var Tj=(n,t)=>()=>(t||n((t={exports:{}}).exports,t),t.exports);var XBt=Tj((yzt,pq)=>{function Nj(n,t){for(var e=0;e<t.length;e++){const r=t[e];if(typeof r!="string"&&!Array.isArray(r)){for(const o in r)if(o!=="default"&&!(o in n)){const a=Object.getOwnPropertyDescriptor(r,o);a&&Object.defineProperty(n,o,a.get?a:{enumerable:!0,get:()=>r[o]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function e(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(o){if(o.ep)return;o.ep=!0;const a=e(o);fetch(o.href,a)}})();function Aj(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function _j(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var t=n.default;if(typeof t=="function"){var e=function r(){var o=!1;try{o=this instanceof r}catch{}return o?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};e.prototype=t.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var o=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(e,r,o.get?o:{enumerable:!0,get:function(){return n[r]}})}),e}var uC={exports:{}},kp={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var l$;function Dj(){if(l$)return kp;l$=1;var n=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function e(r,o,a){var i=null;if(a!==void 0&&(i=""+a),o.key!==void 0&&(i=""+o.key),"key"in o){a={};for(var s in o)s!=="key"&&(a[s]=o[s])}else a=o;return o=a.ref,{$$typeof:n,type:r,key:i,ref:o!==void 0?o:null,props:a}}return kp.Fragment=t,kp.jsx=e,kp.jsxs=e,kp}var c$;function $j(){return c$||(c$=1,uC.exports=Dj()),uC.exports}var Ot=$j(),lC={exports:{}},Re={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var h$;function Oj(){if(h$)return Re;h$=1;var n=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),e=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),a=Symbol.for("react.consumer"),i=Symbol.for("react.context"),s=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),l=Symbol.for("react.memo"),c=Symbol.for("react.lazy"),h=Symbol.iterator;function d(M){return M===null||typeof M!="object"?null:(M=h&&M[h]||M["@@iterator"],typeof M=="function"?M:null)}var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},g=Object.assign,x={};function y(M,G,Q){this.props=M,this.context=G,this.refs=x,this.updater=Q||p}y.prototype.isReactComponent={},y.prototype.setState=function(M,G){if(typeof M!="object"&&typeof M!="function"&&M!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,M,G,"setState")},y.prototype.forceUpdate=function(M){this.updater.enqueueForceUpdate(this,M,"forceUpdate")};function b(){}b.prototype=y.prototype;function C(M,G,Q){this.props=M,this.context=G,this.refs=x,this.updater=Q||p}var E=C.prototype=new b;E.constructor=C,g(E,y.prototype),E.isPureReactComponent=!0;var S=Array.isArray,k={H:null,A:null,T:null,S:null,V:null},R=Object.prototype.hasOwnProperty;function A(M,G,Q,Z,rt,ct){return Q=ct.ref,{$$typeof:n,type:M,key:G,ref:Q!==void 0?Q:null,props:ct}}function N(M,G){return A(M.type,G,void 0,void 0,void 0,M.props)}function _(M){return typeof M=="object"&&M!==null&&M.$$typeof===n}function $(M){var G={"=":"=0",":":"=2"};return"$"+M.replace(/[=:]/g,function(Q){return G[Q]})}var D=/\/+/g;function O(M,G){return typeof M=="object"&&M!==null&&M.key!=null?$(""+M.key):G.toString(36)}function P(){}function z(M){switch(M.status){case"fulfilled":return M.value;case"rejected":throw M.reason;default:switch(typeof M.status=="string"?M.then(P,P):(M.status="pending",M.then(function(G){M.status==="pending"&&(M.status="fulfilled",M.value=G)},function(G){M.status==="pending"&&(M.status="rejected",M.reason=G)})),M.status){case"fulfilled":return M.value;case"rejected":throw M.reason}}throw M}function W(M,G,Q,Z,rt){var ct=typeof M;(ct==="undefined"||ct==="boolean")&&(M=null);var pt=!1;if(M===null)pt=!0;else switch(ct){case"bigint":case"string":case"number":pt=!0;break;case"object":switch(M.$$typeof){case n:case t:pt=!0;break;case c:return pt=M._init,W(pt(M._payload),G,Q,Z,rt)}}if(pt)return rt=rt(M),pt=Z===""?"."+O(M,0):Z,S(rt)?(Q="",pt!=null&&(Q=pt.replace(D,"$&/")+"/"),W(rt,G,Q,"",function(Ft){return Ft})):rt!=null&&(_(rt)&&(rt=N(rt,Q+(rt.key==null||M&&M.key===rt.key?"":(""+rt.key).replace(D,"$&/")+"/")+pt)),G.push(rt)),1;pt=0;var Rt=Z===""?".":Z+":";if(S(M))for(var Ct=0;Ct<M.length;Ct++)Z=M[Ct],ct=Rt+O(Z,Ct),pt+=W(Z,G,Q,ct,rt);else if(Ct=d(M),typeof Ct=="function")for(M=Ct.call(M),Ct=0;!(Z=M.next()).done;)Z=Z.value,ct=Rt+O(Z,Ct++),pt+=W(Z,G,Q,ct,rt);else if(ct==="object"){if(typeof M.then=="function")return W(z(M),G,Q,Z,rt);throw G=String(M),Error("Objects are not valid as a React child (found: "+(G==="[object Object]"?"object with keys {"+Object.keys(M).join(", ")+"}":G)+"). If you meant to render a collection of children, use an array instead.")}return pt}function F(M,G,Q){if(M==null)return M;var Z=[],rt=0;return W(M,Z,"","",function(ct){return G.call(Q,ct,rt++)}),Z}function B(M){if(M._status===-1){var G=M._result;G=G(),G.then(function(Q){(M._status===0||M._status===-1)&&(M._status=1,M._result=Q)},function(Q){(M._status===0||M._status===-1)&&(M._status=2,M._result=Q)}),M._status===-1&&(M._status=0,M._result=G)}if(M._status===1)return M._result.default;throw M._result}var U=typeof reportError=="function"?reportError:function(M){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var G=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof M=="object"&&M!==null&&typeof M.message=="string"?String(M.message):String(M),error:M});if(!window.dispatchEvent(G))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",M);return}console.error(M)};function q(){}return Re.Children={map:F,forEach:function(M,G,Q){F(M,function(){G.apply(this,arguments)},Q)},count:function(M){var G=0;return F(M,function(){G++}),G},toArray:function(M){return F(M,function(G){return G})||[]},only:function(M){if(!_(M))throw Error("React.Children.only expected to receive a single React element child.");return M}},Re.Component=y,Re.Fragment=e,Re.Profiler=o,Re.PureComponent=C,Re.StrictMode=r,Re.Suspense=u,Re.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=k,Re.__COMPILER_RUNTIME={__proto__:null,c:function(M){return k.H.useMemoCache(M)}},Re.cache=function(M){return function(){return M.apply(null,arguments)}},Re.cloneElement=function(M,G,Q){if(M==null)throw Error("The argument must be a React element, but you passed "+M+".");var Z=g({},M.props),rt=M.key,ct=void 0;if(G!=null)for(pt in G.ref!==void 0&&(ct=void 0),G.key!==void 0&&(rt=""+G.key),G)!R.call(G,pt)||pt==="key"||pt==="__self"||pt==="__source"||pt==="ref"&&G.ref===void 0||(Z[pt]=G[pt]);var pt=arguments.length-2;if(pt===1)Z.children=Q;else if(1<pt){for(var Rt=Array(pt),Ct=0;Ct<pt;Ct++)Rt[Ct]=arguments[Ct+2];Z.children=Rt}return A(M.type,rt,void 0,void 0,ct,Z)},Re.createContext=function(M){return M={$$typeof:i,_currentValue:M,_currentValue2:M,_threadCount:0,Provider:null,Consumer:null},M.Provider=M,M.Consumer={$$typeof:a,_context:M},M},Re.createElement=function(M,G,Q){var Z,rt={},ct=null;if(G!=null)for(Z in G.key!==void 0&&(ct=""+G.key),G)R.call(G,Z)&&Z!=="key"&&Z!=="__self"&&Z!=="__source"&&(rt[Z]=G[Z]);var pt=arguments.length-2;if(pt===1)rt.children=Q;else if(1<pt){for(var Rt=Array(pt),Ct=0;Ct<pt;Ct++)Rt[Ct]=arguments[Ct+2];rt.children=Rt}if(M&&M.defaultProps)for(Z in pt=M.defaultProps,pt)rt[Z]===void 0&&(rt[Z]=pt[Z]);return A(M,ct,void 0,void 0,null,rt)},Re.createRef=function(){return{current:null}},Re.forwardRef=function(M){return{$$typeof:s,render:M}},Re.isValidElement=_,Re.lazy=function(M){return{$$typeof:c,_payload:{_status:-1,_result:M},_init:B}},Re.memo=function(M,G){return{$$typeof:l,type:M,compare:G===void 0?null:G}},Re.startTransition=function(M){var G=k.T,Q={};k.T=Q;try{var Z=M(),rt=k.S;rt!==null&&rt(Q,Z),typeof Z=="object"&&Z!==null&&typeof Z.then=="function"&&Z.then(q,U)}catch(ct){U(ct)}finally{k.T=G}},Re.unstable_useCacheRefresh=function(){return k.H.useCacheRefresh()},Re.use=function(M){return k.H.use(M)},Re.useActionState=function(M,G,Q){return k.H.useActionState(M,G,Q)},Re.useCallback=function(M,G){return k.H.useCallback(M,G)},Re.useContext=function(M){return k.H.useContext(M)},Re.useDebugValue=function(){},Re.useDeferredValue=function(M,G){return k.H.useDeferredValue(M,G)},Re.useEffect=function(M,G,Q){var Z=k.H;if(typeof Q=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return Z.useEffect(M,G)},Re.useId=function(){return k.H.useId()},Re.useImperativeHandle=function(M,G,Q){return k.H.useImperativeHandle(M,G,Q)},Re.useInsertionEffect=function(M,G){return k.H.useInsertionEffect(M,G)},Re.useLayoutEffect=function(M,G){return k.H.useLayoutEffect(M,G)},Re.useMemo=function(M,G){return k.H.useMemo(M,G)},Re.useOptimistic=function(M,G){return k.H.useOptimistic(M,G)},Re.useReducer=function(M,G,Q){return k.H.useReducer(M,G,Q)},Re.useRef=function(M){return k.H.useRef(M)},Re.useState=function(M){return k.H.useState(M)},Re.useSyncExternalStore=function(M,G,Q){return k.H.useSyncExternalStore(M,G,Q)},Re.useTransition=function(){return k.H.useTransition()},Re.version="19.1.0",Re}var f$;function ik(){return f$||(f$=1,lC.exports=Oj()),lC.exports}var _t=ik(),cC={exports:{}},Ip={},hC={exports:{}},fC={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var d$;function Fj(){return d$||(d$=1,function(n){function t(F,B){var U=F.length;F.push(B);t:for(;0<U;){var q=U-1>>>1,M=F[q];if(0<o(M,B))F[q]=B,F[U]=M,U=q;else break t}}function e(F){return F.length===0?null:F[0]}function r(F){if(F.length===0)return null;var B=F[0],U=F.pop();if(U!==B){F[0]=U;t:for(var q=0,M=F.length,G=M>>>1;q<G;){var Q=2*(q+1)-1,Z=F[Q],rt=Q+1,ct=F[rt];if(0>o(Z,U))rt<M&&0>o(ct,Z)?(F[q]=ct,F[rt]=U,q=rt):(F[q]=Z,F[Q]=U,q=Q);else if(rt<M&&0>o(ct,U))F[q]=ct,F[rt]=U,q=rt;else break t}}return B}function o(F,B){var U=F.sortIndex-B.sortIndex;return U!==0?U:F.id-B.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var a=performance;n.unstable_now=function(){return a.now()}}else{var i=Date,s=i.now();n.unstable_now=function(){return i.now()-s}}var u=[],l=[],c=1,h=null,d=3,p=!1,g=!1,x=!1,y=!1,b=typeof setTimeout=="function"?setTimeout:null,C=typeof clearTimeout=="function"?clearTimeout:null,E=typeof setImmediate<"u"?setImmediate:null;function S(F){for(var B=e(l);B!==null;){if(B.callback===null)r(l);else if(B.startTime<=F)r(l),B.sortIndex=B.expirationTime,t(u,B);else break;B=e(l)}}function k(F){if(x=!1,S(F),!g)if(e(u)!==null)g=!0,R||(R=!0,O());else{var B=e(l);B!==null&&W(k,B.startTime-F)}}var R=!1,A=-1,N=5,_=-1;function $(){return y?!0:!(n.unstable_now()-_<N)}function D(){if(y=!1,R){var F=n.unstable_now();_=F;var B=!0;try{t:{g=!1,x&&(x=!1,C(A),A=-1),p=!0;var U=d;try{e:{for(S(F),h=e(u);h!==null&&!(h.expirationTime>F&&$());){var q=h.callback;if(typeof q=="function"){h.callback=null,d=h.priorityLevel;var M=q(h.expirationTime<=F);if(F=n.unstable_now(),typeof M=="function"){h.callback=M,S(F),B=!0;break e}h===e(u)&&r(u),S(F)}else r(u);h=e(u)}if(h!==null)B=!0;else{var G=e(l);G!==null&&W(k,G.startTime-F),B=!1}}break t}finally{h=null,d=U,p=!1}B=void 0}}finally{B?O():R=!1}}}var O;if(typeof E=="function")O=function(){E(D)};else if(typeof MessageChannel<"u"){var P=new MessageChannel,z=P.port2;P.port1.onmessage=D,O=function(){z.postMessage(null)}}else O=function(){b(D,0)};function W(F,B){A=b(function(){F(n.unstable_now())},B)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(F){F.callback=null},n.unstable_forceFrameRate=function(F){0>F||125<F?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):N=0<F?Math.floor(1e3/F):5},n.unstable_getCurrentPriorityLevel=function(){return d},n.unstable_next=function(F){switch(d){case 1:case 2:case 3:var B=3;break;default:B=d}var U=d;d=B;try{return F()}finally{d=U}},n.unstable_requestPaint=function(){y=!0},n.unstable_runWithPriority=function(F,B){switch(F){case 1:case 2:case 3:case 4:case 5:break;default:F=3}var U=d;d=F;try{return B()}finally{d=U}},n.unstable_scheduleCallback=function(F,B,U){var q=n.unstable_now();switch(typeof U=="object"&&U!==null?(U=U.delay,U=typeof U=="number"&&0<U?q+U:q):U=q,F){case 1:var M=-1;break;case 2:M=250;break;case 5:M=1073741823;break;case 4:M=1e4;break;default:M=5e3}return M=U+M,F={id:c++,callback:B,priorityLevel:F,startTime:U,expirationTime:M,sortIndex:-1},U>q?(F.sortIndex=U,t(l,F),e(u)===null&&F===e(l)&&(x?(C(A),A=-1):x=!0,W(k,U-q))):(F.sortIndex=M,t(u,F),g||p||(g=!0,R||(R=!0,O()))),F},n.unstable_shouldYield=$,n.unstable_wrapCallback=function(F){var B=d;return function(){var U=d;d=B;try{return F.apply(this,arguments)}finally{d=U}}}}(fC)),fC}var p$;function Mj(){return p$||(p$=1,hC.exports=Fj()),hC.exports}var dC={exports:{}},uo={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var m$;function Lj(){if(m$)return uo;m$=1;var n=ik();function t(u){var l="https://react.dev/errors/"+u;if(1<arguments.length){l+="?args[]="+encodeURIComponent(arguments[1]);for(var c=2;c<arguments.length;c++)l+="&args[]="+encodeURIComponent(arguments[c])}return"Minified React error #"+u+"; visit "+l+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function e(){}var r={d:{f:e,r:function(){throw Error(t(522))},D:e,C:e,L:e,m:e,X:e,S:e,M:e},p:0,findDOMNode:null},o=Symbol.for("react.portal");function a(u,l,c){var h=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:o,key:h==null?null:""+h,children:u,containerInfo:l,implementation:c}}var i=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function s(u,l){if(u==="font")return"";if(typeof l=="string")return l==="use-credentials"?l:""}return uo.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,uo.createPortal=function(u,l){var c=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!l||l.nodeType!==1&&l.nodeType!==9&&l.nodeType!==11)throw Error(t(299));return a(u,l,null,c)},uo.flushSync=function(u){var l=i.T,c=r.p;try{if(i.T=null,r.p=2,u)return u()}finally{i.T=l,r.p=c,r.d.f()}},uo.preconnect=function(u,l){typeof u=="string"&&(l?(l=l.crossOrigin,l=typeof l=="string"?l==="use-credentials"?l:"":void 0):l=null,r.d.C(u,l))},uo.prefetchDNS=function(u){typeof u=="string"&&r.d.D(u)},uo.preinit=function(u,l){if(typeof u=="string"&&l&&typeof l.as=="string"){var c=l.as,h=s(c,l.crossOrigin),d=typeof l.integrity=="string"?l.integrity:void 0,p=typeof l.fetchPriority=="string"?l.fetchPriority:void 0;c==="style"?r.d.S(u,typeof l.precedence=="string"?l.precedence:void 0,{crossOrigin:h,integrity:d,fetchPriority:p}):c==="script"&&r.d.X(u,{crossOrigin:h,integrity:d,fetchPriority:p,nonce:typeof l.nonce=="string"?l.nonce:void 0})}},uo.preinitModule=function(u,l){if(typeof u=="string")if(typeof l=="object"&&l!==null){if(l.as==null||l.as==="script"){var c=s(l.as,l.crossOrigin);r.d.M(u,{crossOrigin:c,integrity:typeof l.integrity=="string"?l.integrity:void 0,nonce:typeof l.nonce=="string"?l.nonce:void 0})}}else l==null&&r.d.M(u)},uo.preload=function(u,l){if(typeof u=="string"&&typeof l=="object"&&l!==null&&typeof l.as=="string"){var c=l.as,h=s(c,l.crossOrigin);r.d.L(u,c,{crossOrigin:h,integrity:typeof l.integrity=="string"?l.integrity:void 0,nonce:typeof l.nonce=="string"?l.nonce:void 0,type:typeof l.type=="string"?l.type:void 0,fetchPriority:typeof l.fetchPriority=="string"?l.fetchPriority:void 0,referrerPolicy:typeof l.referrerPolicy=="string"?l.referrerPolicy:void 0,imageSrcSet:typeof l.imageSrcSet=="string"?l.imageSrcSet:void 0,imageSizes:typeof l.imageSizes=="string"?l.imageSizes:void 0,media:typeof l.media=="string"?l.media:void 0})}},uo.preloadModule=function(u,l){if(typeof u=="string")if(l){var c=s(l.as,l.crossOrigin);r.d.m(u,{as:typeof l.as=="string"&&l.as!=="script"?l.as:void 0,crossOrigin:c,integrity:typeof l.integrity=="string"?l.integrity:void 0})}else r.d.m(u)},uo.requestFormReset=function(u){r.d.r(u)},uo.unstable_batchedUpdates=function(u,l){return u(l)},uo.useFormState=function(u,l,c){return i.H.useFormState(u,l,c)},uo.useFormStatus=function(){return i.H.useHostTransitionStatus()},uo.version="19.1.0",uo}var g$;function Pj(){if(g$)return dC.exports;g$=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(t){console.error(t)}}return n(),dC.exports=Lj(),dC.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var v$;function Bj(){if(v$)return Ip;v$=1;var n=Mj(),t=ik(),e=Pj();function r(f){var m="https://react.dev/errors/"+f;if(1<arguments.length){m+="?args[]="+encodeURIComponent(arguments[1]);for(var v=2;v<arguments.length;v++)m+="&args[]="+encodeURIComponent(arguments[v])}return"Minified React error #"+f+"; visit "+m+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function o(f){return!(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11)}function a(f){var m=f,v=f;if(f.alternate)for(;m.return;)m=m.return;else{f=m;do m=f,(m.flags&4098)!==0&&(v=m.return),f=m.return;while(f)}return m.tag===3?v:null}function i(f){if(f.tag===13){var m=f.memoizedState;if(m===null&&(f=f.alternate,f!==null&&(m=f.memoizedState)),m!==null)return m.dehydrated}return null}function s(f){if(a(f)!==f)throw Error(r(188))}function u(f){var m=f.alternate;if(!m){if(m=a(f),m===null)throw Error(r(188));return m!==f?null:f}for(var v=f,w=m;;){var I=v.return;if(I===null)break;var T=I.alternate;if(T===null){if(w=I.return,w!==null){v=w;continue}break}if(I.child===T.child){for(T=I.child;T;){if(T===v)return s(I),f;if(T===w)return s(I),m;T=T.sibling}throw Error(r(188))}if(v.return!==w.return)v=I,w=T;else{for(var L=!1,V=I.child;V;){if(V===v){L=!0,v=I,w=T;break}if(V===w){L=!0,w=I,v=T;break}V=V.sibling}if(!L){for(V=T.child;V;){if(V===v){L=!0,v=T,w=I;break}if(V===w){L=!0,w=T,v=I;break}V=V.sibling}if(!L)throw Error(r(189))}}if(v.alternate!==w)throw Error(r(190))}if(v.tag!==3)throw Error(r(188));return v.stateNode.current===v?f:m}function l(f){var m=f.tag;if(m===5||m===26||m===27||m===6)return f;for(f=f.child;f!==null;){if(m=l(f),m!==null)return m;f=f.sibling}return null}var c=Object.assign,h=Symbol.for("react.element"),d=Symbol.for("react.transitional.element"),p=Symbol.for("react.portal"),g=Symbol.for("react.fragment"),x=Symbol.for("react.strict_mode"),y=Symbol.for("react.profiler"),b=Symbol.for("react.provider"),C=Symbol.for("react.consumer"),E=Symbol.for("react.context"),S=Symbol.for("react.forward_ref"),k=Symbol.for("react.suspense"),R=Symbol.for("react.suspense_list"),A=Symbol.for("react.memo"),N=Symbol.for("react.lazy"),_=Symbol.for("react.activity"),$=Symbol.for("react.memo_cache_sentinel"),D=Symbol.iterator;function O(f){return f===null||typeof f!="object"?null:(f=D&&f[D]||f["@@iterator"],typeof f=="function"?f:null)}var P=Symbol.for("react.client.reference");function z(f){if(f==null)return null;if(typeof f=="function")return f.$$typeof===P?null:f.displayName||f.name||null;if(typeof f=="string")return f;switch(f){case g:return"Fragment";case y:return"Profiler";case x:return"StrictMode";case k:return"Suspense";case R:return"SuspenseList";case _:return"Activity"}if(typeof f=="object")switch(f.$$typeof){case p:return"Portal";case E:return(f.displayName||"Context")+".Provider";case C:return(f._context.displayName||"Context")+".Consumer";case S:var m=f.render;return f=f.displayName,f||(f=m.displayName||m.name||"",f=f!==""?"ForwardRef("+f+")":"ForwardRef"),f;case A:return m=f.displayName||null,m!==null?m:z(f.type)||"Memo";case N:m=f._payload,f=f._init;try{return z(f(m))}catch{}}return null}var W=Array.isArray,F=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,B=e.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,U={pending:!1,data:null,method:null,action:null},q=[],M=-1;function G(f){return{current:f}}function Q(f){0>M||(f.current=q[M],q[M]=null,M--)}function Z(f,m){M++,q[M]=f.current,f.current=m}var rt=G(null),ct=G(null),pt=G(null),Rt=G(null);function Ct(f,m){switch(Z(pt,m),Z(ct,f),Z(rt,null),m.nodeType){case 9:case 11:f=(f=m.documentElement)&&(f=f.namespaceURI)?LD(f):0;break;default:if(f=m.tagName,m=m.namespaceURI)m=LD(m),f=PD(m,f);else switch(f){case"svg":f=1;break;case"math":f=2;break;default:f=0}}Q(rt),Z(rt,f)}function Ft(){Q(rt),Q(ct),Q(pt)}function Ut(f){f.memoizedState!==null&&Z(Rt,f);var m=rt.current,v=PD(m,f.type);m!==v&&(Z(ct,f),Z(rt,v))}function Pt(f){ct.current===f&&(Q(rt),Q(ct)),Rt.current===f&&(Q(Rt),bp._currentValue=U)}var Vt=Object.prototype.hasOwnProperty,Ht=n.unstable_scheduleCallback,ee=n.unstable_cancelCallback,te=n.unstable_shouldYield,ne=n.unstable_requestPaint,ge=n.unstable_now,we=n.unstable_getCurrentPriorityLevel,en=n.unstable_ImmediatePriority,ze=n.unstable_UserBlockingPriority,un=n.unstable_NormalPriority,nn=n.unstable_LowPriority,Gn=n.unstable_IdlePriority,Dn=n.log,Bn=n.unstable_setDisableYieldValue,cr=null,Ge=null;function mn(f){if(typeof Dn=="function"&&Bn(f),Ge&&typeof Ge.setStrictMode=="function")try{Ge.setStrictMode(cr,f)}catch{}}var zn=Math.clz32?Math.clz32:Td,Al=Math.log,_l=Math.LN2;function Td(f){return f>>>=0,f===0?32:31-(Al(f)/_l|0)|0}var Jo=256,ki=4194304;function ta(f){var m=f&42;if(m!==0)return m;switch(f&-f){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return f&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return f&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return f}}function pv(f,m,v){var w=f.pendingLanes;if(w===0)return 0;var I=0,T=f.suspendedLanes,L=f.pingedLanes;f=f.warmLanes;var V=w&134217727;return V!==0?(w=V&~T,w!==0?I=ta(w):(L&=V,L!==0?I=ta(L):v||(v=V&~f,v!==0&&(I=ta(v))))):(V=w&~T,V!==0?I=ta(V):L!==0?I=ta(L):v||(v=w&~f,v!==0&&(I=ta(v)))),I===0?0:m!==0&&m!==I&&(m&T)===0&&(T=I&-I,v=m&-m,T>=v||T===32&&(v&4194048)!==0)?m:I}function Nd(f,m){return(f.pendingLanes&~(f.suspendedLanes&~f.pingedLanes)&m)===0}function mq(f,m){switch(f){case 1:case 2:case 4:case 8:case 64:return m+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return m+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function bN(){var f=Jo;return Jo<<=1,(Jo&4194048)===0&&(Jo=256),f}function wN(){var f=ki;return ki<<=1,(ki&62914560)===0&&(ki=4194304),f}function Qb(f){for(var m=[],v=0;31>v;v++)m.push(f);return m}function Ad(f,m){f.pendingLanes|=m,m!==268435456&&(f.suspendedLanes=0,f.pingedLanes=0,f.warmLanes=0)}function gq(f,m,v,w,I,T){var L=f.pendingLanes;f.pendingLanes=v,f.suspendedLanes=0,f.pingedLanes=0,f.warmLanes=0,f.expiredLanes&=v,f.entangledLanes&=v,f.errorRecoveryDisabledLanes&=v,f.shellSuspendCounter=0;var V=f.entanglements,tt=f.expirationTimes,vt=f.hiddenUpdates;for(v=L&~v;0<v;){var At=31-zn(v),$t=1<<At;V[At]=0,tt[At]=-1;var xt=vt[At];if(xt!==null)for(vt[At]=null,At=0;At<xt.length;At++){var bt=xt[At];bt!==null&&(bt.lane&=-536870913)}v&=~$t}w!==0&&CN(f,w,0),T!==0&&I===0&&f.tag!==0&&(f.suspendedLanes|=T&~(L&~m))}function CN(f,m,v){f.pendingLanes|=m,f.suspendedLanes&=~m;var w=31-zn(m);f.entangledLanes|=m,f.entanglements[w]=f.entanglements[w]|1073741824|v&4194090}function SN(f,m){var v=f.entangledLanes|=m;for(f=f.entanglements;v;){var w=31-zn(v),I=1<<w;I&m|f[w]&m&&(f[w]|=m),v&=~I}}function Zb(f){switch(f){case 2:f=1;break;case 8:f=4;break;case 32:f=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:f=128;break;case 268435456:f=134217728;break;default:f=0}return f}function Jb(f){return f&=-f,2<f?8<f?(f&134217727)!==0?32:268435456:8:2}function EN(){var f=B.p;return f!==0?f:(f=window.event,f===void 0?32:r$(f.type))}function vq(f,m){var v=B.p;try{return B.p=f,m()}finally{B.p=v}}var pu=Math.random().toString(36).slice(2),io="__reactFiber$"+pu,Fo="__reactProps$"+pu,ch="__reactContainer$"+pu,tw="__reactEvents$"+pu,xq="__reactListeners$"+pu,yq="__reactHandles$"+pu,kN="__reactResources$"+pu,_d="__reactMarker$"+pu;function ew(f){delete f[io],delete f[Fo],delete f[tw],delete f[xq],delete f[yq]}function hh(f){var m=f[io];if(m)return m;for(var v=f.parentNode;v;){if(m=v[ch]||v[io]){if(v=m.alternate,m.child!==null||v!==null&&v.child!==null)for(f=WD(f);f!==null;){if(v=f[io])return v;f=WD(f)}return m}f=v,v=f.parentNode}return null}function fh(f){if(f=f[io]||f[ch]){var m=f.tag;if(m===5||m===6||m===13||m===26||m===27||m===3)return f}return null}function Dd(f){var m=f.tag;if(m===5||m===26||m===27||m===6)return f.stateNode;throw Error(r(33))}function dh(f){var m=f[kN];return m||(m=f[kN]={hoistableStyles:new Map,hoistableScripts:new Map}),m}function $r(f){f[_d]=!0}var IN=new Set,RN={};function Dl(f,m){ph(f,m),ph(f+"Capture",m)}function ph(f,m){for(RN[f]=m,f=0;f<m.length;f++)IN.add(m[f])}var bq=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),TN={},NN={};function wq(f){return Vt.call(NN,f)?!0:Vt.call(TN,f)?!1:bq.test(f)?NN[f]=!0:(TN[f]=!0,!1)}function mv(f,m,v){if(wq(m))if(v===null)f.removeAttribute(m);else{switch(typeof v){case"undefined":case"function":case"symbol":f.removeAttribute(m);return;case"boolean":var w=m.toLowerCase().slice(0,5);if(w!=="data-"&&w!=="aria-"){f.removeAttribute(m);return}}f.setAttribute(m,""+v)}}function gv(f,m,v){if(v===null)f.removeAttribute(m);else{switch(typeof v){case"undefined":case"function":case"symbol":case"boolean":f.removeAttribute(m);return}f.setAttribute(m,""+v)}}function ys(f,m,v,w){if(w===null)f.removeAttribute(v);else{switch(typeof w){case"undefined":case"function":case"symbol":case"boolean":f.removeAttribute(v);return}f.setAttributeNS(m,v,""+w)}}var nw,AN;function mh(f){if(nw===void 0)try{throw Error()}catch(v){var m=v.stack.trim().match(/\n( *(at )?)/);nw=m&&m[1]||"",AN=-1<v.stack.indexOf(`
    at`)?" (<anonymous>)":-1<v.stack.indexOf("@")?"@unknown:0:0":""}return`
`+nw+f+AN}var rw=!1;function ow(f,m){if(!f||rw)return"";rw=!0;var v=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var w={DetermineComponentFrameRoot:function(){try{if(m){var $t=function(){throw Error()};if(Object.defineProperty($t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct($t,[])}catch(bt){var xt=bt}Reflect.construct(f,[],$t)}else{try{$t.call()}catch(bt){xt=bt}f.call($t.prototype)}}else{try{throw Error()}catch(bt){xt=bt}($t=f())&&typeof $t.catch=="function"&&$t.catch(function(){})}}catch(bt){if(bt&&xt&&typeof bt.stack=="string")return[bt.stack,xt.stack]}return[null,null]}};w.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var I=Object.getOwnPropertyDescriptor(w.DetermineComponentFrameRoot,"name");I&&I.configurable&&Object.defineProperty(w.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var T=w.DetermineComponentFrameRoot(),L=T[0],V=T[1];if(L&&V){var tt=L.split(`
`),vt=V.split(`
`);for(I=w=0;w<tt.length&&!tt[w].includes("DetermineComponentFrameRoot");)w++;for(;I<vt.length&&!vt[I].includes("DetermineComponentFrameRoot");)I++;if(w===tt.length||I===vt.length)for(w=tt.length-1,I=vt.length-1;1<=w&&0<=I&&tt[w]!==vt[I];)I--;for(;1<=w&&0<=I;w--,I--)if(tt[w]!==vt[I]){if(w!==1||I!==1)do if(w--,I--,0>I||tt[w]!==vt[I]){var At=`
`+tt[w].replace(" at new "," at ");return f.displayName&&At.includes("<anonymous>")&&(At=At.replace("<anonymous>",f.displayName)),At}while(1<=w&&0<=I);break}}}finally{rw=!1,Error.prepareStackTrace=v}return(v=f?f.displayName||f.name:"")?mh(v):""}function Cq(f){switch(f.tag){case 26:case 27:case 5:return mh(f.type);case 16:return mh("Lazy");case 13:return mh("Suspense");case 19:return mh("SuspenseList");case 0:case 15:return ow(f.type,!1);case 11:return ow(f.type.render,!1);case 1:return ow(f.type,!0);case 31:return mh("Activity");default:return""}}function _N(f){try{var m="";do m+=Cq(f),f=f.return;while(f);return m}catch(v){return`
Error generating stack: `+v.message+`
`+v.stack}}function Ea(f){switch(typeof f){case"bigint":case"boolean":case"number":case"string":case"undefined":return f;case"object":return f;default:return""}}function DN(f){var m=f.type;return(f=f.nodeName)&&f.toLowerCase()==="input"&&(m==="checkbox"||m==="radio")}function Sq(f){var m=DN(f)?"checked":"value",v=Object.getOwnPropertyDescriptor(f.constructor.prototype,m),w=""+f[m];if(!f.hasOwnProperty(m)&&typeof v<"u"&&typeof v.get=="function"&&typeof v.set=="function"){var I=v.get,T=v.set;return Object.defineProperty(f,m,{configurable:!0,get:function(){return I.call(this)},set:function(L){w=""+L,T.call(this,L)}}),Object.defineProperty(f,m,{enumerable:v.enumerable}),{getValue:function(){return w},setValue:function(L){w=""+L},stopTracking:function(){f._valueTracker=null,delete f[m]}}}}function vv(f){f._valueTracker||(f._valueTracker=Sq(f))}function $N(f){if(!f)return!1;var m=f._valueTracker;if(!m)return!0;var v=m.getValue(),w="";return f&&(w=DN(f)?f.checked?"true":"false":f.value),f=w,f!==v?(m.setValue(f),!0):!1}function xv(f){if(f=f||(typeof document<"u"?document:void 0),typeof f>"u")return null;try{return f.activeElement||f.body}catch{return f.body}}var Eq=/[\n"\\]/g;function ka(f){return f.replace(Eq,function(m){return"\\"+m.charCodeAt(0).toString(16)+" "})}function aw(f,m,v,w,I,T,L,V){f.name="",L!=null&&typeof L!="function"&&typeof L!="symbol"&&typeof L!="boolean"?f.type=L:f.removeAttribute("type"),m!=null?L==="number"?(m===0&&f.value===""||f.value!=m)&&(f.value=""+Ea(m)):f.value!==""+Ea(m)&&(f.value=""+Ea(m)):L!=="submit"&&L!=="reset"||f.removeAttribute("value"),m!=null?iw(f,L,Ea(m)):v!=null?iw(f,L,Ea(v)):w!=null&&f.removeAttribute("value"),I==null&&T!=null&&(f.defaultChecked=!!T),I!=null&&(f.checked=I&&typeof I!="function"&&typeof I!="symbol"),V!=null&&typeof V!="function"&&typeof V!="symbol"&&typeof V!="boolean"?f.name=""+Ea(V):f.removeAttribute("name")}function ON(f,m,v,w,I,T,L,V){if(T!=null&&typeof T!="function"&&typeof T!="symbol"&&typeof T!="boolean"&&(f.type=T),m!=null||v!=null){if(!(T!=="submit"&&T!=="reset"||m!=null))return;v=v!=null?""+Ea(v):"",m=m!=null?""+Ea(m):v,V||m===f.value||(f.value=m),f.defaultValue=m}w=w??I,w=typeof w!="function"&&typeof w!="symbol"&&!!w,f.checked=V?f.checked:!!w,f.defaultChecked=!!w,L!=null&&typeof L!="function"&&typeof L!="symbol"&&typeof L!="boolean"&&(f.name=L)}function iw(f,m,v){m==="number"&&xv(f.ownerDocument)===f||f.defaultValue===""+v||(f.defaultValue=""+v)}function gh(f,m,v,w){if(f=f.options,m){m={};for(var I=0;I<v.length;I++)m["$"+v[I]]=!0;for(v=0;v<f.length;v++)I=m.hasOwnProperty("$"+f[v].value),f[v].selected!==I&&(f[v].selected=I),I&&w&&(f[v].defaultSelected=!0)}else{for(v=""+Ea(v),m=null,I=0;I<f.length;I++){if(f[I].value===v){f[I].selected=!0,w&&(f[I].defaultSelected=!0);return}m!==null||f[I].disabled||(m=f[I])}m!==null&&(m.selected=!0)}}function FN(f,m,v){if(m!=null&&(m=""+Ea(m),m!==f.value&&(f.value=m),v==null)){f.defaultValue!==m&&(f.defaultValue=m);return}f.defaultValue=v!=null?""+Ea(v):""}function MN(f,m,v,w){if(m==null){if(w!=null){if(v!=null)throw Error(r(92));if(W(w)){if(1<w.length)throw Error(r(93));w=w[0]}v=w}v==null&&(v=""),m=v}v=Ea(m),f.defaultValue=v,w=f.textContent,w===v&&w!==""&&w!==null&&(f.value=w)}function vh(f,m){if(m){var v=f.firstChild;if(v&&v===f.lastChild&&v.nodeType===3){v.nodeValue=m;return}}f.textContent=m}var kq=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function LN(f,m,v){var w=m.indexOf("--")===0;v==null||typeof v=="boolean"||v===""?w?f.setProperty(m,""):m==="float"?f.cssFloat="":f[m]="":w?f.setProperty(m,v):typeof v!="number"||v===0||kq.has(m)?m==="float"?f.cssFloat=v:f[m]=(""+v).trim():f[m]=v+"px"}function PN(f,m,v){if(m!=null&&typeof m!="object")throw Error(r(62));if(f=f.style,v!=null){for(var w in v)!v.hasOwnProperty(w)||m!=null&&m.hasOwnProperty(w)||(w.indexOf("--")===0?f.setProperty(w,""):w==="float"?f.cssFloat="":f[w]="");for(var I in m)w=m[I],m.hasOwnProperty(I)&&v[I]!==w&&LN(f,I,w)}else for(var T in m)m.hasOwnProperty(T)&&LN(f,T,m[T])}function sw(f){if(f.indexOf("-")===-1)return!1;switch(f){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Iq=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Rq=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function yv(f){return Rq.test(""+f)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":f}var uw=null;function lw(f){return f=f.target||f.srcElement||window,f.correspondingUseElement&&(f=f.correspondingUseElement),f.nodeType===3?f.parentNode:f}var xh=null,yh=null;function BN(f){var m=fh(f);if(m&&(f=m.stateNode)){var v=f[Fo]||null;t:switch(f=m.stateNode,m.type){case"input":if(aw(f,v.value,v.defaultValue,v.defaultValue,v.checked,v.defaultChecked,v.type,v.name),m=v.name,v.type==="radio"&&m!=null){for(v=f;v.parentNode;)v=v.parentNode;for(v=v.querySelectorAll('input[name="'+ka(""+m)+'"][type="radio"]'),m=0;m<v.length;m++){var w=v[m];if(w!==f&&w.form===f.form){var I=w[Fo]||null;if(!I)throw Error(r(90));aw(w,I.value,I.defaultValue,I.defaultValue,I.checked,I.defaultChecked,I.type,I.name)}}for(m=0;m<v.length;m++)w=v[m],w.form===f.form&&$N(w)}break t;case"textarea":FN(f,v.value,v.defaultValue);break t;case"select":m=v.value,m!=null&&gh(f,!!v.multiple,m,!1)}}}var cw=!1;function zN(f,m,v){if(cw)return f(m,v);cw=!0;try{var w=f(m);return w}finally{if(cw=!1,(xh!==null||yh!==null)&&(ox(),xh&&(m=xh,f=yh,yh=xh=null,BN(m),f)))for(m=0;m<f.length;m++)BN(f[m])}}function $d(f,m){var v=f.stateNode;if(v===null)return null;var w=v[Fo]||null;if(w===null)return null;v=w[m];t:switch(m){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(w=!w.disabled)||(f=f.type,w=!(f==="button"||f==="input"||f==="select"||f==="textarea")),f=!w;break t;default:f=!1}if(f)return null;if(v&&typeof v!="function")throw Error(r(231,m,typeof v));return v}var bs=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),hw=!1;if(bs)try{var Od={};Object.defineProperty(Od,"passive",{get:function(){hw=!0}}),window.addEventListener("test",Od,Od),window.removeEventListener("test",Od,Od)}catch{hw=!1}var mu=null,fw=null,bv=null;function UN(){if(bv)return bv;var f,m=fw,v=m.length,w,I="value"in mu?mu.value:mu.textContent,T=I.length;for(f=0;f<v&&m[f]===I[f];f++);var L=v-f;for(w=1;w<=L&&m[v-w]===I[T-w];w++);return bv=I.slice(f,1<w?1-w:void 0)}function wv(f){var m=f.keyCode;return"charCode"in f?(f=f.charCode,f===0&&m===13&&(f=13)):f=m,f===10&&(f=13),32<=f||f===13?f:0}function Cv(){return!0}function WN(){return!1}function Mo(f){function m(v,w,I,T,L){this._reactName=v,this._targetInst=I,this.type=w,this.nativeEvent=T,this.target=L,this.currentTarget=null;for(var V in f)f.hasOwnProperty(V)&&(v=f[V],this[V]=v?v(T):T[V]);return this.isDefaultPrevented=(T.defaultPrevented!=null?T.defaultPrevented:T.returnValue===!1)?Cv:WN,this.isPropagationStopped=WN,this}return c(m.prototype,{preventDefault:function(){this.defaultPrevented=!0;var v=this.nativeEvent;v&&(v.preventDefault?v.preventDefault():typeof v.returnValue!="unknown"&&(v.returnValue=!1),this.isDefaultPrevented=Cv)},stopPropagation:function(){var v=this.nativeEvent;v&&(v.stopPropagation?v.stopPropagation():typeof v.cancelBubble!="unknown"&&(v.cancelBubble=!0),this.isPropagationStopped=Cv)},persist:function(){},isPersistent:Cv}),m}var $l={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(f){return f.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Sv=Mo($l),Fd=c({},$l,{view:0,detail:0}),Tq=Mo(Fd),dw,pw,Md,Ev=c({},Fd,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:gw,button:0,buttons:0,relatedTarget:function(f){return f.relatedTarget===void 0?f.fromElement===f.srcElement?f.toElement:f.fromElement:f.relatedTarget},movementX:function(f){return"movementX"in f?f.movementX:(f!==Md&&(Md&&f.type==="mousemove"?(dw=f.screenX-Md.screenX,pw=f.screenY-Md.screenY):pw=dw=0,Md=f),dw)},movementY:function(f){return"movementY"in f?f.movementY:pw}}),VN=Mo(Ev),Nq=c({},Ev,{dataTransfer:0}),Aq=Mo(Nq),_q=c({},Fd,{relatedTarget:0}),mw=Mo(_q),Dq=c({},$l,{animationName:0,elapsedTime:0,pseudoElement:0}),$q=Mo(Dq),Oq=c({},$l,{clipboardData:function(f){return"clipboardData"in f?f.clipboardData:window.clipboardData}}),Fq=Mo(Oq),Mq=c({},$l,{data:0}),GN=Mo(Mq),Lq={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Pq={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Bq={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function zq(f){var m=this.nativeEvent;return m.getModifierState?m.getModifierState(f):(f=Bq[f])?!!m[f]:!1}function gw(){return zq}var Uq=c({},Fd,{key:function(f){if(f.key){var m=Lq[f.key]||f.key;if(m!=="Unidentified")return m}return f.type==="keypress"?(f=wv(f),f===13?"Enter":String.fromCharCode(f)):f.type==="keydown"||f.type==="keyup"?Pq[f.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:gw,charCode:function(f){return f.type==="keypress"?wv(f):0},keyCode:function(f){return f.type==="keydown"||f.type==="keyup"?f.keyCode:0},which:function(f){return f.type==="keypress"?wv(f):f.type==="keydown"||f.type==="keyup"?f.keyCode:0}}),Wq=Mo(Uq),Vq=c({},Ev,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),HN=Mo(Vq),Gq=c({},Fd,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:gw}),Hq=Mo(Gq),qq=c({},$l,{propertyName:0,elapsedTime:0,pseudoElement:0}),jq=Mo(qq),Xq=c({},Ev,{deltaX:function(f){return"deltaX"in f?f.deltaX:"wheelDeltaX"in f?-f.wheelDeltaX:0},deltaY:function(f){return"deltaY"in f?f.deltaY:"wheelDeltaY"in f?-f.wheelDeltaY:"wheelDelta"in f?-f.wheelDelta:0},deltaZ:0,deltaMode:0}),Kq=Mo(Xq),Yq=c({},$l,{newState:0,oldState:0}),Qq=Mo(Yq),Zq=[9,13,27,32],vw=bs&&"CompositionEvent"in window,Ld=null;bs&&"documentMode"in document&&(Ld=document.documentMode);var Jq=bs&&"TextEvent"in window&&!Ld,qN=bs&&(!vw||Ld&&8<Ld&&11>=Ld),jN=" ",XN=!1;function KN(f,m){switch(f){case"keyup":return Zq.indexOf(m.keyCode)!==-1;case"keydown":return m.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function YN(f){return f=f.detail,typeof f=="object"&&"data"in f?f.data:null}var bh=!1;function t5(f,m){switch(f){case"compositionend":return YN(m);case"keypress":return m.which!==32?null:(XN=!0,jN);case"textInput":return f=m.data,f===jN&&XN?null:f;default:return null}}function e5(f,m){if(bh)return f==="compositionend"||!vw&&KN(f,m)?(f=UN(),bv=fw=mu=null,bh=!1,f):null;switch(f){case"paste":return null;case"keypress":if(!(m.ctrlKey||m.altKey||m.metaKey)||m.ctrlKey&&m.altKey){if(m.char&&1<m.char.length)return m.char;if(m.which)return String.fromCharCode(m.which)}return null;case"compositionend":return qN&&m.locale!=="ko"?null:m.data;default:return null}}var n5={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function QN(f){var m=f&&f.nodeName&&f.nodeName.toLowerCase();return m==="input"?!!n5[f.type]:m==="textarea"}function ZN(f,m,v,w){xh?yh?yh.push(w):yh=[w]:xh=w,m=cx(m,"onChange"),0<m.length&&(v=new Sv("onChange","change",null,v,w),f.push({event:v,listeners:m}))}var Pd=null,Bd=null;function r5(f){DD(f,0)}function kv(f){var m=Dd(f);if($N(m))return f}function JN(f,m){if(f==="change")return m}var tA=!1;if(bs){var xw;if(bs){var yw="oninput"in document;if(!yw){var eA=document.createElement("div");eA.setAttribute("oninput","return;"),yw=typeof eA.oninput=="function"}xw=yw}else xw=!1;tA=xw&&(!document.documentMode||9<document.documentMode)}function nA(){Pd&&(Pd.detachEvent("onpropertychange",rA),Bd=Pd=null)}function rA(f){if(f.propertyName==="value"&&kv(Bd)){var m=[];ZN(m,Bd,f,lw(f)),zN(r5,m)}}function o5(f,m,v){f==="focusin"?(nA(),Pd=m,Bd=v,Pd.attachEvent("onpropertychange",rA)):f==="focusout"&&nA()}function a5(f){if(f==="selectionchange"||f==="keyup"||f==="keydown")return kv(Bd)}function i5(f,m){if(f==="click")return kv(m)}function s5(f,m){if(f==="input"||f==="change")return kv(m)}function u5(f,m){return f===m&&(f!==0||1/f===1/m)||f!==f&&m!==m}var ea=typeof Object.is=="function"?Object.is:u5;function zd(f,m){if(ea(f,m))return!0;if(typeof f!="object"||f===null||typeof m!="object"||m===null)return!1;var v=Object.keys(f),w=Object.keys(m);if(v.length!==w.length)return!1;for(w=0;w<v.length;w++){var I=v[w];if(!Vt.call(m,I)||!ea(f[I],m[I]))return!1}return!0}function oA(f){for(;f&&f.firstChild;)f=f.firstChild;return f}function aA(f,m){var v=oA(f);f=0;for(var w;v;){if(v.nodeType===3){if(w=f+v.textContent.length,f<=m&&w>=m)return{node:v,offset:m-f};f=w}t:{for(;v;){if(v.nextSibling){v=v.nextSibling;break t}v=v.parentNode}v=void 0}v=oA(v)}}function iA(f,m){return f&&m?f===m?!0:f&&f.nodeType===3?!1:m&&m.nodeType===3?iA(f,m.parentNode):"contains"in f?f.contains(m):f.compareDocumentPosition?!!(f.compareDocumentPosition(m)&16):!1:!1}function sA(f){f=f!=null&&f.ownerDocument!=null&&f.ownerDocument.defaultView!=null?f.ownerDocument.defaultView:window;for(var m=xv(f.document);m instanceof f.HTMLIFrameElement;){try{var v=typeof m.contentWindow.location.href=="string"}catch{v=!1}if(v)f=m.contentWindow;else break;m=xv(f.document)}return m}function bw(f){var m=f&&f.nodeName&&f.nodeName.toLowerCase();return m&&(m==="input"&&(f.type==="text"||f.type==="search"||f.type==="tel"||f.type==="url"||f.type==="password")||m==="textarea"||f.contentEditable==="true")}var l5=bs&&"documentMode"in document&&11>=document.documentMode,wh=null,ww=null,Ud=null,Cw=!1;function uA(f,m,v){var w=v.window===v?v.document:v.nodeType===9?v:v.ownerDocument;Cw||wh==null||wh!==xv(w)||(w=wh,"selectionStart"in w&&bw(w)?w={start:w.selectionStart,end:w.selectionEnd}:(w=(w.ownerDocument&&w.ownerDocument.defaultView||window).getSelection(),w={anchorNode:w.anchorNode,anchorOffset:w.anchorOffset,focusNode:w.focusNode,focusOffset:w.focusOffset}),Ud&&zd(Ud,w)||(Ud=w,w=cx(ww,"onSelect"),0<w.length&&(m=new Sv("onSelect","select",null,m,v),f.push({event:m,listeners:w}),m.target=wh)))}function Ol(f,m){var v={};return v[f.toLowerCase()]=m.toLowerCase(),v["Webkit"+f]="webkit"+m,v["Moz"+f]="moz"+m,v}var Ch={animationend:Ol("Animation","AnimationEnd"),animationiteration:Ol("Animation","AnimationIteration"),animationstart:Ol("Animation","AnimationStart"),transitionrun:Ol("Transition","TransitionRun"),transitionstart:Ol("Transition","TransitionStart"),transitioncancel:Ol("Transition","TransitionCancel"),transitionend:Ol("Transition","TransitionEnd")},Sw={},lA={};bs&&(lA=document.createElement("div").style,"AnimationEvent"in window||(delete Ch.animationend.animation,delete Ch.animationiteration.animation,delete Ch.animationstart.animation),"TransitionEvent"in window||delete Ch.transitionend.transition);function Fl(f){if(Sw[f])return Sw[f];if(!Ch[f])return f;var m=Ch[f],v;for(v in m)if(m.hasOwnProperty(v)&&v in lA)return Sw[f]=m[v];return f}var cA=Fl("animationend"),hA=Fl("animationiteration"),fA=Fl("animationstart"),c5=Fl("transitionrun"),h5=Fl("transitionstart"),f5=Fl("transitioncancel"),dA=Fl("transitionend"),pA=new Map,Ew="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Ew.push("scrollEnd");function Ja(f,m){pA.set(f,m),Dl(m,[f])}var mA=new WeakMap;function Ia(f,m){if(typeof f=="object"&&f!==null){var v=mA.get(f);return v!==void 0?v:(m={value:f,source:m,stack:_N(m)},mA.set(f,m),m)}return{value:f,source:m,stack:_N(m)}}var Ra=[],Sh=0,kw=0;function Iv(){for(var f=Sh,m=kw=Sh=0;m<f;){var v=Ra[m];Ra[m++]=null;var w=Ra[m];Ra[m++]=null;var I=Ra[m];Ra[m++]=null;var T=Ra[m];if(Ra[m++]=null,w!==null&&I!==null){var L=w.pending;L===null?I.next=I:(I.next=L.next,L.next=I),w.pending=I}T!==0&&gA(v,I,T)}}function Rv(f,m,v,w){Ra[Sh++]=f,Ra[Sh++]=m,Ra[Sh++]=v,Ra[Sh++]=w,kw|=w,f.lanes|=w,f=f.alternate,f!==null&&(f.lanes|=w)}function Iw(f,m,v,w){return Rv(f,m,v,w),Tv(f)}function Eh(f,m){return Rv(f,null,null,m),Tv(f)}function gA(f,m,v){f.lanes|=v;var w=f.alternate;w!==null&&(w.lanes|=v);for(var I=!1,T=f.return;T!==null;)T.childLanes|=v,w=T.alternate,w!==null&&(w.childLanes|=v),T.tag===22&&(f=T.stateNode,f===null||f._visibility&1||(I=!0)),f=T,T=T.return;return f.tag===3?(T=f.stateNode,I&&m!==null&&(I=31-zn(v),f=T.hiddenUpdates,w=f[I],w===null?f[I]=[m]:w.push(m),m.lane=v|536870912),T):null}function Tv(f){if(50<fp)throw fp=0,D2=null,Error(r(185));for(var m=f.return;m!==null;)f=m,m=f.return;return f.tag===3?f.stateNode:null}var kh={};function d5(f,m,v,w){this.tag=f,this.key=v,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=m,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=w,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function na(f,m,v,w){return new d5(f,m,v,w)}function Rw(f){return f=f.prototype,!(!f||!f.isReactComponent)}function ws(f,m){var v=f.alternate;return v===null?(v=na(f.tag,m,f.key,f.mode),v.elementType=f.elementType,v.type=f.type,v.stateNode=f.stateNode,v.alternate=f,f.alternate=v):(v.pendingProps=m,v.type=f.type,v.flags=0,v.subtreeFlags=0,v.deletions=null),v.flags=f.flags&65011712,v.childLanes=f.childLanes,v.lanes=f.lanes,v.child=f.child,v.memoizedProps=f.memoizedProps,v.memoizedState=f.memoizedState,v.updateQueue=f.updateQueue,m=f.dependencies,v.dependencies=m===null?null:{lanes:m.lanes,firstContext:m.firstContext},v.sibling=f.sibling,v.index=f.index,v.ref=f.ref,v.refCleanup=f.refCleanup,v}function vA(f,m){f.flags&=65011714;var v=f.alternate;return v===null?(f.childLanes=0,f.lanes=m,f.child=null,f.subtreeFlags=0,f.memoizedProps=null,f.memoizedState=null,f.updateQueue=null,f.dependencies=null,f.stateNode=null):(f.childLanes=v.childLanes,f.lanes=v.lanes,f.child=v.child,f.subtreeFlags=0,f.deletions=null,f.memoizedProps=v.memoizedProps,f.memoizedState=v.memoizedState,f.updateQueue=v.updateQueue,f.type=v.type,m=v.dependencies,f.dependencies=m===null?null:{lanes:m.lanes,firstContext:m.firstContext}),f}function Nv(f,m,v,w,I,T){var L=0;if(w=f,typeof f=="function")Rw(f)&&(L=1);else if(typeof f=="string")L=mj(f,v,rt.current)?26:f==="html"||f==="head"||f==="body"?27:5;else t:switch(f){case _:return f=na(31,v,m,I),f.elementType=_,f.lanes=T,f;case g:return Ml(v.children,I,T,m);case x:L=8,I|=24;break;case y:return f=na(12,v,m,I|2),f.elementType=y,f.lanes=T,f;case k:return f=na(13,v,m,I),f.elementType=k,f.lanes=T,f;case R:return f=na(19,v,m,I),f.elementType=R,f.lanes=T,f;default:if(typeof f=="object"&&f!==null)switch(f.$$typeof){case b:case E:L=10;break t;case C:L=9;break t;case S:L=11;break t;case A:L=14;break t;case N:L=16,w=null;break t}L=29,v=Error(r(130,f===null?"null":typeof f,"")),w=null}return m=na(L,v,m,I),m.elementType=f,m.type=w,m.lanes=T,m}function Ml(f,m,v,w){return f=na(7,f,w,m),f.lanes=v,f}function Tw(f,m,v){return f=na(6,f,null,m),f.lanes=v,f}function Nw(f,m,v){return m=na(4,f.children!==null?f.children:[],f.key,m),m.lanes=v,m.stateNode={containerInfo:f.containerInfo,pendingChildren:null,implementation:f.implementation},m}var Ih=[],Rh=0,Av=null,_v=0,Ta=[],Na=0,Ll=null,Cs=1,Ss="";function Pl(f,m){Ih[Rh++]=_v,Ih[Rh++]=Av,Av=f,_v=m}function xA(f,m,v){Ta[Na++]=Cs,Ta[Na++]=Ss,Ta[Na++]=Ll,Ll=f;var w=Cs;f=Ss;var I=32-zn(w)-1;w&=~(1<<I),v+=1;var T=32-zn(m)+I;if(30<T){var L=I-I%5;T=(w&(1<<L)-1).toString(32),w>>=L,I-=L,Cs=1<<32-zn(m)+I|v<<I|w,Ss=T+f}else Cs=1<<T|v<<I|w,Ss=f}function Aw(f){f.return!==null&&(Pl(f,1),xA(f,1,0))}function _w(f){for(;f===Av;)Av=Ih[--Rh],Ih[Rh]=null,_v=Ih[--Rh],Ih[Rh]=null;for(;f===Ll;)Ll=Ta[--Na],Ta[Na]=null,Ss=Ta[--Na],Ta[Na]=null,Cs=Ta[--Na],Ta[Na]=null}var Eo=null,Hn=null,rn=!1,Bl=null,Ii=!1,Dw=Error(r(519));function zl(f){var m=Error(r(418,""));throw Gd(Ia(m,f)),Dw}function yA(f){var m=f.stateNode,v=f.type,w=f.memoizedProps;switch(m[io]=f,m[Fo]=w,v){case"dialog":Le("cancel",m),Le("close",m);break;case"iframe":case"object":case"embed":Le("load",m);break;case"video":case"audio":for(v=0;v<pp.length;v++)Le(pp[v],m);break;case"source":Le("error",m);break;case"img":case"image":case"link":Le("error",m),Le("load",m);break;case"details":Le("toggle",m);break;case"input":Le("invalid",m),ON(m,w.value,w.defaultValue,w.checked,w.defaultChecked,w.type,w.name,!0),vv(m);break;case"select":Le("invalid",m);break;case"textarea":Le("invalid",m),MN(m,w.value,w.defaultValue,w.children),vv(m)}v=w.children,typeof v!="string"&&typeof v!="number"&&typeof v!="bigint"||m.textContent===""+v||w.suppressHydrationWarning===!0||MD(m.textContent,v)?(w.popover!=null&&(Le("beforetoggle",m),Le("toggle",m)),w.onScroll!=null&&Le("scroll",m),w.onScrollEnd!=null&&Le("scrollend",m),w.onClick!=null&&(m.onclick=hx),m=!0):m=!1,m||zl(f)}function bA(f){for(Eo=f.return;Eo;)switch(Eo.tag){case 5:case 13:Ii=!1;return;case 27:case 3:Ii=!0;return;default:Eo=Eo.return}}function Wd(f){if(f!==Eo)return!1;if(!rn)return bA(f),rn=!0,!1;var m=f.tag,v;if((v=m!==3&&m!==27)&&((v=m===5)&&(v=f.type,v=!(v!=="form"&&v!=="button")||X2(f.type,f.memoizedProps)),v=!v),v&&Hn&&zl(f),bA(f),m===13){if(f=f.memoizedState,f=f!==null?f.dehydrated:null,!f)throw Error(r(317));t:{for(f=f.nextSibling,m=0;f;){if(f.nodeType===8)if(v=f.data,v==="/$"){if(m===0){Hn=ei(f.nextSibling);break t}m--}else v!=="$"&&v!=="$!"&&v!=="$?"||m++;f=f.nextSibling}Hn=null}}else m===27?(m=Hn,_u(f.type)?(f=Z2,Z2=null,Hn=f):Hn=m):Hn=Eo?ei(f.stateNode.nextSibling):null;return!0}function Vd(){Hn=Eo=null,rn=!1}function wA(){var f=Bl;return f!==null&&(Bo===null?Bo=f:Bo.push.apply(Bo,f),Bl=null),f}function Gd(f){Bl===null?Bl=[f]:Bl.push(f)}var $w=G(null),Ul=null,Es=null;function gu(f,m,v){Z($w,m._currentValue),m._currentValue=v}function ks(f){f._currentValue=$w.current,Q($w)}function Ow(f,m,v){for(;f!==null;){var w=f.alternate;if((f.childLanes&m)!==m?(f.childLanes|=m,w!==null&&(w.childLanes|=m)):w!==null&&(w.childLanes&m)!==m&&(w.childLanes|=m),f===v)break;f=f.return}}function Fw(f,m,v,w){var I=f.child;for(I!==null&&(I.return=f);I!==null;){var T=I.dependencies;if(T!==null){var L=I.child;T=T.firstContext;t:for(;T!==null;){var V=T;T=I;for(var tt=0;tt<m.length;tt++)if(V.context===m[tt]){T.lanes|=v,V=T.alternate,V!==null&&(V.lanes|=v),Ow(T.return,v,f),w||(L=null);break t}T=V.next}}else if(I.tag===18){if(L=I.return,L===null)throw Error(r(341));L.lanes|=v,T=L.alternate,T!==null&&(T.lanes|=v),Ow(L,v,f),L=null}else L=I.child;if(L!==null)L.return=I;else for(L=I;L!==null;){if(L===f){L=null;break}if(I=L.sibling,I!==null){I.return=L.return,L=I;break}L=L.return}I=L}}function Hd(f,m,v,w){f=null;for(var I=m,T=!1;I!==null;){if(!T){if((I.flags&524288)!==0)T=!0;else if((I.flags&262144)!==0)break}if(I.tag===10){var L=I.alternate;if(L===null)throw Error(r(387));if(L=L.memoizedProps,L!==null){var V=I.type;ea(I.pendingProps.value,L.value)||(f!==null?f.push(V):f=[V])}}else if(I===Rt.current){if(L=I.alternate,L===null)throw Error(r(387));L.memoizedState.memoizedState!==I.memoizedState.memoizedState&&(f!==null?f.push(bp):f=[bp])}I=I.return}f!==null&&Fw(m,f,v,w),m.flags|=262144}function Dv(f){for(f=f.firstContext;f!==null;){if(!ea(f.context._currentValue,f.memoizedValue))return!0;f=f.next}return!1}function Wl(f){Ul=f,Es=null,f=f.dependencies,f!==null&&(f.firstContext=null)}function so(f){return CA(Ul,f)}function $v(f,m){return Ul===null&&Wl(f),CA(f,m)}function CA(f,m){var v=m._currentValue;if(m={context:m,memoizedValue:v,next:null},Es===null){if(f===null)throw Error(r(308));Es=m,f.dependencies={lanes:0,firstContext:m},f.flags|=524288}else Es=Es.next=m;return v}var p5=typeof AbortController<"u"?AbortController:function(){var f=[],m=this.signal={aborted:!1,addEventListener:function(v,w){f.push(w)}};this.abort=function(){m.aborted=!0,f.forEach(function(v){return v()})}},m5=n.unstable_scheduleCallback,g5=n.unstable_NormalPriority,Cr={$$typeof:E,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Mw(){return{controller:new p5,data:new Map,refCount:0}}function qd(f){f.refCount--,f.refCount===0&&m5(g5,function(){f.controller.abort()})}var jd=null,Lw=0,Th=0,Nh=null;function v5(f,m){if(jd===null){var v=jd=[];Lw=0,Th=B2(),Nh={status:"pending",value:void 0,then:function(w){v.push(w)}}}return Lw++,m.then(SA,SA),m}function SA(){if(--Lw===0&&jd!==null){Nh!==null&&(Nh.status="fulfilled");var f=jd;jd=null,Th=0,Nh=null;for(var m=0;m<f.length;m++)(0,f[m])()}}function x5(f,m){var v=[],w={status:"pending",value:null,reason:null,then:function(I){v.push(I)}};return f.then(function(){w.status="fulfilled",w.value=m;for(var I=0;I<v.length;I++)(0,v[I])(m)},function(I){for(w.status="rejected",w.reason=I,I=0;I<v.length;I++)(0,v[I])(void 0)}),w}var EA=F.S;F.S=function(f,m){typeof m=="object"&&m!==null&&typeof m.then=="function"&&v5(f,m),EA!==null&&EA(f,m)};var Vl=G(null);function Pw(){var f=Vl.current;return f!==null?f:Rn.pooledCache}function Ov(f,m){m===null?Z(Vl,Vl.current):Z(Vl,m.pool)}function kA(){var f=Pw();return f===null?null:{parent:Cr._currentValue,pool:f}}var Xd=Error(r(460)),IA=Error(r(474)),Fv=Error(r(542)),Bw={then:function(){}};function RA(f){return f=f.status,f==="fulfilled"||f==="rejected"}function Mv(){}function TA(f,m,v){switch(v=f[v],v===void 0?f.push(m):v!==m&&(m.then(Mv,Mv),m=v),m.status){case"fulfilled":return m.value;case"rejected":throw f=m.reason,AA(f),f;default:if(typeof m.status=="string")m.then(Mv,Mv);else{if(f=Rn,f!==null&&100<f.shellSuspendCounter)throw Error(r(482));f=m,f.status="pending",f.then(function(w){if(m.status==="pending"){var I=m;I.status="fulfilled",I.value=w}},function(w){if(m.status==="pending"){var I=m;I.status="rejected",I.reason=w}})}switch(m.status){case"fulfilled":return m.value;case"rejected":throw f=m.reason,AA(f),f}throw Kd=m,Xd}}var Kd=null;function NA(){if(Kd===null)throw Error(r(459));var f=Kd;return Kd=null,f}function AA(f){if(f===Xd||f===Fv)throw Error(r(483))}var vu=!1;function zw(f){f.updateQueue={baseState:f.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Uw(f,m){f=f.updateQueue,m.updateQueue===f&&(m.updateQueue={baseState:f.baseState,firstBaseUpdate:f.firstBaseUpdate,lastBaseUpdate:f.lastBaseUpdate,shared:f.shared,callbacks:null})}function xu(f){return{lane:f,tag:0,payload:null,callback:null,next:null}}function yu(f,m,v){var w=f.updateQueue;if(w===null)return null;if(w=w.shared,(fn&2)!==0){var I=w.pending;return I===null?m.next=m:(m.next=I.next,I.next=m),w.pending=m,m=Tv(f),gA(f,null,v),m}return Rv(f,w,m,v),Tv(f)}function Yd(f,m,v){if(m=m.updateQueue,m!==null&&(m=m.shared,(v&4194048)!==0)){var w=m.lanes;w&=f.pendingLanes,v|=w,m.lanes=v,SN(f,v)}}function Ww(f,m){var v=f.updateQueue,w=f.alternate;if(w!==null&&(w=w.updateQueue,v===w)){var I=null,T=null;if(v=v.firstBaseUpdate,v!==null){do{var L={lane:v.lane,tag:v.tag,payload:v.payload,callback:null,next:null};T===null?I=T=L:T=T.next=L,v=v.next}while(v!==null);T===null?I=T=m:T=T.next=m}else I=T=m;v={baseState:w.baseState,firstBaseUpdate:I,lastBaseUpdate:T,shared:w.shared,callbacks:w.callbacks},f.updateQueue=v;return}f=v.lastBaseUpdate,f===null?v.firstBaseUpdate=m:f.next=m,v.lastBaseUpdate=m}var Vw=!1;function Qd(){if(Vw){var f=Nh;if(f!==null)throw f}}function Zd(f,m,v,w){Vw=!1;var I=f.updateQueue;vu=!1;var T=I.firstBaseUpdate,L=I.lastBaseUpdate,V=I.shared.pending;if(V!==null){I.shared.pending=null;var tt=V,vt=tt.next;tt.next=null,L===null?T=vt:L.next=vt,L=tt;var At=f.alternate;At!==null&&(At=At.updateQueue,V=At.lastBaseUpdate,V!==L&&(V===null?At.firstBaseUpdate=vt:V.next=vt,At.lastBaseUpdate=tt))}if(T!==null){var $t=I.baseState;L=0,At=vt=tt=null,V=T;do{var xt=V.lane&-536870913,bt=xt!==V.lane;if(bt?(He&xt)===xt:(w&xt)===xt){xt!==0&&xt===Th&&(Vw=!0),At!==null&&(At=At.next={lane:0,tag:V.tag,payload:V.payload,callback:null,next:null});t:{var ye=f,pe=V;xt=m;var xn=v;switch(pe.tag){case 1:if(ye=pe.payload,typeof ye=="function"){$t=ye.call(xn,$t,xt);break t}$t=ye;break t;case 3:ye.flags=ye.flags&-65537|128;case 0:if(ye=pe.payload,xt=typeof ye=="function"?ye.call(xn,$t,xt):ye,xt==null)break t;$t=c({},$t,xt);break t;case 2:vu=!0}}xt=V.callback,xt!==null&&(f.flags|=64,bt&&(f.flags|=8192),bt=I.callbacks,bt===null?I.callbacks=[xt]:bt.push(xt))}else bt={lane:xt,tag:V.tag,payload:V.payload,callback:V.callback,next:null},At===null?(vt=At=bt,tt=$t):At=At.next=bt,L|=xt;if(V=V.next,V===null){if(V=I.shared.pending,V===null)break;bt=V,V=bt.next,bt.next=null,I.lastBaseUpdate=bt,I.shared.pending=null}}while(!0);At===null&&(tt=$t),I.baseState=tt,I.firstBaseUpdate=vt,I.lastBaseUpdate=At,T===null&&(I.shared.lanes=0),Ru|=L,f.lanes=L,f.memoizedState=$t}}function _A(f,m){if(typeof f!="function")throw Error(r(191,f));f.call(m)}function DA(f,m){var v=f.callbacks;if(v!==null)for(f.callbacks=null,f=0;f<v.length;f++)_A(v[f],m)}var Ah=G(null),Lv=G(0);function $A(f,m){f=Ds,Z(Lv,f),Z(Ah,m),Ds=f|m.baseLanes}function Gw(){Z(Lv,Ds),Z(Ah,Ah.current)}function Hw(){Ds=Lv.current,Q(Ah),Q(Lv)}var bu=0,$e=null,gn=null,hr=null,Pv=!1,_h=!1,Gl=!1,Bv=0,Jd=0,Dh=null,y5=0;function or(){throw Error(r(321))}function qw(f,m){if(m===null)return!1;for(var v=0;v<m.length&&v<f.length;v++)if(!ea(f[v],m[v]))return!1;return!0}function jw(f,m,v,w,I,T){return bu=T,$e=m,m.memoizedState=null,m.updateQueue=null,m.lanes=0,F.H=f===null||f.memoizedState===null?g_:v_,Gl=!1,T=v(w,I),Gl=!1,_h&&(T=FA(m,v,w,I)),OA(f),T}function OA(f){F.H=Hv;var m=gn!==null&&gn.next!==null;if(bu=0,hr=gn=$e=null,Pv=!1,Jd=0,Dh=null,m)throw Error(r(300));f===null||Or||(f=f.dependencies,f!==null&&Dv(f)&&(Or=!0))}function FA(f,m,v,w){$e=f;var I=0;do{if(_h&&(Dh=null),Jd=0,_h=!1,25<=I)throw Error(r(301));if(I+=1,hr=gn=null,f.updateQueue!=null){var T=f.updateQueue;T.lastEffect=null,T.events=null,T.stores=null,T.memoCache!=null&&(T.memoCache.index=0)}F.H=I5,T=m(v,w)}while(_h);return T}function b5(){var f=F.H,m=f.useState()[0];return m=typeof m.then=="function"?tp(m):m,f=f.useState()[0],(gn!==null?gn.memoizedState:null)!==f&&($e.flags|=1024),m}function Xw(){var f=Bv!==0;return Bv=0,f}function Kw(f,m,v){m.updateQueue=f.updateQueue,m.flags&=-2053,f.lanes&=~v}function Yw(f){if(Pv){for(f=f.memoizedState;f!==null;){var m=f.queue;m!==null&&(m.pending=null),f=f.next}Pv=!1}bu=0,hr=gn=$e=null,_h=!1,Jd=Bv=0,Dh=null}function Lo(){var f={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return hr===null?$e.memoizedState=hr=f:hr=hr.next=f,hr}function fr(){if(gn===null){var f=$e.alternate;f=f!==null?f.memoizedState:null}else f=gn.next;var m=hr===null?$e.memoizedState:hr.next;if(m!==null)hr=m,gn=f;else{if(f===null)throw $e.alternate===null?Error(r(467)):Error(r(310));gn=f,f={memoizedState:gn.memoizedState,baseState:gn.baseState,baseQueue:gn.baseQueue,queue:gn.queue,next:null},hr===null?$e.memoizedState=hr=f:hr=hr.next=f}return hr}function Qw(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function tp(f){var m=Jd;return Jd+=1,Dh===null&&(Dh=[]),f=TA(Dh,f,m),m=$e,(hr===null?m.memoizedState:hr.next)===null&&(m=m.alternate,F.H=m===null||m.memoizedState===null?g_:v_),f}function zv(f){if(f!==null&&typeof f=="object"){if(typeof f.then=="function")return tp(f);if(f.$$typeof===E)return so(f)}throw Error(r(438,String(f)))}function Zw(f){var m=null,v=$e.updateQueue;if(v!==null&&(m=v.memoCache),m==null){var w=$e.alternate;w!==null&&(w=w.updateQueue,w!==null&&(w=w.memoCache,w!=null&&(m={data:w.data.map(function(I){return I.slice()}),index:0})))}if(m==null&&(m={data:[],index:0}),v===null&&(v=Qw(),$e.updateQueue=v),v.memoCache=m,v=m.data[m.index],v===void 0)for(v=m.data[m.index]=Array(f),w=0;w<f;w++)v[w]=$;return m.index++,v}function Is(f,m){return typeof m=="function"?m(f):m}function Uv(f){var m=fr();return Jw(m,gn,f)}function Jw(f,m,v){var w=f.queue;if(w===null)throw Error(r(311));w.lastRenderedReducer=v;var I=f.baseQueue,T=w.pending;if(T!==null){if(I!==null){var L=I.next;I.next=T.next,T.next=L}m.baseQueue=I=T,w.pending=null}if(T=f.baseState,I===null)f.memoizedState=T;else{m=I.next;var V=L=null,tt=null,vt=m,At=!1;do{var $t=vt.lane&-536870913;if($t!==vt.lane?(He&$t)===$t:(bu&$t)===$t){var xt=vt.revertLane;if(xt===0)tt!==null&&(tt=tt.next={lane:0,revertLane:0,action:vt.action,hasEagerState:vt.hasEagerState,eagerState:vt.eagerState,next:null}),$t===Th&&(At=!0);else if((bu&xt)===xt){vt=vt.next,xt===Th&&(At=!0);continue}else $t={lane:0,revertLane:vt.revertLane,action:vt.action,hasEagerState:vt.hasEagerState,eagerState:vt.eagerState,next:null},tt===null?(V=tt=$t,L=T):tt=tt.next=$t,$e.lanes|=xt,Ru|=xt;$t=vt.action,Gl&&v(T,$t),T=vt.hasEagerState?vt.eagerState:v(T,$t)}else xt={lane:$t,revertLane:vt.revertLane,action:vt.action,hasEagerState:vt.hasEagerState,eagerState:vt.eagerState,next:null},tt===null?(V=tt=xt,L=T):tt=tt.next=xt,$e.lanes|=$t,Ru|=$t;vt=vt.next}while(vt!==null&&vt!==m);if(tt===null?L=T:tt.next=V,!ea(T,f.memoizedState)&&(Or=!0,At&&(v=Nh,v!==null)))throw v;f.memoizedState=T,f.baseState=L,f.baseQueue=tt,w.lastRenderedState=T}return I===null&&(w.lanes=0),[f.memoizedState,w.dispatch]}function t2(f){var m=fr(),v=m.queue;if(v===null)throw Error(r(311));v.lastRenderedReducer=f;var w=v.dispatch,I=v.pending,T=m.memoizedState;if(I!==null){v.pending=null;var L=I=I.next;do T=f(T,L.action),L=L.next;while(L!==I);ea(T,m.memoizedState)||(Or=!0),m.memoizedState=T,m.baseQueue===null&&(m.baseState=T),v.lastRenderedState=T}return[T,w]}function MA(f,m,v){var w=$e,I=fr(),T=rn;if(T){if(v===void 0)throw Error(r(407));v=v()}else v=m();var L=!ea((gn||I).memoizedState,v);L&&(I.memoizedState=v,Or=!0),I=I.queue;var V=BA.bind(null,w,I,f);if(ep(2048,8,V,[f]),I.getSnapshot!==m||L||hr!==null&&hr.memoizedState.tag&1){if(w.flags|=2048,$h(9,Wv(),PA.bind(null,w,I,v,m),null),Rn===null)throw Error(r(349));T||(bu&124)!==0||LA(w,m,v)}return v}function LA(f,m,v){f.flags|=16384,f={getSnapshot:m,value:v},m=$e.updateQueue,m===null?(m=Qw(),$e.updateQueue=m,m.stores=[f]):(v=m.stores,v===null?m.stores=[f]:v.push(f))}function PA(f,m,v,w){m.value=v,m.getSnapshot=w,zA(m)&&UA(f)}function BA(f,m,v){return v(function(){zA(m)&&UA(f)})}function zA(f){var m=f.getSnapshot;f=f.value;try{var v=m();return!ea(f,v)}catch{return!0}}function UA(f){var m=Eh(f,2);m!==null&&sa(m,f,2)}function e2(f){var m=Lo();if(typeof f=="function"){var v=f;if(f=v(),Gl){mn(!0);try{v()}finally{mn(!1)}}}return m.memoizedState=m.baseState=f,m.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Is,lastRenderedState:f},m}function WA(f,m,v,w){return f.baseState=v,Jw(f,gn,typeof w=="function"?w:Is)}function w5(f,m,v,w,I){if(Gv(f))throw Error(r(485));if(f=m.action,f!==null){var T={payload:I,action:f,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(L){T.listeners.push(L)}};F.T!==null?v(!0):T.isTransition=!1,w(T),v=m.pending,v===null?(T.next=m.pending=T,VA(m,T)):(T.next=v.next,m.pending=v.next=T)}}function VA(f,m){var v=m.action,w=m.payload,I=f.state;if(m.isTransition){var T=F.T,L={};F.T=L;try{var V=v(I,w),tt=F.S;tt!==null&&tt(L,V),GA(f,m,V)}catch(vt){n2(f,m,vt)}finally{F.T=T}}else try{T=v(I,w),GA(f,m,T)}catch(vt){n2(f,m,vt)}}function GA(f,m,v){v!==null&&typeof v=="object"&&typeof v.then=="function"?v.then(function(w){HA(f,m,w)},function(w){return n2(f,m,w)}):HA(f,m,v)}function HA(f,m,v){m.status="fulfilled",m.value=v,qA(m),f.state=v,m=f.pending,m!==null&&(v=m.next,v===m?f.pending=null:(v=v.next,m.next=v,VA(f,v)))}function n2(f,m,v){var w=f.pending;if(f.pending=null,w!==null){w=w.next;do m.status="rejected",m.reason=v,qA(m),m=m.next;while(m!==w)}f.action=null}function qA(f){f=f.listeners;for(var m=0;m<f.length;m++)(0,f[m])()}function jA(f,m){return m}function XA(f,m){if(rn){var v=Rn.formState;if(v!==null){t:{var w=$e;if(rn){if(Hn){e:{for(var I=Hn,T=Ii;I.nodeType!==8;){if(!T){I=null;break e}if(I=ei(I.nextSibling),I===null){I=null;break e}}T=I.data,I=T==="F!"||T==="F"?I:null}if(I){Hn=ei(I.nextSibling),w=I.data==="F!";break t}}zl(w)}w=!1}w&&(m=v[0])}}return v=Lo(),v.memoizedState=v.baseState=m,w={pending:null,lanes:0,dispatch:null,lastRenderedReducer:jA,lastRenderedState:m},v.queue=w,v=d_.bind(null,$e,w),w.dispatch=v,w=e2(!1),T=s2.bind(null,$e,!1,w.queue),w=Lo(),I={state:m,dispatch:null,action:f,pending:null},w.queue=I,v=w5.bind(null,$e,I,T,v),I.dispatch=v,w.memoizedState=f,[m,v,!1]}function KA(f){var m=fr();return YA(m,gn,f)}function YA(f,m,v){if(m=Jw(f,m,jA)[0],f=Uv(Is)[0],typeof m=="object"&&m!==null&&typeof m.then=="function")try{var w=tp(m)}catch(L){throw L===Xd?Fv:L}else w=m;m=fr();var I=m.queue,T=I.dispatch;return v!==m.memoizedState&&($e.flags|=2048,$h(9,Wv(),C5.bind(null,I,v),null)),[w,T,f]}function C5(f,m){f.action=m}function QA(f){var m=fr(),v=gn;if(v!==null)return YA(m,v,f);fr(),m=m.memoizedState,v=fr();var w=v.queue.dispatch;return v.memoizedState=f,[m,w,!1]}function $h(f,m,v,w){return f={tag:f,create:v,deps:w,inst:m,next:null},m=$e.updateQueue,m===null&&(m=Qw(),$e.updateQueue=m),v=m.lastEffect,v===null?m.lastEffect=f.next=f:(w=v.next,v.next=f,f.next=w,m.lastEffect=f),f}function Wv(){return{destroy:void 0,resource:void 0}}function ZA(){return fr().memoizedState}function Vv(f,m,v,w){var I=Lo();w=w===void 0?null:w,$e.flags|=f,I.memoizedState=$h(1|m,Wv(),v,w)}function ep(f,m,v,w){var I=fr();w=w===void 0?null:w;var T=I.memoizedState.inst;gn!==null&&w!==null&&qw(w,gn.memoizedState.deps)?I.memoizedState=$h(m,T,v,w):($e.flags|=f,I.memoizedState=$h(1|m,T,v,w))}function JA(f,m){Vv(8390656,8,f,m)}function t_(f,m){ep(2048,8,f,m)}function e_(f,m){return ep(4,2,f,m)}function n_(f,m){return ep(4,4,f,m)}function r_(f,m){if(typeof m=="function"){f=f();var v=m(f);return function(){typeof v=="function"?v():m(null)}}if(m!=null)return f=f(),m.current=f,function(){m.current=null}}function o_(f,m,v){v=v!=null?v.concat([f]):null,ep(4,4,r_.bind(null,m,f),v)}function r2(){}function a_(f,m){var v=fr();m=m===void 0?null:m;var w=v.memoizedState;return m!==null&&qw(m,w[1])?w[0]:(v.memoizedState=[f,m],f)}function i_(f,m){var v=fr();m=m===void 0?null:m;var w=v.memoizedState;if(m!==null&&qw(m,w[1]))return w[0];if(w=f(),Gl){mn(!0);try{f()}finally{mn(!1)}}return v.memoizedState=[w,m],w}function o2(f,m,v){return v===void 0||(bu&1073741824)!==0?f.memoizedState=m:(f.memoizedState=v,f=lD(),$e.lanes|=f,Ru|=f,v)}function s_(f,m,v,w){return ea(v,m)?v:Ah.current!==null?(f=o2(f,v,w),ea(f,m)||(Or=!0),f):(bu&42)===0?(Or=!0,f.memoizedState=v):(f=lD(),$e.lanes|=f,Ru|=f,m)}function u_(f,m,v,w,I){var T=B.p;B.p=T!==0&&8>T?T:8;var L=F.T,V={};F.T=V,s2(f,!1,m,v);try{var tt=I(),vt=F.S;if(vt!==null&&vt(V,tt),tt!==null&&typeof tt=="object"&&typeof tt.then=="function"){var At=x5(tt,w);np(f,m,At,ia(f))}else np(f,m,w,ia(f))}catch($t){np(f,m,{then:function(){},status:"rejected",reason:$t},ia())}finally{B.p=T,F.T=L}}function S5(){}function a2(f,m,v,w){if(f.tag!==5)throw Error(r(476));var I=l_(f).queue;u_(f,I,m,U,v===null?S5:function(){return c_(f),v(w)})}function l_(f){var m=f.memoizedState;if(m!==null)return m;m={memoizedState:U,baseState:U,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Is,lastRenderedState:U},next:null};var v={};return m.next={memoizedState:v,baseState:v,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Is,lastRenderedState:v},next:null},f.memoizedState=m,f=f.alternate,f!==null&&(f.memoizedState=m),m}function c_(f){var m=l_(f).next.queue;np(f,m,{},ia())}function i2(){return so(bp)}function h_(){return fr().memoizedState}function f_(){return fr().memoizedState}function E5(f){for(var m=f.return;m!==null;){switch(m.tag){case 24:case 3:var v=ia();f=xu(v);var w=yu(m,f,v);w!==null&&(sa(w,m,v),Yd(w,m,v)),m={cache:Mw()},f.payload=m;return}m=m.return}}function k5(f,m,v){var w=ia();v={lane:w,revertLane:0,action:v,hasEagerState:!1,eagerState:null,next:null},Gv(f)?p_(m,v):(v=Iw(f,m,v,w),v!==null&&(sa(v,f,w),m_(v,m,w)))}function d_(f,m,v){var w=ia();np(f,m,v,w)}function np(f,m,v,w){var I={lane:w,revertLane:0,action:v,hasEagerState:!1,eagerState:null,next:null};if(Gv(f))p_(m,I);else{var T=f.alternate;if(f.lanes===0&&(T===null||T.lanes===0)&&(T=m.lastRenderedReducer,T!==null))try{var L=m.lastRenderedState,V=T(L,v);if(I.hasEagerState=!0,I.eagerState=V,ea(V,L))return Rv(f,m,I,0),Rn===null&&Iv(),!1}catch{}finally{}if(v=Iw(f,m,I,w),v!==null)return sa(v,f,w),m_(v,m,w),!0}return!1}function s2(f,m,v,w){if(w={lane:2,revertLane:B2(),action:w,hasEagerState:!1,eagerState:null,next:null},Gv(f)){if(m)throw Error(r(479))}else m=Iw(f,v,w,2),m!==null&&sa(m,f,2)}function Gv(f){var m=f.alternate;return f===$e||m!==null&&m===$e}function p_(f,m){_h=Pv=!0;var v=f.pending;v===null?m.next=m:(m.next=v.next,v.next=m),f.pending=m}function m_(f,m,v){if((v&4194048)!==0){var w=m.lanes;w&=f.pendingLanes,v|=w,m.lanes=v,SN(f,v)}}var Hv={readContext:so,use:zv,useCallback:or,useContext:or,useEffect:or,useImperativeHandle:or,useLayoutEffect:or,useInsertionEffect:or,useMemo:or,useReducer:or,useRef:or,useState:or,useDebugValue:or,useDeferredValue:or,useTransition:or,useSyncExternalStore:or,useId:or,useHostTransitionStatus:or,useFormState:or,useActionState:or,useOptimistic:or,useMemoCache:or,useCacheRefresh:or},g_={readContext:so,use:zv,useCallback:function(f,m){return Lo().memoizedState=[f,m===void 0?null:m],f},useContext:so,useEffect:JA,useImperativeHandle:function(f,m,v){v=v!=null?v.concat([f]):null,Vv(4194308,4,r_.bind(null,m,f),v)},useLayoutEffect:function(f,m){return Vv(4194308,4,f,m)},useInsertionEffect:function(f,m){Vv(4,2,f,m)},useMemo:function(f,m){var v=Lo();m=m===void 0?null:m;var w=f();if(Gl){mn(!0);try{f()}finally{mn(!1)}}return v.memoizedState=[w,m],w},useReducer:function(f,m,v){var w=Lo();if(v!==void 0){var I=v(m);if(Gl){mn(!0);try{v(m)}finally{mn(!1)}}}else I=m;return w.memoizedState=w.baseState=I,f={pending:null,lanes:0,dispatch:null,lastRenderedReducer:f,lastRenderedState:I},w.queue=f,f=f.dispatch=k5.bind(null,$e,f),[w.memoizedState,f]},useRef:function(f){var m=Lo();return f={current:f},m.memoizedState=f},useState:function(f){f=e2(f);var m=f.queue,v=d_.bind(null,$e,m);return m.dispatch=v,[f.memoizedState,v]},useDebugValue:r2,useDeferredValue:function(f,m){var v=Lo();return o2(v,f,m)},useTransition:function(){var f=e2(!1);return f=u_.bind(null,$e,f.queue,!0,!1),Lo().memoizedState=f,[!1,f]},useSyncExternalStore:function(f,m,v){var w=$e,I=Lo();if(rn){if(v===void 0)throw Error(r(407));v=v()}else{if(v=m(),Rn===null)throw Error(r(349));(He&124)!==0||LA(w,m,v)}I.memoizedState=v;var T={value:v,getSnapshot:m};return I.queue=T,JA(BA.bind(null,w,T,f),[f]),w.flags|=2048,$h(9,Wv(),PA.bind(null,w,T,v,m),null),v},useId:function(){var f=Lo(),m=Rn.identifierPrefix;if(rn){var v=Ss,w=Cs;v=(w&~(1<<32-zn(w)-1)).toString(32)+v,m="«"+m+"R"+v,v=Bv++,0<v&&(m+="H"+v.toString(32)),m+="»"}else v=y5++,m="«"+m+"r"+v.toString(32)+"»";return f.memoizedState=m},useHostTransitionStatus:i2,useFormState:XA,useActionState:XA,useOptimistic:function(f){var m=Lo();m.memoizedState=m.baseState=f;var v={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return m.queue=v,m=s2.bind(null,$e,!0,v),v.dispatch=m,[f,m]},useMemoCache:Zw,useCacheRefresh:function(){return Lo().memoizedState=E5.bind(null,$e)}},v_={readContext:so,use:zv,useCallback:a_,useContext:so,useEffect:t_,useImperativeHandle:o_,useInsertionEffect:e_,useLayoutEffect:n_,useMemo:i_,useReducer:Uv,useRef:ZA,useState:function(){return Uv(Is)},useDebugValue:r2,useDeferredValue:function(f,m){var v=fr();return s_(v,gn.memoizedState,f,m)},useTransition:function(){var f=Uv(Is)[0],m=fr().memoizedState;return[typeof f=="boolean"?f:tp(f),m]},useSyncExternalStore:MA,useId:h_,useHostTransitionStatus:i2,useFormState:KA,useActionState:KA,useOptimistic:function(f,m){var v=fr();return WA(v,gn,f,m)},useMemoCache:Zw,useCacheRefresh:f_},I5={readContext:so,use:zv,useCallback:a_,useContext:so,useEffect:t_,useImperativeHandle:o_,useInsertionEffect:e_,useLayoutEffect:n_,useMemo:i_,useReducer:t2,useRef:ZA,useState:function(){return t2(Is)},useDebugValue:r2,useDeferredValue:function(f,m){var v=fr();return gn===null?o2(v,f,m):s_(v,gn.memoizedState,f,m)},useTransition:function(){var f=t2(Is)[0],m=fr().memoizedState;return[typeof f=="boolean"?f:tp(f),m]},useSyncExternalStore:MA,useId:h_,useHostTransitionStatus:i2,useFormState:QA,useActionState:QA,useOptimistic:function(f,m){var v=fr();return gn!==null?WA(v,gn,f,m):(v.baseState=f,[f,v.queue.dispatch])},useMemoCache:Zw,useCacheRefresh:f_},Oh=null,rp=0;function qv(f){var m=rp;return rp+=1,Oh===null&&(Oh=[]),TA(Oh,f,m)}function op(f,m){m=m.props.ref,f.ref=m!==void 0?m:null}function jv(f,m){throw m.$$typeof===h?Error(r(525)):(f=Object.prototype.toString.call(m),Error(r(31,f==="[object Object]"?"object with keys {"+Object.keys(m).join(", ")+"}":f)))}function x_(f){var m=f._init;return m(f._payload)}function y_(f){function m(dt,at){if(f){var mt=dt.deletions;mt===null?(dt.deletions=[at],dt.flags|=16):mt.push(at)}}function v(dt,at){if(!f)return null;for(;at!==null;)m(dt,at),at=at.sibling;return null}function w(dt){for(var at=new Map;dt!==null;)dt.key!==null?at.set(dt.key,dt):at.set(dt.index,dt),dt=dt.sibling;return at}function I(dt,at){return dt=ws(dt,at),dt.index=0,dt.sibling=null,dt}function T(dt,at,mt){return dt.index=mt,f?(mt=dt.alternate,mt!==null?(mt=mt.index,mt<at?(dt.flags|=67108866,at):mt):(dt.flags|=67108866,at)):(dt.flags|=1048576,at)}function L(dt){return f&&dt.alternate===null&&(dt.flags|=67108866),dt}function V(dt,at,mt,Dt){return at===null||at.tag!==6?(at=Tw(mt,dt.mode,Dt),at.return=dt,at):(at=I(at,mt),at.return=dt,at)}function tt(dt,at,mt,Dt){var Kt=mt.type;return Kt===g?At(dt,at,mt.props.children,Dt,mt.key):at!==null&&(at.elementType===Kt||typeof Kt=="object"&&Kt!==null&&Kt.$$typeof===N&&x_(Kt)===at.type)?(at=I(at,mt.props),op(at,mt),at.return=dt,at):(at=Nv(mt.type,mt.key,mt.props,null,dt.mode,Dt),op(at,mt),at.return=dt,at)}function vt(dt,at,mt,Dt){return at===null||at.tag!==4||at.stateNode.containerInfo!==mt.containerInfo||at.stateNode.implementation!==mt.implementation?(at=Nw(mt,dt.mode,Dt),at.return=dt,at):(at=I(at,mt.children||[]),at.return=dt,at)}function At(dt,at,mt,Dt,Kt){return at===null||at.tag!==7?(at=Ml(mt,dt.mode,Dt,Kt),at.return=dt,at):(at=I(at,mt),at.return=dt,at)}function $t(dt,at,mt){if(typeof at=="string"&&at!==""||typeof at=="number"||typeof at=="bigint")return at=Tw(""+at,dt.mode,mt),at.return=dt,at;if(typeof at=="object"&&at!==null){switch(at.$$typeof){case d:return mt=Nv(at.type,at.key,at.props,null,dt.mode,mt),op(mt,at),mt.return=dt,mt;case p:return at=Nw(at,dt.mode,mt),at.return=dt,at;case N:var Dt=at._init;return at=Dt(at._payload),$t(dt,at,mt)}if(W(at)||O(at))return at=Ml(at,dt.mode,mt,null),at.return=dt,at;if(typeof at.then=="function")return $t(dt,qv(at),mt);if(at.$$typeof===E)return $t(dt,$v(dt,at),mt);jv(dt,at)}return null}function xt(dt,at,mt,Dt){var Kt=at!==null?at.key:null;if(typeof mt=="string"&&mt!==""||typeof mt=="number"||typeof mt=="bigint")return Kt!==null?null:V(dt,at,""+mt,Dt);if(typeof mt=="object"&&mt!==null){switch(mt.$$typeof){case d:return mt.key===Kt?tt(dt,at,mt,Dt):null;case p:return mt.key===Kt?vt(dt,at,mt,Dt):null;case N:return Kt=mt._init,mt=Kt(mt._payload),xt(dt,at,mt,Dt)}if(W(mt)||O(mt))return Kt!==null?null:At(dt,at,mt,Dt,null);if(typeof mt.then=="function")return xt(dt,at,qv(mt),Dt);if(mt.$$typeof===E)return xt(dt,at,$v(dt,mt),Dt);jv(dt,mt)}return null}function bt(dt,at,mt,Dt,Kt){if(typeof Dt=="string"&&Dt!==""||typeof Dt=="number"||typeof Dt=="bigint")return dt=dt.get(mt)||null,V(at,dt,""+Dt,Kt);if(typeof Dt=="object"&&Dt!==null){switch(Dt.$$typeof){case d:return dt=dt.get(Dt.key===null?mt:Dt.key)||null,tt(at,dt,Dt,Kt);case p:return dt=dt.get(Dt.key===null?mt:Dt.key)||null,vt(at,dt,Dt,Kt);case N:var Fe=Dt._init;return Dt=Fe(Dt._payload),bt(dt,at,mt,Dt,Kt)}if(W(Dt)||O(Dt))return dt=dt.get(mt)||null,At(at,dt,Dt,Kt,null);if(typeof Dt.then=="function")return bt(dt,at,mt,qv(Dt),Kt);if(Dt.$$typeof===E)return bt(dt,at,mt,$v(at,Dt),Kt);jv(at,Dt)}return null}function ye(dt,at,mt,Dt){for(var Kt=null,Fe=null,le=at,ve=at=0,Mr=null;le!==null&&ve<mt.length;ve++){le.index>ve?(Mr=le,le=null):Mr=le.sibling;var Ye=xt(dt,le,mt[ve],Dt);if(Ye===null){le===null&&(le=Mr);break}f&&le&&Ye.alternate===null&&m(dt,le),at=T(Ye,at,ve),Fe===null?Kt=Ye:Fe.sibling=Ye,Fe=Ye,le=Mr}if(ve===mt.length)return v(dt,le),rn&&Pl(dt,ve),Kt;if(le===null){for(;ve<mt.length;ve++)le=$t(dt,mt[ve],Dt),le!==null&&(at=T(le,at,ve),Fe===null?Kt=le:Fe.sibling=le,Fe=le);return rn&&Pl(dt,ve),Kt}for(le=w(le);ve<mt.length;ve++)Mr=bt(le,dt,ve,mt[ve],Dt),Mr!==null&&(f&&Mr.alternate!==null&&le.delete(Mr.key===null?ve:Mr.key),at=T(Mr,at,ve),Fe===null?Kt=Mr:Fe.sibling=Mr,Fe=Mr);return f&&le.forEach(function(Mu){return m(dt,Mu)}),rn&&Pl(dt,ve),Kt}function pe(dt,at,mt,Dt){if(mt==null)throw Error(r(151));for(var Kt=null,Fe=null,le=at,ve=at=0,Mr=null,Ye=mt.next();le!==null&&!Ye.done;ve++,Ye=mt.next()){le.index>ve?(Mr=le,le=null):Mr=le.sibling;var Mu=xt(dt,le,Ye.value,Dt);if(Mu===null){le===null&&(le=Mr);break}f&&le&&Mu.alternate===null&&m(dt,le),at=T(Mu,at,ve),Fe===null?Kt=Mu:Fe.sibling=Mu,Fe=Mu,le=Mr}if(Ye.done)return v(dt,le),rn&&Pl(dt,ve),Kt;if(le===null){for(;!Ye.done;ve++,Ye=mt.next())Ye=$t(dt,Ye.value,Dt),Ye!==null&&(at=T(Ye,at,ve),Fe===null?Kt=Ye:Fe.sibling=Ye,Fe=Ye);return rn&&Pl(dt,ve),Kt}for(le=w(le);!Ye.done;ve++,Ye=mt.next())Ye=bt(le,dt,ve,Ye.value,Dt),Ye!==null&&(f&&Ye.alternate!==null&&le.delete(Ye.key===null?ve:Ye.key),at=T(Ye,at,ve),Fe===null?Kt=Ye:Fe.sibling=Ye,Fe=Ye);return f&&le.forEach(function(Rj){return m(dt,Rj)}),rn&&Pl(dt,ve),Kt}function xn(dt,at,mt,Dt){if(typeof mt=="object"&&mt!==null&&mt.type===g&&mt.key===null&&(mt=mt.props.children),typeof mt=="object"&&mt!==null){switch(mt.$$typeof){case d:t:{for(var Kt=mt.key;at!==null;){if(at.key===Kt){if(Kt=mt.type,Kt===g){if(at.tag===7){v(dt,at.sibling),Dt=I(at,mt.props.children),Dt.return=dt,dt=Dt;break t}}else if(at.elementType===Kt||typeof Kt=="object"&&Kt!==null&&Kt.$$typeof===N&&x_(Kt)===at.type){v(dt,at.sibling),Dt=I(at,mt.props),op(Dt,mt),Dt.return=dt,dt=Dt;break t}v(dt,at);break}else m(dt,at);at=at.sibling}mt.type===g?(Dt=Ml(mt.props.children,dt.mode,Dt,mt.key),Dt.return=dt,dt=Dt):(Dt=Nv(mt.type,mt.key,mt.props,null,dt.mode,Dt),op(Dt,mt),Dt.return=dt,dt=Dt)}return L(dt);case p:t:{for(Kt=mt.key;at!==null;){if(at.key===Kt)if(at.tag===4&&at.stateNode.containerInfo===mt.containerInfo&&at.stateNode.implementation===mt.implementation){v(dt,at.sibling),Dt=I(at,mt.children||[]),Dt.return=dt,dt=Dt;break t}else{v(dt,at);break}else m(dt,at);at=at.sibling}Dt=Nw(mt,dt.mode,Dt),Dt.return=dt,dt=Dt}return L(dt);case N:return Kt=mt._init,mt=Kt(mt._payload),xn(dt,at,mt,Dt)}if(W(mt))return ye(dt,at,mt,Dt);if(O(mt)){if(Kt=O(mt),typeof Kt!="function")throw Error(r(150));return mt=Kt.call(mt),pe(dt,at,mt,Dt)}if(typeof mt.then=="function")return xn(dt,at,qv(mt),Dt);if(mt.$$typeof===E)return xn(dt,at,$v(dt,mt),Dt);jv(dt,mt)}return typeof mt=="string"&&mt!==""||typeof mt=="number"||typeof mt=="bigint"?(mt=""+mt,at!==null&&at.tag===6?(v(dt,at.sibling),Dt=I(at,mt),Dt.return=dt,dt=Dt):(v(dt,at),Dt=Tw(mt,dt.mode,Dt),Dt.return=dt,dt=Dt),L(dt)):v(dt,at)}return function(dt,at,mt,Dt){try{rp=0;var Kt=xn(dt,at,mt,Dt);return Oh=null,Kt}catch(le){if(le===Xd||le===Fv)throw le;var Fe=na(29,le,null,dt.mode);return Fe.lanes=Dt,Fe.return=dt,Fe}finally{}}}var Fh=y_(!0),b_=y_(!1),Aa=G(null),Ri=null;function wu(f){var m=f.alternate;Z(Sr,Sr.current&1),Z(Aa,f),Ri===null&&(m===null||Ah.current!==null||m.memoizedState!==null)&&(Ri=f)}function w_(f){if(f.tag===22){if(Z(Sr,Sr.current),Z(Aa,f),Ri===null){var m=f.alternate;m!==null&&m.memoizedState!==null&&(Ri=f)}}else Cu()}function Cu(){Z(Sr,Sr.current),Z(Aa,Aa.current)}function Rs(f){Q(Aa),Ri===f&&(Ri=null),Q(Sr)}var Sr=G(0);function Xv(f){for(var m=f;m!==null;){if(m.tag===13){var v=m.memoizedState;if(v!==null&&(v=v.dehydrated,v===null||v.data==="$?"||Q2(v)))return m}else if(m.tag===19&&m.memoizedProps.revealOrder!==void 0){if((m.flags&128)!==0)return m}else if(m.child!==null){m.child.return=m,m=m.child;continue}if(m===f)break;for(;m.sibling===null;){if(m.return===null||m.return===f)return null;m=m.return}m.sibling.return=m.return,m=m.sibling}return null}function u2(f,m,v,w){m=f.memoizedState,v=v(w,m),v=v==null?m:c({},m,v),f.memoizedState=v,f.lanes===0&&(f.updateQueue.baseState=v)}var l2={enqueueSetState:function(f,m,v){f=f._reactInternals;var w=ia(),I=xu(w);I.payload=m,v!=null&&(I.callback=v),m=yu(f,I,w),m!==null&&(sa(m,f,w),Yd(m,f,w))},enqueueReplaceState:function(f,m,v){f=f._reactInternals;var w=ia(),I=xu(w);I.tag=1,I.payload=m,v!=null&&(I.callback=v),m=yu(f,I,w),m!==null&&(sa(m,f,w),Yd(m,f,w))},enqueueForceUpdate:function(f,m){f=f._reactInternals;var v=ia(),w=xu(v);w.tag=2,m!=null&&(w.callback=m),m=yu(f,w,v),m!==null&&(sa(m,f,v),Yd(m,f,v))}};function C_(f,m,v,w,I,T,L){return f=f.stateNode,typeof f.shouldComponentUpdate=="function"?f.shouldComponentUpdate(w,T,L):m.prototype&&m.prototype.isPureReactComponent?!zd(v,w)||!zd(I,T):!0}function S_(f,m,v,w){f=m.state,typeof m.componentWillReceiveProps=="function"&&m.componentWillReceiveProps(v,w),typeof m.UNSAFE_componentWillReceiveProps=="function"&&m.UNSAFE_componentWillReceiveProps(v,w),m.state!==f&&l2.enqueueReplaceState(m,m.state,null)}function Hl(f,m){var v=m;if("ref"in m){v={};for(var w in m)w!=="ref"&&(v[w]=m[w])}if(f=f.defaultProps){v===m&&(v=c({},v));for(var I in f)v[I]===void 0&&(v[I]=f[I])}return v}var Kv=typeof reportError=="function"?reportError:function(f){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var m=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof f=="object"&&f!==null&&typeof f.message=="string"?String(f.message):String(f),error:f});if(!window.dispatchEvent(m))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",f);return}console.error(f)};function E_(f){Kv(f)}function k_(f){console.error(f)}function I_(f){Kv(f)}function Yv(f,m){try{var v=f.onUncaughtError;v(m.value,{componentStack:m.stack})}catch(w){setTimeout(function(){throw w})}}function R_(f,m,v){try{var w=f.onCaughtError;w(v.value,{componentStack:v.stack,errorBoundary:m.tag===1?m.stateNode:null})}catch(I){setTimeout(function(){throw I})}}function c2(f,m,v){return v=xu(v),v.tag=3,v.payload={element:null},v.callback=function(){Yv(f,m)},v}function T_(f){return f=xu(f),f.tag=3,f}function N_(f,m,v,w){var I=v.type.getDerivedStateFromError;if(typeof I=="function"){var T=w.value;f.payload=function(){return I(T)},f.callback=function(){R_(m,v,w)}}var L=v.stateNode;L!==null&&typeof L.componentDidCatch=="function"&&(f.callback=function(){R_(m,v,w),typeof I!="function"&&(Tu===null?Tu=new Set([this]):Tu.add(this));var V=w.stack;this.componentDidCatch(w.value,{componentStack:V!==null?V:""})})}function R5(f,m,v,w,I){if(v.flags|=32768,w!==null&&typeof w=="object"&&typeof w.then=="function"){if(m=v.alternate,m!==null&&Hd(m,v,I,!0),v=Aa.current,v!==null){switch(v.tag){case 13:return Ri===null?O2():v.alternate===null&&qn===0&&(qn=3),v.flags&=-257,v.flags|=65536,v.lanes=I,w===Bw?v.flags|=16384:(m=v.updateQueue,m===null?v.updateQueue=new Set([w]):m.add(w),M2(f,w,I)),!1;case 22:return v.flags|=65536,w===Bw?v.flags|=16384:(m=v.updateQueue,m===null?(m={transitions:null,markerInstances:null,retryQueue:new Set([w])},v.updateQueue=m):(v=m.retryQueue,v===null?m.retryQueue=new Set([w]):v.add(w)),M2(f,w,I)),!1}throw Error(r(435,v.tag))}return M2(f,w,I),O2(),!1}if(rn)return m=Aa.current,m!==null?((m.flags&65536)===0&&(m.flags|=256),m.flags|=65536,m.lanes=I,w!==Dw&&(f=Error(r(422),{cause:w}),Gd(Ia(f,v)))):(w!==Dw&&(m=Error(r(423),{cause:w}),Gd(Ia(m,v))),f=f.current.alternate,f.flags|=65536,I&=-I,f.lanes|=I,w=Ia(w,v),I=c2(f.stateNode,w,I),Ww(f,I),qn!==4&&(qn=2)),!1;var T=Error(r(520),{cause:w});if(T=Ia(T,v),hp===null?hp=[T]:hp.push(T),qn!==4&&(qn=2),m===null)return!0;w=Ia(w,v),v=m;do{switch(v.tag){case 3:return v.flags|=65536,f=I&-I,v.lanes|=f,f=c2(v.stateNode,w,f),Ww(v,f),!1;case 1:if(m=v.type,T=v.stateNode,(v.flags&128)===0&&(typeof m.getDerivedStateFromError=="function"||T!==null&&typeof T.componentDidCatch=="function"&&(Tu===null||!Tu.has(T))))return v.flags|=65536,I&=-I,v.lanes|=I,I=T_(I),N_(I,f,v,w),Ww(v,I),!1}v=v.return}while(v!==null);return!1}var A_=Error(r(461)),Or=!1;function qr(f,m,v,w){m.child=f===null?b_(m,null,v,w):Fh(m,f.child,v,w)}function __(f,m,v,w,I){v=v.render;var T=m.ref;if("ref"in w){var L={};for(var V in w)V!=="ref"&&(L[V]=w[V])}else L=w;return Wl(m),w=jw(f,m,v,L,T,I),V=Xw(),f!==null&&!Or?(Kw(f,m,I),Ts(f,m,I)):(rn&&V&&Aw(m),m.flags|=1,qr(f,m,w,I),m.child)}function D_(f,m,v,w,I){if(f===null){var T=v.type;return typeof T=="function"&&!Rw(T)&&T.defaultProps===void 0&&v.compare===null?(m.tag=15,m.type=T,$_(f,m,T,w,I)):(f=Nv(v.type,null,w,m,m.mode,I),f.ref=m.ref,f.return=m,m.child=f)}if(T=f.child,!x2(f,I)){var L=T.memoizedProps;if(v=v.compare,v=v!==null?v:zd,v(L,w)&&f.ref===m.ref)return Ts(f,m,I)}return m.flags|=1,f=ws(T,w),f.ref=m.ref,f.return=m,m.child=f}function $_(f,m,v,w,I){if(f!==null){var T=f.memoizedProps;if(zd(T,w)&&f.ref===m.ref)if(Or=!1,m.pendingProps=w=T,x2(f,I))(f.flags&131072)!==0&&(Or=!0);else return m.lanes=f.lanes,Ts(f,m,I)}return h2(f,m,v,w,I)}function O_(f,m,v){var w=m.pendingProps,I=w.children,T=f!==null?f.memoizedState:null;if(w.mode==="hidden"){if((m.flags&128)!==0){if(w=T!==null?T.baseLanes|v:v,f!==null){for(I=m.child=f.child,T=0;I!==null;)T=T|I.lanes|I.childLanes,I=I.sibling;m.childLanes=T&~w}else m.childLanes=0,m.child=null;return F_(f,m,w,v)}if((v&536870912)!==0)m.memoizedState={baseLanes:0,cachePool:null},f!==null&&Ov(m,T!==null?T.cachePool:null),T!==null?$A(m,T):Gw(),w_(m);else return m.lanes=m.childLanes=536870912,F_(f,m,T!==null?T.baseLanes|v:v,v)}else T!==null?(Ov(m,T.cachePool),$A(m,T),Cu(),m.memoizedState=null):(f!==null&&Ov(m,null),Gw(),Cu());return qr(f,m,I,v),m.child}function F_(f,m,v,w){var I=Pw();return I=I===null?null:{parent:Cr._currentValue,pool:I},m.memoizedState={baseLanes:v,cachePool:I},f!==null&&Ov(m,null),Gw(),w_(m),f!==null&&Hd(f,m,w,!0),null}function Qv(f,m){var v=m.ref;if(v===null)f!==null&&f.ref!==null&&(m.flags|=4194816);else{if(typeof v!="function"&&typeof v!="object")throw Error(r(284));(f===null||f.ref!==v)&&(m.flags|=4194816)}}function h2(f,m,v,w,I){return Wl(m),v=jw(f,m,v,w,void 0,I),w=Xw(),f!==null&&!Or?(Kw(f,m,I),Ts(f,m,I)):(rn&&w&&Aw(m),m.flags|=1,qr(f,m,v,I),m.child)}function M_(f,m,v,w,I,T){return Wl(m),m.updateQueue=null,v=FA(m,w,v,I),OA(f),w=Xw(),f!==null&&!Or?(Kw(f,m,T),Ts(f,m,T)):(rn&&w&&Aw(m),m.flags|=1,qr(f,m,v,T),m.child)}function L_(f,m,v,w,I){if(Wl(m),m.stateNode===null){var T=kh,L=v.contextType;typeof L=="object"&&L!==null&&(T=so(L)),T=new v(w,T),m.memoizedState=T.state!==null&&T.state!==void 0?T.state:null,T.updater=l2,m.stateNode=T,T._reactInternals=m,T=m.stateNode,T.props=w,T.state=m.memoizedState,T.refs={},zw(m),L=v.contextType,T.context=typeof L=="object"&&L!==null?so(L):kh,T.state=m.memoizedState,L=v.getDerivedStateFromProps,typeof L=="function"&&(u2(m,v,L,w),T.state=m.memoizedState),typeof v.getDerivedStateFromProps=="function"||typeof T.getSnapshotBeforeUpdate=="function"||typeof T.UNSAFE_componentWillMount!="function"&&typeof T.componentWillMount!="function"||(L=T.state,typeof T.componentWillMount=="function"&&T.componentWillMount(),typeof T.UNSAFE_componentWillMount=="function"&&T.UNSAFE_componentWillMount(),L!==T.state&&l2.enqueueReplaceState(T,T.state,null),Zd(m,w,T,I),Qd(),T.state=m.memoizedState),typeof T.componentDidMount=="function"&&(m.flags|=4194308),w=!0}else if(f===null){T=m.stateNode;var V=m.memoizedProps,tt=Hl(v,V);T.props=tt;var vt=T.context,At=v.contextType;L=kh,typeof At=="object"&&At!==null&&(L=so(At));var $t=v.getDerivedStateFromProps;At=typeof $t=="function"||typeof T.getSnapshotBeforeUpdate=="function",V=m.pendingProps!==V,At||typeof T.UNSAFE_componentWillReceiveProps!="function"&&typeof T.componentWillReceiveProps!="function"||(V||vt!==L)&&S_(m,T,w,L),vu=!1;var xt=m.memoizedState;T.state=xt,Zd(m,w,T,I),Qd(),vt=m.memoizedState,V||xt!==vt||vu?(typeof $t=="function"&&(u2(m,v,$t,w),vt=m.memoizedState),(tt=vu||C_(m,v,tt,w,xt,vt,L))?(At||typeof T.UNSAFE_componentWillMount!="function"&&typeof T.componentWillMount!="function"||(typeof T.componentWillMount=="function"&&T.componentWillMount(),typeof T.UNSAFE_componentWillMount=="function"&&T.UNSAFE_componentWillMount()),typeof T.componentDidMount=="function"&&(m.flags|=4194308)):(typeof T.componentDidMount=="function"&&(m.flags|=4194308),m.memoizedProps=w,m.memoizedState=vt),T.props=w,T.state=vt,T.context=L,w=tt):(typeof T.componentDidMount=="function"&&(m.flags|=4194308),w=!1)}else{T=m.stateNode,Uw(f,m),L=m.memoizedProps,At=Hl(v,L),T.props=At,$t=m.pendingProps,xt=T.context,vt=v.contextType,tt=kh,typeof vt=="object"&&vt!==null&&(tt=so(vt)),V=v.getDerivedStateFromProps,(vt=typeof V=="function"||typeof T.getSnapshotBeforeUpdate=="function")||typeof T.UNSAFE_componentWillReceiveProps!="function"&&typeof T.componentWillReceiveProps!="function"||(L!==$t||xt!==tt)&&S_(m,T,w,tt),vu=!1,xt=m.memoizedState,T.state=xt,Zd(m,w,T,I),Qd();var bt=m.memoizedState;L!==$t||xt!==bt||vu||f!==null&&f.dependencies!==null&&Dv(f.dependencies)?(typeof V=="function"&&(u2(m,v,V,w),bt=m.memoizedState),(At=vu||C_(m,v,At,w,xt,bt,tt)||f!==null&&f.dependencies!==null&&Dv(f.dependencies))?(vt||typeof T.UNSAFE_componentWillUpdate!="function"&&typeof T.componentWillUpdate!="function"||(typeof T.componentWillUpdate=="function"&&T.componentWillUpdate(w,bt,tt),typeof T.UNSAFE_componentWillUpdate=="function"&&T.UNSAFE_componentWillUpdate(w,bt,tt)),typeof T.componentDidUpdate=="function"&&(m.flags|=4),typeof T.getSnapshotBeforeUpdate=="function"&&(m.flags|=1024)):(typeof T.componentDidUpdate!="function"||L===f.memoizedProps&&xt===f.memoizedState||(m.flags|=4),typeof T.getSnapshotBeforeUpdate!="function"||L===f.memoizedProps&&xt===f.memoizedState||(m.flags|=1024),m.memoizedProps=w,m.memoizedState=bt),T.props=w,T.state=bt,T.context=tt,w=At):(typeof T.componentDidUpdate!="function"||L===f.memoizedProps&&xt===f.memoizedState||(m.flags|=4),typeof T.getSnapshotBeforeUpdate!="function"||L===f.memoizedProps&&xt===f.memoizedState||(m.flags|=1024),w=!1)}return T=w,Qv(f,m),w=(m.flags&128)!==0,T||w?(T=m.stateNode,v=w&&typeof v.getDerivedStateFromError!="function"?null:T.render(),m.flags|=1,f!==null&&w?(m.child=Fh(m,f.child,null,I),m.child=Fh(m,null,v,I)):qr(f,m,v,I),m.memoizedState=T.state,f=m.child):f=Ts(f,m,I),f}function P_(f,m,v,w){return Vd(),m.flags|=256,qr(f,m,v,w),m.child}var f2={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function d2(f){return{baseLanes:f,cachePool:kA()}}function p2(f,m,v){return f=f!==null?f.childLanes&~v:0,m&&(f|=_a),f}function B_(f,m,v){var w=m.pendingProps,I=!1,T=(m.flags&128)!==0,L;if((L=T)||(L=f!==null&&f.memoizedState===null?!1:(Sr.current&2)!==0),L&&(I=!0,m.flags&=-129),L=(m.flags&32)!==0,m.flags&=-33,f===null){if(rn){if(I?wu(m):Cu(),rn){var V=Hn,tt;if(tt=V){t:{for(tt=V,V=Ii;tt.nodeType!==8;){if(!V){V=null;break t}if(tt=ei(tt.nextSibling),tt===null){V=null;break t}}V=tt}V!==null?(m.memoizedState={dehydrated:V,treeContext:Ll!==null?{id:Cs,overflow:Ss}:null,retryLane:536870912,hydrationErrors:null},tt=na(18,null,null,0),tt.stateNode=V,tt.return=m,m.child=tt,Eo=m,Hn=null,tt=!0):tt=!1}tt||zl(m)}if(V=m.memoizedState,V!==null&&(V=V.dehydrated,V!==null))return Q2(V)?m.lanes=32:m.lanes=536870912,null;Rs(m)}return V=w.children,w=w.fallback,I?(Cu(),I=m.mode,V=Zv({mode:"hidden",children:V},I),w=Ml(w,I,v,null),V.return=m,w.return=m,V.sibling=w,m.child=V,I=m.child,I.memoizedState=d2(v),I.childLanes=p2(f,L,v),m.memoizedState=f2,w):(wu(m),m2(m,V))}if(tt=f.memoizedState,tt!==null&&(V=tt.dehydrated,V!==null)){if(T)m.flags&256?(wu(m),m.flags&=-257,m=g2(f,m,v)):m.memoizedState!==null?(Cu(),m.child=f.child,m.flags|=128,m=null):(Cu(),I=w.fallback,V=m.mode,w=Zv({mode:"visible",children:w.children},V),I=Ml(I,V,v,null),I.flags|=2,w.return=m,I.return=m,w.sibling=I,m.child=w,Fh(m,f.child,null,v),w=m.child,w.memoizedState=d2(v),w.childLanes=p2(f,L,v),m.memoizedState=f2,m=I);else if(wu(m),Q2(V)){if(L=V.nextSibling&&V.nextSibling.dataset,L)var vt=L.dgst;L=vt,w=Error(r(419)),w.stack="",w.digest=L,Gd({value:w,source:null,stack:null}),m=g2(f,m,v)}else if(Or||Hd(f,m,v,!1),L=(v&f.childLanes)!==0,Or||L){if(L=Rn,L!==null&&(w=v&-v,w=(w&42)!==0?1:Zb(w),w=(w&(L.suspendedLanes|v))!==0?0:w,w!==0&&w!==tt.retryLane))throw tt.retryLane=w,Eh(f,w),sa(L,f,w),A_;V.data==="$?"||O2(),m=g2(f,m,v)}else V.data==="$?"?(m.flags|=192,m.child=f.child,m=null):(f=tt.treeContext,Hn=ei(V.nextSibling),Eo=m,rn=!0,Bl=null,Ii=!1,f!==null&&(Ta[Na++]=Cs,Ta[Na++]=Ss,Ta[Na++]=Ll,Cs=f.id,Ss=f.overflow,Ll=m),m=m2(m,w.children),m.flags|=4096);return m}return I?(Cu(),I=w.fallback,V=m.mode,tt=f.child,vt=tt.sibling,w=ws(tt,{mode:"hidden",children:w.children}),w.subtreeFlags=tt.subtreeFlags&65011712,vt!==null?I=ws(vt,I):(I=Ml(I,V,v,null),I.flags|=2),I.return=m,w.return=m,w.sibling=I,m.child=w,w=I,I=m.child,V=f.child.memoizedState,V===null?V=d2(v):(tt=V.cachePool,tt!==null?(vt=Cr._currentValue,tt=tt.parent!==vt?{parent:vt,pool:vt}:tt):tt=kA(),V={baseLanes:V.baseLanes|v,cachePool:tt}),I.memoizedState=V,I.childLanes=p2(f,L,v),m.memoizedState=f2,w):(wu(m),v=f.child,f=v.sibling,v=ws(v,{mode:"visible",children:w.children}),v.return=m,v.sibling=null,f!==null&&(L=m.deletions,L===null?(m.deletions=[f],m.flags|=16):L.push(f)),m.child=v,m.memoizedState=null,v)}function m2(f,m){return m=Zv({mode:"visible",children:m},f.mode),m.return=f,f.child=m}function Zv(f,m){return f=na(22,f,null,m),f.lanes=0,f.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},f}function g2(f,m,v){return Fh(m,f.child,null,v),f=m2(m,m.pendingProps.children),f.flags|=2,m.memoizedState=null,f}function z_(f,m,v){f.lanes|=m;var w=f.alternate;w!==null&&(w.lanes|=m),Ow(f.return,m,v)}function v2(f,m,v,w,I){var T=f.memoizedState;T===null?f.memoizedState={isBackwards:m,rendering:null,renderingStartTime:0,last:w,tail:v,tailMode:I}:(T.isBackwards=m,T.rendering=null,T.renderingStartTime=0,T.last=w,T.tail=v,T.tailMode=I)}function U_(f,m,v){var w=m.pendingProps,I=w.revealOrder,T=w.tail;if(qr(f,m,w.children,v),w=Sr.current,(w&2)!==0)w=w&1|2,m.flags|=128;else{if(f!==null&&(f.flags&128)!==0)t:for(f=m.child;f!==null;){if(f.tag===13)f.memoizedState!==null&&z_(f,v,m);else if(f.tag===19)z_(f,v,m);else if(f.child!==null){f.child.return=f,f=f.child;continue}if(f===m)break t;for(;f.sibling===null;){if(f.return===null||f.return===m)break t;f=f.return}f.sibling.return=f.return,f=f.sibling}w&=1}switch(Z(Sr,w),I){case"forwards":for(v=m.child,I=null;v!==null;)f=v.alternate,f!==null&&Xv(f)===null&&(I=v),v=v.sibling;v=I,v===null?(I=m.child,m.child=null):(I=v.sibling,v.sibling=null),v2(m,!1,I,v,T);break;case"backwards":for(v=null,I=m.child,m.child=null;I!==null;){if(f=I.alternate,f!==null&&Xv(f)===null){m.child=I;break}f=I.sibling,I.sibling=v,v=I,I=f}v2(m,!0,v,null,T);break;case"together":v2(m,!1,null,null,void 0);break;default:m.memoizedState=null}return m.child}function Ts(f,m,v){if(f!==null&&(m.dependencies=f.dependencies),Ru|=m.lanes,(v&m.childLanes)===0)if(f!==null){if(Hd(f,m,v,!1),(v&m.childLanes)===0)return null}else return null;if(f!==null&&m.child!==f.child)throw Error(r(153));if(m.child!==null){for(f=m.child,v=ws(f,f.pendingProps),m.child=v,v.return=m;f.sibling!==null;)f=f.sibling,v=v.sibling=ws(f,f.pendingProps),v.return=m;v.sibling=null}return m.child}function x2(f,m){return(f.lanes&m)!==0?!0:(f=f.dependencies,!!(f!==null&&Dv(f)))}function T5(f,m,v){switch(m.tag){case 3:Ct(m,m.stateNode.containerInfo),gu(m,Cr,f.memoizedState.cache),Vd();break;case 27:case 5:Ut(m);break;case 4:Ct(m,m.stateNode.containerInfo);break;case 10:gu(m,m.type,m.memoizedProps.value);break;case 13:var w=m.memoizedState;if(w!==null)return w.dehydrated!==null?(wu(m),m.flags|=128,null):(v&m.child.childLanes)!==0?B_(f,m,v):(wu(m),f=Ts(f,m,v),f!==null?f.sibling:null);wu(m);break;case 19:var I=(f.flags&128)!==0;if(w=(v&m.childLanes)!==0,w||(Hd(f,m,v,!1),w=(v&m.childLanes)!==0),I){if(w)return U_(f,m,v);m.flags|=128}if(I=m.memoizedState,I!==null&&(I.rendering=null,I.tail=null,I.lastEffect=null),Z(Sr,Sr.current),w)break;return null;case 22:case 23:return m.lanes=0,O_(f,m,v);case 24:gu(m,Cr,f.memoizedState.cache)}return Ts(f,m,v)}function W_(f,m,v){if(f!==null)if(f.memoizedProps!==m.pendingProps)Or=!0;else{if(!x2(f,v)&&(m.flags&128)===0)return Or=!1,T5(f,m,v);Or=(f.flags&131072)!==0}else Or=!1,rn&&(m.flags&1048576)!==0&&xA(m,_v,m.index);switch(m.lanes=0,m.tag){case 16:t:{f=m.pendingProps;var w=m.elementType,I=w._init;if(w=I(w._payload),m.type=w,typeof w=="function")Rw(w)?(f=Hl(w,f),m.tag=1,m=L_(null,m,w,f,v)):(m.tag=0,m=h2(null,m,w,f,v));else{if(w!=null){if(I=w.$$typeof,I===S){m.tag=11,m=__(null,m,w,f,v);break t}else if(I===A){m.tag=14,m=D_(null,m,w,f,v);break t}}throw m=z(w)||w,Error(r(306,m,""))}}return m;case 0:return h2(f,m,m.type,m.pendingProps,v);case 1:return w=m.type,I=Hl(w,m.pendingProps),L_(f,m,w,I,v);case 3:t:{if(Ct(m,m.stateNode.containerInfo),f===null)throw Error(r(387));w=m.pendingProps;var T=m.memoizedState;I=T.element,Uw(f,m),Zd(m,w,null,v);var L=m.memoizedState;if(w=L.cache,gu(m,Cr,w),w!==T.cache&&Fw(m,[Cr],v,!0),Qd(),w=L.element,T.isDehydrated)if(T={element:w,isDehydrated:!1,cache:L.cache},m.updateQueue.baseState=T,m.memoizedState=T,m.flags&256){m=P_(f,m,w,v);break t}else if(w!==I){I=Ia(Error(r(424)),m),Gd(I),m=P_(f,m,w,v);break t}else{switch(f=m.stateNode.containerInfo,f.nodeType){case 9:f=f.body;break;default:f=f.nodeName==="HTML"?f.ownerDocument.body:f}for(Hn=ei(f.firstChild),Eo=m,rn=!0,Bl=null,Ii=!0,v=b_(m,null,w,v),m.child=v;v;)v.flags=v.flags&-3|4096,v=v.sibling}else{if(Vd(),w===I){m=Ts(f,m,v);break t}qr(f,m,w,v)}m=m.child}return m;case 26:return Qv(f,m),f===null?(v=qD(m.type,null,m.pendingProps,null))?m.memoizedState=v:rn||(v=m.type,f=m.pendingProps,w=fx(pt.current).createElement(v),w[io]=m,w[Fo]=f,Xr(w,v,f),$r(w),m.stateNode=w):m.memoizedState=qD(m.type,f.memoizedProps,m.pendingProps,f.memoizedState),null;case 27:return Ut(m),f===null&&rn&&(w=m.stateNode=VD(m.type,m.pendingProps,pt.current),Eo=m,Ii=!0,I=Hn,_u(m.type)?(Z2=I,Hn=ei(w.firstChild)):Hn=I),qr(f,m,m.pendingProps.children,v),Qv(f,m),f===null&&(m.flags|=4194304),m.child;case 5:return f===null&&rn&&((I=w=Hn)&&(w=nj(w,m.type,m.pendingProps,Ii),w!==null?(m.stateNode=w,Eo=m,Hn=ei(w.firstChild),Ii=!1,I=!0):I=!1),I||zl(m)),Ut(m),I=m.type,T=m.pendingProps,L=f!==null?f.memoizedProps:null,w=T.children,X2(I,T)?w=null:L!==null&&X2(I,L)&&(m.flags|=32),m.memoizedState!==null&&(I=jw(f,m,b5,null,null,v),bp._currentValue=I),Qv(f,m),qr(f,m,w,v),m.child;case 6:return f===null&&rn&&((f=v=Hn)&&(v=rj(v,m.pendingProps,Ii),v!==null?(m.stateNode=v,Eo=m,Hn=null,f=!0):f=!1),f||zl(m)),null;case 13:return B_(f,m,v);case 4:return Ct(m,m.stateNode.containerInfo),w=m.pendingProps,f===null?m.child=Fh(m,null,w,v):qr(f,m,w,v),m.child;case 11:return __(f,m,m.type,m.pendingProps,v);case 7:return qr(f,m,m.pendingProps,v),m.child;case 8:return qr(f,m,m.pendingProps.children,v),m.child;case 12:return qr(f,m,m.pendingProps.children,v),m.child;case 10:return w=m.pendingProps,gu(m,m.type,w.value),qr(f,m,w.children,v),m.child;case 9:return I=m.type._context,w=m.pendingProps.children,Wl(m),I=so(I),w=w(I),m.flags|=1,qr(f,m,w,v),m.child;case 14:return D_(f,m,m.type,m.pendingProps,v);case 15:return $_(f,m,m.type,m.pendingProps,v);case 19:return U_(f,m,v);case 31:return w=m.pendingProps,v=m.mode,w={mode:w.mode,children:w.children},f===null?(v=Zv(w,v),v.ref=m.ref,m.child=v,v.return=m,m=v):(v=ws(f.child,w),v.ref=m.ref,m.child=v,v.return=m,m=v),m;case 22:return O_(f,m,v);case 24:return Wl(m),w=so(Cr),f===null?(I=Pw(),I===null&&(I=Rn,T=Mw(),I.pooledCache=T,T.refCount++,T!==null&&(I.pooledCacheLanes|=v),I=T),m.memoizedState={parent:w,cache:I},zw(m),gu(m,Cr,I)):((f.lanes&v)!==0&&(Uw(f,m),Zd(m,null,null,v),Qd()),I=f.memoizedState,T=m.memoizedState,I.parent!==w?(I={parent:w,cache:w},m.memoizedState=I,m.lanes===0&&(m.memoizedState=m.updateQueue.baseState=I),gu(m,Cr,w)):(w=T.cache,gu(m,Cr,w),w!==I.cache&&Fw(m,[Cr],v,!0))),qr(f,m,m.pendingProps.children,v),m.child;case 29:throw m.pendingProps}throw Error(r(156,m.tag))}function Ns(f){f.flags|=4}function V_(f,m){if(m.type!=="stylesheet"||(m.state.loading&4)!==0)f.flags&=-16777217;else if(f.flags|=16777216,!QD(m)){if(m=Aa.current,m!==null&&((He&4194048)===He?Ri!==null:(He&62914560)!==He&&(He&536870912)===0||m!==Ri))throw Kd=Bw,IA;f.flags|=8192}}function Jv(f,m){m!==null&&(f.flags|=4),f.flags&16384&&(m=f.tag!==22?wN():536870912,f.lanes|=m,Bh|=m)}function ap(f,m){if(!rn)switch(f.tailMode){case"hidden":m=f.tail;for(var v=null;m!==null;)m.alternate!==null&&(v=m),m=m.sibling;v===null?f.tail=null:v.sibling=null;break;case"collapsed":v=f.tail;for(var w=null;v!==null;)v.alternate!==null&&(w=v),v=v.sibling;w===null?m||f.tail===null?f.tail=null:f.tail.sibling=null:w.sibling=null}}function Un(f){var m=f.alternate!==null&&f.alternate.child===f.child,v=0,w=0;if(m)for(var I=f.child;I!==null;)v|=I.lanes|I.childLanes,w|=I.subtreeFlags&65011712,w|=I.flags&65011712,I.return=f,I=I.sibling;else for(I=f.child;I!==null;)v|=I.lanes|I.childLanes,w|=I.subtreeFlags,w|=I.flags,I.return=f,I=I.sibling;return f.subtreeFlags|=w,f.childLanes=v,m}function N5(f,m,v){var w=m.pendingProps;switch(_w(m),m.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Un(m),null;case 1:return Un(m),null;case 3:return v=m.stateNode,w=null,f!==null&&(w=f.memoizedState.cache),m.memoizedState.cache!==w&&(m.flags|=2048),ks(Cr),Ft(),v.pendingContext&&(v.context=v.pendingContext,v.pendingContext=null),(f===null||f.child===null)&&(Wd(m)?Ns(m):f===null||f.memoizedState.isDehydrated&&(m.flags&256)===0||(m.flags|=1024,wA())),Un(m),null;case 26:return v=m.memoizedState,f===null?(Ns(m),v!==null?(Un(m),V_(m,v)):(Un(m),m.flags&=-16777217)):v?v!==f.memoizedState?(Ns(m),Un(m),V_(m,v)):(Un(m),m.flags&=-16777217):(f.memoizedProps!==w&&Ns(m),Un(m),m.flags&=-16777217),null;case 27:Pt(m),v=pt.current;var I=m.type;if(f!==null&&m.stateNode!=null)f.memoizedProps!==w&&Ns(m);else{if(!w){if(m.stateNode===null)throw Error(r(166));return Un(m),null}f=rt.current,Wd(m)?yA(m):(f=VD(I,w,v),m.stateNode=f,Ns(m))}return Un(m),null;case 5:if(Pt(m),v=m.type,f!==null&&m.stateNode!=null)f.memoizedProps!==w&&Ns(m);else{if(!w){if(m.stateNode===null)throw Error(r(166));return Un(m),null}if(f=rt.current,Wd(m))yA(m);else{switch(I=fx(pt.current),f){case 1:f=I.createElementNS("http://www.w3.org/2000/svg",v);break;case 2:f=I.createElementNS("http://www.w3.org/1998/Math/MathML",v);break;default:switch(v){case"svg":f=I.createElementNS("http://www.w3.org/2000/svg",v);break;case"math":f=I.createElementNS("http://www.w3.org/1998/Math/MathML",v);break;case"script":f=I.createElement("div"),f.innerHTML="<script><\/script>",f=f.removeChild(f.firstChild);break;case"select":f=typeof w.is=="string"?I.createElement("select",{is:w.is}):I.createElement("select"),w.multiple?f.multiple=!0:w.size&&(f.size=w.size);break;default:f=typeof w.is=="string"?I.createElement(v,{is:w.is}):I.createElement(v)}}f[io]=m,f[Fo]=w;t:for(I=m.child;I!==null;){if(I.tag===5||I.tag===6)f.appendChild(I.stateNode);else if(I.tag!==4&&I.tag!==27&&I.child!==null){I.child.return=I,I=I.child;continue}if(I===m)break t;for(;I.sibling===null;){if(I.return===null||I.return===m)break t;I=I.return}I.sibling.return=I.return,I=I.sibling}m.stateNode=f;t:switch(Xr(f,v,w),v){case"button":case"input":case"select":case"textarea":f=!!w.autoFocus;break t;case"img":f=!0;break t;default:f=!1}f&&Ns(m)}}return Un(m),m.flags&=-16777217,null;case 6:if(f&&m.stateNode!=null)f.memoizedProps!==w&&Ns(m);else{if(typeof w!="string"&&m.stateNode===null)throw Error(r(166));if(f=pt.current,Wd(m)){if(f=m.stateNode,v=m.memoizedProps,w=null,I=Eo,I!==null)switch(I.tag){case 27:case 5:w=I.memoizedProps}f[io]=m,f=!!(f.nodeValue===v||w!==null&&w.suppressHydrationWarning===!0||MD(f.nodeValue,v)),f||zl(m)}else f=fx(f).createTextNode(w),f[io]=m,m.stateNode=f}return Un(m),null;case 13:if(w=m.memoizedState,f===null||f.memoizedState!==null&&f.memoizedState.dehydrated!==null){if(I=Wd(m),w!==null&&w.dehydrated!==null){if(f===null){if(!I)throw Error(r(318));if(I=m.memoizedState,I=I!==null?I.dehydrated:null,!I)throw Error(r(317));I[io]=m}else Vd(),(m.flags&128)===0&&(m.memoizedState=null),m.flags|=4;Un(m),I=!1}else I=wA(),f!==null&&f.memoizedState!==null&&(f.memoizedState.hydrationErrors=I),I=!0;if(!I)return m.flags&256?(Rs(m),m):(Rs(m),null)}if(Rs(m),(m.flags&128)!==0)return m.lanes=v,m;if(v=w!==null,f=f!==null&&f.memoizedState!==null,v){w=m.child,I=null,w.alternate!==null&&w.alternate.memoizedState!==null&&w.alternate.memoizedState.cachePool!==null&&(I=w.alternate.memoizedState.cachePool.pool);var T=null;w.memoizedState!==null&&w.memoizedState.cachePool!==null&&(T=w.memoizedState.cachePool.pool),T!==I&&(w.flags|=2048)}return v!==f&&v&&(m.child.flags|=8192),Jv(m,m.updateQueue),Un(m),null;case 4:return Ft(),f===null&&V2(m.stateNode.containerInfo),Un(m),null;case 10:return ks(m.type),Un(m),null;case 19:if(Q(Sr),I=m.memoizedState,I===null)return Un(m),null;if(w=(m.flags&128)!==0,T=I.rendering,T===null)if(w)ap(I,!1);else{if(qn!==0||f!==null&&(f.flags&128)!==0)for(f=m.child;f!==null;){if(T=Xv(f),T!==null){for(m.flags|=128,ap(I,!1),f=T.updateQueue,m.updateQueue=f,Jv(m,f),m.subtreeFlags=0,f=v,v=m.child;v!==null;)vA(v,f),v=v.sibling;return Z(Sr,Sr.current&1|2),m.child}f=f.sibling}I.tail!==null&&ge()>nx&&(m.flags|=128,w=!0,ap(I,!1),m.lanes=4194304)}else{if(!w)if(f=Xv(T),f!==null){if(m.flags|=128,w=!0,f=f.updateQueue,m.updateQueue=f,Jv(m,f),ap(I,!0),I.tail===null&&I.tailMode==="hidden"&&!T.alternate&&!rn)return Un(m),null}else 2*ge()-I.renderingStartTime>nx&&v!==536870912&&(m.flags|=128,w=!0,ap(I,!1),m.lanes=4194304);I.isBackwards?(T.sibling=m.child,m.child=T):(f=I.last,f!==null?f.sibling=T:m.child=T,I.last=T)}return I.tail!==null?(m=I.tail,I.rendering=m,I.tail=m.sibling,I.renderingStartTime=ge(),m.sibling=null,f=Sr.current,Z(Sr,w?f&1|2:f&1),m):(Un(m),null);case 22:case 23:return Rs(m),Hw(),w=m.memoizedState!==null,f!==null?f.memoizedState!==null!==w&&(m.flags|=8192):w&&(m.flags|=8192),w?(v&536870912)!==0&&(m.flags&128)===0&&(Un(m),m.subtreeFlags&6&&(m.flags|=8192)):Un(m),v=m.updateQueue,v!==null&&Jv(m,v.retryQueue),v=null,f!==null&&f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(v=f.memoizedState.cachePool.pool),w=null,m.memoizedState!==null&&m.memoizedState.cachePool!==null&&(w=m.memoizedState.cachePool.pool),w!==v&&(m.flags|=2048),f!==null&&Q(Vl),null;case 24:return v=null,f!==null&&(v=f.memoizedState.cache),m.memoizedState.cache!==v&&(m.flags|=2048),ks(Cr),Un(m),null;case 25:return null;case 30:return null}throw Error(r(156,m.tag))}function A5(f,m){switch(_w(m),m.tag){case 1:return f=m.flags,f&65536?(m.flags=f&-65537|128,m):null;case 3:return ks(Cr),Ft(),f=m.flags,(f&65536)!==0&&(f&128)===0?(m.flags=f&-65537|128,m):null;case 26:case 27:case 5:return Pt(m),null;case 13:if(Rs(m),f=m.memoizedState,f!==null&&f.dehydrated!==null){if(m.alternate===null)throw Error(r(340));Vd()}return f=m.flags,f&65536?(m.flags=f&-65537|128,m):null;case 19:return Q(Sr),null;case 4:return Ft(),null;case 10:return ks(m.type),null;case 22:case 23:return Rs(m),Hw(),f!==null&&Q(Vl),f=m.flags,f&65536?(m.flags=f&-65537|128,m):null;case 24:return ks(Cr),null;case 25:return null;default:return null}}function G_(f,m){switch(_w(m),m.tag){case 3:ks(Cr),Ft();break;case 26:case 27:case 5:Pt(m);break;case 4:Ft();break;case 13:Rs(m);break;case 19:Q(Sr);break;case 10:ks(m.type);break;case 22:case 23:Rs(m),Hw(),f!==null&&Q(Vl);break;case 24:ks(Cr)}}function ip(f,m){try{var v=m.updateQueue,w=v!==null?v.lastEffect:null;if(w!==null){var I=w.next;v=I;do{if((v.tag&f)===f){w=void 0;var T=v.create,L=v.inst;w=T(),L.destroy=w}v=v.next}while(v!==I)}}catch(V){Sn(m,m.return,V)}}function Su(f,m,v){try{var w=m.updateQueue,I=w!==null?w.lastEffect:null;if(I!==null){var T=I.next;w=T;do{if((w.tag&f)===f){var L=w.inst,V=L.destroy;if(V!==void 0){L.destroy=void 0,I=m;var tt=v,vt=V;try{vt()}catch(At){Sn(I,tt,At)}}}w=w.next}while(w!==T)}}catch(At){Sn(m,m.return,At)}}function H_(f){var m=f.updateQueue;if(m!==null){var v=f.stateNode;try{DA(m,v)}catch(w){Sn(f,f.return,w)}}}function q_(f,m,v){v.props=Hl(f.type,f.memoizedProps),v.state=f.memoizedState;try{v.componentWillUnmount()}catch(w){Sn(f,m,w)}}function sp(f,m){try{var v=f.ref;if(v!==null){switch(f.tag){case 26:case 27:case 5:var w=f.stateNode;break;case 30:w=f.stateNode;break;default:w=f.stateNode}typeof v=="function"?f.refCleanup=v(w):v.current=w}}catch(I){Sn(f,m,I)}}function Ti(f,m){var v=f.ref,w=f.refCleanup;if(v!==null)if(typeof w=="function")try{w()}catch(I){Sn(f,m,I)}finally{f.refCleanup=null,f=f.alternate,f!=null&&(f.refCleanup=null)}else if(typeof v=="function")try{v(null)}catch(I){Sn(f,m,I)}else v.current=null}function j_(f){var m=f.type,v=f.memoizedProps,w=f.stateNode;try{t:switch(m){case"button":case"input":case"select":case"textarea":v.autoFocus&&w.focus();break t;case"img":v.src?w.src=v.src:v.srcSet&&(w.srcset=v.srcSet)}}catch(I){Sn(f,f.return,I)}}function y2(f,m,v){try{var w=f.stateNode;Q5(w,f.type,v,m),w[Fo]=m}catch(I){Sn(f,f.return,I)}}function X_(f){return f.tag===5||f.tag===3||f.tag===26||f.tag===27&&_u(f.type)||f.tag===4}function b2(f){t:for(;;){for(;f.sibling===null;){if(f.return===null||X_(f.return))return null;f=f.return}for(f.sibling.return=f.return,f=f.sibling;f.tag!==5&&f.tag!==6&&f.tag!==18;){if(f.tag===27&&_u(f.type)||f.flags&2||f.child===null||f.tag===4)continue t;f.child.return=f,f=f.child}if(!(f.flags&2))return f.stateNode}}function w2(f,m,v){var w=f.tag;if(w===5||w===6)f=f.stateNode,m?(v.nodeType===9?v.body:v.nodeName==="HTML"?v.ownerDocument.body:v).insertBefore(f,m):(m=v.nodeType===9?v.body:v.nodeName==="HTML"?v.ownerDocument.body:v,m.appendChild(f),v=v._reactRootContainer,v!=null||m.onclick!==null||(m.onclick=hx));else if(w!==4&&(w===27&&_u(f.type)&&(v=f.stateNode,m=null),f=f.child,f!==null))for(w2(f,m,v),f=f.sibling;f!==null;)w2(f,m,v),f=f.sibling}function tx(f,m,v){var w=f.tag;if(w===5||w===6)f=f.stateNode,m?v.insertBefore(f,m):v.appendChild(f);else if(w!==4&&(w===27&&_u(f.type)&&(v=f.stateNode),f=f.child,f!==null))for(tx(f,m,v),f=f.sibling;f!==null;)tx(f,m,v),f=f.sibling}function K_(f){var m=f.stateNode,v=f.memoizedProps;try{for(var w=f.type,I=m.attributes;I.length;)m.removeAttributeNode(I[0]);Xr(m,w,v),m[io]=f,m[Fo]=v}catch(T){Sn(f,f.return,T)}}var As=!1,ar=!1,C2=!1,Y_=typeof WeakSet=="function"?WeakSet:Set,Fr=null;function _5(f,m){if(f=f.containerInfo,q2=xx,f=sA(f),bw(f)){if("selectionStart"in f)var v={start:f.selectionStart,end:f.selectionEnd};else t:{v=(v=f.ownerDocument)&&v.defaultView||window;var w=v.getSelection&&v.getSelection();if(w&&w.rangeCount!==0){v=w.anchorNode;var I=w.anchorOffset,T=w.focusNode;w=w.focusOffset;try{v.nodeType,T.nodeType}catch{v=null;break t}var L=0,V=-1,tt=-1,vt=0,At=0,$t=f,xt=null;e:for(;;){for(var bt;$t!==v||I!==0&&$t.nodeType!==3||(V=L+I),$t!==T||w!==0&&$t.nodeType!==3||(tt=L+w),$t.nodeType===3&&(L+=$t.nodeValue.length),(bt=$t.firstChild)!==null;)xt=$t,$t=bt;for(;;){if($t===f)break e;if(xt===v&&++vt===I&&(V=L),xt===T&&++At===w&&(tt=L),(bt=$t.nextSibling)!==null)break;$t=xt,xt=$t.parentNode}$t=bt}v=V===-1||tt===-1?null:{start:V,end:tt}}else v=null}v=v||{start:0,end:0}}else v=null;for(j2={focusedElem:f,selectionRange:v},xx=!1,Fr=m;Fr!==null;)if(m=Fr,f=m.child,(m.subtreeFlags&1024)!==0&&f!==null)f.return=m,Fr=f;else for(;Fr!==null;){switch(m=Fr,T=m.alternate,f=m.flags,m.tag){case 0:break;case 11:case 15:break;case 1:if((f&1024)!==0&&T!==null){f=void 0,v=m,I=T.memoizedProps,T=T.memoizedState,w=v.stateNode;try{var ye=Hl(v.type,I,v.elementType===v.type);f=w.getSnapshotBeforeUpdate(ye,T),w.__reactInternalSnapshotBeforeUpdate=f}catch(pe){Sn(v,v.return,pe)}}break;case 3:if((f&1024)!==0){if(f=m.stateNode.containerInfo,v=f.nodeType,v===9)Y2(f);else if(v===1)switch(f.nodeName){case"HEAD":case"HTML":case"BODY":Y2(f);break;default:f.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((f&1024)!==0)throw Error(r(163))}if(f=m.sibling,f!==null){f.return=m.return,Fr=f;break}Fr=m.return}}function Q_(f,m,v){var w=v.flags;switch(v.tag){case 0:case 11:case 15:Eu(f,v),w&4&&ip(5,v);break;case 1:if(Eu(f,v),w&4)if(f=v.stateNode,m===null)try{f.componentDidMount()}catch(L){Sn(v,v.return,L)}else{var I=Hl(v.type,m.memoizedProps);m=m.memoizedState;try{f.componentDidUpdate(I,m,f.__reactInternalSnapshotBeforeUpdate)}catch(L){Sn(v,v.return,L)}}w&64&&H_(v),w&512&&sp(v,v.return);break;case 3:if(Eu(f,v),w&64&&(f=v.updateQueue,f!==null)){if(m=null,v.child!==null)switch(v.child.tag){case 27:case 5:m=v.child.stateNode;break;case 1:m=v.child.stateNode}try{DA(f,m)}catch(L){Sn(v,v.return,L)}}break;case 27:m===null&&w&4&&K_(v);case 26:case 5:Eu(f,v),m===null&&w&4&&j_(v),w&512&&sp(v,v.return);break;case 12:Eu(f,v);break;case 13:Eu(f,v),w&4&&tD(f,v),w&64&&(f=v.memoizedState,f!==null&&(f=f.dehydrated,f!==null&&(v=z5.bind(null,v),oj(f,v))));break;case 22:if(w=v.memoizedState!==null||As,!w){m=m!==null&&m.memoizedState!==null||ar,I=As;var T=ar;As=w,(ar=m)&&!T?ku(f,v,(v.subtreeFlags&8772)!==0):Eu(f,v),As=I,ar=T}break;case 30:break;default:Eu(f,v)}}function Z_(f){var m=f.alternate;m!==null&&(f.alternate=null,Z_(m)),f.child=null,f.deletions=null,f.sibling=null,f.tag===5&&(m=f.stateNode,m!==null&&ew(m)),f.stateNode=null,f.return=null,f.dependencies=null,f.memoizedProps=null,f.memoizedState=null,f.pendingProps=null,f.stateNode=null,f.updateQueue=null}var Mn=null,Po=!1;function _s(f,m,v){for(v=v.child;v!==null;)J_(f,m,v),v=v.sibling}function J_(f,m,v){if(Ge&&typeof Ge.onCommitFiberUnmount=="function")try{Ge.onCommitFiberUnmount(cr,v)}catch{}switch(v.tag){case 26:ar||Ti(v,m),_s(f,m,v),v.memoizedState?v.memoizedState.count--:v.stateNode&&(v=v.stateNode,v.parentNode.removeChild(v));break;case 27:ar||Ti(v,m);var w=Mn,I=Po;_u(v.type)&&(Mn=v.stateNode,Po=!1),_s(f,m,v),gp(v.stateNode),Mn=w,Po=I;break;case 5:ar||Ti(v,m);case 6:if(w=Mn,I=Po,Mn=null,_s(f,m,v),Mn=w,Po=I,Mn!==null)if(Po)try{(Mn.nodeType===9?Mn.body:Mn.nodeName==="HTML"?Mn.ownerDocument.body:Mn).removeChild(v.stateNode)}catch(T){Sn(v,m,T)}else try{Mn.removeChild(v.stateNode)}catch(T){Sn(v,m,T)}break;case 18:Mn!==null&&(Po?(f=Mn,UD(f.nodeType===9?f.body:f.nodeName==="HTML"?f.ownerDocument.body:f,v.stateNode),Ep(f)):UD(Mn,v.stateNode));break;case 4:w=Mn,I=Po,Mn=v.stateNode.containerInfo,Po=!0,_s(f,m,v),Mn=w,Po=I;break;case 0:case 11:case 14:case 15:ar||Su(2,v,m),ar||Su(4,v,m),_s(f,m,v);break;case 1:ar||(Ti(v,m),w=v.stateNode,typeof w.componentWillUnmount=="function"&&q_(v,m,w)),_s(f,m,v);break;case 21:_s(f,m,v);break;case 22:ar=(w=ar)||v.memoizedState!==null,_s(f,m,v),ar=w;break;default:_s(f,m,v)}}function tD(f,m){if(m.memoizedState===null&&(f=m.alternate,f!==null&&(f=f.memoizedState,f!==null&&(f=f.dehydrated,f!==null))))try{Ep(f)}catch(v){Sn(m,m.return,v)}}function D5(f){switch(f.tag){case 13:case 19:var m=f.stateNode;return m===null&&(m=f.stateNode=new Y_),m;case 22:return f=f.stateNode,m=f._retryCache,m===null&&(m=f._retryCache=new Y_),m;default:throw Error(r(435,f.tag))}}function S2(f,m){var v=D5(f);m.forEach(function(w){var I=U5.bind(null,f,w);v.has(w)||(v.add(w),w.then(I,I))})}function ra(f,m){var v=m.deletions;if(v!==null)for(var w=0;w<v.length;w++){var I=v[w],T=f,L=m,V=L;t:for(;V!==null;){switch(V.tag){case 27:if(_u(V.type)){Mn=V.stateNode,Po=!1;break t}break;case 5:Mn=V.stateNode,Po=!1;break t;case 3:case 4:Mn=V.stateNode.containerInfo,Po=!0;break t}V=V.return}if(Mn===null)throw Error(r(160));J_(T,L,I),Mn=null,Po=!1,T=I.alternate,T!==null&&(T.return=null),I.return=null}if(m.subtreeFlags&13878)for(m=m.child;m!==null;)eD(m,f),m=m.sibling}var ti=null;function eD(f,m){var v=f.alternate,w=f.flags;switch(f.tag){case 0:case 11:case 14:case 15:ra(m,f),oa(f),w&4&&(Su(3,f,f.return),ip(3,f),Su(5,f,f.return));break;case 1:ra(m,f),oa(f),w&512&&(ar||v===null||Ti(v,v.return)),w&64&&As&&(f=f.updateQueue,f!==null&&(w=f.callbacks,w!==null&&(v=f.shared.hiddenCallbacks,f.shared.hiddenCallbacks=v===null?w:v.concat(w))));break;case 26:var I=ti;if(ra(m,f),oa(f),w&512&&(ar||v===null||Ti(v,v.return)),w&4){var T=v!==null?v.memoizedState:null;if(w=f.memoizedState,v===null)if(w===null)if(f.stateNode===null){t:{w=f.type,v=f.memoizedProps,I=I.ownerDocument||I;e:switch(w){case"title":T=I.getElementsByTagName("title")[0],(!T||T[_d]||T[io]||T.namespaceURI==="http://www.w3.org/2000/svg"||T.hasAttribute("itemprop"))&&(T=I.createElement(w),I.head.insertBefore(T,I.querySelector("head > title"))),Xr(T,w,v),T[io]=f,$r(T),w=T;break t;case"link":var L=KD("link","href",I).get(w+(v.href||""));if(L){for(var V=0;V<L.length;V++)if(T=L[V],T.getAttribute("href")===(v.href==null||v.href===""?null:v.href)&&T.getAttribute("rel")===(v.rel==null?null:v.rel)&&T.getAttribute("title")===(v.title==null?null:v.title)&&T.getAttribute("crossorigin")===(v.crossOrigin==null?null:v.crossOrigin)){L.splice(V,1);break e}}T=I.createElement(w),Xr(T,w,v),I.head.appendChild(T);break;case"meta":if(L=KD("meta","content",I).get(w+(v.content||""))){for(V=0;V<L.length;V++)if(T=L[V],T.getAttribute("content")===(v.content==null?null:""+v.content)&&T.getAttribute("name")===(v.name==null?null:v.name)&&T.getAttribute("property")===(v.property==null?null:v.property)&&T.getAttribute("http-equiv")===(v.httpEquiv==null?null:v.httpEquiv)&&T.getAttribute("charset")===(v.charSet==null?null:v.charSet)){L.splice(V,1);break e}}T=I.createElement(w),Xr(T,w,v),I.head.appendChild(T);break;default:throw Error(r(468,w))}T[io]=f,$r(T),w=T}f.stateNode=w}else YD(I,f.type,f.stateNode);else f.stateNode=XD(I,w,f.memoizedProps);else T!==w?(T===null?v.stateNode!==null&&(v=v.stateNode,v.parentNode.removeChild(v)):T.count--,w===null?YD(I,f.type,f.stateNode):XD(I,w,f.memoizedProps)):w===null&&f.stateNode!==null&&y2(f,f.memoizedProps,v.memoizedProps)}break;case 27:ra(m,f),oa(f),w&512&&(ar||v===null||Ti(v,v.return)),v!==null&&w&4&&y2(f,f.memoizedProps,v.memoizedProps);break;case 5:if(ra(m,f),oa(f),w&512&&(ar||v===null||Ti(v,v.return)),f.flags&32){I=f.stateNode;try{vh(I,"")}catch(bt){Sn(f,f.return,bt)}}w&4&&f.stateNode!=null&&(I=f.memoizedProps,y2(f,I,v!==null?v.memoizedProps:I)),w&1024&&(C2=!0);break;case 6:if(ra(m,f),oa(f),w&4){if(f.stateNode===null)throw Error(r(162));w=f.memoizedProps,v=f.stateNode;try{v.nodeValue=w}catch(bt){Sn(f,f.return,bt)}}break;case 3:if(mx=null,I=ti,ti=dx(m.containerInfo),ra(m,f),ti=I,oa(f),w&4&&v!==null&&v.memoizedState.isDehydrated)try{Ep(m.containerInfo)}catch(bt){Sn(f,f.return,bt)}C2&&(C2=!1,nD(f));break;case 4:w=ti,ti=dx(f.stateNode.containerInfo),ra(m,f),oa(f),ti=w;break;case 12:ra(m,f),oa(f);break;case 13:ra(m,f),oa(f),f.child.flags&8192&&f.memoizedState!==null!=(v!==null&&v.memoizedState!==null)&&(N2=ge()),w&4&&(w=f.updateQueue,w!==null&&(f.updateQueue=null,S2(f,w)));break;case 22:I=f.memoizedState!==null;var tt=v!==null&&v.memoizedState!==null,vt=As,At=ar;if(As=vt||I,ar=At||tt,ra(m,f),ar=At,As=vt,oa(f),w&8192)t:for(m=f.stateNode,m._visibility=I?m._visibility&-2:m._visibility|1,I&&(v===null||tt||As||ar||ql(f)),v=null,m=f;;){if(m.tag===5||m.tag===26){if(v===null){tt=v=m;try{if(T=tt.stateNode,I)L=T.style,typeof L.setProperty=="function"?L.setProperty("display","none","important"):L.display="none";else{V=tt.stateNode;var $t=tt.memoizedProps.style,xt=$t!=null&&$t.hasOwnProperty("display")?$t.display:null;V.style.display=xt==null||typeof xt=="boolean"?"":(""+xt).trim()}}catch(bt){Sn(tt,tt.return,bt)}}}else if(m.tag===6){if(v===null){tt=m;try{tt.stateNode.nodeValue=I?"":tt.memoizedProps}catch(bt){Sn(tt,tt.return,bt)}}}else if((m.tag!==22&&m.tag!==23||m.memoizedState===null||m===f)&&m.child!==null){m.child.return=m,m=m.child;continue}if(m===f)break t;for(;m.sibling===null;){if(m.return===null||m.return===f)break t;v===m&&(v=null),m=m.return}v===m&&(v=null),m.sibling.return=m.return,m=m.sibling}w&4&&(w=f.updateQueue,w!==null&&(v=w.retryQueue,v!==null&&(w.retryQueue=null,S2(f,v))));break;case 19:ra(m,f),oa(f),w&4&&(w=f.updateQueue,w!==null&&(f.updateQueue=null,S2(f,w)));break;case 30:break;case 21:break;default:ra(m,f),oa(f)}}function oa(f){var m=f.flags;if(m&2){try{for(var v,w=f.return;w!==null;){if(X_(w)){v=w;break}w=w.return}if(v==null)throw Error(r(160));switch(v.tag){case 27:var I=v.stateNode,T=b2(f);tx(f,T,I);break;case 5:var L=v.stateNode;v.flags&32&&(vh(L,""),v.flags&=-33);var V=b2(f);tx(f,V,L);break;case 3:case 4:var tt=v.stateNode.containerInfo,vt=b2(f);w2(f,vt,tt);break;default:throw Error(r(161))}}catch(At){Sn(f,f.return,At)}f.flags&=-3}m&4096&&(f.flags&=-4097)}function nD(f){if(f.subtreeFlags&1024)for(f=f.child;f!==null;){var m=f;nD(m),m.tag===5&&m.flags&1024&&m.stateNode.reset(),f=f.sibling}}function Eu(f,m){if(m.subtreeFlags&8772)for(m=m.child;m!==null;)Q_(f,m.alternate,m),m=m.sibling}function ql(f){for(f=f.child;f!==null;){var m=f;switch(m.tag){case 0:case 11:case 14:case 15:Su(4,m,m.return),ql(m);break;case 1:Ti(m,m.return);var v=m.stateNode;typeof v.componentWillUnmount=="function"&&q_(m,m.return,v),ql(m);break;case 27:gp(m.stateNode);case 26:case 5:Ti(m,m.return),ql(m);break;case 22:m.memoizedState===null&&ql(m);break;case 30:ql(m);break;default:ql(m)}f=f.sibling}}function ku(f,m,v){for(v=v&&(m.subtreeFlags&8772)!==0,m=m.child;m!==null;){var w=m.alternate,I=f,T=m,L=T.flags;switch(T.tag){case 0:case 11:case 15:ku(I,T,v),ip(4,T);break;case 1:if(ku(I,T,v),w=T,I=w.stateNode,typeof I.componentDidMount=="function")try{I.componentDidMount()}catch(vt){Sn(w,w.return,vt)}if(w=T,I=w.updateQueue,I!==null){var V=w.stateNode;try{var tt=I.shared.hiddenCallbacks;if(tt!==null)for(I.shared.hiddenCallbacks=null,I=0;I<tt.length;I++)_A(tt[I],V)}catch(vt){Sn(w,w.return,vt)}}v&&L&64&&H_(T),sp(T,T.return);break;case 27:K_(T);case 26:case 5:ku(I,T,v),v&&w===null&&L&4&&j_(T),sp(T,T.return);break;case 12:ku(I,T,v);break;case 13:ku(I,T,v),v&&L&4&&tD(I,T);break;case 22:T.memoizedState===null&&ku(I,T,v),sp(T,T.return);break;case 30:break;default:ku(I,T,v)}m=m.sibling}}function E2(f,m){var v=null;f!==null&&f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(v=f.memoizedState.cachePool.pool),f=null,m.memoizedState!==null&&m.memoizedState.cachePool!==null&&(f=m.memoizedState.cachePool.pool),f!==v&&(f!=null&&f.refCount++,v!=null&&qd(v))}function k2(f,m){f=null,m.alternate!==null&&(f=m.alternate.memoizedState.cache),m=m.memoizedState.cache,m!==f&&(m.refCount++,f!=null&&qd(f))}function Ni(f,m,v,w){if(m.subtreeFlags&10256)for(m=m.child;m!==null;)rD(f,m,v,w),m=m.sibling}function rD(f,m,v,w){var I=m.flags;switch(m.tag){case 0:case 11:case 15:Ni(f,m,v,w),I&2048&&ip(9,m);break;case 1:Ni(f,m,v,w);break;case 3:Ni(f,m,v,w),I&2048&&(f=null,m.alternate!==null&&(f=m.alternate.memoizedState.cache),m=m.memoizedState.cache,m!==f&&(m.refCount++,f!=null&&qd(f)));break;case 12:if(I&2048){Ni(f,m,v,w),f=m.stateNode;try{var T=m.memoizedProps,L=T.id,V=T.onPostCommit;typeof V=="function"&&V(L,m.alternate===null?"mount":"update",f.passiveEffectDuration,-0)}catch(tt){Sn(m,m.return,tt)}}else Ni(f,m,v,w);break;case 13:Ni(f,m,v,w);break;case 23:break;case 22:T=m.stateNode,L=m.alternate,m.memoizedState!==null?T._visibility&2?Ni(f,m,v,w):up(f,m):T._visibility&2?Ni(f,m,v,w):(T._visibility|=2,Mh(f,m,v,w,(m.subtreeFlags&10256)!==0)),I&2048&&E2(L,m);break;case 24:Ni(f,m,v,w),I&2048&&k2(m.alternate,m);break;default:Ni(f,m,v,w)}}function Mh(f,m,v,w,I){for(I=I&&(m.subtreeFlags&10256)!==0,m=m.child;m!==null;){var T=f,L=m,V=v,tt=w,vt=L.flags;switch(L.tag){case 0:case 11:case 15:Mh(T,L,V,tt,I),ip(8,L);break;case 23:break;case 22:var At=L.stateNode;L.memoizedState!==null?At._visibility&2?Mh(T,L,V,tt,I):up(T,L):(At._visibility|=2,Mh(T,L,V,tt,I)),I&&vt&2048&&E2(L.alternate,L);break;case 24:Mh(T,L,V,tt,I),I&&vt&2048&&k2(L.alternate,L);break;default:Mh(T,L,V,tt,I)}m=m.sibling}}function up(f,m){if(m.subtreeFlags&10256)for(m=m.child;m!==null;){var v=f,w=m,I=w.flags;switch(w.tag){case 22:up(v,w),I&2048&&E2(w.alternate,w);break;case 24:up(v,w),I&2048&&k2(w.alternate,w);break;default:up(v,w)}m=m.sibling}}var lp=8192;function Lh(f){if(f.subtreeFlags&lp)for(f=f.child;f!==null;)oD(f),f=f.sibling}function oD(f){switch(f.tag){case 26:Lh(f),f.flags&lp&&f.memoizedState!==null&&vj(ti,f.memoizedState,f.memoizedProps);break;case 5:Lh(f);break;case 3:case 4:var m=ti;ti=dx(f.stateNode.containerInfo),Lh(f),ti=m;break;case 22:f.memoizedState===null&&(m=f.alternate,m!==null&&m.memoizedState!==null?(m=lp,lp=16777216,Lh(f),lp=m):Lh(f));break;default:Lh(f)}}function aD(f){var m=f.alternate;if(m!==null&&(f=m.child,f!==null)){m.child=null;do m=f.sibling,f.sibling=null,f=m;while(f!==null)}}function cp(f){var m=f.deletions;if((f.flags&16)!==0){if(m!==null)for(var v=0;v<m.length;v++){var w=m[v];Fr=w,sD(w,f)}aD(f)}if(f.subtreeFlags&10256)for(f=f.child;f!==null;)iD(f),f=f.sibling}function iD(f){switch(f.tag){case 0:case 11:case 15:cp(f),f.flags&2048&&Su(9,f,f.return);break;case 3:cp(f);break;case 12:cp(f);break;case 22:var m=f.stateNode;f.memoizedState!==null&&m._visibility&2&&(f.return===null||f.return.tag!==13)?(m._visibility&=-3,ex(f)):cp(f);break;default:cp(f)}}function ex(f){var m=f.deletions;if((f.flags&16)!==0){if(m!==null)for(var v=0;v<m.length;v++){var w=m[v];Fr=w,sD(w,f)}aD(f)}for(f=f.child;f!==null;){switch(m=f,m.tag){case 0:case 11:case 15:Su(8,m,m.return),ex(m);break;case 22:v=m.stateNode,v._visibility&2&&(v._visibility&=-3,ex(m));break;default:ex(m)}f=f.sibling}}function sD(f,m){for(;Fr!==null;){var v=Fr;switch(v.tag){case 0:case 11:case 15:Su(8,v,m);break;case 23:case 22:if(v.memoizedState!==null&&v.memoizedState.cachePool!==null){var w=v.memoizedState.cachePool.pool;w!=null&&w.refCount++}break;case 24:qd(v.memoizedState.cache)}if(w=v.child,w!==null)w.return=v,Fr=w;else t:for(v=f;Fr!==null;){w=Fr;var I=w.sibling,T=w.return;if(Z_(w),w===v){Fr=null;break t}if(I!==null){I.return=T,Fr=I;break t}Fr=T}}}var $5={getCacheForType:function(f){var m=so(Cr),v=m.data.get(f);return v===void 0&&(v=f(),m.data.set(f,v)),v}},O5=typeof WeakMap=="function"?WeakMap:Map,fn=0,Rn=null,Me=null,He=0,dn=0,aa=null,Iu=!1,Ph=!1,I2=!1,Ds=0,qn=0,Ru=0,jl=0,R2=0,_a=0,Bh=0,hp=null,Bo=null,T2=!1,N2=0,nx=1/0,rx=null,Tu=null,jr=0,Nu=null,zh=null,Uh=0,A2=0,_2=null,uD=null,fp=0,D2=null;function ia(){if((fn&2)!==0&&He!==0)return He&-He;if(F.T!==null){var f=Th;return f!==0?f:B2()}return EN()}function lD(){_a===0&&(_a=(He&536870912)===0||rn?bN():536870912);var f=Aa.current;return f!==null&&(f.flags|=32),_a}function sa(f,m,v){(f===Rn&&(dn===2||dn===9)||f.cancelPendingCommit!==null)&&(Wh(f,0),Au(f,He,_a,!1)),Ad(f,v),((fn&2)===0||f!==Rn)&&(f===Rn&&((fn&2)===0&&(jl|=v),qn===4&&Au(f,He,_a,!1)),Ai(f))}function cD(f,m,v){if((fn&6)!==0)throw Error(r(327));var w=!v&&(m&124)===0&&(m&f.expiredLanes)===0||Nd(f,m),I=w?L5(f,m):F2(f,m,!0),T=w;do{if(I===0){Ph&&!w&&Au(f,m,0,!1);break}else{if(v=f.current.alternate,T&&!F5(v)){I=F2(f,m,!1),T=!1;continue}if(I===2){if(T=m,f.errorRecoveryDisabledLanes&T)var L=0;else L=f.pendingLanes&-536870913,L=L!==0?L:L&536870912?536870912:0;if(L!==0){m=L;t:{var V=f;I=hp;var tt=V.current.memoizedState.isDehydrated;if(tt&&(Wh(V,L).flags|=256),L=F2(V,L,!1),L!==2){if(I2&&!tt){V.errorRecoveryDisabledLanes|=T,jl|=T,I=4;break t}T=Bo,Bo=I,T!==null&&(Bo===null?Bo=T:Bo.push.apply(Bo,T))}I=L}if(T=!1,I!==2)continue}}if(I===1){Wh(f,0),Au(f,m,0,!0);break}t:{switch(w=f,T=I,T){case 0:case 1:throw Error(r(345));case 4:if((m&4194048)!==m)break;case 6:Au(w,m,_a,!Iu);break t;case 2:Bo=null;break;case 3:case 5:break;default:throw Error(r(329))}if((m&62914560)===m&&(I=N2+300-ge(),10<I)){if(Au(w,m,_a,!Iu),pv(w,0,!0)!==0)break t;w.timeoutHandle=BD(hD.bind(null,w,v,Bo,rx,T2,m,_a,jl,Bh,Iu,T,2,-0,0),I);break t}hD(w,v,Bo,rx,T2,m,_a,jl,Bh,Iu,T,0,-0,0)}}break}while(!0);Ai(f)}function hD(f,m,v,w,I,T,L,V,tt,vt,At,$t,xt,bt){if(f.timeoutHandle=-1,$t=m.subtreeFlags,($t&8192||($t&16785408)===16785408)&&(yp={stylesheets:null,count:0,unsuspend:gj},oD(m),$t=xj(),$t!==null)){f.cancelPendingCommit=$t(xD.bind(null,f,m,T,v,w,I,L,V,tt,At,1,xt,bt)),Au(f,T,L,!vt);return}xD(f,m,T,v,w,I,L,V,tt)}function F5(f){for(var m=f;;){var v=m.tag;if((v===0||v===11||v===15)&&m.flags&16384&&(v=m.updateQueue,v!==null&&(v=v.stores,v!==null)))for(var w=0;w<v.length;w++){var I=v[w],T=I.getSnapshot;I=I.value;try{if(!ea(T(),I))return!1}catch{return!1}}if(v=m.child,m.subtreeFlags&16384&&v!==null)v.return=m,m=v;else{if(m===f)break;for(;m.sibling===null;){if(m.return===null||m.return===f)return!0;m=m.return}m.sibling.return=m.return,m=m.sibling}}return!0}function Au(f,m,v,w){m&=~R2,m&=~jl,f.suspendedLanes|=m,f.pingedLanes&=~m,w&&(f.warmLanes|=m),w=f.expirationTimes;for(var I=m;0<I;){var T=31-zn(I),L=1<<T;w[T]=-1,I&=~L}v!==0&&CN(f,v,m)}function ox(){return(fn&6)===0?(dp(0),!1):!0}function $2(){if(Me!==null){if(dn===0)var f=Me.return;else f=Me,Es=Ul=null,Yw(f),Oh=null,rp=0,f=Me;for(;f!==null;)G_(f.alternate,f),f=f.return;Me=null}}function Wh(f,m){var v=f.timeoutHandle;v!==-1&&(f.timeoutHandle=-1,J5(v)),v=f.cancelPendingCommit,v!==null&&(f.cancelPendingCommit=null,v()),$2(),Rn=f,Me=v=ws(f.current,null),He=m,dn=0,aa=null,Iu=!1,Ph=Nd(f,m),I2=!1,Bh=_a=R2=jl=Ru=qn=0,Bo=hp=null,T2=!1,(m&8)!==0&&(m|=m&32);var w=f.entangledLanes;if(w!==0)for(f=f.entanglements,w&=m;0<w;){var I=31-zn(w),T=1<<I;m|=f[I],w&=~T}return Ds=m,Iv(),v}function fD(f,m){$e=null,F.H=Hv,m===Xd||m===Fv?(m=NA(),dn=3):m===IA?(m=NA(),dn=4):dn=m===A_?8:m!==null&&typeof m=="object"&&typeof m.then=="function"?6:1,aa=m,Me===null&&(qn=1,Yv(f,Ia(m,f.current)))}function dD(){var f=F.H;return F.H=Hv,f===null?Hv:f}function pD(){var f=F.A;return F.A=$5,f}function O2(){qn=4,Iu||(He&4194048)!==He&&Aa.current!==null||(Ph=!0),(Ru&134217727)===0&&(jl&134217727)===0||Rn===null||Au(Rn,He,_a,!1)}function F2(f,m,v){var w=fn;fn|=2;var I=dD(),T=pD();(Rn!==f||He!==m)&&(rx=null,Wh(f,m)),m=!1;var L=qn;t:do try{if(dn!==0&&Me!==null){var V=Me,tt=aa;switch(dn){case 8:$2(),L=6;break t;case 3:case 2:case 9:case 6:Aa.current===null&&(m=!0);var vt=dn;if(dn=0,aa=null,Vh(f,V,tt,vt),v&&Ph){L=0;break t}break;default:vt=dn,dn=0,aa=null,Vh(f,V,tt,vt)}}M5(),L=qn;break}catch(At){fD(f,At)}while(!0);return m&&f.shellSuspendCounter++,Es=Ul=null,fn=w,F.H=I,F.A=T,Me===null&&(Rn=null,He=0,Iv()),L}function M5(){for(;Me!==null;)mD(Me)}function L5(f,m){var v=fn;fn|=2;var w=dD(),I=pD();Rn!==f||He!==m?(rx=null,nx=ge()+500,Wh(f,m)):Ph=Nd(f,m);t:do try{if(dn!==0&&Me!==null){m=Me;var T=aa;e:switch(dn){case 1:dn=0,aa=null,Vh(f,m,T,1);break;case 2:case 9:if(RA(T)){dn=0,aa=null,gD(m);break}m=function(){dn!==2&&dn!==9||Rn!==f||(dn=7),Ai(f)},T.then(m,m);break t;case 3:dn=7;break t;case 4:dn=5;break t;case 7:RA(T)?(dn=0,aa=null,gD(m)):(dn=0,aa=null,Vh(f,m,T,7));break;case 5:var L=null;switch(Me.tag){case 26:L=Me.memoizedState;case 5:case 27:var V=Me;if(!L||QD(L)){dn=0,aa=null;var tt=V.sibling;if(tt!==null)Me=tt;else{var vt=V.return;vt!==null?(Me=vt,ax(vt)):Me=null}break e}}dn=0,aa=null,Vh(f,m,T,5);break;case 6:dn=0,aa=null,Vh(f,m,T,6);break;case 8:$2(),qn=6;break t;default:throw Error(r(462))}}P5();break}catch(At){fD(f,At)}while(!0);return Es=Ul=null,F.H=w,F.A=I,fn=v,Me!==null?0:(Rn=null,He=0,Iv(),qn)}function P5(){for(;Me!==null&&!te();)mD(Me)}function mD(f){var m=W_(f.alternate,f,Ds);f.memoizedProps=f.pendingProps,m===null?ax(f):Me=m}function gD(f){var m=f,v=m.alternate;switch(m.tag){case 15:case 0:m=M_(v,m,m.pendingProps,m.type,void 0,He);break;case 11:m=M_(v,m,m.pendingProps,m.type.render,m.ref,He);break;case 5:Yw(m);default:G_(v,m),m=Me=vA(m,Ds),m=W_(v,m,Ds)}f.memoizedProps=f.pendingProps,m===null?ax(f):Me=m}function Vh(f,m,v,w){Es=Ul=null,Yw(m),Oh=null,rp=0;var I=m.return;try{if(R5(f,I,m,v,He)){qn=1,Yv(f,Ia(v,f.current)),Me=null;return}}catch(T){if(I!==null)throw Me=I,T;qn=1,Yv(f,Ia(v,f.current)),Me=null;return}m.flags&32768?(rn||w===1?f=!0:Ph||(He&536870912)!==0?f=!1:(Iu=f=!0,(w===2||w===9||w===3||w===6)&&(w=Aa.current,w!==null&&w.tag===13&&(w.flags|=16384))),vD(m,f)):ax(m)}function ax(f){var m=f;do{if((m.flags&32768)!==0){vD(m,Iu);return}f=m.return;var v=N5(m.alternate,m,Ds);if(v!==null){Me=v;return}if(m=m.sibling,m!==null){Me=m;return}Me=m=f}while(m!==null);qn===0&&(qn=5)}function vD(f,m){do{var v=A5(f.alternate,f);if(v!==null){v.flags&=32767,Me=v;return}if(v=f.return,v!==null&&(v.flags|=32768,v.subtreeFlags=0,v.deletions=null),!m&&(f=f.sibling,f!==null)){Me=f;return}Me=f=v}while(f!==null);qn=6,Me=null}function xD(f,m,v,w,I,T,L,V,tt){f.cancelPendingCommit=null;do ix();while(jr!==0);if((fn&6)!==0)throw Error(r(327));if(m!==null){if(m===f.current)throw Error(r(177));if(T=m.lanes|m.childLanes,T|=kw,gq(f,v,T,L,V,tt),f===Rn&&(Me=Rn=null,He=0),zh=m,Nu=f,Uh=v,A2=T,_2=I,uD=w,(m.subtreeFlags&10256)!==0||(m.flags&10256)!==0?(f.callbackNode=null,f.callbackPriority=0,W5(un,function(){return SD(),null})):(f.callbackNode=null,f.callbackPriority=0),w=(m.flags&13878)!==0,(m.subtreeFlags&13878)!==0||w){w=F.T,F.T=null,I=B.p,B.p=2,L=fn,fn|=4;try{_5(f,m,v)}finally{fn=L,B.p=I,F.T=w}}jr=1,yD(),bD(),wD()}}function yD(){if(jr===1){jr=0;var f=Nu,m=zh,v=(m.flags&13878)!==0;if((m.subtreeFlags&13878)!==0||v){v=F.T,F.T=null;var w=B.p;B.p=2;var I=fn;fn|=4;try{eD(m,f);var T=j2,L=sA(f.containerInfo),V=T.focusedElem,tt=T.selectionRange;if(L!==V&&V&&V.ownerDocument&&iA(V.ownerDocument.documentElement,V)){if(tt!==null&&bw(V)){var vt=tt.start,At=tt.end;if(At===void 0&&(At=vt),"selectionStart"in V)V.selectionStart=vt,V.selectionEnd=Math.min(At,V.value.length);else{var $t=V.ownerDocument||document,xt=$t&&$t.defaultView||window;if(xt.getSelection){var bt=xt.getSelection(),ye=V.textContent.length,pe=Math.min(tt.start,ye),xn=tt.end===void 0?pe:Math.min(tt.end,ye);!bt.extend&&pe>xn&&(L=xn,xn=pe,pe=L);var dt=aA(V,pe),at=aA(V,xn);if(dt&&at&&(bt.rangeCount!==1||bt.anchorNode!==dt.node||bt.anchorOffset!==dt.offset||bt.focusNode!==at.node||bt.focusOffset!==at.offset)){var mt=$t.createRange();mt.setStart(dt.node,dt.offset),bt.removeAllRanges(),pe>xn?(bt.addRange(mt),bt.extend(at.node,at.offset)):(mt.setEnd(at.node,at.offset),bt.addRange(mt))}}}}for($t=[],bt=V;bt=bt.parentNode;)bt.nodeType===1&&$t.push({element:bt,left:bt.scrollLeft,top:bt.scrollTop});for(typeof V.focus=="function"&&V.focus(),V=0;V<$t.length;V++){var Dt=$t[V];Dt.element.scrollLeft=Dt.left,Dt.element.scrollTop=Dt.top}}xx=!!q2,j2=q2=null}finally{fn=I,B.p=w,F.T=v}}f.current=m,jr=2}}function bD(){if(jr===2){jr=0;var f=Nu,m=zh,v=(m.flags&8772)!==0;if((m.subtreeFlags&8772)!==0||v){v=F.T,F.T=null;var w=B.p;B.p=2;var I=fn;fn|=4;try{Q_(f,m.alternate,m)}finally{fn=I,B.p=w,F.T=v}}jr=3}}function wD(){if(jr===4||jr===3){jr=0,ne();var f=Nu,m=zh,v=Uh,w=uD;(m.subtreeFlags&10256)!==0||(m.flags&10256)!==0?jr=5:(jr=0,zh=Nu=null,CD(f,f.pendingLanes));var I=f.pendingLanes;if(I===0&&(Tu=null),Jb(v),m=m.stateNode,Ge&&typeof Ge.onCommitFiberRoot=="function")try{Ge.onCommitFiberRoot(cr,m,void 0,(m.current.flags&128)===128)}catch{}if(w!==null){m=F.T,I=B.p,B.p=2,F.T=null;try{for(var T=f.onRecoverableError,L=0;L<w.length;L++){var V=w[L];T(V.value,{componentStack:V.stack})}}finally{F.T=m,B.p=I}}(Uh&3)!==0&&ix(),Ai(f),I=f.pendingLanes,(v&4194090)!==0&&(I&42)!==0?f===D2?fp++:(fp=0,D2=f):fp=0,dp(0)}}function CD(f,m){(f.pooledCacheLanes&=m)===0&&(m=f.pooledCache,m!=null&&(f.pooledCache=null,qd(m)))}function ix(f){return yD(),bD(),wD(),SD()}function SD(){if(jr!==5)return!1;var f=Nu,m=A2;A2=0;var v=Jb(Uh),w=F.T,I=B.p;try{B.p=32>v?32:v,F.T=null,v=_2,_2=null;var T=Nu,L=Uh;if(jr=0,zh=Nu=null,Uh=0,(fn&6)!==0)throw Error(r(331));var V=fn;if(fn|=4,iD(T.current),rD(T,T.current,L,v),fn=V,dp(0,!1),Ge&&typeof Ge.onPostCommitFiberRoot=="function")try{Ge.onPostCommitFiberRoot(cr,T)}catch{}return!0}finally{B.p=I,F.T=w,CD(f,m)}}function ED(f,m,v){m=Ia(v,m),m=c2(f.stateNode,m,2),f=yu(f,m,2),f!==null&&(Ad(f,2),Ai(f))}function Sn(f,m,v){if(f.tag===3)ED(f,f,v);else for(;m!==null;){if(m.tag===3){ED(m,f,v);break}else if(m.tag===1){var w=m.stateNode;if(typeof m.type.getDerivedStateFromError=="function"||typeof w.componentDidCatch=="function"&&(Tu===null||!Tu.has(w))){f=Ia(v,f),v=T_(2),w=yu(m,v,2),w!==null&&(N_(v,w,m,f),Ad(w,2),Ai(w));break}}m=m.return}}function M2(f,m,v){var w=f.pingCache;if(w===null){w=f.pingCache=new O5;var I=new Set;w.set(m,I)}else I=w.get(m),I===void 0&&(I=new Set,w.set(m,I));I.has(v)||(I2=!0,I.add(v),f=B5.bind(null,f,m,v),m.then(f,f))}function B5(f,m,v){var w=f.pingCache;w!==null&&w.delete(m),f.pingedLanes|=f.suspendedLanes&v,f.warmLanes&=~v,Rn===f&&(He&v)===v&&(qn===4||qn===3&&(He&62914560)===He&&300>ge()-N2?(fn&2)===0&&Wh(f,0):R2|=v,Bh===He&&(Bh=0)),Ai(f)}function kD(f,m){m===0&&(m=wN()),f=Eh(f,m),f!==null&&(Ad(f,m),Ai(f))}function z5(f){var m=f.memoizedState,v=0;m!==null&&(v=m.retryLane),kD(f,v)}function U5(f,m){var v=0;switch(f.tag){case 13:var w=f.stateNode,I=f.memoizedState;I!==null&&(v=I.retryLane);break;case 19:w=f.stateNode;break;case 22:w=f.stateNode._retryCache;break;default:throw Error(r(314))}w!==null&&w.delete(m),kD(f,v)}function W5(f,m){return Ht(f,m)}var sx=null,Gh=null,L2=!1,ux=!1,P2=!1,Xl=0;function Ai(f){f!==Gh&&f.next===null&&(Gh===null?sx=Gh=f:Gh=Gh.next=f),ux=!0,L2||(L2=!0,G5())}function dp(f,m){if(!P2&&ux){P2=!0;do for(var v=!1,w=sx;w!==null;){if(f!==0){var I=w.pendingLanes;if(I===0)var T=0;else{var L=w.suspendedLanes,V=w.pingedLanes;T=(1<<31-zn(42|f)+1)-1,T&=I&~(L&~V),T=T&201326741?T&201326741|1:T?T|2:0}T!==0&&(v=!0,ND(w,T))}else T=He,T=pv(w,w===Rn?T:0,w.cancelPendingCommit!==null||w.timeoutHandle!==-1),(T&3)===0||Nd(w,T)||(v=!0,ND(w,T));w=w.next}while(v);P2=!1}}function V5(){ID()}function ID(){ux=L2=!1;var f=0;Xl!==0&&(Z5()&&(f=Xl),Xl=0);for(var m=ge(),v=null,w=sx;w!==null;){var I=w.next,T=RD(w,m);T===0?(w.next=null,v===null?sx=I:v.next=I,I===null&&(Gh=v)):(v=w,(f!==0||(T&3)!==0)&&(ux=!0)),w=I}dp(f)}function RD(f,m){for(var v=f.suspendedLanes,w=f.pingedLanes,I=f.expirationTimes,T=f.pendingLanes&-62914561;0<T;){var L=31-zn(T),V=1<<L,tt=I[L];tt===-1?((V&v)===0||(V&w)!==0)&&(I[L]=mq(V,m)):tt<=m&&(f.expiredLanes|=V),T&=~V}if(m=Rn,v=He,v=pv(f,f===m?v:0,f.cancelPendingCommit!==null||f.timeoutHandle!==-1),w=f.callbackNode,v===0||f===m&&(dn===2||dn===9)||f.cancelPendingCommit!==null)return w!==null&&w!==null&&ee(w),f.callbackNode=null,f.callbackPriority=0;if((v&3)===0||Nd(f,v)){if(m=v&-v,m===f.callbackPriority)return m;switch(w!==null&&ee(w),Jb(v)){case 2:case 8:v=ze;break;case 32:v=un;break;case 268435456:v=Gn;break;default:v=un}return w=TD.bind(null,f),v=Ht(v,w),f.callbackPriority=m,f.callbackNode=v,m}return w!==null&&w!==null&&ee(w),f.callbackPriority=2,f.callbackNode=null,2}function TD(f,m){if(jr!==0&&jr!==5)return f.callbackNode=null,f.callbackPriority=0,null;var v=f.callbackNode;if(ix()&&f.callbackNode!==v)return null;var w=He;return w=pv(f,f===Rn?w:0,f.cancelPendingCommit!==null||f.timeoutHandle!==-1),w===0?null:(cD(f,w,m),RD(f,ge()),f.callbackNode!=null&&f.callbackNode===v?TD.bind(null,f):null)}function ND(f,m){if(ix())return null;cD(f,m,!0)}function G5(){tj(function(){(fn&6)!==0?Ht(en,V5):ID()})}function B2(){return Xl===0&&(Xl=bN()),Xl}function AD(f){return f==null||typeof f=="symbol"||typeof f=="boolean"?null:typeof f=="function"?f:yv(""+f)}function _D(f,m){var v=m.ownerDocument.createElement("input");return v.name=m.name,v.value=m.value,f.id&&v.setAttribute("form",f.id),m.parentNode.insertBefore(v,m),f=new FormData(f),v.parentNode.removeChild(v),f}function H5(f,m,v,w,I){if(m==="submit"&&v&&v.stateNode===I){var T=AD((I[Fo]||null).action),L=w.submitter;L&&(m=(m=L[Fo]||null)?AD(m.formAction):L.getAttribute("formAction"),m!==null&&(T=m,L=null));var V=new Sv("action","action",null,w,I);f.push({event:V,listeners:[{instance:null,listener:function(){if(w.defaultPrevented){if(Xl!==0){var tt=L?_D(I,L):new FormData(I);a2(v,{pending:!0,data:tt,method:I.method,action:T},null,tt)}}else typeof T=="function"&&(V.preventDefault(),tt=L?_D(I,L):new FormData(I),a2(v,{pending:!0,data:tt,method:I.method,action:T},T,tt))},currentTarget:I}]})}}for(var z2=0;z2<Ew.length;z2++){var U2=Ew[z2],q5=U2.toLowerCase(),j5=U2[0].toUpperCase()+U2.slice(1);Ja(q5,"on"+j5)}Ja(cA,"onAnimationEnd"),Ja(hA,"onAnimationIteration"),Ja(fA,"onAnimationStart"),Ja("dblclick","onDoubleClick"),Ja("focusin","onFocus"),Ja("focusout","onBlur"),Ja(c5,"onTransitionRun"),Ja(h5,"onTransitionStart"),Ja(f5,"onTransitionCancel"),Ja(dA,"onTransitionEnd"),ph("onMouseEnter",["mouseout","mouseover"]),ph("onMouseLeave",["mouseout","mouseover"]),ph("onPointerEnter",["pointerout","pointerover"]),ph("onPointerLeave",["pointerout","pointerover"]),Dl("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Dl("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Dl("onBeforeInput",["compositionend","keypress","textInput","paste"]),Dl("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Dl("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Dl("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var pp="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),X5=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(pp));function DD(f,m){m=(m&4)!==0;for(var v=0;v<f.length;v++){var w=f[v],I=w.event;w=w.listeners;t:{var T=void 0;if(m)for(var L=w.length-1;0<=L;L--){var V=w[L],tt=V.instance,vt=V.currentTarget;if(V=V.listener,tt!==T&&I.isPropagationStopped())break t;T=V,I.currentTarget=vt;try{T(I)}catch(At){Kv(At)}I.currentTarget=null,T=tt}else for(L=0;L<w.length;L++){if(V=w[L],tt=V.instance,vt=V.currentTarget,V=V.listener,tt!==T&&I.isPropagationStopped())break t;T=V,I.currentTarget=vt;try{T(I)}catch(At){Kv(At)}I.currentTarget=null,T=tt}}}}function Le(f,m){var v=m[tw];v===void 0&&(v=m[tw]=new Set);var w=f+"__bubble";v.has(w)||($D(m,f,2,!1),v.add(w))}function W2(f,m,v){var w=0;m&&(w|=4),$D(v,f,w,m)}var lx="_reactListening"+Math.random().toString(36).slice(2);function V2(f){if(!f[lx]){f[lx]=!0,IN.forEach(function(v){v!=="selectionchange"&&(X5.has(v)||W2(v,!1,f),W2(v,!0,f))});var m=f.nodeType===9?f:f.ownerDocument;m===null||m[lx]||(m[lx]=!0,W2("selectionchange",!1,m))}}function $D(f,m,v,w){switch(r$(m)){case 2:var I=wj;break;case 8:I=Cj;break;default:I=rC}v=I.bind(null,m,v,f),I=void 0,!hw||m!=="touchstart"&&m!=="touchmove"&&m!=="wheel"||(I=!0),w?I!==void 0?f.addEventListener(m,v,{capture:!0,passive:I}):f.addEventListener(m,v,!0):I!==void 0?f.addEventListener(m,v,{passive:I}):f.addEventListener(m,v,!1)}function G2(f,m,v,w,I){var T=w;if((m&1)===0&&(m&2)===0&&w!==null)t:for(;;){if(w===null)return;var L=w.tag;if(L===3||L===4){var V=w.stateNode.containerInfo;if(V===I)break;if(L===4)for(L=w.return;L!==null;){var tt=L.tag;if((tt===3||tt===4)&&L.stateNode.containerInfo===I)return;L=L.return}for(;V!==null;){if(L=hh(V),L===null)return;if(tt=L.tag,tt===5||tt===6||tt===26||tt===27){w=T=L;continue t}V=V.parentNode}}w=w.return}zN(function(){var vt=T,At=lw(v),$t=[];t:{var xt=pA.get(f);if(xt!==void 0){var bt=Sv,ye=f;switch(f){case"keypress":if(wv(v)===0)break t;case"keydown":case"keyup":bt=Wq;break;case"focusin":ye="focus",bt=mw;break;case"focusout":ye="blur",bt=mw;break;case"beforeblur":case"afterblur":bt=mw;break;case"click":if(v.button===2)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":bt=VN;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":bt=Aq;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":bt=Hq;break;case cA:case hA:case fA:bt=$q;break;case dA:bt=jq;break;case"scroll":case"scrollend":bt=Tq;break;case"wheel":bt=Kq;break;case"copy":case"cut":case"paste":bt=Fq;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":bt=HN;break;case"toggle":case"beforetoggle":bt=Qq}var pe=(m&4)!==0,xn=!pe&&(f==="scroll"||f==="scrollend"),dt=pe?xt!==null?xt+"Capture":null:xt;pe=[];for(var at=vt,mt;at!==null;){var Dt=at;if(mt=Dt.stateNode,Dt=Dt.tag,Dt!==5&&Dt!==26&&Dt!==27||mt===null||dt===null||(Dt=$d(at,dt),Dt!=null&&pe.push(mp(at,Dt,mt))),xn)break;at=at.return}0<pe.length&&(xt=new bt(xt,ye,null,v,At),$t.push({event:xt,listeners:pe}))}}if((m&7)===0){t:{if(xt=f==="mouseover"||f==="pointerover",bt=f==="mouseout"||f==="pointerout",xt&&v!==uw&&(ye=v.relatedTarget||v.fromElement)&&(hh(ye)||ye[ch]))break t;if((bt||xt)&&(xt=At.window===At?At:(xt=At.ownerDocument)?xt.defaultView||xt.parentWindow:window,bt?(ye=v.relatedTarget||v.toElement,bt=vt,ye=ye?hh(ye):null,ye!==null&&(xn=a(ye),pe=ye.tag,ye!==xn||pe!==5&&pe!==27&&pe!==6)&&(ye=null)):(bt=null,ye=vt),bt!==ye)){if(pe=VN,Dt="onMouseLeave",dt="onMouseEnter",at="mouse",(f==="pointerout"||f==="pointerover")&&(pe=HN,Dt="onPointerLeave",dt="onPointerEnter",at="pointer"),xn=bt==null?xt:Dd(bt),mt=ye==null?xt:Dd(ye),xt=new pe(Dt,at+"leave",bt,v,At),xt.target=xn,xt.relatedTarget=mt,Dt=null,hh(At)===vt&&(pe=new pe(dt,at+"enter",ye,v,At),pe.target=mt,pe.relatedTarget=xn,Dt=pe),xn=Dt,bt&&ye)e:{for(pe=bt,dt=ye,at=0,mt=pe;mt;mt=Hh(mt))at++;for(mt=0,Dt=dt;Dt;Dt=Hh(Dt))mt++;for(;0<at-mt;)pe=Hh(pe),at--;for(;0<mt-at;)dt=Hh(dt),mt--;for(;at--;){if(pe===dt||dt!==null&&pe===dt.alternate)break e;pe=Hh(pe),dt=Hh(dt)}pe=null}else pe=null;bt!==null&&OD($t,xt,bt,pe,!1),ye!==null&&xn!==null&&OD($t,xn,ye,pe,!0)}}t:{if(xt=vt?Dd(vt):window,bt=xt.nodeName&&xt.nodeName.toLowerCase(),bt==="select"||bt==="input"&&xt.type==="file")var Kt=JN;else if(QN(xt))if(tA)Kt=s5;else{Kt=a5;var Fe=o5}else bt=xt.nodeName,!bt||bt.toLowerCase()!=="input"||xt.type!=="checkbox"&&xt.type!=="radio"?vt&&sw(vt.elementType)&&(Kt=JN):Kt=i5;if(Kt&&(Kt=Kt(f,vt))){ZN($t,Kt,v,At);break t}Fe&&Fe(f,xt,vt),f==="focusout"&&vt&&xt.type==="number"&&vt.memoizedProps.value!=null&&iw(xt,"number",xt.value)}switch(Fe=vt?Dd(vt):window,f){case"focusin":(QN(Fe)||Fe.contentEditable==="true")&&(wh=Fe,ww=vt,Ud=null);break;case"focusout":Ud=ww=wh=null;break;case"mousedown":Cw=!0;break;case"contextmenu":case"mouseup":case"dragend":Cw=!1,uA($t,v,At);break;case"selectionchange":if(l5)break;case"keydown":case"keyup":uA($t,v,At)}var le;if(vw)t:{switch(f){case"compositionstart":var ve="onCompositionStart";break t;case"compositionend":ve="onCompositionEnd";break t;case"compositionupdate":ve="onCompositionUpdate";break t}ve=void 0}else bh?KN(f,v)&&(ve="onCompositionEnd"):f==="keydown"&&v.keyCode===229&&(ve="onCompositionStart");ve&&(qN&&v.locale!=="ko"&&(bh||ve!=="onCompositionStart"?ve==="onCompositionEnd"&&bh&&(le=UN()):(mu=At,fw="value"in mu?mu.value:mu.textContent,bh=!0)),Fe=cx(vt,ve),0<Fe.length&&(ve=new GN(ve,f,null,v,At),$t.push({event:ve,listeners:Fe}),le?ve.data=le:(le=YN(v),le!==null&&(ve.data=le)))),(le=Jq?t5(f,v):e5(f,v))&&(ve=cx(vt,"onBeforeInput"),0<ve.length&&(Fe=new GN("onBeforeInput","beforeinput",null,v,At),$t.push({event:Fe,listeners:ve}),Fe.data=le)),H5($t,f,vt,v,At)}DD($t,m)})}function mp(f,m,v){return{instance:f,listener:m,currentTarget:v}}function cx(f,m){for(var v=m+"Capture",w=[];f!==null;){var I=f,T=I.stateNode;if(I=I.tag,I!==5&&I!==26&&I!==27||T===null||(I=$d(f,v),I!=null&&w.unshift(mp(f,I,T)),I=$d(f,m),I!=null&&w.push(mp(f,I,T))),f.tag===3)return w;f=f.return}return[]}function Hh(f){if(f===null)return null;do f=f.return;while(f&&f.tag!==5&&f.tag!==27);return f||null}function OD(f,m,v,w,I){for(var T=m._reactName,L=[];v!==null&&v!==w;){var V=v,tt=V.alternate,vt=V.stateNode;if(V=V.tag,tt!==null&&tt===w)break;V!==5&&V!==26&&V!==27||vt===null||(tt=vt,I?(vt=$d(v,T),vt!=null&&L.unshift(mp(v,vt,tt))):I||(vt=$d(v,T),vt!=null&&L.push(mp(v,vt,tt)))),v=v.return}L.length!==0&&f.push({event:m,listeners:L})}var K5=/\r\n?/g,Y5=/\u0000|\uFFFD/g;function FD(f){return(typeof f=="string"?f:""+f).replace(K5,`
`).replace(Y5,"")}function MD(f,m){return m=FD(m),FD(f)===m}function hx(){}function vn(f,m,v,w,I,T){switch(v){case"children":typeof w=="string"?m==="body"||m==="textarea"&&w===""||vh(f,w):(typeof w=="number"||typeof w=="bigint")&&m!=="body"&&vh(f,""+w);break;case"className":gv(f,"class",w);break;case"tabIndex":gv(f,"tabindex",w);break;case"dir":case"role":case"viewBox":case"width":case"height":gv(f,v,w);break;case"style":PN(f,w,T);break;case"data":if(m!=="object"){gv(f,"data",w);break}case"src":case"href":if(w===""&&(m!=="a"||v!=="href")){f.removeAttribute(v);break}if(w==null||typeof w=="function"||typeof w=="symbol"||typeof w=="boolean"){f.removeAttribute(v);break}w=yv(""+w),f.setAttribute(v,w);break;case"action":case"formAction":if(typeof w=="function"){f.setAttribute(v,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof T=="function"&&(v==="formAction"?(m!=="input"&&vn(f,m,"name",I.name,I,null),vn(f,m,"formEncType",I.formEncType,I,null),vn(f,m,"formMethod",I.formMethod,I,null),vn(f,m,"formTarget",I.formTarget,I,null)):(vn(f,m,"encType",I.encType,I,null),vn(f,m,"method",I.method,I,null),vn(f,m,"target",I.target,I,null)));if(w==null||typeof w=="symbol"||typeof w=="boolean"){f.removeAttribute(v);break}w=yv(""+w),f.setAttribute(v,w);break;case"onClick":w!=null&&(f.onclick=hx);break;case"onScroll":w!=null&&Le("scroll",f);break;case"onScrollEnd":w!=null&&Le("scrollend",f);break;case"dangerouslySetInnerHTML":if(w!=null){if(typeof w!="object"||!("__html"in w))throw Error(r(61));if(v=w.__html,v!=null){if(I.children!=null)throw Error(r(60));f.innerHTML=v}}break;case"multiple":f.multiple=w&&typeof w!="function"&&typeof w!="symbol";break;case"muted":f.muted=w&&typeof w!="function"&&typeof w!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(w==null||typeof w=="function"||typeof w=="boolean"||typeof w=="symbol"){f.removeAttribute("xlink:href");break}v=yv(""+w),f.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",v);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":w!=null&&typeof w!="function"&&typeof w!="symbol"?f.setAttribute(v,""+w):f.removeAttribute(v);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":w&&typeof w!="function"&&typeof w!="symbol"?f.setAttribute(v,""):f.removeAttribute(v);break;case"capture":case"download":w===!0?f.setAttribute(v,""):w!==!1&&w!=null&&typeof w!="function"&&typeof w!="symbol"?f.setAttribute(v,w):f.removeAttribute(v);break;case"cols":case"rows":case"size":case"span":w!=null&&typeof w!="function"&&typeof w!="symbol"&&!isNaN(w)&&1<=w?f.setAttribute(v,w):f.removeAttribute(v);break;case"rowSpan":case"start":w==null||typeof w=="function"||typeof w=="symbol"||isNaN(w)?f.removeAttribute(v):f.setAttribute(v,w);break;case"popover":Le("beforetoggle",f),Le("toggle",f),mv(f,"popover",w);break;case"xlinkActuate":ys(f,"http://www.w3.org/1999/xlink","xlink:actuate",w);break;case"xlinkArcrole":ys(f,"http://www.w3.org/1999/xlink","xlink:arcrole",w);break;case"xlinkRole":ys(f,"http://www.w3.org/1999/xlink","xlink:role",w);break;case"xlinkShow":ys(f,"http://www.w3.org/1999/xlink","xlink:show",w);break;case"xlinkTitle":ys(f,"http://www.w3.org/1999/xlink","xlink:title",w);break;case"xlinkType":ys(f,"http://www.w3.org/1999/xlink","xlink:type",w);break;case"xmlBase":ys(f,"http://www.w3.org/XML/1998/namespace","xml:base",w);break;case"xmlLang":ys(f,"http://www.w3.org/XML/1998/namespace","xml:lang",w);break;case"xmlSpace":ys(f,"http://www.w3.org/XML/1998/namespace","xml:space",w);break;case"is":mv(f,"is",w);break;case"innerText":case"textContent":break;default:(!(2<v.length)||v[0]!=="o"&&v[0]!=="O"||v[1]!=="n"&&v[1]!=="N")&&(v=Iq.get(v)||v,mv(f,v,w))}}function H2(f,m,v,w,I,T){switch(v){case"style":PN(f,w,T);break;case"dangerouslySetInnerHTML":if(w!=null){if(typeof w!="object"||!("__html"in w))throw Error(r(61));if(v=w.__html,v!=null){if(I.children!=null)throw Error(r(60));f.innerHTML=v}}break;case"children":typeof w=="string"?vh(f,w):(typeof w=="number"||typeof w=="bigint")&&vh(f,""+w);break;case"onScroll":w!=null&&Le("scroll",f);break;case"onScrollEnd":w!=null&&Le("scrollend",f);break;case"onClick":w!=null&&(f.onclick=hx);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!RN.hasOwnProperty(v))t:{if(v[0]==="o"&&v[1]==="n"&&(I=v.endsWith("Capture"),m=v.slice(2,I?v.length-7:void 0),T=f[Fo]||null,T=T!=null?T[v]:null,typeof T=="function"&&f.removeEventListener(m,T,I),typeof w=="function")){typeof T!="function"&&T!==null&&(v in f?f[v]=null:f.hasAttribute(v)&&f.removeAttribute(v)),f.addEventListener(m,w,I);break t}v in f?f[v]=w:w===!0?f.setAttribute(v,""):mv(f,v,w)}}}function Xr(f,m,v){switch(m){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Le("error",f),Le("load",f);var w=!1,I=!1,T;for(T in v)if(v.hasOwnProperty(T)){var L=v[T];if(L!=null)switch(T){case"src":w=!0;break;case"srcSet":I=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,m));default:vn(f,m,T,L,v,null)}}I&&vn(f,m,"srcSet",v.srcSet,v,null),w&&vn(f,m,"src",v.src,v,null);return;case"input":Le("invalid",f);var V=T=L=I=null,tt=null,vt=null;for(w in v)if(v.hasOwnProperty(w)){var At=v[w];if(At!=null)switch(w){case"name":I=At;break;case"type":L=At;break;case"checked":tt=At;break;case"defaultChecked":vt=At;break;case"value":T=At;break;case"defaultValue":V=At;break;case"children":case"dangerouslySetInnerHTML":if(At!=null)throw Error(r(137,m));break;default:vn(f,m,w,At,v,null)}}ON(f,T,V,tt,vt,L,I,!1),vv(f);return;case"select":Le("invalid",f),w=L=T=null;for(I in v)if(v.hasOwnProperty(I)&&(V=v[I],V!=null))switch(I){case"value":T=V;break;case"defaultValue":L=V;break;case"multiple":w=V;default:vn(f,m,I,V,v,null)}m=T,v=L,f.multiple=!!w,m!=null?gh(f,!!w,m,!1):v!=null&&gh(f,!!w,v,!0);return;case"textarea":Le("invalid",f),T=I=w=null;for(L in v)if(v.hasOwnProperty(L)&&(V=v[L],V!=null))switch(L){case"value":w=V;break;case"defaultValue":I=V;break;case"children":T=V;break;case"dangerouslySetInnerHTML":if(V!=null)throw Error(r(91));break;default:vn(f,m,L,V,v,null)}MN(f,w,I,T),vv(f);return;case"option":for(tt in v)if(v.hasOwnProperty(tt)&&(w=v[tt],w!=null))switch(tt){case"selected":f.selected=w&&typeof w!="function"&&typeof w!="symbol";break;default:vn(f,m,tt,w,v,null)}return;case"dialog":Le("beforetoggle",f),Le("toggle",f),Le("cancel",f),Le("close",f);break;case"iframe":case"object":Le("load",f);break;case"video":case"audio":for(w=0;w<pp.length;w++)Le(pp[w],f);break;case"image":Le("error",f),Le("load",f);break;case"details":Le("toggle",f);break;case"embed":case"source":case"link":Le("error",f),Le("load",f);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(vt in v)if(v.hasOwnProperty(vt)&&(w=v[vt],w!=null))switch(vt){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,m));default:vn(f,m,vt,w,v,null)}return;default:if(sw(m)){for(At in v)v.hasOwnProperty(At)&&(w=v[At],w!==void 0&&H2(f,m,At,w,v,void 0));return}}for(V in v)v.hasOwnProperty(V)&&(w=v[V],w!=null&&vn(f,m,V,w,v,null))}function Q5(f,m,v,w){switch(m){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var I=null,T=null,L=null,V=null,tt=null,vt=null,At=null;for(bt in v){var $t=v[bt];if(v.hasOwnProperty(bt)&&$t!=null)switch(bt){case"checked":break;case"value":break;case"defaultValue":tt=$t;default:w.hasOwnProperty(bt)||vn(f,m,bt,null,w,$t)}}for(var xt in w){var bt=w[xt];if($t=v[xt],w.hasOwnProperty(xt)&&(bt!=null||$t!=null))switch(xt){case"type":T=bt;break;case"name":I=bt;break;case"checked":vt=bt;break;case"defaultChecked":At=bt;break;case"value":L=bt;break;case"defaultValue":V=bt;break;case"children":case"dangerouslySetInnerHTML":if(bt!=null)throw Error(r(137,m));break;default:bt!==$t&&vn(f,m,xt,bt,w,$t)}}aw(f,L,V,tt,vt,At,T,I);return;case"select":bt=L=V=xt=null;for(T in v)if(tt=v[T],v.hasOwnProperty(T)&&tt!=null)switch(T){case"value":break;case"multiple":bt=tt;default:w.hasOwnProperty(T)||vn(f,m,T,null,w,tt)}for(I in w)if(T=w[I],tt=v[I],w.hasOwnProperty(I)&&(T!=null||tt!=null))switch(I){case"value":xt=T;break;case"defaultValue":V=T;break;case"multiple":L=T;default:T!==tt&&vn(f,m,I,T,w,tt)}m=V,v=L,w=bt,xt!=null?gh(f,!!v,xt,!1):!!w!=!!v&&(m!=null?gh(f,!!v,m,!0):gh(f,!!v,v?[]:"",!1));return;case"textarea":bt=xt=null;for(V in v)if(I=v[V],v.hasOwnProperty(V)&&I!=null&&!w.hasOwnProperty(V))switch(V){case"value":break;case"children":break;default:vn(f,m,V,null,w,I)}for(L in w)if(I=w[L],T=v[L],w.hasOwnProperty(L)&&(I!=null||T!=null))switch(L){case"value":xt=I;break;case"defaultValue":bt=I;break;case"children":break;case"dangerouslySetInnerHTML":if(I!=null)throw Error(r(91));break;default:I!==T&&vn(f,m,L,I,w,T)}FN(f,xt,bt);return;case"option":for(var ye in v)if(xt=v[ye],v.hasOwnProperty(ye)&&xt!=null&&!w.hasOwnProperty(ye))switch(ye){case"selected":f.selected=!1;break;default:vn(f,m,ye,null,w,xt)}for(tt in w)if(xt=w[tt],bt=v[tt],w.hasOwnProperty(tt)&&xt!==bt&&(xt!=null||bt!=null))switch(tt){case"selected":f.selected=xt&&typeof xt!="function"&&typeof xt!="symbol";break;default:vn(f,m,tt,xt,w,bt)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var pe in v)xt=v[pe],v.hasOwnProperty(pe)&&xt!=null&&!w.hasOwnProperty(pe)&&vn(f,m,pe,null,w,xt);for(vt in w)if(xt=w[vt],bt=v[vt],w.hasOwnProperty(vt)&&xt!==bt&&(xt!=null||bt!=null))switch(vt){case"children":case"dangerouslySetInnerHTML":if(xt!=null)throw Error(r(137,m));break;default:vn(f,m,vt,xt,w,bt)}return;default:if(sw(m)){for(var xn in v)xt=v[xn],v.hasOwnProperty(xn)&&xt!==void 0&&!w.hasOwnProperty(xn)&&H2(f,m,xn,void 0,w,xt);for(At in w)xt=w[At],bt=v[At],!w.hasOwnProperty(At)||xt===bt||xt===void 0&&bt===void 0||H2(f,m,At,xt,w,bt);return}}for(var dt in v)xt=v[dt],v.hasOwnProperty(dt)&&xt!=null&&!w.hasOwnProperty(dt)&&vn(f,m,dt,null,w,xt);for($t in w)xt=w[$t],bt=v[$t],!w.hasOwnProperty($t)||xt===bt||xt==null&&bt==null||vn(f,m,$t,xt,w,bt)}var q2=null,j2=null;function fx(f){return f.nodeType===9?f:f.ownerDocument}function LD(f){switch(f){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function PD(f,m){if(f===0)switch(m){case"svg":return 1;case"math":return 2;default:return 0}return f===1&&m==="foreignObject"?0:f}function X2(f,m){return f==="textarea"||f==="noscript"||typeof m.children=="string"||typeof m.children=="number"||typeof m.children=="bigint"||typeof m.dangerouslySetInnerHTML=="object"&&m.dangerouslySetInnerHTML!==null&&m.dangerouslySetInnerHTML.__html!=null}var K2=null;function Z5(){var f=window.event;return f&&f.type==="popstate"?f===K2?!1:(K2=f,!0):(K2=null,!1)}var BD=typeof setTimeout=="function"?setTimeout:void 0,J5=typeof clearTimeout=="function"?clearTimeout:void 0,zD=typeof Promise=="function"?Promise:void 0,tj=typeof queueMicrotask=="function"?queueMicrotask:typeof zD<"u"?function(f){return zD.resolve(null).then(f).catch(ej)}:BD;function ej(f){setTimeout(function(){throw f})}function _u(f){return f==="head"}function UD(f,m){var v=m,w=0,I=0;do{var T=v.nextSibling;if(f.removeChild(v),T&&T.nodeType===8)if(v=T.data,v==="/$"){if(0<w&&8>w){v=w;var L=f.ownerDocument;if(v&1&&gp(L.documentElement),v&2&&gp(L.body),v&4)for(v=L.head,gp(v),L=v.firstChild;L;){var V=L.nextSibling,tt=L.nodeName;L[_d]||tt==="SCRIPT"||tt==="STYLE"||tt==="LINK"&&L.rel.toLowerCase()==="stylesheet"||v.removeChild(L),L=V}}if(I===0){f.removeChild(T),Ep(m);return}I--}else v==="$"||v==="$?"||v==="$!"?I++:w=v.charCodeAt(0)-48;else w=0;v=T}while(v);Ep(m)}function Y2(f){var m=f.firstChild;for(m&&m.nodeType===10&&(m=m.nextSibling);m;){var v=m;switch(m=m.nextSibling,v.nodeName){case"HTML":case"HEAD":case"BODY":Y2(v),ew(v);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(v.rel.toLowerCase()==="stylesheet")continue}f.removeChild(v)}}function nj(f,m,v,w){for(;f.nodeType===1;){var I=v;if(f.nodeName.toLowerCase()!==m.toLowerCase()){if(!w&&(f.nodeName!=="INPUT"||f.type!=="hidden"))break}else if(w){if(!f[_d])switch(m){case"meta":if(!f.hasAttribute("itemprop"))break;return f;case"link":if(T=f.getAttribute("rel"),T==="stylesheet"&&f.hasAttribute("data-precedence"))break;if(T!==I.rel||f.getAttribute("href")!==(I.href==null||I.href===""?null:I.href)||f.getAttribute("crossorigin")!==(I.crossOrigin==null?null:I.crossOrigin)||f.getAttribute("title")!==(I.title==null?null:I.title))break;return f;case"style":if(f.hasAttribute("data-precedence"))break;return f;case"script":if(T=f.getAttribute("src"),(T!==(I.src==null?null:I.src)||f.getAttribute("type")!==(I.type==null?null:I.type)||f.getAttribute("crossorigin")!==(I.crossOrigin==null?null:I.crossOrigin))&&T&&f.hasAttribute("async")&&!f.hasAttribute("itemprop"))break;return f;default:return f}}else if(m==="input"&&f.type==="hidden"){var T=I.name==null?null:""+I.name;if(I.type==="hidden"&&f.getAttribute("name")===T)return f}else return f;if(f=ei(f.nextSibling),f===null)break}return null}function rj(f,m,v){if(m==="")return null;for(;f.nodeType!==3;)if((f.nodeType!==1||f.nodeName!=="INPUT"||f.type!=="hidden")&&!v||(f=ei(f.nextSibling),f===null))return null;return f}function Q2(f){return f.data==="$!"||f.data==="$?"&&f.ownerDocument.readyState==="complete"}function oj(f,m){var v=f.ownerDocument;if(f.data!=="$?"||v.readyState==="complete")m();else{var w=function(){m(),v.removeEventListener("DOMContentLoaded",w)};v.addEventListener("DOMContentLoaded",w),f._reactRetry=w}}function ei(f){for(;f!=null;f=f.nextSibling){var m=f.nodeType;if(m===1||m===3)break;if(m===8){if(m=f.data,m==="$"||m==="$!"||m==="$?"||m==="F!"||m==="F")break;if(m==="/$")return null}}return f}var Z2=null;function WD(f){f=f.previousSibling;for(var m=0;f;){if(f.nodeType===8){var v=f.data;if(v==="$"||v==="$!"||v==="$?"){if(m===0)return f;m--}else v==="/$"&&m++}f=f.previousSibling}return null}function VD(f,m,v){switch(m=fx(v),f){case"html":if(f=m.documentElement,!f)throw Error(r(452));return f;case"head":if(f=m.head,!f)throw Error(r(453));return f;case"body":if(f=m.body,!f)throw Error(r(454));return f;default:throw Error(r(451))}}function gp(f){for(var m=f.attributes;m.length;)f.removeAttributeNode(m[0]);ew(f)}var Da=new Map,GD=new Set;function dx(f){return typeof f.getRootNode=="function"?f.getRootNode():f.nodeType===9?f:f.ownerDocument}var $s=B.d;B.d={f:aj,r:ij,D:sj,C:uj,L:lj,m:cj,X:fj,S:hj,M:dj};function aj(){var f=$s.f(),m=ox();return f||m}function ij(f){var m=fh(f);m!==null&&m.tag===5&&m.type==="form"?c_(m):$s.r(f)}var qh=typeof document>"u"?null:document;function HD(f,m,v){var w=qh;if(w&&typeof m=="string"&&m){var I=ka(m);I='link[rel="'+f+'"][href="'+I+'"]',typeof v=="string"&&(I+='[crossorigin="'+v+'"]'),GD.has(I)||(GD.add(I),f={rel:f,crossOrigin:v,href:m},w.querySelector(I)===null&&(m=w.createElement("link"),Xr(m,"link",f),$r(m),w.head.appendChild(m)))}}function sj(f){$s.D(f),HD("dns-prefetch",f,null)}function uj(f,m){$s.C(f,m),HD("preconnect",f,m)}function lj(f,m,v){$s.L(f,m,v);var w=qh;if(w&&f&&m){var I='link[rel="preload"][as="'+ka(m)+'"]';m==="image"&&v&&v.imageSrcSet?(I+='[imagesrcset="'+ka(v.imageSrcSet)+'"]',typeof v.imageSizes=="string"&&(I+='[imagesizes="'+ka(v.imageSizes)+'"]')):I+='[href="'+ka(f)+'"]';var T=I;switch(m){case"style":T=jh(f);break;case"script":T=Xh(f)}Da.has(T)||(f=c({rel:"preload",href:m==="image"&&v&&v.imageSrcSet?void 0:f,as:m},v),Da.set(T,f),w.querySelector(I)!==null||m==="style"&&w.querySelector(vp(T))||m==="script"&&w.querySelector(xp(T))||(m=w.createElement("link"),Xr(m,"link",f),$r(m),w.head.appendChild(m)))}}function cj(f,m){$s.m(f,m);var v=qh;if(v&&f){var w=m&&typeof m.as=="string"?m.as:"script",I='link[rel="modulepreload"][as="'+ka(w)+'"][href="'+ka(f)+'"]',T=I;switch(w){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":T=Xh(f)}if(!Da.has(T)&&(f=c({rel:"modulepreload",href:f},m),Da.set(T,f),v.querySelector(I)===null)){switch(w){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(v.querySelector(xp(T)))return}w=v.createElement("link"),Xr(w,"link",f),$r(w),v.head.appendChild(w)}}}function hj(f,m,v){$s.S(f,m,v);var w=qh;if(w&&f){var I=dh(w).hoistableStyles,T=jh(f);m=m||"default";var L=I.get(T);if(!L){var V={loading:0,preload:null};if(L=w.querySelector(vp(T)))V.loading=5;else{f=c({rel:"stylesheet",href:f,"data-precedence":m},v),(v=Da.get(T))&&J2(f,v);var tt=L=w.createElement("link");$r(tt),Xr(tt,"link",f),tt._p=new Promise(function(vt,At){tt.onload=vt,tt.onerror=At}),tt.addEventListener("load",function(){V.loading|=1}),tt.addEventListener("error",function(){V.loading|=2}),V.loading|=4,px(L,m,w)}L={type:"stylesheet",instance:L,count:1,state:V},I.set(T,L)}}}function fj(f,m){$s.X(f,m);var v=qh;if(v&&f){var w=dh(v).hoistableScripts,I=Xh(f),T=w.get(I);T||(T=v.querySelector(xp(I)),T||(f=c({src:f,async:!0},m),(m=Da.get(I))&&tC(f,m),T=v.createElement("script"),$r(T),Xr(T,"link",f),v.head.appendChild(T)),T={type:"script",instance:T,count:1,state:null},w.set(I,T))}}function dj(f,m){$s.M(f,m);var v=qh;if(v&&f){var w=dh(v).hoistableScripts,I=Xh(f),T=w.get(I);T||(T=v.querySelector(xp(I)),T||(f=c({src:f,async:!0,type:"module"},m),(m=Da.get(I))&&tC(f,m),T=v.createElement("script"),$r(T),Xr(T,"link",f),v.head.appendChild(T)),T={type:"script",instance:T,count:1,state:null},w.set(I,T))}}function qD(f,m,v,w){var I=(I=pt.current)?dx(I):null;if(!I)throw Error(r(446));switch(f){case"meta":case"title":return null;case"style":return typeof v.precedence=="string"&&typeof v.href=="string"?(m=jh(v.href),v=dh(I).hoistableStyles,w=v.get(m),w||(w={type:"style",instance:null,count:0,state:null},v.set(m,w)),w):{type:"void",instance:null,count:0,state:null};case"link":if(v.rel==="stylesheet"&&typeof v.href=="string"&&typeof v.precedence=="string"){f=jh(v.href);var T=dh(I).hoistableStyles,L=T.get(f);if(L||(I=I.ownerDocument||I,L={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},T.set(f,L),(T=I.querySelector(vp(f)))&&!T._p&&(L.instance=T,L.state.loading=5),Da.has(f)||(v={rel:"preload",as:"style",href:v.href,crossOrigin:v.crossOrigin,integrity:v.integrity,media:v.media,hrefLang:v.hrefLang,referrerPolicy:v.referrerPolicy},Da.set(f,v),T||pj(I,f,v,L.state))),m&&w===null)throw Error(r(528,""));return L}if(m&&w!==null)throw Error(r(529,""));return null;case"script":return m=v.async,v=v.src,typeof v=="string"&&m&&typeof m!="function"&&typeof m!="symbol"?(m=Xh(v),v=dh(I).hoistableScripts,w=v.get(m),w||(w={type:"script",instance:null,count:0,state:null},v.set(m,w)),w):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,f))}}function jh(f){return'href="'+ka(f)+'"'}function vp(f){return'link[rel="stylesheet"]['+f+"]"}function jD(f){return c({},f,{"data-precedence":f.precedence,precedence:null})}function pj(f,m,v,w){f.querySelector('link[rel="preload"][as="style"]['+m+"]")?w.loading=1:(m=f.createElement("link"),w.preload=m,m.addEventListener("load",function(){return w.loading|=1}),m.addEventListener("error",function(){return w.loading|=2}),Xr(m,"link",v),$r(m),f.head.appendChild(m))}function Xh(f){return'[src="'+ka(f)+'"]'}function xp(f){return"script[async]"+f}function XD(f,m,v){if(m.count++,m.instance===null)switch(m.type){case"style":var w=f.querySelector('style[data-href~="'+ka(v.href)+'"]');if(w)return m.instance=w,$r(w),w;var I=c({},v,{"data-href":v.href,"data-precedence":v.precedence,href:null,precedence:null});return w=(f.ownerDocument||f).createElement("style"),$r(w),Xr(w,"style",I),px(w,v.precedence,f),m.instance=w;case"stylesheet":I=jh(v.href);var T=f.querySelector(vp(I));if(T)return m.state.loading|=4,m.instance=T,$r(T),T;w=jD(v),(I=Da.get(I))&&J2(w,I),T=(f.ownerDocument||f).createElement("link"),$r(T);var L=T;return L._p=new Promise(function(V,tt){L.onload=V,L.onerror=tt}),Xr(T,"link",w),m.state.loading|=4,px(T,v.precedence,f),m.instance=T;case"script":return T=Xh(v.src),(I=f.querySelector(xp(T)))?(m.instance=I,$r(I),I):(w=v,(I=Da.get(T))&&(w=c({},v),tC(w,I)),f=f.ownerDocument||f,I=f.createElement("script"),$r(I),Xr(I,"link",w),f.head.appendChild(I),m.instance=I);case"void":return null;default:throw Error(r(443,m.type))}else m.type==="stylesheet"&&(m.state.loading&4)===0&&(w=m.instance,m.state.loading|=4,px(w,v.precedence,f));return m.instance}function px(f,m,v){for(var w=v.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),I=w.length?w[w.length-1]:null,T=I,L=0;L<w.length;L++){var V=w[L];if(V.dataset.precedence===m)T=V;else if(T!==I)break}T?T.parentNode.insertBefore(f,T.nextSibling):(m=v.nodeType===9?v.head:v,m.insertBefore(f,m.firstChild))}function J2(f,m){f.crossOrigin==null&&(f.crossOrigin=m.crossOrigin),f.referrerPolicy==null&&(f.referrerPolicy=m.referrerPolicy),f.title==null&&(f.title=m.title)}function tC(f,m){f.crossOrigin==null&&(f.crossOrigin=m.crossOrigin),f.referrerPolicy==null&&(f.referrerPolicy=m.referrerPolicy),f.integrity==null&&(f.integrity=m.integrity)}var mx=null;function KD(f,m,v){if(mx===null){var w=new Map,I=mx=new Map;I.set(v,w)}else I=mx,w=I.get(v),w||(w=new Map,I.set(v,w));if(w.has(f))return w;for(w.set(f,null),v=v.getElementsByTagName(f),I=0;I<v.length;I++){var T=v[I];if(!(T[_d]||T[io]||f==="link"&&T.getAttribute("rel")==="stylesheet")&&T.namespaceURI!=="http://www.w3.org/2000/svg"){var L=T.getAttribute(m)||"";L=f+L;var V=w.get(L);V?V.push(T):w.set(L,[T])}}return w}function YD(f,m,v){f=f.ownerDocument||f,f.head.insertBefore(v,m==="title"?f.querySelector("head > title"):null)}function mj(f,m,v){if(v===1||m.itemProp!=null)return!1;switch(f){case"meta":case"title":return!0;case"style":if(typeof m.precedence!="string"||typeof m.href!="string"||m.href==="")break;return!0;case"link":if(typeof m.rel!="string"||typeof m.href!="string"||m.href===""||m.onLoad||m.onError)break;switch(m.rel){case"stylesheet":return f=m.disabled,typeof m.precedence=="string"&&f==null;default:return!0}case"script":if(m.async&&typeof m.async!="function"&&typeof m.async!="symbol"&&!m.onLoad&&!m.onError&&m.src&&typeof m.src=="string")return!0}return!1}function QD(f){return!(f.type==="stylesheet"&&(f.state.loading&3)===0)}var yp=null;function gj(){}function vj(f,m,v){if(yp===null)throw Error(r(475));var w=yp;if(m.type==="stylesheet"&&(typeof v.media!="string"||matchMedia(v.media).matches!==!1)&&(m.state.loading&4)===0){if(m.instance===null){var I=jh(v.href),T=f.querySelector(vp(I));if(T){f=T._p,f!==null&&typeof f=="object"&&typeof f.then=="function"&&(w.count++,w=gx.bind(w),f.then(w,w)),m.state.loading|=4,m.instance=T,$r(T);return}T=f.ownerDocument||f,v=jD(v),(I=Da.get(I))&&J2(v,I),T=T.createElement("link"),$r(T);var L=T;L._p=new Promise(function(V,tt){L.onload=V,L.onerror=tt}),Xr(T,"link",v),m.instance=T}w.stylesheets===null&&(w.stylesheets=new Map),w.stylesheets.set(m,f),(f=m.state.preload)&&(m.state.loading&3)===0&&(w.count++,m=gx.bind(w),f.addEventListener("load",m),f.addEventListener("error",m))}}function xj(){if(yp===null)throw Error(r(475));var f=yp;return f.stylesheets&&f.count===0&&eC(f,f.stylesheets),0<f.count?function(m){var v=setTimeout(function(){if(f.stylesheets&&eC(f,f.stylesheets),f.unsuspend){var w=f.unsuspend;f.unsuspend=null,w()}},6e4);return f.unsuspend=m,function(){f.unsuspend=null,clearTimeout(v)}}:null}function gx(){if(this.count--,this.count===0){if(this.stylesheets)eC(this,this.stylesheets);else if(this.unsuspend){var f=this.unsuspend;this.unsuspend=null,f()}}}var vx=null;function eC(f,m){f.stylesheets=null,f.unsuspend!==null&&(f.count++,vx=new Map,m.forEach(yj,f),vx=null,gx.call(f))}function yj(f,m){if(!(m.state.loading&4)){var v=vx.get(f);if(v)var w=v.get(null);else{v=new Map,vx.set(f,v);for(var I=f.querySelectorAll("link[data-precedence],style[data-precedence]"),T=0;T<I.length;T++){var L=I[T];(L.nodeName==="LINK"||L.getAttribute("media")!=="not all")&&(v.set(L.dataset.precedence,L),w=L)}w&&v.set(null,w)}I=m.instance,L=I.getAttribute("data-precedence"),T=v.get(L)||w,T===w&&v.set(null,I),v.set(L,I),this.count++,w=gx.bind(this),I.addEventListener("load",w),I.addEventListener("error",w),T?T.parentNode.insertBefore(I,T.nextSibling):(f=f.nodeType===9?f.head:f,f.insertBefore(I,f.firstChild)),m.state.loading|=4}}var bp={$$typeof:E,Provider:null,Consumer:null,_currentValue:U,_currentValue2:U,_threadCount:0};function bj(f,m,v,w,I,T,L,V){this.tag=1,this.containerInfo=f,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Qb(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Qb(0),this.hiddenUpdates=Qb(null),this.identifierPrefix=w,this.onUncaughtError=I,this.onCaughtError=T,this.onRecoverableError=L,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=V,this.incompleteTransitions=new Map}function ZD(f,m,v,w,I,T,L,V,tt,vt,At,$t){return f=new bj(f,m,v,L,V,tt,vt,$t),m=1,T===!0&&(m|=24),T=na(3,null,null,m),f.current=T,T.stateNode=f,m=Mw(),m.refCount++,f.pooledCache=m,m.refCount++,T.memoizedState={element:w,isDehydrated:v,cache:m},zw(T),f}function JD(f){return f?(f=kh,f):kh}function t$(f,m,v,w,I,T){I=JD(I),w.context===null?w.context=I:w.pendingContext=I,w=xu(m),w.payload={element:v},T=T===void 0?null:T,T!==null&&(w.callback=T),v=yu(f,w,m),v!==null&&(sa(v,f,m),Yd(v,f,m))}function e$(f,m){if(f=f.memoizedState,f!==null&&f.dehydrated!==null){var v=f.retryLane;f.retryLane=v!==0&&v<m?v:m}}function nC(f,m){e$(f,m),(f=f.alternate)&&e$(f,m)}function n$(f){if(f.tag===13){var m=Eh(f,67108864);m!==null&&sa(m,f,67108864),nC(f,67108864)}}var xx=!0;function wj(f,m,v,w){var I=F.T;F.T=null;var T=B.p;try{B.p=2,rC(f,m,v,w)}finally{B.p=T,F.T=I}}function Cj(f,m,v,w){var I=F.T;F.T=null;var T=B.p;try{B.p=8,rC(f,m,v,w)}finally{B.p=T,F.T=I}}function rC(f,m,v,w){if(xx){var I=oC(w);if(I===null)G2(f,m,w,yx,v),o$(f,w);else if(Ej(I,f,m,v,w))w.stopPropagation();else if(o$(f,w),m&4&&-1<Sj.indexOf(f)){for(;I!==null;){var T=fh(I);if(T!==null)switch(T.tag){case 3:if(T=T.stateNode,T.current.memoizedState.isDehydrated){var L=ta(T.pendingLanes);if(L!==0){var V=T;for(V.pendingLanes|=2,V.entangledLanes|=2;L;){var tt=1<<31-zn(L);V.entanglements[1]|=tt,L&=~tt}Ai(T),(fn&6)===0&&(nx=ge()+500,dp(0))}}break;case 13:V=Eh(T,2),V!==null&&sa(V,T,2),ox(),nC(T,2)}if(T=oC(w),T===null&&G2(f,m,w,yx,v),T===I)break;I=T}I!==null&&w.stopPropagation()}else G2(f,m,w,null,v)}}function oC(f){return f=lw(f),aC(f)}var yx=null;function aC(f){if(yx=null,f=hh(f),f!==null){var m=a(f);if(m===null)f=null;else{var v=m.tag;if(v===13){if(f=i(m),f!==null)return f;f=null}else if(v===3){if(m.stateNode.current.memoizedState.isDehydrated)return m.tag===3?m.stateNode.containerInfo:null;f=null}else m!==f&&(f=null)}}return yx=f,null}function r$(f){switch(f){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(we()){case en:return 2;case ze:return 8;case un:case nn:return 32;case Gn:return 268435456;default:return 32}default:return 32}}var iC=!1,Du=null,$u=null,Ou=null,wp=new Map,Cp=new Map,Fu=[],Sj="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function o$(f,m){switch(f){case"focusin":case"focusout":Du=null;break;case"dragenter":case"dragleave":$u=null;break;case"mouseover":case"mouseout":Ou=null;break;case"pointerover":case"pointerout":wp.delete(m.pointerId);break;case"gotpointercapture":case"lostpointercapture":Cp.delete(m.pointerId)}}function Sp(f,m,v,w,I,T){return f===null||f.nativeEvent!==T?(f={blockedOn:m,domEventName:v,eventSystemFlags:w,nativeEvent:T,targetContainers:[I]},m!==null&&(m=fh(m),m!==null&&n$(m)),f):(f.eventSystemFlags|=w,m=f.targetContainers,I!==null&&m.indexOf(I)===-1&&m.push(I),f)}function Ej(f,m,v,w,I){switch(m){case"focusin":return Du=Sp(Du,f,m,v,w,I),!0;case"dragenter":return $u=Sp($u,f,m,v,w,I),!0;case"mouseover":return Ou=Sp(Ou,f,m,v,w,I),!0;case"pointerover":var T=I.pointerId;return wp.set(T,Sp(wp.get(T)||null,f,m,v,w,I)),!0;case"gotpointercapture":return T=I.pointerId,Cp.set(T,Sp(Cp.get(T)||null,f,m,v,w,I)),!0}return!1}function a$(f){var m=hh(f.target);if(m!==null){var v=a(m);if(v!==null){if(m=v.tag,m===13){if(m=i(v),m!==null){f.blockedOn=m,vq(f.priority,function(){if(v.tag===13){var w=ia();w=Zb(w);var I=Eh(v,w);I!==null&&sa(I,v,w),nC(v,w)}});return}}else if(m===3&&v.stateNode.current.memoizedState.isDehydrated){f.blockedOn=v.tag===3?v.stateNode.containerInfo:null;return}}}f.blockedOn=null}function bx(f){if(f.blockedOn!==null)return!1;for(var m=f.targetContainers;0<m.length;){var v=oC(f.nativeEvent);if(v===null){v=f.nativeEvent;var w=new v.constructor(v.type,v);uw=w,v.target.dispatchEvent(w),uw=null}else return m=fh(v),m!==null&&n$(m),f.blockedOn=v,!1;m.shift()}return!0}function i$(f,m,v){bx(f)&&v.delete(m)}function kj(){iC=!1,Du!==null&&bx(Du)&&(Du=null),$u!==null&&bx($u)&&($u=null),Ou!==null&&bx(Ou)&&(Ou=null),wp.forEach(i$),Cp.forEach(i$)}function wx(f,m){f.blockedOn===m&&(f.blockedOn=null,iC||(iC=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,kj)))}var Cx=null;function s$(f){Cx!==f&&(Cx=f,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){Cx===f&&(Cx=null);for(var m=0;m<f.length;m+=3){var v=f[m],w=f[m+1],I=f[m+2];if(typeof w!="function"){if(aC(w||v)===null)continue;break}var T=fh(v);T!==null&&(f.splice(m,3),m-=3,a2(T,{pending:!0,data:I,method:v.method,action:w},w,I))}}))}function Ep(f){function m(tt){return wx(tt,f)}Du!==null&&wx(Du,f),$u!==null&&wx($u,f),Ou!==null&&wx(Ou,f),wp.forEach(m),Cp.forEach(m);for(var v=0;v<Fu.length;v++){var w=Fu[v];w.blockedOn===f&&(w.blockedOn=null)}for(;0<Fu.length&&(v=Fu[0],v.blockedOn===null);)a$(v),v.blockedOn===null&&Fu.shift();if(v=(f.ownerDocument||f).$$reactFormReplay,v!=null)for(w=0;w<v.length;w+=3){var I=v[w],T=v[w+1],L=I[Fo]||null;if(typeof T=="function")L||s$(v);else if(L){var V=null;if(T&&T.hasAttribute("formAction")){if(I=T,L=T[Fo]||null)V=L.formAction;else if(aC(I)!==null)continue}else V=L.action;typeof V=="function"?v[w+1]=V:(v.splice(w,3),w-=3),s$(v)}}}function sC(f){this._internalRoot=f}Sx.prototype.render=sC.prototype.render=function(f){var m=this._internalRoot;if(m===null)throw Error(r(409));var v=m.current,w=ia();t$(v,w,f,m,null,null)},Sx.prototype.unmount=sC.prototype.unmount=function(){var f=this._internalRoot;if(f!==null){this._internalRoot=null;var m=f.containerInfo;t$(f.current,2,null,f,null,null),ox(),m[ch]=null}};function Sx(f){this._internalRoot=f}Sx.prototype.unstable_scheduleHydration=function(f){if(f){var m=EN();f={blockedOn:null,target:f,priority:m};for(var v=0;v<Fu.length&&m!==0&&m<Fu[v].priority;v++);Fu.splice(v,0,f),v===0&&a$(f)}};var u$=t.version;if(u$!=="19.1.0")throw Error(r(527,u$,"19.1.0"));B.findDOMNode=function(f){var m=f._reactInternals;if(m===void 0)throw typeof f.render=="function"?Error(r(188)):(f=Object.keys(f).join(","),Error(r(268,f)));return f=u(m),f=f!==null?l(f):null,f=f===null?null:f.stateNode,f};var Ij={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:F,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ex=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ex.isDisabled&&Ex.supportsFiber)try{cr=Ex.inject(Ij),Ge=Ex}catch{}}return Ip.createRoot=function(f,m){if(!o(f))throw Error(r(299));var v=!1,w="",I=E_,T=k_,L=I_,V=null;return m!=null&&(m.unstable_strictMode===!0&&(v=!0),m.identifierPrefix!==void 0&&(w=m.identifierPrefix),m.onUncaughtError!==void 0&&(I=m.onUncaughtError),m.onCaughtError!==void 0&&(T=m.onCaughtError),m.onRecoverableError!==void 0&&(L=m.onRecoverableError),m.unstable_transitionCallbacks!==void 0&&(V=m.unstable_transitionCallbacks)),m=ZD(f,1,!1,null,null,v,w,I,T,L,V,null),f[ch]=m.current,V2(f),new sC(m)},Ip.hydrateRoot=function(f,m,v){if(!o(f))throw Error(r(299));var w=!1,I="",T=E_,L=k_,V=I_,tt=null,vt=null;return v!=null&&(v.unstable_strictMode===!0&&(w=!0),v.identifierPrefix!==void 0&&(I=v.identifierPrefix),v.onUncaughtError!==void 0&&(T=v.onUncaughtError),v.onCaughtError!==void 0&&(L=v.onCaughtError),v.onRecoverableError!==void 0&&(V=v.onRecoverableError),v.unstable_transitionCallbacks!==void 0&&(tt=v.unstable_transitionCallbacks),v.formState!==void 0&&(vt=v.formState)),m=ZD(f,1,!0,m,v??null,w,I,T,L,V,tt,vt),m.context=JD(null),v=m.current,w=ia(),w=Zb(w),I=xu(w),I.callback=null,yu(v,I,w),v=w,m.current.lanes=v,Ad(m,v),Ai(m),f[ch]=m.current,V2(f),new Sx(m)},Ip.version="19.1.0",Ip}var x$;function zj(){if(x$)return cC.exports;x$=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(t){console.error(t)}}return n(),cC.exports=Bj(),cC.exports}var Uj=zj();/**
 * react-router v7.7.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var y$="popstate";function Wj(n={}){function t(r,o){let{pathname:a,search:i,hash:s}=r.location;return NS("",{pathname:a,search:i,hash:s},o.state&&o.state.usr||null,o.state&&o.state.key||"default")}function e(r,o){return typeof o=="string"?o:Jp(o)}return Gj(t,e,null,n)}function Wn(n,t){if(n===!1||n===null||typeof n>"u")throw new Error(t)}function ts(n,t){if(!n){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function Vj(){return Math.random().toString(36).substring(2,10)}function b$(n,t){return{usr:n.state,key:n.key,idx:t}}function NS(n,t,e=null,r){return{pathname:typeof n=="string"?n:n.pathname,search:"",hash:"",...typeof t=="string"?Jf(t):t,state:e,key:t&&t.key||r||Vj()}}function Jp({pathname:n="/",search:t="",hash:e=""}){return t&&t!=="?"&&(n+=t.charAt(0)==="?"?t:"?"+t),e&&e!=="#"&&(n+=e.charAt(0)==="#"?e:"#"+e),n}function Jf(n){let t={};if(n){let e=n.indexOf("#");e>=0&&(t.hash=n.substring(e),n=n.substring(0,e));let r=n.indexOf("?");r>=0&&(t.search=n.substring(r),n=n.substring(0,r)),n&&(t.pathname=n)}return t}function Gj(n,t,e,r={}){let{window:o=document.defaultView,v5Compat:a=!1}=r,i=o.history,s="POP",u=null,l=c();l==null&&(l=0,i.replaceState({...i.state,idx:l},""));function c(){return(i.state||{idx:null}).idx}function h(){s="POP";let y=c(),b=y==null?null:y-l;l=y,u&&u({action:s,location:x.location,delta:b})}function d(y,b){s="PUSH";let C=NS(x.location,y,b);l=c()+1;let E=b$(C,l),S=x.createHref(C);try{i.pushState(E,"",S)}catch(k){if(k instanceof DOMException&&k.name==="DataCloneError")throw k;o.location.assign(S)}a&&u&&u({action:s,location:x.location,delta:1})}function p(y,b){s="REPLACE";let C=NS(x.location,y,b);l=c();let E=b$(C,l),S=x.createHref(C);i.replaceState(E,"",S),a&&u&&u({action:s,location:x.location,delta:0})}function g(y){return Hj(y)}let x={get action(){return s},get location(){return n(o,i)},listen(y){if(u)throw new Error("A history only accepts one active listener");return o.addEventListener(y$,h),u=y,()=>{o.removeEventListener(y$,h),u=null}},createHref(y){return t(o,y)},createURL:g,encodeLocation(y){let b=g(y);return{pathname:b.pathname,search:b.search,hash:b.hash}},push:d,replace:p,go(y){return i.go(y)}};return x}function Hj(n,t=!1){let e="http://localhost";typeof window<"u"&&(e=window.location.origin!=="null"?window.location.origin:window.location.href),Wn(e,"No window.location.(origin|href) available to create URL");let r=typeof n=="string"?n:Jp(n);return r=r.replace(/ $/,"%20"),!t&&r.startsWith("//")&&(r=e+r),new URL(r,e)}function RM(n,t,e="/"){return qj(n,t,e,!1)}function qj(n,t,e,r){let o=typeof t=="string"?Jf(t):t,a=js(o.pathname||"/",e);if(a==null)return null;let i=TM(n);jj(i);let s=null;for(let u=0;s==null&&u<i.length;++u){let l=oX(a);s=nX(i[u],l,r)}return s}function TM(n,t=[],e=[],r=""){let o=(a,i,s)=>{let u={relativePath:s===void 0?a.path||"":s,caseSensitive:a.caseSensitive===!0,childrenIndex:i,route:a};u.relativePath.startsWith("/")&&(Wn(u.relativePath.startsWith(r),`Absolute route path "${u.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),u.relativePath=u.relativePath.slice(r.length));let l=Hs([r,u.relativePath]),c=e.concat(u);a.children&&a.children.length>0&&(Wn(a.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${l}".`),TM(a.children,t,c,l)),!(a.path==null&&!a.index)&&t.push({path:l,score:tX(l,a.index),routesMeta:c})};return n.forEach((a,i)=>{if(a.path===""||!a.path?.includes("?"))o(a,i);else for(let s of NM(a.path))o(a,i,s)}),t}function NM(n){let t=n.split("/");if(t.length===0)return[];let[e,...r]=t,o=e.endsWith("?"),a=e.replace(/\?$/,"");if(r.length===0)return o?[a,""]:[a];let i=NM(r.join("/")),s=[];return s.push(...i.map(u=>u===""?a:[a,u].join("/"))),o&&s.push(...i),s.map(u=>n.startsWith("/")&&u===""?"/":u)}function jj(n){n.sort((t,e)=>t.score!==e.score?e.score-t.score:eX(t.routesMeta.map(r=>r.childrenIndex),e.routesMeta.map(r=>r.childrenIndex)))}var Xj=/^:[\w-]+$/,Kj=3,Yj=2,Qj=1,Zj=10,Jj=-2,w$=n=>n==="*";function tX(n,t){let e=n.split("/"),r=e.length;return e.some(w$)&&(r+=Jj),t&&(r+=Yj),e.filter(o=>!w$(o)).reduce((o,a)=>o+(Xj.test(a)?Kj:a===""?Qj:Zj),r)}function eX(n,t){return n.length===t.length&&n.slice(0,-1).every((r,o)=>r===t[o])?n[n.length-1]-t[t.length-1]:0}function nX(n,t,e=!1){let{routesMeta:r}=n,o={},a="/",i=[];for(let s=0;s<r.length;++s){let u=r[s],l=s===r.length-1,c=a==="/"?t:t.slice(a.length)||"/",h=M0({path:u.relativePath,caseSensitive:u.caseSensitive,end:l},c),d=u.route;if(!h&&l&&e&&!r[r.length-1].route.index&&(h=M0({path:u.relativePath,caseSensitive:u.caseSensitive,end:!1},c)),!h)return null;Object.assign(o,h.params),i.push({params:o,pathname:Hs([a,h.pathname]),pathnameBase:uX(Hs([a,h.pathnameBase])),route:d}),h.pathnameBase!=="/"&&(a=Hs([a,h.pathnameBase]))}return i}function M0(n,t){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[e,r]=rX(n.path,n.caseSensitive,n.end),o=t.match(e);if(!o)return null;let a=o[0],i=a.replace(/(.)\/+$/,"$1"),s=o.slice(1);return{params:r.reduce((l,{paramName:c,isOptional:h},d)=>{if(c==="*"){let g=s[d]||"";i=a.slice(0,a.length-g.length).replace(/(.)\/+$/,"$1")}const p=s[d];return h&&!p?l[c]=void 0:l[c]=(p||"").replace(/%2F/g,"/"),l},{}),pathname:a,pathnameBase:i,pattern:n}}function rX(n,t=!1,e=!0){ts(n==="*"||!n.endsWith("*")||n.endsWith("/*"),`Route path "${n}" will be treated as if it were "${n.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${n.replace(/\*$/,"/*")}".`);let r=[],o="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(i,s,u)=>(r.push({paramName:s,isOptional:u!=null}),u?"/?([^\\/]+)?":"/([^\\/]+)"));return n.endsWith("*")?(r.push({paramName:"*"}),o+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):e?o+="\\/*$":n!==""&&n!=="/"&&(o+="(?:(?=\\/|$))"),[new RegExp(o,t?void 0:"i"),r]}function oX(n){try{return n.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return ts(!1,`The URL path "${n}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${t}).`),n}}function js(n,t){if(t==="/")return n;if(!n.toLowerCase().startsWith(t.toLowerCase()))return null;let e=t.endsWith("/")?t.length-1:t.length,r=n.charAt(e);return r&&r!=="/"?null:n.slice(e)||"/"}function aX(n,t="/"){let{pathname:e,search:r="",hash:o=""}=typeof n=="string"?Jf(n):n;return{pathname:e?e.startsWith("/")?e:iX(e,t):t,search:lX(r),hash:cX(o)}}function iX(n,t){let e=t.replace(/\/+$/,"").split("/");return n.split("/").forEach(o=>{o===".."?e.length>1&&e.pop():o!=="."&&e.push(o)}),e.length>1?e.join("/"):"/"}function pC(n,t,e,r){return`Cannot include a '${n}' character in a manually specified \`to.${t}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${e}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function sX(n){return n.filter((t,e)=>e===0||t.route.path&&t.route.path.length>0)}function AM(n){let t=sX(n);return t.map((e,r)=>r===t.length-1?e.pathname:e.pathnameBase)}function _M(n,t,e,r=!1){let o;typeof n=="string"?o=Jf(n):(o={...n},Wn(!o.pathname||!o.pathname.includes("?"),pC("?","pathname","search",o)),Wn(!o.pathname||!o.pathname.includes("#"),pC("#","pathname","hash",o)),Wn(!o.search||!o.search.includes("#"),pC("#","search","hash",o)));let a=n===""||o.pathname==="",i=a?"/":o.pathname,s;if(i==null)s=e;else{let h=t.length-1;if(!r&&i.startsWith("..")){let d=i.split("/");for(;d[0]==="..";)d.shift(),h-=1;o.pathname=d.join("/")}s=h>=0?t[h]:"/"}let u=aX(o,s),l=i&&i!=="/"&&i.endsWith("/"),c=(a||i===".")&&e.endsWith("/");return!u.pathname.endsWith("/")&&(l||c)&&(u.pathname+="/"),u}var Hs=n=>n.join("/").replace(/\/\/+/g,"/"),uX=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),lX=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,cX=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;function hX(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}var DM=["POST","PUT","PATCH","DELETE"];new Set(DM);var fX=["GET",...DM];new Set(fX);var td=_t.createContext(null);td.displayName="DataRouter";var qy=_t.createContext(null);qy.displayName="DataRouterState";_t.createContext(!1);var $M=_t.createContext({isTransitioning:!1});$M.displayName="ViewTransition";var dX=_t.createContext(new Map);dX.displayName="Fetchers";var pX=_t.createContext(null);pX.displayName="Await";var ls=_t.createContext(null);ls.displayName="Navigation";var bm=_t.createContext(null);bm.displayName="Location";var Js=_t.createContext({outlet:null,matches:[],isDataRoute:!1});Js.displayName="Route";var sk=_t.createContext(null);sk.displayName="RouteError";function mX(n,{relative:t}={}){Wn(wm(),"useHref() may be used only in the context of a <Router> component.");let{basename:e,navigator:r}=_t.useContext(ls),{hash:o,pathname:a,search:i}=Cm(n,{relative:t}),s=a;return e!=="/"&&(s=a==="/"?e:Hs([e,a])),r.createHref({pathname:s,search:i,hash:o})}function wm(){return _t.useContext(bm)!=null}function dl(){return Wn(wm(),"useLocation() may be used only in the context of a <Router> component."),_t.useContext(bm).location}var OM="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function FM(n){_t.useContext(ls).static||_t.useLayoutEffect(n)}function gX(){let{isDataRoute:n}=_t.useContext(Js);return n?NX():vX()}function vX(){Wn(wm(),"useNavigate() may be used only in the context of a <Router> component.");let n=_t.useContext(td),{basename:t,navigator:e}=_t.useContext(ls),{matches:r}=_t.useContext(Js),{pathname:o}=dl(),a=JSON.stringify(AM(r)),i=_t.useRef(!1);return FM(()=>{i.current=!0}),_t.useCallback((u,l={})=>{if(ts(i.current,OM),!i.current)return;if(typeof u=="number"){e.go(u);return}let c=_M(u,JSON.parse(a),o,l.relative==="path");n==null&&t!=="/"&&(c.pathname=c.pathname==="/"?t:Hs([t,c.pathname])),(l.replace?e.replace:e.push)(c,l.state,l)},[t,e,a,o,n])}_t.createContext(null);function Cm(n,{relative:t}={}){let{matches:e}=_t.useContext(Js),{pathname:r}=dl(),o=JSON.stringify(AM(e));return _t.useMemo(()=>_M(n,JSON.parse(o),r,t==="path"),[n,o,r,t])}function xX(n,t){return MM(n,t)}function MM(n,t,e,r){Wn(wm(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:o}=_t.useContext(ls),{matches:a}=_t.useContext(Js),i=a[a.length-1],s=i?i.params:{},u=i?i.pathname:"/",l=i?i.pathnameBase:"/",c=i&&i.route;{let b=c&&c.path||"";LM(u,!c||b.endsWith("*")||b.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${u}" (under <Route path="${b}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${b}"> to <Route path="${b==="/"?"*":`${b}/*`}">.`)}let h=dl(),d;if(t){let b=typeof t=="string"?Jf(t):t;Wn(l==="/"||b.pathname?.startsWith(l),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${l}" but pathname "${b.pathname}" was given in the \`location\` prop.`),d=b}else d=h;let p=d.pathname||"/",g=p;if(l!=="/"){let b=l.replace(/^\//,"").split("/");g="/"+p.replace(/^\//,"").split("/").slice(b.length).join("/")}let x=RM(n,{pathname:g});ts(c||x!=null,`No routes matched location "${d.pathname}${d.search}${d.hash}" `),ts(x==null||x[x.length-1].route.element!==void 0||x[x.length-1].route.Component!==void 0||x[x.length-1].route.lazy!==void 0,`Matched leaf route at location "${d.pathname}${d.search}${d.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let y=SX(x&&x.map(b=>Object.assign({},b,{params:Object.assign({},s,b.params),pathname:Hs([l,o.encodeLocation?o.encodeLocation(b.pathname).pathname:b.pathname]),pathnameBase:b.pathnameBase==="/"?l:Hs([l,o.encodeLocation?o.encodeLocation(b.pathnameBase).pathname:b.pathnameBase])})),a,e,r);return t&&y?_t.createElement(bm.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...d},navigationType:"POP"}},y):y}function yX(){let n=TX(),t=hX(n)?`${n.status} ${n.statusText}`:n instanceof Error?n.message:JSON.stringify(n),e=n instanceof Error?n.stack:null,r="rgba(200,200,200, 0.5)",o={padding:"0.5rem",backgroundColor:r},a={padding:"2px 4px",backgroundColor:r},i=null;return console.error("Error handled by React Router default ErrorBoundary:",n),i=_t.createElement(_t.Fragment,null,_t.createElement("p",null,"💿 Hey developer 👋"),_t.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",_t.createElement("code",{style:a},"ErrorBoundary")," or"," ",_t.createElement("code",{style:a},"errorElement")," prop on your route.")),_t.createElement(_t.Fragment,null,_t.createElement("h2",null,"Unexpected Application Error!"),_t.createElement("h3",{style:{fontStyle:"italic"}},t),e?_t.createElement("pre",{style:o},e):null,i)}var bX=_t.createElement(yX,null),wX=class extends _t.Component{constructor(n){super(n),this.state={location:n.location,revalidation:n.revalidation,error:n.error}}static getDerivedStateFromError(n){return{error:n}}static getDerivedStateFromProps(n,t){return t.location!==n.location||t.revalidation!=="idle"&&n.revalidation==="idle"?{error:n.error,location:n.location,revalidation:n.revalidation}:{error:n.error!==void 0?n.error:t.error,location:t.location,revalidation:n.revalidation||t.revalidation}}componentDidCatch(n,t){console.error("React Router caught the following error during render",n,t)}render(){return this.state.error!==void 0?_t.createElement(Js.Provider,{value:this.props.routeContext},_t.createElement(sk.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function CX({routeContext:n,match:t,children:e}){let r=_t.useContext(td);return r&&r.static&&r.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=t.route.id),_t.createElement(Js.Provider,{value:n},e)}function SX(n,t=[],e=null,r=null){if(n==null){if(!e)return null;if(e.errors)n=e.matches;else if(t.length===0&&!e.initialized&&e.matches.length>0)n=e.matches;else return null}let o=n,a=e?.errors;if(a!=null){let u=o.findIndex(l=>l.route.id&&a?.[l.route.id]!==void 0);Wn(u>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(a).join(",")}`),o=o.slice(0,Math.min(o.length,u+1))}let i=!1,s=-1;if(e)for(let u=0;u<o.length;u++){let l=o[u];if((l.route.HydrateFallback||l.route.hydrateFallbackElement)&&(s=u),l.route.id){let{loaderData:c,errors:h}=e,d=l.route.loader&&!c.hasOwnProperty(l.route.id)&&(!h||h[l.route.id]===void 0);if(l.route.lazy||d){i=!0,s>=0?o=o.slice(0,s+1):o=[o[0]];break}}}return o.reduceRight((u,l,c)=>{let h,d=!1,p=null,g=null;e&&(h=a&&l.route.id?a[l.route.id]:void 0,p=l.route.errorElement||bX,i&&(s<0&&c===0?(LM("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),d=!0,g=null):s===c&&(d=!0,g=l.route.hydrateFallbackElement||null)));let x=t.concat(o.slice(0,c+1)),y=()=>{let b;return h?b=p:d?b=g:l.route.Component?b=_t.createElement(l.route.Component,null):l.route.element?b=l.route.element:b=u,_t.createElement(CX,{match:l,routeContext:{outlet:u,matches:x,isDataRoute:e!=null},children:b})};return e&&(l.route.ErrorBoundary||l.route.errorElement||c===0)?_t.createElement(wX,{location:e.location,revalidation:e.revalidation,component:p,error:h,children:y(),routeContext:{outlet:null,matches:x,isDataRoute:!0}}):y()},null)}function uk(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function EX(n){let t=_t.useContext(td);return Wn(t,uk(n)),t}function kX(n){let t=_t.useContext(qy);return Wn(t,uk(n)),t}function IX(n){let t=_t.useContext(Js);return Wn(t,uk(n)),t}function lk(n){let t=IX(n),e=t.matches[t.matches.length-1];return Wn(e.route.id,`${n} can only be used on routes that contain a unique "id"`),e.route.id}function RX(){return lk("useRouteId")}function TX(){let n=_t.useContext(sk),t=kX("useRouteError"),e=lk("useRouteError");return n!==void 0?n:t.errors?.[e]}function NX(){let{router:n}=EX("useNavigate"),t=lk("useNavigate"),e=_t.useRef(!1);return FM(()=>{e.current=!0}),_t.useCallback(async(o,a={})=>{ts(e.current,OM),e.current&&(typeof o=="number"?n.navigate(o):await n.navigate(o,{fromRouteId:t,...a}))},[n,t])}var C$={};function LM(n,t,e){!t&&!C$[n]&&(C$[n]=!0,ts(!1,e))}_t.memo(AX);function AX({routes:n,future:t,state:e}){return MM(n,void 0,e,t)}function Pp(n){Wn(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function _X({basename:n="/",children:t=null,location:e,navigationType:r="POP",navigator:o,static:a=!1}){Wn(!wm(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let i=n.replace(/^\/*/,"/"),s=_t.useMemo(()=>({basename:i,navigator:o,static:a,future:{}}),[i,o,a]);typeof e=="string"&&(e=Jf(e));let{pathname:u="/",search:l="",hash:c="",state:h=null,key:d="default"}=e,p=_t.useMemo(()=>{let g=js(u,i);return g==null?null:{location:{pathname:g,search:l,hash:c,state:h,key:d},navigationType:r}},[i,u,l,c,h,d,r]);return ts(p!=null,`<Router basename="${i}"> is not able to match the URL "${u}${l}${c}" because it does not start with the basename, so the <Router> won't render anything.`),p==null?null:_t.createElement(ls.Provider,{value:s},_t.createElement(bm.Provider,{children:t,value:p}))}function DX({children:n,location:t}){return xX(AS(n),t)}function AS(n,t=[]){let e=[];return _t.Children.forEach(n,(r,o)=>{if(!_t.isValidElement(r))return;let a=[...t,o];if(r.type===_t.Fragment){e.push.apply(e,AS(r.props.children,a));return}Wn(r.type===Pp,`[${typeof r.type=="string"?r.type:r.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Wn(!r.props.index||!r.props.children,"An index route cannot have child routes.");let i={id:r.props.id||a.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,hydrateFallbackElement:r.props.hydrateFallbackElement,HydrateFallback:r.props.HydrateFallback,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.hasErrorBoundary===!0||r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(i.children=AS(r.props.children,a)),e.push(i)}),e}var i0="get",s0="application/x-www-form-urlencoded";function jy(n){return n!=null&&typeof n.tagName=="string"}function $X(n){return jy(n)&&n.tagName.toLowerCase()==="button"}function OX(n){return jy(n)&&n.tagName.toLowerCase()==="form"}function FX(n){return jy(n)&&n.tagName.toLowerCase()==="input"}function MX(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function LX(n,t){return n.button===0&&(!t||t==="_self")&&!MX(n)}var kx=null;function PX(){if(kx===null)try{new FormData(document.createElement("form"),0),kx=!1}catch{kx=!0}return kx}var BX=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function mC(n){return n!=null&&!BX.has(n)?(ts(!1,`"${n}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${s0}"`),null):n}function zX(n,t){let e,r,o,a,i;if(OX(n)){let s=n.getAttribute("action");r=s?js(s,t):null,e=n.getAttribute("method")||i0,o=mC(n.getAttribute("enctype"))||s0,a=new FormData(n)}else if($X(n)||FX(n)&&(n.type==="submit"||n.type==="image")){let s=n.form;if(s==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let u=n.getAttribute("formaction")||s.getAttribute("action");if(r=u?js(u,t):null,e=n.getAttribute("formmethod")||s.getAttribute("method")||i0,o=mC(n.getAttribute("formenctype"))||mC(s.getAttribute("enctype"))||s0,a=new FormData(s,n),!PX()){let{name:l,type:c,value:h}=n;if(c==="image"){let d=l?`${l}.`:"";a.append(`${d}x`,"0"),a.append(`${d}y`,"0")}else l&&a.append(l,h)}}else{if(jy(n))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');e=i0,r=null,o=s0,i=n}return a&&o==="text/plain"&&(i=a,a=void 0),{action:r,method:e.toLowerCase(),encType:o,formData:a,body:i}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function ck(n,t){if(n===!1||n===null||typeof n>"u")throw new Error(t)}function UX(n,t,e){let r=typeof n=="string"?new URL(n,typeof window>"u"?"server://singlefetch/":window.location.origin):n;return r.pathname==="/"?r.pathname=`_root.${e}`:t&&js(r.pathname,t)==="/"?r.pathname=`${t.replace(/\/$/,"")}/_root.${e}`:r.pathname=`${r.pathname.replace(/\/$/,"")}.${e}`,r}async function WX(n,t){if(n.id in t)return t[n.id];try{let e=await import(n.module);return t[n.id]=e,e}catch(e){return console.error(`Error loading route module \`${n.module}\`, reloading page...`),console.error(e),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function VX(n){return n==null?!1:n.href==null?n.rel==="preload"&&typeof n.imageSrcSet=="string"&&typeof n.imageSizes=="string":typeof n.rel=="string"&&typeof n.href=="string"}async function GX(n,t,e){let r=await Promise.all(n.map(async o=>{let a=t.routes[o.route.id];if(a){let i=await WX(a,e);return i.links?i.links():[]}return[]}));return XX(r.flat(1).filter(VX).filter(o=>o.rel==="stylesheet"||o.rel==="preload").map(o=>o.rel==="stylesheet"?{...o,rel:"prefetch",as:"style"}:{...o,rel:"prefetch"}))}function S$(n,t,e,r,o,a){let i=(u,l)=>e[l]?u.route.id!==e[l].route.id:!0,s=(u,l)=>e[l].pathname!==u.pathname||e[l].route.path?.endsWith("*")&&e[l].params["*"]!==u.params["*"];return a==="assets"?t.filter((u,l)=>i(u,l)||s(u,l)):a==="data"?t.filter((u,l)=>{let c=r.routes[u.route.id];if(!c||!c.hasLoader)return!1;if(i(u,l)||s(u,l))return!0;if(u.route.shouldRevalidate){let h=u.route.shouldRevalidate({currentUrl:new URL(o.pathname+o.search+o.hash,window.origin),currentParams:e[0]?.params||{},nextUrl:new URL(n,window.origin),nextParams:u.params,defaultShouldRevalidate:!0});if(typeof h=="boolean")return h}return!0}):[]}function HX(n,t,{includeHydrateFallback:e}={}){return qX(n.map(r=>{let o=t.routes[r.route.id];if(!o)return[];let a=[o.module];return o.clientActionModule&&(a=a.concat(o.clientActionModule)),o.clientLoaderModule&&(a=a.concat(o.clientLoaderModule)),e&&o.hydrateFallbackModule&&(a=a.concat(o.hydrateFallbackModule)),o.imports&&(a=a.concat(o.imports)),a}).flat(1))}function qX(n){return[...new Set(n)]}function jX(n){let t={},e=Object.keys(n).sort();for(let r of e)t[r]=n[r];return t}function XX(n,t){let e=new Set;return new Set(t),n.reduce((r,o)=>{let a=JSON.stringify(jX(o));return e.has(a)||(e.add(a),r.push({key:a,link:o})),r},[])}function PM(){let n=_t.useContext(td);return ck(n,"You must render this element inside a <DataRouterContext.Provider> element"),n}function KX(){let n=_t.useContext(qy);return ck(n,"You must render this element inside a <DataRouterStateContext.Provider> element"),n}var hk=_t.createContext(void 0);hk.displayName="FrameworkContext";function BM(){let n=_t.useContext(hk);return ck(n,"You must render this element inside a <HydratedRouter> element"),n}function YX(n,t){let e=_t.useContext(hk),[r,o]=_t.useState(!1),[a,i]=_t.useState(!1),{onFocus:s,onBlur:u,onMouseEnter:l,onMouseLeave:c,onTouchStart:h}=t,d=_t.useRef(null);_t.useEffect(()=>{if(n==="render"&&i(!0),n==="viewport"){let x=b=>{b.forEach(C=>{i(C.isIntersecting)})},y=new IntersectionObserver(x,{threshold:.5});return d.current&&y.observe(d.current),()=>{y.disconnect()}}},[n]),_t.useEffect(()=>{if(r){let x=setTimeout(()=>{i(!0)},100);return()=>{clearTimeout(x)}}},[r]);let p=()=>{o(!0)},g=()=>{o(!1),i(!1)};return e?n!=="intent"?[a,d,{}]:[a,d,{onFocus:Rp(s,p),onBlur:Rp(u,g),onMouseEnter:Rp(l,p),onMouseLeave:Rp(c,g),onTouchStart:Rp(h,p)}]:[!1,d,{}]}function Rp(n,t){return e=>{n&&n(e),e.defaultPrevented||t(e)}}function QX({page:n,...t}){let{router:e}=PM(),r=_t.useMemo(()=>RM(e.routes,n,e.basename),[e.routes,n,e.basename]);return r?_t.createElement(JX,{page:n,matches:r,...t}):null}function ZX(n){let{manifest:t,routeModules:e}=BM(),[r,o]=_t.useState([]);return _t.useEffect(()=>{let a=!1;return GX(n,t,e).then(i=>{a||o(i)}),()=>{a=!0}},[n,t,e]),r}function JX({page:n,matches:t,...e}){let r=dl(),{manifest:o,routeModules:a}=BM(),{basename:i}=PM(),{loaderData:s,matches:u}=KX(),l=_t.useMemo(()=>S$(n,t,u,o,r,"data"),[n,t,u,o,r]),c=_t.useMemo(()=>S$(n,t,u,o,r,"assets"),[n,t,u,o,r]),h=_t.useMemo(()=>{if(n===r.pathname+r.search+r.hash)return[];let g=new Set,x=!1;if(t.forEach(b=>{let C=o.routes[b.route.id];!C||!C.hasLoader||(!l.some(E=>E.route.id===b.route.id)&&b.route.id in s&&a[b.route.id]?.shouldRevalidate||C.hasClientLoader?x=!0:g.add(b.route.id))}),g.size===0)return[];let y=UX(n,i,"data");return x&&g.size>0&&y.searchParams.set("_routes",t.filter(b=>g.has(b.route.id)).map(b=>b.route.id).join(",")),[y.pathname+y.search]},[i,s,r,o,l,t,n,a]),d=_t.useMemo(()=>HX(c,o),[c,o]),p=ZX(c);return _t.createElement(_t.Fragment,null,h.map(g=>_t.createElement("link",{key:g,rel:"prefetch",as:"fetch",href:g,...e})),d.map(g=>_t.createElement("link",{key:g,rel:"modulepreload",href:g,...e})),p.map(({key:g,link:x})=>_t.createElement("link",{key:g,...x})))}function tK(...n){return t=>{n.forEach(e=>{typeof e=="function"?e(t):e!=null&&(e.current=t)})}}var zM=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{zM&&(window.__reactRouterVersion="7.7.1")}catch{}function eK({basename:n,children:t,window:e}){let r=_t.useRef();r.current==null&&(r.current=Wj({window:e,v5Compat:!0}));let o=r.current,[a,i]=_t.useState({action:o.action,location:o.location}),s=_t.useCallback(u=>{_t.startTransition(()=>i(u))},[i]);return _t.useLayoutEffect(()=>o.listen(s),[o,s]),_t.createElement(_X,{basename:n,children:t,location:a.location,navigationType:a.action,navigator:o})}var UM=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,sc=_t.forwardRef(function({onClick:t,discover:e="render",prefetch:r="none",relative:o,reloadDocument:a,replace:i,state:s,target:u,to:l,preventScrollReset:c,viewTransition:h,...d},p){let{basename:g}=_t.useContext(ls),x=typeof l=="string"&&UM.test(l),y,b=!1;if(typeof l=="string"&&x&&(y=l,zM))try{let _=new URL(window.location.href),$=l.startsWith("//")?new URL(_.protocol+l):new URL(l),D=js($.pathname,g);$.origin===_.origin&&D!=null?l=D+$.search+$.hash:b=!0}catch{ts(!1,`<Link to="${l}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let C=mX(l,{relative:o}),[E,S,k]=YX(r,d),R=aK(l,{replace:i,state:s,target:u,preventScrollReset:c,relative:o,viewTransition:h});function A(_){t&&t(_),_.defaultPrevented||R(_)}let N=_t.createElement("a",{...d,...k,href:y||C,onClick:b||a?t:A,ref:tK(p,S),target:u,"data-discover":!x&&e==="render"?"true":void 0});return E&&!x?_t.createElement(_t.Fragment,null,N,_t.createElement(QX,{page:C})):N});sc.displayName="Link";var nK=_t.forwardRef(function({"aria-current":t="page",caseSensitive:e=!1,className:r="",end:o=!1,style:a,to:i,viewTransition:s,children:u,...l},c){let h=Cm(i,{relative:l.relative}),d=dl(),p=_t.useContext(qy),{navigator:g,basename:x}=_t.useContext(ls),y=p!=null&&cK(h)&&s===!0,b=g.encodeLocation?g.encodeLocation(h).pathname:h.pathname,C=d.pathname,E=p&&p.navigation&&p.navigation.location?p.navigation.location.pathname:null;e||(C=C.toLowerCase(),E=E?E.toLowerCase():null,b=b.toLowerCase()),E&&x&&(E=js(E,x)||E);const S=b!=="/"&&b.endsWith("/")?b.length-1:b.length;let k=C===b||!o&&C.startsWith(b)&&C.charAt(S)==="/",R=E!=null&&(E===b||!o&&E.startsWith(b)&&E.charAt(b.length)==="/"),A={isActive:k,isPending:R,isTransitioning:y},N=k?t:void 0,_;typeof r=="function"?_=r(A):_=[r,k?"active":null,R?"pending":null,y?"transitioning":null].filter(Boolean).join(" ");let $=typeof a=="function"?a(A):a;return _t.createElement(sc,{...l,"aria-current":N,className:_,ref:c,style:$,to:i,viewTransition:s},typeof u=="function"?u(A):u)});nK.displayName="NavLink";var rK=_t.forwardRef(({discover:n="render",fetcherKey:t,navigate:e,reloadDocument:r,replace:o,state:a,method:i=i0,action:s,onSubmit:u,relative:l,preventScrollReset:c,viewTransition:h,...d},p)=>{let g=uK(),x=lK(s,{relative:l}),y=i.toLowerCase()==="get"?"get":"post",b=typeof s=="string"&&UM.test(s),C=E=>{if(u&&u(E),E.defaultPrevented)return;E.preventDefault();let S=E.nativeEvent.submitter,k=S?.getAttribute("formmethod")||i;g(S||E.currentTarget,{fetcherKey:t,method:k,navigate:e,replace:o,state:a,relative:l,preventScrollReset:c,viewTransition:h})};return _t.createElement("form",{ref:p,method:y,action:x,onSubmit:r?u:C,...d,"data-discover":!b&&n==="render"?"true":void 0})});rK.displayName="Form";function oK(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function WM(n){let t=_t.useContext(td);return Wn(t,oK(n)),t}function aK(n,{target:t,replace:e,state:r,preventScrollReset:o,relative:a,viewTransition:i}={}){let s=gX(),u=dl(),l=Cm(n,{relative:a});return _t.useCallback(c=>{if(LX(c,t)){c.preventDefault();let h=e!==void 0?e:Jp(u)===Jp(l);s(n,{replace:h,state:r,preventScrollReset:o,relative:a,viewTransition:i})}},[u,s,l,e,r,t,n,o,a,i])}var iK=0,sK=()=>`__${String(++iK)}__`;function uK(){let{router:n}=WM("useSubmit"),{basename:t}=_t.useContext(ls),e=RX();return _t.useCallback(async(r,o={})=>{let{action:a,method:i,encType:s,formData:u,body:l}=zX(r,t);if(o.navigate===!1){let c=o.fetcherKey||sK();await n.fetch(c,e,o.action||a,{preventScrollReset:o.preventScrollReset,formData:u,body:l,formMethod:o.method||i,formEncType:o.encType||s,flushSync:o.flushSync})}else await n.navigate(o.action||a,{preventScrollReset:o.preventScrollReset,formData:u,body:l,formMethod:o.method||i,formEncType:o.encType||s,replace:o.replace,state:o.state,fromRouteId:e,flushSync:o.flushSync,viewTransition:o.viewTransition})},[n,t,e])}function lK(n,{relative:t}={}){let{basename:e}=_t.useContext(ls),r=_t.useContext(Js);Wn(r,"useFormAction must be used inside a RouteContext");let[o]=r.matches.slice(-1),a={...Cm(n||".",{relative:t})},i=dl();if(n==null){a.search=i.search;let s=new URLSearchParams(a.search),u=s.getAll("index");if(u.some(c=>c==="")){s.delete("index"),u.filter(h=>h).forEach(h=>s.append("index",h));let c=s.toString();a.search=c?`?${c}`:""}}return(!n||n===".")&&o.route.index&&(a.search=a.search?a.search.replace(/^\?/,"?index&"):"?index"),e!=="/"&&(a.pathname=a.pathname==="/"?e:Hs([e,a.pathname])),Jp(a)}function cK(n,{relative:t}={}){let e=_t.useContext($M);Wn(e!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=WM("useViewTransitionState"),o=Cm(n,{relative:t});if(!e.isTransitioning)return!1;let a=js(e.currentLocation.pathname,r)||e.currentLocation.pathname,i=js(e.nextLocation.pathname,r)||e.nextLocation.pathname;return M0(o.pathname,i)!=null||M0(o.pathname,a)!=null}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var _S=function(n,t){return _S=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var o in r)r.hasOwnProperty(o)&&(e[o]=r[o])},_S(n,t)};function Se(n,t){_S(n,t);function e(){this.constructor=n}n.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var ci=function(){return ci=Object.assign||function(t){for(var e,r=1,o=arguments.length;r<o;r++){e=arguments[r];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])}return t},ci.apply(this,arguments)};function ie(n,t,e,r){function o(a){return a instanceof e?a:new e(function(i){i(a)})}return new(e||(e=Promise))(function(a,i){function s(c){try{l(r.next(c))}catch(h){i(h)}}function u(c){try{l(r.throw(c))}catch(h){i(h)}}function l(c){c.done?a(c.value):o(c.value).then(s,u)}l((r=r.apply(n,[])).next())})}function se(n,t){var e={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},r,o,a,i;return i={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function s(l){return function(c){return u([l,c])}}function u(l){if(r)throw new TypeError("Generator is already executing.");for(;e;)try{if(r=1,o&&(a=l[0]&2?o.return:l[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,l[1])).done)return a;switch(o=0,a&&(l=[l[0]&2,a.value]),l[0]){case 0:case 1:a=l;break;case 4:return e.label++,{value:l[1],done:!1};case 5:e.label++,o=l[1],l=[0];continue;case 7:l=e.ops.pop(),e.trys.pop();continue;default:if(a=e.trys,!(a=a.length>0&&a[a.length-1])&&(l[0]===6||l[0]===2)){e=0;continue}if(l[0]===3&&(!a||l[1]>a[0]&&l[1]<a[3])){e.label=l[1];break}if(l[0]===6&&e.label<a[1]){e.label=a[1],a=l;break}if(a&&e.label<a[2]){e.label=a[2],e.ops.push(l);break}a[2]&&e.ops.pop(),e.trys.pop();continue}l=t.call(n,e)}catch(c){l=[6,c],o=0}finally{r=a=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function gC(){for(var n=0,t=0,e=arguments.length;t<e;t++)n+=arguments[t].length;for(var r=Array(n),o=0,t=0;t<e;t++)for(var a=arguments[t],i=0,s=a.length;i<s;i++,o++)r[o]=a[i];return r}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var VM=function(n,t){return(VM=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var o in r)r.hasOwnProperty(o)&&(e[o]=r[o])})(n,t)};function tu(n,t){function e(){this.constructor=n}VM(n,t),n.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}function bn(n,t,e,r){return new(e||(e=Promise))(function(o,a){function i(l){try{u(r.next(l))}catch(c){a(c)}}function s(l){try{u(r.throw(l))}catch(c){a(c)}}function u(l){l.done?o(l.value):new e(function(c){c(l.value)}).then(i,s)}u((r=r.apply(n,[])).next())})}function wn(n,t){var e,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function s(u){return function(l){return function(c){if(e)throw new TypeError("Generator is already executing.");for(;i;)try{if(e=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(c[0]===6||c[0]===2)){i=0;continue}if(c[0]===3&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(c[0]===6&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(n,i)}catch(h){c=[6,h],r=0}finally{e=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([u,l])}}}var nc={},vC={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function hK(n,t){nc[n]=t}function cs(n){n in nc||(nc[n]=fK(n));var t=nc[n];return t.isContextLost()?(delete nc[n],cs(n)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),nc[n])}function fK(n){if(n!==1&&n!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var t=document.createElement("canvas");return t.addEventListener("webglcontextlost",function(e){e.preventDefault(),delete nc[n]},!1),n===1?t.getContext("webgl",vC)||t.getContext("experimental-webgl",vC):t.getContext("webgl2",vC)}function dK(){var n=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(n)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(n.substr(0,4))}function DS(n,t,e){return Math.max(n,Math.min(t,e))}function Af(n){return n%2==0?n:n+1}function pK(n){for(var t=0,e=0;e<n.length;e++)t+=n[e];return t}function mK(n,t){var e=Math.random();return t*e+(1-e)*n}function et(n,t){if(!n)throw new Error(typeof t=="string"?t:t())}function Cn(n,t,e){e===void 0&&(e=""),et(Ao(n,t),function(){return e+" Shapes "+n+" and "+t+" must match"})}function ed(n){et(n!=null,function(){return"The input to the tensor constructor must be a non-null value."})}function _f(n,t){if(t===void 0&&(t=[]),t==null&&(t=[]),Array.isArray(n)||Xs(n))for(var e=0;e<n.length;++e)_f(n[e],t);else t.push(n);return t}function de(n){if(n.length===0)return 1;for(var t=n[0],e=1;e<n.length;e++)t*=n[e];return t}function Ao(n,t){if(n===t)return!0;if(n==null||t==null||n.length!==t.length)return!1;for(var e=0;e<n.length;e++)if(n[e]!==t[e])return!1;return!0}function Va(n){return n%1==0}function gK(n){if(Math.tanh!=null)return Math.tanh(n);if(n===1/0)return 1;if(n===-1/0)return-1;var t=Math.exp(2*n);return(t-1)/(t+1)}function E$(n){var t=Math.ceil(Math.sqrt(n));return[t,Math.ceil(n/t)]}function pf(n,t){return t<=n.length?n:n+" ".repeat(t-n.length)}function k$(n,t,e){return t===void 0&&(t=function(r){return 0}),new Promise(function(r,o){var a=0,i=function(){if(n())r();else{var s=t(++a);e!=null&&a>=e?o():setTimeout(i,s)}};i()})}function vK(n,t){for(var e=1,r=-1,o=0;o<n.length;++o)if(n[o]>=0)e*=n[o];else if(n[o]===-1){if(r!==-1)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+o);r=o}else if(n[o]<0)throw Error("Shapes can not be < 0. Found "+n[o]+" at dim "+o);if(r===-1){if(t>0&&t!==e)throw Error("Size("+t+") must match the product of shape "+n);return n}if(e===0)throw Error("Cannot infer the missing size in ["+n+"] when there are 0 elements");if(t%e!=0)throw Error("The implicit shape can't be a fractional number. Got "+t+" / "+e);var a=n.slice();return a[r]=t/e,a}function no(n,t){var e=t.length;return et((n=n==null?t.map(function(r,o){return o}):[].concat(n)).every(function(r){return r>=-e&&r<e}),function(){return"All values in axis param must be in range [-"+e+", "+e+") but got axis "+n}),et(n.every(function(r){return Va(r)}),function(){return"All values in axis param must be integers but got axis "+n}),n.map(function(r){return r<0?e+r:r})}function Uc(n,t){for(var e=[],r=[],o=t==null?null:no(t,n).sort(),a=0,i=0;i<n.length;++i){if(o!=null){if(o[a]===i&&n[i]!==1)throw new Error("Can't squeeze axis "+i+" since its dim '"+n[i]+"' is not 1");(o[a]==null||o[a]>i)&&n[i]===1&&(e.push(n[i]),r.push(i)),o[a]<=i&&a++}n[i]!==1&&(e.push(n[i]),r.push(i))}return{newShape:e,keptDims:r}}function $S(n,t){var e=null;if(n==null||n==="float32")e=new Float32Array(t);else if(n==="int32")e=new Int32Array(t);else{if(n!=="bool")throw new Error("Unknown data type "+n);e=new Uint8Array(t)}return e}function L0(n,t){var e=null;if(n==null||n==="float32")e=new Float32Array(t);else if(n==="int32")e=new Int32Array(t);else if(n==="bool")e=new Uint8Array(t);else{if(n!=="string")throw new Error("Unknown data type "+n);e=new Array(t)}return e}function xK(n,t,e){if(t==="float32")for(var r=0;r<n.length;r++){var o=n[r];if(isNaN(o)||!isFinite(o))throw Error("The result of the '"+e+"' is "+o+".")}}function yK(n,t){for(var e=0;e<n.length;e++){var r=n[e];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+t+" being uploaded contains "+r+".")}}function bK(n,t){return t!=="complex64"&&(t!=="float32"||n==="complex64")&&(t!=="int32"||n==="float32"||n==="complex64")&&(t!=="bool"||n!=="bool")}function Xs(n){return n instanceof Float32Array||n instanceof Int32Array||n instanceof Uint8Array}function GM(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error("Unknown dtype "+n)}function wK(n){if(n==null)return 0;var t=0;return n.forEach(function(e){return t+=2*e.length}),t}function HM(n){return typeof n=="string"||n instanceof String}function CK(n){return typeof n=="boolean"}function SK(n){return typeof n=="number"}function Sm(n){return Array.isArray(n)?Sm(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array?"int32":SK(n)?"float32":HM(n)?"string":CK(n)?"bool":"float32"}function OS(n){return!!(n&&n.constructor&&n.call&&n.apply)}function FS(n,t){for(var e=t;e<n;++e)if(n%e==0)return e;return n}function Wc(n){var t=n.length;if(t<2)return[];var e=new Array(t-1);e[t-2]=n[t-1];for(var r=t-3;r>=0;--r)e[r]=e[r+1]*n[r+1];return e}function qM(n,t,e){if(t==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=_f(n)),e&&yK(n,t),EK(n,t))return n;if(t==null||t==="float32"||t==="complex64")return new Float32Array(n);if(t==="int32")return new Int32Array(n);if(t==="bool"){for(var r=new Uint8Array(n.length),o=0;o<r.length;++o)Math.round(n[o])!==0&&(r[o]=1);return r}throw new Error("Unknown data type "+t)}function jM(n,t,e){var r=new Array;if(t.length===1)for(var o=t[0],a=0;a<o;a++)r[a]=e[n+a];else{o=t[0];var i=t.slice(1),s=i.reduce(function(u,l){return u*l});for(a=0;a<o;a++)r[a]=jM(n+a*s,i,e)}return r}function I$(n,t){if(n.length===0)return t[0];var e=n.reduce(function(r,o){return r*o});if(e===0)return[];if(e!==t.length)throw new Error("["+n+"] does not match the input size.");return jM(0,n,t)}function EK(n,t){return n instanceof Float32Array&&t==="float32"||n instanceof Int32Array&&t==="int32"||n instanceof Uint8Array&&t==="bool"}function XM(n,t){for(var e=Em(n,t),r=0;r<e.length;r++)e[r]=1;return e}function Em(n,t){if(t==null||t==="float32"||t==="complex64")return new Float32Array(n);if(t==="int32")return new Int32Array(n);if(t==="bool")return new Uint8Array(n);throw new Error("Unknown data type "+t)}function P0(){if(typeof performance<"u")return performance.now();if(typeof process<"u"){var n=process.hrtime();return 1e3*n[0]+n[1]/1e6}throw new Error("Cannot measure time in this environment. You should run tf.js in the browser or in Node.js")}function KM(n){n.forEach(function(t){et(Number.isInteger(t)&&t>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+n+"]."})})}var kK=function(){function n(t,e){this.backendTimer=t,this.logger=e,e==null&&(this.logger=new IK)}return n.prototype.profileKernel=function(t,e){var r,o=this,a=this.backendTimer.time(function(){r=e()});return(Array.isArray(r)?r:[r]).forEach(function(i){var s=i.dataSync();xK(s,i.dtype,t),a.then(function(u){var l="";u.getExtraProfileInfo!=null&&(l=u.getExtraProfileInfo()),o.logger.logKernelProfile(t,i,s,u.kernelMs,l)})}),r},n}(),IK=function(){function n(){}return n.prototype.logKernelProfile=function(t,e,r,o,a){var i=pf(o+"ms",9),s=pf(t,25),u=e.rank,l=e.size,c=pf(e.shape.toString(),14);console.log("%c"+s+"	%c"+i+"	%c"+u+"D "+c+"	%c"+l+"	%c"+a,"font-weight:bold","color:red","color:blue","color: orange","color: green")},n}(),R$=20,Tp=3,xC=7;function RK(n,t,e,r){var o=Wc(t),a=TK(n,t,e,o),i=t.length,s=u0(n,t,e,o,a),u=["Tensor"];return r&&(u.push("  dtype: "+e),u.push("  rank: "+i),u.push("  shape: ["+t+"]"),u.push("  values:")),u.push(s.map(function(l){return"    "+l}).join(`
`)),u.join(`
`)}function TK(n,t,e,r){var o=de(t),a=r[r.length-1],i=new Array(a).fill(0),s=t.length,u=e==="complex64"?zp(n):n;if(s>1)for(var l=0;l<o/a;l++)for(var c=l*a,h=0;h<a;h++)i[h]=Math.max(i[h],Bp(u[c+h],0,e).length);return i}function Bp(n,t,e){return pf(Array.isArray(n)?parseFloat(n[0].toFixed(xC))+" + "+parseFloat(n[1].toFixed(xC))+"j":HM(n)?"'"+n+"'":e==="bool"?YM(n):parseFloat(n.toFixed(xC)).toString(),t)}function YM(n){return n===0?"false":"true"}function u0(n,t,e,r,o,a){a===void 0&&(a=!0);var i=e==="complex64"?2:1,s=t[0],u=t.length;if(u===0)return e==="complex64"?[Bp(zp(n)[0],0,e)]:e==="bool"?[YM(n[0])]:[n[0].toString()];if(u===1){if(s>R$){var l=Tp*i,c=Array.from(n.slice(0,l)),h=Array.from(n.slice(s-Tp*i,s));return e==="complex64"&&(c=zp(c),h=zp(h)),["["+c.map(function(k,R){return Bp(k,o[R],e)}).join(", ")+", ..., "+h.map(function(k,R){return Bp(k,o[s-Tp+R],e)}).join(", ")+"]"]}return["["+(e==="complex64"?zp(n):Array.from(n)).map(function(k,R){return Bp(k,o[R],e)}).join(", ")+"]"]}var d=t.slice(1),p=r.slice(1),g=r[0]*i,x=[];if(s>R$){for(var y=0;y<Tp;y++){var b=(C=y*g)+g;x.push.apply(x,u0(n.slice(C,b),d,e,p,o,!1))}for(x.push("..."),y=s-Tp;y<s;y++)b=(C=y*g)+g,x.push.apply(x,u0(n.slice(C,b),d,e,p,o,y===s-1))}else for(y=0;y<s;y++){var C;b=(C=y*g)+g,x.push.apply(x,u0(n.slice(C,b),d,e,p,o,y===s-1))}var E=u===2?",":"";for(x[0]="["+x[0]+E,y=1;y<x.length-1;y++)x[y]=" "+x[y]+E;var S=`,
`;for(y=2;y<u;y++)S+=`
`;return x[x.length-1]=" "+x[x.length-1]+"]"+(a?"":S),x}function zp(n){for(var t=[],e=0;e<n.length;e+=2)t.push([n[e],n[e+1]]);return t}var tm=function(){function n(t,e,r){var o=this;if(this.dtype=e,this.shape=t.slice(),this.size=de(t),r!=null){var a=r.length;et(a===this.size,function(){return"Length of values '"+a+"' does not match the size inferred by the shape '"+o.size+"'."})}if(e==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||L0(e,this.size),this.strides=Wc(t)}return n.prototype.set=function(t){for(var e=this,r=[],o=1;o<arguments.length;o++)r[o-1]=arguments[o];r.length===0&&(r=[0]),et(r.length===this.rank,function(){return"The number of provided coordinates ("+r.length+") must match the rank ("+e.rank+")"});var a=this.locToIndex(r);this.values[a]=t},n.prototype.get=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];t.length===0&&(t=[0]);for(var r=0,o=0,a=t;o<a.length;o++){var i=a[o];if(i<0||i>=this.shape[r]){var s="Requested out of range element at "+t+".   Buffer shape="+this.shape;throw new Error(s)}r++}for(var u=t[t.length-1],l=0;l<t.length-1;++l)u+=this.strides[l]*t[l];return this.values[u]},n.prototype.locToIndex=function(t){if(this.rank===0)return 0;if(this.rank===1)return t[0];for(var e=t[t.length-1],r=0;r<t.length-1;++r)e+=this.strides[r]*t[r];return e},n.prototype.indexToLoc=function(t){if(this.rank===0)return[];if(this.rank===1)return[t];for(var e=new Array(this.shape.length),r=0;r<e.length-1;++r)e[r]=Math.floor(t/this.strides[r]),t-=e[r]*this.strides[r];return e[e.length-1]=t,e},Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),n.prototype.toTensor=function(){return Gt.make(this.shape,{values:this.values},this.dtype)},n}(),Ma=null,kt=null,QM=null;function NK(n){Ma=n}function AK(n){kt=n}function _K(n){QM=n}var Gt=function(){function n(t,e,r,o,a){this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=e||"float32",this.size=de(t),this.strides=Wc(t),this.dataId=o??{},this.id=Ma().nextTensorId(),this.rankType=this.rank<5?this.rank.toString():"higher",Ma().registerTensor(this,a),r!=null&&Ma().write(this.dataId,r)}return n.make=function(t,e,r,o){return new n(t,r,e.values,e.dataId,o)},n.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},n.prototype.asScalar=function(){return this.throwIfDisposed(),et(this.size===1,function(){return"The array must have only 1 element."}),this.reshape([])},n.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},n.prototype.as2D=function(t,e){return this.throwIfDisposed(),this.reshape([t,e])},n.prototype.as3D=function(t,e,r){return this.throwIfDisposed(),this.reshape([t,e,r])},n.prototype.as4D=function(t,e,r,o){return this.throwIfDisposed(),this.reshape([t,e,r,o])},n.prototype.as5D=function(t,e,r,o,a){return this.throwIfDisposed(),this.reshape([t,e,r,o,a])},n.prototype.asType=function(t){return this.throwIfDisposed(),kt.cast(this,t)},Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),n.prototype.buffer=function(){return bn(this,void 0,void 0,function(){var t;return wn(this,function(e){switch(e.label){case 0:return[4,this.data()];case 1:return t=e.sent(),[2,kt.buffer(this.shape,this.dtype,t)]}})})},n.prototype.bufferSync=function(){return kt.buffer(this.shape,this.dtype,this.dataSync())},n.prototype.array=function(){return bn(this,void 0,void 0,function(){var t;return wn(this,function(e){switch(e.label){case 0:return[4,this.data()];case 1:return t=e.sent(),[2,I$(this.shape,t)]}})})},n.prototype.arraySync=function(){return I$(this.shape,this.dataSync())},n.prototype.data=function(){return bn(this,void 0,void 0,function(){return wn(this,function(t){return this.throwIfDisposed(),[2,Ma().read(this.dataId)]})})},n.prototype.dataSync=function(){return this.throwIfDisposed(),Ma().readSync(this.dataId)},n.prototype.dispose=function(){this.isDisposed||(Ma().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(n.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),n.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},n.prototype.toFloat=function(){return this.asType("float32")},n.prototype.toInt=function(){return this.asType("int32")},n.prototype.toBool=function(){return this.asType("bool")},n.prototype.print=function(t){return t===void 0&&(t=!1),kt.print(this,t)},n.prototype.reshape=function(t){return this.throwIfDisposed(),kt.reshape(this,t)},n.prototype.reshapeAs=function(t){return this.throwIfDisposed(),this.reshape(t.shape)},n.prototype.expandDims=function(t){return t===void 0&&(t=0),kt.expandDims(this,t)},n.prototype.cumsum=function(t,e,r){return t===void 0&&(t=0),e===void 0&&(e=!1),r===void 0&&(r=!1),kt.cumsum(this,t,e,r)},n.prototype.squeeze=function(t){return this.throwIfDisposed(),kt.squeeze(this,t)},n.prototype.clone=function(){return this.throwIfDisposed(),kt.clone(this)},n.prototype.oneHot=function(t,e,r){return this.throwIfDisposed(),kt.oneHot(this,t,e,r)},n.prototype.toString=function(t){return t===void 0&&(t=!1),RK(this.dataSync(),this.shape,this.dtype,t)},n.prototype.tile=function(t){return this.throwIfDisposed(),kt.tile(this,t)},n.prototype.gather=function(t,e){return e===void 0&&(e=0),this.throwIfDisposed(),kt.gather(this,t,e)},n.prototype.matMul=function(t,e,r){return e===void 0&&(e=!1),r===void 0&&(r=!1),this.throwIfDisposed(),kt.matMul(this,t,e,r)},n.prototype.dot=function(t){return this.throwIfDisposed(),kt.dot(this,t)},n.prototype.norm=function(t,e,r){return t===void 0&&(t="euclidean"),e===void 0&&(e=null),r===void 0&&(r=!1),this.throwIfDisposed(),kt.norm(this,t,e,r)},n.prototype.slice=function(t,e){return this.throwIfDisposed(),kt.slice(this,t,e)},n.prototype.reverse=function(t){return this.throwIfDisposed(),kt.reverse(this,t)},n.prototype.concat=function(t,e){return e===void 0&&(e=0),this.throwIfDisposed(),t instanceof n&&(t=[t]),kt.concat([this].concat(t),e)},n.prototype.split=function(t,e){return e===void 0&&(e=0),this.throwIfDisposed(),kt.split(this,t,e)},n.prototype.stack=function(t,e){return e===void 0&&(e=0),kt.stack([this,t],e)},n.prototype.unstack=function(t){return t===void 0&&(t=0),kt.unstack(this,t)},n.prototype.pad=function(t,e){return e===void 0&&(e=0),kt.pad(this,t,e)},n.prototype.batchNormalization=function(t,e,r,o,a){return r===void 0&&(r=.001),QM("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(t,e,a,o,r)},n.prototype.batchNorm=function(t,e,r,o,a){return a===void 0&&(a=.001),this.throwIfDisposed(),kt.batchNorm(this,t,e,r,o,a)},n.prototype.all=function(t,e){return t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),kt.all(this,t,e)},n.prototype.any=function(t,e){return t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),kt.any(this,t,e)},n.prototype.logSumExp=function(t,e){return t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),kt.logSumExp(this,t,e)},n.prototype.sum=function(t,e){return t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),kt.sum(this,t,e)},n.prototype.prod=function(t,e){return t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),kt.prod(this,t,e)},n.prototype.mean=function(t,e){return t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),kt.mean(this,t,e)},n.prototype.min=function(t,e){return t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),kt.min(this,t,e)},n.prototype.max=function(t,e){return t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),kt.max(this,t,e)},n.prototype.argMin=function(t){return t===void 0&&(t=null),this.throwIfDisposed(),kt.argMin(this,t)},n.prototype.argMax=function(t){return t===void 0&&(t=null),this.throwIfDisposed(),kt.argMax(this,t)},n.prototype.cast=function(t){return this.throwIfDisposed(),kt.cast(this,t)},n.prototype.add=function(t){return this.throwIfDisposed(),kt.add(this,t)},n.prototype.addStrict=function(t){return this.throwIfDisposed(),kt.addStrict(this,t)},n.prototype.atan2=function(t){return this.throwIfDisposed(),kt.atan2(this,t)},n.prototype.sub=function(t){return this.throwIfDisposed(),kt.sub(this,t)},n.prototype.subStrict=function(t){return this.throwIfDisposed(),kt.subStrict(this,t)},n.prototype.pow=function(t){return this.throwIfDisposed(),kt.pow(this,t)},n.prototype.powStrict=function(t){return this.throwIfDisposed(),kt.powStrict(this,t)},n.prototype.mul=function(t){return this.throwIfDisposed(),kt.mul(this,t)},n.prototype.mulStrict=function(t){return this.throwIfDisposed(),kt.mulStrict(this,t)},n.prototype.div=function(t){return this.throwIfDisposed(),kt.div(this,t)},n.prototype.floorDiv=function(t){return this.throwIfDisposed(),kt.floorDiv(this,t)},n.prototype.divStrict=function(t){return this.throwIfDisposed(),kt.divStrict(this,t)},n.prototype.minimum=function(t){return this.throwIfDisposed(),kt.minimum(this,t)},n.prototype.minimumStrict=function(t){return this.throwIfDisposed(),kt.minimumStrict(this,t)},n.prototype.maximum=function(t){return this.throwIfDisposed(),kt.maximum(this,t)},n.prototype.maximumStrict=function(t){return this.throwIfDisposed(),kt.maximumStrict(this,t)},n.prototype.mod=function(t){return this.throwIfDisposed(),kt.mod(this,t)},n.prototype.modStrict=function(t){return this.throwIfDisposed(),kt.modStrict(this,t)},n.prototype.squaredDifference=function(t){return this.throwIfDisposed(),kt.squaredDifference(this,t)},n.prototype.squaredDifferenceStrict=function(t){return this.throwIfDisposed(),kt.squaredDifferenceStrict(this,t)},n.prototype.transpose=function(t){return this.throwIfDisposed(),kt.transpose(this,t)},n.prototype.notEqual=function(t){return this.throwIfDisposed(),kt.notEqual(this,t)},n.prototype.notEqualStrict=function(t){return this.throwIfDisposed(),kt.notEqualStrict(this,t)},n.prototype.less=function(t){return this.throwIfDisposed(),kt.less(this,t)},n.prototype.lessStrict=function(t){return this.throwIfDisposed(),kt.lessStrict(this,t)},n.prototype.equal=function(t){return this.throwIfDisposed(),kt.equal(this,t)},n.prototype.equalStrict=function(t){return this.throwIfDisposed(),kt.equalStrict(this,t)},n.prototype.lessEqual=function(t){return this.throwIfDisposed(),kt.lessEqual(this,t)},n.prototype.lessEqualStrict=function(t){return this.throwIfDisposed(),kt.lessEqualStrict(this,t)},n.prototype.greater=function(t){return this.throwIfDisposed(),kt.greater(this,t)},n.prototype.greaterStrict=function(t){return this.throwIfDisposed(),kt.greaterStrict(this,t)},n.prototype.greaterEqual=function(t){return this.throwIfDisposed(),kt.greaterEqual(this,t)},n.prototype.greaterEqualStrict=function(t){return this.throwIfDisposed(),kt.greaterEqualStrict(this,t)},n.prototype.logicalAnd=function(t){return this.throwIfDisposed(),kt.logicalAnd(this,t)},n.prototype.logicalOr=function(t){return this.throwIfDisposed(),kt.logicalOr(this,t)},n.prototype.logicalNot=function(){return this.throwIfDisposed(),kt.logicalNot(this)},n.prototype.logicalXor=function(t){return this.throwIfDisposed(),kt.logicalXor(this,t)},n.prototype.where=function(t,e){return this.throwIfDisposed(),kt.where(t,this,e)},n.prototype.neg=function(){return this.throwIfDisposed(),kt.neg(this)},n.prototype.ceil=function(){return this.throwIfDisposed(),kt.ceil(this)},n.prototype.floor=function(){return this.throwIfDisposed(),kt.floor(this)},n.prototype.sign=function(){return this.throwIfDisposed(),kt.sign(this)},n.prototype.exp=function(){return this.throwIfDisposed(),kt.exp(this)},n.prototype.expm1=function(){return this.throwIfDisposed(),kt.expm1(this)},n.prototype.log=function(){return this.throwIfDisposed(),kt.log(this)},n.prototype.log1p=function(){return this.throwIfDisposed(),kt.log1p(this)},n.prototype.sqrt=function(){return this.throwIfDisposed(),kt.sqrt(this)},n.prototype.rsqrt=function(){return this.throwIfDisposed(),kt.rsqrt(this)},n.prototype.square=function(){return this.throwIfDisposed(),kt.square(this)},n.prototype.reciprocal=function(){return this.throwIfDisposed(),kt.reciprocal(this)},n.prototype.abs=function(){return this.throwIfDisposed(),kt.abs(this)},n.prototype.clipByValue=function(t,e){return this.throwIfDisposed(),kt.clipByValue(this,t,e)},n.prototype.relu=function(){return this.throwIfDisposed(),kt.relu(this)},n.prototype.elu=function(){return this.throwIfDisposed(),kt.elu(this)},n.prototype.selu=function(){return this.throwIfDisposed(),kt.selu(this)},n.prototype.leakyRelu=function(t){return t===void 0&&(t=.2),this.throwIfDisposed(),kt.leakyRelu(this,t)},n.prototype.prelu=function(t){return this.throwIfDisposed(),kt.prelu(this,t)},n.prototype.sigmoid=function(){return this.throwIfDisposed(),kt.sigmoid(this)},n.prototype.logSigmoid=function(){return this.throwIfDisposed(),kt.logSigmoid(this)},n.prototype.softplus=function(){return this.throwIfDisposed(),kt.softplus(this)},n.prototype.zerosLike=function(){return this.throwIfDisposed(),kt.zerosLike(this)},n.prototype.onesLike=function(){return this.throwIfDisposed(),kt.onesLike(this)},n.prototype.sin=function(){return this.throwIfDisposed(),kt.sin(this)},n.prototype.cos=function(){return this.throwIfDisposed(),kt.cos(this)},n.prototype.tan=function(){return this.throwIfDisposed(),kt.tan(this)},n.prototype.asin=function(){return this.throwIfDisposed(),kt.asin(this)},n.prototype.acos=function(){return this.throwIfDisposed(),kt.acos(this)},n.prototype.atan=function(){return this.throwIfDisposed(),kt.atan(this)},n.prototype.sinh=function(){return this.throwIfDisposed(),kt.sinh(this)},n.prototype.cosh=function(){return this.throwIfDisposed(),kt.cosh(this)},n.prototype.tanh=function(){return this.throwIfDisposed(),kt.tanh(this)},n.prototype.asinh=function(){return this.throwIfDisposed(),kt.asinh(this)},n.prototype.acosh=function(){return this.throwIfDisposed(),kt.acosh(this)},n.prototype.atanh=function(){return this.throwIfDisposed(),kt.atanh(this)},n.prototype.erf=function(){return this.throwIfDisposed(),kt.erf(this)},n.prototype.round=function(){return this.throwIfDisposed(),kt.round(this)},n.prototype.step=function(t){return t===void 0&&(t=0),this.throwIfDisposed(),kt.step(this,t)},n.prototype.softmax=function(t){return t===void 0&&(t=-1),this.throwIfDisposed(),kt.softmax(this,t)},n.prototype.logSoftmax=function(t){return t===void 0&&(t=-1),this.throwIfDisposed(),kt.logSoftmax(this,t)},n.prototype.resizeBilinear=function(t,e){return e===void 0&&(e=!1),this.throwIfDisposed(),kt.image.resizeBilinear(this,t,e)},n.prototype.resizeNearestNeighbor=function(t,e){return e===void 0&&(e=!1),this.throwIfDisposed(),kt.image.resizeNearestNeighbor(this,t,e)},n.prototype.conv1d=function(t,e,r,o,a,i){return o===void 0&&(o="NWC"),a===void 0&&(a=1),this.throwIfDisposed(),kt.conv1d(this,t,e,r,o,a,i)},n.prototype.conv2d=function(t,e,r,o,a,i){return o===void 0&&(o="NHWC"),a===void 0&&(a=[1,1]),this.throwIfDisposed(),kt.conv2d(this,t,e,r,o,a,i)},n.prototype.conv2dTranspose=function(t,e,r,o,a){return this.throwIfDisposed(),kt.conv2dTranspose(this,t,e,r,o,a)},n.prototype.depthwiseConv2D=function(t,e,r,o,a,i){return o===void 0&&(o="NHWC"),a===void 0&&(a=[1,1]),this.throwIfDisposed(),kt.depthwiseConv2d(this,t,e,r,o,a,i)},n.prototype.separableConv2d=function(t,e,r,o,a,i){return a===void 0&&(a=[1,1]),i===void 0&&(i="NHWC"),this.throwIfDisposed(),kt.separableConv2d(this,t,e,r,o,a,i)},n.prototype.avgPool=function(t,e,r,o){return this.throwIfDisposed(),kt.avgPool(this,t,e,r,o)},n.prototype.maxPool=function(t,e,r,o){return this.throwIfDisposed(),kt.maxPool(this,t,e,r,o)},n.prototype.localResponseNormalization=function(t,e,r,o){return t===void 0&&(t=5),e===void 0&&(e=1),r===void 0&&(r=1),o===void 0&&(o=.5),kt.localResponseNormalization(this,t,e,r,o)},n.prototype.pool=function(t,e,r,o,a){return this.throwIfDisposed(),kt.pool(this,t,e,r,o,a)},n.prototype.variable=function(t,e,r){return t===void 0&&(t=!0),this.throwIfDisposed(),km.variable(this,t,e,r)},n.prototype.unsortedSegmentSum=function(t,e){return this.throwIfDisposed(),kt.unsortedSegmentSum(this,t,e)},n.prototype.batchToSpaceND=function(t,e){return this.throwIfDisposed(),kt.batchToSpaceND(this,t,e)},n.prototype.spaceToBatchND=function(t,e){return this.throwIfDisposed(),kt.spaceToBatchND(this,t,e)},n.prototype.topk=function(t,e){return t===void 0&&(t=1),e===void 0&&(e=!0),this.throwIfDisposed(),kt.topk(this,t,e)},n.prototype.stridedSlice=function(t,e,r,o,a,i,s,u){return o===void 0&&(o=0),a===void 0&&(a=0),i===void 0&&(i=0),s===void 0&&(s=0),u===void 0&&(u=0),this.throwIfDisposed(),kt.stridedSlice(this,t,e,r,o,a,i,s,u)},n.prototype.depthToSpace=function(t,e){return this.throwIfDisposed(),kt.depthToSpace(this,t,e)},n.prototype.fft=function(){return this.throwIfDisposed(),kt.spectral.fft(this)},n.prototype.ifft=function(){return this.throwIfDisposed(),kt.spectral.ifft(this)},n.prototype.rfft=function(){return this.throwIfDisposed(),kt.spectral.rfft(this)},n.prototype.irfft=function(){return this.throwIfDisposed(),kt.spectral.irfft(this)},n}();Object.defineProperty(Gt,Symbol.hasInstance,{value:function(n){return!!n&&n.dataId!=null&&n.shape!=null&&n.dtype!=null}});var km=function(n){function t(e,r,o){r===void 0&&(r=!0);var a=n.call(this,e.shape,e.dtype,null,e.dataId)||this;a.trainable=r,a.name=o,a.name==null&&(a.name=Ma().nextVariableId().toString());try{Ma().registerVariable(a)}catch(i){throw Ma().disposeTensor(a),i}return a}return tu(t,n),t.variable=function(e,r,o,a){return r===void 0&&(r=!0),a!=null&&a!==e.dtype&&(e=e.asType(a)),new t(e,r,o)},t.prototype.assign=function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value ("+e.dtype+") and previous value ("+this.dtype+") must match");if(!Ao(e.shape,this.shape))throw new Error("shape of the new value ("+e.shape+") and previous value ("+this.shape+") must match");Ma().disposeTensor(this),this.dataId=e.dataId,Ma().registerTensor(this)},t}(Gt);Object.defineProperty(km,Symbol.hasInstance,{value:function(n){return n instanceof Gt&&n.assign!=null&&n.assign instanceof Function}});var T$,MS,LS,PS,BS;km.variable;function DK(n,t,e){for(var r={},o={},a=0;a<t.length;a++)r[t[a].id]=!0;for(a=0;a<n.length;a++){var i=(g=n[a]).inputs;for(var s in i){for(var u=i[s],l=!1,c=0;c<t.length;c++)if(r[u.id]){g.outputs.forEach(function(C){return r[C.id]=!0}),l=!0,o[g.id]=!0;break}if(l)break}}var h={};h[e.id]=!0;var d={};for(a=n.length-1;a>=0;a--)for(i=(g=n[a]).inputs,c=0;c<g.outputs.length;c++)if(h[g.outputs[c].id]){for(var s in i)h[i[s].id]=!0,d[g.id]=!0;break}var p=[];for(a=0;a<n.length;a++){var g;if(o[(g=n[a]).id]&&d[g.id]){var x={};for(var s in g.inputs){var y=g.inputs[s];r[y.id]&&(x[s]=y)}var b=Object.assign({},g);b.inputs=x,b.outputs=g.outputs,p.push(b)}}return p}function $K(n,t,e){for(var r=function(a){var i=t[a],s=[];if(i.outputs.forEach(function(h){var d=n[h.id];if(d!=null)s.push(d);else{var p=Gt.make(h.shape,{values:Em(h.size,h.dtype)},h.dtype);s.push(p)}}),i.gradient==null)throw new Error("Cannot compute gradient: gradient function not found for "+i.name+".");var u=i.gradient(i.outputs.length===1?s[0]:s),l=function(h){if(!(h in u))throw new Error("Cannot backprop through input "+h+". Available gradients found: "+Object.keys(u)+".");var d=e(function(){return u[h]()});if(d.dtype!=="float32")throw new Error("Error in gradient for op "+i.name+". The gradient of input "+h+" must have 'float32' dtype, but has '"+d.dtype+"'");var p=i.inputs[h];if(!Ao(d.shape,p.shape))throw new Error("Error in gradient for op "+i.name+". The gradient of input '"+h+"' has shape '"+d.shape+"', which does not match the shape of the input '"+p.shape+"'");if(n[p.id]==null)n[p.id]=d;else{var g=n[p.id];n[p.id]=g.add(d),g.dispose()}};for(var c in i.inputs)l(c)},o=t.length-1;o>=0;o--)r(o)}(function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"})(T$||(T$={})),function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"}(MS||(MS={})),function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"}(LS||(LS={})),function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"}(PS||(PS={})),function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"}(BS||(BS={}));var OK={float32:PS,int32:MS,bool:LS,complex64:BS};function Lr(n,t){if(n==="string"||t==="string"){if(n==="string"&&t==="string")return"string";throw new Error("Can not upcast "+n+" with "+t)}return OK[n][t]}function yC(n){return Lr(n,"int32")}function Nr(n,t){if(n.dtype===t.dtype)return[n,t];var e=Lr(n.dtype,t.dtype);return[n.cast(e),t.cast(e)]}function FK(n,t){et(n.dtype===t.dtype,function(){return"The dtypes of the first("+n.dtype+") and second("+t.dtype+") input must match"})}function ZM(n){var t=[];return JM(n,t,new Set),t}function JM(n,t,e){if(n!=null){if(n instanceof Gt)t.push(n);else if(MK(n)){var r=n;for(var o in r){var a=r[o];e.has(a)||(e.add(a),JM(a,t,e))}}}}function MK(n){return Array.isArray(n)||typeof n=="object"}var Ke,LK=function(){function n(t,e,r){this.backend=t,this.safeMode=e,this.debugMode=r,this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.profiling=!1,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiler=new kK(t),this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return n.prototype.moveData=function(t){this.write(t,this.readSync(t))},n.prototype.tidy=function(t,e){var r,o=this,a=null;if(e==null){if(typeof t!="function")throw new Error("Please provide a function to tidy()");e=t}else{if(typeof t!="string"&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof e!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=t}return this.scopedRun(function(){return o.startScope(a)},function(){return o.endScope(r)},function(){return(r=e())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r})},n.prototype.scopedRun=function(t,e,r){t();try{var o=r();return e(),o}catch(a){throw e(),a}},n.prototype.nextTensorId=function(){return n.nextTensorId++},n.prototype.nextVariableId=function(){return n.nextVariableId++},n.prototype.clone=function(t){var e=Gt.make(t.shape,{dataId:t.dataId},t.dtype);return this.addTapeNode([t],e,function(r){return[r.toFloat()]}),e},n.prototype.runKernel=function(t,e,r){var o,a=this,i=[],s=this.isTapeOn(),u=this.activeScope!=null?this.activeScope.name:"",l=function(p){s&&(i=p.map(function(g){return a.keep(a.clone(g))}))},c=this.numBytes,h=this.numTensors;if(this.scopedRun(function(){return a.kernelDepth++},function(){return a.kernelDepth--},function(){o=a.debugMode()?a.profiler.profileKernel(u,function(){return t(a.backend,l)}):t(a.backend,l)}),s){var d={id:this.nextTapeNodeId++,name:u,inputs:e,outputs:Array.isArray(o)?o:[o],saved:i};r!=null&&(d.gradient=function(p){return r(p,i)}),this.activeTape.push(d)}return this.profiling&&this.activeProfile.kernels.push({name:u,bytesAdded:this.numBytes-c,totalBytesSnapshot:this.numBytes,tensorsAdded:this.numTensors-h,totalTensorsSnapshot:this.numTensors,inputShapes:Object.keys(e).map(function(p){return e[p].shape}),outputShape:Array.isArray(o)?o.map(function(p){return p.shape}):o.shape}),o},n.prototype.registerTensor=function(t,e){var r=this.tensorInfo.has(t.dataId)?this.tensorInfo.get(t.dataId).refCount:0;if(this.numTensors++,t.dtype==="string"&&this.numStringTensors++,r===0){this.numDataBuffers++;var o=0;t.dtype!=="complex64"&&t.dtype!=="string"&&(o=t.size*GM(t.dtype)),this.tensorInfo.set(t.dataId,{backend:e??this.backend,dtype:t.dtype,shape:t.shape,bytes:o,refCount:0}),this.numBytes+=o,e!=null?e.register(t.dataId,t.shape,t.dtype):this.backend.register(t.dataId,t.shape,t.dtype)}this.tensorInfo.get(t.dataId).refCount++,t instanceof km||this.track(t)},n.prototype.registerVariable=function(t){if(this.registeredVariables[t.name]!=null)throw new Error("Variable with name "+t.name+" was already registered");this.registeredVariables[t.name]=t},n.prototype.disposeTensor=function(t){if(this.tensorInfo.has(t.dataId)){this.numTensors--,t.dtype==="string"&&this.numStringTensors--;var e=this.tensorInfo.get(t.dataId);e.refCount<=1?(t.dtype!=="complex64"&&(this.numBytes-=e.bytes),this.numDataBuffers--,e.backend.disposeData(t.dataId),this.tensorInfo.delete(t.dataId)):this.tensorInfo.get(t.dataId).refCount--}},n.prototype.disposeVariables=function(){for(var t in this.registeredVariables){var e=this.registeredVariables[t];this.disposeTensor(e),delete this.registeredVariables[t]}},n.prototype.memory=function(){var t=this.backend.memory();return t.numTensors=this.numTensors,t.numDataBuffers=this.numDataBuffers,t.numBytes=this.numBytes,this.numStringTensors>0&&(t.unreliable=!0,t.reasons==null&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t},n.prototype.profile=function(t){return bn(this,void 0,void 0,function(){var e,r;return wn(this,function(o){return this.profiling=!0,e=this.numBytes,r=this.numTensors,this.activeProfile.kernels=[],this.activeProfile.result=t(),this.profiling=!1,this.activeProfile.peakBytes=Math.max.apply(Math,this.activeProfile.kernels.map(function(a){return a.totalBytesSnapshot})),this.activeProfile.newBytes=this.numBytes-e,this.activeProfile.newTensors=this.numTensors-r,[2,this.activeProfile]})})},n.prototype.isTapeOn=function(){return this.gradientDepth>0&&this.kernelDepth===0},n.prototype.addTapeNode=function(t,e,r){var o={};t.forEach(function(i,s){o[s]=i});var a={id:this.nextTapeNodeId++,name:this.activeScope.name,inputs:o,outputs:[e],gradient:function(i){var s={};return r(i).forEach(function(u,l){s[l]=function(){return u}}),s}};this.activeTape.push(a)},n.prototype.keep=function(t){if(this.scopeStack.length===1&&this.safeMode)throw new Error("Safe mode is ON. Enclose all tensor operations inside tf.tidy(): tf.tidy(() => {...}) to avoid memory leaks.");return t.kept=!0,t},n.prototype.startTape=function(){this.gradientDepth===0&&(this.activeTape=[]),this.gradientDepth++},n.prototype.endTape=function(){this.gradientDepth--},n.prototype.startScope=function(t){var e={track:[],name:"unnamed scope",id:this.nextScopeId++};t&&(e.name=t),this.scopeStack.push(e),this.activeScope=e},n.prototype.endScope=function(t){for(var e=this,r=ZM(t),o=new Set(r.map(function(u){return u.id})),a=0;a<this.activeScope.track.length;a++){var i=this.activeScope.track[a];i.kept||o.has(i.id)||i.dispose()}var s=this.scopeStack.pop();this.activeScope=this.scopeStack.length===0?null:this.scopeStack[this.scopeStack.length-1],r.forEach(function(u){u.kept||u.scopeId!==s.id||e.track(u)})},n.prototype.gradients=function(t,e,r,o){var a=this;if(o===void 0&&(o=!1),et(e.length>0,function(){return"gradients() received an empty list of xs."}),r!=null&&r.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+r.dtype+"'");var i=this.scopedRun(function(){return a.startTape()},function(){return a.endTape()},function(){return a.tidy("forward",t)});et(i instanceof Gt,function(){return"The result y returned by f() must be a tensor."});var s=DK(this.activeTape,e,i);if(!o&&s.length===0&&e.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var u={};u[i.id]=r??PK(i.shape),$K(u,s,function(c){return a.tidy(c)});var l=e.map(function(c){return u[c.id]});return a.gradientDepth===0&&(a.activeTape.forEach(function(c){for(var h in c.saved)c.saved[h].dispose()}),a.activeTape=null),{value:i,grads:l}})},n.prototype.customGrad=function(t){var e=this;return et(OS(t),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var r,o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];et(o.every(function(s){return s instanceof Gt}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var i={};return o.forEach(function(s,u){i[u]=s}),e.runKernel(function(s,u){return et((r=t.apply(void 0,o.concat([u]))).value instanceof Gt,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),et(OS(r.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),r.value},i,function(s,u){var l=r.gradFunc(s,u),c=Array.isArray(l)?l:[l];et(c.length===o.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),et(c.every(function(d){return d instanceof Gt}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var h={};return c.forEach(function(d,p){h[p]=function(){return d}}),h})}},n.prototype.write=function(t,e){var r=this.tensorInfo.get(t);if(r.dtype==="string"){var o=wK(e);this.numBytes+=o-r.bytes,r.bytes=o}this.backend!==r.backend&&(r.backend.disposeData(t),r.backend=this.backend,this.backend.register(t,r.shape,r.dtype)),this.backend.write(t,e)},n.prototype.readSync=function(t){return this.tensorInfo.get(t).backend.readSync(t)},n.prototype.read=function(t){return this.tensorInfo.get(t).backend.read(t)},n.prototype.fromPixels=function(t,e){return this.backend.fromPixels(t,e)},n.prototype.time=function(t){return bn(this,void 0,void 0,function(){var e,r;return wn(this,function(o){switch(o.label){case 0:return e=P0(),[4,this.backend.time(t)];case 1:return(r=o.sent()).wallMs=P0()-e,[2,r]}})})},n.prototype.track=function(t){if(this.scopeStack.length===1&&this.safeMode)throw new Error("Safe mode is ON. Enclose all tensor operations inside tf.tidy(): tf.tidy(() => {op();...}); to avoid memory leaks.");return this.activeScope!=null&&(t.scopeId=this.activeScope.id,this.activeScope.track.push(t)),t},n.nextTensorId=0,n.nextVariableId=0,n}();function PK(n){var t=XM(de(n),"float32");return Gt.make(n,{values:t})}(function(n){n[n.NUMBER=0]="NUMBER",n[n.BOOLEAN=1]="BOOLEAN",n[n.STRING=2]="STRING"})(Ke||(Ke={}));var bC,wC,BK=[{name:"DEBUG",type:Ke.BOOLEAN},{name:"IS_BROWSER",type:Ke.BOOLEAN},{name:"WEBGL_LAZILY_UNPACK",type:Ke.BOOLEAN},{name:"WEBGL_CPU_FORWARD",type:Ke.BOOLEAN},{name:"WEBGL_PACK",type:Ke.BOOLEAN},{name:"WEBGL_PACK_BATCHNORMALIZATION",type:Ke.BOOLEAN},{name:"WEBGL_PACK_CLIP",type:Ke.BOOLEAN},{name:"WEBGL_PACK_DEPTHWISECONV",type:Ke.BOOLEAN},{name:"WEBGL_PACK_BINARY_OPERATIONS",type:Ke.BOOLEAN},{name:"WEBGL_PACK_ARRAY_OPERATIONS",type:Ke.BOOLEAN},{name:"WEBGL_PACK_IMAGE_OPERATIONS",type:Ke.BOOLEAN},{name:"WEBGL_PACK_REDUCE",type:Ke.BOOLEAN},{name:"WEBGL_CONV_IM2COL",type:Ke.BOOLEAN},{name:"WEBGL_MAX_TEXTURE_SIZE",type:Ke.NUMBER},{name:"WEBGL_NUM_MB_BEFORE_PAGING",type:Ke.NUMBER},{name:"WEBGL_MAX_TEXTURES_IN_SHADER",type:Ke.NUMBER},{name:"WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",type:Ke.NUMBER},{name:"WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",type:Ke.BOOLEAN},{name:"WEBGL_VERSION",type:Ke.NUMBER},{name:"WEBGL_RENDER_FLOAT32_ENABLED",type:Ke.BOOLEAN},{name:"WEBGL_DOWNLOAD_FLOAT_ENABLED",type:Ke.BOOLEAN},{name:"WEBGL_FENCE_API_ENABLED",type:Ke.BOOLEAN},{name:"WEBGL_SIZE_UPLOAD_UNIFORM",type:Ke.NUMBER},{name:"BACKEND",type:Ke.STRING},{name:"EPSILON",type:Ke.NUMBER},{name:"PROD",type:Ke.BOOLEAN},{name:"TENSORLIKE_CHECK_SHAPE_CONSISTENCY",type:Ke.BOOLEAN},{name:"DEPRECATION_WARNINGS_ENABLED",type:Ke.BOOLEAN}];function N$(n){try{if(cs(n)!=null)return!0}catch{return!1}return!1}function zK(n){if(bC==null){var t=cs(n);bC=t.getParameter(t.MAX_TEXTURE_SIZE)}return bC}function UK(n){if(wC==null){var t=cs(n);wC=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,wC)}function WK(n){if(n===0)return 0;var t=cs(n);return pc(t,"EXT_disjoint_timer_query_webgl2")&&n===2?2:pc(t,"EXT_disjoint_timer_query")?1:0}function VK(n){if(n===0)return!1;var t=cs(n);if(n===1){if(!pc(t,"OES_texture_float"))return!1}else if(!pc(t,"EXT_color_buffer_float"))return!1;return e4(t,n)}function GK(n){if(n===0)return!1;var t=cs(n);if(n===1){if(!pc(t,"OES_texture_float")||!pc(t,"WEBGL_color_buffer_float"))return!1}else if(!pc(t,"EXT_color_buffer_float"))return!1;return e4(t,n)}function HK(n){return n===2&&cs(n).fenceSync!=null}function qK(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}var A$="tfjsflags";function t4(){var n={};if(typeof window>"u"||window.location===void 0||window.location.search===void 0)return n;var t=jK(window.location.search);if(A$ in t){var e={};t[A$].split(",").forEach(function(r){var o=r.split(":"),a=o[0],i=o[1];e[a]=i}),BK.forEach(function(r){r.name in e&&(console.log("Setting feature override from URL "+r.name+": "+e[r.name]),r.type===Ke.NUMBER?n[r.name]=+e[r.name]:r.type===Ke.BOOLEAN?n[r.name]=e[r.name]==="true":r.type===Ke.STRING?n[r.name]=e[r.name]:console.warn("Unknown URL param: "+r.name+"."))})}return n}function pc(n,t){return n.getExtension(t)!=null}function e4(n,t){var e=n.createFramebuffer(),r=n.createTexture();n.bindTexture(n.TEXTURE_2D,r);var o=t===2?n.RGBA32F:n.RGBA;n.texImage2D(n.TEXTURE_2D,0,o,1,1,0,n.RGBA,n.FLOAT,null),n.bindFramebuffer(n.FRAMEBUFFER,e),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,r,0);var a=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(r),n.deleteFramebuffer(e),a}function jK(n){var t={};return n.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(e){for(var r=[],o=1;o<arguments.length;o++)r[o-1]=arguments[o];return XK(t,r[0],r[1]),r.join("=")}),t}function XK(n,t,e){n[decodeURIComponent(t)]=decodeURIComponent(e||"")}var KK=600;function YK(){return window.screen.height*window.screen.width*window.devicePixelRatio*KK/1024}var CC,QK=1e-4,ZK=.1,JK=1e-7,t8=.001,hs=function(){function n(t){this.features={},this.registry={},this.registryFactory={},t!=null&&(this.features=t),this.get("DEBUG")&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}return n.setBackend=function(t,e){if(!(t in Y.registry))throw new Error("Backend name '"+t+"' not found in registry");Y.engine.backend=Y.findBackend(t),Y.backendName=t},n.getBackend=function(){return Y.initEngine(),Y.backendName},n.disposeVariables=function(){Y.engine.disposeVariables()},n.memory=function(){return Y.engine.memory()},n.profile=function(t){return Y.engine.profile(t)},n.tidy=function(t,e){return Y.engine.tidy(t,e)},n.dispose=function(t){ZM(t).forEach(function(e){return e.dispose()})},n.keep=function(t){return Y.engine.keep(t)},n.time=function(t){return Y.engine.time(t)},n.prototype.get=function(t){return t in this.features?this.features[t]:(this.features[t]=this.evaluateFeature(t),this.features[t])},n.prototype.getFeatures=function(){return this.features},n.prototype.set=function(t,e){this.features[t]=e},n.prototype.getBestBackendName=function(){var t=this;if(Object.keys(this.registry).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registry).map(function(e){return{name:e,entry:t.registry[e]}}).sort(function(e,r){return r.entry.priority-e.entry.priority})[0].name},n.prototype.evaluateFeature=function(t){if(t==="DEBUG")return!1;if(t==="IS_BROWSER")return typeof window<"u";if(t==="IS_NODE")return typeof process<"u"&&process.versions!==void 0&&process.versions.node!==void 0;if(t==="IS_CHROME")return qK();if(t==="WEBGL_CPU_FORWARD")return!0;if(t==="WEBGL_PACK")return this.get("WEBGL_VERSION")!==0;if(t==="WEBGL_PACK_BATCHNORMALIZATION")return this.get("WEBGL_PACK");if(t==="WEBGL_PACK_CLIP")return this.get("WEBGL_PACK");if(t==="WEBGL_PACK_DEPTHWISECONV")return this.get("WEBGL_PACK");if(t==="WEBGL_PACK_BINARY_OPERATIONS")return this.get("WEBGL_PACK");if(t==="WEBGL_PACK_ARRAY_OPERATIONS")return this.get("WEBGL_PACK");if(t==="WEBGL_PACK_IMAGE_OPERATIONS")return this.get("WEBGL_PACK");if(t==="WEBGL_PACK_REDUCE")return this.get("WEBGL_PACK");if(t==="WEBGL_LAZILY_UNPACK")return this.get("WEBGL_PACK");if(t==="WEBGL_CONV_IM2COL")return this.get("WEBGL_PACK");if(t==="WEBGL_NUM_MB_BEFORE_PAGING")return this.get("PROD")||!this.get("IS_BROWSER")?Number.POSITIVE_INFINITY:YK();if(t==="WEBGL_MAX_TEXTURE_SIZE")return zK(this.get("WEBGL_VERSION"));if(t==="WEBGL_MAX_TEXTURES_IN_SHADER")return UK(this.get("WEBGL_VERSION"));if(t==="IS_TEST")return!1;if(t==="BACKEND")return this.getBestBackendName();if(t==="WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"){var e=this.get("WEBGL_VERSION");return e===0?0:WK(e)}if(t==="WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")return this.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!dK();if(t==="HAS_WEBGL")return this.get("WEBGL_VERSION")>0;if(t==="WEBGL_VERSION")return N$(2)?2:N$(1)?1:0;if(t==="WEBGL_RENDER_FLOAT32_ENABLED")return VK(this.get("WEBGL_VERSION"));if(t==="WEBGL_DOWNLOAD_FLOAT_ENABLED")return GK(this.get("WEBGL_VERSION"));if(t==="WEBGL_FENCE_API_ENABLED")return HK(this.get("WEBGL_VERSION"));if(t==="WEBGL_SIZE_UPLOAD_UNIFORM")return this.get("WEBGL_RENDER_FLOAT32_ENABLED")?4:0;if(t==="TEST_EPSILON")return this.backend.floatPrecision()===32?t8:ZK;if(t==="EPSILON")return this.backend.floatPrecision()===32?JK:QK;if(t==="PROD")return!1;if(t==="TENSORLIKE_CHECK_SHAPE_CONSISTENCY")return!this.get("PROD");if(t==="DEPRECATION_WARNINGS_ENABLED")return!0;throw new Error("Unknown feature "+t+".")},n.prototype.setFeatures=function(t){this.features=Object.assign({},t)},n.prototype.reset=function(){this.features=t4(),this.globalEngine!=null&&(this.globalEngine=null)},Object.defineProperty(n.prototype,"backend",{get:function(){return this.engine.backend},enumerable:!0,configurable:!0}),n.prototype.findBackend=function(t){return t in this.registry?this.registry[t].backend:null},n.prototype.findBackendFactory=function(t){return t in this.registryFactory?this.registryFactory[t]:null},n.prototype.registerBackend=function(t,e,r){var o=this;if(r===void 0&&(r=1),t in this.registry)return console.warn(t+" backend was already registered. Reusing existing backend"),!1;try{var a=e();return a.setDataMover({moveData:function(i){return o.engine.moveData(i)}}),this.registry[t]={backend:a,priority:r},this.registryFactory[t]=e,!0}catch(i){return console.warn("Registration of backend "+t+" failed"),console.warn(i.stack||i.message),!1}},n.prototype.removeBackend=function(t){if(!(t in this.registry))throw new Error(t+" backend not found in registry");this.registry[t].backend.dispose(),delete this.registry[t]},Object.defineProperty(n.prototype,"engine",{get:function(){return this.initEngine(),this.globalEngine},enumerable:!0,configurable:!0}),n.prototype.initEngine=function(){var t=this;if(this.globalEngine==null){this.backendName=this.get("BACKEND");var e=this.findBackend(this.backendName);this.globalEngine=new LK(e,!1,function(){return t.get("DEBUG")})}},Object.defineProperty(n.prototype,"global",{get:function(){return n4()},enumerable:!0,configurable:!0}),n}();function n4(){if(CC==null){var n=void 0;if(typeof window<"u")n=window;else if(typeof global<"u")n=global;else{if(typeof process>"u")throw new Error("Could not find a global object");n=process}CC=n}return CC}function e8(){var n=n4();return n.ENV==null&&(n.ENV=new hs(t4())),NK(function(){return n.ENV.engine}),n.ENV}function r4(n){Y.get("DEPRECATION_WARNINGS_ENABLED")&&console.warn(n+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}_K(r4);var Y=e8();function pl(n){var t=n;if(Xs(n))return[n.length];if(!Array.isArray(n))return[];for(var e=[];Array.isArray(t)||Xs(t);)e.push(t.length),t=t[0];return Array.isArray(n)&&Y.get("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&o4(n,e,[]),e}function o4(n,t,e){if(e=e||[],Array.isArray(n)||Xs(n)){et(t.length>0,function(){return"Element arr["+e.join("][")+"] should be a primitive, but is an array of "+n.length+" elements"}),et(n.length===t[0],function(){return"Element arr["+e.join("][")+"] should have "+t[0]+" elements, but has "+n.length+" elements"});for(var r=t.slice(1),o=0;o<n.length;++o)o4(n[o],r,e.concat(o))}else et(t.length===0,function(){return"Element arr["+e.join("][")+"] is a primitive, but should be an array/TypedArray of "+t[0]+" elements"})}function _$(n,t,e,r){if(n!=null&&(n!=="numeric"&&n!==t||n==="numeric"&&t==="string"))throw new Error("Argument '"+e+"' passed to '"+r+"' must be "+n+" tensor, but got "+t+" tensor")}function K(n,t,e,r){if(r===void 0&&(r="numeric"),n instanceof Gt)return _$(r,n.dtype,t,e),n;var o=Sm(n);if(o!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(o=r),_$(r,o,t,e),n==null||!Xs(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){var a=n==null?"null":n.constructor.name;throw new Error("Argument '"+t+"' passed to '"+e+"' must be a Tensor or TensorLike, but got '"+a+"'")}var i=pl(n);Xs(n)||Array.isArray(n)||(n=[n]);var s=o!=="string"?qM(n,o,Y.get("DEBUG")):_f(n);return Gt.make(i,{values:s},o)}function B0(n,t,e,r){if(r===void 0&&(r="numeric"),!Array.isArray(n))throw new Error("Argument "+t+" passed to "+e+" must be a `Tensor[]` or `TensorLike[]`");return n.map(function(o,a){return K(o,t+"["+a+"]",e)},r)}function n8(n,t){if(et(OS(n),function(){return"The f passed in variableGrads(f) must be a function"}),et(t==null||Array.isArray(t)&&t.every(function(u){return u instanceof km}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"}),t==null)for(var e in t=[],Y.engine.registeredVariables)t.push(Y.engine.registeredVariables[e]);var r=t.length;et((t=t.filter(function(u){return u.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+r+" variables is trainable."});var o=Y.engine.gradients(n,t,null,!0),a=o.value,i=o.grads;et(i.some(function(u){return u!=null}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),et(a.rank===0,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+a.rank+" tensor"});var s={};return t.forEach(function(u,l){i[l]!=null&&(s[u.name]=i[l])}),{value:a,grads:s}}function Im(n){return Y.engine.customGrad(n)}var he=hs.tidy,Nn=hs.keep,r8=hs.dispose;hs.time;hs.profile;function zS(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];Y.get("IS_TEST")||console.warn.apply(console,n)}function z0(n,t,e,r){r===void 0&&(r=!0);var o=[];if(r)(o=o.concat(t.slice(0))).push(n[0]/e),o=o.concat(n.slice(1));else{o=o.concat(n[0]);for(var a=t.length,i=0;i<a;++i)o=o.concat([n[i+1]/t[i],t[i]]);o=o.concat(n.slice(a+1))}return o}function U0(n,t,e){e===void 0&&(e=!0);var r=[];if(e){r.push(t);for(var o=t+1;o<n;++o)o<=2*t?(r.push(o),r.push(o-(t+1))):r.push(o)}else{var a=[],i=[];for(o=1;o<n;++o)o>=2*t+1||o%2==1?i.push(o):a.push(o);r.push.apply(r,a),r.push(0),r.push.apply(r,i)}return r}function W0(n,t,e,r){r===void 0&&(r=!0);var o=[];r?o.push(n[0]/e):o.push(n[0]*e);for(var a=1;a<n.length;++a)a<=t.length?r?o.push(t[a-1]*n[a]):o.push(n[a]/t[a-1]):o.push(n[a]);return o}function a4(n,t){for(var e=[0],r=0;r<t;++r)e.push(n[r][0]);return e}function i4(n,t,e){for(var r=n.slice(0,1),o=0;o<e;++o)r.push(n[o+1]-t[o][0]-t[o][1]);return r}function s4(n,t){for(var e=0;e<n.length;++e)if(n[n.length-e-1]!==t-1-e)return!1;return!0}function o8(n,t,e){for(var r=n.length+t.length,o=[],a=0,i=0,s=0;s<r;s++)e.indexOf(s)===-1?o.push(n[a++]):o.push(t[i++]);return o}function co(n,t){for(var e=[],r=n.length,o=0;o<r;o++)t.indexOf(o)===-1&&e.push(n[o]);return[e,t.map(function(a){return n[a]})]}function Ga(n,t){return o8(n,t.map(function(e){return 1}),t)}function la(n,t,e){et(s4(t,e),function(){return n+" supports only inner-most axes for now. Got axes "+t+" and rank-"+e+" input."})}function fs(n,t){if(s4(n,t))return null;for(var e=[],r=0;r<t;++r)n.indexOf(r)===-1&&e.push(r);return n.forEach(function(o){return e.push(o)}),e}function fk(n){return n.map(function(t,e){return[e,t]}).sort(function(t,e){return t[1]-e[1]}).map(function(t){return t[0]})}function ds(n,t){for(var e=[],r=t-n;r<t;++r)e.push(r);return e}function a8(n,t){var e=n[0].length;n.forEach(function(o,a){et(o.length===e,function(){return"Error in concat"+e+"D: rank of tensors["+a+"] must be the same as the rank of the rest ("+e+")"})}),et(t>=0&&t<e,function(){return"Error in concat"+e+"D: axis must be between 0 and "+(e-1)+"."});var r=n[0];n.forEach(function(o,a){for(var i=0;i<e;i++)et(i===t||o[i]===r[i],function(){return"Error in concat"+e+"D: Shape of tensors["+a+"] ("+o+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+a+"."})})}function Df(n,t){for(var e=n[0].slice(),r=1;r<n.length;r++)e[t]+=n[r][t];return e}function u4(n,t){if(n.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+n.rank+".");if(t.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if(t.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+t.dtype+".");if(t.shape[t.rank-1]>n.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+t.shape[t.rank-1]+" vs. "+n.rank);if(n.size===0)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+n.shape+".");for(var e=t.shape,r=e[e.length-1],o=1,a=0;a<e.length-1;++a)o*=e[a];var i=n.shape,s=e.slice();s.pop();var u=1;for(a=r;a<n.rank;++a)u*=i[a],s.push(i[a]);var l=Wc(n.shape).map(function(c){return c/u}).concat([1]).slice(0,r);return[s,o,u,l]}var l4=30;function SC(n){return n<=l4?n:FS(n,Math.floor(Math.sqrt(n)))}function i8(n,t,e){var r=t.rank>1?t.shape[t.rank-1]:1,o=t.rank>1?t.rank-1:1,a="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+e.shape+", indices.shape: "+t.shape+", shape: "+n+", sliceDim: "+r+", and batchDim: "+o+".";if(e.rank<o)throw new Error(a+" update.rank < "+o+". ");if(n.length<r+(e.rank-o))throw new Error(a+" Output shape length < "+(r+(e.rank-o)));if(e.rank!==o+n.length-r)throw new Error(a+" update.rank != "+(o+n.length-r));for(var i=0;i<o;++i)if(e.shape[i]!==t.shape[i])throw new Error(a+" updates.shape["+i+"] ("+e.shape[i]+") != indices.shape["+i+"] ("+t.shape[i]+").");for(i=0;i<e.rank-o;++i)if(e.shape[i+o]!==n[i+r])throw new Error(a+" updates.shape["+(i+o)+"] ("+e.shape[i+o]+") != shape["+(i+o)+"] ("+n[i+o]+")")}function s8(n,t,e){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if(n.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+n.rank+".");if(t.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+t.dtype);if(e.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+e);if(e.length===0){if(t.size===0)throw new Error("Indices specified for empty output. indices shape: "+t.shape);if(n.size===0)throw new Error("Updates specified for empty output. updates shape: "+n.shape)}i8(e,t,n)}function V0(n,t,e){for(var r=t.rank>1?t.shape[t.rank-1]:1,o=e.length,a=1,i=r;i<o;++i)a*=e[i];var s=r<1?1:r;return{sliceRank:r,numUpdates:t.size/s,sliceSize:a,strides:Wc(e.slice(0,r)).concat([1]),outputSize:de(e)}}function u8(n,t){var e,r=!1;for(n<=l4?(e=n,r=!0):e=FS(n,Math.floor(Math.sqrt(n)));!r;)e>t||e===n?r=!0:e=FS(n,e+1);return e}function l8(n,t,e){for(var r=[],o=n.length,a=0;a<o;a++)a!==t?r.push(n[a]):r.push(e);return r}function c8(n,t,e){for(var r=n.shape[e],o=[],a=1,i=1,s=0;s<e;s++)o.push(n.shape[s]),a*=n.shape[s];for(s=0;s<t.rank;s++)o.push(t.shape[s]);for(s=e+1;s<n.rank;s++)o.push(n.shape[s]),i*=n.shape[s];return{batchSize:a,sliceSize:i,dimSize:r,outputShape:o}}function h8(n,t,e){et(n.rank===t.length,function(){return"Error in slice"+n.rank+"D: Length of begin "+t+" must match the rank of the array ("+n.rank+")."}),et(n.rank===e.length,function(){return"Error in slice"+n.rank+"D: Length of size "+e+" must match the rank of the array ("+n.rank+")."});for(var r=function(a){et(t[a]+e[a]<=n.shape[a],function(){return"Error in slice"+n.rank+"D: begin["+a+"] + size["+a+"] ("+(t[a]+e[a])+") would overflow input.shape["+a+"] ("+n.shape[a]+")"})},o=0;o<n.rank;++o)r(o)}function dk(n,t,e,r,o,a,i,s,u){if(o===void 0&&(o=0),a===void 0&&(a=0),i===void 0&&(i=0),s===void 0&&(s=0),u===void 0&&(u=0),i!==0)throw new Error("ellipsis mask is not yet supported");if(s!==0)throw new Error("new axis mask is not yet supported");for(var l=[],c=[],h=[],d=0;d<n.length;d++)l[d]=f8(o,t,r,n,d),c[d]=d8(a,e,r,n,d),u&1<<d&&(c[d]=l[d]+1,h.push(d));var p=new Array(n.length).fill(0);return p=p.map(function(g,x){for(var y=0,b=r[x]||1,C=l[x];!(b>0?C>=c[x]:C<=c[x]);C+=b)y+=1;return y}),[l,p,h]}function f8(n,t,e,r,o){var a=t[o],i=e[o]||1;(n&1<<o||a==null)&&(a=i>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var s=r[o];return a<0&&(a+=s),a=DS(0,a,s-1)}function d8(n,t,e,r,o){var a=t[o],i=e[o]||1;(n&1<<o||a==null)&&(a=i>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var s=r[o];return a<0&&(a+=s),a=i>0?DS(0,a,s):DS(-1,a,s-1)}function c4(n,t,e){for(var r=e.length,o=0;o<e.length;o++)if(e[o]>1){r=o;break}for(o=r+1;o<e.length;o++)if(t[o]>0||e[o]!==n[o])return!1;return!0}function h4(n,t){for(var e=n.length>0?n[n.length-1]:1,r=0;r<n.length-1;r++)e+=n[r]*t[r];return e}function lt(n){var t=Object.keys(n);if(t.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+t.length+" keys.");var e=t[0],r=n[e];e.endsWith("_")&&(e=e.substring(0,e.length-1));var o=function(){for(var a=[],i=0;i<arguments.length;i++)a[i]=arguments[i];Y.engine.startScope(e);try{var s=r.apply(void 0,a);return s instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),Y.engine.endScope(s),s}catch(u){throw Y.engine.endScope(null),u}};return Object.defineProperty(o,"name",{value:e,configurable:!0}),o}function p8(n,t){t===void 0&&(t=-1);var e=K(n,"logits","softmax");if(t===-1&&(t=e.rank-1),t!==e.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+e.rank+" and dim was "+t);return Im(function(r,o){var a=r.logSumExp([t],!0),i=r.toFloat().sub(a).exp();return o([i]),{value:i,gradFunc:function(s,u){var l=u[0],c=s.mul(l);return c.sub(c.sum([t],!0).mul(l))}}})(e)}function m8(n,t){t===void 0&&(t=-1);var e=K(n,"logits","logSoftmax");if(t===-1&&(t=e.rank-1),t!==e.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+e.rank+" and axis was "+t);return Im(function(r,o){var a=r.max(t,!0),i=r.sub(a),s=i.toFloat().sub(i.exp().sum(t,!0).log());return o([s]),{value:s,gradFunc:function(u,l){var c=l[0].exp();return u.sub(u.sum(t,!0).mul(c))}}})(e)}var ml=lt({softmax_:p8}),g8=lt({logSoftmax_:m8});function v8(n,t){var e=K(n,"real","complex"),r=K(t,"imag","complex");return Cn(e.shape,r.shape,"real and imag shapes, "+e.shape+" and "+r.shape+", must match in call to tf.complex()."),Y.engine.runKernel(function(o){return o.complex(e,r)},{$real:e,$imag:r})}function x8(n){var t=K(n,"input","real");return Y.engine.runKernel(function(e){return e.real(t)},{$input:t})}function y8(n){var t=K(n,"input","imag");return Y.engine.runKernel(function(e){return e.imag(t)},{$input:t})}var ko=lt({complex_:v8}),Gi=lt({real_:x8}),Vu=lt({imag_:y8});function dr(n,t,e){if(e==null&&(e=Sm(n)),e==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!Xs(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");var r=pl(n);if(t!=null){KM(t);var o=de(t),a=de(r);et(o===a,function(){return"Based on the provided shape, ["+t+"], the tensor should have "+o+" values but has "+a});for(var i=0;i<r.length;++i){var s=r[i],u=i!==r.length-1||s!==de(t.slice(i));et(r[i]===t[i]||!u,function(){return"Error creating a new Tensor. Inferred shape ("+r+") does not match the provided shape ("+t+"). "})}}return Xs(n)||Array.isArray(n)||(n=[n]),t=t||r,n=e!=="string"?qM(n,e,Y.get("DEBUG")):_f(n),Gt.make(t,{values:n},e)}function zt(n,t){if((Xs(n)||Array.isArray(n))&&t!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");return dr(n,[],t)}function fa(n,t){ed(n);var e=pl(n);if(e.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return dr(n,e,t)}function Xy(n,t,e){if(ed(n),t!=null&&t.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var r=pl(n);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return dr(n,t=t||r,e)}function pk(n,t,e){if(ed(n),t!=null&&t.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var r=pl(n);if(r.length!==3&&r.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return dr(n,t=t||r,e)}function oi(n,t,e){if(ed(n),t!=null&&t.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var r=pl(n);if(r.length!==4&&r.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return dr(n,t=t||r,e)}function b8(n,t,e){if(ed(n),t!=null&&t.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var r=pl(n);if(r.length!==5&&r.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return dr(n,t=t||r,e)}function w8(n,t,e){if(ed(n),t!=null&&t.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var r=pl(n);if(r.length!==6&&r.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return dr(n,t=t||r,e)}function Cc(n,t){if(t===void 0&&(t="float32"),t==="complex64"){var e=Cc(n,"float32"),r=Cc(n,"float32");return ko(e,r)}var o=XM(de(n),t);return Gt.make(n,{values:o},t)}function ir(n,t){if(t===void 0&&(t="float32"),t==="complex64"){var e=ir(n,"float32"),r=ir(n,"float32");return ko(e,r)}var o=Em(de(n),t);return Gt.make(n,{values:o},t)}function jp(n,t,e){return Y.engine.runKernel(function(r){return r.fill(n,t,e)},{})}function C8(n){var t=K(n,"x","onesLike");if(t.dtype==="complex64"){var e=d4(Gi(t)),r=sn(Vu(t));return ko(e,r)}return Y.engine.runKernel(function(o){return o.onesLike(t)},{$x:t},null)}function S8(n){var t=K(n,"x","zerosLike");return Y.engine.runKernel(function(e){return e.zerosLike(t)},{$x:t},null)}function E8(n,t,e){if(e===0)throw new Error("Cannot request zero samples");var r=(t-n)/(e-1),o=Em(e,"float32");o[0]=n;for(var a=1;a<o.length;a++)o[a]=o[a-1]+r;return fa(o,"float32")}function f4(n,t,e,r){if(e===void 0&&(e=1),r===void 0&&(r="float32"),e===0)throw new Error("Cannot have a step of zero");if(n===t||n<t&&e<0||t<n&&e>1)return ir([0],r);var o=Em(Math.abs(Math.ceil((t-n)/e)),r);t<n&&e===1&&(e=-1),o[0]=n;for(var a=1;a<o.length;a++)o[a]=o[a-1]+e;return fa(o,r)}var d4=lt({onesLike_:C8}),sn=lt({zerosLike_:S8}),p4=function(){function n(t){this.dataMover=t,this.data=new WeakMap}return n.prototype.get=function(t){return this.data.has(t)||this.dataMover.moveData(t),this.data.get(t)},n.prototype.set=function(t,e){this.data.set(t,e)},n.prototype.has=function(t){return this.data.has(t)},n.prototype.delete=function(t){return this.data.delete(t)},n}();function m4(n,t,e){if(t==="complex64"){if(n.dtype==="complex64")return n.clone();var r=ir(n.shape),o=n.toFloat(),a=e.complex(o,r);return r.dispose(),o.dispose(),a}if(!bK(n.dtype,t))return Gt.make(n.shape,{dataId:n.dataId},t);if(n.dtype==="complex64"){var i=e.real(n);return a=i.cast(t),i.dispose(),a}if(t==="int32")return e.int(n);if(t==="bool"){var s=zt(0,n.dtype);return a=e.notEqual(n,s),s.dispose(),a}throw new Error("Error in Cast: unknown dtype argument ("+t+")")}function US(n,t){return Gt.make(t,{dataId:n.dataId},n.dtype)}function g4(n,t){if(n.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+n.length+", imag: "+t.length+".");for(var e=new Float32Array(2*n.length),r=0;r<e.length;r+=2)e[r]=n[r/2],e[r+1]=t[r/2];return e}function k8(n){for(var t=new Float32Array(n.length/2),e=new Float32Array(n.length/2),r=0;r<n.length;r+=2)t[r/2]=n[r],e[r/2]=n[r+1];return{real:t,imag:e}}function I8(n){for(var t=Math.ceil(n.length/4),e=new Float32Array(t),r=new Float32Array(t),o=0;o<n.length;o+=4)e[Math.floor(o/4)]=n[o],r[Math.floor(o/4)]=n[o+1];return{real:e,imag:r}}function R8(n){for(var t=Math.floor(n.length/4),e=new Float32Array(t),r=new Float32Array(t),o=2;o<n.length;o+=4)e[Math.floor(o/4)]=n[o],r[Math.floor(o/4)]=n[o+1];return{real:e,imag:r}}function D$(n,t){return{real:n[2*t],imag:n[2*t+1]}}function T8(n,t,e,r){n[2*r]=t,n[2*r+1]=e}function N8(n,t){for(var e=new Float32Array(n/2),r=new Float32Array(n/2),o=0;o<Math.ceil(n/2);o++){var a=(t?2:-2)*Math.PI*(o/n);e[o]=Math.cos(a),r[o]=Math.sin(a)}return{real:e,imag:r}}function A8(n,t,e){var r=(e?2:-2)*Math.PI*(n/t);return{real:Math.cos(r),imag:Math.sin(r)}}function mk(n,t,e,r,o){for(var a=Array.from(t).map(function(p,g){return{score:p,boxIndex:g}}).filter(function(p){return p.score>o}).sort(function(p,g){return g.score-p.score}),i=[],s=0;s<a.length;s++){var u=a[s],l=u.score,c=u.boxIndex;if(l<o)break;for(var h=!1,d=i.length-1;d>=0;--d)if(_8(n,c,i[d])>=r){h=!0;break}if(!h&&(i.push(c),i.length>=e))break}return fa(i,"int32")}function _8(n,t,e){var r=n.subarray(4*t,4*t+4),o=n.subarray(4*e,4*e+4),a=Math.min(r[0],r[2]),i=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),l=Math.min(o[0],o[2]),c=Math.min(o[1],o[3]),h=Math.max(o[0],o[2]),d=Math.max(o[1],o[3]),p=(s-a)*(u-i),g=(h-l)*(d-c);if(p<=0||g<=0)return 0;var x=Math.max(a,l),y=Math.max(i,c),b=Math.min(s,h),C=Math.min(u,d),E=Math.max(b-x,0)*Math.max(C-y,0);return E/(p+g-E)}function v4(n,t,e){var r=new Array(n.rank).fill(0),o=n.shape.slice();return t.map(function(a){o[e]=a;var i=n.slice(r,o);return r[e]+=a,i})}function x4(n,t,e,r,o){for(var a=t[t.length-1],i=[n.length/a,a],s=i[0],u=i[1],l=$S(e,s*r),c=$S("int32",s*r),h=0;h<s;h++){for(var d=h*u,p=n.subarray(d,d+u),g=[],x=0;x<p.length;x++)g.push({value:p[x],index:x});g.sort(function(S,k){return k.value-S.value});var y=h*r,b=l.subarray(y,y+r),C=c.subarray(y,y+r);for(x=0;x<r;x++)b[x]=g[x].value,C[x]=g[x].index}var E=t.slice();return E[E.length-1]=r,[dr(l,E,e),dr(c,E,"int32")]}var D8=function(){return function(n,t,e){this.variableNames=["A"];var r=n.windowSize,o=n.batchSize,a=n.inSize,i=Math.ceil(a/r);e||this.variableNames.push("bestIndicesA"),this.outputShape=[o,i];var s=t==="max"?">":"<",u=e?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+r+`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `+r+`; i++) {
          int inIdx = `+u+`;
          float candidate = getA(batch, inIdx);
          if (candidate `+s+` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}();function y4(n,t){return["x","y","z","w","u","v"].slice(0,t).map(function(e){return n+"."+e})}function da(n,t){return t===1?[n]:y4(n,t)}function $8(n,t){if(n===1)return"rc";for(var e="",r=0;r<n;r++)e+=t[r],r<n-1&&(e+=",");return e}function df(n,t){for(var e=n.length,r=[],o=0;o<e;o++){var a=e-1-o,i=n[a]||1;(t[t.length-1-o]||1)>1&&i===1&&r.unshift(a)}return r}function Ar(n,t){for(var e=[],r=0;r<t.length;r++){var o=n[n.length-r-1],a=t.length-r-1,i=t[a];(o==null||o===1&&i>1)&&e.unshift(a)}return e}function qe(n,t){for(var e=[],r=Math.max(n.length,t.length),o=0;o<r;o++){var a=n[n.length-o-1];a==null&&(a=1);var i=t[t.length-o-1];if(i==null&&(i=1),a===1)e.unshift(i);else if(i===1)e.unshift(a);else{if(a!==i)throw Error("Operands could not be broadcast together with shapes "+n+" and "+t+".");e.unshift(a)}}return e}function ps(){var n,t,e,r,o,a,i,s,u,l;return Y.get("WEBGL_VERSION")===2?(n="#version 300 es",t="in",e="out",r="in",o="texture",a="outputColor",i="out vec4 outputColor;",s=`
      const float NAN = uintBitsToFloat(uint(0x7fc00000));
    `,u=`
      const float INFINITY = uintBitsToFloat(uint(0x7f800000));
    `,l=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(n="",t="attribute",e="varying",r="varying",o="texture2D",a="gl_FragColor",i="",s=`
      uniform float NAN;

      bool isnan(float val) {
        return (val < 1.0 || 0.0 < val || val == 0.0) ? false : true;
      }
      bvec4 isnan(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,u=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,l=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:n,attribute:t,varyingVs:e,varyingFs:r,texture2D:o,output:a,defineOutput:i,defineSpecialNaN:s,defineSpecialInf:u,defineRound:l}}function Rm(n,t,e){e===void 0&&(e="index");var r=Wc(t);return r.map(function(o,a){return"int "+n[a]+" = "+e+" / "+o+"; "+(a===r.length-1?"int "+n[a+1]+" = "+e+" - "+n[a]+" * "+o:"index -= "+n[a]+" * "+o)+";"}).join("")}function Ix(n){return n.length===1?""+n[0]:"vec"+n.length+"("+n.join(",")+")"}function O8(n,t){if(n.length!==t.length)throw new Error("Vectors to be dotted must be of the same length -got "+n.length+" and "+t.length);for(var e=[],r=Math.floor(n.length/4),o=n.length%4,a=0;a<r;a++){var i=n.slice(4*a,4*a+4),s=t.slice(4*a,4*a+4);e.push(Ix(i)+", "+Ix(s))}return o!==0&&(i=n.slice(4*r),s=t.slice(4*r),i.length===1&&(i=i.map(function(u){return"float("+u+")"}),s=s.map(function(u){return"float("+u+")"})),e.push(Ix(i)+", "+Ix(s))),e.map(function(u,l){return"dot("+u+")"}).join("+")}function F8(n,t,e,r){var o=[];n.forEach(function(p){var g=de(p.shapeInfo.logicalShape);p.shapeInfo.isUniform?o.push("uniform float "+p.name+(g>1?"["+g+"]":"")+";"):(o.push("uniform sampler2D "+p.name+";"),o.push("uniform int offset"+p.name+";"))});var a,i,s=o.join(`
`),u=n.map(function(p){return M8(p,t,r)}).join(`
`),l=t.texShape,c=ps(),h=B8(c),d=W8(c);return t.isPacked?(a=L8(t.logicalShape,l),i=U8(c)):(a=P8(t.logicalShape,l),i=z8(c)),r&&(d+=q8),[d,h,i,s,a,u,e].join(`
`)}function nd(n){var t=n.shapeInfo.logicalShape;switch(t.length){case 0:return o7(n);case 1:return i7(n);case 2:return u7(n);case 3:return c7(n);case 4:return f7(n);case 5:return d7(n);case 6:return p7(n);default:throw new Error(t.length+"-D input sampling is not yet supported")}}function b4(n){switch(n.shapeInfo.logicalShape.length){case 0:return r7(n);case 1:return a7(n);case 2:return s7(n);case 3:return l7(n);default:return h7(n)}}function M8(n,t,e){e===void 0&&(e=!1);var r="";r+=e?b4(n):nd(n);var o=n.shapeInfo.logicalShape,a=t.logicalShape;return o.length<=a.length&&(r+=e?m7(n,t):g7(n,t)),r}function L8(n,t){switch(n.length){case 0:return w4();case 1:return j8(n,t);case 2:return e7(n,t);case 3:return K8(n,t);default:return Q8(n,t)}}function P8(n,t){switch(n.length){case 0:return w4();case 1:return X8(n,t);case 2:return n7(n,t);case 3:return Y8(n,t);case 4:return Z8(n,t);case 5:return J8(n,t);case 6:return t7(n,t);default:throw new Error(n.length+"-D output sampling is not yet supported")}}function B8(n){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return `+n.texture2D+`(textureSampler, uv).r;
    }
  `}function z8(n){return`
    void setOutput(float val) {
      `+n.output+` = vec4(val, 0, 0, 0);
    }
  `}function U8(n){return`
    void setOutput(vec4 val) {
      `+n.output+` = val;
    }
  `}function W8(n){return n.version+`
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    `+n.varyingFs+` vec2 resultUV;
    `+n.defineOutput+`
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    `+n.defineSpecialNaN+`
    `+n.defineSpecialInf+`
    `+n.defineRound+`

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    `+V8+`
    `+G8+`
    `+H8+`
  `}var V8=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,G8=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,H8=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,q8=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function w4(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function j8(n,t){var e=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];return e[0]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `+e[1]+`.0);
      }
    `:e[1]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `+e[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+e[0]+", "+e[1]+`));
      return resTexRC.x * `+e[1]+` + resTexRC.y;
    }
  `}function X8(n,t){return t[0]===1?`
      int getOutputCoords() {
        return int(resultUV.x * `+t[1]+`.0);
      }
    `:t[1]===1?`
      int getOutputCoords() {
        return int(resultUV.y * `+t[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+t[0]+", "+t[1]+`));
      return resTexRC.x * `+t[1]+` + resTexRC.y;
    }
  `}function K8(n,t){var e=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(n[2]/2),o=r*Math.ceil(n[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+e[0]+", "+e[1]+`));
      int index = resTexRC.x * `+e[1]+` + resTexRC.y;

      int b = index / `+o+`;
      index -= b * `+o+`;

      int r = 2 * (index / `+r+`);
      int c = imod(index, `+r+`) * 2;

      return ivec3(b, r, c);
    }
  `}function Y8(n,t){var e=Rm(["r","c","d"],n);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+t[0]+", "+t[1]+`));
      int index = resTexRC.x * `+t[1]+` + resTexRC.y;
      `+e+`
      return ivec3(r, c, d);
    }
  `}function Q8(n,t){for(var e=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(n[n.length-1]/2),o=r*Math.ceil(n[n.length-2]/2),a=o,i="",s="b, r, c",u=2;u<n.length-1;u++)i=`
      int b`+u+" = index / "+(a*=n[n.length-u-1])+`;
      index -= b`+u+" * "+a+`;
    `+i,s="b"+u+", "+s;return`
    ivec`+n.length+` getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+e[0]+", "+e[1]+`));
      int index = resTexRC.x * `+e[1]+` + resTexRC.y;

      `+i+`

      int b = index / `+o+`;
      index -= b * `+o+`;

      int r = 2 * (index / `+r+`);
      int c = imod(index, `+r+`) * 2;

      return ivec`+n.length+"("+s+`);
    }
  `}function Z8(n,t){var e=Rm(["r","c","d","d2"],n);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+t[0]+", "+t[1]+`));
      int index = resTexRC.x * `+t[1]+` + resTexRC.y;
      `+e+`
      return ivec4(r, c, d, d2);
    }
  `}function J8(n,t){var e=Rm(["r","c","d","d2","d3"],n);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`+t[0]+`,
                             `+t[1]+`));

      int index = resTexRC.x * `+t[1]+` + resTexRC.y;

      `+e+`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function t7(n,t){var e=Rm(["r","c","d","d2","d3","d4"],n);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+t[0]+", "+t[1]+`));
      int index = resTexRC.x * `+t[1]+` + resTexRC.y;

      `+e+`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function e7(n,t){var e=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(Ao(n,t))return`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`+e[0]+", "+e[1]+`));
      }
    `;var r=Math.ceil(n[1]/2);return`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+e[0]+", "+e[1]+`));

      int index = resTexRC.x * `+e[1]+` + resTexRC.y;
      int r = 2 * (index / `+r+`);
      int c = imod(index, `+r+`) * 2;

      return ivec2(r, c);
    }
  `}function n7(n,t){return Ao(n,t)?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`+t[0]+", "+t[1]+`));
      }
    `:n[1]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+t[0]+", "+t[1]+`));
        int index = resTexRC.x * `+t[1]+` + resTexRC.y;
        return ivec2(index, 0);
      }
    `:n[0]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+t[0]+", "+t[1]+`));
        int index = resTexRC.x * `+t[1]+` + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+t[0]+", "+t[1]+`));
      int index = resTexRC.x * `+t[1]+` + resTexRC.y;
      int r = index / `+n[1]+`;
      int c = index - r * `+n[1]+`;
      return ivec2(r, c);
    }
  `}function Vc(n){return"offset"+n}function r7(n){var t=n.name;return`
    vec4 `+("get"+t.charAt(0).toUpperCase()+t.slice(1))+`() {
      return `+ps().texture2D+"("+t+`, halfCR);
    }
  `}function o7(n){var t=n.name,e="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return"float "+e+"() {return "+t+";}";var r=n.shapeInfo.texShape,o=r[0],a=r[1];if(o===1&&a===1)return`
      float `+e+`() {
        return sampleTexture(`+t+`, halfCR);
      }
    `;var i=n.shapeInfo.texShape;return`
    float `+e+`() {
      vec2 uv = uvFromFlat(`+i[0]+", "+i[1]+", "+Vc(t)+`);
      return sampleTexture(`+t+`, uv);
    }
  `}function a7(n){var t=n.name,e="get"+t.charAt(0).toUpperCase()+t.slice(1),r=n.shapeInfo.texShape,o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],a=ps();return`
    vec4 `+e+`(int index) {
      vec2 uv = packedUVfrom1D(
        `+o[0]+", "+o[1]+`, index);
      return `+a.texture2D+"("+t+`, uv);
    }
  `}function i7(n){var t=n.name,e="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return`
      float `+e+`(int index) {
        `+rd(n)+`
      }
    `;var r=n.shapeInfo.texShape,o=r[0],a=r[1];if(a===1&&o===1)return`
      float `+e+`(int index) {
        return sampleTexture(`+t+`, halfCR);
      }
    `;var i=Vc(t);return a===1?`
      float `+e+`(int index) {
        vec2 uv = vec2(0.5, (float(index + `+i+") + 0.5) / "+o+`.0);
        return sampleTexture(`+t+`, uv);
      }
    `:o===1?`
      float `+e+`(int index) {
        vec2 uv = vec2((float(index + `+i+") + 0.5) / "+a+`.0, 0.5);
        return sampleTexture(`+t+`, uv);
      }
    `:`
    float `+e+`(int index) {
      vec2 uv = uvFromFlat(`+o+", "+a+", index + "+i+`);
      return sampleTexture(`+t+`, uv);
    }
  `}function s7(n){var t=n.shapeInfo.logicalShape,e=n.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1),o=n.shapeInfo.texShape,a=o[0],i=o[1],s=ps();if(o!=null&&Ao(t,o))return`
      vec4 `+r+`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`+i+".0, "+a+`.0);

        return `+s.texture2D+"("+e+`, uv);
      }
    `;var u=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];return`
    vec4 `+r+`(int row, int col) {
      vec2 uv = packedUVfrom2D(`+Math.ceil(t[1]/2)+", "+u[0]+", "+u[1]+`, row, col);
      return `+s.texture2D+"("+e+`, uv);
    }
  `}function u7(n){var t=n.shapeInfo.logicalShape,e=n.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1),o=n.shapeInfo.texShape;if(o!=null&&Ao(t,o)){var a=o[0];return`
    float `+r+`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`+o[1]+".0, "+a+`.0);
      return sampleTexture(`+e+`, uv);
    }
  `}var i=Uc(t),s=i.newShape,u=i.keptDims,l=s;if(l.length<t.length)return`
      `+nd(od(n,l))+`
      float `+r+`(int row, int col) {
        return `+r+"("+ad(["row","col"],u)+`);
      }
    `;if(n.shapeInfo.isUniform)return`
      float `+r+`(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(`+t[1]+`, 1)));
        `+rd(n)+`
      }
    `;var c=o[0],h=o[1],d=Vc(e);return h===1?`
    float `+r+`(int row, int col) {
      float index = dot(vec3(row, col, `+d+"), vec3("+t[1]+`, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `+c+`.0);
      return sampleTexture(`+e+`, uv);
    }
  `:c===1?`
    float `+r+`(int row, int col) {
      float index = dot(vec3(row, col, `+d+"), vec3("+t[1]+`, 1, 1));
      vec2 uv = vec2((index + 0.5) / `+h+`.0, 0.5);
      return sampleTexture(`+e+`, uv);
    }
  `:`
  float `+r+`(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * `+t[1]+" + col + "+d+`;
    vec2 uv = uvFromFlat(`+c+", "+h+`, index);
    return sampleTexture(`+e+`, uv);
  }
`}function l7(n){var t=n.shapeInfo.logicalShape,e=n.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1),o=n.shapeInfo.texShape,a=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];if(t[0]===1)return`
        `+b4(od(n,t.slice(1)))+`
        vec4 `+r+`(int b, int row, int col) {
          return `+r+"("+ad(["b","row","col"],[1,2])+`);
        }
      `;var i=a[0],s=a[1],u=Math.ceil(t[2]/2);return`
    vec4 `+r+`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `+i+", "+s+", "+u*Math.ceil(t[1]/2)+", "+u+`, b, row, col);
      return `+ps().texture2D+"("+e+`, uv);
    }
  `}function c7(n){var t=n.shapeInfo.logicalShape,e=n.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1),o=t[1]*t[2],a=t[2],i=Uc(t),s=i.newShape,u=i.keptDims,l=s;if(l.length<t.length)return`
        `+nd(od(n,l))+`
        float `+r+`(int row, int col, int depth) {
          return `+r+"("+ad(["row","col","depth"],u)+`);
        }
      `;if(n.shapeInfo.isUniform)return`
      float `+r+`(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(`+o+", "+a+`, 1)));
        `+rd(n)+`
      }
    `;var c=n.shapeInfo.texShape,h=c[0],d=c[1],p=n.shapeInfo.flatOffset;return d===o&&p==null?`
        float `+r+`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`+a+`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`+d+".0, "+h+`.0);
          return sampleTexture(`+e+`, uv);
        }
      `:d===a&&p==null?`
    float `+r+`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`+t[1]+`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+d+".0, "+h+`.0);
      return sampleTexture(`+e+`, uv);
    }
  `:`
      float `+r+`(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `+o+" + col * "+a+" + depth + "+Vc(e)+`;
        vec2 uv = uvFromFlat(`+h+", "+d+`, index);
        return sampleTexture(`+e+`, uv);
      }
  `}function h7(n){for(var t=n.shapeInfo.logicalShape,e=t.length,r=n.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),a=n.shapeInfo.texShape,i=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],s=i[0],u=i[1],l=Math.ceil(t[e-1]/2),c=l*Math.ceil(t[e-2]/2),h="int b, int row, int col",d="b * "+c+" + (row / 2) * "+l+" + (col / 2)",p=2;p<e-1;p++)h="int b"+p+", "+h,d="b"+p+" * "+(c*=t[e-p-1])+" + "+d;return`
    vec4 `+o+"("+h+`) {
      int index = `+d+`;
      int texR = index / `+u+`;
      int texC = index - texR * `+u+`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+u+", "+s+`);
      return `+ps().texture2D+"("+r+`, uv);
    }
  `}function f7(n){var t=n.shapeInfo.logicalShape,e=n.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1),o=t[3],a=t[2]*o,i=t[1]*a,s=Uc(t),u=s.newShape,l=s.keptDims;if(u.length<t.length)return`
      `+nd(od(n,u))+`
      float `+r+`(int row, int col, int depth, int depth2) {
        return `+r+"("+ad(["row","col","depth","depth2"],l)+`);
      }
    `;if(n.shapeInfo.isUniform)return`
      float `+r+`(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(`+i+", "+a+", "+o+`, 1)));
        `+rd(n)+`
      }
    `;var c=n.shapeInfo.flatOffset,h=n.shapeInfo.texShape,d=h[0],p=h[1];return p===i&&c==null?`
      float `+r+`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(`+a+", "+o+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+p+".0, "+d+`.0);
        return sampleTexture(`+e+`, uv);
      }
    `:p===o&&c==null?`
      float `+r+`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`+t[1]*t[2]+", "+t[2]+`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+p+".0, "+d+`.0);
        return sampleTexture(`+e+`, uv);
      }
    `:`
    float `+r+`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+i+" + col * "+a+` +
          depth * `+o+` + depth2;
      vec2 uv = uvFromFlat(`+d+", "+p+", index + "+Vc(e)+`);
      return sampleTexture(`+e+`, uv);
    }
  `}function d7(n){var t=n.shapeInfo.logicalShape,e=n.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1),o=t[4],a=t[3]*o,i=t[2]*a,s=t[1]*i,u=Uc(t),l=u.newShape,c=u.keptDims;if(l.length<t.length)return`
      `+nd(od(n,l))+`
      float `+r+`(int row, int col, int depth, int depth2, int depth3) {
        return `+r+"("+ad(["row","col","depth","depth2","depth3"],c)+`);
      }
    `;if(n.shapeInfo.isUniform)return`
      float `+r+`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`+s+", "+i+", "+a+", "+o+`)) +
          depth3;
        `+rd(n)+`
      }
    `;var h=n.shapeInfo.flatOffset,d=n.shapeInfo.texShape,p=d[0],g=d[1];return g===s&&h==null?`
      float `+r+`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(`+i+", "+a+", "+o+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+g+".0, "+p+`.0);
        return sampleTexture(`+e+`, uv);
      }
    `:g===o&&h==null?`
      float `+r+`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`+t[1]*t[2]*t[3]+`,
               `+t[2]*t[3]+", "+t[3]+`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+g+".0, "+p+`.0);
        return sampleTexture(`+e+`, uv);
      }
    `:`
    float `+r+`(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+s+" + col * "+i+" + depth * "+a+` +
          depth2 * `+o+" + depth3 + "+Vc(e)+`;
      vec2 uv = uvFromFlat(`+p+", "+g+`, index);
      return sampleTexture(`+e+`, uv);
    }
  `}function p7(n){var t=n.shapeInfo.logicalShape,e=n.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1),o=Uc(t),a=o.newShape,i=o.keptDims;if(a.length<t.length)return`
      `+nd(od(n,a))+`
      float `+r+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `+r+"("+ad(["row","col","depth","depth2","depth3","depth4"],i)+`);
      }
    `;var s=t[5],u=t[4]*s,l=t[3]*u,c=t[2]*l,h=t[1]*c;if(n.shapeInfo.isUniform)return`
      float `+r+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(`+h+", "+c+", "+l+", "+u+`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`+s+`, 1)));
        `+rd(n)+`
      }
    `;var d=n.shapeInfo.flatOffset,p=n.shapeInfo.texShape,g=p[0],x=p[1];return x===h&&d==null?`
      float `+r+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(`+c+", "+l+", "+u+", "+s+`)) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+x+".0, "+g+`.0);
        return sampleTexture(`+e+`, uv);
      }
    `:x===s&&d==null?`
      float `+r+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(`+t[1]*t[2]*t[3]*t[4]+`,
               `+t[2]*t[3]*t[4]+`,
               `+t[3]*t[4]+`,
               `+t[4]+`)) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+x+".0, "+g+`.0);
        return sampleTexture(`+e+`, uv);
      }
    `:`
    float `+r+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+h+" + col * "+c+" + depth * "+l+` +
          depth2 * `+u+" + depth3 * "+s+" + depth4 + "+Vc(e)+`;
      vec2 uv = uvFromFlat(`+g+", "+x+`, index);
      return sampleTexture(`+e+`, uv);
    }
  `}function rd(n){var t=n.name,e=de(n.shapeInfo.logicalShape);return e<2?"return "+t+";":`
    for (int i = 0; i < `+e+`; i++) {
      if (i == index) {
        return `+t+`[i];
      }
    }
  `}function m7(n,t){var e,r=n.name,o=r.charAt(0).toUpperCase()+r.slice(1),a="get"+o+"AtOutCoords",i=n.shapeInfo.logicalShape.length,s=t.logicalShape.length,u=df(n.shapeInfo.logicalShape,t.logicalShape),l=Fn(s),c=s-i,h=["x","y","z","w","u","v"];e=i===0?"":s<2&&u.length>=1?"coords = 0;":u.map(function(y){return"coords."+h[y+c]+" = 0;"}).join(`
`);var d="";d=s<2&&i>0?"coords":n.shapeInfo.logicalShape.map(function(y,b){return"coords."+h[b+c]}).join(", ");var p="return outputValue;";if(i===1&&s>1)p=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(i===0&&s>0)p=s===1?`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:`
        return vec4(outputValue.x);
      `;else if(u.length){var g=i-2,x=i-1;u.indexOf(g)>-1&&u.indexOf(x)>-1?p="return vec4(outputValue.x);":u.indexOf(g)>-1?p="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":u.indexOf(x)>-1&&(p="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 `+a+`() {
      `+l+` coords = getOutputCoords();
      `+e+`
      vec4 outputValue = get`+o+"("+d+`);
      `+p+`
    }
  `}function g7(n,t){var e=n.name,r=e.charAt(0).toUpperCase()+e.slice(1),o="get"+r+"AtOutCoords",a=t.texShape,i=n.shapeInfo.texShape,s=n.shapeInfo.logicalShape.length,u=t.logicalShape.length;if(!n.shapeInfo.isUniform&&s===u&&n.shapeInfo.flatOffset==null&&Ao(i,a))return`
      float `+o+`() {
        return sampleTexture(`+e+`, resultUV);
      }
    `;var l=Fn(u),c=df(n.shapeInfo.logicalShape,t.logicalShape),h=u-s,d=["x","y","z","w","u","v"];return`
    float `+o+`() {
      `+l+` coords = getOutputCoords();
      `+(s===0?"":u<2&&c.length>=1?"coords = 0;":c.map(function(p){return"coords."+d[p+h]+" = 0;"}).join(`
`))+`
      return get`+r+"("+(u<2&&s>0?"coords":n.shapeInfo.logicalShape.map(function(p,g){return"coords."+d[g+h]}).join(", "))+`);
    }
  `}function Fn(n){if(n<=1)return"int";if(n===2)return"ivec2";if(n===3)return"ivec3";if(n===4)return"ivec4";if(n===5)return"ivec5";if(n===6)return"ivec6";throw Error("GPU for rank "+n+" is not yet supported")}function od(n,t){var e=JSON.parse(JSON.stringify(n));return e.shapeInfo.logicalShape=t,e}function ad(n,t){return t.map(function(e){return n[e]}).join(", ")}var v7=function(){return function(n,t,e,r){this.variableNames=["A"],this.usesPackedTextures=!0,et(n.length>2,function(){return"Packed arg"+(e.charAt(0).toUpperCase()+e.slice(1))+" supports only inputs with rank above 2."});var o=n[n.length-1],a=Math.ceil(o/t);this.outputShape=n.slice(0,-1),a>1&&this.outputShape.push(a),r||this.variableNames.push("bestIndicesA");var i,s,u=this.outputShape,l=u.length,c=Fn(l),h=da("coords",l);if(a===1){var d=Fn(s=l+1);i=`
        `+d+" sourceLocR = "+d+"("+h.join()+`, 0);
        ++`+h[l-1]+`;
        `+d+" sourceLocG = "+d+"("+h.join()+`, 0);
        ++`+h[l-2]+`;
        `+d+" sourceLocA = "+d+"("+h.join()+`, 0);
        --`+h[l-1]+`;
        `+d+" sourceLocB = "+d+"("+h.join()+`, 0);
        --`+h[l-2]+";"}else s=l,i=`
        `+c+` sourceLocR = coords;
        ++`+h[l-1]+`;
        `+c+` sourceLocG = coords;
        ++`+h[l-2]+`;
        `+c+` sourceLocA = coords;
        --`+h[l-1]+`;
        `+c+` sourceLocB = coords;
        --`+h[l-2]+";";var p=["x","y","z","w","u","v"].slice(0,s),g="."+p[s-1],x=p.map(function(N){return"int "+N}),y=da("sourceLocR",s-1).concat("inIdx.r"),b=da("sourceLocG",s-1).concat("inIdx.g"),C=da("sourceLocB",s-1).concat("inIdx.b"),E=da("sourceLocA",s-1).concat("inIdx.a"),S=e==="max"?"greaterThan":"lessThan",k=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(`+y.join()+`),
                             getBestIndicesAChannel(`+b.join()+`),
                             getBestIndicesAChannel(`+C.join()+`),
                             getBestIndicesAChannel(`+E.join()+")));",R=`vec4(
            getAChannel(`+y.join()+`),
            hasNextCol ? getAChannel(`+b.join()+`) : 0.,
            hasNextRow ? getAChannel(`+C.join()+`) : 0.,
            hasNextRow && hasNextCol ? getAChannel(`+E.join()+") : 0.)",A=r?"":`
      float getBestIndicesAChannel(`+x.join()+`) {
        return getChannel(getBestIndicesA(`+p.join()+`),
                                          vec2(`+p.slice(-2).join()+`));
      }`;this.userCode=`
      float getAChannel(`+x.join()+`) {
        return getChannel(getA(`+p.join()+`),
                               vec2(`+p.slice(-2).join()+`));
      }
      `+A+`
      void main() {
        `+c+` coords = getOutputCoords();
        bool hasNextCol = `+h[l-1]+" < "+(u[l-1]-1)+`;
        bool hasNextRow = `+h[l-2]+" < "+(u[l-2]-1)+`;
        `+i+`
        ivec4 srcIdx = ivec4(sourceLocR`+g+", sourceLocG"+g+`,
          sourceLocB`+g+", sourceLocA"+g+") * "+t+`;
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = `+R+`;

        for (int i = 0; i < `+t+`; i++) {
          inIdx = srcIdx;
          `+k+`
          vec4 candidate = `+R+`;
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(`+S+`(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}(),x7=function(){return function(n){this.variableNames=["dy"],this.outputShape=n.inShape;var t=n.filterHeight,e=n.filterWidth,r=n.strideHeight,o=n.strideWidth,a=n.dilationHeight,i=n.dilationWidth,s=n.effectiveFilterHeight,u=n.effectiveFilterWidth,l=s-1-n.padInfo.top,c=u-1-n.padInfo.left,h=1/(t*e);this.userCode=`
      const ivec2 pads = ivec2(`+l+", "+c+`);
      const float avgMultiplier = float(`+h+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+s+`;
            wR += `+a+`) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+u+`;
            wC+= `+i+`) {
            float dyC = float(dyCCorner + wC) / `+o+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}(),y7=function(){return function(n,t,e,r,o,a){this.outputShape=[],this.variableNames=["x","mean","variance"],qe(n,t),qe(n,e);var i="0.0";r!=null&&(qe(n,r),this.variableNames.push("offset"),i="getOffsetAtOutCoords()");var s="1.0";o!=null&&(qe(n,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=n,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `+i+`;
        float scale = `+s+`;
        float inv = scale * inversesqrt(variance + float(`+a+`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}(),b7=function(){return function(n,t,e,r,o,a){this.usesPackedTextures=!0,this.variableNames=["x","mean","variance"],qe(n,t),qe(n,e);var i="vec4(0.0)";r!=null&&(qe(n,r),this.variableNames.push("offset"),i="getOffsetAtOutCoords()");var s="vec4(1.0)";o!=null&&(qe(n,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=n,this.userCode=`
      void main() {
        vec4 offset = `+i+`;
        vec4 scale = `+s+`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`+a+`));

        setOutput((x - mean) * inv + offset);
      }
    `}}(),$$={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"},O$=function(){return function(n,t,e){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=qe(t,e),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `+n+`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}(),gk=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`,EC="return a + b;",kC="return a - b;",F$="return a * b;",w7=`if (a == b) return 1.0;
  return a / b;`,C7=`
  float resultSign = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  int result = ia / ib;
  int amodb = ia - ib * result;

  if (resultSign < 0.0 && amodb != 0) {
    result -= 1;
  }
  return float(result);
`,S7=`
if(a < 0.0 && floor(b) < b){
  return NAN;
}
return (round(mod(b, 2.0)) != 1) ?
    pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,M$="return (a - b) * (a - b);",E7="return float(a == b);",k7="return float(a != b);",I7="return float(a < b);",R7="return float(a <= b);",T7="return float(a > b);",N7="return float(a >= b);",A7="return float(a >= 1.0 && b >= 1.0);",_7="return float(a >= 1.0 || b >= 1.0);",D7=gk+`
  return max(a, b);
`,$7=gk+`
  return min(a, b);
`,O7=`if (b == 0.0) return NAN;
  return mod(a, b);`,F7=gk+`
  return atan(a, b);
`,M7="return (b >= 1.0) ? a : a * (b + 1.0);",L7="return (a < 0.) ? b * a : a;",jn=function(){return function(n,t,e){this.variableNames=["A","B"],this.outputShape=qe(t,e),this.userCode=`
      float binaryOperation(float a, float b) {
        `+n+`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}(),Tm=`
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;
`,P7=`
  vec4 resultSign = sign(a) * sign(b);
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  ivec4 result = ia / ib;
  ivec4 amodb = ia - ib * result;

  // Vectorize INT_DIV
  // if (resultSign < 0.0 && amodb != 0) result -= 1;
  // return float(result);
  return vec4(result -
     ivec4(lessThan(resultSign, vec4(0.0))) * ivec4(notEqual(amodb, ivec4(0))));
`,B7=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));
  `+Tm+`
  return result;
`,z7=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`,U7=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,W7=`
  vec4 result = atan(a, b);
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  `+Tm+`
  return result;
`,V7=`
  return vec4(equal(a, b));
`,G7=`
  return vec4(notEqual(a, b));
`,H7=`
  return vec4(lessThan(a, b));
`,q7=`
  return vec4(lessThanEqual(a, b));
`,j7=`
  return vec4(greaterThan(a, b));
`,X7=`
  return vec4(greaterThanEqual(a, b));
`,K7=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,Y7=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,Q7=`
  vec4 result = vec4(max(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  `+Tm+`
  return result;
`,Z7=`
  vec4 result = vec4(min(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  `+Tm+`
  return result;
`,J7=`
  vec4 result = mod(a, b);
  vec4 isNaN = vec4(equal(b, vec4(0.0)));
  `+Tm+`
  return result;
`,Os=function(){return function(n,t,e){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.usesPackedTextures=!0,this.outputShape=qe(t,e),this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        `+n+`
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}(),t9=function(){function n(t){this.variableNames=["A"],this.outputShape=t,this.userCode=`
      uniform float min;
      uniform float max;

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, min, max));
      }
    `}return n.prototype.getCustomSetupFunc=function(t,e){var r=this;return function(o,a){r.minLoc==null&&(r.minLoc=o.getUniformLocationNoThrow(a,"min"),r.maxLoc=o.getUniformLocationNoThrow(a,"max")),o.gl.uniform1f(r.minLoc,t),o.gl.uniform1f(r.maxLoc,e)}},n}(),e9=function(){function n(t){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=t,this.userCode=`
      uniform float min;
      uniform float max;

      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(min), vec4(max)));
      }
    `}return n.prototype.getCustomSetupFunc=function(t,e){var r=this;return function(o,a){r.minLoc==null&&(r.minLoc=o.getUniformLocationNoThrow(a,"min"),r.maxLoc=o.getUniformLocationNoThrow(a,"max")),o.gl.uniform1f(r.minLoc,t),o.gl.uniform1f(r.maxLoc,e)}},n}(),n9=function(){return function(n){this.variableNames=["real","imag"],this.outputShape=n,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}(),r9=function(){return function(n){this.outputShape=[],this.outputShape=Df(n,1),this.variableNames=n.map(function(s,u){return"T"+u});var t=new Array(n.length-1);t[0]=n[0][1];for(var e=1;e<t.length;e++)t[e]=t[e-1]+n[e][1];var r=["if (yC < "+t[0]+") setOutput(getT0(yR, yC));"];for(e=1;e<t.length;e++){var o=t[e-1];r.push("else if (yC < "+t[e]+") setOutput(getT"+e+"(yR, yC-"+o+"));")}var a=t.length,i=t[t.length-1];r.push("else setOutput(getT"+a+"(yR, yC-"+i+"));"),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        `+r.join(`
        `)+`
      }
    `}}(),o9=function(){return function(n,t){this.usesPackedTextures=!0,this.outputShape=[],this.outputShape=Df(n,t);var e=this.outputShape,r=e.length,o=Fn(r),a=da("coords",r),i=["x","y","z","w","u","v"].slice(0,r);this.variableNames=n.map(function(x,y){return"T"+y});var s=new Array(n.length-1);s[0]=n[0][t];for(var u=1;u<s.length;u++)s[u]=s[u-1]+n[u][t];var l=i[t],c="vec2("+i.slice(-2).join()+")",h=i.join(),d="if ("+l+" < "+s[0]+`)
          return getChannel(getT0(`+h+"), "+c+");";for(u=1;u<s.length;u++){var p=s[u-1];d+=`
        else if (`+l+" < "+s[u]+`) {
          `+l+" -= "+p+`;
          return getChannel(getT`+u+"("+h+"), "+c+`);
        }`}var g=s.length;d+=`
        else {
          `+l+" -= "+s[s.length-1]+`;
          return getChannel(getT`+g+"("+h+"), "+c+`);
        }`,this.userCode=`
      float getValue(`+i.map(function(x){return"int "+x})+`) {
        `+d+`
      }

      void main() {
        `+o+` coords = getOutputCoords();
        vec4 result = vec4(getValue(`+a+`), 0., 0., 0.);
        if (++`+a[r-1]+" < "+e[r-1]+`) {
          result.g = getValue(`+a+`);
        }
        if (++`+a[r-2]+" < "+e[r-2]+`) {
          result.a = getValue(`+a+`);
        }
        if (`+a[r-2]+" < "+e[r-2]+` &&
            --`+a[r-1]+" < "+e[r-1]+`) {
          result.b = getValue(`+a+`);
        }
        setOutput(result);
      }
    `}}(),a9=function(){return function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;var t=n.strideHeight,e=n.strideWidth,r=n.padInfo.top,o=n.padInfo.left;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `+n.batchSize+`; b++) {
          for (int yR = 0; yR < `+n.outHeight+`; yR++) {
            int xR = wR + yR * `+t+" - "+r+`;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+n.outWidth+`; yC++) {
              int xC = wC + yC * `+e+" - "+o+`;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),i9=function(){return function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var t=n.filterHeight,e=n.filterWidth,r=n.strideHeight,o=n.strideWidth,a=t-1-n.padInfo.top,i=e-1-n.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(`+a+", "+i+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+t+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+t+` - 1 - wR;

          for (int wC = 0; wC < `+e+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+o+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+e+` - 1 - wC;

            for (int d2 = 0; d2 < `+n.outChannels+`; d2++) {
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, d2);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),s9=function(){return function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;var t=n.strideDepth,e=n.strideHeight,r=n.strideWidth,o=n.padInfo.front,a=n.padInfo.top,i=n.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `+n.batchSize+`; b++) {
          for (int yF = 0; yF < `+n.outDepth+`; yF++) {
            int xF = wF + yF * `+t+" - "+o+`;

            if (xF < 0 || xF >= `+n.inDepth+`) {
              continue;
            }

            for (int yR = 0; yR < `+n.outHeight+`; yR++) {
              int xR = wR + yR * `+e+" - "+a+`;

              if (xR < 0 || xR >= `+n.inHeight+`) {
                continue;
              }

              for (int yC = 0; yC < `+n.outWidth+`; yC++) {
                int xC = wC + yC * `+r+" - "+i+`;

                if (xC < 0 || xC >= `+n.inWidth+`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),u9=function(){return function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var t=n.filterDepth,e=n.filterHeight,r=n.filterWidth,o=n.strideDepth,a=n.strideHeight,i=n.strideWidth,s=t-1-n.padInfo.front,u=e-1-n.padInfo.top,l=r-1-n.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`+s+", "+u+", "+l+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `+t+`; wF++) {
          float dyF = float(dyFCorner + wF) / `+o+`.0;

          if (dyF < 0.0 || dyF >= `+n.outDepth+`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `+t+` - 1 - wF;

          for (int wR = 0; wR < `+e+`; wR++) {
            float dyR = float(dyRCorner + wR) / `+a+`.0;

            if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `+e+` - 1 - wR;

            for (int wC = 0; wC < `+r+`; wC++) {
              float dyC = float(dyCCorner + wC) / `+i+`.0;

              if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `+r+` - 1 - wC;

              for (int d2 = 0; d2 < `+n.outChannels+`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),l9=function(){return function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;var t=n.strideHeight,e=n.strideWidth,r=n.padInfo.top,o=n.padInfo.left,a=n.outChannels/n.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `+a+` + dm;

        float dotProd = 0.0;

        // TODO: Vec4 over the batch size
        for (int b = 0; b < `+n.batchSize+`; b++) {
          for (int yR = 0; yR < `+n.outHeight+`; yR++) {
            int xR = wR + yR * `+t+" - "+r+`;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+n.outWidth+`; yC++) {
              int xC = wC + yC * `+e+" - "+o+`;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),c9=function(){return function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var t=n.filterHeight,e=n.filterWidth,r=n.strideHeight,o=n.strideWidth,a=t-1-n.padInfo.top,i=e-1-n.padInfo.left,s=n.outChannels/n.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`+a+", "+i+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `+t+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+t+` - 1 - wR;

          for (int wC = 0; wC < `+e+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+o+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+e+` - 1 - wC;

            // TODO: Vec4 over the channelMul
            for (int dm = 0; dm < `+s+`; dm++) {
              int d2 = d1 * `+s+` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),h9=function(){return function(n){this.variableNames=["x","W"],this.outputShape=n.outShape;var t=n.padInfo.top,e=n.padInfo.left,r=n.strideHeight,o=n.strideWidth,a=n.dilationHeight,i=n.dilationWidth,s=n.filterHeight,u=n.filterWidth,l=4*Math.floor(n.inChannels/4),c=n.inChannels%4;this.userCode=`
      const ivec2 strides = ivec2(`+r+", "+o+`);
      const ivec2 pads = ivec2(`+t+", "+e+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+s+`; wR++) {
          int xR = xRCorner + wR * `+a+`;

          if (xR < 0 || xR >= `+n.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+u+`; wC++) {
            int xC = xCCorner + wC * `+i+`;

            if (xC < 0 || xC >= `+n.inWidth+`) {
              continue;
            }

            for (int d1 = 0; d1 < `+l+`; d1 += 4) {
              vec4 xValues = vec4(
                getX(batch, xR, xC, d1),
                getX(batch, xR, xC, d1 + 1),
                getX(batch, xR, xC, d1 + 2),
                getX(batch, xR, xC, d1 + 3)
              );
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              dotProd += dot(xValues, wValues);
            }

            if (`+(c===1)+`) {
              dotProd +=
                getX(batch, xR, xC, `+l+`) *
                getW(wR, wC, `+l+`, d2);
            } else if (`+(c===2)+`) {
              vec2 xValues = vec2(
                getX(batch, xR, xC, `+l+`),
                getX(batch, xR, xC, `+l+` + 1)
              );
              vec2 wValues = vec2(
                getW(wR, wC, `+l+`, d2),
                getW(wR, wC, `+l+` + 1, d2)
              );
              dotProd += dot(xValues, wValues);
            } else if (`+(c===3)+`) {
              vec3 xValues = vec3(
                getX(batch, xR, xC, `+l+`),
                getX(batch, xR, xC, `+l+` + 1),
                getX(batch, xR, xC, `+l+` + 2)
              );
              vec3 wValues = vec3(
                getW(wR, wC, `+l+`, d2),
                getW(wR, wC, `+l+` + 1, d2),
                getW(wR, wC, `+l+` + 2, d2)
              );
              dotProd += dot(xValues, wValues);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),f9=function(){return function(n){this.variableNames=["x","W"],this.outputShape=n.outShape;var t=n.padInfo.front,e=n.padInfo.top,r=n.padInfo.left,o=n.strideDepth,a=n.strideHeight,i=n.strideWidth,s=n.dilationDepth,u=n.dilationHeight,l=n.dilationWidth,c=n.filterDepth,h=n.filterHeight,d=n.filterWidth,p=4*Math.floor(n.inChannels/4),g=n.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`+o+", "+a+", "+i+`);
      const ivec3 pads = ivec3(`+t+", "+e+", "+r+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `+c+`; wF++) {
          int xF = xFCorner + wF * `+s+`;

          if (xF < 0 || xF >= `+n.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+h+`; wR++) {
            int xR = xRCorner + wR * `+u+`;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+d+`; wC++) {
              int xC = xCCorner + wC * `+l+`;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              for (int d1 = 0; d1 < `+p+`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`+(g===1)+`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `+p+`) *
                  getW(wF, wR, wC, `+p+`, d2);
              } else if (`+(g===2)+`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `+p+`),
                  getX(batch, xF, xR, xC, `+p+` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `+p+`, d2),
                  getW(wF, wR, wC, `+p+` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`+(g===3)+`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `+p+`),
                  getX(batch, xF, xR, xC, `+p+` + 1),
                  getX(batch, xF, xR, xC, `+p+` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `+p+`, d2),
                  getW(wF, wR, wC, `+p+` + 1, d2),
                  getW(wF, wR, wC, `+p+` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),d9=function(){return function(n){this.variableNames=["x","W"],this.outputShape=n.outShape;var t=n.inHeight,e=n.inWidth,r=n.padInfo.top,o=n.padInfo.left,a=n.strideHeight,i=n.strideWidth,s=n.dilationHeight,u=n.dilationWidth,l=n.filterHeight,c=n.filterWidth,h=n.outChannels/n.inChannels;this.userCode=`
      const ivec2 strides = ivec2(`+a+", "+i+`);
      const ivec2 pads = ivec2(`+r+", "+o+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `+h+`;
        int q = d2 - d1 * `+h+`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TODO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `+l+`; wR++) {
          int xR = xRCorner + wR * `+s+`;

          if (xR < 0 || xR >= `+t+`) {
            continue;
          }

          for (int wC = 0; wC < `+c+`; wC++) {
            int xC = xCCorner + wC * `+u+`;

            if (xC < 0 || xC >= `+e+`) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }
        setOutput(dotProd);
      }
    `}}(),p9=function(){return function(n){this.variableNames=["x","W"],this.usesPackedTextures=!0,this.outputShape=n.outShape;for(var t=n.inHeight,e=n.inWidth,r=n.padInfo.top,o=n.padInfo.left,a=n.strideHeight,i=n.strideWidth,s=n.dilationHeight,u=n.dilationWidth,l=n.filterHeight,c=n.filterWidth,h=c,d="int xR; int xC; int xCOffset;",p=0;p<l;p++)for(var g=0;g<c;g++)d+=`
          vec4 xTexelR`+p+"C"+2*g+` = vec4(0.);
          vec4 wR`+p+"C"+g+` = vec4(0.);
          vec4 xR`+p+"C"+g+" = vec4(0.);";for(p=0;p<l;p++)for(var x=0;x<h;x++){if(d+=`
          xR = xRCorner + `+p*s+`;
          xC = xCCorner + `+(g=2*x)*u+`;
        `,i===1){if(g<c&&(d+=o%2==1?`
                xCOffset = xC + 1;
                if(xR >= 0 && xR < `+t+" && xCOffset >= 0 && xCOffset < "+e+`) {
                  xTexelR`+p+"C"+g+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+p+"C"+g+` = vec4(0.);
                }

                xCOffset = xC + 1 - 2;
                if(xR >= 0 && xR < `+t+" && xCOffset >= 0 && xCOffset < "+e+`) {
                  vec4 previous = getX(batch, xR, xCOffset, d1);
                  xR`+p+"C"+g+" = vec4(previous.zw, xTexelR"+p+"C"+g+`.xy);
                } else {
                  xR`+p+"C"+g+" = vec4(0, 0, xTexelR"+p+"C"+g+`.xy);
                }
              `:`
                if(xR >= 0 && xR < `+t+" && xC >= 0 && xC < "+e+`) {
                  xTexelR`+p+"C"+g+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+p+"C"+g+` = vec4(0.);
                }

                xR`+p+"C"+g+" = xTexelR"+p+"C"+g+`;
              `,g+1<c)){var y=o%2==0?Af(u):u;u%2==0&&o%2==1||u%2!=0&&o%2!=1?(d+=`
                  xCOffset = xC + `+o%2+" + "+y+`;

                  if(xR >= 0 && xR < `+t+` &&
                    xCOffset >= 0 && xCOffset < `+e+`) {
                    xTexelR`+p+"C"+(g+2)+` = getX(batch, xR, xCOffset, d1);
                  }
                `,u>1&&(d+=`
                    xCOffset -= 2;
                    if(xR >= 0 && xR < `+t+` &&
                      xCOffset >= 0 && xCOffset < `+e+`) {
                      xTexelR`+p+"C"+g+` = getX(batch, xR, xCOffset, d1);
                    } else {
                      xTexelR`+p+"C"+g+` = vec4(0.);
                    }
                  `),d+=`
                  xR`+p+"C"+(g+1)+` = vec4(
                    xTexelR`+p+"C"+g+".zw, xTexelR"+p+"C"+(g+2)+`.xy);
                `):d+=`
                  xCOffset = xC + `+y+`;

                  if(xR >= 0 && xR < `+t+` &&
                    xCOffset >= 0 && xCOffset < `+e+`) {
                    xTexelR`+p+"C"+(g+2)+` = getX(batch, xR, xCOffset, d1);
                  }

                  xR`+p+"C"+(g+1)+" = xTexelR"+p+"C"+(g+2)+`;
                `}}else g<c&&(d+=`
              if(xR >= 0 && xR < `+t+`) {
            `,o%2==1?(d+=`
                xCOffset = xC + 1 - `+i+`;
                if(xCOffset >= 0 && xCOffset < `+e+`) {
                  xTexelR`+p+"C"+g+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+p+"C"+g+` = vec4(0.);
                }

                if(xC + 1 >= 0 && xC + 1 < `+e+`) {
                  xTexelR`+p+"C"+(g+2)+` = getX(batch, xR, xC + 1, d1);
                } else {
                  xTexelR`+p+"C"+(g+2)+` = vec4(0.);
                }

                xR`+p+"C"+g+` = vec4(
                  xTexelR`+p+"C"+g+".zw, xTexelR"+p+"C"+(g+2)+`.zw);
              `,g+1<c&&(d+=`
                  vec4 final = vec4(0.);
                  xCOffset = xC + 1 + `+i+`;
                  if(xCOffset >= 0 && xCOffset < `+e+`) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xR`+p+"C"+(g+1)+" = vec4(xTexelR"+p+"C"+(g+2)+`.xy, final.xy);
                `)):(d+=`
                if(xC >= 0 && xC < `+e+`) {
                  xTexelR`+p+"C"+g+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+p+"C"+g+` = vec4(0.);
                }

                xCOffset = xC + `+i+`;
                if(xCOffset >= 0 && xCOffset < `+e+`) {
                  xTexelR`+p+"C"+(g+2)+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+p+"C"+(g+2)+` = vec4(0.);
                }

                xR`+p+"C"+g+` = vec4(
                  xTexelR`+p+"C"+g+".xy, xTexelR"+p+"C"+(g+2)+`.xy);
              `,g+1<c&&(d+=`
                  xR`+p+"C"+(g+1)+` = vec4(
                    xTexelR`+p+"C"+g+".zw, xTexelR"+p+"C"+(g+2)+`.zw);
                `)),d+="}");g<c&&(d+=`
            vec4 wTexelR`+p+"C"+g+" = getW("+p+", "+g+`, d1, q);
            wR`+p+"C"+g+" = vec4(wTexelR"+p+"C"+g+".xz, wTexelR"+p+"C"+g+`.xz);
          `,g+1<c&&(d+=`
              vec4 wTexelR`+p+"C"+(g+1)+" = getW("+p+", "+(g+1)+`, d1, q);
              wR`+p+"C"+(g+1)+` =
                vec4(wTexelR`+p+"C"+(g+1)+".xz, wTexelR"+p+"C"+(g+1)+".xz);"))}for(p=0;p<l;p++)for(g=0;g<c;g++)d+="result += xR"+p+"C"+g+" * wR"+p+"C"+g+";";this.userCode=`
      const ivec2 strides = ivec2(`+a+", "+i+`);
      const ivec2 pads = ivec2(`+r+", "+o+`);

      void main() {

        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2;
        int q = 0;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        vec4 result = vec4(0.);

        `+d+`

        setOutput(result);
      }
    `}}(),m9=function(){return function(n,t,e,r,o){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var a=n[0],i=n[1],s=n[2],u=n[3],l=t[0],c=e[0],h=e[1];this.outputShape=[l,c,h,u];var d=r==="bilinear"?1:0,p=[i-1+".0",s-1+".0"],g=p[0],x=p[1],y=c>1?[""+(i-1)/(c-1),"(y2-y1) * height_ratio","y1*"+g+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+g],b=y[0],C=y[1],E=y[2],S=h>1?[""+(s-1)/(h-1),"(x2-x1) * width_ratio","x1*"+x+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+x],k=S[0],R=S[1],A=S[2];this.userCode=`
      const float height_ratio = float(`+b+`);
      const float width_ratio = float(`+k+`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `+a+`) {
          return;
        }

        float height_scale = `+C+`;
        float width_scale = `+R+`;

        float in_y = `+E+`;
        if( in_y < 0.0 || in_y > `+g+` ) {
          setOutput(float(`+o+`));
          return;
        }
        float in_x = `+A+`;
        if( in_x < 0.0 || in_x > `+x+` ) {
          setOutput(float(`+o+`));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(`+d+` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}(),g9=function(){return function(n,t,e){this.variableNames=["x"],this.outputShape=n;var r=n.length,o=n[n.length-1],a=e?"<":">";this.userCode=`
      int getIndex(int i) {
        `+(e?"return "+o+" -i - 1;":"return i;")+`
      }

      void main() {
        `+Fn(r)+` coords = getOutputCoords();
        int end = `+L$(r,"coords")+`;
        float val = 0.0;
        for (int i = `+o+` - 1; i >= 0; i -= 1) {
          int idx = getIndex(i);
          if (idx `+a+` end) {
            continue;
          }
          if (idx == end && `+t+`) {
            continue;
          }
          `+L$(r,"coords")+` = idx;
          val += getX(`+v9(r,"coords")+`);
        }
        setOutput(val);
      }
    `}}();function v9(n,t){if(n===1)return""+t;if(n===2)return t+".x, "+t+".y";if(n===3)return t+".x, "+t+".y, "+t+".z";if(n===4)return t+".x, "+t+".y, "+t+".z, "+t+".w";throw Error("Cumulative sum for rank "+n+" is not yet supported")}function L$(n,t){if(n===1)return""+t;if(n===2)return t+".y";if(n===3)return t+".z";if(n===4)return t+".w";throw Error("Cumulative sum for rank "+n+" is not yet supported")}var x9=function(){function n(t,e,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=e,this.dataFormat=r,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `+this.getHeightCoordString()+`;
      int w = `+this.getWidthCoordString()+`;
      int d = `+this.getDepthCoordString()+`;

      int in_h = h / `+e+`;
      int offset_h = imod(h, `+e+`);
      int in_w = w / `+e+`;
      int offset_w = imod(w, `+e+`);
      int offset_d = (offset_h * `+e+` + offset_w) *
        `+this.getOutputDepthSize()+`;
      int in_d = d + offset_d;

      float result = `+this.getInputSamplingString()+`;
      setOutput(result);
    }
  `}return n.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},n.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},n.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},n.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},n.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},n}(),y9=function(){return function(n){this.variableNames=["A"];var t=ps();this.outputShape=n,this.userCode=`
      const float FLOAT_MAX = 1.70141184e38;
      const float FLOAT_MIN = 1.17549435e-38;

      lowp vec4 encode_float(highp float v) {
        if (isnan(v)) {
          return vec4(255, 255, 255, 255);
        }

        highp float av = abs(v);

        if(av < FLOAT_MIN) {
          return vec4(0.0, 0.0, 0.0, 0.0);
        } else if(v > FLOAT_MAX) {
          return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
        } else if(v < -FLOAT_MAX) {
          return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
        }

        highp vec4 c = vec4(0,0,0,0);

        highp float e = floor(log2(av));
        highp float m = exp2(fract(log2(av))) - 1.0;

        c[2] = floor(128.0 * m);
        m -= c[2] / 128.0;
        c[1] = floor(32768.0 * m);
        m -= c[1] / 32768.0;
        c[0] = floor(8388608.0 * m);

        highp float ebias = e + 127.0;
        c[3] = floor(ebias / 2.0);
        ebias -= c[3] * 2.0;
        c[2] += floor(ebias) * 128.0;

        c[3] += 128.0 * step(0.0, -v);

        return c / 255.0;
      }

      void main() {
        float x = getAAtOutCoords();
        `+t.output+` = encode_float(x);
      }
    `}}(),P$={REAL:"return real * expR - imag * expI;",IMAG:"return real * expI + imag * expR;"},B$=function(){return function(n,t,e){this.variableNames=["real","imag"];var r=t[1];this.outputShape=t;var o=e?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,a=e?r+".0":"1.0";this.userCode=`
      const float exponentMultiplier = `+o+`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `+n+`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`+r+`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `+r+`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `+a+`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}(),b9=function(){function n(t,e){this.outputShape=[],this.variableNames=["x"],this.outputShape=t,this.userCode=`
      uniform float value;
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}return n.prototype.getCustomSetupFunc=function(t){var e=this;return function(r,o){e.valueLoc==null&&(e.valueLoc=r.getUniformLocationNoThrow(o,"value")),r.gl.uniform1f(e.valueLoc,t)}},n}(),w9=function(){return function(n){this.variableNames=["A"];var t=ps(),e=n[0],r=n[1];this.outputShape=n,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+r+".0, "+e+`.0);

        vec4 values = `+t.texture2D+`(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}(),C9=function(){return function(n,t,e){this.variableNames=["A","indices"];var r=n.slice();r[e]=t,this.outputShape=r,this.rank=r.length;var o=Fn(this.rank),a=S9(n,e);this.userCode=`
      void main() {
        `+o+` resRC = getOutputCoords();
        setOutput(getA(`+a+`));
      }
    `}}();function S9(n,t){var e=n.length;if(e>4)throw Error("Gather for rank "+e+" is not yet supported");if(e===1)return"int(getIndices(resRC))";for(var r=["resRC.x","resRC.y","resRC.z","resRC.w"],o=[],a=0;a<n.length;a++)a===t?o.push("int(getIndices("+r[a]+"))"):o.push(""+r[a]);return o.join()}var Hi,Uo,E9=function(){return function(n,t,e){this.sliceDim=n,this.strides=t,this.variableNames=["x","indices"],this.outputShape=e;var r=Fn(t.length),o=Fn(e.length),a=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        `+r+" strides = "+r+"("+this.strides+`);
         void main() {
          `+o+` coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < `+this.sliceDim+`; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * `+a+`;
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `}}();function id(n,t){return[t,n]}function Nm(n,t){return n*t}function k9(n,t){if(n%t!=0)throw new Error("unpackedSize ("+n+") must be a multiple of "+t);return n/t}function I9(n,t,e){var r=Nm(n.length,e);if(t.length<r)throw new Error("unpackedArray length ("+t.length+") must be >= "+r);for(var o=0,a=0;a<n.length;++a)t[o]=n[a],o+=e}function C4(n,t,e){var r=k9(n.length,e);if(t.length<r)throw new Error("matrix length ("+t.length+") must be >= "+r);for(var o=0,a=0;a<n.length;a+=e)t[o++]=n[a]}function Gc(n,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(n/2))]}function vk(n,t){var e=Gc(n,t);return e[0]*e[1]*4}function R9(n,t,e,r,o){for(var a=r%2==1,i=e%2==1,s=Math.floor(r/2),u=Math.floor(e/2),l=Math.ceil(r/2),c=l*Math.ceil(e/2),h=Af(e)*Af(r),d=0;d<t;d++){for(var p=d*e*r,g=d*h,x=a?4:0,y=r,b=g,C=0;C<u;++C){for(var E=2*C*r,S=0;S<s;++S){var k=p+E+2*S;o[b]=n[k],o[b+1]=n[k+1],o[b+2]=n[k+y],o[b+3]=n[k+y+1],b+=4}b+=x}if(a){k=p+r-1,b=g+4*(l-1);var R=2*r;for(x=4*l,C=0;C<u;++C)o[b]=n[k],o[b+2]=n[k+r],k+=R,b+=x}if(i){for(k=p+(e-1)*r,b=g+4*(c-l),S=0;S<s;++S)o[b++]=n[k++],o[b++]=n[k++],b+=2;a&&i&&(o[g+h-4]=n[k])}}return o}function S4(n,t,e,r,o){var a=e*r;if(o.length<a)throw new Error("matrix length ("+o.length+") must be >= "+a);for(var i=r%2==1,s=e%2==1,u=Math.floor(r/2),l=Math.floor(e/2),c=Math.ceil(r/2),h=c*Math.ceil(e/2),d=Af(e)*Af(r),p=0;p<t;p++){for(var g=p*e*r,x=p*d,y=i?4:0,b=r+(i?1:0),C=x,E=g,S=g+r,k=0;k<l;++k){for(var R=0;R<u;++R)o[E++]=n[C++],o[E++]=n[C++],o[S++]=n[C++],o[S++]=n[C++];C+=y,E+=b,S+=b}if(i){C=x+4*(c-1);var A=g+r-1;for(y=4*c,b=2*r,k=0;k<l;++k)o[A]=n[C],o[A+r]=n[C+2],C+=y,A+=b}if(s){for(C=x+4*(h-c),A=g+(e-1)*r,R=0;R<u;++R)o[A++]=n[C++],o[A++]=n[C++],C+=2;i&&(o[g+e*r-1]=n[C])}}return o}function re(n,t,e){var r=e();return t&&T9(n),r}function T9(n){var t=n.getError();if(t!==n.NO_ERROR)throw new Error("WebGL Error: "+D9(n,t))}(function(n){n[n.RENDER=0]="RENDER",n[n.UPLOAD=1]="UPLOAD",n[n.PIXELS=2]="PIXELS",n[n.DOWNLOAD=3]="DOWNLOAD"})(Hi||(Hi={})),function(n){n[n.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",n[n.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",n[n.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",n[n.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",n[n.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(Uo||(Uo={}));var N9=596e-10,A9=65504;function _9(n){return!!(Y.get("WEBGL_RENDER_FLOAT32_ENABLED")||n===0||N9<Math.abs(n)&&Math.abs(n)<A9)}function D9(n,t){switch(t){case n.NO_ERROR:return"NO_ERROR";case n.INVALID_ENUM:return"INVALID_ENUM";case n.INVALID_VALUE:return"INVALID_VALUE";case n.INVALID_OPERATION:return"INVALID_OPERATION";case n.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case n.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case n.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+t}}function Rx(n,t,e){return eu(n,t,function(){return n.getExtension(e)},'Extension "'+e+'" not supported on this browser.')}function $9(n,t,e){var r=eu(n,t,function(){return n.createShader(n.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(re(n,t,function(){return n.shaderSource(r,e)}),re(n,t,function(){return n.compileShader(r)}),n.getShaderParameter(r,n.COMPILE_STATUS)===!1)throw console.log(n.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function O9(n,t,e){var r=eu(n,t,function(){return n.createShader(n.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(re(n,t,function(){return n.shaderSource(r,e)}),re(n,t,function(){return n.compileShader(r)}),n.getShaderParameter(r,n.COMPILE_STATUS)===!1)throw M9(e,n.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}var F9=/ERROR: [0-9]+:([0-9]+):/g;function M9(n,t){var e=F9.exec(t);if(e==null)return console.log("Couldn't parse line number in error: "+t),void console.log(n);for(var r=+e[1],o=n.split(`
`),a=o.length.toString().length+2,i=o.map(function(d,p){return pf((p+1).toString(),a)+d}),s=0,u=0;u<i.length;u++)s=Math.max(i[u].length,s);var l=i.slice(0,r-1),c=i.slice(r-1,r),h=i.slice(r);console.log(l.join(`
`)),console.log(t.split(`
`)[0]),console.log("%c "+pf(c[0],s),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(h.join(`
`))}function L9(n,t){return eu(n,t,function(){return n.createProgram()},"Unable to create WebGLProgram.")}function P9(n,t,e){if(re(n,t,function(){return n.linkProgram(e)}),n.getProgramParameter(e,n.LINK_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function IC(n,t,e){if(re(n,t,function(){return n.validateProgram(e)}),n.getProgramParameter(e,n.VALIDATE_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function B9(n,t,e){var r=eu(n,t,function(){return n.createBuffer()},"Unable to create WebGLBuffer");return re(n,t,function(){return n.bindBuffer(n.ARRAY_BUFFER,r)}),re(n,t,function(){return n.bufferData(n.ARRAY_BUFFER,e,n.STATIC_DRAW)}),r}function z9(n,t,e){var r=eu(n,t,function(){return n.createBuffer()},"Unable to create WebGLBuffer");return re(n,t,function(){return n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,r)}),re(n,t,function(){return n.bufferData(n.ELEMENT_ARRAY_BUFFER,e,n.STATIC_DRAW)}),r}function U9(){return Y.get("WEBGL_VERSION")===2?1:4}function W9(n,t){return eu(n,t,function(){return n.createTexture()},"Unable to create WebGLTexture.")}function E4(n,t){var e=Y.get("WEBGL_MAX_TEXTURE_SIZE");if(n<=0||t<=0){var r="["+n+"x"+t+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(n>e||t>e)throw r="["+n+"x"+t+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+("["+e+"x"+e+"]")+".")}function V9(n,t){return eu(n,t,function(){return n.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function z$(n,t,e,r,o,a,i,s){var u=n.getAttribLocation(e,r);return u!==-1&&(re(n,t,function(){return n.bindBuffer(n.ARRAY_BUFFER,o)}),re(n,t,function(){return n.vertexAttribPointer(u,a,n.FLOAT,!1,i,s)}),re(n,t,function(){return n.enableVertexAttribArray(u)}),!0)}function G9(n,t,e,r){K9(n,r),re(n,t,function(){return n.activeTexture(n.TEXTURE0+r)}),re(n,t,function(){return n.bindTexture(n.TEXTURE_2D,e)})}function H9(n,t,e,r){return eu(n,t,function(){return n.getUniformLocation(e,r)},'uniform "'+r+'" not present in program.')}function q9(n,t,e){return n.getUniformLocation(t,e)}function j9(n,t,e,r,o,a){re(n,t,function(){return G9(n,t,r,a)}),re(n,t,function(){return n.uniform1i(o,a)})}function RC(n,t,e,r){re(n,t,function(){return n.bindFramebuffer(n.FRAMEBUFFER,r)}),re(n,t,function(){return n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0)})}function U$(n,t,e){re(n,t,function(){return n.bindFramebuffer(n.FRAMEBUFFER,e)}),re(n,t,function(){return n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0)})}function Tx(n){var t=n.checkFramebufferStatus(n.FRAMEBUFFER);if(t!==n.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+X9(n,t))}function X9(n,t){switch(t){case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case n.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+t}}function eu(n,t,e,r){var o=re(n,t,function(){return e()});if(o==null)throw new Error(r);return o}function K9(n,t){var e=n.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+n.TEXTURE0;if(r<n.TEXTURE0||r>e)throw new Error("textureUnit must be in "+("[gl.TEXTURE0, gl.TEXTURE"+e+"]")+".")}function nf(n,t){return t===void 0&&(t=2),de(n.slice(0,n.length-t))}function rf(n){if(n.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[n.length>1?n[n.length-2]:1,n[n.length-1]]}function Y9(n,t){var e;t===void 0&&(t=!1);var r=Y.get("WEBGL_MAX_TEXTURE_SIZE");if(t&&(r*=2,(n=n.map(function(l,c){return c>=n.length-2?Af(n[c]):n[c]})).length===1&&(n=[2,n[0]])),n.length!==2){var o=Uc(n);n=o.newShape}var a=de(n);if(n.length<=1&&a<=r)return[1,a];if(n.length===2&&n[0]<=r&&n[1]<=r)return n;if(n.length===3&&n[0]*n[1]<=r&&n[2]<=r)return[n[0]*n[1],n[2]];if(n.length===3&&n[0]<=r&&n[1]*n[2]<=r)return[n[0],n[1]*n[2]];if(n.length===4&&n[0]*n[1]*n[2]<=r&&n[3]<=r)return[n[0]*n[1]*n[2],n[3]];if(n.length===4&&n[0]<=r&&n[1]*n[2]*n[3]<=r)return[n[0],n[1]*n[2]*n[3]];if(t){var i=nf(n),s=2,u=2;return n.length&&(s=(e=rf(n))[0],u=e[1]),E$(a=i*(s/2)*(u/2)).map(function(l){return 2*l})}return E$(a)}function Nx(n){return n%2==0}function Ax(n,t){if(Ao(n=n.slice(-2),t=t.slice(-2))||!n.length||!t.length||n[0]===0||n[1]===0||t[0]===0||t[1]===0)return!0;if(n.length!==t.length){var e=n.slice(-1)[0],r=t.slice(-1)[0];if(e===r||Nx(e)&&Nx(r)&&(n[0]===1||t[0]===1))return!0}return n[1]===t[1]&&Nx(n[0])&&Nx(t[0])}function Q9(n,t){var e=ps();return $9(n,t,e.version+`
    precision highp float;
    `+e.attribute+` vec3 clipSpacePos;
    `+e.attribute+` vec2 uv;
    `+e.varyingVs+` vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`)}function Z9(n,t){return B9(n,t,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function J9(n,t){return z9(n,t,new Uint16Array([0,1,2,2,1,3]))}function tY(n,t){var e,r,o,a,i,s,u,l,c=n;return Y.get("WEBGL_VERSION")===2?(e=c.R32F,r=c.R16F,o=c.RGBA16F,a=c.RGBA32F,i=c.RED,s=4,u=1,l=c.HALF_FLOAT):(e=n.RGBA,r=n.RGBA,o=n.RGBA,a=c.RGBA,i=n.RGBA,s=4,u=4,l=t!=null?t.HALF_FLOAT_OES:null),{internalFormatFloat:e,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:o,internalFormatPackedFloat:a,textureFormatFloat:i,downloadTextureFormat:n.RGBA,downloadUnpackNumChannels:s,defaultNumChannels:u,textureTypeHalfFloat:l}}function Am(n,t,e,r,o,a,i){E4(e,r);var s=W9(n,t),u=n.TEXTURE_2D;return re(n,t,function(){return n.bindTexture(u,s)}),re(n,t,function(){return n.texParameteri(u,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE)}),re(n,t,function(){return n.texParameteri(u,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)}),re(n,t,function(){return n.texParameteri(u,n.TEXTURE_MIN_FILTER,n.NEAREST)}),re(n,t,function(){return n.texParameteri(u,n.TEXTURE_MAG_FILTER,n.NEAREST)}),re(n,t,function(){return n.texImage2D(u,0,o,e,r,0,a,i,null)}),re(n,t,function(){return n.bindTexture(n.TEXTURE_2D,null)}),s}function eY(n,t,e,r,o){var a=id(e,r);return Am(n,t,a[0],a[1],o.internalFormatFloat,o.textureFormatFloat,n.FLOAT)}function nY(n,t,e,r,o){var a=id(e,r);return Am(n,t,a[0],a[1],o.internalFormatHalfFloat,o.textureFormatFloat,o.textureTypeHalfFloat)}function rY(n,t,e,r,o){var a=id(e,r);return Am(n,t,a[0],a[1],n.RGBA,n.RGBA,n.UNSIGNED_BYTE)}function oY(n,t,e,r,o){var a=Gc(e,r);return Am(n,t,a[0],a[1],o.internalFormatPackedFloat,n.RGBA,n.FLOAT)}function aY(n,t,e,r,o){var a=Gc(e,r);return Am(n,t,a[0],a[1],o.internalFormatPackedHalfFloat,n.RGBA,o.textureTypeHalfFloat)}function iY(n,t,e,r){return re(n,t,function(){return n.bindBuffer(n.ARRAY_BUFFER,r)}),z$(n,t,e,"clipSpacePos",r,3,20,0)&&z$(n,t,e,"uv",r,2,20,12)}function sY(n,t,e,r){re(n,t,function(){return n.bindTexture(n.TEXTURE_2D,e)}),re(n,t,function(){return n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,r)}),re(n,t,function(){return n.bindTexture(n.TEXTURE_2D,null)})}function k4(n,t,e,r,o,a,i){E4(r,o),re(n,t,function(){return n.bindTexture(n.TEXTURE_2D,e)}),re(n,t,function(){return n.texSubImage2D(n.TEXTURE_2D,0,0,0,r,o,i,n.FLOAT,a)}),re(n,t,function(){return n.bindTexture(n.TEXTURE_2D,null)})}function uY(n,t,e,r,o,a,i,s){var u,l=id(r,o),c=l[0],h=l[1],d=r*o;s.defaultNumChannels===1&&d===a.length?u=a:I9(a,u=new Float32Array(d*i),i),k4(n,t,e,c,h,u,s.textureFormatFloat)}function lY(n,t,e,r,o,a,i,s,u,l){var c=Gc(i,s),h=c[0],d=c[1],p=new Float32Array(vk(i,s));R9(u,r,o,a,p),k4(n,t,e,h,d,p,n.RGBA)}function cY(n,t,e,r,o,a){var i=e;if(Y.get("WEBGL_VERSION")===2){var s=n,u=s.createBuffer();re(n,t,function(){return n.bindBuffer(s.PIXEL_PACK_BUFFER,u)});var l=4*Nm(r*o,a.downloadUnpackNumChannels);re(n,t,function(){return n.bufferData(s.PIXEL_PACK_BUFFER,l,s.STREAM_READ)}),re(n,t,function(){return s.readPixels(0,0,o,r,n.RGBA,n.FLOAT,0)}),re(n,t,function(){return n.bindBuffer(s.PIXEL_PACK_BUFFER,null)}),i=u}return i}function hY(n,t,e,r,o){var a=n,i=new Float32Array(Nm(e*r,o.downloadUnpackNumChannels));a.bindBuffer(a.PIXEL_PACK_BUFFER,t),a.getBufferSubData(a.PIXEL_PACK_BUFFER,0,i),a.bindBuffer(a.PIXEL_PACK_BUFFER,null);var s=new Float32Array(e*r);return C4(i,s,o.downloadUnpackNumChannels),s}function fY(n,t,e,r,o){var a=id(e,r),i=a[0],s=a[1],u=new Float32Array(Nm(e*r,o.downloadUnpackNumChannels));re(n,t,function(){return n.readPixels(0,0,i,s,o.downloadTextureFormat,n.FLOAT,u)});var l=new Float32Array(e*r);return C4(u,l,o.downloadUnpackNumChannels),l}function dY(n,t,e,r,o){var a=id(e,r),i=a[0],s=a[1],u=new Uint8Array(Nm(e*r,4));return re(n,t,function(){return n.readPixels(0,0,i,s,o.downloadTextureFormat,n.UNSIGNED_BYTE,u)}),new Float32Array(u.buffer)}function pY(n,t,e,r,o,a,i,s){var u=n,l=new Float32Array(vk(a,i));u.bindBuffer(u.PIXEL_PACK_BUFFER,t),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,l),u.bindBuffer(u.PIXEL_PACK_BUFFER,null);var c=new Float32Array(de([e,r,o]));return S4(l,e,r,o,c),c}function mY(n,t,e,r,o,a,i,s){var u=Gc(a,i),l=u[0],c=u[1],h=new Float32Array(vk(a,i));re(n,t,function(){return n.readPixels(0,0,l,c,n.RGBA,n.FLOAT,h)});var d=new Float32Array(de([e,r,o]));return S4(h,e,r,o,d)}var gY=function(){function n(t){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var e=Y.get("WEBGL_VERSION");t!=null?(this.gl=t,hK(e,t)):this.gl=cs(e),Y.get("WEBGL_VERSION")===1?(this.textureFloatExtension=Rx(this.gl,this.debug,"OES_texture_float"),this.colorBufferFloatExtension=this.gl.getExtension("WEBGL_color_buffer_float"),Y.get("WEBGL_RENDER_FLOAT32_ENABLED")||(this.textureHalfFloatExtension=Rx(this.gl,this.debug,"OES_texture_half_float"),this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float"))):this.colorBufferFloatExtension=Rx(this.gl,this.debug,"EXT_color_buffer_float"),this.vertexBuffer=Z9(this.gl,this.debug),this.indexBuffer=J9(this.gl,this.debug),this.framebuffer=V9(this.gl,this.debug),this.textureConfig=tY(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(n.prototype,"debug",{get:function(){return Y.get("DEBUG")},enumerable:!0,configurable:!0}),n.prototype.dispose=function(){var t=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var e=this.gl;re(e,this.debug,function(){return e.finish()}),re(e,this.debug,function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)}),re(e,this.debug,function(){return e.deleteFramebuffer(t.framebuffer)}),re(e,this.debug,function(){return e.bindBuffer(e.ARRAY_BUFFER,null)}),re(e,this.debug,function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}),re(e,this.debug,function(){return e.deleteBuffer(t.indexBuffer)}),this.disposed=!0}},n.prototype.createFloat32MatrixTexture=function(t,e){return this.throwIfDisposed(),eY(this.gl,this.debug,t,e,this.textureConfig)},n.prototype.createFloat16MatrixTexture=function(t,e){return this.throwIfDisposed(),nY(this.gl,this.debug,t,e,this.textureConfig)},n.prototype.createUnsignedBytesMatrixTexture=function(t,e){return this.throwIfDisposed(),rY(this.gl,this.debug,t,e,this.textureConfig)},n.prototype.uploadPixelDataToTexture=function(t,e){this.throwIfDisposed(),sY(this.gl,this.debug,t,e)},n.prototype.createFloat16PackedMatrixTexture=function(t,e){return this.throwIfDisposed(),aY(this.gl,this.debug,t,e,this.textureConfig)},n.prototype.createPackedMatrixTexture=function(t,e){return this.throwIfDisposed(),oY(this.gl,this.debug,t,e,this.textureConfig)},n.prototype.deleteMatrixTexture=function(t){var e=this;this.throwIfDisposed(),this.outputTexture===t&&(U$(this.gl,this.debug,this.framebuffer),this.outputTexture=null),re(this.gl,this.debug,function(){return e.gl.deleteTexture(t)})},n.prototype.uploadMatrixToTexture=function(t,e,r,o){this.throwIfDisposed();var a=U9();return uY(this.gl,this.debug,t,e,r,o,a,this.textureConfig)},n.prototype.uploadMatrixToPackedTexture=function(t,e,r,o,a,i,s){return this.throwIfDisposed(),lY(this.gl,this.debug,t,e,r,o,a,i,s,this.textureConfig)},n.prototype.downloadFloat32MatrixFromOutputTexture=function(t,e,r){var o=this;return this.downloadMatrixDriver(t,function(){return fY(o.gl,o.debug,e,r,o.textureConfig)})},n.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(t,e,r){var o=this;return this.downloadMatrixDriver(t,function(){return dY(o.gl,o.debug,e,r,o.textureConfig)})},n.prototype.downloadPackedMatrixFromBuffer=function(t,e,r,o,a,i){return pY(this.gl,t,e,r,o,a,i,this.textureConfig)},n.prototype.downloadFloat32MatrixFromBuffer=function(t,e,r){return hY(this.gl,t,e,r,this.textureConfig)},n.prototype.maybeCreateBufferFromTexture=function(t,e,r){this.bindTextureToFrameBuffer(t);var o=cY(this.gl,this.debug,t,e,r,this.textureConfig);return this.unbindTextureToFrameBuffer(),o},n.prototype.createAndWaitForFence=function(){var t=this.createFence(this.gl);return this.pollFence(t)},n.prototype.createFence=function(t){var e,r,o=this;if(Y.get("WEBGL_FENCE_API_ENABLED")){var a=t,i=a.fenceSync(a.SYNC_GPU_COMMANDS_COMPLETE,0);t.flush(),r=function(){var s=a.clientWaitSync(i,0,0);return s===a.ALREADY_SIGNALED||s===a.CONDITION_SATISFIED},e=i}else Y.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(e=this.beginQuery(),this.endQuery(),r=function(){return o.isQueryAvailable(e,Y.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):r=function(){return!0};return{query:e,isFencePassed:r}},n.prototype.downloadMatrixFromPackedTexture=function(t,e,r,o,a,i){var s=this;return this.downloadMatrixDriver(t,function(){return mY(s.gl,s.debug,e,r,o,a,i,s.textureConfig)})},n.prototype.createProgram=function(t){this.throwIfDisposed();var e=this.gl,r=O9(e,this.debug,t),o=Q9(e,this.debug),a=L9(e,this.debug);return re(e,this.debug,function(){return e.attachShader(a,o)}),re(e,this.debug,function(){return e.attachShader(a,r)}),P9(e,this.debug,a),this.debug&&IC(e,this.debug,a),this.vertexAttrsAreBound||(this.setProgram(a),this.vertexAttrsAreBound=iY(e,this.debug,this.program,this.vertexBuffer)),a},n.prototype.deleteProgram=function(t){var e=this;this.throwIfDisposed(),t===this.program&&(this.program=null),t!=null&&re(this.gl,this.debug,function(){return e.gl.deleteProgram(t)})},n.prototype.setProgram=function(t){var e=this;this.throwIfDisposed(),this.program=t,this.program!=null&&this.debug&&IC(this.gl,this.debug,this.program),re(this.gl,this.debug,function(){return e.gl.useProgram(t)})},n.prototype.getUniformLocation=function(t,e,r){return r===void 0&&(r=!0),this.throwIfDisposed(),r?H9(this.gl,this.debug,t,e):q9(this.gl,t,e)},n.prototype.getAttributeLocation=function(t,e){var r=this;return this.throwIfDisposed(),re(this.gl,this.debug,function(){return r.gl.getAttribLocation(t,e)})},n.prototype.getUniformLocationNoThrow=function(t,e){return this.throwIfDisposed(),this.gl.getUniformLocation(t,e)},n.prototype.setInputMatrixTexture=function(t,e,r){this.throwIfDisposed(),this.throwIfNoProgram(),j9(this.gl,this.debug,this.program,t,e,r)},n.prototype.setOutputMatrixTexture=function(t,e,r){this.setOutputMatrixTextureDriver(t,r,e)},n.prototype.setOutputPackedMatrixTexture=function(t,e,r){this.throwIfDisposed();var o=Gc(e,r),a=o[0],i=o[1];this.setOutputMatrixTextureDriver(t,a,i)},n.prototype.setOutputMatrixWriteRegion=function(t,e,r,o){this.setOutputMatrixWriteRegionDriver(r,t,o,e)},n.prototype.setOutputPackedMatrixWriteRegion=function(t,e,r,o){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},n.prototype.debugValidate=function(){this.program!=null&&IC(this.gl,this.debug,this.program),Tx(this.gl)},n.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var t=this.gl;this.debug&&this.debugValidate(),re(t,this.debug,function(){return t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0)})},n.prototype.blockUntilAllProgramsCompleted=function(){var t=this;this.throwIfDisposed(),re(this.gl,this.debug,function(){return t.gl.finish()})},n.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=Rx(this.gl,this.debug,Y.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},n.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},n.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},n.prototype.beginQuery=function(){if(Y.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var t=this.gl,e=this.getQueryTimerExtensionWebGL2(),r=t.createQuery();return t.beginQuery(e.TIME_ELAPSED_EXT,r),r}var o=this.getQueryTimerExtensionWebGL1(),a=o.createQueryEXT();return o.beginQueryEXT(o.TIME_ELAPSED_EXT,a),a},n.prototype.endQuery=function(){if(Y.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")!==2){var t=this.getQueryTimerExtensionWebGL1();t.endQueryEXT(t.TIME_ELAPSED_EXT)}else{var e=this.gl,r=this.getQueryTimerExtensionWebGL2();e.endQuery(r.TIME_ELAPSED_EXT)}},n.prototype.waitForQueryAndGetTime=function(t){return bn(this,void 0,void 0,function(){var e=this;return wn(this,function(r){switch(r.label){case 0:return[4,k$(function(){return e.disposed||e.isQueryAvailable(t,Y.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return r.sent(),[2,this.getQueryTime(t,Y.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},n.prototype.getQueryTime=function(t,e){if(e===0)return null;if(e===2){var r=this.gl;return r.getQueryParameter(t,r.QUERY_RESULT)/1e6}var o=this.getQueryTimerExtensionWebGL1();return o.getQueryObjectEXT(t,o.QUERY_RESULT_EXT)/1e6},n.prototype.isQueryAvailable=function(t,e){if(e===0)return!0;if(e===2){var r=this.gl,o=this.getQueryTimerExtensionWebGL2(),a=r.getQueryParameter(t,r.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(o.GPU_DISJOINT_EXT)),a&&!this.disjoint}return a=(o=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(t,o.QUERY_RESULT_AVAILABLE_EXT),this.disjoint==null&&(this.disjoint=this.gl.getParameter(o.GPU_DISJOINT_EXT)),a&&!this.disjoint},n.prototype.pollFence=function(t){var e=this;return new Promise(function(r){e.addItemToPoll(function(){return t.isFencePassed()},function(){return r()})})},n.prototype.pollItems=function(){for(var t=vY(this.itemsToPoll.map(function(r){return r.isDoneFn})),e=0;e<=t;++e)(0,this.itemsToPoll[e].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(t+1)},n.prototype.addItemToPoll=function(t,e){var r=this;this.itemsToPoll.push({isDoneFn:t,resolveFn:e}),this.itemsToPoll.length>1||k$(function(){return r.pollItems(),r.itemsToPoll.length===0})},n.prototype.bindTextureToFrameBuffer=function(t){this.throwIfDisposed(),RC(this.gl,this.debug,t,this.framebuffer),this.debug&&Tx(this.gl)},n.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(RC(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&Tx(this.gl)):U$(this.gl,this.debug,this.framebuffer)},n.prototype.downloadMatrixDriver=function(t,e){this.bindTextureToFrameBuffer(t);var r=e();return this.unbindTextureToFrameBuffer(),r},n.prototype.setOutputMatrixTextureDriver=function(t,e,r){this.throwIfDisposed();var o=this.gl;RC(o,this.debug,t,this.framebuffer),this.debug&&Tx(o),this.outputTexture=t,re(o,this.debug,function(){return o.viewport(0,0,e,r)}),re(o,this.debug,function(){return o.scissor(0,0,e,r)})},n.prototype.setOutputMatrixWriteRegionDriver=function(t,e,r,o){var a=this;this.throwIfDisposed(),re(this.gl,this.debug,function(){return a.gl.scissor(t,e,r,o)})},n.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},n.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},n}();function vY(n){for(var t=0;t<n.length&&n[t]();++t);return t-1}function xY(n,t,e,r){var o=t.userCode,a=e.map(function(x,y){var b={logicalShape:x.shape,texShape:x.isUniform?null:x.texData.texShape,isUniform:x.isUniform,isPacked:!x.isUniform&&x.texData.isPacked,flatOffset:null};return x.texData!=null&&x.texData.slice!=null&&x.texData.slice.flatOffset>0&&(b.flatOffset=x.texData.slice.flatOffset),{name:t.variableNames[y],shapeInfo:b}}),i=a.map(function(x){return x.shapeInfo}),s={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},u=F8(a,s,o,t.usesPackedTextures),l=n.createProgram(u),c=null,h=null;Y.get("WEBGL_VERSION")===1&&(c=n.getUniformLocation(l,"INFINITY",!1),h=n.getUniformLocation(l,"NAN",!1));for(var d={},p=0;p<t.variableNames.length;p++){var g=t.variableNames[p];d[g]=n.getUniformLocation(l,g,!1),d["offset"+g]=n.getUniformLocation(l,"offset"+g,!1)}return{program:t,source:u,webGLProgram:l,uniformLocations:d,inShapeInfos:i,outShapeInfo:s,infLoc:c,nanLoc:h}}function W$(n,t){if(n.length!==t.length)throw Error("Binary was compiled with "+n.length+" inputs, but was executed with "+t.length+" inputs");n.forEach(function(e,r){var o=e.logicalShape,a=t[r],i=a.shape;if(!Ao(o,i))throw Error("Binary was compiled with different shapes than the current args. Shapes "+o+" and "+i+" must match");if(!e.isUniform||!a.isUniform){var s=e.texShape,u=a.isUniform?null:a.texData.texShape;if(!Ao(s,u))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+s+" and "+u+" must match")}})}function yY(n,t,e,r,o){W$(t.inShapeInfos,e),W$([t.outShapeInfo],[r]);var a=r.texData.texture,i=r.texData.texShape;r.texData.isPacked?n.setOutputPackedMatrixTexture(a,i[0],i[1]):n.setOutputMatrixTexture(a,i[0],i[1]),n.setProgram(t.webGLProgram),Y.get("WEBGL_VERSION")===1&&(t.infLoc!==null&&n.gl.uniform1f(t.infLoc,1/0),t.nanLoc!==null&&n.gl.uniform1f(t.nanLoc,NaN)),e.forEach(function(s,u){var l=t.program.variableNames[u],c=t.uniformLocations[l],h=t.uniformLocations["offset"+l];if(c!=null)if(s.isUniform)if(de(s.shape)<2)n.gl.uniform1f(c,s.uniformValues[0]);else{var d=s.uniformValues;d instanceof Float32Array||(d=new Float32Array(d)),n.gl.uniform1fv(c,d)}else s.texData.slice!=null&&h!=null&&n.gl.uniform1i(h,s.texData.slice.flatOffset),n.setInputMatrixTexture(s.texData.texture,c,u)}),o?.(n,t.webGLProgram),n.executeProgram()}function bY(n,t,e){var r="";t.concat(e).forEach(function(i){var s=i.texData!=null&&i.texData.slice!=null&&i.texData.slice.flatOffset>0,u=i.isUniform?"uniform":i.texData.texShape;r+=i.shape+"_"+u+"_"+s});var o=n.userCode,a=n.constructor.name;return a+="_"+r+"_"+o}var wY=function(){return function(n,t,e){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=n;var r=e.filterWidth,o=e.inChannels,a=e.strideWidth,i=e.strideHeight,s=e.padInfo,u=e.outWidth,l=e.dilationWidth,c=e.dilationHeight,h=s.left,d=s.top,p=o*r,g=ps();this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            int blockIndex = rc.y + col;
            int pos = rc.x + row;

            if(blockIndex >= `+n[1]+" || pos >= "+n[0]+`) continue;

            int offsetY = int(blockIndex / (`+u+")) * "+i+" - "+d+`;
            int d0 = offsetY + `+c+" * (pos / "+p+`);

            if(d0 >= `+t[0]+` || d0 < 0) continue;

            int offsetX = int(mod(float(blockIndex), `+u+".) * "+a+". - "+h+`.);
            int d1 = offsetX + `+l+" * (int(mod(float(pos), "+p+".) / "+o+`.));

            if(d1 >= `+t[1]+` || d1 < 0) continue;

            vec2 innerDims = vec2(d1, int(mod(float(pos), `+o+`.)));
            result[row * 2 + col] = getChannel(getA(d0, int(innerDims.x),
                                              int(innerDims.y)), innerDims);
          }
        }

        `+g.output+` = result;
      }
    `}}(),CY=function(){return function(n,t,e,r,o){this.variableNames=["x"],this.outputShape=[];var a,i=t,s=n[3]-1;this.outputShape=n;var u="float("+e+") + float("+r+") * sum";a=o===.5?"inversesqrt("+u+")":o===1?"1.0/("+u+")":"exp(log("+u+") * float(-"+o+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`+i+"; j <= "+i+`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `+s+`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `+a+`;
        setOutput(val);
      }
    `}}(),SY=function(){return function(n,t,e,r,o){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=n,this.depth=n[3],this.depthRadius=t,this.bias=e,this.alpha=r,this.beta=o,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `+this.depth+`; ++d) {
          int depthBegin = int(max(0.0, float(d - `+t+`)));
          int depthEnd = int(min(float(`+this.depth+`),
              float(d + `+t+` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `+this.depth+`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`+r+") * norm + float("+e+`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`+r+`)
                * float(`+o+`)
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `+o+`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}(),EY=function(){return function(n){this.variableNames=["dy","maxPos"],this.outputShape=n.inShape;var t=n.strideHeight,e=n.strideWidth,r=n.dilationHeight,o=n.effectiveFilterHeight,a=n.effectiveFilterWidth,i=o-1-n.padInfo.top,s=a-1-n.padInfo.left,u=o*a-1;this.userCode=`
      const ivec2 pads = ivec2(`+i+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+o+`;
          wR += `+r+`) {
          float dyR = float(dyRCorner + wR) / `+t+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+a+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+e+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `+u+` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `+a+` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}(),TC=function(){return function(n,t,e,r,o,a){e===void 0&&(e=!1),r===void 0&&(r=!1),o===void 0&&(o=!1),a===void 0&&(a=null),this.variableNames=["matrixA","matrixB"],this.usesPackedTextures=!0,this.outputShape=t;var i=e?n[1]:n[2],s=Math.ceil(i/2),u=e?"i * 2, rc.y":"rc.y, i * 2",l=r?"rc.z, i * 2":"i * 2, rc.z",c=e?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],h=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],d="",p="";a&&(d=`vec4 activation(vec4 x) {
        `+a+`
      }`,p="result = activation(result);");var g=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),this.userCode=`
      `+d+`

      const float sharedDimension = `+s+`.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < `+s+`; i++) {
          vec4 a = getMatrixA(rc.x, `+u+`);
          vec4 b = getMatrixB(rc.x, `+l+`);

          result += (`+c[0]+" * "+h[0]+") + ("+c[1]+" * "+h[1]+`);
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        `+g+`

        `+p+`

        setOutput(result);
      }
    `}}(),kY=function(){function n(t,e,r){this.variableNames=["probs"],this.outputShape=[t,r],this.userCode=`
      uniform float seed;

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `+(e-1)+`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`+(e-1)+`));
      }
    `}return n.prototype.getCustomSetupFunc=function(t){var e=this;return function(r,o){e.seedLoc==null&&(e.seedLoc=r.getUniformLocation(o,"seed")),r.gl.uniform1f(e.seedLoc,t)}},n}(),IY=function(){return function(n,t,e,r){this.variableNames=["indices"],this.outputShape=[n,t],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`+r+"), float("+e+`),
                      float(index == coords.y)));
      }
    `}}(),RY=function(){return function(n){this.variableNames=["A"],this.isPackShader=!0,this.outputShape=n;var t=n.length;if(t===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var e=da("rc",t),r=Fn(t),o=NY(t,n,e),a=AY(t,n[n.length-1],n[n.length-2],e),i=_Y(n,e);this.userCode=`
        void main() {
          `+r+` rc = getOutputCoords();

          if(`+o+`) {
            setOutput(vec4(0));
          } else {
            `+a+`

            setOutput(vec4(`+i+`));
          }
        }
      `}}}();function TY(n,t){for(var e=[],r=0;r<=1;r++)for(var o=0;o<=1;o++){for(var a=(r===0?"r":"rp1")+", "+(o===0?"c":"cp1"),i=2;i<n;i++)a=t[t.length-1-i]+","+a;e.push(a)}return e}function NY(n,t,e){if(n===1)return"rc > "+t[0];for(var r="",o=n-2;o<n;o++)r+=e[o]+" >= "+t[o],o<n-1&&(r+="||");return r}function AY(n,t,e,r){if(n===1)return"";var o=r.slice(-2);return`
    int r = `+o[0]+`;
    int c = `+o[1]+`;
    int rp1 = r + 1;
    int cp1 = c + 1;

    bool cEdge = cp1 >= `+t+`;
    bool rEdge = rp1 >= `+e+`;
  `}function _Y(n,t){var e=n.length,r=TY(e,t);return e===1?`getA(rc),
            rc + 1 >= `+n[0]+` ? 0. : getA(rc + 1),
            0, 0`:"getA("+r[0]+`),
          cEdge ? 0. : getA(`+r[1]+`),
          rEdge ? 0. : getA(`+r[2]+`),
          rEdge || cEdge ? 0. : getA(`+r[3]+")"}var DY=function(){return function(n,t,e){this.variableNames=["x"],this.outputShape=t.map(function(u,l){return u[0]+n[l]+u[1]});var r=n.length,o=Fn(r),a=t.map(function(u){return u[0]}).join(","),i=t.map(function(u,l){return u[0]+n[l]}).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=r!==1?`
      `+o+" start = "+o+"("+a+`);
      `+o+" end = "+o+"("+i+`);

      void main() {
        `+o+` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(float(`+e+`));
        } else {
          `+o+` coords = outC - start;
          setOutput(getX(`+s+`));
        }
      }
    `:`
        int start = `+a+`;
        int end = `+i+`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(float(`+e+`));
          } else {
            setOutput(getX(outC - start));
          }
        }
      `}}(),$Y=function(){return function(n,t,e){this.variableNames=["x"],this.usesPackedTextures=!0,this.outputShape=t.map(function(y,b){return y[0]+n[b]+y[1]});for(var r=n.length,o=Fn(r),a=t.map(function(y){return y[0]}).join(","),i=t.map(function(y,b){return y[0]+n[b]}).join(","),s=da("rc",r),u=da("source",r),l=s[r-1]+" < "+this.outputShape[r-1],c=r===1?"source":"vec2("+u.slice(-2).join()+")",h=[o+" rc = outputLoc;",s[r-1]+` += 1;
       if(`+l+`) {
      `,r===1?"":`}
       rc = outputLoc;
       `+s[r-2]+` += 1;
       if(`+s[r-2]+" < "+this.outputShape[r-2]+") {",r===1?"":"  "+s[r-1]+` += 1;
         if(`+l+") {"],d=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",p="",g=0,x=r===1?2:4;g<x;g++)p+=`
        `+h[g]+`
        if (`+d+`) {
          result[`+g+"] = float("+e+`);
        } else {
          `+o+` source = rc - start;
          result[`+g+"] = getChannel(getX("+u.join()+"), "+c+`);
        }
      `;p+=r===1?"} ":"}}",this.userCode=`
      const `+o+" start = "+o+"("+a+`);
      const `+o+" end = "+o+"("+i+`);

      void main() {
        `+o+` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `+p+`
        setOutput(result);
      }
    `}}(),NC=function(){return function(n,t,e){if(this.variableNames=["x"],t==="avg"&&e)throw new Error("Cannot compute positions for average pool.");var r=n.filterWidth,o=n.strideHeight,a=n.strideWidth,i=n.dilationHeight,s=n.dilationWidth,u=n.effectiveFilterHeight,l=n.effectiveFilterWidth,c=n.padInfo.top,h=n.padInfo.left;this.outputShape=n.outShape;var d=t==="avg",p="0.0";if(d||(p="-1.0 / 1e-20"),e)this.userCode=`
        const ivec2 strides = ivec2(`+o+", "+a+`);
        const ivec2 pads = ivec2(`+c+", "+h+`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `+u+`;
              wR += `+i+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+l+`;
                wC += `+s+`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = wR * `+l+` + wC;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var g=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="avg"&&(g="avgValue / count");var x=4*Math.floor(r/4),y=r%4,b=`
      if (`+d+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(`+o+", "+a+`);
      const ivec2 pads = ivec2(`+c+", "+h+`);
      const float initializationValue = `+p+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `+n.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+p+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `+u+`;
            wR += `+i+`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `+n.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+x+`; wC += 4) {
            int xC = xCCorner + wC * `+s+`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+s+`, d),
              getValue(batch, xR, xC + 2 * `+s+`, d),
              getValue(batch, xR, xC + 3 * `+s+`, d)
            );

            `+b+`
          }

          int xC = xCCorner + `+x+`;
          if (`+(y===1)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `+b+`
          } else if (`+(y===2)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+s+`, d),
              initializationValue,
              initializationValue
            );

            `+b+`
          } else if (`+(y===3)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+s+`, d),
              getValue(batch, xR, xC + 2 * `+s+`, d),
              initializationValue
            );

            `+b+`
          }
        }
        setOutput(`+g+`);
      }
    `}}}(),OY=function(){return function(n,t){this.variableNames=["x"];var e=n.windowSize,r=n.batchSize,o=n.inSize,a=Math.ceil(o/e);this.outputShape=[r,a];var i="0.0",s="";t==="prod"?i="1.0":t==="min"?(i="1.0 / 1e-20",s="min"):t==="max"&&(i="-1.0 / 1e-20",s="max");var u=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="sum"?u="sumValue":t==="prod"?u="prodValue":t==="all"?u="allValue":t==="any"&&(u="anyValue");var l=4*Math.floor(e/4),c=e%4,h=`
      if (`+(t==="sum")+`) {
        sumValue += dot(values, ones);
      } else if (`+(t==="prod")+`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `+s+`(values, minMaxValue);
      }
    `,d="vec4";t==="all"?(i="1.0",h=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,d="bvec4"):t==="any"&&(i="0.0",h=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,d="bvec4");var p="";o%e>0&&(p=`
        if (inIdx < 0 || inIdx >= `+o+`) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = `+i+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `+p+`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+e+`;

        vec4 minMaxValue = vec4(`+i+`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `+l+`; i += 4) {
          int inIdx = inOffset + i;
          `+d+" values = "+d+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `+h+`
        }

        int inIdx = inOffset + `+l+`;
        if (`+(c===1)+`) {
          `+d+" values = "+d+`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `+h+`
        } else if (`+(c===2)+`) {
          `+d+" values = "+d+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `+h+`
        } else if (`+(c===3)+`) {
          `+d+" values = "+d+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `+h+`
        }
        setOutput(`+u+`);
      }
    `}}(),FY=function(){return function(n,t){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=n;for(var e="",r=0;r<4;r++){var o="thisRC = rc;";r%2==1&&(o+="thisRC.z += 1;"),r>1&&(o+="thisRC.y += 1;"),e+=`
        `+o+`
        `+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`+r+`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `+(r>0?"}":"")+`
      `}this.userCode=`
      `+LY(t)+`
      `+MY(n)+`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `+n[1]+`;
        int cols = `+n[2]+`;

        `+e+`

        setOutput(result);
      }
    `}}();function MY(n){return`
    int getFlatIndex(ivec3 coords) {
      return round(`+O8(["coords.x","coords.y","coords.z"],Wc(n).map(function(t){return t.toString()}).concat(["1."]))+`);
    }
  `}function LY(n){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `+Rm(["r","c","d"],n)+`
      return ivec3(r, c, d);
    }
  `}var PY=function(){return function(n,t,e){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,o=r[1],a=r[2],i=n.shape,s=i[1],u=i[2],l=[e&&s>1?o-1:o,e&&u>1?a-1:a],c=[e&&s>1?s-1:s,e&&u>1?u-1:u],h=l[0]/c[0],d=l[1]/c[1],p=1/h,g=1/d,x=2*Math.ceil(p)+2,y=2*Math.ceil(g)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+h+`);
        const float widthScale = float(`+d+`);

        const float invHeightScale = float(`+p+`);
        const float invWidthScale = float(`+g+`);

        const int winHeight = int(`+x+`);
        const int winWidth = int(`+y+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+s+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+u+`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `+(o-1)+`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `+(a-1)+`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}(),BY=function(){return function(n,t,e,r){this.variableNames=["A"],this.outputShape=[];var o=n[0],a=n[1],i=n[2],s=n[3];this.outputShape=[o,t,e,s];var u=[r&&t>1?a-1:a,r&&e>1?i-1:i],l=[r&&t>1?t-1:t,r&&e>1?e-1:e];this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+u[0]/l[0]+`,
          `+u[1]/l[1]+`);
      const vec2 inputShapeRC = vec2(`+a+".0, "+i+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}(),zY=function(){return function(n,t,e,r){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=[];var o=n[0],a=n[1],i=n[2],s=n[3];this.outputShape=[o,t,e,s];var u=[r&&t>1?a-1:a,r&&e>1?i-1:i],l=[r&&t>1?t-1:t,r&&e>1?e-1:e];this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `+u[0]/l[0]+`,
          `+u[1]/l[1]+`,
          `+u[1]/l[1]+`);
      const vec3 inputShapeRC = vec3(`+a+".0, "+i+`.0,
                                     `+i+`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));
        
        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `+(s-1)+`; 
        bool hasNextRow = coords.z < `+(e-1)+`;

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}(),UY=function(){return function(n,t,e){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,o=r[1],a=r[2],i=n.shape,s=i[1],u=i[2],l=[e&&s>1?o-1:o,e&&u>1?a-1:a],c=[e&&s>1?s-1:s,e&&u>1?u-1:u],h=l[0]/c[0],d=l[1]/c[1],p=1/h,g=1/d,x=2*Math.ceil(p)+2,y=2*Math.ceil(g)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+h+`);
        const float widthScale = float(`+d+`);

        const float invHeightScale = float(`+p+`);
        const float invWidthScale = float(`+g+`);

        const int winHeight = int(`+x+`);
        const int winWidth = int(`+y+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+s+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+u+`) {
              continue;
            }

            float sourceFracRow =
              float(`+l[0]+`) *
                (float(dyR) / float(`+c[0]+`));

            float sourceFracCol =
                float(`+l[1]+`) *
                  (float(dyC) / float(`+c[1]+`));

            int sourceNearestRow = int(min(
                float(int(`+o+`) - 1),
                `+e+` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`+a+`) - 1),
                `+e+` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}(),WY=function(){return function(n,t,e,r){this.variableNames=["A"],this.outputShape=[];var o=n[0],a=n[1],i=n[2],s=n[3];this.outputShape=[o,t,e,s];var u=[r&&t>1?a-1:a,r&&e>1?i-1:i],l=[r&&t>1?t-1:t,r&&e>1?e-1:e],c=r?"0.5":"0.0";this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+u[0]/l[0]+`,
          `+u[1]/l[1]+`);
      const vec2 inputShapeRC = vec2(`+a+".0, "+i+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `+c+`)));

        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}(),VY=function(){return function(n,t){this.variableNames=["x"];var e=n.length;if(e>4)throw new Error("WebGL backend: Reverse of rank-"+e+" tensor is not yet supported");if(this.outputShape=n,e!==1){var r=n.map(function(a,i){return function(s){return t.indexOf(s)!==-1&&n[s]!==1?n[s]+" - coords["+s+"] - 1":"coords["+s+"]"}(i)}).join(","),o=Fn(e);this.userCode=`
      void main() {
        `+o+` coords = getOutputCoords();
        setOutput(getX(`+r+`));
      }
    `}else this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`+n[0]+` - coord - 1));
        }
      `}}(),GY=function(){return function(n,t){this.variableNames=["x"],this.usesPackedTextures=!0;var e=n.length;if(e>4)throw new Error("WebGL backend: Reverse of rank-"+e+" tensor is not yet supported");this.outputShape=n;var r=da("rc",e),o=r[e-1]+" + 1 < "+this.outputShape[e-1],a=r[e-2]+" + 1 < "+this.outputShape[e-2],i=Fn(e);function s(u){var l=n.map(function(c,h){return function(d,p){return t.indexOf(d)!==-1&&n[d]!==1?n[d]+" - "+p[d]+" - 1":""+p[d]}(h,u)});return"getChannel(getX("+l.join(",")+"), vec2("+l.slice(-2).join(",")+"))"}this.userCode=e===1?`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(`+n[0]+` - rc - 1), rc);
          if(`+o+`){
              result.g = getChannel(getX(`+n[0]+` - (rc  + 1) - 1), rc + 1);
          }
          setOutput(result);
        }
      `:`
        void main() {
          `+i+` rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = `+function(u){return s(u)}(r.slice())+`;
          if(`+o+`){
            result.g = `+function(u){return u[e-1]="("+u[e-1]+" + 1)",s(u)}(r.slice())+`;
          }
          if(`+a+`) {
            result.b = `+function(u){return u[e-2]="("+u[e-2]+" + 1)",s(u)}(r.slice())+`;
            if(`+o+`) {
              result.a = `+function(u){return u[e-1]="("+u[e-1]+" + 1)",u[e-2]="("+u[e-2]+" + 1)",s(u)}(r.slice())+`;
            }
          }
          setOutput(result);
        }
    `}}(),V$=function(){return function(n,t,e,r,o,a,i){this.variableNames=["updates","indices","defaultValue"],this.outputShape=a;var s=Fn(o.length),u=Fn(a.length),l="";e===1?l="i":e===2&&(l="i, j");var c="getIndices("+l+")",h="";r===1?h="i":r===2&&(h="i, coords[1]");var d="getUpdates("+h+")",p=t>1?"strides[j]":"strides";this.userCode=`
        `+s+" strides = "+s+"("+o+`);

        void main() {
          `+u+` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `+n+`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `+t+`; j++) {
              int index = round(`+c+`);
              flattenedIndex += index * `+p+`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `+d+`;
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `}}(),HY=function(){return function(n,t){this.variableNames=["x","segmentIds"];var e=n.windowSize,r=n.batchSize,o=n.inSize,a=n.numSegments,i=a*Math.ceil(o/e);this.outputShape=[r,i];var s=4*Math.floor(e/4),u=e%4,l=`
        sumValue += dot(values, segFilter);
    `,c="";o%e>0&&(c=`
        if (inIdx < 0 || inIdx >= `+o+`) {
          return initializationValue;
        }
      `);var h="";o%e>0&&(h=`
        if (inIdx < 0 || inIdx >= `+o+`) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = 0.0;

      float getValue(int batch, int inIdx) {
        `+c+`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `+h+`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `+a+")) * float("+e+`));
        int currentSeg = int(mod(float(outIdx), float(`+a+`)));

        float sumValue = 0.0;

        for (int i = 0; i < `+s+`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `+l+`
        }

        int inIdx = inOffset + `+s+`;
        if (`+(u===1)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `+l+`
        } else if (`+(u===2)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `+l+`
        } else if (`+(u===3)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `+l+`
        }
        setOutput(sumValue);
      }
    `}}(),qY=function(){return function(n,t,e){var r,o;if(this.variableNames=["c","a","b"],this.outputShape=t,e>4)throw Error("Where for rank "+e+" is not yet supported");if(e===1)o="resRC",r="resRC";else{for(var a=["resRC.x","resRC.y","resRC.z","resRC.w"],i=[],s=[],u=0;u<t.length;u++)s.push(""+a[u]),u<n&&i.push(""+a[u]);r=i.join(),o=s.join()}var l=Fn(e);this.userCode=`
      void main() {
        `+l+` resRC = getOutputCoords();
        float cVal = getC(`+r+`);
        if (cVal >= 1.0) {
          setOutput(getA(`+o+`));
        } else {
          setOutput(getB(`+o+`));
        }
      }
    `}}(),jY=function(){function n(t){this.variableNames=["source"],this.outputShape=t,this.rank=t.length;var e,r=Fn(this.rank),o="uniform int start["+this.rank+"];",a=XY(this.rank);e=`
        `+r+` sourceLoc;
        `+r+` coords = getOutputCoords();
        `+t.map(function(i,s){return"sourceLoc."+WS[s]+" = start["+s+"] + coords."+WS[s]+";"}).join(`
`)+`
      `,this.userCode=`
      `+o+`
      void main() {
        `+e+`
        setOutput(getSource(`+a+`));
      }
    `}return n.prototype.getCustomSetupFunc=function(t){var e=this;if(t.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+t.length+")");return function(r,o){e.startLoc==null&&(e.startLoc=r.getUniformLocationNoThrow(o,"start"),e.startLoc==null)||r.gl.uniform1iv(e.startLoc,t)}},n}(),WS=["x","y","z","w","u","v"];function XY(n){if(n===1)return"sourceLoc";if(n<=6)return WS.slice(0,n).map(function(t){return"sourceLoc."+t}).join(",");throw Error("Slicing for rank "+n+" is not yet supported")}var KY=function(){function n(t){this.variableNames=["source"],this.usesPackedTextures=!0,this.outputShape=t,this.rank=t.length;var e=Fn(this.rank),r=da("coords",this.rank),o=da("sourceLoc",this.rank),a=this.rank===1?"sourceLoc":"vec2("+o.slice(-2).join()+")",i="getChannel(getSource("+o.join()+"), "+a+")",s=`
      result.x = `+i+`;
      if (++`+r[this.rank-1]+" < "+t[this.rank-1]+`) {
        ++`+o[this.rank-1]+`;
        result.y = `+i+`;
        --`+o[this.rank-1]+`;
      }
    `,u=this.rank===1?"":`
      --`+r[this.rank-1]+`;
      if (++`+r[this.rank-2]+" < "+t[this.rank-2]+`) {
        ++`+o[this.rank-2]+`;
        result.z = `+i+`;
        if (++`+r[this.rank-1]+" < "+t[this.rank-1]+`) {
          ++`+o[this.rank-1]+`;
          result.w = `+i+`;
        }
      }
    `,l=this.rank<=4?`sourceLoc = coords +
            `+e+"("+t.map(function(c,h){return"start["+h+"]"}).join()+");":t.map(function(c,h){return o[h]+" = "+r[h]+" + start["+h+"];"}).join(`
`);this.userCode=`
      uniform int start[`+this.rank+`];
      void main() {
        `+e+` coords = getOutputCoords();
        `+e+` sourceLoc;
        `+l+` 
        vec4 result = vec4(0.);
        `+s+`
        `+u+`
        setOutput(result);
      }
    `}return n.prototype.getCustomSetupFunc=function(t){var e=this;if(t.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+t.length+")");return function(r,o){e.startLoc==null&&(e.startLoc=r.getUniformLocationNoThrow(o,"start"),e.startLoc==null)||r.gl.uniform1iv(e.startLoc,t)}},n}(),YY=function(){return function(n,t,e,r){this.variableNames=["x"];var o=e.filter(function(c,h){return r.indexOf(h)===-1});this.outputShape=o;var a=e.length,i=Fn(e.length),s=Fn(o.length),u="";if(a===1)u="coords * strides + begin";else{var l=0;u=e.map(function(c,h){return r.indexOf(h)===-1?(l++,o.length===1?"coords * strides["+h+"] + begin["+h+"]":"coords["+(l-1)+"] * strides["+h+"] + begin["+h+"]"):"begin["+h+"]"}).join(",")}this.userCode=`
      `+i+" begin = "+i+"("+n+`);
      `+i+" strides = "+i+"("+t+`);

      void main() {
        `+s+` coords = getOutputCoords();
        setOutput(getX(`+u+`));
      }
    `}}(),QY=function(){function n(t){this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return n.prototype.acquireTexture=function(t,e,r){var o,a=G$(e,r),i=H$(t,a,r);if(i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]),this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var s=this.freeTextures[i].shift();return this.usedTextures[i].push(s),s}return this.numUsedTextures++,this.log(),a===Uo.PACKED_2X2_FLOAT32?o=this.gpgpu.createPackedMatrixTexture(t[0],t[1]):a===Uo.PACKED_2X2_FLOAT16?o=this.gpgpu.createFloat16PackedMatrixTexture(t[0],t[1]):a===Uo.UNPACKED_FLOAT32?o=this.gpgpu.createFloat32MatrixTexture(t[0],t[1]):a===Uo.UNPACKED_FLOAT16?o=this.gpgpu.createFloat16MatrixTexture(t[0],t[1]):a===Uo.PACKED_4X1_UNSIGNED_BYTE&&(o=this.gpgpu.createUnsignedBytesMatrixTexture(t[0],t[1])),this.usedTextures[i].push(o),o},n.prototype.releaseTexture=function(t,e,r,o){if(this.freeTextures!=null){var a=H$(e,G$(r,o),o);a in this.freeTextures||(this.freeTextures[a]=[]),this.freeTextures[a].push(t),this.numFreeTextures++,this.numUsedTextures--;var i=this.usedTextures[a],s=i.indexOf(t);if(s<0)throw new Error("Cannot release a texture that was never provided by this texture manager");i.splice(s,1),this.log()}},n.prototype.log=function(){if(this.logEnabled){var t=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+t+")")}},n.prototype.getNumUsedTextures=function(){return this.numUsedTextures},n.prototype.getNumFreeTextures=function(){return this.numFreeTextures},n.prototype.dispose=function(){var t=this;if(this.freeTextures!=null){for(var e in this.freeTextures)this.freeTextures[e].forEach(function(r){t.gpgpu.deleteMatrixTexture(r)});for(var e in this.usedTextures)this.usedTextures[e].forEach(function(o){t.gpgpu.deleteMatrixTexture(o)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},n}();function G$(n,t){if(n===Hi.UPLOAD)return t?Uo.PACKED_2X2_FLOAT32:Uo.UNPACKED_FLOAT32;if(n===Hi.RENDER||n==null)return t?Y.get("WEBGL_RENDER_FLOAT32_ENABLED")?Uo.PACKED_2X2_FLOAT32:Uo.PACKED_2X2_FLOAT16:Y.get("WEBGL_RENDER_FLOAT32_ENABLED")?Uo.UNPACKED_FLOAT32:Uo.UNPACKED_FLOAT16;if(n===Hi.DOWNLOAD||n===Hi.PIXELS)return Uo.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+n)}function H$(n,t,e){return n[0]+"_"+n[1]+"_"+t+"_"+e}var ZY=function(){return function(n,t){this.variableNames=["A"];for(var e=new Array(n.length),r=0;r<e.length;r++)e[r]=n[r]*t[r];this.outputShape=e,this.rank=e.length;var o=Fn(this.rank),a=JY(n);this.userCode=`
      void main() {
        `+o+` resRC = getOutputCoords();
        setOutput(getA(`+a+`));
      }
    `}}();function JY(n){var t=n.length;if(t>5)throw Error("Tile for rank "+t+" is not yet supported");if(t===1)return"imod(resRC, "+n[0]+")";for(var e=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],o=0;o<n.length;o++)r.push("imod("+e[o]+", "+n[o]+")");return r.join()}var tQ=function(){return function(n,t){this.variableNames=["A"];for(var e=new Array(n.length),r=0;r<e.length;r++)e[r]=n[t[r]];this.outputShape=e,this.rank=e.length;var o=Fn(this.rank),a=eQ(t);this.userCode=`
    void main() {
      `+o+` resRC = getOutputCoords();
      setOutput(getA(`+a+`));
    }
    `}}();function eQ(n){var t=n.length;if(t>6)throw Error("Transpose for rank "+t+" is not yet supported");for(var e=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t),o=0;o<n.length;o++)r[n[o]]=e[o];return r.join()}var nQ=function(){return function(n,t){this.variableNames=["A"],this.usesPackedTextures=!0;for(var e=new Array(n.length),r=0;r<e.length;r++)e[r]=n[t[r]];if(this.outputShape=e,this.rank=e.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var o=Fn(this.rank),a=y4("rc",this.rank),i=new Array(this.rank);for(r=0;r<t.length;r++)i[t[r]]=a[r];var s="vec2("+i.slice(-2).join()+")",u="++"+a[this.rank-1]+" < "+e[this.rank-1],l="getChannel(getA("+i.join()+"), "+s+")";this.userCode=`
    void main() {
      `+o+` rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = `+l+`;
      if(`+u+`) {
        result[1] = `+l+`;
      }
      --`+a[this.rank-1]+`;
      if(++`+a[this.rank-2]+" < "+e[this.rank-2]+`) {
        result[2] = `+l+`;
        if(`+u+`) {
          result[3] = `+l+`;
        }
      }  
      setOutput(result);
    }
    `}}(),I4=.3275911,R4=.254829592,T4=-.284496736,N4=1.421413741,A4=-1.453152027,_4=1.061405429,xk=1.7580993408473768,yk=1.0507009873554805,Ne=function(){return function(n,t){this.variableNames=["A"],this.outputShape=n,this.userCode=`
      float unaryOperation(float x) {
        `+t+`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}(),Hc="if (isnan(x)) return x;",rQ="return x;",oQ="return abs(x);",D4=Hc+`
  return (x < 0.0) ? 0.0 : x;
`,aQ="return (x >= 0.0) ? x : (exp(x) - 1.0);",iQ=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = `+xk+`;
  float scale = `+yk+`;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`;function sQ(n){return n===void 0&&(n=0),Hc+`
    return x > 0.0 ? 1.0 : float(`+n+`);
  `}var uQ="return -x;",lQ="return ceil(x);",cQ="return floor(x);",hQ=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,fQ="return float(isnan(x));",dQ="return float(isinf(x));",pQ="return float(!isnan(x) && !isinf(x));",mQ=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,q$="return exp(x);",gQ="return exp(x) - 1.0;",vQ=`if (x < 0.0) return NAN;
  return log(x);`,xQ="return log(1.0 + x);",yQ="return sqrt(x);",bQ="return inversesqrt(x);",wQ="return 1.0 / (1.0 + exp(-1.0 * x));",CQ=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,SQ=Hc+`
  return sin(x);
`,EQ=Hc+`
  return cos(x);
`,kQ="return tan(x);",IQ="return asin(x);",RQ="return acos(x);",TQ=Hc+`
  return atan(x);
`,NQ=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,AQ=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,_Q=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,DQ="return log(x + sqrt(x * x + 1.0));",$Q=Hc+`
  if (x < 1.0) return NAN;
  return log(x + sqrt(x * x - 1.0));`,OQ=Hc+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
  return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,FQ=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = `+I4+`;
  float a1 = `+R4+`;
  float a2 = `+T4+`;
  float a3 = `+N4+`;
  float a4 = `+A4+`;
  float a5 = `+_4+`;

  float t = 1.0 / (1.0 + p * x);
  return 1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x);
`,MQ="return x * x;",LQ="return 1.0 / x;",PQ="return float(!(x >= 1.0));",BQ="return float(int(x));",j$="return x;",zQ="return x;",UQ=`
  vec4 result = log(x);
  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));
  result.r = isNaN.r == 1.0 ? NAN : result.r;
  result.g = isNaN.g == 1.0 ? NAN : result.g;
  result.b = isNaN.b == 1.0 ? NAN : result.b;
  result.a = isNaN.a == 1.0 ? NAN : result.a;

  return result;
`,$4=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,AC=function(){return function(n,t){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=n,this.userCode=`
      vec4 unaryOperation(vec4 x) {
        `+t+`
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}(),WQ=function(){return function(n){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=n;var t=n.length,e=da("rc",t),r=Fn(t),o=$8(t,e),a=e.slice(-2),i=t<=1?"rc":"vec2("+a.join(",")+")";this.userCode=`
      void main() {
        `+r+` rc = getOutputCoords();
        vec4 packedInput = getA(`+o+`);

        setOutput(getChannel(packedInput, `+i+`));
      }
    `}}();function VQ(n){return Ho(n,0)}function GQ(n,t){return Ho(n,t)}function HQ(n,t){return Ho(n,t)}function qQ(n,t){return Ho(n,t)}function jQ(n,t){t===void 0&&(t=0),et(n.length>=1,function(){return"Pass at least one tensor to concat"});var e=B0(n,"tensors","concat");t=no(t,e[0].shape)[0];var r=Df(e.map(function(i){return i.shape}),t);if(de(r)===0)return dr([],r);if((e=e.filter(function(i){return i.size>0})).length===1)return e[0];var o=e.map(function(i){return i.shape});a8(o,t);var a=e;return Y.engine.runKernel(function(i){return i.concat(e,t)},a,function(i){var s=o.map(function(u){return u[t]});return bk(i,s,t).map(function(u){return function(){return u}})})}function XQ(n,t,e){e===void 0&&(e=0);var r,o=K(n,"x","split");return e=no(e,o.shape)[0],typeof t=="number"?(et(o.shape[e]%t==0,function(){return"Number of splits must evenly divide the axis."}),r=new Array(t).fill(o.shape[e]/t)):(et(o.shape[e]===t.reduce(function(a,i){return a+i}),function(){return"The sum of sizes must match the size of the axis dimension."}),r=t),Y.engine.runKernel(function(a){return a.split(o,r,e)},{$x:o},function(a){return{$x:function(){return Ho(a,e)}}})}var Ho=lt({concat_:jQ}),KQ=lt({concat1d_:VQ}),YQ=lt({concat2d_:GQ}),QQ=lt({concat3d_:HQ}),ZQ=lt({concat4d_:qQ}),bk=lt({split_:XQ});function qc(n,t){return n(t={exports:{}},t.exports),t.exports}var JQ=qc(function(n){(function(t,e,r){function o(i,s){return s.c=i.c,s.s0=i.s0,s.s1=i.s1,s.s2=i.s2,s}function a(i,s){var u=new function(h){var d,p=this,g=(d=4022871197,function(x){x=x.toString();for(var y=0;y<x.length;y++){var b=.02519603282416938*(d+=x.charCodeAt(y));b-=d=b>>>0,d=(b*=d)>>>0,d+=4294967296*(b-=d)}return 23283064365386963e-26*(d>>>0)});p.next=function(){var x=2091639*p.s0+23283064365386963e-26*p.c;return p.s0=p.s1,p.s1=p.s2,p.s2=x-(p.c=0|x)},p.c=1,p.s0=g(" "),p.s1=g(" "),p.s2=g(" "),p.s0-=g(h),p.s0<0&&(p.s0+=1),p.s1-=g(h),p.s1<0&&(p.s1+=1),p.s2-=g(h),p.s2<0&&(p.s2+=1),g=null}(i),l=s&&s.state,c=u.next;return c.int32=function(){return 4294967296*u.next()|0},c.double=function(){return c()+11102230246251565e-32*(2097152*c()|0)},c.quick=c,l&&(typeof l=="object"&&o(l,u),c.state=function(){return o(u,{})}),c}e&&e.exports?e.exports=a:this.alea=a})(0,n)}),tZ=qc(function(n){(function(t,e,r){function o(i,s){return s.x=i.x,s.y=i.y,s.z=i.z,s.w=i.w,s}function a(i,s){var u=new function(h){var d=this,p="";d.x=0,d.y=0,d.z=0,d.w=0,d.next=function(){var x=d.x^d.x<<11;return d.x=d.y,d.y=d.z,d.z=d.w,d.w^=d.w>>>19^x^x>>>8},h===(0|h)?d.x=h:p+=h;for(var g=0;g<p.length+64;g++)d.x^=0|p.charCodeAt(g),d.next()}(i),l=s&&s.state,c=function(){return(u.next()>>>0)/4294967296};return c.double=function(){do var h=((u.next()>>>11)+(u.next()>>>0)/4294967296)/2097152;while(h===0);return h},c.int32=u.next,c.quick=c,l&&(typeof l=="object"&&o(l,u),c.state=function(){return o(u,{})}),c}e&&e.exports?e.exports=a:this.xor128=a})(0,n)}),eZ=qc(function(n){(function(t,e,r){function o(i,s){return s.x=i.x,s.y=i.y,s.z=i.z,s.w=i.w,s.v=i.v,s.d=i.d,s}function a(i,s){var u=new function(h){var d=this,p="";d.next=function(){var x=d.x^d.x>>>2;return d.x=d.y,d.y=d.z,d.z=d.w,d.w=d.v,(d.d=d.d+362437|0)+(d.v=d.v^d.v<<4^x^x<<1)|0},d.x=0,d.y=0,d.z=0,d.w=0,d.v=0,h===(0|h)?d.x=h:p+=h;for(var g=0;g<p.length+64;g++)d.x^=0|p.charCodeAt(g),g==p.length&&(d.d=d.x<<10^d.x>>>4),d.next()}(i),l=s&&s.state,c=function(){return(u.next()>>>0)/4294967296};return c.double=function(){do var h=((u.next()>>>11)+(u.next()>>>0)/4294967296)/2097152;while(h===0);return h},c.int32=u.next,c.quick=c,l&&(typeof l=="object"&&o(l,u),c.state=function(){return o(u,{})}),c}e&&e.exports?e.exports=a:this.xorwow=a})(0,n)}),nZ=qc(function(n){(function(t,e,r){function o(i,s){return s.x=i.x.slice(),s.i=i.i,s}function a(i,s){i==null&&(i=+new Date);var u=new function(h){var d=this;d.next=function(){var p,g,x=d.x,y=d.i;return p=x[y],g=(p^=p>>>7)^p<<24,g^=(p=x[y+1&7])^p>>>10,g^=(p=x[y+3&7])^p>>>3,g^=(p=x[y+4&7])^p<<7,p=x[y+7&7],g^=(p^=p<<13)^p<<9,x[y]=g,d.i=y+1&7,g},function(p,g){var x,y=[];if(g===(0|g))y[0]=g;else for(g=""+g,x=0;x<g.length;++x)y[7&x]=y[7&x]<<15^g.charCodeAt(x)+y[x+1&7]<<13;for(;y.length<8;)y.push(0);for(x=0;x<8&&y[x]===0;++x);for(x==8?y[7]=-1:y[x],p.x=y,p.i=0,x=256;x>0;--x)p.next()}(d,h)}(i),l=s&&s.state,c=function(){return(u.next()>>>0)/4294967296};return c.double=function(){do var h=((u.next()>>>11)+(u.next()>>>0)/4294967296)/2097152;while(h===0);return h},c.int32=u.next,c.quick=c,l&&(l.x&&o(l,u),c.state=function(){return o(u,{})}),c}e&&e.exports?e.exports=a:this.xorshift7=a})(0,n)}),rZ=qc(function(n){(function(t,e,r){function o(i,s){return s.i=i.i,s.w=i.w,s.X=i.X.slice(),s}function a(i,s){i==null&&(i=+new Date);var u=new function(h){var d=this;d.next=function(){var p,g,x=d.w,y=d.X,b=d.i;return d.w=x=x+1640531527|0,g=y[b+34&127],p=y[b=b+1&127],g^=g<<13,p^=p<<17,g^=g>>>15,p^=p>>>12,g=y[b]=g^p,d.i=b,g+(x^x>>>16)|0},function(p,g){var x,y,b,C,E,S=[],k=128;for(g===(0|g)?(y=g,g=null):(g+="\0",y=0,k=Math.max(k,g.length)),b=0,C=-32;C<k;++C)g&&(y^=g.charCodeAt((C+32)%g.length)),C===0&&(E=y),y^=y<<10,y^=y>>>15,y^=y<<4,y^=y>>>13,C>=0&&(E=E+1640531527|0,b=(x=S[127&C]^=y+E)==0?b+1:0);for(b>=128&&(S[127&(g&&g.length||0)]=-1),b=127,C=512;C>0;--C)y=S[b+34&127],x=S[b=b+1&127],y^=y<<13,x^=x<<17,y^=y>>>15,x^=x>>>12,S[b]=y^x;p.w=E,p.X=S,p.i=b}(d,h)}(i),l=s&&s.state,c=function(){return(u.next()>>>0)/4294967296};return c.double=function(){do var h=((u.next()>>>11)+(u.next()>>>0)/4294967296)/2097152;while(h===0);return h},c.int32=u.next,c.quick=c,l&&(l.X&&o(l,u),c.state=function(){return o(u,{})}),c}e&&e.exports?e.exports=a:this.xor4096=a})(0,n)}),oZ=qc(function(n){(function(t,e,r){function o(i,s){return s.a=i.a,s.b=i.b,s.c=i.c,s.d=i.d,s}function a(i,s){var u=new function(h){var d=this,p="";d.next=function(){var x=d.b,y=d.c,b=d.d,C=d.a;return x=x<<25^x>>>7^y,y=y-b|0,b=b<<24^b>>>8^C,C=C-x|0,d.b=x=x<<20^x>>>12^y,d.c=y=y-b|0,d.d=b<<16^y>>>16^C,d.a=C-x|0},d.a=0,d.b=0,d.c=-1640531527,d.d=1367130551,h===Math.floor(h)?(d.a=h/4294967296|0,d.b=0|h):p+=h;for(var g=0;g<p.length+20;g++)d.b^=0|p.charCodeAt(g),d.next()}(i),l=s&&s.state,c=function(){return(u.next()>>>0)/4294967296};return c.double=function(){do var h=((u.next()>>>11)+(u.next()>>>0)/4294967296)/2097152;while(h===0);return h},c.int32=u.next,c.quick=c,l&&(typeof l=="object"&&o(l,u),c.state=function(){return o(u,{})}),c}e&&e.exports?e.exports=a:this.tychei=a})(0,n)}),Zl=qc(function(n){(function(t,e){var r,o=this,a=256,i=6,s="random",u=e.pow(a,i),l=e.pow(2,52),c=2*l,h=a-1;function d(y,b,C){var E=[],S=g(function A(N,_){var $,D=[],O=typeof N;if(_&&O=="object")for($ in N)try{D.push(A(N[$],_-1))}catch{}return D.length?D:O=="string"?N:N+"\0"}((b=b==1?{entropy:!0}:b||{}).entropy?[y,x(t)]:y??function(){try{var A;return r&&(A=r.randomBytes)?A=A(a):(A=new Uint8Array(a),(o.crypto||o.msCrypto).getRandomValues(A)),x(A)}catch{var N=o.navigator,_=N&&N.plugins;return[+new Date,o,_,o.screen,x(t)]}}(),3),E),k=new function(A){var N,_=A.length,$=this,D=0,O=$.i=$.j=0,P=$.S=[];for(_||(A=[_++]);D<a;)P[D]=D++;for(D=0;D<a;D++)P[D]=P[O=h&O+A[D%_]+(N=P[D])],P[O]=N;($.g=function(z){for(var W,F=0,B=$.i,U=$.j,q=$.S;z--;)W=q[B=h&B+1],F=F*a+q[h&(q[B]=q[U=h&U+W])+(q[U]=W)];return $.i=B,$.j=U,F})(a)}(E),R=function(){for(var A=k.g(i),N=u,_=0;A<l;)A=(A+_)*a,N*=a,_=k.g(1);for(;A>=c;)A/=2,N/=2,_>>>=1;return(A+_)/N};return R.int32=function(){return 0|k.g(4)},R.quick=function(){return k.g(4)/4294967296},R.double=R,g(x(k.S),t),(b.pass||C||function(A,N,_,$){return $&&($.S&&p($,k),A.state=function(){return p(k,{})}),_?(e[s]=A,N):A})(R,S,"global"in b?b.global:this==e,b.state)}function p(y,b){return b.i=y.i,b.j=y.j,b.S=y.S.slice(),b}function g(y,b){for(var C,E=y+"",S=0;S<E.length;)b[h&S]=h&(C^=19*b[h&S])+E.charCodeAt(S++);return x(b)}function x(y){return String.fromCharCode.apply(0,y)}if(e["seed"+s]=d,g(e.random(),t),n.exports){n.exports=d;try{r=require("crypto")}catch{}}})([],Math)});Zl.alea=JQ,Zl.xor128=tZ,Zl.xorwow=eZ,Zl.xorshift7=nZ,Zl.xor4096=rZ,Zl.tychei=oZ;var aZ=Zl,O4=aZ.alea,F4=function(){function n(t,e,r,o,a){this.mean=t,this.stdDev=e,this.dtype=r,this.nextVal=NaN,this.truncated=o,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var i=a||Math.random();this.random=O4(i.toString())}return n.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var t=this.nextVal;return this.nextVal=NaN,t}for(var e,r,o=!1;!o;){var a=void 0,i=void 0,s=void 0;do s=(a=2*this.random()-1)*a+(i=2*this.random()-1)*i;while(s>=1||s===0);var u=Math.sqrt(-2*Math.log(s)/s);e=this.mean+this.stdDev*a*u,r=this.mean+this.stdDev*i*u,this.truncated&&!this.isValidTruncated(e)||(o=!0)}return this.truncated&&!this.isValidTruncated(r)||(this.nextVal=this.convertValue(r)),this.convertValue(e)},n.prototype.convertValue=function(t){return this.dtype==null||this.dtype==="float32"?t:Math.round(t)},n.prototype.isValidTruncated=function(t){return t<=this.upper&&t>=this.lower},n}();function iZ(n){var t=K(n,"x","clone",null);return Y.engine.runKernel(function(e){return Gt.make(t.shape,{dataId:t.dataId},t.dtype)},{$x:t},function(e){return{$x:function(){return e.toFloat()}}})}function sZ(n,t,e,r){r===void 0&&(r="float32"),t==null&&(t=n);for(var o=Be([n,t],r),a=n<=t?n:t,i=0;i<a;++i)o.set(1,i,i);var s=o.toTensor().as2D(n,t);if(e==null)return s;if(e.length===1)return mf(La(s,0),[e[0],1,1]);if(e.length===2)return mf(La(La(s,0),0),[e[0],e[1],1,1]);if(e.length===3)return mf(La(La(La(s,0),0),0),[e[0],e[1],e[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+e.length+"D.")}function uZ(n,t,e,r,o){if(t===void 0&&(t=0),e===void 0&&(e=1),r!=null&&r==="bool")throw new Error("Unsupported data type "+r);for(var a=new F4(t,e,r,!1,o),i=Be(n,r),s=0;s<i.values.length;s++)i.values[s]=a.nextValue();return i.toTensor()}function lZ(n,t,e,r,o){if(t===void 0&&(t=0),e===void 0&&(e=1),r!=null&&r==="bool")throw new Error("Unsupported data type "+r);for(var a=new F4(t,e,r,!0,o),i=Be(n,r),s=0;s<i.values.length;s++)i.values[s]=a.nextValue();return i.toTensor()}function cZ(n,t,e,r){t===void 0&&(t=0),e===void 0&&(e=1),r===void 0&&(r="float32");for(var o=Be(n,r),a=0;a<o.values.length;a++)o.values[a]=mK(t,e);return o.toTensor()}function hZ(n,t,e){var r=de(n),o=null;if(e==null||e==="float32")o=new Float32Array(r);else if(e==="int32")o=new Int32Array(r);else{if(e!=="bool")throw new Error("Unknown data type "+e);o=new Uint8Array(r)}for(var a=0;a<r;a++)o[a]=t();return Gt.make(n,{values:o},e)}function fZ(n,t,e,r){r===void 0&&(r=!1);var o=K(n,"logits","multinomial"),a=o.size,i=o.rank;if(a<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+a+".");if(i>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+i);e=e||Math.random();var s=i===1?o.as2D(1,-1):o,u=Y.engine.runKernel(function(l){return l.multinomial(s,r,t,e)},{logits2D:s});return i===1?u.as1D():u}function dZ(n,t,e,r){if(e===void 0&&(e=1),r===void 0&&(r=0),t<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+t);var o=K(n,"indices","oneHot","int32"),a=o.shape.concat([t]);return o=o.flatten(),Y.engine.runKernel(function(i){return i.oneHot(o,t,e,r)},{$indices:o},function(i){return{$indices:function(){return ir(o.shape,"float32")}}}).reshape(a)}function pZ(n,t){var e=K(n,"x","reshape",null);return t=vK(t,e.size),et(e.size===de(t),function(){return"new shape and old shape must have the same number of elements."}),Y.engine.runKernel(function(r){return r.reshape(e,t)},{$x:e},function(r){return{$x:function(){return r.reshape(e.shape)}}})}function mZ(n,t){var e=K(n,"x","squeeze");return ui(e,Uc(e.shape,t).newShape)}function gZ(n,t){var e=K(n,"x","cast");return Y.engine.runKernel(function(r){return r.cast(e,t)},{$x:e},function(r){return{$x:function(){return r.clone()}}})}function vZ(n,t){var e=K(n,"x","tile");return et(e.rank===t.length,function(){return"Error in transpose: rank of input "+e.rank+" must match length of reps "+t+"."}),Y.engine.runKernel(function(r,o){var a=r.tile(e,t);return o([e]),a},{$x:e},function(r,o){var a=o[0];return{$x:function(){var i=sn(a);if(a.rank===1)for(var s=0;s<t[0];++s)i=i.add(r.slice([s*a.shape[0]],[a.shape[0]]));else if(a.rank===2)for(s=0;s<t[0];++s)for(var u=0;u<t[1];++u)i=i.add(r.slice([s*a.shape[0],u*a.shape[1]],[a.shape[0],a.shape[1]]));else if(a.rank===3)for(s=0;s<t[0];++s)for(u=0;u<t[1];++u)for(var l=0;l<t[2];++l)i=i.add(r.slice([s*a.shape[0],u*a.shape[1],l*a.shape[2]],[a.shape[0],a.shape[1],a.shape[2]]));else{if(a.rank!==4)throw new Error("Gradient for tile operation is not implemented for rank-"+a.rank+" tensors yet.");for(s=0;s<t[0];++s)for(u=0;u<t[1];++u)for(l=0;l<t[2];++l)for(var c=0;c<t[3];++c)i=i.add(r.slice([s*a.shape[0],u*a.shape[1],l*a.shape[2],c*a.shape[3]],[a.shape[0],a.shape[1],a.shape[2],a.shape[3]]))}return i}}})}function xZ(n,t,e){return e===void 0&&(e=0),et(t.length===2,function(){return"Invalid number of paddings. Must be length of 2."}),_m(n,[t],e)}function yZ(n,t,e){return e===void 0&&(e=0),et(t.length===2&&t[0].length===2&&t[1].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),_m(n,t,e)}function bZ(n,t,e){return e===void 0&&(e=0),et(t.length===3&&t[0].length===2&&t[1].length===2&&t[2].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),_m(n,t,e)}function wZ(n,t,e){return e===void 0&&(e=0),et(t.length===4&&t[0].length===2&&t[1].length===2&&t[2].length===2&&t[3].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),_m(n,t,e)}function CZ(n,t,e){e===void 0&&(e=0);var r=K(n,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var o=t.map(function(a){return a[0]});return Y.engine.runKernel(function(a){return a.pad(r,t,e)},{$x:r},function(a){return{$x:function(){return a.slice(o,r.shape)}}})}function SZ(n,t){t===void 0&&(t=0);var e=B0(n,"tensors","stack");if(et(e.length>=1,function(){return"Pass at least one tensor to tf.stack"}),e.length===1)return e[0].expandDims(t);var r=e[0].rank,o=e[0].shape,a=e[0].dtype;et(t<=r,function(){return"Axis must be <= rank of the tensor"}),e.forEach(function(s){Cn(o,s.shape,"All tensors passed to stack must have matching shapes")}),e.forEach(function(s){et(a===s.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var i=e.map(function(s){return s.expandDims(t)});return Ho(i,t)}function EZ(n,t,e){var r=K(n,"x","batchToSpaceND"),o=t.reduce(function(a,i){return a*i});return et(r.rank>=1+t.length,function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+t.length}),et(e.length===t.length,function(){return"crops.length is "+e.length+" but should be equal to blockShape.length  "+t.length}),et(r.shape[0]%o==0,function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+t.join(" * ")+" === "+o}),Y.engine.runKernel(function(a){return a.batchToSpaceND(r,t,e)},{$x:r},function(a){return{$x:function(){return a.spaceToBatchND(t,e)}}})}function kZ(n,t,e){var r=K(n,"x","spaceToBatchND");return et(r.rank>=1+t.length,function(){return"input rank "+r.rank+" should be > than [blockShape] "+t.length}),et(e.length===t.length,function(){return"paddings.shape[0] "+e.length+" must be equal to [blockShape] "+t.length}),et(r.shape.reduce(function(o,a,i){return i>0&&i<=t.length?o&&(a+e[i-1][0]+e[i-1][1])%t[i-1]==0:o},!0),function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+e.toString()+" must be divisible by blockShapes "+t.toString()}),Y.engine.runKernel(function(o){return o.spaceToBatchND(r,t,e)},{$x:r},function(o){return{$x:function(){return o.batchToSpaceND(t,e)}}})}function IZ(n,t){t===void 0&&(t=0),t=t||0;var e=K(n,"x","unstack");return et(t>=-e.shape.length&&t<e.shape.length,function(){return"Axis = "+t+" is not in [-"+e.shape.length+", "+e.shape.length+")"}),t<0&&(t+=e.shape.length),Y.engine.runKernel(function(r){return r.unstack(e,t)},{$x:e},function(r){return{$x:function(){return hi(r,t)}}})}function RZ(n,t,e,r){t===void 0&&(t=0),e===void 0&&(e=!1),r===void 0&&(r=!1);var o=K(n,"x","cumsum"),a=fs([t|=0],o.rank),i=o;a!=null&&(i=o.transpose(a));var s=ds(1,o.rank)[0],u=Y.engine.runKernel(function(l){return l.cumsum(i,s,e,r)},{permutedX:i},function(l){return{permutedX:function(){return l.cumsum(t,e,!r)}}});return a!=null&&(u=u.transpose(a)),u}function TZ(n,t){t===void 0&&(t=0);var e=K(n,"x","expandDims");et(t<=e.rank,function(){return"Axis must be <= rank of the tensor"});var r=e.shape.slice();return t<0&&(et(-(e.rank+1)<=t,function(){return"Axis must be in the interval ["+-(e.rank+1)+", "+e.rank+"]"}),t=e.rank+t+1),r.splice(t,0,1),ui(e,r)}function NZ(n,t,e){e===void 0&&(e="NHWC");var r=K(n,"x","depthToSpace"),o=e==="NHWC"?r.shape[1]:r.shape[2],a=e==="NHWC"?r.shape[2]:r.shape[3],i=e==="NHWC"?r.shape[3]:r.shape[1];return et(o*t>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+o+" and "+t+`  for depthToSpace with input shape
      `+r.shape}),et(a*t>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+a+" and "+t+` for depthToSpace with input shape
          `+r.shape}),et(i%(t*t)==0,function(){return"Dimension size must be evenly divisible by "+t*t+" but is "+i+" for depthToSpace with input shape "+r.shape}),Y.engine.runKernel(function(s){return s.depthToSpace(r,t,e)},{$x:r})}function AZ(n,t){return bn(this,void 0,void 0,function(){var e,r,o,a,i,s,u,l,c,h;return wn(this,function(d){switch(d.label){case 0:return e=K(n,"x","setdiff1d"),r=K(t,"y","setdiff1d"),et(e.dtype===r.dtype,function(){return"x and y should have the same dtype, but got x ("+e.dtype+") and y ("+r.dtype+")."}),et(e.rank===1,function(){return"x should be 1D tensor, but got x ("+e.shape+")."}),et(r.rank===1,function(){return"y should be 1D tensor, but got y ("+r.shape+")."}),[4,e.data()];case 1:return o=d.sent(),[4,r.data()];case 2:for(a=d.sent(),i=new Set(a),s=0,c=0;c<o.length;c++)i.has(o[c])||s++;for(u=new tm([s],e.dtype),l=new tm([s],"int32"),c=0,h=0;c<o.length;c++)i.has(o[c])||(u.values[h]=o[c],l.values[h]=c,h++);return[2,[u.toTensor(),l.toTensor()]]}})})}function Be(n,t,e){return t===void 0&&(t="float32"),t=t||"float32",KM(n),new tm(n,t,e)}function _Z(n,t){t===void 0&&(t=!1),console.log(n.toString(t))}var M4=lt({batchToSpaceND_:EZ}),DZ=lt({cast_:gZ}),$Z=lt({clone_:iZ}),OZ=lt({cumsum_:RZ}),FZ=lt({depthToSpace_:NZ}),La=lt({expandDims_:TZ}),L4=lt({eye_:sZ}),MZ=lt({multinomial_:fZ}),VS=lt({oneHot_:dZ}),_m=lt({pad_:CZ}),LZ=lt({pad1d_:xZ}),PZ=lt({pad2d_:yZ}),BZ=lt({pad3d_:bZ}),zZ=lt({pad4d_:wZ}),UZ=lt({rand_:hZ}),WZ=lt({randomNormal_:uZ}),VZ=lt({randomUniform_:cZ}),ui=lt({reshape_:pZ}),P4=lt({spaceToBatchND_:kZ}),B4=lt({squeeze_:mZ}),hi=lt({stack_:SZ}),mf=lt({tile_:vZ}),GZ=lt({truncatedNormal_:lZ}),Zr=lt({unstack_:IZ}),HZ=AZ;function wk(n,t){for(var e=[],r=0;r<t.length;r++)t[r]&&e.push(r);var o=Be(n,"int32"),a=Be([e.length,n.length],"int32");for(r=0;r<e.length;r++){var i=o.indexToLoc(e[r]),s=r*n.length;a.values.set(i,s)}return a.toTensor()}var _x={};function qZ(n){return n in _x||(_x[n]={}),_x[n]}function jZ(n,t){if(n==="linear")return t?zQ:rQ;if(n==="relu")return t?$4:D4;throw new Error("Activation "+n+" has not been implemented for the WebGL backend.")}var XZ=128,X$=1e3,KZ=function(){function n(t){if(this.gpgpu=t,this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.lruDataGPU=[],this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.disposed=!1,Y.get("WEBGL_VERSION")<1)throw new Error("WebGL is not supported on this device");if(t==null){var e=cs(Y.get("WEBGL_VERSION"));this.binaryCache=qZ(Y.get("WEBGL_VERSION")),this.gpgpu=new gY(e),this.canvas=e.canvas,this.gpgpuCreatedLocally=!0}else this.binaryCache={},this.gpgpuCreatedLocally=!1,this.canvas=t.gl.canvas;this.textureManager=new QY(this.gpgpu)}return n.prototype.register=function(t,e,r){if(this.texData.has(t))throw new Error("Data buffer is already registered");this.texData.set(t,{shape:e,dtype:r})},n.prototype.setDataMover=function(t){this.texData=new p4(t)},n.prototype.fromPixels=function(t,e){if(t==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var r=[t.height,t.width],o=[t.height,t.width,e];if(Y.get("IS_BROWSER")){if(!(t instanceof HTMLVideoElement||t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageData))throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement or ImageData, but was "+t.constructor.name);if(t instanceof HTMLVideoElement){if(this.fromPixels2DContext==null){if(document.readyState!=="complete")throw new Error("The DOM is not ready yet. Please call tf.browser.fromPixels() once the DOM is ready. One way to do that is to add an event listener for `DOMContentLoaded` on the document object");this.fromPixels2DContext=document.createElement("canvas").getContext("2d")}this.fromPixels2DContext.canvas.width=t.width,this.fromPixels2DContext.canvas.height=t.height,this.fromPixels2DContext.drawImage(t,0,0,t.width,t.height),t=this.fromPixels2DContext.canvas}}var a=this.makeTensorHandle(r,"int32");this.texData.get(a.dataId).usage=Hi.PIXELS,this.gpgpu.uploadPixelDataToTexture(this.getTexture(a.dataId),t);var i=new w9(o),s=this.compileAndRun(i,[a]);return this.disposeData(a.dataId),s},n.prototype.makeTensorHandle=function(t,e){var r={};return this.register(r,t,e),{dataId:r,shape:t,dtype:e}},n.prototype.write=function(t,e){if(e==null)throw new Error("MathBackendWebGL.write(): values can not be null");if(Y.get("DEBUG"))for(var r=0;r<e.length;r++){var o=e[r];if(!_9(o))throw Error("The value "+o+" cannot be represented on this device.")}var a=this.texData.get(t),i=a.texture,s=a.texShape,u=a.usage,l=a.dtype,c=a.isPacked;if(l==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");i!=null&&(this.releaseTexture(t,i,s,u,l,c),a.texture=null,a.texShape=null),a.usage=Hi.UPLOAD,a.values=e},n.prototype.readSync=function(t){var e=this.texData.get(t),r=e.values,o=e.dtype,a=e.complexTensors,i=e.slice,s=e.shape;if(i!=null){var u=new Ne(s,j$),l=this.compileAndRun(u,[{dataId:t,shape:s,dtype:o}]),c=this.readSync(l.dataId);return l.dispose(),c}if(r!=null)return this.convertAndCacheOnCPU(t);if(o==="string")return r;var h,d,p=this.activeTimers!=null;return p&&(h=performance.now()),o==="complex64"?d=g4(a.real.dataSync(),a.imag.dataSync()):d=this.getValuesFromTexture(t),p&&(this.downloadWaitMs+=performance.now()-h),this.convertAndCacheOnCPU(t,d)},n.prototype.read=function(t){return bn(this,void 0,void 0,function(){var e,r,o,a,i,s,u,l,c,h,d,p,g,x,y,b,C,E,S,k,R,A,N,_;return wn(this,function($){switch($.label){case 0:if(this.pendingRead.has(t))return o=this.pendingRead.get(t),[2,new Promise(function(D){return o.push(D)})];if(a=this.texData.get(t),i=a.texture,s=a.values,u=a.texShape,l=a.isPacked,c=a.shape,h=a.slice,d=a.dtype,h!=null)return p=new Ne(c,j$),g=this.compileAndRun(p,[{dataId:t,shape:c,dtype:d}]),x=this.read(g.dataId),g.dispose(),[2,x];if(s!=null)return[2,this.convertAndCacheOnCPU(t)];if(this.pendingRead.set(t,[]),!Y.get("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&Y.get("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return y=u[1],b=u[0],l&&(e=Gc(u[0],u[1]),y=e[0],b=e[1]),C=this.gpgpu.maybeCreateBufferFromTexture(i,b,y),[4,this.gpgpu.createAndWaitForFence()];case 1:return $.sent(),C instanceof WebGLTexture?E=this.getValuesFromTexture(t):(S=de(c),l?(k=nf(c),R=1,A=1,c.length&&(r=rf(c),R=r[0],A=r[1]),E=this.gpgpu.downloadPackedMatrixFromBuffer(C,k,R,A,u[0],u[1]).subarray(0,S)):E=this.gpgpu.downloadFloat32MatrixFromBuffer(C,u[0],u[1]).subarray(0,S)),N=this.convertAndCacheOnCPU(t,E),_=this.pendingRead.get(t),this.pendingRead.delete(t),_.forEach(function(D){return D(N)}),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t)),[2,N]}})})},n.prototype.getValuesFromTexture=function(t){var e,r=this,o=this.texData.get(t),a=o.shape,i=o.dtype,s=o.texture,u=o.texShape,l=de(a);if(Y.get("WEBGL_DOWNLOAD_FLOAT_ENABLED")){if(this.texData.get(t).isPacked){var c=nf(a),h=1,d=1;return a.length&&(h=(e=rf(a))[0],d=e[1]),this.gpgpu.downloadMatrixFromPackedTexture(s,c,h,d,u[0],u[1]).subarray(0,l)}return this.gpgpu.downloadFloat32MatrixFromOutputTexture(s,u[0],u[1]).subarray(0,l)}var p=this.makeTensorHandle(a,"float32");p.size=de(a),this.texData.get(p.dataId).usage=Hi.DOWNLOAD;var g=he(function(){var b=new y9(a);return r.compileAndRun(b,[{shape:a,dtype:i,dataId:t}],p,null,!1)}),x=this.texData.get(g.dataId),y=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(x.texture,x.texShape[0],x.texShape[1]).subarray(0,l);return this.disposeData(p.dataId),y},n.prototype.time=function(t){return bn(this,void 0,void 0,function(){var e,r,o,a,i,s,u;return wn(this,function(l){switch(l.label){case 0:return e=this.activeTimers,r=[],o=!1,this.programTimersStack==null?(this.programTimersStack=r,o=!0):this.activeTimers.push(r),this.activeTimers=r,t(),a=_f(this.activeTimers.map(function(c){return c.query})).filter(function(c){return c!=null}),i=_f(this.activeTimers.map(function(c){return c.name})).filter(function(c){return c!=null}),this.activeTimers=e,o&&(this.programTimersStack=null),[4,Promise.all(a)];case 1:return s=l.sent(),u={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:pK(s),getExtraProfileInfo:function(){return s.map(function(c,h){return{name:i[h],ms:c}}).map(function(c){return c.name+": "+c.ms}).join(", ")},wallMs:null},this.uploadWaitMs=0,this.downloadWaitMs=0,[2,u]}})})},n.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},n.prototype.startTimer=function(){return Y.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?this.gpgpu.beginQuery():{startMs:performance.now(),endMs:null}},n.prototype.endTimer=function(t){return Y.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(this.gpgpu.endQuery(),t):(t.endMs=performance.now(),t)},n.prototype.getQueryTime=function(t){return bn(this,void 0,void 0,function(){var e;return wn(this,function(r){return Y.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?[2,this.gpgpu.waitForQueryAndGetTime(t)]:[2,(e=t).endMs-e.startMs]})})},n.prototype.disposeData=function(t){if(!this.pendingDisposal.has(t)){if(this.pendingRead.has(t))this.pendingDisposal.add(t);else if(this.texData.has(t)){var e=this.texData.get(t),r=e.texture,o=e.dtype,a=e.texShape,i=e.usage,s=e.complexTensors,u=e.isPacked,l=e.slice;if(r!=null){var c=l&&l.origDataId||t,h=this.dataRefCount.get(c);h>1?this.dataRefCount.set(c,h-1):(this.dataRefCount.delete(c),this.releaseTexture(t,r,a,i,o,u),this.texData.delete(t))}s!=null&&(s.real.dispose(),s.imag.dispose())}}},n.prototype.getTexture=function(t){return this.uploadToGPU(t),this.texData.get(t).texture},n.prototype.getCPUBackend=function(){return Y.get("WEBGL_CPU_FORWARD")?(this.cpuBackend==null&&(this.cpuBackend=Y.findBackend("cpu")),this.cpuBackend):null},n.prototype.shouldExecuteOnCPU=function(t,e){var r=this;return e===void 0&&(e=XZ),this.getCPUBackend()!=null&&t.every(function(o){return r.texData.get(o.dataId).texture==null&&o.size<e})},n.prototype.getGPGPUContext=function(){return this.gpgpu},n.prototype.getCanvas=function(){return this.canvas},n.prototype.complex=function(t,e){var r=this.makeOutputArray(t.shape,"complex64");return this.texData.get(r.dataId).complexTensors={real:Y.engine.keep(t.clone()),imag:Y.engine.keep(e.clone())},r},n.prototype.real=function(t){return this.texData.get(t.dataId).complexTensors.real.clone()},n.prototype.imag=function(t){return this.texData.get(t.dataId).complexTensors.imag.clone()},n.prototype.slice=function(t,e,r){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.slice(t,e,r);var o=this.texData.get(t.dataId).isPacked,a=c4(t.shape,e,r);if(o||!a){var i=Y.get("WEBGL_PACK_ARRAY_OPERATIONS")?new KY(r):new jY(r),s=i.getCustomSetupFunc(e);return this.compileAndRun(i,[t],null,s)}return this.uploadToGPU(t.dataId),this.shallowSlice(t,e,r)},n.prototype.shallowSlice=function(t,e,r){var o=this.texData.get(t.dataId),a=Gt.make(r,{},t.dtype,this),i=this.texData.get(a.dataId);Object.assign(i,o),i.shape=r,i.dtype=t.dtype;var s=h4(e,t.strides);o.slice&&(s+=o.slice.flatOffset),i.slice={flatOffset:s,origDataId:o.slice&&o.slice.origDataId||t.dataId};var u=this.dataRefCount.get(i.slice.origDataId)||1;return this.dataRefCount.set(i.slice.origDataId,u+1),a},n.prototype.stridedSlice=function(t,e,r,o,a,i,s,u,l){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.stridedSlice(t,e,r,o,a,i,s,u,l);var c=dk(t.shape,e,r,o,a,i,s,u,l),h=c[0],d=c[1],p=c[2],g=d.filter(function(y,b){return p.indexOf(b)===-1});if(g.some(function(y){return y===0}))return dr([],g);var x=new YY(h,o,d,p);return this.compileAndRun(x,[t])},n.prototype.reverse=function(t,e){var r=Y.get("WEBGL_PACK_ARRAY_OPERATIONS")?new GY(t.shape,e):new VY(t.shape,e);return this.compileAndRun(r,[t])},n.prototype.concat=function(t,e){if(this.shouldExecuteOnCPU(t))return this.cpuBackend.concat(t,e);if(t.length===1)return t[0];if(t.length>Y.get("WEBGL_MAX_TEXTURES_IN_SHADER")){var r=Math.floor(t.length/2),o=this.concat(t.slice(0,r),e),a=this.concat(t.slice(r),e);return this.concat([o,a],e)}if(Y.get("WEBGL_PACK_ARRAY_OPERATIONS")&&t[0].rank>1){var i=new o9(t.map(function(c){return c.shape}),e);return this.compileAndRun(i,t)}var s=Df(t.map(function(c){return c.shape}),e),u=t.map(function(c){return c.as2D(-1,de(c.shape.slice(e)))}),l=new r9(u.map(function(c){return c.shape}));return this.compileAndRun(l,u).reshape(s)},n.prototype.neg=function(t){var e=new Ne(t.shape,uQ);return this.compileAndRun(e,[t])},n.prototype.batchMatMul=function(t,e,r,o){var a=r?t.shape[2]:t.shape[1],i=o?e.shape[1]:e.shape[2],s=r?t.shape[1]:t.shape[2],u=t.shape[0];if((a===1||i===1)&&s>X$){r&&(t=t.transpose([0,2,1])),o&&(e=e.transpose([0,2,1]));var l=i===1?t:t.as3D(u,s,1),c=i===1?2:1,h=i===1?e.as3D(u,1,s):e;return this.multiply(l,h).sum(c,!0)}var d=Lr(t.dtype,e.dtype),p=new TC(t.shape,[u,a,i],r,o),g=this.makePackedTensor(p.outputShape,d);return this.compileAndRun(p,[t,e],g)},n.prototype.fusedBatchMatMul=function(t,e,r,o,a,i){var s=r?t.shape[2]:t.shape[1],u=o?e.shape[1]:e.shape[2],l=t.shape[0],c=Lr(t.dtype,e.dtype),h=new TC(t.shape,[l,s,u],r,o,!!a,i?jZ(i,!0):null),d=this.makePackedTensor(h.outputShape,c),p=[t,e];return a&&p.push(a),this.compileAndRun(h,p,d)},n.prototype.multiply=function(t,e){if(t.dtype==="complex64"){var r=this.texData.get(t.dataId),o=this.texData.get(e.dataId),a=new O$($$.REAL,t.shape,e.shape),i=new O$($$.IMAG,t.shape,e.shape),s=[this.makeComplexComponentTensorHandle(t,r.complexTensors.real),this.makeComplexComponentTensorHandle(t,r.complexTensors.imag),this.makeComplexComponentTensorHandle(e,o.complexTensors.real),this.makeComplexComponentTensorHandle(e,o.complexTensors.imag)],u=this.compileAndRun(a,s),l=this.compileAndRun(i,s),c=this.complex(u,l);return u.dispose(),l.dispose(),c}if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.multiply(t,e);if(Y.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,F$,t.dtype);var h=new jn(F$,t.shape,e.shape),d=this.makeOutputArray(h.outputShape,t.dtype);return this.compileAndRun(h,[t,e],d)},n.prototype.batchNormalization=function(t,e,r,o,a,i){var s=[t,e,r],u=null;i!=null&&(u=i.shape,s.push(i));var l=null;if(a!=null&&(l=a.shape,s.push(a)),Y.get("WEBGL_PACK_BATCHNORMALIZATION")){var c=new b7(t.shape,e.shape,r.shape,u,l,o);return this.compileAndRun(c,s)}var h=new y7(t.shape,e.shape,r.shape,u,l,o);return this.compileAndRun(h,s)},n.prototype.localResponseNormalization4D=function(t,e,r,o,a){var i=new CY(t.shape,e,r,o,a);return this.compileAndRun(i,[t])},n.prototype.LRNGrad=function(t,e,r,o,a,i,s){var u=new SY(e.shape,o,a,i,s);return this.compileAndRun(u,[e,r,t])},n.prototype.tile=function(t,e){var r=new ZY(t.shape,e);return this.compileAndRun(r,[t])},n.prototype.pad=function(t,e,r){var o=Y.get("WEBGL_PACK_ARRAY_OPERATIONS")?new $Y(t.shape,e,r):new DY(t.shape,e,r);return this.compileAndRun(o,[t])},n.prototype.transpose=function(t,e){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.transpose(t,e);var r=Y.get("WEBGL_PACK_ARRAY_OPERATIONS")?new nQ(t.shape,e):new tQ(t.shape,e);return this.compileAndRun(r,[t])},n.prototype.gather=function(t,e,r){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.gather(t,e,r);var o=new C9(t.shape,e.size,r);return this.compileAndRun(o,[t,e])},n.prototype.batchToSpaceND=function(t,e,r){et(t.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var o=e.reduce(function(c,h){return c*h}),a=z0(t.shape,e,o),i=U0(a.length,e.length),s=W0(t.shape,e,o),u=a4(r,e.length),l=i4(s,r,e.length);return t.reshape(a).transpose(i).reshape(s).slice(u,l)},n.prototype.spaceToBatchND=function(t,e,r){et(t.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var o=e.reduce(function(h,d){return h*d}),a=[[0,0]];a.push.apply(a,r);for(var i=1+e.length;i<t.shape.length;++i)a.push([0,0]);var s=t.pad(a),u=z0(s.shape,e,o,!1),l=U0(u.length,e.length,!1),c=W0(s.shape,e,o,!1);return s.reshape(u).transpose(l).reshape(c)},n.prototype.reduce=function(t,e,r){var o=t.shape[0],a=t.shape[1],i=SC(a),s=new OY({windowSize:i,inSize:a,batchSize:o},e),u=s.outputShape,l=u[0],c=u[1],h=this.makeOutputArray([l,c],r);return this.compileAndRun(s,[t],h),h.shape[1]===1?h:this.reduce(h,e,r)},n.prototype.argReduce=function(t,e,r){r===void 0&&(r=null);var o=t.shape[0],a=t.shape[1];r!=null&&(o=r.shape[0],a=r.shape[1]);var i=SC(a),s=new D8({windowSize:i,inSize:a,batchSize:o},e,r==null),u=s.outputShape,l=u[0],c=u[1],h=this.makeOutputArray([l,c],"int32"),d=[t];return r!=null&&d.push(r),this.compileAndRun(s,d,h),h.shape[1]===1?h:this.argReduce(t,e,h)},n.prototype.argReducePacked=function(t,e,r){r===void 0&&(r=null);var o=r!=null?r.shape:t.shape,a=SC(o[o.length-1]),i=new v7(o,a,e,r==null),s=this.makePackedTensor(i.outputShape,"int32"),u=r==null?[t]:[t,r];return this.compileAndRun(i,u,s),s.rank===t.rank?this.argReducePacked(t,e,s):s},n.prototype.sum=function(t,e){la("sum",e,t.rank);var r=co(t.shape,e),o=r[0],a=de(r[1]),i=t.as2D(-1,a),s=yC(t.dtype);return this.reduce(i,"sum",s).reshape(o)},n.prototype.prod=function(t,e){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.prod(t,e);var r=co(t.shape,e),o=r[0],a=de(r[1]),i=t.as2D(-1,a),s=yC(t.dtype);return this.reduce(i,"prod",s).reshape(o)},n.prototype.unsortedSegmentSum=function(t,e,r){var o=0,a=fs([o],t.rank),i=t;a!=null&&(i=t.transpose(a),o=ds(1,t.rank)[0]);var s=l8(i.shape,o,r),u=de([i.shape[o]]),l=i.as2D(-1,u),c=yC(t.dtype),h=this.segOpCompute(l,"unsortedSegmentSum",e,c,r).reshape(s);return a!=null&&(h=h.transpose(fk(a))),h},n.prototype.segOpCompute=function(t,e,r,o,a){var i=t.shape[0],s=t.shape[1],u=u8(s,a),l=new HY({windowSize:u,inSize:s,batchSize:i,numSegments:a},e),c=l.outputShape,h=c[0],d=c[1],p=this.makeOutputArray([h,d],o);return this.compileAndRun(l,[t,r],p),p.shape[1]===a?p:(r=f4(0,a).tile([s/u]),this.segOpCompute(p,e,r,o,a))},n.prototype.argMinMaxReduce=function(t,e,r){var o=[e];if(la("arg"+r.charAt(0).toUpperCase()+r.slice(1),o,t.rank),!Y.get("WEBGL_PACK_REDUCE")||t.rank<=2){var a=co(t.shape,o),i=a[0],s=de(a[1]),u=t.as2D(-1,s);return this.argReduce(u,r).reshape(i)}return this.argReducePacked(t,r)},n.prototype.argMin=function(t,e){return this.argMinMaxReduce(t,e,"min")},n.prototype.argMax=function(t,e){return this.argMinMaxReduce(t,e,"max")},n.prototype.cumsum=function(t,e,r,o){if(e!==t.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(t.rank-1)+" but got axis="+e);var a=new g9(t.shape,r,o);return this.compileAndRun(a,[t])},n.prototype.equal=function(t,e){if(Y.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,V7,"bool");var r=new jn(E7,t.shape,e.shape),o=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[t,e],o)},n.prototype.notEqual=function(t,e){if(Y.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,G7,"bool");var r=new jn(k7,t.shape,e.shape),o=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[t,e],o)},n.prototype.less=function(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.less(t,e);if(Y.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,H7,"bool");var r=new jn(I7,t.shape,e.shape),o=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[t,e],o)},n.prototype.lessEqual=function(t,e){if(Y.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,q7,"bool");var r=new jn(R7,t.shape,e.shape),o=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[t,e],o)},n.prototype.greater=function(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.greater(t,e);if(Y.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,j7,"bool");var r=new jn(T7,t.shape,e.shape),o=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[t,e],o)},n.prototype.greaterEqual=function(t,e){if(Y.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,X7,"bool");var r=new jn(N7,t.shape,e.shape),o=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[t,e],o)},n.prototype.logicalNot=function(t){var e=new Ne(t.shape,PQ);return this.compileAndRun(e,[t])},n.prototype.logicalAnd=function(t,e){if(Y.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,K7,"bool");var r=new jn(A7,t.shape,e.shape),o=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[t,e],o)},n.prototype.logicalOr=function(t,e){if(Y.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,Y7,"bool");var r=new jn(_7,t.shape,e.shape),o=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[t,e],o)},n.prototype.select=function(t,e,r){var o=new qY(t.rank,e.shape,e.rank),a=this.makeOutputArray(o.outputShape,Lr(e.dtype,r.dtype));return this.compileAndRun(o,[t,e,r],a)},n.prototype.where=function(t){zS("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var e=t.dataSync();return wk(t.shape,e)},n.prototype.topk=function(t,e,r){return x4(t.dataSync(),t.shape,t.dtype,e)},n.prototype.min=function(t,e){la("min",e,t.rank);var r=co(t.shape,e),o=r[0],a=de(r[1]),i=t.as2D(-1,a);return this.reduce(i,"min",i.dtype).reshape(o)},n.prototype.minimum=function(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.minimum(t,e);var r=Y.get("WEBGL_PACK_BINARY_OPERATIONS")?new Os(Z7,t.shape,e.shape):new jn($7,t.shape,e.shape);return this.compileAndRun(r,[t,e])},n.prototype.mod=function(t,e){var r=Y.get("WEBGL_PACK_BINARY_OPERATIONS")?new Os(J7,t.shape,e.shape):new jn(O7,t.shape,e.shape);return this.compileAndRun(r,[t,e])},n.prototype.max=function(t,e){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.max(t,e);la("max",e,t.rank);var r=co(t.shape,e),o=r[0],a=de(r[1]),i=t.as2D(-1,a);return this.reduce(i,"max",i.dtype).reshape(o)},n.prototype.maximum=function(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.maximum(t,e);var r=Y.get("WEBGL_PACK_BINARY_OPERATIONS")?new Os(Q7,t.shape,e.shape):new jn(D7,t.shape,e.shape);return this.compileAndRun(r,[t,e])},n.prototype.all=function(t,e){la("all",e,t.rank);var r=co(t.shape,e),o=r[0],a=de(r[1]),i=t.as2D(-1,a);return this.reduce(i,"all",i.dtype).reshape(o)},n.prototype.any=function(t,e){la("any",e,t.rank);var r=co(t.shape,e),o=r[0],a=de(r[1]),i=t.as2D(-1,a);return this.reduce(i,"any",i.dtype).reshape(o)},n.prototype.squaredDifference=function(t,e){var r=Y.get("WEBGL_PACK_BINARY_OPERATIONS")?new Os(M$,t.shape,e.shape):new jn(M$,t.shape,e.shape);return this.compileAndRun(r,[t,e])},n.prototype.realDivide=function(t,e){var r=new jn(w7,t.shape,e.shape),o=this.makeOutputArray(r.outputShape,"float32");return this.compileAndRun(r,[t,e],o)},n.prototype.floorDiv=function(t,e){var r=C7;if(Y.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,P7,"int32");var o=new jn(r,t.shape,e.shape),a=this.makeOutputArray(o.outputShape,"int32");return this.compileAndRun(o,[t,e],a)},n.prototype.add=function(t,e){if(t.dtype==="complex64"&&e.dtype==="complex64")return this.complexSeparableBinaryOp(t,e,EC);if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.add(t,e);var r=Lr(t.dtype,e.dtype);if(Y.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,EC,r);var o=new jn(EC,t.shape,e.shape),a=this.makeOutputArray(o.outputShape,r);return this.compileAndRun(o,[t,e],a)},n.prototype.packedBinaryOp=function(t,e,r,o){var a=new Os(r,t.shape,e.shape),i=this.makePackedTensor(a.outputShape,o);return this.compileAndRun(a,[t,e],i)},n.prototype.complexSeparableBinaryOp=function(t,e,r){var o=this,a=this.texData.get(t.dataId),i=this.texData.get(e.dataId),s=[[a.complexTensors.real,i.complexTensors.real],[a.complexTensors.imag,i.complexTensors.imag]].map(function(h){var d=h[0],p=h[1],g=o.makeComplexComponentTensorHandle(t,d),x=o.makeComplexComponentTensorHandle(e,p),y=new jn(r,t.shape,e.shape),b=o.makeOutputArray(y.outputShape,Lr(d.dtype,p.dtype));return o.compileAndRun(y,[g,x],b)}),u=s[0],l=s[1],c=this.complex(u,l);return u.dispose(),l.dispose(),c},n.prototype.makeComplexComponentTensorHandle=function(t,e){return{dataId:e.dataId,dtype:e.dtype,shape:t.shape}},n.prototype.addN=function(t){for(var e=t[0],r=1;r<t.length;r++)e=this.add(e,t[r]);return e},n.prototype.subtract=function(t,e){if(t.dtype==="complex64"&&e.dtype==="complex64")return this.complexSeparableBinaryOp(t,e,kC);if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.subtract(t,e);var r=Lr(t.dtype,e.dtype);if(Y.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,kC,t.dtype);var o=new jn(kC,t.shape,e.shape),a=this.makeOutputArray(o.outputShape,r);return this.compileAndRun(o,[t,e],a)},n.prototype.pow=function(t,e){var r=Y.get("WEBGL_PACK_BINARY_OPERATIONS"),o=r?new Os(B7,t.shape,e.shape):new jn(S7,t.shape,e.shape),a=Lr(t.dtype,e.dtype),i=r?this.makePackedTensor(o.outputShape,a):this.makeOutputArray(o.outputShape,a);return this.compileAndRun(o,[t,e],i)},n.prototype.ceil=function(t){var e=new Ne(t.shape,lQ);return this.compileAndRun(e,[t])},n.prototype.floor=function(t){var e=new Ne(t.shape,cQ);return this.compileAndRun(e,[t])},n.prototype.sign=function(t){var e=new Ne(t.shape,hQ);return this.compileAndRun(e,[t])},n.prototype.isNaN=function(t){var e=new Ne(t.shape,fQ),r=this.makeOutputArray(e.outputShape,"bool");return this.compileAndRun(e,[t],r)},n.prototype.isInf=function(t){var e=new Ne(t.shape,dQ),r=this.makeOutputArray(e.outputShape,"bool");return this.compileAndRun(e,[t],r)},n.prototype.isFinite=function(t){var e=new Ne(t.shape,pQ),r=this.makeOutputArray(e.outputShape,"bool");return this.compileAndRun(e,[t],r)},n.prototype.round=function(t){var e=new Ne(t.shape,mQ);return this.compileAndRun(e,[t])},n.prototype.exp=function(t){var e;return e=Y.get("WEBGL_PACK")?new AC(t.shape,q$):new Ne(t.shape,q$),this.compileAndRun(e,[t])},n.prototype.expm1=function(t){var e=new Ne(t.shape,gQ);return this.compileAndRun(e,[t])},n.prototype.log=function(t){var e;return e=Y.get("WEBGL_PACK")?new AC(t.shape,UQ):new Ne(t.shape,vQ),this.compileAndRun(e,[t])},n.prototype.log1p=function(t){var e=new Ne(t.shape,xQ);return this.compileAndRun(e,[t])},n.prototype.sqrt=function(t){var e=new Ne(t.shape,yQ);return this.compileAndRun(e,[t])},n.prototype.rsqrt=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.rsqrt(t);var e=new Ne(t.shape,bQ);return this.compileAndRun(e,[t])},n.prototype.square=function(t){var e=new Ne(t.shape,MQ);return this.compileAndRun(e,[t])},n.prototype.reciprocal=function(t){var e=new Ne(t.shape,LQ);return this.compileAndRun(e,[t])},n.prototype.relu=function(t){var e;return e=Y.get("WEBGL_PACK")?new AC(t.shape,$4):new Ne(t.shape,D4),this.compileAndRun(e,[t])},n.prototype.prelu=function(t,e){var r=Y.get("WEBGL_PACK_BINARY_OPERATIONS")?new Os(z7,t.shape,e.shape):new jn(L7,t.shape,e.shape);return this.compileAndRun(r,[t,e])},n.prototype.elu=function(t){var e=new Ne(t.shape,aQ);return this.compileAndRun(e,[t])},n.prototype.eluDer=function(t,e){var r=Y.get("WEBGL_PACK_BINARY_OPERATIONS")?new Os(U7,t.shape,e.shape):new jn(M7,t.shape,e.shape);return this.compileAndRun(r,[t,e])},n.prototype.selu=function(t){var e=new Ne(t.shape,iQ);return this.compileAndRun(e,[t])},n.prototype.int=function(t){var e=new Ne(t.shape,BQ),r=this.makeOutputArray(e.outputShape,"int32");return this.compileAndRun(e,[t],r)},n.prototype.clip=function(t,e,r){var o,a=(o=Y.get("WEBGL_PACK_CLIP")?new e9(t.shape):new t9(t.shape)).getCustomSetupFunc(e,r);return this.compileAndRun(o,[t],null,a)},n.prototype.abs=function(t){var e=new Ne(t.shape,oQ);return this.compileAndRun(e,[t])},n.prototype.complexAbs=function(t){var e=this.texData.get(t.dataId),r=new n9(t.shape),o=[this.makeComplexComponentTensorHandle(t,e.complexTensors.real),this.makeComplexComponentTensorHandle(t,e.complexTensors.imag)];return this.compileAndRun(r,o)},n.prototype.sigmoid=function(t){var e=new Ne(t.shape,wQ);return this.compileAndRun(e,[t])},n.prototype.softplus=function(t){var e=new Ne(t.shape,CQ);return this.compileAndRun(e,[t])},n.prototype.sin=function(t){var e=new Ne(t.shape,SQ);return this.compileAndRun(e,[t])},n.prototype.cos=function(t){var e=new Ne(t.shape,EQ);return this.compileAndRun(e,[t])},n.prototype.tan=function(t){var e=new Ne(t.shape,kQ);return this.compileAndRun(e,[t])},n.prototype.asin=function(t){var e=new Ne(t.shape,IQ);return this.compileAndRun(e,[t])},n.prototype.acos=function(t){var e=new Ne(t.shape,RQ);return this.compileAndRun(e,[t])},n.prototype.atan=function(t){var e=new Ne(t.shape,TQ);return this.compileAndRun(e,[t])},n.prototype.atan2=function(t,e){var r=Y.get("WEBGL_PACK_BINARY_OPERATIONS")?new Os(W7,t.shape,e.shape):new jn(F7,t.shape,e.shape);return this.compileAndRun(r,[t,e])},n.prototype.sinh=function(t){var e=new Ne(t.shape,NQ);return this.compileAndRun(e,[t])},n.prototype.cosh=function(t){var e=new Ne(t.shape,AQ);return this.compileAndRun(e,[t])},n.prototype.tanh=function(t){var e=new Ne(t.shape,_Q);return this.compileAndRun(e,[t])},n.prototype.asinh=function(t){var e=new Ne(t.shape,DQ);return this.compileAndRun(e,[t])},n.prototype.acosh=function(t){var e=new Ne(t.shape,$Q);return this.compileAndRun(e,[t])},n.prototype.atanh=function(t){var e=new Ne(t.shape,OQ);return this.compileAndRun(e,[t])},n.prototype.erf=function(t){var e=new Ne(t.shape,FQ);return this.compileAndRun(e,[t])},n.prototype.step=function(t,e){var r=new Ne(t.shape,sQ(e));return this.compileAndRun(r,[t])},n.prototype.conv2dByMatMul=function(t,e,r){var o=t.shape,a=this.texData.get(t.dataId),i=r.inChannels,s=o[0]*o[1]*o[2],u=r.outChannels,l=(s===1||u===1)&&i>X$,c=o[2]%2!=0&&!!a.isPacked;if(l||!Y.get("WEBGL_LAZILY_UNPACK")||!Y.get("WEBGL_PACK_BINARY_OPERATIONS")||!c){var h=this.reshape(t,[1,o[0]*o[1]*o[2],r.inChannels]),d=this.reshape(e,[1,r.inChannels,r.outChannels]);return this.reshape(this.batchMatMul(h,d,!1,!1),r.outShape)}var p=Gt.make([1,o[0]*o[1]*(o[2]+1),r.inChannels],{dataId:t.dataId},t.dtype,this),g=a.shape;a.shape=a.shape.slice(),a.shape[a.shape.length-2]++,et(Ax(a.shape,p.shape),function(){return"packed reshape "+a.shape+" to "+p.shape+" isn't free"});var x=this.reshape(e,[1,r.inChannels,r.outChannels]),y=this.batchMatMul(p,x,!1,!1),b=this.texData.get(y.dataId);return et(b.isPacked,function(){return"batchMatMul result is expected to be packed"}),a.shape=g,b.shape=r.outShape,Gt.make(r.outShape,{dataId:y.dataId},y.dtype,this)},n.prototype.conv2dWithIm2Row=function(t,e,r){var o=r.filterWidth,a=r.filterHeight,i=r.inChannels,s=r.outWidth,u=r.outHeight,l=o*a*i,c=u*s,h=[l,c],d=t.squeeze([0]),p=e.reshape([1,l,-1]),g=new wY(h,d.shape,r),x=this.compileAndRun(g,[d]).reshape([1,h[0],h[1]]),y=new TC(x.shape,[1,c,r.outChannels],!0,!1);return this.compileAndRun(y,[x,p]).reshape([1,u,s,r.outChannels])},n.prototype.conv2d=function(t,e,r){if(r.filterHeight===1&&r.filterWidth===1&&r.dilationHeight===1&&r.dilationWidth===1&&r.strideHeight===1&&r.strideWidth===1&&(r.padInfo.type==="SAME"||r.padInfo.type==="VALID"))return this.conv2dByMatMul(t,e,r);if(Y.get("WEBGL_CONV_IM2COL")&&t.shape[0]===1)return this.conv2dWithIm2Row(t,e,r);var o=new h9(r);return this.compileAndRun(o,[t,e])},n.prototype.conv2dDerInput=function(t,e,r){var o=new i9(r);return this.compileAndRun(o,[t,e])},n.prototype.conv2dDerFilter=function(t,e,r){var o=new a9(r);return this.compileAndRun(o,[t,e])},n.prototype.depthwiseConv2D=function(t,e,r){var o;return Y.get("WEBGL_PACK_DEPTHWISECONV")&&r.strideWidth<=2&&r.outChannels/r.inChannels==1?(o=new p9(r),this.compileAndRun(o,[t,e],this.makePackedTensor(r.outShape,t.dtype))):(o=new d9(r),this.compileAndRun(o,[t,e]))},n.prototype.depthwiseConv2DDerInput=function(t,e,r){var o=new c9(r);return this.compileAndRun(o,[t,e])},n.prototype.depthwiseConv2DDerFilter=function(t,e,r){var o=new l9(r);return this.compileAndRun(o,[t,e])},n.prototype.conv3d=function(t,e,r){var o=new f9(r);return this.compileAndRun(o,[t,e])},n.prototype.conv3dDerInput=function(t,e,r){var o=new u9(r);return this.compileAndRun(o,[t,e])},n.prototype.conv3dDerFilter=function(t,e,r){var o=new s9(r);return this.compileAndRun(o,[t,e])},n.prototype.maxPool=function(t,e){var r=new NC(e,"max",!1),o=this.makeOutputArray(r.outputShape,t.dtype);return this.compileAndRun(r,[t],o)},n.prototype.avgPool=function(t,e){var r=new NC(e,"avg",!1),o=this.makeOutputArray(r.outputShape,"float32");return this.compileAndRun(r,[t],o)},n.prototype.maxPoolBackprop=function(t,e,r,o){var a=new NC(o,"max",!0),i=this.compileAndRun(a,[e]),s=new EY(o),u=this.makeOutputArray(s.outputShape,e.dtype),l=this.compileAndRun(s,[t,i],u);return i.dispose(),l},n.prototype.avgPoolBackprop=function(t,e,r){var o=new x7(r),a=this.makeOutputArray(o.outputShape,e.dtype);return this.compileAndRun(o,[t],a)},n.prototype.cast=function(t,e){return m4(t,e,this)},n.prototype.unstack=function(t,e){for(var r=t.shape[e],o=new Array(t.rank-1),a=0,i=0;i<t.rank;i++)i!==e&&(o[a++]=t.shape[i]);var s=new Array(t.rank).fill(0),u=t.shape.slice();u[e]=1;var l=new Array(r);for(i=0;i<l.length;i++)s[e]=i,l[i]=this.slice(t,s,u).reshape(o);return l},n.prototype.reshape=function(t,e){var r=this.texData.get(t.dataId);return!r.isPacked||Ax(t.shape,e)||r.texture!==null&&Ax(r.shape,e)?US(t,e):this.packedReshape(t,e)},n.prototype.resizeBilinear=function(t,e,r,o){var a=Y.get("WEBGL_PACK_IMAGE_OPERATIONS")?new zY(t.shape,e,r,o):new BY(t.shape,e,r,o);return this.compileAndRun(a,[t])},n.prototype.resizeBilinearBackprop=function(t,e,r){var o=new PY(t,e,r);return this.compileAndRun(o,[t])},n.prototype.resizeNearestNeighbor=function(t,e,r,o){var a=new WY(t.shape,e,r,o);return this.compileAndRun(a,[t])},n.prototype.resizeNearestNeighborBackprop=function(t,e,r){var o=new UY(t,e,r);return this.compileAndRun(o,[t])},n.prototype.multinomial=function(t,e,r,o){var a=e?t:ml(t),i=a.shape[0],s=a.shape[1],u=new kY(i,s,r),l=this.makeOutputArray(u.outputShape,"int32"),c=u.getCustomSetupFunc(o);return this.compileAndRun(u,[a],l,c)},n.prototype.oneHot=function(t,e,r,o){var a=new IY(t.size,e,r,o);return this.compileAndRun(a,[t])},n.prototype.nonMaxSuppression=function(t,e,r,o,a){return zS("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),mk(t.dataSync(),e.dataSync(),r,o,a)},n.prototype.cropAndResize=function(t,e,r,o,a,i){var s=new m9(t.shape,e.shape,o,a,i);return this.compileAndRun(s,[t,e,r])},n.prototype.depthToSpace=function(t,e,r){et(e>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+e});var o=t.shape[0],a=r==="NHWC"?t.shape[1]:t.shape[2],i=r==="NHWC"?t.shape[2]:t.shape[3],s=r==="NHWC"?t.shape[3]:t.shape[1],u=a*e,l=i*e,c=s/(e*e),h=new x9(r==="NHWC"?[o,u,l,c]:[o,c,u,l],e,r);return this.compileAndRun(h,[t])},n.prototype.split=function(t,e,r){return v4(t,e,r)},n.prototype.scatterND=function(t,e,r){var o=V0(e,t,r),a=o.sliceRank,i=o.numUpdates,s=o.sliceSize,u=o.strides,l=o.outputSize,c=[l/s,s],h=t.reshape([i,a]),d=e.reshape([i,s]);if(l===0)return US(dr([]),r);var p=zt(0),g=new V$(i,a,h.rank,d.rank,u,c);return this.compileAndRun(g,[d,h,p]).reshape(r)},n.prototype.sparseToDense=function(t,e,r,o){var a=V0(e,t,r),i=a.sliceRank,s=a.numUpdates,u=a.strides,l=a.outputSize,c=new V$(s,i,t.rank,e.rank,u,[l,1],!1);return this.compileAndRun(c,[e,t,o]).reshape(r)},n.prototype.fft=function(t){return this.fftImpl(t,!1)},n.prototype.ifft=function(t){return this.fftImpl(t,!0)},n.prototype.fftImpl=function(t,e){var r=this.texData.get(t.dataId),o=new B$(P$.REAL,t.shape,e),a=new B$(P$.IMAG,t.shape,e),i=[this.makeComplexComponentTensorHandle(t,r.complexTensors.real),this.makeComplexComponentTensorHandle(t,r.complexTensors.imag)],s=this.compileAndRun(o,i),u=this.compileAndRun(a,i),l=this.complex(s,u).as2D(t.shape[0],t.shape[1]);return s.dispose(),u.dispose(),l},n.prototype.gatherND=function(t,e){var r=e.shape,o=r[r.length-1],a=u4(t,e),i=a[0],s=a[1],u=a[2],l=a[3],c=e.reshape([s,o]),h=t.reshape([t.size/u,u]),d=new E9(o,l,[s,u]);return this.compileAndRun(d,[h,c]).reshape(i)},n.prototype.fill=function(t,e,r){if((r=r||Sm(e))==="string"){var o=L0(r,de(t));return o.fill(e),Gt.make(t,{values:o},r)}var a=new b9(t,e),i=a.getCustomSetupFunc(e),s=this.makeOutputArray(t,r);return this.compileAndRun(a,[],s,i)},n.prototype.onesLike=function(t){if(t.dtype==="string")throw new Error("onesLike is not supported under string dtype");return this.fill(t.shape,1,t.dtype)},n.prototype.zerosLike=function(t){return this.fill(t.shape,t.dtype==="string"?"":0,t.dtype)},n.prototype.makeOutputArray=function(t,e){return Gt.make(t,{},e,this)},n.prototype.makePackedTensor=function(t,e){var r=Gt.make(t,{},e,this);return this.texData.get(r.dataId).isPacked=!0,r},n.prototype.unpackTensor=function(t){var e=new WQ(t.shape);return this.compileAndRun(e,[t],Gt.make(e.outputShape,{},t.dtype,this))},n.prototype.packTensor=function(t){var e=new RY(t.shape);return this.compileAndRun(e,[t],this.makePackedTensor(t.shape,t.dtype))},n.prototype.packedReshape=function(t,e){var r=t.reshape([nf(t.shape)].concat(rf(t.shape))),o=[nf(e)].concat(rf(e)),a=new FY(o,r.shape);return this.compileAndRun(a,[r]).reshape(e)},n.prototype.compileAndRun=function(t,e,r,o,a){var i=this;if(a===void 0&&(a=!0),r==null&&(r=t.usesPackedTextures?this.makePackedTensor(t.outputShape,e[0].dtype):this.makeOutputArray(t.outputShape,e[0].dtype)),r.size===0)return this.texData.get(r.dataId).values=$S(r.dtype,0),r;var s=e.map(function(E){if(E.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var S=i.texData.get(E.dataId);if(S.texture==null){if(!t.usesPackedTextures&&de(E.shape)<=Y.get("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:E.shape,texData:null,isUniform:!0,uniformValues:i.readSync(E.dataId)};t.usesPackedTextures&&(S.isPacked=!0,S.shape=E.shape)}else if(!!S.isPacked!=!!t.usesPackedTextures)E=S.isPacked?i.unpackTensor(E):i.packTensor(E),S=i.texData.get(E.dataId);else if(S.isPacked&&!Ax(S.shape,E.shape)){var k=E,R=E.shape;E.shape=S.shape,E=i.packedReshape(E,R),S=i.texData.get(E.dataId),k.shape=R}return i.uploadToGPU(E.dataId),{shape:E.shape,texData:S,isUniform:!1}});this.uploadToGPU(r.dataId);var u,l={shape:r.shape,texData:this.texData.get(r.dataId),isUniform:!1},c=bY(t,s,l),h=this.getAndSaveBinary(c,function(){return xY(i.gpgpu,t,s,l)}),d=this.activeTimers!=null;d&&(u=this.startTimer()),yY(this.gpgpu,h,s,l,o);var p=1024*Y.get("WEBGL_NUM_MB_BEFORE_PAGING");if(a&&this.numBytesInGPU>p)for(var g=this.numBytesInGPU-p;g>0&&this.lruDataGPU.length>0;){var x=this.lruDataGPU.shift(),y=this.texData.get(x),b=y.texShape,C=y.dtype;g-=this.computeBytes(b,C),this.read(x)}return d&&(u=this.endTimer(u),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(u)})),Y.get("WEBGL_LAZILY_UNPACK")||!this.texData.get(r.dataId).isPacked||t.isPackShader?r:this.unpackTensor(r)},n.prototype.getAndSaveBinary=function(t,e){return t in this.binaryCache||(this.binaryCache[t]=e()),this.binaryCache[t]},n.prototype.getTextureManager=function(){return this.textureManager},n.prototype.dispose=function(){this.disposed||(this.textureManager.dispose(),this.canvas.remove(),this.fromPixels2DContext!=null&&this.fromPixels2DContext.canvas.remove(),this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},n.prototype.floatPrecision=function(){var t=this;return he(function(){var e=Y.get("DEBUG");Y.set("DEBUG",!1);var r=t.abs(zt(1e-8)).dataSync()[0];return Y.set("DEBUG",e),r>0?32:16})},n.prototype.uploadToGPU=function(t){var e,r=this.texData.get(t),o=r.shape,a=r.dtype,i=r.values,s=r.texture,u=r.usage,l=r.isPacked;if(s==null){var c,h=this.activeTimers!=null;h&&(c=performance.now());var d=Y9(o,l);r.texShape=d;var p=this.acquireTexture(t,d,u,a,l);if(r.texture=p,i!=null){if(l){var g=nf(o),x=1,y=1;o.length&&(x=(e=rf(o))[0],y=e[1]),this.gpgpu.uploadMatrixToPackedTexture(p,g,x,y,d[0],d[1],K$(i))}else this.gpgpu.uploadMatrixToTexture(p,d[0],d[1],K$(i));r.values=null,h&&(this.uploadWaitMs+=performance.now()-c)}}else Y.get("WEBGL_NUM_MB_BEFORE_PAGING")<Number.POSITIVE_INFINITY&&this.lruDataGPU.indexOf(t)>=0&&(this.lruDataGPU.splice(this.lruDataGPU.indexOf(t),1),this.lruDataGPU.push(t))},n.prototype.convertAndCacheOnCPU=function(t,e){var r=this.texData.get(t),o=r.texture,a=r.texShape,i=r.dtype,s=r.usage,u=r.isPacked;return o!=null&&(this.releaseTexture(t,o,a,s,i,u),r.texture=null,r.texShape=null,r.isPacked=!1),r.usage=Hi.UPLOAD,e!=null&&(r.values=YZ(e,i)),r.values},n.prototype.releaseTexture=function(t,e,r,o,a,i){if(Y.get("WEBGL_NUM_MB_BEFORE_PAGING")<Number.POSITIVE_INFINITY){var s=this.lruDataGPU.indexOf(t);s>=0&&this.lruDataGPU.splice(s,1)}this.numBytesInGPU-=this.computeBytes(r,a),this.textureManager.releaseTexture(e,r,o,i)},n.prototype.acquireTexture=function(t,e,r,o,a){return Y.get("WEBGL_NUM_MB_BEFORE_PAGING")<Number.POSITIVE_INFINITY&&this.lruDataGPU.push(t),this.numBytesInGPU+=this.computeBytes(e,o),this.textureManager.acquireTexture(e,r,a)},n.prototype.computeBytes=function(t,e){return t[0]*t[1]*GM(e)},n}();function YZ(n,t){if(t==="float32"||t==="complex64")return n;if(t==="int32"||t==="bool"){for(var e=t==="int32"?new Int32Array(n.length):new Uint8Array(n.length),r=0;r<e.length;++r)e[r]=Math.round(n[r]);return e}throw new Error("Unknown dtype "+t)}function K$(n){return n instanceof Float32Array?n:new Float32Array(n)}function QZ(n){var t=K(n,"x","neg");return Y.engine.runKernel(function(e){return e.neg(t)},{$x:t},function(e){return{$x:function(){return e.neg()}}})}function ZZ(n){var t=K(n,"x","ceil");return Y.engine.runKernel(function(e){return e.ceil(t)},{$x:t},function(e){return{$x:function(){return sn(e)}}})}function JZ(n){var t=K(n,"x","floor");return Y.engine.runKernel(function(e){return e.floor(t)},{$x:t},function(e){return{$x:function(){return sn(e)}}})}function tJ(n){var t=K(n,"x","sign");return Y.engine.runKernel(function(e){return e.sign(t)},{$x:t},function(e){return{$x:function(){return sn(e)}}})}function eJ(n){var t=K(n,"x","isNaN");return Y.engine.runKernel(function(e){return e.isNaN(t)},{$x:t},function(e){return{$x:function(){return sn(e)}}})}function nJ(n){var t=K(n,"x","isInf");return Y.engine.runKernel(function(e){return e.isInf(t)},{$x:t},function(e){return{$x:function(){return sn(e)}}})}function rJ(n){var t=K(n,"x","isFinite");return Y.engine.runKernel(function(e){return e.isFinite(t)},{$x:t},function(e){return{$x:function(){return sn(e)}}})}function oJ(n){var t=K(n,"x","round");return Y.engine.runKernel(function(e){return e.round(t)},{$x:t},function(e){return{$x:function(){return sn(e)}}})}function aJ(n){var t=K(n,"x","exp");return Y.engine.runKernel(function(e,r){var o=e.exp(t);return r([o]),o},{$x:t},function(e,r){return{$x:function(){return e.mulStrict(r[0])}}})}function iJ(n){var t=K(n,"x","expm1");return Y.engine.runKernel(function(e,r){var o=e.expm1(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return e.mul(o.exp())}}})}function sJ(n){var t=K(n,"x","log");return Y.engine.runKernel(function(e,r){var o=e.log(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return e.div(o.toFloat())}}})}function uJ(n){var t=K(n,"x","log1p");return Y.engine.runKernel(function(e,r){var o=e.log1p(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return e.div(o.add(1))}}})}function lJ(n){var t=K(n,"x","sqrt");return Y.engine.runKernel(function(e,r){var o=e.sqrt(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return e.div(o.toFloat().sqrt().mul(2))}}})}function cJ(n){var t=K(n,"x","rsqrt");return Y.engine.runKernel(function(e,r){var o=e.rsqrt(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return e.div(o.pow(1.5).mul(2)).neg()}}})}function hJ(n){var t=K(n,"x","square");return Y.engine.runKernel(function(e,r){return r([t]),e.square(t)},{$x:t},function(e,r){var o=r[0];return{$x:function(){return e.mul(o.toFloat().mul(2))}}})}function fJ(n){var t=K(n,"x","reciprocal");return Y.engine.runKernel(function(e,r){var o=e.reciprocal(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return e.div(o.square().neg())}}})}function dJ(n){var t=K(n,"x","abs");return t.dtype==="complex64"?Y.engine.runKernel(function(e){return e.complexAbs(t)},{$x:t}):Y.engine.runKernel(function(e,r){var o=e.abs(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return e.mul(o.toFloat().step(-1))}}})}function pJ(n,t,e){var r=K(n,"x","clipByValue");return et(t<=e,function(){return"Error in clip: min ("+t+") must be less than or equal to max ("+e+")."}),Y.engine.runKernel(function(o,a){var i=o.clip(r,t,e);return a([r]),i},{$x:r},function(o,a){var i=a[0];return{$x:function(){return o.where(i.greaterEqual(t).logicalAnd(i.lessEqual(e)),sn(o))}}})}function mJ(n){var t=K(n,"x","sigmoid");return Y.engine.runKernel(function(e,r){var o=e.sigmoid(t);return r([o]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return e.mul(o.mul(zt(1).sub(o)))}}})}function gJ(n){var t=K(n,"x","logSigmoid");return Y.engine.runKernel(function(e,r){var o=e.softplus(t.neg()).neg();return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return e.mul(o.neg().sigmoid())}}})}function vJ(n){var t=K(n,"x","softplus");return Y.engine.runKernel(function(e,r){var o=e.softplus(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return e.mul(o.sigmoid())}}})}function xJ(n){var t=K(n,"x","sin");return Y.engine.runKernel(function(e,r){var o=e.sin(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return o.toFloat().cos().mul(e)}}})}function yJ(n){var t=K(n,"x","cos");return Y.engine.runKernel(function(e,r){var o=e.cos(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return o.toFloat().sin().neg().mul(e)}}})}function bJ(n){var t=K(n,"x","tan");return Y.engine.runKernel(function(e,r){var o=e.tan(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return e.div(o.cos().square())}}})}function wJ(n){var t=K(n,"x","asin");return Y.engine.runKernel(function(e,r){var o=e.asin(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return e.divStrict(zt(1).sub(o.toFloat().square()).sqrt())}}})}function CJ(n){var t=K(n,"x","acos");return Y.engine.runKernel(function(e,r){var o=e.acos(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return e.divStrict(zt(1).sub(o.toFloat().square()).sqrt()).neg()}}})}function SJ(n){var t=K(n,"x","atan");return Y.engine.runKernel(function(e,r){var o=e.atan(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return e.div(o.toFloat().square().add(1))}}})}function EJ(n){var t=K(n,"x","sinh");return Y.engine.runKernel(function(e,r){var o=e.sinh(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return o.toFloat().cosh().mulStrict(e)}}})}function kJ(n){var t=K(n,"x","cosh");return Y.engine.runKernel(function(e,r){var o=e.cosh(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return o.toFloat().sinh().mulStrict(e)}}})}function IJ(n){var t=K(n,"x","tanh");return Y.engine.runKernel(function(e,r){var o=e.tanh(t);return r([o]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return zt(1).sub(o.square()).mulStrict(e)}}})}function RJ(n){var t=K(n,"x","asinh");return Y.engine.runKernel(function(e,r){var o=e.asinh(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return e.divStrict(zt(1).add(o.toFloat().square()).sqrt())}}})}function TJ(n){var t=K(n,"x","acosh");return Y.engine.runKernel(function(e,r){var o=e.acosh(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return e.divStrict(o.toFloat().square().sub(1).sqrt())}}})}function NJ(n){var t=K(n,"x","atanh");return Y.engine.runKernel(function(e,r){var o=e.atanh(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return e.div(zt(1).sub(o.toFloat().square()))}}})}function AJ(n){var t=K(n,"x","erf");return et(t.dtype==="int32"||t.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),t.dtype==="int32"&&(t=t.toFloat()),Y.engine.runKernel(function(e,r){var o=e.erf(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return e.mul(o.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}function _J(n,t){t===void 0&&(t=0);var e=K(n,"x","step");return Y.engine.runKernel(function(r){return r.step(e,t)},{$x:e},function(r){return{$x:function(){return sn(r)}}})}Y.get("IS_BROWSER")&&Y.registerBackend("webgl",function(){return new KZ},2);var DJ=lt({abs_:dJ}),$J=lt({acos_:CJ}),OJ=lt({acosh_:TJ}),FJ=lt({asin_:wJ}),MJ=lt({asinh_:RJ}),LJ=lt({atan_:SJ}),PJ=lt({atanh_:NJ}),BJ=lt({ceil_:ZZ}),Ck=lt({clipByValue_:pJ}),zJ=lt({cos_:yJ}),UJ=lt({cosh_:kJ}),WJ=lt({erf_:AJ}),GS=lt({exp_:aJ}),VJ=lt({expm1_:iJ}),GJ=lt({floor_:JZ}),HJ=lt({log_:sJ}),qJ=lt({log1p_:uJ}),jJ=lt({logSigmoid_:gJ}),G0=lt({neg_:QZ}),XJ=lt({reciprocal_:fJ}),KJ=lt({round_:oJ}),z4=lt({rsqrt_:cJ}),U4=lt({sigmoid_:mJ}),YJ=lt({sign_:tJ}),QJ=lt({isNaN_:eJ}),ZJ=lt({isInf_:nJ}),JJ=lt({isFinite_:rJ}),ttt=lt({sin_:xJ}),ett=lt({sinh_:EJ}),ntt=lt({softplus_:vJ}),rtt=lt({sqrt_:lJ}),ott=lt({square_:hJ}),att=lt({step_:_J}),itt=lt({tan_:bJ}),stt=lt({tanh_:IJ});function W4(n,t,e,r,o,a){var i,s,u=K(n,"x","batchNorm"),l=K(t,"mean","batchNorm"),c=K(e,"variance","batchNorm");return o!=null&&(i=K(o,"scale","batchNorm")),r!=null&&(s=K(r,"offset","batchNorm")),et(u.rank===2,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),et(l.rank===2||l.rank===1,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+l.rank+"."}),et(c.rank===2||c.rank===1,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+c.rank+"."}),i!=null&&et(i.rank===2||i.rank===1,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+i.rank+"."}),s!=null&&et(s.rank===2||s.rank===1,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+s.rank+"."}),Dm(u,l,c,s,i,a)}function V4(n,t,e,r,o,a){var i,s,u=K(n,"x","batchNorm"),l=K(t,"mean","batchNorm"),c=K(e,"variance","batchNorm");return o!=null&&(i=K(o,"scale","batchNorm")),r!=null&&(s=K(r,"offset","batchNorm")),et(u.rank===3,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),et(l.rank===3||l.rank===1,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+l.rank+"."}),et(c.rank===3||c.rank===1,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+c.rank+"."}),i!=null&&et(i.rank===3||i.rank===1,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+i.rank+"."}),s!=null&&et(s.rank===3||s.rank===1,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+s.rank+"."}),Dm(u,l,c,s,i,a)}function G4(n,t,e,r,o,a){var i,s,u=K(n,"x","batchNorm"),l=K(t,"mean","batchNorm"),c=K(e,"variance","batchNorm");return o!=null&&(i=K(o,"scale","batchNorm")),r!=null&&(s=K(r,"offset","batchNorm")),et(u.rank===4,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."}),et(l.rank===4||l.rank===1,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+l.rank+"."}),et(c.rank===4||c.rank===1,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+c.rank+"."}),i!=null&&et(i.rank===4||i.rank===1,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+i.rank+"."}),s!=null&&et(s.rank===4||s.rank===1,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+s.rank+"."}),Dm(u,l,c,s,i,a)}function utt(n,t,e,r,o,a){return r===void 0&&(r=.001),Ky(),Dm(n,t,e,a,o,r)}function Dm(n,t,e,r,o,a){a==null&&(a=.001);var i,s,u,l=K(n,"x","batchNorm"),c=K(t,"mean","batchNorm"),h=K(e,"variance","batchNorm");return o!=null&&(i=K(o,"scale","batchNorm")),r!=null&&(s=K(r,"offset","batchNorm")),et(c.rank===h.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),et(s==null||c.rank===s.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),et(i==null||c.rank===i.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),u=l.rank===0||l.rank===1?l.as4D(1,1,1,l.size):l.rank===2?l.as4D(1,1,l.shape[0],l.shape[1]):l.rank===3?l.as4D(1,l.shape[0],l.shape[1],l.shape[2]):l,Y.engine.runKernel(function(d,p){var g=d.batchNormalization(u,Dx(c),Dx(h),a,Dx(i),Dx(s));return p([l,c,h,i]),g},{$x:l,$mean:c,$variance:h,$scale:i,$offset:s},function(d,p){var g=p[0],x=p[1],y=p[2],b=p[3],C=b??zt(1),E=Ar(x.shape,u.shape),S=[];if(x.rank===1){for(var k=0;k<u.shape.length-1;++k)S.push(u.shape[k]);S.push(1)}var R=g.sub(x),A=d.mul(C),N=z4(y.add(zt(a))),_=N.mul(N).mul(N).mul(zt(-.5));return{$x:function(){return x.rank===1?d.mul(mf(N.as4D(1,1,1,x.shape[0]),S)).mul(C).reshape(g.shape):d.mul(N).mul(C).reshape(g.shape)},$mean:function(){var $=N.mul(zt(-1)).mul(A);return x.rank===1&&($=$.sum(E)),$.reshape(x.shape)},$variance:function(){var $=_.mul(R).mul(A);return x.rank===1&&($=$.sum(E)),$.reshape(x.shape)},$scale:function(){var $=R.mul(N),D=d.mul($);return x.rank===1&&(D=D.sum(E)),D.reshape(x.shape)},$offset:function(){var $=d;return x.rank===1&&($=$.sum(E)),$.reshape(x.shape)}}}).reshape(l.shape)}function Dx(n){return n==null?null:n.rank===0?n.as1D():n.rank===1?n:n.rank===2?n.as4D(1,1,n.shape[0],n.shape[1]):n.rank===3?n.as4D(1,n.shape[0],n.shape[1],n.shape[2]):n}function ltt(n,t,e,r,o,a){return r===void 0&&(r=.001),Ky(),W4(n,t,e,a,o,r)}function ctt(n,t,e,r,o,a){return r===void 0&&(r=.001),Ky(),V4(n,t,e,a,o,r)}function htt(n,t,e,r,o,a){return r===void 0&&(r=.001),Ky(),G4(n,t,e,a,o,r)}function Ky(){r4("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var ftt=lt({batchNormalization2d_:ltt}),dtt=lt({batchNormalization3d_:ctt}),ptt=lt({batchNormalization4d_:htt}),mtt=lt({batchNormalization_:utt}),H4=lt({batchNorm_:Dm}),gtt=lt({batchNorm2d_:W4}),vtt=lt({batchNorm3d_:V4}),xtt=lt({batchNorm4d_:G4});function $m(n,t,e,r,o,a,i){i===void 0&&(i="channelsLast");var s,u=H0(t),l=u[0],c=u[1];if(i==="channelsLast")s=[l,c,n[3],n[3]];else{if(i!=="channelsFirst")throw new Error("Unknown dataFormat "+i);s=[l,c,n[1],n[1]]}return Om(n,s,e,r,o,a,!1,i)}function Om(n,t,e,r,o,a,i,s){i===void 0&&(i=!1),s===void 0&&(s="channelsLast");var u=[-1,-1,-1,-1],l=u[0],c=u[1],h=u[2],d=u[3];if(s==="channelsLast")l=n[0],c=n[1],h=n[2],d=n[3];else{if(s!=="channelsFirst")throw new Error("Unknown dataFormat "+s);l=n[0],d=n[1],c=n[2],h=n[3]}var p,g=t[0],x=t[1],y=t[3],b=H0(e),C=b[0],E=b[1],S=H0(r),k=S[0],R=S[1],A=gf(g,k),N=gf(x,R),_=wtt(o,c,h,C,E,A,N,a),$=_.padInfo,D=_.outHeight,O=_.outWidth,P=i?y*d:y;return s==="channelsFirst"?p=[l,P,D,O]:s==="channelsLast"&&(p=[l,D,O,P]),{batchSize:l,dataFormat:s,inHeight:c,inWidth:h,inChannels:d,outHeight:D,outWidth:O,outChannels:P,padInfo:$,strideHeight:C,strideWidth:E,filterHeight:g,filterWidth:x,effectiveFilterHeight:A,effectiveFilterWidth:N,dilationHeight:k,dilationWidth:R,inShape:n,outShape:p,filterShape:t}}function Sk(n,t,e,r,o,a,i){a===void 0&&(a=!1),i===void 0&&(i="channelsLast");var s=[-1,-1,-1,-1,-1],u=s[0],l=s[1],c=s[2],h=s[3],d=s[4];if(i==="channelsLast")u=n[0],l=n[1],c=n[2],h=n[3],d=n[4];else{if(i!=="channelsFirst")throw new Error("Unknown dataFormat "+i);u=n[0],d=n[1],l=n[2],c=n[3],h=n[4]}var p,g=t[0],x=t[1],y=t[2],b=t[4],C=Y$(e),E=C[0],S=C[1],k=C[2],R=Y$(r),A=R[0],N=R[1],_=R[2],$=Ctt(o,l,c,h,E,S,k,gf(g,A),gf(x,N),gf(y,_)),D=$.padInfo,O=$.outDepth,P=$.outHeight,z=$.outWidth,W=a?b*d:b;return i==="channelsFirst"?p=[u,W,O,P,z]:i==="channelsLast"&&(p=[u,O,P,z,W]),{batchSize:u,dataFormat:i,inDepth:l,inHeight:c,inWidth:h,inChannels:d,outDepth:O,outHeight:P,outWidth:z,outChannels:W,padInfo:D,strideDepth:E,strideHeight:S,strideWidth:k,filterDepth:g,filterHeight:x,filterWidth:y,dilationDepth:A,dilationHeight:N,dilationWidth:_,inShape:n,outShape:p,filterShape:t}}function ytt(n,t,e,r,o,a){o==null&&(o=btt(n,t,r));var i=n[0],s=n[1],u=Q$((i-t+2*o)/r+1,a);et(Va(u),function(){return"The output # of rows ("+u+") must be an integer. Change the stride and/or zero pad parameters"});var l=Q$((s-t+2*o)/r+1,a);return et(Va(l),function(){return"The output # of columns ("+l+") must be an integer. Change the stride and/or zero pad parameters"}),[u,l,e]}function btt(n,t,e,r){r===void 0&&(r=1);var o=gf(t,r);return Math.floor((n[0]*(e-1)-e+o)/2)}function H0(n){return typeof n=="number"?[n,n]:n}function Y$(n){return typeof n=="number"?[n,n,n]:n}function gf(n,t){return t<=1?n:n+(n-1)*(t-1)}function wtt(n,t,e,r,o,a,i,s){var u,l,c;if(typeof n=="number"){u={top:n,bottom:n,left:n,right:n,type:n===0?"VALID":"NUMBER"};var h=ytt([t,e,1],a,1,r,n,s);l=h[0],c=h[1]}else if(n==="same"){l=Math.ceil(t/r),c=Math.ceil(e/o);var d=Math.max(0,(l-1)*r+a-t),p=Math.max(0,(c-1)*o+i-e),g=Math.floor(d/2),x=d-g,y=Math.floor(p/2);u={top:g,bottom:x,left:y,right:p-y,type:"SAME"}}else{if(n!=="valid")throw Error("Unknown padding parameter: "+n);u={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((t-a+1)/r),c=Math.ceil((e-i+1)/o)}return{padInfo:u,outHeight:l,outWidth:c}}function Ctt(n,t,e,r,o,a,i,s,u,l){var c,h,d,p;if(n==="same"){var g=((h=Math.ceil(t/o))-1)*o+s-t,x=((d=Math.ceil(e/a))-1)*a+u-e,y=((p=Math.ceil(r/i))-1)*i+l-r,b=Math.floor(g/2),C=g-b,E=Math.floor(x/2),S=x-E,k=Math.floor(y/2);c={top:E,bottom:S,left:k,right:y-k,front:b,back:C,type:"SAME"}}else{if(n!=="valid")throw Error("Unknown padding parameter: "+n);c={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},h=Math.ceil((t-s+1)/o),d=Math.ceil((e-u+1)/a),p=Math.ceil((r-l+1)/i)}return{padInfo:c,outDepth:h,outHeight:d,outWidth:p}}function Q$(n,t){if(!t)return n;switch(t){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error("Unknown roundingMode "+t)}}function q0(n){var t=H0(n),e=t[0],r=t[1];return e===1&&r===1}function gl(n,t){return q0(n)||q0(t)}function Stt(n,t,e,r,o,a,i){o===void 0&&(o="NWC"),a===void 0&&(a=1);var s=K(n,"x","conv1d"),u=K(t,"filter","conv1d"),l=s,c=!1;s.rank===2&&(c=!0,l=s.as3D(1,s.shape[0],s.shape[1])),et(l.rank===3,function(){return"Error in conv1d: input must be rank 3, but got rank "+l.rank+"."}),et(u.rank===3,function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."}),i!=null&&et(Va(r),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."}),et(l.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input ("+l.shape[2]+") must match input depth for filter "+u.shape[1]+"."}),et(gl(e,a),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+e+" and dilation '"+a+"'"}),et(o==="NWC",function(){return"Error in conv1d: got dataFormat of "+o+" but only NWC is currently supported."});var h=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),d=l.as4D(l.shape[0],1,l.shape[1],l.shape[2]),p=nu(d,h,[1,e],r,"NHWC",[1,a],i);return c?p.as2D(p.shape[2],p.shape[3]):p.as3D(p.shape[0],p.shape[2],p.shape[3])}function Ett(n,t,e,r,o,a,i){o===void 0&&(o="NHWC"),a===void 0&&(a=[1,1]);var s=K(n,"x","conv2d"),u=K(t,"filter","conv2d"),l=s,c=!1;s.rank===3&&(c=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),et(l.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank "+l.rank+"."}),et(u.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."}),i!=null&&et(Va(r),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."}),et(l.shape[3]===u.shape[2],function(){return"Error in conv2d: depth of input ("+l.shape[3]+") must match input depth for filter "+u.shape[2]+"."}),et(gl(e,a),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+a+"'"}),et(o==="NHWC",function(){return"Error in conv2d: got dataFormat of "+o+" but only NHWC is currently supported."});var h=Om(l.shape,u.shape,e,a,r,i),d=Y.engine.runKernel(function(p,g){var x=p.conv2d(l,u,h);return g([u,l]),x},{x:l,$filter:u},function(p,g){var x=g,y=x[0],b=x[1];return et(q0(a),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+a+"'"}),{x:function(){return q4(b.shape,p,y,e,r)},$filter:function(){return j4(b,p,y.shape,e,r)}}});return c?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}function q4(n,t,e,r,o,a){et(n.length===t.rank,function(){return"Length of inShape ("+n.length+") and rank of dy ("+t.rank+") must match"});var i=n,s=t,u=!1;t.rank===3&&(u=!0,s=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]),i=[1,n[0],n[1],n[2]]);var l=i[3],c=s.shape[3];et(i.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+i.length+"."}),et(s.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+s.rank}),et(e.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+e.rank}),et(l===e.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+l+") must match input depth for filter "+e.shape[2]+"."}),et(c===e.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+c+") must match output depth for filter "+e.shape[3]+"."}),a!=null&&et(Va(o),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."});var h=Om(i,e.shape,r,1,o,a),d=Y.engine.runKernel(function(p,g){var x=p.conv2dDerInput(s,e,h);return g([e,s]),x},{dy4D:s,filter:e},function(p,g){var x=g[0],y=g[1];return{dy4D:function(){return nu(p,x,r,o,"NHWC",1,a)},filter:function(){return X4(p,y,x.shape,r,o,a)}}});return u?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}function j4(n,t,e,r,o,a){var i=n;n.rank===3&&(i=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var s=t;s.rank===3&&(s=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),et(i.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+i.shape+"."}),et(s.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+s.shape+"."}),et(e.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+e+"."}),et(i.shape[3]===e[2],function(){return"Error in conv2dDerFilter: depth of input "+i.shape[3]+") must match input depth in filter ("+e[2]+"."}),et(s.shape[3]===e[3],function(){return"Error in conv2dDerFilter: depth of dy ("+s.shape[3]+") must match output depth for filter ("+e[3]+")."}),a!=null&&et(Va(o),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."});var u=Om(i.shape,e,r,1,o,a);return Y.engine.runKernel(function(l){return l.conv2dDerFilter(i,s,u)},{x4D:i,dy4D:s})}function ktt(n,t,e,r,o,a){return q4(e,K(n,"x","conv2dTranspose"),K(t,"filter","conv2dTranspose"),r,o,a)}function Itt(n,t,e,r,o,a,i){a===void 0&&(a=[1,1]);var s=K(n,"x","depthwiseConv2d"),u=K(t,"filter","depthwiseConv2d"),l=s,c=!1;s.rank===3&&(c=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),et(l.rank===4,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+l.rank+"."}),et(u.rank===4,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."}),et(l.shape[3]===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+l.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."}),a==null&&(a=[1,1]),et(gl(e,a),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+a+"'"}),i!=null&&et(Va(r),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."});var h=Om(l.shape,u.shape,e,a,r,i,!0),d=Y.engine.runKernel(function(p,g){var x=p.depthwiseConv2D(l,u,h);return g([l,u]),x},{x:l,$filter:u},function(p,g){et(q0(a),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+a+"'"});var x=g[0],y=g[1];return{x:function(){return Att(x.shape,p,y,h)},$filter:function(){return _tt(x,p,y.shape,h)}}});return c?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}function Rtt(n,t,e,r,o,a,i){a===void 0&&(a=[1,1]),i===void 0&&(i="NHWC");var s=K(n,"x","separableConv2d"),u=K(t,"depthwiseFilter","separableConv2d"),l=K(e,"pointwiseFilter","separableConv2d"),c=s,h=!1;if(s.rank===3&&(h=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),i==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");et(c.rank===4,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+c.rank+"."}),et(u.rank===4,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."}),et(l.rank===4,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."}),et(l.shape[0]===1,function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+l.shape[0]+"."}),et(l.shape[1]===1,function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+l.shape[1]+"."});var d=u.shape[2],p=u.shape[3];et(l.shape[2]===d*p,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+d*p+", but got "+l.shape[2]+"."});var g=Ek(c,u,r,o,i,a),x=nu(g,l,1,"valid",i);return h?x.as3D(x.shape[1],x.shape[2],x.shape[3]):x}function Ttt(n){return typeof n=="number"?[n,n,n]:n.length===2?[n[0],n[1],1]:n}function HS(n){var t=Ttt(n),e=t[0],r=t[1],o=t[2];return e===1&&r===1&&o===1}function Ntt(n,t){return HS(n)||HS(t)}function Att(n,t,e,r){var o=t,a=!1;t.rank===3&&(a=!0,o=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var i=Y.engine.runKernel(function(s){return s.depthwiseConv2DDerInput(o,e,r)},{dy4D:o});return a?i.as3D(i.shape[1],i.shape[2],i.shape[3]):i}function _tt(n,t,e,r){var o=n;n.rank===3&&(o=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var a=t;return a.rank===3&&(a=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),Y.engine.runKernel(function(i){return i.depthwiseConv2DDerFilter(o,a,r)},{x4D:o,dy4D:a})}function Dtt(n,t,e,r,o,a){o===void 0&&(o="NHWC"),a===void 0&&(a=[1,1,1]);var i=K(n,"x","conv3d"),s=K(t,"filter","conv3d"),u=i,l=!1;i.rank===4&&(l=!0,u=i.as5D(1,i.shape[0],i.shape[1],i.shape[2],i.shape[3])),et(u.rank===5,function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."}),et(s.rank===5,function(){return"Error in conv3d: filter must be rank 5, but got rank "+s.rank+"."}),et(u.shape[4]===s.shape[3],function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match input depth for filter "+s.shape[3]+"."}),et(Ntt(e,a),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+a+"'"}),et(o==="NHWC",function(){return"Error in conv3d: got dataFormat of "+o+" but only NHWC is currently supported."});var c=Sk(u.shape,s.shape,e,a,r),h=Y.engine.runKernel(function(d,p){var g=d.conv3d(u,s,c);return p([u,s]),g},{x:u,$filter:s},function(d,p){et(HS(a),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+a+"'"});var g=p[0],x=p[1];return{x:function(){return $tt(g.shape,d,x,e,r)},$filter:function(){return Ott(g,d,x.shape,e,r)}}});return l?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}function $tt(n,t,e,r,o){et(n.length===t.rank,function(){return"Length of inShape ("+n.length+") and rank of dy ("+t.rank+") must match"});var a=n,i=t,s=!1;t.rank===4&&(s=!0,i=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]),a=[1,n[0],n[1],n[2],n[3]]);var u=a[4],l=i.shape[4];et(a.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+a.length+"."}),et(i.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+i.rank}),et(e.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+e.rank}),et(u===e.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+u+") must match input depth for filter "+e.shape[3]+"."}),et(l===e.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+l+") must match output depth for filter "+e.shape[4]+"."});var c=Sk(a,e.shape,r,1,o),h=Y.engine.runKernel(function(d){return d.conv3dDerInput(i,e,c)},{dy5D:i});return s?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}function Ott(n,t,e,r,o){var a=n;n.rank===4&&(a=n.as5D(1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]));var i=t;i.rank===4&&(i=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3])),et(a.rank===5,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+a.shape+"."}),et(i.rank===5,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+i.shape+"."}),et(e.length===5,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+e+"."}),et(a.shape[4]===e[3],function(){return"Error in conv3dDerFilter: depth of input "+a.shape[4]+") must match input depth in filter ("+e[3]+"."}),et(i.shape[4]===e[4],function(){return"Error in conv3dDerFilter: depth of dy ("+i.shape[4]+") must match output depth for filter ("+e[4]+")."});var s=Sk(a.shape,e,r,1,o);return Y.engine.runKernel(function(u){return u.conv3dDerFilter(a,i,s)},{x5D:a,dy5D:i})}var Ftt=lt({conv1d_:Stt}),nu=lt({conv2d_:Ett}),Mtt=lt({conv3d_:Dtt}),X4=lt({conv2dDerFilter_:j4}),Ek=lt({depthwiseConv2d_:Itt}),K4=lt({separableConv2d_:Rtt}),Ltt=lt({conv2dTranspose_:ktt});function Ptt(n,t,e,r){var o;e===void 0&&(e=!1),r===void 0&&(r=!1);var a=K(n,"a","matMul"),i=K(t,"b","matMul");o=Nr(a,i),a=o[0],i=o[1];var s=e?a.shape[a.rank-2]:a.shape[a.rank-1],u=r?i.shape[i.rank-1]:i.shape[i.rank-2],l=e?a.shape[a.rank-1]:a.shape[a.rank-2],c=r?i.shape[i.rank-2]:i.shape[i.rank-1],h=a.shape.slice(0,-2),d=i.shape.slice(0,-2),p=de(h),g=de(d);et(a.rank>=2&&i.rank>=2&&a.rank===i.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+a.rank+" and "+i.rank+"."}),et(Ao(h,d),function(){return"Error in matMul: outer dimensions ("+h+") and ("+d+") of Tensors with shapes "+a.shape+" and "+i.shape+" must match."}),et(s===u,function(){return"Error in matMul: inner shapes ("+s+") and ("+u+") of Tensors with shapes "+a.shape+" and "+i.shape+" and transposeA="+e+" and transposeB="+r+" must match."});var x=a.shape.slice(0,-2).concat([l,c]),y=e?a.as3D(p,s,l):a.as3D(p,l,s),b=r?i.as3D(g,c,u):i.as3D(g,u,c);return Y.engine.runKernel(function(C,E){var S=C.batchMatMul(y,b,e,r);return E([y,b]),S},{$a:y,$b:b},function(C,E){var S=E,k=S[0],R=S[1];return e||r?!e&&r?{$a:function(){return C.matMul(R,!1,!1)},$b:function(){return C.matMul(k,!0,!1)}}:e&&!r?{$a:function(){return R.matMul(C,!1,!0)},$b:function(){return k.matMul(C,!1,!1)}}:{$a:function(){return R.matMul(C,!0,!0)},$b:function(){return C.matMul(k,!0,!0)}}:{$a:function(){return C.matMul(R,!1,!0)},$b:function(){return k.matMul(C,!0,!1)}}}).reshape(x)}function Btt(n,t){var e=K(n,"v1","outerProduct"),r=K(t,"v2","outerProduct");return et(e.rank===1&&r.rank===1,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+e.rank+" and "+r.rank+"."}),e.as2D(-1,1).matMul(r.as2D(1,-1))}function ztt(n,t){var e=K(n,"t1","dot"),r=K(t,"t2","dot");et(!(e.rank!==1&&e.rank!==2||r.rank!==1&&r.rank!==2),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+e.rank+" and "+r.rank+"."});var o=e.rank===1?e.size:e.shape[1],a=r.rank===1?r.size:r.shape[0];return et(o===a,function(){return"Error in dot: inner dimensions of inputs must match, but got "+o+" and "+a+"."}),e.rank===1&&r.rank===1?e.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():e.rank===1&&r.rank===2?e.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():e.rank===2&&r.rank===1?e.matMul(r.as2D(-1,1)).as1D():e.matMul(r.as2D(r.shape[0],r.shape[1]))}var kk=lt({matMul_:Ptt}),Utt=lt({dot_:ztt}),Wtt=lt({outerProduct_:Btt});function Vtt(n){var t=K(n,"x","reverse");return et(t.rank===1,function(){return"Error in reverse1D: x must be rank 1 but got rank "+t.rank+"."}),Fm(t,0)}function Gtt(n,t){var e=K(n,"x","reverse");return et(e.rank===2,function(){return"Error in reverse2D: x must be rank 2 but got rank "+e.rank+"."}),Fm(e,t)}function Htt(n,t){var e=K(n,"x","reverse");return et(e.rank===3,function(){return"Error in reverse3D: x must be rank 3 but got rank "+e.rank+"."}),Fm(e,t)}function qtt(n,t){var e=K(n,"x","reverse");return et(e.rank===4,function(){return"Error in reverse4D: x must be rank 4 but got rank "+e.rank+"."}),Fm(e,t)}function jtt(n,t){var e=K(n,"x","reverse");if(e.rank===0)return e.clone();var r=no(t,e.shape);return Y.engine.runKernel(function(o){return o.reverse(e,r)},{$x:e},function(o){return{$x:function(){return o.reverse(r)}}}).reshapeAs(e)}var Fm=lt({reverse_:jtt}),Xtt=lt({reverse1d_:Vtt}),Ktt=lt({reverse2d_:Gtt}),Ytt=lt({reverse3d_:Htt}),Qtt=lt({reverse4d_:qtt});function Y4(n,t,e,r,o,a){var i=K(n,"x","maxPool"),s=i,u=!1;i.rank===3&&(u=!0,s=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),et(s.rank===4,function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."}),et(gl(e,r),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+r+"'"}),a!=null&&et(Va(o),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."});var l=$m(s.shape,t,e,r,o,a),c=Y.engine.runKernel(function(h,d){var p=h.maxPool(s,l);return d([s,p]),p},{x:s},function(h,d){var p=d[0],g=d[1];return{x:function(){return eet(h,p,g,t,e,r,o)}}});return u?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}function Ztt(n,t,e,r,o){return Y4(n,t,e,1,r,o)}function Q4(n,t,e,r,o,a){var i=K(n,"x","avgPool","float32");et(gl(e,r),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+r+"'"});var s=i,u=!1;i.rank===3&&(u=!0,s=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),et(s.rank===4,function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."}),a!=null&&et(Va(o),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."});var l=$m(s.shape,t,e,r,o,a),c=Y.engine.runKernel(function(h){return h.avgPool(s,l)},{x:s},function(h){return{x:function(){return net(h,s,t,e,r,o)}}});return c=c.cast(i.dtype),u?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}function Jtt(n,t,e,r,o){return Q4(n,t,e,1,r,o)}function tet(n,t,e,r,o,a){o==null&&(o=[1,1]),a==null&&(a=1),r===0&&(r="valid");var i=K(n,"x","maxPool"),s=i,u=!1;i.rank===3&&(u=!0,s=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),et(gl(a,o),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+a+" and dilations '"+o+"'"});var l,c=$m(s.shape,t,a,o,r),h=[c.dilationHeight,c.dilationWidth];l=r==="same"?oet([c.filterHeight,c.filterWidth],h):[[0,0],[0,0]];var d=h[0]===1&&h[1]===1,p=ret([c.inHeight,c.inWidth],h,l),g=p[0],x=p[1],y=d?r:"valid",b=d?s:P4(s,h,g),C=(e==="avg"?function(){return Q4(b,t,a,1,y)}:function(){return Y4(b,t,a,1,y)})(),E=d?C:M4(C,h,x);return u?E.as3D(E.shape[1],E.shape[2],E.shape[3]):E}function eet(n,t,e,r,o,a,i,s){var u=K(n,"dy","maxPoolBackprop"),l=K(t,"input","maxPoolBackprop"),c=K(e,"output","maxPoolBackprop");et(l.rank===u.rank,function(){return"Rank of input ("+l.rank+") does not match rank of dy ("+u.rank+")"}),et(gl(o,a),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+a+"'"}),et(u.rank===4,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+u.rank+"."}),et(l.rank===4,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+l.rank+"."});var h=$m(l.shape,r,o,a,i,s);return Y.engine.runKernel(function(d){return d.maxPoolBackprop(u,l,c,h)},{$dy:u,$input:l})}function net(n,t,e,r,o,a){var i=K(n,"dy","avgPoolBackprop"),s=K(t,"input","avgPoolBackprop");et(s.rank===i.rank,function(){return"Rank of input ("+s.rank+") does not match rank of dy ("+i.rank+")"}),et(gl(r,o),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+o+"'"});var u=s,l=i,c=!1;s.rank===3&&(c=!0,u=s.as4D(1,s.shape[0],s.shape[1],s.shape[2]),l=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),et(l.rank===4,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+l.rank+"."}),et(u.rank===4,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+u.rank+"."});var h=$m(u.shape,e,r,o,a),d=Y.engine.runKernel(function(p){return p.avgPoolBackprop(l,u,h)},{dy4D:l,input4D:u});return c?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}function ret(n,t,e){var r=e.map(function(u){return u[0]}),o=e.map(function(u){return u[1]}),a=n.concat(r,o),i=t.map(function(u,l){return(u-a[l]%u)%u}),s=o.map(function(u,l){return u+i[l]});return[t.map(function(u,l){return[r[l],s[l]]}),t.map(function(u,l){return[0,i[l]]})]}function oet(n,t){var e=n.map(function(a,i){return a+(a-1)*(t[i]-1)}).map(function(a){return a-1}),r=e.map(function(a){return Math.floor(a/2)}),o=e.map(function(a,i){return a-r[i]});return e.map(function(a,i){return[r[i],o[i]]})}var $f=lt({maxPool_:Ztt}),Mm=lt({avgPool_:Jtt}),aet=lt({pool_:tet});function iet(n,t,e){var r=K(n,"x","slice1d");return et(r.rank===1,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"}),nl(r,[t],[e])}function set(n,t,e){var r=K(n,"x","slice2d");return et(r.rank===2,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"}),nl(r,t,e)}function uet(n,t,e){var r=K(n,"x","slice3d");return et(r.rank===3,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"}),nl(r,t,e)}function cet(n,t,e){var r=K(n,"x","slice4d");return et(r.rank===4,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"}),nl(r,t,e)}function het(n,t,e){var r,o,a=K(n,"x","slice");if(a.rank===0)throw new Error("Slicing scalar is not possible");r=typeof t=="number"?[t].concat(new Array(a.rank-1).fill(0)):t.length<a.rank?t.concat(new Array(a.rank-t.length).fill(0)):t.slice(),o=(o=e==null?new Array(a.rank).fill(-1):typeof e=="number"?[e].concat(new Array(a.rank-1).fill(-1)):e.length<a.rank?e.concat(new Array(a.rank-e.length).fill(-1)):e).map(function(s,u){return s>=0?s:(et(s===-1,function(){return"Bad value in size"}),a.shape[u]-r[u])}),h8(a,r,o);var i=a.shape;return Y.engine.runKernel(function(s){return s.slice(a,r,o)},{$x:a},function(s){for(var u=[],l=0;l<s.rank;l++)u.push([r[l],i[l]-r[l]-o[l]]);return{$x:function(){return s.pad(u)}}})}var nl=lt({slice_:het}),fet=lt({slice1d_:iet}),det=lt({slice2d_:set}),Z4=lt({slice3d_:uet}),pet=lt({slice4d_:cet});function met(n,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var r=K(n,"x","logSumExp"),o=no(t,r.shape),a=r.max(o,!0),i=r.sub(a).exp().sum(o).log(),s=a.reshape(i.shape).add(i);if(e){var u=Ga(s.shape,o);return s.reshape(u)}return s}function get(n,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var r=K(n,"x","sum");r.dtype==="bool"&&(r=r.toInt());var o=no(t,r.shape);return Im(function(a){var i=fs(o,a.rank),s=o,u=a;i!=null&&(u=a.transpose(i),s=ds(s.length,a.rank));var l=Y.engine.runKernel(function(h){return h.sum(u,s)},{permutedX:u});if(e){var c=Ga(l.shape,o);l=l.reshape(c)}return{value:l,gradFunc:function(h){var d=a.shape.slice();return o.forEach(function(p){d[p]=1}),h.reshape(d).mul(Cc(a.shape,"float32"))}}})(r)}function vet(n,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var r=K(n,"x","prod");r.dtype==="bool"&&(r=r.toInt());var o=no(t,r.shape),a=fs(o,r.rank),i=o,s=r;a!=null&&(s=r.transpose(a),i=ds(i.length,r.rank));var u=Y.engine.runKernel(function(c){return c.prod(s,i)},{permutedX:s});if(e){var l=Ga(u.shape,o);u=u.reshape(l)}return u}function xet(n,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var r=K(n,"x","mean"),o=no(t,r.shape),a=de(co(r.shape,o)[1]);return Im(function(i){var s=zt(a);return{value:(s.dtype===i.dtype?i:i.cast(s.dtype)).div(s).sum(t,e),gradFunc:function(u){var l=i.shape.slice();return o.forEach(function(c){l[c]=1}),u.reshape(l).mul(Cc(i.shape,"float32")).div(a)}}})(r)}function J4(n,t,e,r,o){return t.rank<e.rank&&(t=t.reshape(Ga(t.shape,r))),n.rank<e.rank&&(n=n.reshape(Ga(n.shape,r))),{$x:function(){var a=n.mul(e.equal(t).cast(n.dtype));return o==null?a:a.transpose(o)}}}function yet(n,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var r=K(n,"x","min"),o=r,a=no(t,r.shape),i=a,s=fs(i,r.rank);s!=null&&(r=r.transpose(s),i=ds(i.length,r.rank));var u=Y.engine.runKernel(function(c,h){var d=c.min(r,i);return h([o,d]),d},{$x:r},function(c,h){return J4(c,h[1],h[0],a,s)});if(e){var l=Ga(u.shape,a);u=u.reshape(l)}return u}function bet(n,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var r=K(n,"x","max"),o=r,a=no(t,r.shape),i=a,s=fs(i,r.rank);s!=null&&(r=r.transpose(s),i=ds(i.length,r.rank));var u=Y.engine.runKernel(function(c,h){var d=c.max(r,i);return h([o,d]),d},{$x:r},function(c,h){return J4(c,h[1],h[0],a,s)});if(e){var l=Ga(u.shape,a);u=u.reshape(l)}return u}function wet(n,t){t===void 0&&(t=0);var e=K(n,"x","argMin");t==null&&(t=0);var r=no(t,e.shape),o=fs(r,e.rank);return o!=null&&(e=e.transpose(o),r=ds(r.length,e.rank)),Y.engine.runKernel(function(a,i){var s=a.argMin(e,r[0]);return i([e]),s},{$x:e},function(a,i){var s=i[0];return{$x:function(){return sn(s)}}})}function Cet(n,t){t===void 0&&(t=0);var e=K(n,"x","argMax");t==null&&(t=0);var r=no(t,e.shape),o=fs(r,e.rank);return o!=null&&(e=e.transpose(o),r=ds(r.length,e.rank)),Y.engine.runKernel(function(a,i){var s=a.argMax(e,r[0]);return i([e]),s},{$x:e},function(a,i){var s=i[0];return{$x:function(){return sn(s)}}})}function Eet(n,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var r=K(n,"x","all","bool"),o=no(t,r.shape),a=o,i=fs(a,r.rank);i!=null&&(r=r.transpose(i),a=ds(a.length,r.rank));var s=Y.engine.runKernel(function(l){return l.all(r,a)},{$x:r});if(e){var u=Ga(s.shape,o);return s.reshape(u)}return s}function ket(n,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var r=K(n,"x","any","bool"),o=no(t,r.shape),a=o,i=fs(a,r.rank);i!=null&&(r=r.transpose(i),a=ds(a.length,r.rank));var s=Y.engine.runKernel(function(l){return l.any(r,a)},{$x:r});if(e){var u=Ga(s.shape,o);return s.reshape(u)}return s}function Iet(n,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var r=no(t,(n=K(n,"x","moments")).shape),o=n.mean(r,e),a=o.shape;return e||(a=Ga(o.shape,r)),{mean:o,variance:n.toFloat().sub(o.reshape(a)).square().mean(r,e)}}var Ret=lt({all_:Eet}),Tet=lt({any_:ket}),Net=lt({argMax_:Cet}),Aet=lt({argMin_:wet}),_et=lt({logSumExp_:met}),Yy=lt({max_:bet}),Det=lt({mean_:xet}),$et=lt({min_:yet}),Oet=lt({moments_:Iet}),tL=lt({sum_:get}),Fet=lt({prod_:vet});function Met(n,t){var e,r=K(n,"a","notEqual"),o=K(t,"b","notEqual");return e=Nr(r,o),r=e[0],o=e[1],qe(r.shape,o.shape),Y.engine.runKernel(function(a){return a.notEqual(r,o)},{$a:r,$b:o})}function Let(n,t){var e=K(n,"a","notEqualStrict"),r=K(t,"b","notEqualStrict");return Cn(e.shape,r.shape,"Error in notEqualStrict: "),e.notEqual(r)}function Pet(n,t){var e,r=K(n,"a","less"),o=K(t,"b","less");return e=Nr(r,o),r=e[0],o=e[1],qe(r.shape,o.shape),Y.engine.runKernel(function(a){return a.less(r,o)},{$a:r,$b:o})}function Bet(n,t){var e=K(n,"a","lessStrict"),r=K(t,"b","lessStrict");return Cn(e.shape,r.shape,"Error in lessStrict: "),e.less(r)}function zet(n,t){var e,r=K(n,"a","equal"),o=K(t,"b","equal");return e=Nr(r,o),r=e[0],o=e[1],qe(r.shape,o.shape),Y.engine.runKernel(function(a){return a.equal(r,o)},{$a:r,$b:o})}function Uet(n,t){var e=K(n,"a","equalStrict"),r=K(t,"b","equalStrict");return Cn(e.shape,r.shape,"Error in equalStrict: "),e.equal(r)}function Wet(n,t){var e,r=K(n,"a","lessEqual"),o=K(t,"b","lessEqual");return e=Nr(r,o),r=e[0],o=e[1],qe(r.shape,o.shape),Y.engine.runKernel(function(a){return a.lessEqual(r,o)},{$a:r,$b:o})}function Vet(n,t){var e=K(n,"a","lessEqualStrict"),r=K(t,"b","lessEqualStrict");return Cn(e.shape,r.shape,"Error in lessEqualStrict: "),e.lessEqual(r)}function Get(n,t){var e,r=K(n,"a","greater"),o=K(t,"b","greater");return e=Nr(r,o),r=e[0],o=e[1],qe(r.shape,o.shape),Y.engine.runKernel(function(a){return a.greater(r,o)},{$a:r,$b:o})}function Het(n,t){var e=K(n,"a","greaterStrict"),r=K(t,"b","greaterStrict");return Cn(e.shape,r.shape,"Error in greaterStrict: "),e.greater(r)}function qet(n,t){var e,r=K(n,"a","greaterEqual"),o=K(t,"b","greaterEqual");return e=Nr(r,o),r=e[0],o=e[1],qe(r.shape,o.shape),Y.engine.runKernel(function(a,i){var s=a.greaterEqual(r,o);return i([r,o]),s},{$a:r,$b:o},function(a,i){var s=i[0],u=i[1];return{$a:function(){return sn(s)},$b:function(){return sn(u)}}})}function jet(n,t){var e=K(n,"a","greaterEqualStrict"),r=K(t,"b","greaterEqualStrict");return Cn(e.shape,r.shape,"Error in greaterEqualStrict: "),e.greaterEqual(r)}var eL=lt({equal_:zet}),Xet=lt({equalStrict_:Uet}),Ket=lt({greater_:Get}),nL=lt({greaterEqual_:qet}),Yet=lt({greaterEqualStrict_:jet}),Qet=lt({greaterStrict_:Het}),Zet=lt({less_:Pet}),Jet=lt({lessEqual_:Wet}),tnt=lt({lessEqualStrict_:Vet}),ent=lt({lessStrict_:Bet}),nnt=lt({notEqual_:Met}),rnt=lt({notEqualStrict_:Let});function ont(n,t){var e,r=K(n,"a","add"),o=K(t,"b","add");e=Nr(r,o),r=e[0],o=e[1];var a=qe(r.shape,o.shape);return Y.engine.runKernel(function(i){return i.add(r,o)},{$a:r,$b:o},function(i){return{$a:function(){var s=i,u=Ar(r.shape,a);return u.length>0&&(s=s.sum(u)),s.reshape(r.shape)},$b:function(){var s=i,u=Ar(o.shape,a);return u.length>0&&(s=s.sum(u)),s.reshape(o.shape)}}})}function ant(n){et(Array.isArray(n),function(){return"The argument passed to tf.addN() must be a list of tensors"}),et(n.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+n.length});var t=n.map(function(o,a){return K(o,"tensors"+a,"addN")}),e=t[0];t.forEach(function(o){if(o.dtype!==e.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),t.forEach(function(o){if(!Ao(o.shape,e.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var r=t;return Y.engine.runKernel(function(o){return o.addN(t)},r,function(o){var a={};return t.forEach(function(i,s){a[s]=function(){return o.clone()}}),a})}function int(n,t){var e=K(n,"a","addStrict"),r=K(t,"b","addStrict");return Cn(e.shape,r.shape,"Error in addStrict: "),e.add(r)}function snt(n,t){var e,r=K(n,"a","sub"),o=K(t,"b","sub");e=Nr(r,o),r=e[0],o=e[1];var a=qe(r.shape,o.shape);return Y.engine.runKernel(function(i){return i.subtract(r,o)},{$a:r,$b:o},function(i){return{$a:function(){var s=i,u=Ar(r.shape,a);return u.length>0&&(s=s.sum(u)),s.reshape(r.shape)},$b:function(){var s=i,u=Ar(o.shape,a);return u.length>0&&(s=s.sum(u)),s.neg().reshape(o.shape)}}})}function unt(n,t){var e=K(n,"a","subStrict"),r=K(t,"b","subStrict");return Cn(e.shape,r.shape,"Error in subStrict: "),e.sub(r)}function lnt(n,t){var e=K(n,"base","pow"),r=K(t,"exp","pow"),o=qe(e.shape,r.shape);return n=e.cast(Lr(e.dtype,r.dtype)),t=r.cast(Lr(e.dtype,r.dtype)),Y.engine.runKernel(function(a,i){var s=a.pow(e,r);return i([e,r,s]),s},{$base:e,$exp:r},function(a,i){var s=i[0],u=i[1],l=i[2];return{$base:function(){var c=u.toFloat(),h=a.mul(c.mul(s.pow(c.sub(zt(1))))),d=Ar(s.shape,o);return d.length>0&&(h=h.sum(d)),h.reshape(s.shape)},$exp:function(){var c=s.greater(0),h=s.log().where(c,sn(s)),d=a.mul(l.mul(h)),p=Ar(u.shape,o);return p.length>0&&(d=d.sum(p)),d.reshape(u.shape)}}})}function cnt(n,t){return Cn(n.shape,t.shape,"Error in powStrict: "),n.pow(t)}function hnt(n,t){var e,r=K(n,"a","mul"),o=K(t,"b","mul");e=Nr(r,o),r=e[0],o=e[1];var a=qe(r.shape,o.shape);return Y.engine.runKernel(function(i,s){var u=i.multiply(r,o);return s([r,o]),u},{$a:r,$b:o},function(i,s){var u=s[0],l=s[1];return{$a:function(){var c=i.mul(l.toFloat()),h=Ar(u.shape,a);return h.length>0?c.sum(h).reshape(u.shape):c},$b:function(){var c=i.mul(u.toFloat()),h=Ar(l.shape,a);return h.length>0?c.sum(h).reshape(l.shape):c}}})}function fnt(n,t){var e=K(n,"a","mul"),r=K(t,"b","mul");return Cn(e.shape,r.shape,"Error in multiplyStrict: "),e.mul(r)}function dnt(n,t){var e,r=K(n,"a","div"),o=K(t,"b","div");if(e=Nr(r,o),r=e[0],o=e[1],r.dtype==="int32"&&o.dtype==="int32")return rL(r,o);var a=qe(r.shape,o.shape);return Y.engine.runKernel(function(i,s){var u=i.realDivide(r,o);return s([r,o]),u},{$a:r,$b:o},function(i,s){var u=s[0],l=s[1];return{$a:function(){var c=i.div(l.toFloat()),h=Ar(u.shape,a);return h.length>0?c.sum(h).reshape(u.shape):c},$b:function(){var c=i.mul(u.toFloat()),h=Ar(l.shape,a);h.length>0&&(c=c.sum(h).reshape(l.shape));var d=l.square();return c.div(d.toFloat()).neg()}}})}function pnt(n,t){var e,r=K(n,"a","floorDiv"),o=K(t,"b","floorDiv");e=Nr(r,o),r=e[0],o=e[1];var a=qe(r.shape,o.shape);return Y.engine.runKernel(function(i,s){var u=i.floorDiv(r,o);return s([r,o]),u},{$a:r,$b:o},function(i,s){var u=s[0],l=s[1];return{$a:function(){var c=i.div(l.toFloat()),h=Ar(u.shape,a);return h.length>0?c.sum(h).reshape(u.shape):c},$b:function(){var c=i.mul(u.toFloat()),h=Ar(l.shape,a);h.length>0&&(c=c.sum(h).reshape(l.shape));var d=l.square();return c.div(d.toFloat()).neg()}}})}function mnt(n,t){var e=K(n,"a","div"),r=K(t,"b","div");return Cn(e.shape,r.shape,"Error in divideStrict: "),e.div(r)}function gnt(n,t){var e,r=K(n,"a","mod"),o=K(t,"b","mod");e=Nr(r,o),r=e[0],o=e[1];var a=qe(r.shape,o.shape);return Y.engine.runKernel(function(i,s){var u=i.mod(r,o);return s([r,o]),u},{$a:r,$b:o},function(i,s){var u=s[0],l=s[1];return{$a:function(){var c=Ar(u.shape,a);return c.length>0?i.sum(c).reshape(u.shape):i},$b:function(){var c=i.mul(u.div(l).floor().neg()),h=Ar(l.shape,a);return h.length>0?c.sum(h).reshape(l.shape):c}}})}function vnt(n,t){var e=K(n,"a","modStrict"),r=K(t,"b","modStrict");return Cn(e.shape,r.shape,"Error in modStrict: "),e.mod(r)}function xnt(n,t){var e,r=K(n,"a","minimum"),o=K(t,"b","minimum");return e=Nr(r,o),r=e[0],o=e[1],r.dtype==="bool"&&(r=r.toInt(),o=o.toInt()),qe(r.shape,o.shape),Y.engine.runKernel(function(a,i){var s=a.minimum(r,o);return i([r,o]),s},{$a:r,$b:o},function(a,i){var s=i[0],u=i[1];return{$a:function(){return a.mul(s.lessEqual(u).toFloat())},$b:function(){return a.mul(s.greater(u).toFloat())}}})}function ynt(n,t){var e=K(n,"a","minimumStrict"),r=K(t,"b","minimumStrict");return Cn(e.shape,r.shape,"Error in minimumStrict: "),e.minimum(r)}function bnt(n,t){var e,r=K(n,"a","maximum"),o=K(t,"b","maximum");return e=Nr(r,o),r=e[0],o=e[1],r.dtype==="bool"&&(r=r.toInt(),o=o.toInt()),qe(r.shape,o.shape),Y.engine.runKernel(function(a,i){var s=a.maximum(r,o);return i([r,o]),s},{$a:r,$b:o},function(a,i){var s=i[0],u=i[1];return{$a:function(){return a.mul(s.greaterEqual(u).toFloat())},$b:function(){return a.mul(s.less(u).toFloat())}}})}function wnt(n,t){var e=K(n,"a","maximumStrict"),r=K(t,"b","maximumStrict");return Cn(e.shape,r.shape,"Error in maximumStrict: "),e.maximum(r)}function Cnt(n,t){var e,r=K(n,"a","squaredDifference"),o=K(t,"b","squaredDifference");return e=Nr(r,o),r=e[0],o=e[1],qe(r.shape,o.shape),Y.engine.runKernel(function(a,i){var s=a.squaredDifference(r,o);return i([r,o]),s},{$a:r,$b:o},function(a,i){var s=i[0],u=i[1],l=zt(2);return{$a:function(){return a.mul(s.sub(u).mul(l))},$b:function(){return a.mul(u.sub(s).mul(l))}}})}function Snt(n,t){var e=K(n,"a","squaredDifferenceStrict"),r=K(t,"b","squaredDifferenceStrict");return Cn(e.shape,r.shape,"Error in squaredDifferenceStrict: "),e.squaredDifference(r)}function Ent(n,t){var e,r=K(n,"a","atan2"),o=K(t,"b","atan2");e=Nr(r,o),r=e[0],o=e[1];var a=qe(r.shape,o.shape);return Y.engine.runKernel(function(i,s){var u=i.atan2(r,o);return s([r,o]),u},{$a:r,$b:o},function(i,s){var u=s[0],l=s[1];return{$a:function(){var c=on(u.square(),l.square()),h=i.mul(l.div(c)),d=Ar(u.shape,a);return d.length>0&&(h=h.sum(d)),h.reshape(u.shape)},$b:function(){var c=on(u.square(),l.square()),h=G0(i.mul(u.div(c))),d=Ar(l.shape,a);return d.length>0&&(h=h.sum(d)),h.reshape(l.shape)}}})}var on=lt({add_:ont}),knt=lt({addN_:ant}),Int=lt({addStrict_:int}),Rnt=lt({atan2_:Ent}),Ms=lt({div_:dnt}),Tnt=lt({divStrict_:mnt}),rL=lt({floorDiv_:pnt}),Ik=lt({maximum_:bnt}),Nnt=lt({maximumStrict_:wnt}),oL=lt({minimum_:xnt}),Ant=lt({minimumStrict_:ynt}),_nt=lt({mod_:gnt}),Dnt=lt({modStrict_:vnt}),Ws=lt({mul_:hnt}),$nt=lt({mulStrict_:fnt}),aL=lt({pow_:lnt}),Ont=lt({powStrict_:cnt}),Fnt=lt({squaredDifference_:Cnt}),Mnt=lt({squaredDifferenceStrict_:Snt}),es=lt({sub_:snt}),Lnt=lt({subStrict_:unt});function Pnt(n){var t=K(n,"x","logicalNot","bool");return Y.engine.runKernel(function(e){return e.logicalNot(t)},{$x:t})}function Bnt(n,t){var e=K(n,"a","logicalAnd","bool"),r=K(t,"b","logicalAnd","bool");return qe(e.shape,r.shape),Y.engine.runKernel(function(o){return o.logicalAnd(e,r)},{$a:e,$b:r})}function znt(n,t){var e=K(n,"a","logicalOr","bool"),r=K(t,"b","logicalOr","bool");return qe(e.shape,r.shape),Y.engine.runKernel(function(o){return o.logicalOr(e,r)},{$a:e,$b:r})}function Unt(n,t){var e=K(n,"a","logicalXor","bool"),r=K(t,"b","logicalXor","bool");return qe(e.shape,r.shape),iL(n,t).logicalAnd(Rk(n,t).logicalNot())}function Wnt(n,t,e){var r=K(t,"a","where"),o=K(e,"b","where"),a=K(n,"condition","where","bool");return Cn(r.shape,o.shape,"Error in where: "),a.rank===1?et(a.shape[0]===r.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):Cn(a.shape,o.shape,"Error in where: "),Y.engine.runKernel(function(i,s){var u=i.select(a,r,o);return s([a]),u},{$condition:a,$a:r,$b:o},function(i,s){var u=s[0];return{$condition:function(){return sn(u).toFloat()},$a:function(){return i.mul(u.cast(i.dtype))},$b:function(){return i.mul(u.logicalNot().cast(i.dtype))}}})}function Vnt(n){return bn(this,void 0,void 0,function(){var t,e,r;return wn(this,function(o){switch(o.label){case 0:return[4,(t=K(n,"condition","whereAsync","bool")).data()];case 1:return e=o.sent(),r=wk(t.shape,e),n!==t&&t.dispose(),[2,r]}})})}var Rk=lt({logicalAnd_:Bnt}),Gnt=lt({logicalNot_:Pnt}),iL=lt({logicalOr_:znt}),Hnt=lt({logicalXor_:Unt}),em=lt({where_:Wnt}),qnt=Vnt;function jnt(n){var t=K(n,"x","relu");return t.dtype==="bool"?t.toInt():Y.engine.runKernel(function(e,r){var o=e.relu(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return e.mulStrict(o.step().toFloat())}}})}function Xnt(n){var t=K(n,"x","elu");return Y.engine.runKernel(function(e,r){var o=e.elu(t);return r([o]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return Y.engine.runKernel(function(a){return a.eluDer(e,o)},{dy:e,y:o})}}})}function Knt(n){var t=K(n,"x","selu");return Y.engine.runKernel(function(e,r){var o=e.selu(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){var a=o.greater(zt(0)),i=zt(xk),s=zt(yk),u=e.mul(s),l=e.mul(i).mul(o.toFloat().exp());return em(a,u,l)}}})}function Ynt(n,t){t===void 0&&(t=.2);var e=K(n,"x","leakyRelu");return Ik(zt(t).mul(e),e)}function Qnt(n,t){var e=K(n,"x","prelu"),r=K(t,"alpha","prelu");return Y.engine.runKernel(function(o,a){var i=o.prelu(e,r);return a([e,r]),i},{$x:e,$alpha:r},function(o,a){var i=a[0],s=a[1],u=i.greater(0);return{$x:function(){return em(u,o,o.mul(s))},$alpha:function(){var l=em(u,sn(o),o.mul(i)),c=Ar(s.shape,o.shape);return c.length>0&&(l=l.sum(c)),l.reshape(s.shape)}}})}var Znt=lt({elu_:Xnt}),Jnt=lt({leakyRelu_:Ynt}),trt=lt({prelu_:Qnt}),mr=lt({relu_:jnt}),ert=lt({selu_:Knt});function nrt(n,t){var e=K(n,"x","transpose");return t==null&&(t=e.shape.map(function(r,o){return o}).reverse()),et(e.rank===t.length,function(){return"Error in transpose: rank of input "+e.rank+" must match length of perm "+t+"."}),t.forEach(function(r){et(r>=0&&r<e.rank,function(){return"All entries in 'perm' must be between 0 and "+(e.rank-1)+" but got "+t})}),e.rank<=1?e.clone():Y.engine.runKernel(function(r){return r.transpose(e,t)},{$x:e},function(r){var o=fk(t);return{$x:function(){return r.transpose(o)}}})}var rl=lt({transpose_:nrt});function rrt(n,t,e,r,o){t===void 0&&(t=5),e===void 0&&(e=1),r===void 0&&(r=1),o===void 0&&(o=.5);var a=K(n,"x","localResponseNormalization");et(a.rank===4||a.rank===3,function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `+a.rank+"."}),et(Va(t),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+t+"."});var i=a,s=!1;a.rank===3&&(s=!0,i=a.as4D(1,a.shape[0],a.shape[1],a.shape[2]));var u=Y.engine.runKernel(function(l,c){var h=l.localResponseNormalization4D(i,t,e,r,o);return c([i,h]),h},{x4D:i},function(l,c){var h=c[0],d=c[1];return{x4D:function(){return Y.engine.runKernel(function(p){return p.LRNGrad(l,h,d,t,e,r,o)},{})}}});return s?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}var ort=lt({localResponseNormalization_:rrt});function art(n,t,e,r){t===void 0&&(t="euclidean"),e===void 0&&(e=null),r===void 0&&(r=!1);var o=sL(n=K(n,"x","norm"),t,e),a=o.shape;if(r){var i=no(e,n.shape);a=Ga(o.shape,i)}return o.reshape(a)}function sL(n,t,e){if(e===void 0&&(e=null),n.rank===0)return n.abs();if(n.rank!==1&&e===null)return sL(n.reshape([-1]),t,e);if(n.rank===1||typeof e=="number"||Array.isArray(e)&&e.length===1){if(t===1)return n.abs().sum(e);if(t===1/0)return n.abs().max(e);if(t===-1/0)return n.abs().min(e);if(t==="euclidean"||t===2)return n.abs().pow(zt(2,"int32")).sum(e).sqrt();throw new Error("Error in norm: invalid ord value: "+t)}if(Array.isArray(e)&&e.length===2){if(t===1)return n.abs().sum(e[0]).max(e[1]-1);if(t===1/0)return n.abs().sum(e[1]).max(e[0]);if(t===-1/0)return n.abs().sum(e[1]).min(e[0]);if(t==="fro"||t==="euclidean")return n.square().sum(e).sqrt();throw new Error("Error in norm: invalid ord value: "+t)}throw new Error("Error in norm: invalid axis: "+e)}var uL=lt({norm_:art});function irt(n,t,e){var r=K(n,"x","unsortedSegmentSum"),o=K(t,"segmentIds","unsortedSegmentSum","int32");return et(Va(e),function(){return"numSegments must be of dtype int"}),Y.engine.runKernel(function(a,i){var s=a.unsortedSegmentSum(r,o,e);return i([o]),s},{$x:r},function(a,i){var s=i[0];return{$x:function(){return urt(a,s)}}})}function srt(n,t,e){e===void 0&&(e=0);var r=K(n,"x","gather"),o=K(t,"indices","gather","int32");e=no(e,r.shape)[0];var a=c8(r,o,e);return Y.engine.runKernel(function(i,s){var u=i.gather(r,o.flatten(),e);return s([o]),u},{$x:r},function(i,s){var u=s[0];return{$x:function(){var l=r.shape,c=u.size,h=l.slice(0,e),d=h.length,p=l.slice(e,l.length).slice(1),g=p.length,x=Z$(0,d),y=Z$(d+1,d+1+g),b=J$([h,[c],p]),C=i.reshape(b),E=u.reshape([c]),S=J$([[d],x,y]),k=C.transpose(S),R=cL(k,E,r.shape[e]),A=fk(S);return R=R.transpose(A)}}}).reshape(a.outputShape)}function Z$(n,t){for(var e=[],r=n;r<t;++r)e.push(r);return e}function J$(n){for(var t=[],e=0;e<n.length;++e)for(var r=0;r<n[e].length;++r)t.push(n[e][r]);return t}function urt(n,t){for(var e=Ik(t,sn(t)),r=lL(n,e),o=nL(t,zt(0,"int32")),a=r.rank-o.rank,i=0;i<a;++i)o=La(o,i+1);o=Rk(o,Cc(r.shape,"bool"));var s=sn(r);return em(o,r,s)}var lL=lt({gather_:srt}),cL=lt({unsortedSegmentSum_:irt});function lrt(n,t,e,r){for(var o=K(t,"data","multiRNNCell"),a=B0(e,"c","multiRNNCell"),i=B0(r,"h","multiRNNCell"),s=o,u=[],l=0;l<n.length;l++){var c=n[l](s,a[l],i[l]);u.push(c[0]),u.push(c[1]),s=c[1]}var h=[],d=[];for(l=0;l<u.length;l+=2)h.push(u[l]),d.push(u[l+1]);return[h,d]}function crt(n,t,e,r,o,a){var i=K(n,"forgetBias","basicLSTMCell"),s=K(t,"lstmKernel","basicLSTMCell"),u=K(e,"lstmBias","basicLSTMCell"),l=K(r,"data","basicLSTMCell"),c=K(o,"c","basicLSTMCell"),h=K(a,"h","basicLSTMCell"),d=l.concat(h,1).matMul(s).add(u),p=d.shape[0],g=d.shape[1]/4,x=[p,g],y=d.slice([0,0],x),b=d.slice([0,g],x),C=d.slice([0,2*g],x),E=d.slice([0,3*g],x),S=y.sigmoid().mulStrict(b.tanh()).addStrict(c.mulStrict(i.add(C).sigmoid()));return[S,S.tanh().mulStrict(E.sigmoid())]}var hrt=lt({basicLSTMCell_:crt}),frt=lt({multiRNNCell_:lrt});function drt(n,t,e,r,o){o===void 0&&(o=!0);var a=K(n,"v","movingAverage"),i=K(t,"x","movingAverage"),s=K(e,"decay","movingAverage");FK(a,i),et(Ao(a.shape,i.shape),function(){return"Shape mismatch in v and x"});var u=zt(1),l=u.sub(s),c=i.sub(a).mul(l);if(o){et(r!=null,function(){return"When using zeroDebias: true, step is required."});var h=K(r,"step","movingAverage");c=c.div(u.sub(aL(s,h)))}return a.add(c)}var prt=lt({movingAverage_:drt});function mrt(n,t,e,r,o,a,i,s,u){if(o===void 0&&(o=0),a===void 0&&(a=0),i===void 0&&(i=0),s===void 0&&(s=0),u===void 0&&(u=0),i!==0)throw new Error("ellipsis mask is not yet supported");if(s!==0)throw new Error("new axis mask is not yet supported");var l=K(n,"x","stridedSlice");if(r.every(function(x){return x===1})){var c=dk(l.shape,t,e,r,o,a,i,s,u),h=c[0],d=c[1],p=c[2],g=d.filter(function(x,y){return p.indexOf(y)===-1});return nl(l,h,d).reshape(g)}return Y.engine.runKernel(function(x){return x.stridedSlice(l,t,e,r,o,a,i,s,u)},{$x:l})}var grt=lt({stridedSlice_:mrt});function vrt(n,t,e){t===void 0&&(t=1),e===void 0&&(e=!0);var r=K(n,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var o=r.shape[r.shape.length-1];if(t>o)throw new Error("'k' passed to topk() must be <= the last dimension ("+o+") but got "+t);var a=Y.engine.runKernel(function(i){return i.topk(r,t,e)},{$x:r});return{values:a[0],indices:a[1]}}var xrt=lt({topk_:vrt});function yrt(n,t,e){var r=K(n,"indices","scatterND","int32"),o=K(t,"updates","scatterND");return s8(o,r,e),Y.engine.runKernel(function(a){return a.scatterND(r,o,e)},{$indices:r,$updates:o})}var brt=lt({scatterND_:yrt});function wrt(n){et(n.dtype==="complex64",function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+n.dtype+"."});var t=n.shape[n.shape.length-1],e=n.size/t,r=n.as2D(e,t);return Y.engine.runKernel(function(o){return o.fft(r)},{input:n}).reshape(n.shape)}function Crt(n){et(n.dtype==="complex64",function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+n.dtype+"."});var t=n.shape[n.shape.length-1],e=n.size/t,r=n.as2D(e,t);return Y.engine.runKernel(function(o){return o.ifft(r)},{input:n}).reshape(n.shape)}function Srt(n){et(n.dtype==="float32",function(){return"The dtype for rfft() must be real value but got "+n.dtype});var t=n.shape[n.shape.length-1],e=n.size/t,r=n.zerosLike(),o=ko(n,r).as2D(e,t),a=Tk(o),i=Math.floor(t/2)+1,s=Gi(a),u=Vu(a),l=s.split([i,t-i],s.shape.length-1),c=u.split([i,t-i],u.shape.length-1),h=n.shape.slice();return h[n.shape.length-1]=i,ko(l[0],c[0]).reshape(h)}function Ert(n){var t=n.shape[n.shape.length-1],e=n.size/t;if(t<=2){var r=n.as2D(e,t),o=j0(r);return Gi(o)}var a=[e,2*(t-1)],i=Gi(n).as2D(e,t),s=Vu(n).as2D(e,t),u=i.slice([0,1],[e,t-2]).reverse(1),l=s.slice([0,1],[e,t-2]).reverse(1).mul(zt(-1)),c=i.concat(u,1),h=s.concat(l,1);return r=ko(c,h).as2D(a[0],a[1]),o=j0(r),Gi(o)}var Tk=lt({fft_:wrt}),j0=lt({ifft_:Crt}),hL=lt({rfft_:Srt}),fL=lt({irfft_:Ert}),krt=Object.freeze({fft:Tk,ifft:j0,rfft:hL,irfft:fL});function Irt(n,t,e,r){if(n.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+n.dtype+".");if(n.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+n.shape+".");var o=n.rank>0?n.shape[0]:1,a=n.rank>1?n.shape[1]:1;if(e.length!==a)throw new Error("outputShape has incorrect number of elements:, "+e.length+", should be: "+a+".");var i=t.size;if(t.rank!==0&&(t.rank!==1||i!==o))throw new Error("sparseValues has incorrect shape "+t.shape+", should be [] or ["+o+"]");if(t.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}function Rrt(n,t,e,r){r===void 0&&(r=0);var o=K(n,"sparseIndices","sparseToDense","int32"),a=K(t,"sparseValues","sparseToDense"),i=K(r,"defaultValue","sparseToDense",a.dtype);return Irt(o,a,e,i),Y.engine.runKernel(function(s){return s.sparseToDense(o,a,e,i)},{$sparseIndices:o,$sparseValues:a,$defaultValue:i})}var Trt=lt({sparseToDense_:Rrt});function Nrt(n,t){var e=K(t,"indices","gatherND","int32"),r=K(n,"x","gatherND");return Y.engine.runKernel(function(o){return o.gatherND(r,e)},{$x:r,$indices:e})}var mo,Art=lt({gatherND_:Nrt});function _rt(n,t,e){e===void 0&&(e=mo.SUM_BY_NONZERO_WEIGHTS);var r=K(n,"losses","computeWeightedLoss"),o=null;t!=null&&(o=K(t,"weights","computeWeightedLoss"));var a=o==null?r:r.mul(o);if(e===mo.NONE)return a;if(e===mo.SUM)return a.sum();if(e===mo.MEAN){if(o==null)return a.mean();var i=r.size/o.size,s=a.sum().div(o.sum());return i>1?s.div(zt(i)):s}if(e===mo.SUM_BY_NONZERO_WEIGHTS){if(o==null)return a.sum().div(zt(r.size));var u=o.mul(Cc(r.shape)).notEqual(zt(0)).sum().toFloat();return a.sum().div(u)}throw Error("Unknown reduction: "+e)}function Drt(n,t,e,r){r===void 0&&(r=mo.SUM_BY_NONZERO_WEIGHTS);var o=K(n,"labels","absoluteDifference"),a=K(t,"predictions","absoluteDifference"),i=null;e!=null&&(i=K(e,"weights","absoluteDifference")),Cn(o.shape,a.shape,"Error in absoluteDifference: ");var s=o.sub(a).abs();return ru(s,i,r)}function $rt(n,t,e,r){r===void 0&&(r=mo.SUM_BY_NONZERO_WEIGHTS);var o=K(n,"labels","meanSquaredError"),a=K(t,"predictions","meanSquaredError"),i=null;e!=null&&(i=K(e,"weights","meanSquaredError")),Cn(o.shape,a.shape,"Error in meanSquaredError: ");var s=o.squaredDifference(a);return ru(s,i,r)}function Ort(n,t,e,r,o){o===void 0&&(o=mo.SUM_BY_NONZERO_WEIGHTS);var a=K(n,"labels","cosineDistance"),i=K(t,"predictions","cosineDistance"),s=null;r!=null&&(s=K(r,"weights","cosineDistance")),Cn(a.shape,i.shape,"Error in cosineDistance: ");var u=zt(1).sub(a.mul(i).sum(e,!0));return ru(u,s,o)}function Frt(n,t,e,r){r===void 0&&(r=mo.SUM_BY_NONZERO_WEIGHTS);var o=K(n,"labels","hingeLoss"),a=K(t,"predictions","hingeLoss"),i=null;e!=null&&(i=K(e,"weights","hingeLoss")),Cn(o.shape,a.shape,"Error in hingeLoss: ");var s=zt(1);o=zt(2).mul(o).sub(s);var u=s.sub(o.mul(a)).relu();return ru(u,i,r)}function Mrt(n,t,e,r,o){r===void 0&&(r=1e-7),o===void 0&&(o=mo.SUM_BY_NONZERO_WEIGHTS);var a=K(n,"labels","logLoss"),i=K(t,"predictions","logLoss"),s=null;e!=null&&(s=K(e,"weights","logLoss")),Cn(a.shape,i.shape,"Error in logLoss: ");var u=zt(1),l=zt(r),c=a.mul(i.add(l).log()).neg().sub(u.sub(a).mul(u.sub(i).add(l).log()));return ru(c,s,o)}function Lrt(n,t){var e=K(n,"labels","sigmoidCrossEntropyWithLogits"),r=K(t,"logits","sigmoidCrossEntropyWithLogits");Cn(e.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var o=r.relu(),a=r.mul(e),i=r.abs().neg().exp().log1p();return o.sub(a).add(i)}function Prt(n,t,e,r,o){r===void 0&&(r=0),o===void 0&&(o=mo.SUM_BY_NONZERO_WEIGHTS);var a=K(n,"multiClassLabels","sigmoidCrossEntropy"),i=K(t,"logits","sigmoidCrossEntropy"),s=null;if(e!=null&&(s=K(e,"weights","sigmoidCrossEntropy")),Cn(a.shape,i.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=zt(r),l=zt(1),c=zt(.5);a=a.mul(l.sub(u)).add(c.mul(u))}var h=Lrt(a,i);return ru(h,s,o)}function Brt(n,t,e,r,o){r===void 0&&(r=1),o===void 0&&(o=mo.SUM_BY_NONZERO_WEIGHTS);var a=K(n,"labels","huberLoss"),i=K(t,"predictions","huberLoss"),s=null;e!=null&&(s=K(e,"weights","huberLoss")),Cn(a.shape,i.shape,"Error in huberLoss: ");var u=zt(r),l=i.sub(a).abs(),c=oL(l,u),h=l.sub(c),d=zt(.5).mul(c.square()).add(u.mul(h));return ru(d,s,o)}function zrt(n,t,e){if(e===void 0&&(e=-1),e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+t.rank+" and dim was "+e);return Im(function(r,o,a){var i=o.logSumExp([e],!0),s=o.toFloat().sub(i);return a([r,s]),{value:s.mul(r).neg().sum([e]),gradFunc:function(u,l){var c=l[0],h=l[1],d=Ga(u.shape,[e]);return[u.reshape(d).mul(c.toFloat().sub(h.exp())),u.reshape(d).mul(h.exp().sub(c.toFloat()))]}}})(n,t)}function Urt(n,t,e,r,o){r===void 0&&(r=0),o===void 0&&(o=mo.SUM_BY_NONZERO_WEIGHTS);var a=K(n,"onehotLabels","softmaxCrossEntropy"),i=K(t,"logits","softmaxCrossEntropy"),s=null;if(e!=null&&(s=K(e,"weights","softmaxCrossEntropy")),Cn(a.shape,i.shape,"Error in softmaxCrossEntropy: "),r>0){var u=zt(r),l=zt(1),c=zt(a.shape[1]);a=a.mul(l.sub(u)).add(u.div(c))}var h=zrt(a,i);return ru(h,s,o)}(function(n){n[n.NONE=0]="NONE",n[n.MEAN=1]="MEAN",n[n.SUM=2]="SUM",n[n.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(mo||(mo={}));var Wrt=lt({absoluteDifference_:Drt}),ru=lt({computeWeightedLoss_:_rt}),Vrt=lt({cosineDistance_:Ort}),Grt=lt({hingeLoss_:Frt}),Hrt=lt({huberLoss_:Brt}),qrt=lt({logLoss_:Mrt}),jrt=lt({meanSquaredError_:$rt}),Xrt=lt({sigmoidCrossEntropy_:Prt}),Krt=lt({softmaxCrossEntropy_:Urt}),Yrt=Object.freeze({get Reduction(){return mo},absoluteDifference:Wrt,computeWeightedLoss:ru,cosineDistance:Vrt,hingeLoss:Grt,huberLoss:Hrt,logLoss:qrt,meanSquaredError:jrt,sigmoidCrossEntropy:Xrt,softmaxCrossEntropy:Krt});function Qrt(n){var t;if(Array.isArray(n)){t=!1,et(n!=null&&n.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var e=n[0].shape[0],r=function(u){et(n[u].shape[0]===e,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+n[u].shape[0]+" vs. "+e+")"})},o=1;o<n.length;++o)r(o)}else t=!0,n=bk(n,n.shape[0],0).map(function(u){return B4(u,[0])});et(n.length<=n[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+n.length+") exceeds number of dimensions ("+n[0].shape[0]+")."});var a=[],i=n,s=function(u){a.push(Y.engine.tidy(function(){var l=i[u];if(u>0)for(var c=0;c<u;++c){var h=tL(a[c].mulStrict(l)).mul(a[c]);l=l.sub(h)}return l.div(uL(l,"euclidean"))}))};for(o=0;o<n.length;++o)s(o);return t?hi(a,0):a}function Zrt(n,t){if(t===void 0&&(t=!1),n.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+n.rank);if(n.rank===2)return tO(n,t);var e=n.shape.slice(0,n.shape.length-2).reduce(function(a,i){return a*i}),r=[],o=[];return Zr(n.reshape([e,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0).forEach(function(a){var i=tO(a,t),s=i[0],u=i[1];r.push(s),o.push(u)}),[hi(r,0).reshape(n.shape),hi(o,0).reshape(n.shape)]}function tO(n,t){return t===void 0&&(t=!1),Y.engine.tidy(function(){if(n.shape.length!==2)throw new Error("qr2d() requires a 2D Tensor, but got a "+n.shape.length+"D Tensor.");for(var e=n.shape[0],r=n.shape[1],o=L4(e),a=n.clone(),i=Xy([[1]],[1,1]),s=i.clone(),u=e>=r?r:e,l=function(h){var d,p=a,g=s,x=o;d=Y.engine.tidy(function(){var y=a.slice([h,h],[e-h,1]),b=y.norm(),C=a.slice([h,h],[1,1]),E=C.sign().neg(),S=C.sub(E.mul(b)),k=y.div(S);s=k.shape[0]===1?i.clone():i.concat(k.slice([1,0],[k.shape[0]-1,k.shape[1]]),0);var R=E.matMul(S).div(b).neg(),A=a.slice([h,0],[e-h,r]),N=R.mul(s);a=h===0?A.sub(N.matMul(s.transpose().matMul(A))):a.slice([0,0],[h,r]).concat(A.sub(N.matMul(s.transpose().matMul(A))),0);var _=o.slice([0,h],[e,o.shape[1]-h]);return o=h===0?_.sub(_.matMul(s).matMul(N.transpose())):o.slice([0,0],[e,h]).concat(_.sub(_.matMul(s).matMul(N.transpose())),1),[s,a,o]}),s=d[0],a=d[1],o=d[2],r8([p,g,x])},c=0;c<u;++c)l(c);return!t&&e>r&&(o=o.slice([0,0],[e,r]),a=a.slice([0,0],[r,r])),[o,a]})}var Jrt=lt({gramSchmidt_:Qrt}),tot=lt({qr_:Zrt}),eot=Object.freeze({gramSchmidt:Jrt,qr:tot});function not(n,t,e){e===void 0&&(e=!1);var r=K(n,"images","resizeBilinear");et(r.rank===3||r.rank===4,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."}),et(t.length===2,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+t+"."});var o=r,a=!1;r.rank===3&&(a=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var i=t[0],s=t[1],u=Y.engine.runKernel(function(l,c){return c([o]),l.resizeBilinear(o,i,s,e)},{batchImages:o},function(l,c){return{batchImages:function(){return Y.engine.runKernel(function(h){return h.resizeBilinearBackprop(l,c[0],e)},{})}}});return a?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}function rot(n,t,e){e===void 0&&(e=!1);var r=K(n,"images","resizeNearestNeighbor");et(r.rank===3||r.rank===4,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."}),et(t.length===2,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+t+"."}),et(r.dtype==="float32"||r.dtype==="int32",function(){return"`images` must have `int32` or `float32` as dtype"});var o=r,a=!1;r.rank===3&&(a=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var i=t[0],s=t[1],u=Y.engine.runKernel(function(l,c){return c([o]),l.resizeNearestNeighbor(o,i,s,e)},{batchImages:o},function(l,c){return{batchImages:function(){return Y.engine.runKernel(function(h){return h.resizeNearestNeighborBackprop(l,c[0],e)},{})}}});return a?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}function oot(n,t,e,r,o){r===void 0&&(r=.5),o===void 0&&(o=Number.NEGATIVE_INFINITY);var a=K(n,"boxes","nonMaxSuppression"),i=K(t,"scores","nonMaxSuppression"),s=dL(a,i,e,r,o);return e=s.maxOutputSize,r=s.iouThreshold,o=s.scoreThreshold,Y.engine.runKernel(function(u){return u.nonMaxSuppression(a,i,e,r,o)},{$boxes:a})}function aot(n,t,e,r,o){return r===void 0&&(r=.5),o===void 0&&(o=Number.NEGATIVE_INFINITY),bn(this,void 0,void 0,function(){var a,i,s,u,l,c;return wn(this,function(h){switch(h.label){case 0:return a=K(n,"boxes","nonMaxSuppressionAsync"),i=K(t,"scores","nonMaxSuppressionAsync"),s=dL(a,i,e,r,o),e=s.maxOutputSize,r=s.iouThreshold,o=s.scoreThreshold,[4,a.data()];case 1:return u=h.sent(),[4,i.data()];case 2:return l=h.sent(),c=mk(u,l,e,r,o),a!==n&&a.dispose(),i!==t&&i.dispose(),[2,c]}})})}function dL(n,t,e,r,o){r==null&&(r=.5),o==null&&(o=Number.NEGATIVE_INFINITY);var a=n.shape[0];return e=Math.min(e,a),et(0<=r&&r<=1,function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"}),et(n.rank===2,function(){return"boxes must be a 2D tensor, but was of rank '"+n.rank+"'"}),et(n.shape[1]===4,function(){return"boxes must have 4 columns, but 2nd dimension was "+n.shape[1]}),et(t.rank===1,function(){return"scores must be a 1D tensor"}),et(t.shape[0]===a,function(){return"scores has incompatible shape with boxes. Expected "+a+", but was "+t.shape[0]}),{maxOutputSize:e,iouThreshold:r,scoreThreshold:o}}function iot(n,t,e,r,o,a){var i=K(n,"image","cropAndResize","float32"),s=K(t,"boxes","cropAndResize","float32"),u=K(e,"boxInd","cropAndResize","int32");o=o||"bilinear",a=a||0;var l=s.shape[0];return et(i.rank===4,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+i.rank+"."}),et(s.rank===2&&s.shape[1]===4,function(){return"Error in cropAndResize: boxes must be have size ["+l+",4] but had shape "+s.shape+"."}),et(u.rank===1&&u.shape[0]===l,function(){return"Error in cropAndResize: boxInd must be have size ["+l+"] but had shape "+s.shape+"."}),et(r.length===2,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."}),et(r[0]>=1&&r[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+r}),et(o==="bilinear"||o==="nearest",function(){return"method must be bilinear or nearest, but was "+o}),Y.engine.runKernel(function(c,h){return c.cropAndResize(i,s,u,r,o,a)},{$image:i,$boxes:s})}var sot=lt({resizeBilinear_:not}),uot=lt({resizeNearestNeighbor_:rot}),lot=lt({nonMaxSuppression_:oot}),cot=aot,hot=lt({cropAndResize_:iot}),pL=Object.freeze({resizeBilinear:sot,resizeNearestNeighbor:uot,nonMaxSuppression:lot,nonMaxSuppressionAsync:cot,cropAndResize:hot});function fot(n,t,e,r,o,a){var i;e===void 0&&(e=!1),r===void 0&&(r=!1),a===void 0&&(a="linear");var s=K(n,"a","fused matMul"),u=K(t,"b","fused matMul");i=Nr(s,u),s=i[0],u=i[1];var l=e?s.shape[s.rank-2]:s.shape[s.rank-1],c=r?u.shape[u.rank-1]:u.shape[u.rank-2],h=e?s.shape[s.rank-1]:s.shape[s.rank-2],d=r?u.shape[u.rank-2]:u.shape[u.rank-1],p=s.shape.slice(0,-2),g=u.shape.slice(0,-2),x=de(p),y=de(g);et(s.rank>=2&&u.rank>=2&&s.rank===u.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+s.rank+" and "+u.rank+"."}),et(Ao(p,g),function(){return"Error in fused matMul: outer dimensions ("+p+") and ("+g+") of Tensors with shapes "+s.shape+" and "+u.shape+" must match."}),et(l===c,function(){return"Error in fused matMul: inner shapes ("+l+") and ("+c+") of Tensors with shapes "+s.shape+" and "+u.shape+" and transposeA="+e+" and transposeB="+r+" must match."});var b,C=s.shape.slice(0,-2).concat([h,d]),E=e?s.as3D(x,l,h):s.as3D(x,h,l),S=r?u.as3D(y,d,c):u.as3D(y,c,d);o!=null&&qe(C,(b=Nr(b=K(o,"bias","fused matMul"),s)[0]).shape);var k={$a:E,$b:S};return o!=null&&(k.$bias=b),Y.engine.runKernel(function(R,A){var N=R.fusedBatchMatMul(E,S,e,r,b,a);return A([E,S,N]),N},k,function(R,A){var N,_=A[0],$=A[1],D=A[2];if(a==null||a==="linear")N=R;else{if(a!=="relu")throw new Error("Gradient for activation "+a+" has not been implemented yet.");N=R.mul(D.step())}var O={};return o!=null&&(O={$bias:function(){var P=N,z=Ar(b.shape,N.shape);return z.length>0&&(P=P.sum(z)),P.reshape(b.shape)}}),Object.assign(e||r?!e&&r?{$a:function(){return N.matMul($,!1,!1)},$b:function(){return N.matMul(_,!0,!1)}}:e&&!r?{$a:function(){return $.matMul(N,!1,!0)},$b:function(){return _.matMul(N,!1,!1)}}:{$a:function(){return $.matMul(N,!0,!0)},$b:function(){return N.matMul(_,!0,!0)}}:{$a:function(){return N.matMul($,!1,!0)},$b:function(){return _.matMul(N,!0,!1)}},O)}).reshape(C)}var dot=lt({matMul_:fot}),pot=Object.freeze({matMul:dot}),mot=Object.freeze({image:pL,linalg:eot,losses:Yrt,spectral:krt,fused:pot,op:lt,batchNormalization2d:ftt,batchNormalization3d:dtt,batchNormalization4d:ptt,batchNormalization:mtt,batchNorm:H4,batchNorm2d:gtt,batchNorm3d:vtt,batchNorm4d:xtt,complex:ko,real:Gi,imag:Vu,concat:Ho,concat1d:KQ,concat2d:YQ,concat3d:QQ,concat4d:ZQ,split:bk,conv1d:Ftt,conv2d:nu,conv3d:Mtt,conv2dDerFilter:X4,depthwiseConv2d:Ek,separableConv2d:K4,conv2dTranspose:Ltt,matMul:kk,dot:Utt,outerProduct:Wtt,reverse:Fm,reverse1d:Xtt,reverse2d:Ktt,reverse3d:Ytt,reverse4d:Qtt,maxPool:$f,avgPool:Mm,pool:aet,slice:nl,slice1d:fet,slice2d:det,slice3d:Z4,slice4d:pet,abs:DJ,acos:$J,acosh:OJ,asin:FJ,asinh:MJ,atan:LJ,atanh:PJ,ceil:BJ,clipByValue:Ck,cos:zJ,cosh:UJ,erf:WJ,exp:GS,expm1:VJ,floor:GJ,log:HJ,log1p:qJ,logSigmoid:jJ,neg:G0,reciprocal:XJ,round:KJ,rsqrt:z4,sigmoid:U4,sign:YJ,isNaN:QJ,isInf:ZJ,isFinite:JJ,sin:ttt,sinh:ett,softplus:ntt,sqrt:rtt,square:ott,step:att,tan:itt,tanh:stt,all:Ret,any:Tet,argMax:Net,argMin:Aet,logSumExp:_et,max:Yy,mean:Det,min:$et,moments:Oet,sum:tL,prod:Fet,equal:eL,equalStrict:Xet,greater:Ket,greaterEqual:nL,greaterEqualStrict:Yet,greaterStrict:Qet,less:Zet,lessEqual:Jet,lessEqualStrict:tnt,lessStrict:ent,notEqual:nnt,notEqualStrict:rnt,add:on,addN:knt,addStrict:Int,atan2:Rnt,div:Ms,divStrict:Tnt,floorDiv:rL,maximum:Ik,maximumStrict:Nnt,minimum:oL,minimumStrict:Ant,mod:_nt,modStrict:Dnt,mul:Ws,mulStrict:$nt,pow:aL,powStrict:Ont,squaredDifference:Fnt,squaredDifferenceStrict:Mnt,sub:es,subStrict:Lnt,elu:Znt,leakyRelu:Jnt,prelu:trt,relu:mr,selu:ert,logicalAnd:Rk,logicalNot:Gnt,logicalOr:iL,logicalXor:Hnt,where:em,whereAsync:qnt,buffer:Be,print:_Z,batchToSpaceND:M4,cast:DZ,clone:$Z,cumsum:OZ,depthToSpace:FZ,expandDims:La,eye:L4,multinomial:MZ,oneHot:VS,pad:_m,pad1d:LZ,pad2d:PZ,pad3d:BZ,pad4d:zZ,rand:UZ,randomNormal:WZ,randomUniform:VZ,reshape:ui,spaceToBatchND:P4,squeeze:B4,stack:hi,tile:mf,truncatedNormal:GZ,unstack:Zr,setdiff1dAsync:HZ,fill:jp,linspace:E8,ones:Cc,range:f4,scalar:zt,tensor:dr,tensor1d:fa,tensor2d:Xy,tensor3d:pk,tensor4d:oi,tensor5d:b8,tensor6d:w8,zeros:ir,onesLike:d4,zerosLike:sn,transpose:rl,softmax:ml,logSoftmax:g8,localResponseNormalization:ort,norm:uL,gather:lL,unsortedSegmentSum:cL,basicLSTMCell:hrt,multiRNNCell:frt,movingAverage:prt,stridedSlice:grt,topk:xrt,scatterND:brt,fft:Tk,ifft:j0,rfft:hL,irfft:fL,sparseToDense:Trt,gatherND:Art});function got(n,t,e){if(t==="linear")return n.linear(e);if(t==="relu")return n.relu(e);throw new Error("Activation "+t+" has not been implemented for the CPU backend.")}var vot=function(){function n(){this.blockSize=48,this.firstUse=!0,Y.get("IS_BROWSER")&&(this.fromPixels2DContext=document.createElement("canvas").getContext("2d"))}return n.prototype.setDataMover=function(t){this.data=new p4(t)},n.prototype.register=function(t,e,r){if(this.firstUse&&(this.firstUse=!1,Y.get("IS_NODE")&&zS(`
============================
Hi there 👋. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================
`)),this.data.has(t))throw new Error("Data buffer is already registered");this.data.set(t,{dtype:r})},n.prototype.write=function(t,e){if(e==null)throw new Error("MathBackendCPU.write(): values can not be null");this.data.get(t).values=e},n.prototype.fromPixels=function(t,e){if(t==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var r,o;if(Y.get("IS_NODE")&&t.getContext==null)throw new Error("When running in node, pixels must be an HTMLCanvasElement like the one returned by the `canvas` npm package");if(t.getContext!=null)r=t.getContext("2d").getImageData(0,0,t.width,t.height).data;else if(t instanceof ImageData)r=t.data;else{if(!(t instanceof HTMLImageElement||t instanceof HTMLVideoElement))throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement or ImageData, but was "+t.constructor.name);if(this.fromPixels2DContext==null)throw new Error("Can't read pixels from HTMLImageElement outside the browser.");this.fromPixels2DContext.canvas.width=t.width,this.fromPixels2DContext.canvas.height=t.height,this.fromPixels2DContext.drawImage(t,0,0,t.width,t.height),r=this.fromPixels2DContext.getImageData(0,0,t.width,t.height).data}if(e===4)o=new Int32Array(r);else{var a=t.width*t.height;o=new Int32Array(a*e);for(var i=0;i<a;i++)for(var s=0;s<e;++s)o[i*e+s]=r[4*i+s]}return pk(o,[t.height,t.width,e],"int32")},n.prototype.read=function(t){return bn(this,void 0,void 0,function(){return wn(this,function(e){return[2,this.readSync(t)]})})},n.prototype.readSync=function(t){var e=this.data.get(t),r=e.dtype,o=e.complexTensors;return r==="complex64"?g4(o.real.dataSync(),o.imag.dataSync()):this.data.get(t).values},n.prototype.disposeData=function(t){if(this.data.has(t)){var e=this.data.get(t).complexTensors;e!=null&&(e.real.dispose(),e.imag.dispose()),this.data.delete(t)}},n.prototype.time=function(t){return bn(this,void 0,void 0,function(){var e;return wn(this,function(r){return e=P0(),t(),[2,{kernelMs:P0()-e}]})})},n.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},n.prototype.complex=function(t,e){var r=Gt.make(t.shape,{},"complex64");return this.data.get(r.dataId).complexTensors={real:Y.engine.keep(t.clone()),imag:Y.engine.keep(e.clone())},r},n.prototype.real=function(t){return this.data.get(t.dataId).complexTensors.real.clone()},n.prototype.imag=function(t){return this.data.get(t.dataId).complexTensors.imag.clone()},n.prototype.assertNotComplex=function(t,e){Array.isArray(t)||(t=[t]),t.forEach(function(r){r!=null&&et(r.dtype!=="complex64",function(){return e+" does not support complex64 tensors."})})},n.prototype.slice=function(t,e,r){if(this.assertNotComplex(t,"slice"),c4(t.shape,e,r)){var o=h4(e,t.strides),a=de(r);return dr(t.dataSync().subarray(o,o+a),r,t.dtype)}for(var i=Be(r,t.dtype),s=t.bufferSync(),u=0;u<i.size;++u){var l=i.indexToLoc(u).map(function(c,h){return c+e[h]});i.values[u]=s.get.apply(s,l)}return i.toTensor()},n.prototype.stridedSlice=function(t,e,r,o,a,i,s,u,l){this.assertNotComplex(t,"stridedSlice");var c=dk(t.shape,e,r,o,a,i,s,u,l),h=c[0],d=c[1],p=c[2],g=d.filter(function(k,R){return p.indexOf(R)===-1});if(g.some(function(k){return k===0}))return dr([],g);for(var x=Be(d,t.dtype),y=t.bufferSync(),b=0;b<x.size;b++){for(var C=x.indexToLoc(b),E=new Array(C.length),S=0;S<E.length;S++)E[S]=C[S]*o[S]+h[S];x.set.apply(x,[y.get.apply(y,E)].concat(C))}return x.toTensor().reshape(g)},n.prototype.unstack=function(t,e){for(var r=t.shape[e],o=new Array(t.rank-1),a=0,i=0;i<t.rank;i++)i!==e&&(o[a++]=t.shape[i]);var s=new Array(t.rank).fill(0),u=t.shape.slice();u[e]=1;var l=new Array(r);for(i=0;i<l.length;i++)s[e]=i,l[i]=this.slice(t,s,u).reshape(o);return l},n.prototype.reverse=function(t,e){this.assertNotComplex(t,"reverse");for(var r=Be(t.shape,t.dtype),o=t.bufferSync(),a=function(s){var u=r.indexToLoc(s),l=u.slice();e.forEach(function(c){return l[c]=t.shape[c]-1-l[c]}),r.set.apply(r,[o.get.apply(o,l)].concat(u))},i=0;i<r.size;i++)a(i);return r.toTensor()},n.prototype.concat=function(t,e){this.assertNotComplex(t,"concat");var r=t.map(function(l){var c=de(l.shape.slice(e));return l.as2D(-1,c)}),o=Df(r.map(function(l){return l.shape}),1),a=Be(o,t[0].dtype).values;if(r[0].shape[0]===1){var i=0;r.forEach(function(l){a.set(l.dataSync(),i),i+=l.size})}else{var s=0;r.forEach(function(l){for(var c=l.dataSync(),h=0,d=0;d<l.shape[0];++d)for(var p=d*o[1]+s,g=0;g<l.shape[1];++g)a[p+g]=c[h++];s+=l.shape[1]})}var u=Df(t.map(function(l){return l.shape}),e);return dr(a,u,t[0].dtype)},n.prototype.neg=function(t){return this.assertNotComplex(t,"neg"),this.multiply(zt(-1),t)},n.prototype.add=function(t,e){return t.dtype==="complex64"||e.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),e.cast("complex64"),function(r,o,a,i){return{real:r+a,imag:o+i}}):this.broadcastedBinaryOp(t,e,Lr(t.dtype,e.dtype),function(r,o){return r+o})},n.prototype.addN=function(t){this.assertNotComplex(t,"addN");for(var e=t.map(function(u){return u.dataSync()}),r=Be(t[0].shape,t[0].dtype),o=r.values,a=0;a<t.length;a++)for(var i=e[a],s=0;s<o.length;s++)o[s]+=i[s];return r.toTensor()},n.prototype.subtract=function(t,e){return t.dtype==="complex64"||e.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),e.cast("complex64"),function(r,o,a,i){return{real:r-a,imag:o-i}}):this.broadcastedBinaryOp(t,e,Lr(t.dtype,e.dtype),function(r,o){return r-o})},n.prototype.pow=function(t,e){return this.assertNotComplex([t,e],"pow"),this.broadcastedBinaryOp(t,e,t.dtype,function(r,o){return Math.pow(r,o)})},n.prototype.batchMatMul=function(t,e,r,o){this.assertNotComplex([t,e],"matMul");for(var a=r?t.shape[1]:t.shape[2],i=r?t.shape[2]:t.shape[1],s=o?e.shape[1]:e.shape[2],u=t.shape[0],l=t.dataSync(),c=e.dataSync(),h=r?[t.strides[0],1,t.strides[1]]:[t.strides[0],t.strides[1],1],d=h[0],p=h[1],g=h[2],x=o?[1,e.strides[1],e.strides[0]]:[e.strides[1],1,e.strides[0]],y=x[0],b=x[1],C=x[2],E=i*s,S=Be([u,i,s],t.dtype),k=S.values,R=this.blockSize,A=0;A<u;A++)for(var N=0;N<i;N+=R)for(var _=0;_<s;_+=R)for(var $=0;$<a;$+=R)for(var D=Math.min(N+R,i),O=Math.min(_+R,s),P=Math.min($+R,a),z=N;z<D;z++)for(var W=_;W<O;W++){for(var F=0,B=$;B<P;B++)F+=l[A*d+z*p+B*g]*c[B*y+W*b+A*C];k[A*E+(z*s+W)]+=F}return S.toTensor()},n.prototype.fusedBatchMatMul=function(t,e,r,o,a,i){var s=this.batchMatMul(t,e,r,o);return a&&(s=this.add(s,a)),i&&(s=got(this,i,s)),s},n.prototype.multiply=function(t,e){return t.dtype==="complex64"||e.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),e.cast("complex64"),function(r,o,a,i){return{real:r*a-o*i,imag:r*i+o*a}}):this.broadcastedBinaryOp(t,e,Lr(t.dtype,e.dtype),function(r,o){return r*o})},n.prototype.realDivide=function(t,e){return this.assertNotComplex([t,e],"realDivide"),this.broadcastedBinaryOp(t,e,"float32",function(r,o){return r/o})},n.prototype.floorDiv=function(t,e){return this.assertNotComplex([t,e],"floorDiv"),this.broadcastedBinaryOp(t,e,"int32",function(r,o){return Math.floor(r/o)})},n.prototype.sum=function(t,e){this.assertNotComplex(t,"sum"),la("sum",e,t.rank);for(var r=co(t.shape,e),o=r[0],a=r[1],i=ir(o,Lr(t.dtype,"int32")),s=de(a),u=i.dataSync(),l=t.dataSync(),c=0;c<u.length;++c){for(var h=c*s,d=0,p=0;p<s;++p)d+=l[h+p];u[c]=d}return i},n.prototype.prod=function(t,e){this.assertNotComplex(t,"sum");for(var r=co(t.shape,e),o=r[0],a=r[1],i=ir(o,Lr(t.dtype,"int32")),s=de(a),u=i.dataSync(),l=t.dataSync(),c=0;c<u.length;++c){for(var h=c*s,d=1,p=0;p<s;++p)d*=l[h+p];u[c]=d}return i},n.prototype.unsortedSegmentSum=function(t,e,r){this.assertNotComplex(t,"unsortedSegmentSum");for(var o=[],a=t.rank-e.rank,i=0;i<a;++i)e=e.expandDims(i+1);for(i=0;i<r;++i){var s=zt(i,"int32"),u=eL(s,e).asType("float32").mul(t).sum(0);o.push(u)}return hi(o)},n.prototype.argMin=function(t,e){this.assertNotComplex(t,"argMin");var r=[e];la("argMin",r,t.rank);for(var o=co(t.shape,r),a=o[0],i=o[1],s=ir(a,"int32"),u=de(i),l=s.dataSync(),c=t.dataSync(),h=0;h<l.length;++h){for(var d=h*u,p=c[d],g=0,x=0;x<u;++x){var y=c[d+x];y<p&&(p=y,g=x)}l[h]=g}return s},n.prototype.argMax=function(t,e){this.assertNotComplex(t,"argMax");var r=[e];la("argMax",r,t.rank);for(var o=co(t.shape,r),a=o[0],i=o[1],s=ir(a,"int32"),u=de(i),l=s.dataSync(),c=t.dataSync(),h=0;h<l.length;++h){for(var d=h*u,p=c[d],g=0,x=0;x<u;++x){var y=c[d+x];y>p&&(p=y,g=x)}l[h]=g}return s},n.prototype.cumsum=function(t,e,r,o){if(this.assertNotComplex(t,"cumsum"),e!==t.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(t.rank-1)+" but got axis="+e);for(var a=Lr(t.dtype,"int32"),i=ir(t.shape,a),s=i.dataSync(),u=t.dataSync(),l=t.shape[t.rank-1],c=o?function(x,y){return x+l-y-1}:function(x,y){return x+y},h=0;h<u.length;h+=l)for(var d=0;d<l;d++){var p=c(h,d);if(d===0)s[p]=r?0:u[p];else{var g=c(h,d-1);s[p]=r?u[g]+s[g]:u[p]+s[g]}}return i},n.prototype.equal=function(t,e){return this.assertNotComplex([t,e],"equal"),this.broadcastedBinaryOp(t,e,"bool",function(r,o){return r===o?1:0})},n.prototype.notEqual=function(t,e){return this.assertNotComplex([t,e],"notEqual"),this.broadcastedBinaryOp(t,e,"bool",function(r,o){return r!==o?1:0})},n.prototype.less=function(t,e){return this.assertNotComplex([t,e],"less"),this.broadcastedBinaryOp(t,e,"bool",function(r,o){return r<o?1:0})},n.prototype.lessEqual=function(t,e){return this.assertNotComplex([t,e],"lessEqual"),this.broadcastedBinaryOp(t,e,"bool",function(r,o){return r<=o?1:0})},n.prototype.greater=function(t,e){return this.assertNotComplex([t,e],"greater"),this.broadcastedBinaryOp(t,e,"bool",function(r,o){return r>o?1:0})},n.prototype.greaterEqual=function(t,e){return this.assertNotComplex([t,e],"greaterEqual"),this.broadcastedBinaryOp(t,e,"bool",function(r,o){return r>=o?1:0})},n.prototype.logicalNot=function(t){this.assertNotComplex(t,"logicalNot");for(var e=t.dataSync(),r=new Uint8Array(e.length),o=0;o<e.length;++o)r[o]=e[o]?0:1;return Gt.make(t.shape,{values:r},"bool")},n.prototype.logicalAnd=function(t,e){return this.assertNotComplex([t,e],"logicalAnd"),this.broadcastedBinaryOp(t,e,"bool",function(r,o){return r&&o})},n.prototype.logicalOr=function(t,e){return this.assertNotComplex([t,e],"logicalOr"),this.broadcastedBinaryOp(t,e,"bool",function(r,o){return r||o})},n.prototype.select=function(t,e,r){this.assertNotComplex([t,e,r],"select");for(var o=t.dataSync(),a=e.dataSync(),i=r.dataSync(),s=ir(e.shape,Lr(e.dtype,r.dtype)),u=s.dataSync(),l=0,c=t.rank===0||t.rank>1||e.rank===1?1:e.shape[1],h=0;h<o.length;h++)for(var d=0;d<c;d++)o[h]===1?u[l++]=a[h]:u[l++]=i[h];return s},n.prototype.where=function(t){this.assertNotComplex([t],"where");var e=t.dataSync();return wk(t.shape,e)},n.prototype.topk=function(t,e,r){return this.assertNotComplex(t,"topk"),x4(t.dataSync(),t.shape,t.dtype,e)},n.prototype.min=function(t,e){this.assertNotComplex(t,"min"),la("min",e,t.rank);for(var r=co(t.shape,e),o=r[0],a=r[1],i=ir(o,t.dtype),s=de(a),u=i.dataSync(),l=t.dataSync(),c=0;c<u.length;++c){for(var h=c*s,d=l[h],p=0;p<s;++p){var g=l[h+p];g<d&&(d=g)}u[c]=d}return i},n.prototype.minimum=function(t,e){return this.assertNotComplex([t,e],"minimum"),this.broadcastedBinaryOp(t,e,t.dtype,function(r,o){return Math.min(r,o)})},n.prototype.mod=function(t,e){return this.assertNotComplex([t,e],"mod"),this.broadcastedBinaryOp(t,e,t.dtype,function(r,o){var a=r%o;return r<0&&o<0||r>=0&&o>=0?a:(a+o)%o})},n.prototype.max=function(t,e){this.assertNotComplex(t,"max"),la("max",e,t.rank);for(var r=co(t.shape,e),o=r[0],a=r[1],i=ir(o,t.dtype),s=de(a),u=i.dataSync(),l=t.dataSync(),c=0;c<u.length;++c){for(var h=c*s,d=l[h],p=0;p<s;++p){var g=l[h+p];g>d&&(d=g)}u[c]=d}return i},n.prototype.maximum=function(t,e){return this.assertNotComplex([t,e],"maximum"),this.broadcastedBinaryOp(t,e,t.dtype,function(r,o){return Math.max(r,o)})},n.prototype.all=function(t,e){this.assertNotComplex(t,"all"),la("all",e,t.rank);for(var r=co(t.shape,e),o=r[0],a=r[1],i=ir(o,t.dtype),s=de(a),u=i.dataSync(),l=t.dataSync(),c=0;c<u.length;++c){for(var h=c*s,d=l[h],p=0;p<s;++p){var g=l[h+p];d=d&&g}u[c]=d}return i},n.prototype.any=function(t,e){this.assertNotComplex(t,"any"),la("any",e,t.rank);for(var r=co(t.shape,e),o=r[0],a=r[1],i=ir(o,t.dtype),s=de(a),u=i.dataSync(),l=t.dataSync(),c=0;c<u.length;++c){for(var h=c*s,d=l[h],p=0;p<s;++p){var g=l[h+p];d=d||g}u[c]=d}return i},n.prototype.squaredDifference=function(t,e){return this.assertNotComplex([t,e],"squaredDifference"),this.broadcastedBinaryOp(t,e,t.dtype,function(r,o){var a=r-o;return a*a})},n.prototype.ceil=function(t){this.assertNotComplex(t,"ceil");for(var e=t.dataSync(),r=new Float32Array(e.length),o=0;o<e.length;++o)r[o]=Math.ceil(e[o]);return Gt.make(t.shape,{values:r})},n.prototype.floor=function(t){this.assertNotComplex(t,"floor");for(var e=t.dataSync(),r=new Float32Array(e.length),o=0;o<e.length;++o)r[o]=Math.floor(e[o]);return Gt.make(t.shape,{values:r})},n.prototype.sign=function(t){this.assertNotComplex(t,"x");for(var e=t.dataSync(),r=new Float32Array(e.length),o=0;o<e.length;++o)e[o]<0?r[o]=-1:e[o]>0?r[o]=1:r[o]=0;return Gt.make(t.shape,{values:r})},n.prototype.isNaN=function(t){this.assertNotComplex(t,"x");for(var e=t.dataSync(),r=new Uint8Array(e.length),o=0;o<e.length;++o)Number.isNaN(e[o])&&(r[o]=1);return Gt.make(t.shape,{values:r},"bool")},n.prototype.isInf=function(t){this.assertNotComplex(t,"x");for(var e=t.dataSync(),r=new Uint8Array(e.length),o=0;o<e.length;++o)Math.abs(e[o])===1/0&&(r[o]=1);return Gt.make(t.shape,{values:r},"bool")},n.prototype.isFinite=function(t){this.assertNotComplex(t,"x");for(var e=t.dataSync(),r=new Uint8Array(e.length),o=0;o<e.length;++o)Number.isFinite(e[o])&&(r[o]=1);return Gt.make(t.shape,{values:r},"bool")},n.prototype.round=function(t){this.assertNotComplex(t,"round");for(var e=t.dataSync(),r=new Float32Array(e.length),o=0;o<e.length;++o){var a=Math.floor(e[o]);e[o]-a<.5?r[o]=Math.floor(e[o]):e[o]-a>.5?r[o]=Math.ceil(e[o]):r[o]=a%2==0?a:a+1}return Gt.make(t.shape,{values:r})},n.prototype.exp=function(t){this.assertNotComplex(t,"exp");for(var e=t.dataSync(),r=new Float32Array(e.length),o=0;o<e.length;++o)r[o]=Math.exp(e[o]);return Gt.make(t.shape,{values:r})},n.prototype.expm1=function(t){this.assertNotComplex(t,"expm1");for(var e=t.dataSync(),r=new Float32Array(e.length),o=0;o<e.length;++o)r[o]=Math.expm1(e[o]);return Gt.make(t.shape,{values:r})},n.prototype.log=function(t){this.assertNotComplex(t,"log");for(var e=t.dataSync(),r=new Float32Array(e.length),o=0;o<e.length;++o){var a=e[o];r[o]=Math.log(a)}return Gt.make(t.shape,{values:r})},n.prototype.log1p=function(t){this.assertNotComplex(t,"log1p");for(var e=t.dataSync(),r=new Float32Array(e.length),o=0;o<e.length;++o){var a=e[o];r[o]=Math.log1p(a)}return Gt.make(t.shape,{values:r})},n.prototype.sqrt=function(t){this.assertNotComplex(t,"sqrt");for(var e=t.dataSync(),r=new Float32Array(e.length),o=0;o<e.length;++o){var a=e[o];r[o]=Math.sqrt(a)}return Gt.make(t.shape,{values:r})},n.prototype.rsqrt=function(t){this.assertNotComplex(t,"rsqrt");for(var e=t.dataSync(),r=new Float32Array(e.length),o=0;o<e.length;++o){var a=e[o];r[o]=1/Math.sqrt(a)}return Gt.make(t.shape,{values:r})},n.prototype.square=function(t){this.assertNotComplex(t,"square");for(var e=t.dataSync(),r=new Float32Array(e.length),o=0;o<e.length;++o){var a=e[o];r[o]=a*a}return Gt.make(t.shape,{values:r})},n.prototype.reciprocal=function(t){this.assertNotComplex(t,"reciprocal");for(var e=t.dataSync(),r=new Float32Array(e.length),o=0;o<e.length;++o)r[o]=1/e[o];return Gt.make(t.shape,{values:r})},n.prototype.linear=function(t){return t},n.prototype.relu=function(t){this.assertNotComplex(t,"relu");for(var e=ir(t.shape,t.dtype),r=e.dataSync(),o=t.dataSync(),a=0;a<o.length;++a)r[a]=Math.max(0,o[a]);return e},n.prototype.prelu=function(t,e){return this.assertNotComplex([t,e],"prelu"),this.broadcastedBinaryOp(t,e,t.dtype,function(r,o){return r<0?o*r:r})},n.prototype.elu=function(t){this.assertNotComplex(t,"elu");for(var e=new Float32Array(t.size),r=t.dataSync(),o=0;o<r.length;++o){var a=r[o];e[o]=a>=0?a:Math.exp(a)-1}return Gt.make(t.shape,{values:e})},n.prototype.eluDer=function(t,e){this.assertNotComplex([t,e],"eluDer");for(var r=new Float32Array(e.size),o=e.dataSync(),a=t.dataSync(),i=0;i<o.length;++i){var s=o[i];r[i]=s>=1?a[i]:a[i]*(s+1)}return Gt.make(e.shape,{values:r})},n.prototype.selu=function(t){this.assertNotComplex(t,"selu");for(var e=xk,r=yk,o=new Float32Array(t.size),a=t.dataSync(),i=0;i<a.length;++i){var s=a[i];o[i]=s>=0?r*s:e*(Math.exp(s)-1)}return Gt.make(t.shape,{values:o})},n.prototype.clip=function(t,e,r){this.assertNotComplex(t,"clip");for(var o=new Float32Array(t.size),a=t.dataSync(),i=0;i<a.length;++i){var s=a[i];o[i]=s>r?r:s<e?e:s}return Gt.make(t.shape,{values:o})},n.prototype.abs=function(t){for(var e=new Float32Array(t.size),r=t.dataSync(),o=0;o<r.length;++o)e[o]=Math.abs(r[o]);return Gt.make(t.shape,{values:e})},n.prototype.complexAbs=function(t){for(var e=new Float32Array(t.size),r=t.dataSync(),o=0;o<t.size;++o){var a=r[2*o],i=r[2*o+1];e[o]=Math.hypot(a,i)}return Gt.make(t.shape,{values:e})},n.prototype.int=function(t){this.assertNotComplex(t,"int");for(var e=new Int32Array(t.size),r=t.dataSync(),o=0;o<r.length;++o)e[o]=r[o];return Gt.make(t.shape,{values:e},"int32")},n.prototype.sigmoid=function(t){this.assertNotComplex(t,"sigmoid");for(var e=new Float32Array(t.size),r=t.dataSync(),o=0;o<r.length;++o)e[o]=1/(1+Math.exp(-r[o]));return Gt.make(t.shape,{values:e})},n.prototype.softplus=function(t){this.assertNotComplex(t,"softplus");for(var e=Math.log(11920928955078125e-23)+2,r=new Float32Array(t.size),o=t.dataSync(),a=0;a<o.length;++a){var i=o[a]>-e,s=o[a]<e,u=Math.exp(o[a]),l=void 0;l=s?u:i?o[a]:Math.log(1+u),r[a]=l}return Gt.make(t.shape,{values:r})},n.prototype.sin=function(t){this.assertNotComplex(t,"sin");for(var e=new Float32Array(t.size),r=t.dataSync(),o=0;o<r.length;++o)e[o]=Math.sin(r[o]);return Gt.make(t.shape,{values:e})},n.prototype.cos=function(t){this.assertNotComplex(t,"cos");for(var e=new Float32Array(t.size),r=t.dataSync(),o=0;o<r.length;++o)e[o]=Math.cos(r[o]);return Gt.make(t.shape,{values:e})},n.prototype.tan=function(t){this.assertNotComplex(t,"tan");for(var e=new Float32Array(t.size),r=t.dataSync(),o=0;o<r.length;++o)e[o]=Math.tan(r[o]);return Gt.make(t.shape,{values:e})},n.prototype.asin=function(t){this.assertNotComplex(t,"asin");for(var e=new Float32Array(t.size),r=t.dataSync(),o=0;o<r.length;++o)e[o]=Math.asin(r[o]);return Gt.make(t.shape,{values:e})},n.prototype.acos=function(t){this.assertNotComplex(t,"acos");for(var e=new Float32Array(t.size),r=t.dataSync(),o=0;o<r.length;++o)e[o]=Math.acos(r[o]);return Gt.make(t.shape,{values:e})},n.prototype.atan=function(t){this.assertNotComplex(t,"atan");for(var e=new Float32Array(t.size),r=t.dataSync(),o=0;o<r.length;++o)e[o]=Math.atan(r[o]);return Gt.make(t.shape,{values:e})},n.prototype.atan2=function(t,e){return this.assertNotComplex([t,e],"atan2"),this.broadcastedBinaryOp(t,e,t.dtype,function(r,o){return Math.atan2(r,o)})},n.prototype.sinh=function(t){this.assertNotComplex(t,"sinh");for(var e=new Float32Array(t.size),r=t.dataSync(),o=0;o<r.length;++o)e[o]=Math.sinh(r[o]);return Gt.make(t.shape,{values:e})},n.prototype.cosh=function(t){this.assertNotComplex(t,"cosh");for(var e=new Float32Array(t.size),r=t.dataSync(),o=0;o<r.length;++o)e[o]=Math.cosh(r[o]);return Gt.make(t.shape,{values:e})},n.prototype.tanh=function(t){this.assertNotComplex(t,"tanh");for(var e=new Float32Array(t.size),r=t.dataSync(),o=0;o<r.length;++o)e[o]=gK(r[o]);return Gt.make(t.shape,{values:e})},n.prototype.asinh=function(t){this.assertNotComplex(t,"asinh");for(var e=new Float32Array(t.size),r=t.dataSync(),o=0;o<r.length;++o)e[o]=Math.asinh(r[o]);return Gt.make(t.shape,{values:e})},n.prototype.acosh=function(t){this.assertNotComplex(t,"acosh");for(var e=new Float32Array(t.size),r=t.dataSync(),o=0;o<r.length;++o)e[o]=Math.acosh(r[o]);return Gt.make(t.shape,{values:e})},n.prototype.atanh=function(t){this.assertNotComplex(t,"atanh");for(var e=new Float32Array(t.size),r=t.dataSync(),o=0;o<r.length;++o)e[o]=Math.atanh(r[o]);return Gt.make(t.shape,{values:e})},n.prototype.erf=function(t){this.assertNotComplex(t,"erf");for(var e=new Float32Array(t.size),r=t.dataSync(),o=I4,a=R4,i=T4,s=N4,u=A4,l=_4,c=0;c<r.length;++c){var h=r[c],d=1/(1+o*h);e[c]=1-((((l*d+u)*d+s)*d+i)*d+a)*d*Math.exp(-h*h)}return Gt.make(t.shape,{values:e})},n.prototype.step=function(t,e){e===void 0&&(e=0),this.assertNotComplex(t,"step");for(var r=new Float32Array(t.size),o=t.dataSync(),a=0;a<o.length;++a){var i=o[a];isNaN(i)?r[a]=NaN:r[a]=i>0?1:e}return Gt.make(t.shape,{values:r})},n.prototype.conv2d=function(t,e,r){this.assertNotComplex([t,e],"conv2d");for(var o=r.filterHeight,a=r.filterWidth,i=r.dilationHeight,s=r.dilationWidth,u=r.padInfo.left,l=r.padInfo.top,c=Be(r.outShape,t.dtype),h=t.dataSync(),d=e.dataSync(),p=c.values,g=0;g<r.batchSize;++g)for(var x=g*t.strides[0],y=g*c.strides[0],b=0;b<r.outHeight;++b)for(var C=y+b*c.strides[1],E=b*r.strideHeight-u,S=0;S<o;S++){var k=E+S*i;if(!(k<0||k>=r.inHeight))for(var R=S*e.strides[0],A=x+k*t.strides[1],N=0;N<r.outWidth;++N)for(var _=C+N*r.outChannels,$=N*r.strideWidth-l,D=0;D<a;D++){var O=$+D*s;if(!(O<0||O>=r.inWidth))for(var P=R+D*e.strides[1],z=A+O*r.inChannels,W=P,F=0;F<r.inChannels;++F){for(var B=h[z+F],U=0;U<r.outChannels;++U)p[_+U]+=B*d[W+U];W+=r.outChannels}}}return c.toTensor()},n.prototype.conv3d=function(t,e,r){for(var o=r.filterDepth,a=r.filterHeight,i=r.filterWidth,s=r.dilationDepth,u=r.dilationHeight,l=r.dilationWidth,c=r.padInfo.front,h=r.padInfo.left,d=r.padInfo.top,p=Be(r.outShape,t.dtype),g=t.dataSync(),x=e.dataSync(),y=p.values,b=0;b<r.batchSize;++b)for(var C=b*t.strides[0],E=b*p.strides[0],S=0;S<r.outDepth;++S)for(var k=E+S*p.strides[1],R=S*r.strideDepth-c,A=0;A<o;A++){var N=R+A*s;if(!(N<0||N>=r.inDepth))for(var _=A*e.strides[0],$=C+N*t.strides[1],D=0;D<r.outHeight;++D)for(var O=k+D*p.strides[2],P=D*r.strideHeight-d,z=0;z<a;z++){var W=P+z*u;if(!(W<0||W>=r.inHeight))for(var F=_+z*e.strides[1],B=$+W*t.strides[2],U=0;U<r.outWidth;++U)for(var q=O+U*r.outChannels,M=U*r.strideWidth-h,G=0;G<i;G++){var Q=M+G*l;if(!(Q<0||Q>=r.inWidth))for(var Z=F+G*e.strides[2],rt=B+Q*r.inChannels,ct=Z,pt=0;pt<r.inChannels;++pt){for(var Rt=g[rt+pt],Ct=0;Ct<r.outChannels;++Ct)y[q+Ct]+=Rt*x[ct+Ct];ct+=r.outChannels}}}}return p.toTensor()},n.prototype.conv2dDerInput=function(t,e,r){this.assertNotComplex([t,e],"conv2dDerInput");for(var o=Be(r.inShape,"float32"),a=o.values,i=o.strides,s=i[0],u=i[1],l=i[2],c=t.dataSync(),h=t.strides,d=h[0],p=h[1],g=h[2],x=e.dataSync(),y=e.strides,b=y[0],C=y[1],E=y[2],S=r.batchSize,k=r.filterHeight,R=r.filterWidth,A=r.inChannels,N=r.inHeight,_=r.inWidth,$=r.outChannels,D=r.outHeight,O=r.outWidth,P=r.strideHeight,z=r.strideWidth,W=k-1-r.padInfo.top,F=R-1-r.padInfo.left,B=0;B<S;++B)for(var U=0;U<A;++U)for(var q=0;q<N;++q)for(var M=q-W,G=Math.max(0,Math.ceil(M/P)),Q=Math.min(D,(k+M)/P),Z=0;Z<_;++Z){for(var rt=Z-F,ct=Math.max(0,Math.ceil(rt/z)),pt=Math.min(O,(R+rt)/z),Rt=0,Ct=G;Ct<Q;++Ct)for(var Ft=Ct*P-M,Ut=ct;Ut<pt;++Ut)for(var Pt=d*B+p*Ct+g*Ut,Vt=b*(k-1-Ft)+C*(R-1-(Ut*z-rt))+E*U,Ht=0;Ht<$;++Ht)Rt+=c[Pt+Ht]*x[Vt+Ht];a[s*B+u*q+l*Z+U]=Rt}return o.toTensor()},n.prototype.conv3dDerInput=function(t,e,r){for(var o=Be(r.inShape,"float32"),a=o.values,i=o.strides,s=i[0],u=i[1],l=i[2],c=i[3],h=t.dataSync(),d=t.strides,p=d[0],g=d[1],x=d[2],y=d[3],b=e.dataSync(),C=e.strides,E=C[0],S=C[1],k=C[2],R=C[3],A=r.batchSize,N=r.filterDepth,_=r.filterHeight,$=r.filterWidth,D=r.inChannels,O=r.inDepth,P=r.inHeight,z=r.inWidth,W=r.outChannels,F=r.outDepth,B=r.outHeight,U=r.outWidth,q=r.strideDepth,M=r.strideHeight,G=r.strideWidth,Q=N-1-r.padInfo.front,Z=_-1-r.padInfo.top,rt=$-1-r.padInfo.left,ct=0;ct<A;++ct)for(var pt=0;pt<D;++pt)for(var Rt=0;Rt<O;++Rt)for(var Ct=Rt-Q,Ft=Math.max(0,Math.ceil(Ct/q)),Ut=Math.min(F,(N+Ct)/q),Pt=0;Pt<P;++Pt)for(var Vt=Pt-Z,Ht=Math.max(0,Math.ceil(Vt/M)),ee=Math.min(B,(_+Vt)/M),te=0;te<z;++te){for(var ne=te-rt,ge=Math.max(0,Math.ceil(ne/G)),we=Math.min(U,($+ne)/G),en=0,ze=Ft;ze<Ut;++ze)for(var un=ze*q-Ct,nn=Ht;nn<ee;++nn)for(var Gn=nn*M-Vt,Dn=ge;Dn<we;++Dn)for(var Bn=p*ct+g*ze+x*nn+y*Dn,cr=E*(N-1-un)+S*(_-1-Gn)+k*($-1-(Dn*G-ne))+R*pt,Ge=0;Ge<W;++Ge)en+=h[Bn+Ge]*b[cr+Ge];a[s*ct+u*Rt+l*Pt+c*te+pt]=en}return o.toTensor()},n.prototype.conv2dDerFilter=function(t,e,r){this.assertNotComplex([t,e],"conv2dDerFilter");for(var o=r.strideHeight,a=r.strideWidth,i=r.filterHeight,s=r.filterWidth,u=Be(r.filterShape,"float32"),l=r.padInfo.left,c=r.padInfo.top,h=t.bufferSync(),d=e.bufferSync(),p=0;p<i;++p)for(var g=Math.max(0,Math.ceil((c-p)/o)),x=Math.min(r.outHeight,(r.inHeight+c-p)/o),y=0;y<s;++y)for(var b=Math.max(0,Math.ceil((l-y)/a)),C=Math.min(r.outWidth,(r.inWidth+l-y)/a),E=0;E<r.inChannels;++E)for(var S=0;S<r.outChannels;++S){for(var k=0,R=0;R<r.batchSize;++R)for(var A=g;A<x;++A)for(var N=p+A*o-c,_=b;_<C;++_){var $=y+_*a-l;k+=h.get(R,N,$,E)*d.get(R,A,_,S)}u.set(k,p,y,E,S)}return u.toTensor()},n.prototype.conv3dDerFilter=function(t,e,r){for(var o=r.strideDepth,a=r.strideHeight,i=r.strideWidth,s=r.filterDepth,u=r.filterHeight,l=r.filterWidth,c=Be(r.filterShape,"float32"),h=c.values,d=c.strides,p=d[0],g=d[1],x=d[2],y=d[3],b=e.dataSync(),C=e.strides,E=C[0],S=C[1],k=C[2],R=C[3],A=t.dataSync(),N=t.strides,_=N[0],$=N[1],D=N[2],O=N[3],P=r.padInfo.front,z=r.padInfo.left,W=r.padInfo.top,F=0;F<s;++F)for(var B=Math.max(0,Math.ceil((P-F)/o)),U=Math.min(r.outDepth,(r.inDepth+P-F)/o),q=F*p,M=0;M<u;++M)for(var G=Math.max(0,Math.ceil((W-M)/a)),Q=Math.min(r.outHeight,(r.inHeight+W-M)/a),Z=M*g+q,rt=0;rt<l;++rt)for(var ct=Math.max(0,Math.ceil((z-rt)/i)),pt=Math.min(r.outWidth,(r.inWidth+z-rt)/i),Rt=rt*x+Z,Ct=0;Ct<r.inChannels;++Ct)for(var Ft=Ct*y+Rt,Ut=0;Ut<r.outChannels;++Ut){for(var Pt=0,Vt=0;Vt<r.batchSize;++Vt)for(var Ht=Vt*_,ee=Vt*E,te=B;te<U;++te)for(var ne=(F+te*o-P)*$+Ht,ge=te*S+ee,we=G;we<Q;++we)for(var en=(M+we*a-W)*D+ne,ze=we*k+ge,un=ct;un<pt;++un){var nn=un*R+ze;Pt+=A[(rt+un*i-z)*O+en+Ct]*b[nn+Ut]}h[Ft+Ut]=Pt}return c.toTensor()},n.prototype.depthwiseConv2D=function(t,e,r){this.assertNotComplex([t,e],"depthwiseConv2D");for(var o=r.filterHeight,a=r.filterWidth,i=r.dilationHeight,s=r.dilationWidth,u=r.padInfo.left,l=r.padInfo.top,c=r.outChannels/r.inChannels,h=Be(r.outShape,t.dtype),d=t.dataSync(),p=e.dataSync(),g=h.values,x=0;x<r.batchSize;++x)for(var y=x*t.strides[0],b=x*h.strides[0],C=0;C<r.outHeight;++C)for(var E=b+C*h.strides[1],S=C*r.strideHeight-u,k=0;k<o;++k){var R=S+k*i;if(!(R<0||R>=r.inHeight))for(var A=k*e.strides[0],N=y+R*t.strides[1],_=0;_<r.outWidth;++_)for(var $=E+_*h.strides[2],D=_*r.strideWidth-l,O=0;O<a;++O){var P=D+O*s;if(!(P<0||P>=r.inWidth))for(var z=A+O*e.strides[1],W=N+P*r.inChannels,F=$,B=z,U=0;U<r.inChannels;++U){for(var q=d[W+U],M=0;M<c;++M)g[F+M]+=q*p[B+M];F+=c,B+=c}}}return h.toTensor()},n.prototype.depthwiseConv2DDerInput=function(t,e,r){this.assertNotComplex([t,e],"depthwiseConv2DDerInput");for(var o=Be(r.inShape,"float32"),a=o.values,i=o.strides,s=i[0],u=i[1],l=i[2],c=t.dataSync(),h=t.strides,d=h[0],p=h[1],g=h[2],x=e.dataSync(),y=e.strides,b=y[0],C=y[1],E=y[2],S=r.batchSize,k=r.filterHeight,R=r.filterWidth,A=r.inChannels,N=r.inHeight,_=r.inWidth,$=r.outChannels,D=r.outHeight,O=r.outWidth,P=r.strideHeight,z=r.strideWidth,W=k-1-r.padInfo.top,F=R-1-r.padInfo.left,B=$/A,U=0;U<S;++U)for(var q=0;q<A;++q)for(var M=0;M<N;++M)for(var G=M-W,Q=Math.max(0,Math.ceil(G/P)),Z=Math.min(D,(k+G)/P),rt=0;rt<_;++rt){for(var ct=rt-F,pt=Math.max(0,Math.ceil(ct/z)),Rt=Math.min(O,(R+ct)/z),Ct=0,Ft=Q;Ft<Z;++Ft)for(var Ut=Ft*P-G,Pt=pt;Pt<Rt;++Pt)for(var Vt=d*U+p*Ft+g*Pt,Ht=b*(k-1-Ut)+C*(R-1-(Pt*z-ct))+E*q,ee=0;ee<B;++ee)Ct+=c[Vt+(q*B+ee)]*x[Ht+ee];a[s*U+u*M+l*rt+q]=Ct}return o.toTensor()},n.prototype.depthwiseConv2DDerFilter=function(t,e,r){this.assertNotComplex([t,e],"depthwiseConv2DDerFilter");for(var o=r.strideHeight,a=r.strideWidth,i=r.filterHeight,s=r.filterWidth,u=Be(r.filterShape,"float32"),l=r.padInfo.left,c=r.padInfo.top,h=r.outChannels/r.inChannels,d=t.bufferSync(),p=e.bufferSync(),g=0;g<i;++g)for(var x=Math.max(0,Math.ceil((c-g)/o)),y=Math.min(r.outHeight,(r.inHeight+c-g)/o),b=0;b<s;++b)for(var C=Math.max(0,Math.ceil((l-b)/a)),E=Math.min(r.outWidth,(r.inWidth+l-b)/a),S=0;S<r.outChannels;++S){for(var k=Math.trunc(S/h),R=S%h,A=0,N=0;N<r.batchSize;++N)for(var _=x;_<y;++_)for(var $=g+_*o-c,D=C;D<E;++D){var O=b+D*a-l;A+=d.get(N,$,O,k)*p.get(N,_,D,S)}u.set(A,g,b,k,R)}return u.toTensor()},n.prototype.tile=function(t,e){this.assertNotComplex(t,"tile");for(var r=new Array(t.rank),o=0;o<r.length;o++)r[o]=t.shape[o]*e[o];var a=Be(r,t.dtype),i=t.bufferSync();for(o=0;o<a.values.length;++o){for(var s=a.indexToLoc(o),u=new Array(t.rank),l=0;l<u.length;l++)u[l]=s[l]%t.shape[l];var c=i.locToIndex(u);a.values[o]=i.values[c]}return a.toTensor()},n.prototype.pad=function(t,e,r){this.assertNotComplex(t,"pad");var o=e.map(function(h,d){return h[0]+t.shape[d]+h[1]}),a=e.map(function(h){return h[0]}),i=t.bufferSync(),s=Be(o,t.dtype);r!==0&&s.values.fill(r);for(var u=0;u<t.size;u++){var l=i.indexToLoc(u),c=l.map(function(h,d){return h+a[d]});s.set.apply(s,[i.get.apply(i,l)].concat(c))}return s.toTensor()},n.prototype.transpose=function(t,e){this.assertNotComplex(t,"transpose");for(var r=new Array(t.rank),o=0;o<r.length;o++)r[o]=t.shape[e[o]];var a=t.dataSync(),i=Be(r,t.dtype),s=t.bufferSync();for(o=0;o<t.size;++o){for(var u=s.indexToLoc(o),l=new Array(u.length),c=0;c<l.length;c++)l[c]=u[e[c]];var h=i.locToIndex(l);i.values[h]=a[o]}return i.toTensor()},n.prototype.gather=function(t,e,r){this.assertNotComplex([t,e],"gather");var o=t.shape.slice(),a=e.dataSync();o[r]=a.length;for(var i=Be(o,t.dtype),s=t.bufferSync(),u=0;u<i.size;++u){var l=i.indexToLoc(u),c=l.slice();c[r]=a[l[r]];var h=s.locToIndex(c);i.values[u]=s.values[h]}return i.toTensor()},n.prototype.batchToSpaceND=function(t,e,r){this.assertNotComplex([t],"batchToSpaceND");var o=e.reduce(function(c,h){return c*h}),a=z0(t.shape,e,o),i=U0(a.length,e.length),s=W0(t.shape,e,o),u=a4(r,e.length),l=i4(s,r,e.length);return t.reshape(a).transpose(i).reshape(s).slice(u,l)},n.prototype.spaceToBatchND=function(t,e,r){this.assertNotComplex([t],"spaceToBatchND");var o=e.reduce(function(h,d){return h*d}),a=[[0,0]];a.push.apply(a,r);for(var i=1+e.length;i<t.shape.length;++i)a.push([0,0]);var s=t.pad(a),u=z0(s.shape,e,o,!1),l=U0(u.length,e.length,!1),c=W0(s.shape,e,o,!1);return s.reshape(u).transpose(l).reshape(c)},n.prototype.pool=function(t,e,r){this.assertNotComplex(t,"pool");for(var o=e.strideHeight,a=e.strideWidth,i=e.dilationHeight,s=e.dilationWidth,u=e.effectiveFilterHeight,l=e.effectiveFilterWidth,c=e.padInfo.top,h=e.padInfo.left,d=r==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,p=t.dataSync(),g=Be(e.outShape,t.dtype),x=g.values,y=e.outShape[1]*e.outShape[2]*e.outShape[3],b=e.outShape[2]*e.outShape[3],C=e.outShape[3],E=0;E<e.batchSize;++E)for(var S=E*y,k=E*t.strides[0],R=0;R<e.inChannels;++R)for(var A=0;A<e.outHeight;++A)for(var N=A*o-c,_=Math.max(0,N),$=Math.min(e.inHeight,u+N),D=S+A*b,O=0;O<e.outWidth;++O){for(var P=O*a-h,z=Math.max(0,P),W=Math.min(e.inWidth,l+P),F=d,B=0,U=0,q=_;q<$;q+=i){for(var M=k+q*t.strides[1],G=z;G<W;G+=s){var Q=p[M+G*t.strides[2]+R];r==="max"&&Q>F?F=Q:r==="avg"&&(B+=Q,U++)}if(isNaN(F))break}x[D+O*C+R]=r==="avg"?B/U:F}return g.toTensor()},n.prototype.maxPool=function(t,e){return this.pool(t,e,"max")},n.prototype.maxPoolPositions=function(t,e){for(var r=Be(e.outShape,"int32"),o=e.strideHeight,a=e.strideWidth,i=e.dilationHeight,s=e.dilationWidth,u=e.effectiveFilterHeight,l=e.effectiveFilterWidth,c=e.padInfo.top,h=e.padInfo.left,d=t.bufferSync(),p=0;p<e.batchSize;++p)for(var g=0;g<e.inChannels;++g)for(var x=0;x<e.outHeight;++x){for(var y=x*o-c,b=y;b<0;)b+=i;for(var C=Math.min(e.inHeight,u+y),E=0;E<e.outWidth;++E){for(var S=E*a-h,k=S;k<0;)k+=s;for(var R=Math.min(e.inWidth,l+S),A=Number.NEGATIVE_INFINITY,N=-1,_=b;_<C;_+=i)for(var $=_-y,D=k;D<R;D+=s){var O=D-S,P=d.get(p,_,D,g);P>A&&(A=P,N=$*l+O)}r.set(N,p,x,E,g)}}return r.toTensor()},n.prototype.maxPoolBackprop=function(t,e,r,o){this.assertNotComplex([e,r],"maxPoolBackprop");for(var a=this.maxPoolPositions(e,o),i=o.strideHeight,s=o.strideWidth,u=o.dilationHeight,l=o.dilationWidth,c=o.effectiveFilterHeight,h=o.effectiveFilterWidth,d=h-1-o.padInfo.left,p=c-1-o.padInfo.top,g=Be(e.shape,"float32"),x=a.bufferSync(),y=t.bufferSync(),b=0;b<o.batchSize;++b)for(var C=0;C<o.inChannels;++C)for(var E=0;E<o.inHeight;++E)for(var S=0;S<o.inWidth;++S){for(var k=E-p,R=S-d,A=0,N=0;N<c;N+=u){var _=(k+N)/i;if(!(_<0||_>=o.outHeight||Math.floor(_)!==_))for(var $=0;$<h;$+=l){var D=(R+$)/s;if(!(D<0||D>=o.outWidth||Math.floor(D)!==D)){var O=c*h-1-x.get(b,_,D,C)===N*h+$?1:0;O!==0&&(A+=y.get(b,_,D,C)*O)}}}g.set(A,b,E,S,C)}return g.toTensor()},n.prototype.avgPoolBackprop=function(t,e,r){this.assertNotComplex([t,e],"avgPoolBackprop");for(var o=r.strideHeight,a=r.strideWidth,i=r.filterHeight,s=r.filterWidth,u=r.dilationHeight,l=r.dilationWidth,c=r.effectiveFilterHeight,h=r.effectiveFilterWidth,d=h-1-r.padInfo.left,p=c-1-r.padInfo.top,g=Be(e.shape,"float32"),x=1/(i*s),y=t.bufferSync(),b=0;b<r.batchSize;++b)for(var C=0;C<r.inChannels;++C)for(var E=0;E<r.inHeight;++E)for(var S=0;S<r.inWidth;++S){for(var k=E-p,R=S-d,A=0,N=0;N<c;N+=u){var _=(k+N)/o;if(!(_<0||_>=r.outHeight||Math.floor(_)!==_))for(var $=0;$<h;$+=l){var D=(R+$)/a;D<0||D>=r.outWidth||Math.floor(D)!==D||(A+=y.get(b,_,D,C))}}g.set(A*x,b,E,S,C)}return g.toTensor()},n.prototype.cast=function(t,e){return m4(t,e,this)},n.prototype.reshape=function(t,e){return US(t,e)},n.prototype.avgPool=function(t,e){return this.assertNotComplex(t,"avgPool"),this.pool(t,e,"avg").toFloat()},n.prototype.resizeBilinear=function(t,e,r,o){this.assertNotComplex(t,"resizeBilinear");for(var a=t.shape,i=a[0],s=a[1],u=a[2],l=a[3],c=t.dataSync(),h=new Float32Array(de([i,e,r,l])),d=[o&&e>1?s-1:s,o&&r>1?u-1:u],p=[o&&e>1?e-1:e,o&&r>1?r-1:r],g=0,x=d[0]/p[0],y=d[1]/p[1],b=0;b<i;b++)for(var C=0;C<e;C++)for(var E=x*C,S=Math.floor(E),k=E-S,R=Math.min(s-1,Math.ceil(E)),A=b*t.strides[0]+S*t.strides[1],N=b*t.strides[0]+R*t.strides[1],_=0;_<r;_++)for(var $=y*_,D=Math.floor($),O=$-D,P=Math.min(u-1,Math.ceil($)),z=A+D*t.strides[2],W=N+D*t.strides[2],F=A+ +P*t.strides[2],B=N+P*t.strides[2],U=0;U<l;U++){var q=c[z+U],M=c[W+U],G=q+(c[F+U]-q)*O,Q=G+(M+(c[B+U]-M)*O-G)*k;h[g++]=Q}return dr(h,[i,e,r,l])},n.prototype.resizeBilinearBackprop=function(t,e,r){this.assertNotComplex([t,e],"resizeBilinearBackprop");for(var o=e.shape,a=o[0],i=o[1],s=o[2],u=o[3],l=t.shape,c=l[1],h=l[2],d=new Float32Array(a*i*s*u),p=[r&&c>1?i-1:i,r&&h>1?s-1:s],g=[r&&c>1?c-1:c,r&&h>1?h-1:h],x=p[0]/g[0],y=p[1]/g[1],b=t.dataSync(),C=0,E=0;E<a;E++)for(var S=E*e.strides[0],k=0;k<c;k++)for(var R=k*x,A=Math.floor(R),N=Math.min(Math.ceil(R),i-1),_=S+A*e.strides[1],$=S+N*e.strides[1],D=R-A,O=1-D,P=0;P<h;P++)for(var z=P*y,W=Math.floor(z),F=Math.min(Math.ceil(z),s-1),B=z-W,U=1-B,q=_+W*e.strides[2],M=_+F*e.strides[2],G=$+W*e.strides[2],Q=$+F*e.strides[2],Z=O*U,rt=O*B,ct=D*U,pt=D*B,Rt=0;Rt<u;Rt++){var Ct=b[C++];d[q+Rt]+=Ct*Z,d[M+Rt]+=Ct*rt,d[G+Rt]+=Ct*ct,d[Q+Rt]+=Ct*pt}return oi(d,[a,s,i,u],e.dtype)},n.prototype.resizeNearestNeighbor=function(t,e,r,o){this.assertNotComplex(t,"resizeNearestNeighbor");for(var a=t.shape,i=a[0],s=a[1],u=a[2],l=a[3],c=t.dataSync(),h=new Float32Array(i*e*r*l),d=[o&&e>1?s-1:s,o&&r>1?u-1:u],p=[o&&e>1?e-1:e,o&&r>1?r-1:r],g=d[0]/p[0],x=d[1]/p[1],y=0,b=0;b<i;b++)for(var C=b*t.strides[0],E=0;E<e;E++)for(var S=g*E,k=C+Math.min(s-1,o?Math.round(S):Math.floor(S))*t.strides[1],R=0;R<r;R++)for(var A=x*R,N=k+Math.min(u-1,o?Math.round(A):Math.floor(A))*t.strides[2],_=0;_<l;_++){var $=c[N+_];h[y++]=$}return dr(h,[i,e,r,l],t.dtype)},n.prototype.resizeNearestNeighborBackprop=function(t,e,r){this.assertNotComplex([t,e],"resizeNearestNeighborBackprop");for(var o=e.shape,a=o[0],i=o[1],s=o[2],u=o[3],l=t.shape,c=l[1],h=l[2],d=new Float32Array(a*i*s*u),p=t.dataSync(),g=[r&&c>1?i-1:i,r&&h>1?s-1:s],x=[r&&c>1?c-1:c,r&&h>1?h-1:h],y=g[0]/x[0],b=g[1]/x[1],C=1/y,E=1/b,S=2*Math.ceil(C)+2,k=2*Math.ceil(E)+2,R=0;R<a;R++)for(var A=R*e.strides[0],N=0;N<i;N++)for(var _=A+N*e.strides[1],$=Math.floor(N*C),D=Math.floor($-S/2),O=0;O<s;O++)for(var P=_+O*e.strides[2],z=Math.floor(O*E),W=Math.floor(z-k/2),F=0;F<u;F++){for(var B=0,U=0;U<S;U++){var q=U+D;if(!(q<0||q>=c)){var M=A+q*t.strides[1],G=q*y;if(N===Math.min(i-1,r?Math.round(G):Math.floor(G)))for(var Q=0;Q<k;Q++){var Z=Q+W;if(!(Z<0||Z>=h)){var rt=M+Z*t.strides[2],ct=Z*b;O===Math.min(s-1,r?Math.round(ct):Math.floor(ct))&&(B+=p[rt+F])}}}}d[P+F]=B}return oi(d,e.shape,e.dtype)},n.prototype.batchNormalization=function(t,e,r,o,a,i){this.assertNotComplex([t,e,r,a,i],"batchNorm");for(var s=t.dataSync(),u=e.dataSync(),l=r.dataSync(),c=a?a.dataSync():new Float32Array([1]),h=i?i.dataSync():new Float32Array([0]),d=new Float32Array(s.length),p=h.length,g=c.length,x=l.length,y=u.length,b=0,C=0,E=0,S=0,k=0;k<s.length;++k)d[k]=h[b++]+(s[k]-u[C++])*c[E++]/Math.sqrt(l[S++]+o),b>=p&&(b=0),C>=y&&(C=0),E>=g&&(E=0),S>=x&&(S=0);return oi(d,t.shape)},n.prototype.localResponseNormalization4D=function(t,e,r,o,a){this.assertNotComplex(t,"localResponseNormalization4D");var i=t.shape[3],s=i-1,u=t.dataSync(),l=t.size,c=new Float32Array(l);function h(x){for(var y=x%i,b=x-y+Math.max(0,y-e),C=x-y+Math.min(y+e,s),E=0;b<=C;b++){var S=u[b];E+=S*S}return E}for(var d=0;d<l;d++){var p=h(d),g=u[d]*Math.pow(r+o*p,-a);c[d]=g}return oi(c,t.shape)},n.prototype.LRNGrad=function(t,e,r,o,a,i,s){this.assertNotComplex(t,"LRNGrad");for(var u=t.shape[3],l=t.dataSync(),c=e.dataSync(),h=r.dataSync(),d=new Float32Array(t.size),p=t.size,g=0;g<p;g++){for(var x=g%u,y=g-x+Math.max(0,x-o),b=g-x+Math.min(u,x+o+1),C=0,E=y;E<b;E++)C+=Math.pow(c[E],2);for(C=i*C+a,E=y;E<b;E++){var S=-2*i*s*c[E]*h[g]/C;g===E&&(S+=Math.pow(C,-s)),S*=l[g],d[E]+=S}}return oi(d,t.shape)},n.prototype.multinomial=function(t,e,r,o){this.assertNotComplex(t,"multinomial");for(var a=e?t:ml(t),i=a.shape[0],s=a.shape[1],u=ir([i,r],"int32"),l=u.dataSync(),c=a.dataSync(),h=0;h<i;++h){var d=h*s,p=new Float32Array(s-1);p[0]=c[d];for(var g=1;g<p.length;++g)p[g]=p[g-1]+c[d+g];for(var x=O4(o.toString()),y=h*r,b=0;b<r;++b){var C=x();l[y+b]=p.length;for(var E=0;E<p.length;E++)if(C<p[E]){l[y+b]=E;break}}}return u},n.prototype.oneHot=function(t,e,r,o){this.assertNotComplex(t,"oneHot");var a=new Float32Array(t.size*e);a.fill(o);for(var i=t.dataSync(),s=0;s<t.size;++s)i[s]>=0&&i[s]<e&&(a[s*e+i[s]]=r);return Xy(a,[t.size,e],"int32")},n.prototype.nonMaxSuppression=function(t,e,r,o,a){return this.assertNotComplex(t,"nonMaxSuppression"),mk(t.dataSync(),e.dataSync(),r,o,a)},n.prototype.fft=function(t){return this.fftBatch(t,!1)},n.prototype.ifft=function(t){return this.fftBatch(t,!0)},n.prototype.fftBatch=function(t,e){for(var r=t.shape[0],o=t.shape[1],a=Be(t.shape,"float32"),i=Be(t.shape,"float32"),s=Gi(t).as2D(r,o),u=Vu(t).as2D(r,o),l=0;l<r;l++)for(var c=s.slice([l,0],[1,o]),h=u.slice([l,0],[1,o]),d=ko(c,h),p=this.fftImpl(d,e).dataSync(),g=0;g<o;g++){var x=D$(p,g);a.values[l*o+g]=x.real,i.values[l*o+g]=x.imag}return ko(a.toTensor(),i.toTensor()).as2D(r,o)},n.prototype.fftImpl=function(t,e){var r=t.as1D(),o=r.size;if(this.isExponentOf2(o)){var a=this.fftRadix2(r,o,e).as2D(t.shape[0],t.shape[1]);return e&&(a=ko(Gi(a).div(zt(o)),Vu(a).div(zt(o)))),a}var i=t.dataSync(),s=k8(this.fourierTransformByMatmul(i,o,e));return ko(s.real,s.imag).as2D(t.shape[0],t.shape[1])},n.prototype.isExponentOf2=function(t){return(t&t-1)==0},n.prototype.fftRadix2=function(t,e,r){if(e===1)return t;var o=t.dataSync(),a=e/2,i=I8(o),s=ko(i.real,i.imag).as1D(),u=R8(o),l=ko(u.real,u.imag).as1D();s=this.fftRadix2(s,a,r),l=this.fftRadix2(l,a,r);var c=N8(e,r),h=ko(c.real,c.imag).mul(l),d=s.add(h),p=s.sub(h),g=Gi(d).concat(Gi(p)),x=Vu(d).concat(Vu(p));return ko(g,x).as1D()},n.prototype.fourierTransformByMatmul=function(t,e,r){for(var o=new Float32Array(2*e),a=0;a<e;a++){for(var i=0,s=0,u=0;u<e;u++){var l=A8(a*u,e,r),c=D$(t,u);i+=c.real*l.real-c.imag*l.imag,s+=c.real*l.imag+c.imag*l.real}r&&(i/=e,s/=e),T8(o,i,s,a)}return o},n.prototype.depthToSpace=function(t,e,r){et(r==="NHWC",function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+r}),et(e>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+e});for(var o=t.shape[0],a=t.shape[1],i=t.shape[2],s=t.shape[3],u=a*e,l=i*e,c=s/(e*e),h=t.dataSync(),d=new Float32Array(o*u*l*c),p=0,g=0;g<o;++g)for(var x=0;x<u;++x)for(var y=Math.floor(x/e),b=x%e,C=0;C<l;++C)for(var E=Math.floor(C/e),S=(b*e+C%e)*c,k=0;k<c;++k){var R=k+S+s*(E+i*(y+a*g));d[p++]=h[R]}return oi(d,[o,u,l,c])},n.prototype.broadcastedBinaryOp=function(t,e,r,o){var a=qe(t.shape,e.shape),i=Be(a,r),s=t.dataSync(),u=e.dataSync(),l=df(t.shape,a),c=df(e.shape,a),h=i.values;if(l.length+c.length===0)for(var d=0;d<h.length;++d)h[d]=o(s[d%s.length],u[d%u.length]);else{var p=t.bufferSync(),g=e.bufferSync(),x=function(y){var b=i.indexToLoc(y),C=b.slice(-t.rank);l.forEach(function(R){return C[R]=0});var E=p.locToIndex(C),S=b.slice(-e.rank);c.forEach(function(R){return S[R]=0});var k=g.locToIndex(S);h[y]=o(s[E],u[k])};for(d=0;d<h.length;++d)x(d)}return i.toTensor()},n.prototype.broadcastedBinaryComplexOp=function(t,e,r){var o=qe(t.shape,e.shape),a=Be(o,"float32"),i=Be(o,"float32"),s=t.dataSync(),u=e.dataSync(),l=df(t.shape,o),c=df(e.shape,o),h=a.values,d=i.values;if(l.length+c.length===0)for(var p=0;p<h.length;p++){var g=p%s.length,x=p%u.length,y=r(s[2*g],s[2*g+1],u[2*x],u[2*x+1]);h[p]=y.real,d[p]=y.imag}else{var b=this.data.get(t.dataId).complexTensors.real.bufferSync(),C=this.data.get(e.dataId).complexTensors.real.bufferSync(),E=function(S){var k=a.indexToLoc(S),R=k.slice(-t.rank);l.forEach(function(D){return R[D]=0});var A=b.locToIndex(R),N=k.slice(-e.rank);c.forEach(function(D){return N[D]=0});var _=C.locToIndex(N),$=r(s[2*A],s[2*A+1],u[2*_],u[2*_+1]);h[S]=$.real,d[S]=$.imag};for(p=0;p<h.length;p++)E(p)}return this.complex(a.toTensor(),i.toTensor())},n.prototype.split=function(t,e,r){return v4(t,e,r)},n.prototype.dispose=function(){},n.prototype.floatPrecision=function(){return 32},n.prototype.cropAndResize=function(t,e,r,o,a,i){for(var s=t.shape,u=s[0],l=s[1],c=s[2],h=s[3],d=e.shape[0],p=o[0],g=o[1],x=Be([d,p,g,h],t.dtype),y=e.dataSync(),b=r.dataSync(),C=t.dataSync(),E=t.strides,S=x.strides,k=0;k<d;k++){var R=4*k,A=y[R],N=y[R+1],_=y[R+2],$=y[R+3],D=b[k];if(!(D>=u))for(var O=p>1?(_-A)*(l-1)/(p-1):0,P=g>1?($-N)*(c-1)/(g-1):0,z=0;z<p;z++){var W=p>1?A*(l-1)+z*O:.5*(A+_)*(l-1);if(W<0||W>l-1)for(var F=0;F<g;F++)for(var B=0;B<h;B++){var U=B+F*S[2]+z*S[1]+k*S[0];x.values[U]=i}else if(a==="bilinear"){var q=Math.floor(W),M=Math.ceil(W),G=W-q;for(F=0;F<g;F++)if((Ut=g>1?N*(c-1)+F*P:.5*(N+$)*(c-1))<0||Ut>c-1)for(B=0;B<h;B++)U=B+F*S[2]+z*S[1]+k*S[0],x.values[U]=i;else{var Q=Math.floor(Ut),Z=Math.ceil(Ut),rt=Ut-Q;for(B=0;B<h;B++){var ct=C[U=B+Q*E[2]+q*E[1]+D*E[0]],pt=C[U=B+Z*E[2]+q*E[1]+D*E[0]],Rt=C[U=B+Q*E[2]+M*E[1]+D*E[0]],Ct=ct+(pt-ct)*rt,Ft=Rt+(C[U=B+Z*E[2]+M*E[1]+D*E[0]]-Rt)*rt;U=B+F*S[2]+z*S[1]+k*S[0],x.values[U]=Ct+(Ft-Ct)*G}}}else for(F=0;F<g;++F){var Ut;if((Ut=g>1?N*(c-1)+F*P:.5*(N+$)*(c-1))<0||Ut>c-1)for(B=0;B<h;B++)U=B+F*S[2]+z*S[1]+k*S[0],x.values[U]=i;else{var Pt=Math.round(Ut),Vt=Math.round(W);for(B=0;B<h;B++){var Ht=B+Pt*E[2]+Vt*E[1]+D*E[0],ee=B+F*S[2]+z*S[1]+k*S[0];x.values[ee]=C[Ht]}}}}}return x.toTensor()},n.prototype.sparseToDense=function(t,e,r,o){var a=V0(e,t,r),i=a.sliceRank,s=a.numUpdates,u=a.sliceSize,l=a.strides,c=a.outputSize;return this.scatter(t,e,r,c,u,s,i,l,o,!1)},n.prototype.gatherND=function(t,e){var r=e.shape,o=r[r.length-1],a=u4(t,e),i=a[0],s=a[1],u=a[2],l=a[3];if(s===0)return dr([],i,t.dtype);for(var c=new tm([s,u],t.dtype),h=e.dataSync(),d=t.dataSync(),p=0;p<s;p++){for(var g=[],x=0,y=0;y<o;y++){var b=h[p*o+y];x+=b*l[y],g.push(b)}if(x<0||x>=t.size/u)throw new Error("Invalid indices: "+g+" does not index into "+t.shape);for(var C=0;C<u;C++)c.values[p*u+C]=d[x*u+C]}return c.toTensor().reshape(i)},n.prototype.scatterND=function(t,e,r){var o=V0(e,t,r),a=o.sliceRank,i=o.numUpdates,s=o.sliceSize,u=o.strides,l=o.outputSize,c=zt(0);return this.scatter(t,e,r,l,s,i,a,u,c,!0)},n.prototype.fill=function(t,e,r){var o=L0(r=r||Sm(e),de(t));return o.fill(e),Gt.make(t,{values:o},r)},n.prototype.onesLike=function(t){if(t.dtype==="string")throw new Error("onesLike is not supported for string tensors");return this.fill(t.shape,1,t.dtype)},n.prototype.zerosLike=function(t){var e=L0(t.dtype,de(t.shape));return Gt.make(t.shape,{values:e},t.dtype)},n.prototype.scatter=function(t,e,r,o,a,i,s,u,l,c){var h=[o/a,a],d=t.dataSync(),p=e.dataSync();if(o===0)return dr([],r,e.dtype);var g=new tm(h,e.dtype);g.values.fill(l.dataSync()[0]);for(var x=0;x<i;x++){for(var y=[],b=0,C=0;C<s;C++){var E=d[x*s+C];y.push(E),b+=E*u[C]}if(b<0||b>=o/a)throw new Error("Invalid indices: "+y+" does not index into "+r);for(var S=0;S<a;S++)c?g.values[b*a+S]+=p[x*a+S]:g.values[b*a+S]=e.rank===0?p[0]:p[x*a+S]}return g.toTensor().reshape(r)},n}();Y.registerBackend("cpu",function(){return new vot},1);var Nk=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function eO(n){return Nk?Buffer.byteLength(n):new Blob([n]).size}function xot(n){return Nk?Buffer.from(n).toString("base64"):btoa(String.fromCharCode.apply(null,new Uint8Array(n)))}function yot(n){if(Nk){var t=Buffer.from(n,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}for(var e=atob(n),r=new Uint8Array(e.length),o=0;o<e.length;++o)r.set([e.charCodeAt(o)],o);return r.buffer}function bot(n){var t=0;n.forEach(function(o){t+=o.byteLength});var e=new Uint8Array(t),r=0;return n.forEach(function(o){e.set(new Uint8Array(o),r),r+=o.byteLength}),e.buffer}function Qy(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:n.modelTopology==null?0:eO(JSON.stringify(n.modelTopology)),weightSpecsBytes:n.weightSpecs==null?0:eO(JSON.stringify(n.weightSpecs)),weightDataBytes:n.weightData==null?0:n.weightData.byteLength}}var Sc=function(){function n(){this.saveRouters=[],this.loadRouters=[]}return n.getInstance=function(){return n.instance==null&&(n.instance=new n),n.instance},n.registerSaveRouter=function(t){n.getInstance().saveRouters.push(t)},n.registerLoadRouter=function(t){n.getInstance().loadRouters.push(t)},n.getSaveHandlers=function(t){return n.getHandlers(t,"save")},n.getLoadHandlers=function(t,e){return n.getHandlers(t,"load",e)},n.getHandlers=function(t,e,r){var o=[];return(e==="load"?n.getInstance().loadRouters:n.getInstance().saveRouters).forEach(function(a){var i=a(t,r);i!==null&&o.push(i)}),o},n}(),nO="://",mL=function(){function n(){this.managers={}}return n.getInstance=function(){return n.instance==null&&(n.instance=new n),n.instance},n.registerManager=function(t,e){et(t!=null,function(){return"scheme must not be undefined or null."}),t.endsWith(nO)&&(t=t.slice(0,t.indexOf(nO))),et(t.length>0,function(){return"scheme must not be an empty string."});var r=n.getInstance();et(r.managers[t]==null,function(){return"A model store manager is already registered for scheme '"+t+"'."}),r.managers[t]=e},n.getManager=function(t){var e=this.getInstance().managers[t];if(e==null)throw new Error("Cannot find model manager for scheme '"+t+"'");return e},n.getSchemes=function(){return Object.keys(this.getInstance().managers)},n}(),qS="tensorflowjs",jS=1,uc="models_store",Gu="model_info_store";function gL(){if(!Y.get("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var n=window,t=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(t==null)throw new Error("The current browser does not appear to support IndexedDB.");return t}function XS(n){var t=n.result;t.createObjectStore(uc,{keyPath:"modelPath"}),t.createObjectStore(Gu,{keyPath:"modelPath"})}var Of=function(){function n(t){if(this.indexedDB=gL(),t==null||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}return n.prototype.save=function(t){return bn(this,void 0,void 0,function(){return wn(this,function(e){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,t)]})})},n.prototype.load=function(){return bn(this,void 0,void 0,function(){return wn(this,function(t){return[2,this.databaseAction(this.modelPath)]})})},n.prototype.databaseAction=function(t,e){var r=this;return new Promise(function(o,a){var i=r.indexedDB.open(qS,jS);i.onupgradeneeded=function(){return XS(i)},i.onsuccess=function(){var s=i.result;if(e==null){var u=s.transaction(uc,"readonly"),l=u.objectStore(uc).get(r.modelPath);l.onsuccess=function(){if(l.result==null)return s.close(),a(new Error("Cannot find model with path '"+r.modelPath+"' in IndexedDB."));o(l.result.modelArtifacts)},l.onerror=function(x){return s.close(),a(l.error)},u.oncomplete=function(){return s.close()}}else{var c,h=Qy(e),d=s.transaction(Gu,"readwrite"),p=d.objectStore(Gu),g=p.put({modelPath:r.modelPath,modelArtifactsInfo:h});g.onsuccess=function(){var x=(c=s.transaction(uc,"readwrite")).objectStore(uc).put({modelPath:r.modelPath,modelArtifacts:e,modelArtifactsInfo:h});x.onsuccess=function(){return o({modelArtifactsInfo:h})},x.onerror=function(y){var b=(p=d.objectStore(Gu)).delete(r.modelPath);b.onsuccess=function(){return s.close(),a(x.error)},b.onerror=function(C){return s.close(),a(x.error)}}},g.onerror=function(x){return s.close(),a(g.error)},d.oncomplete=function(){c==null?s.close():c.oncomplete=function(){return s.close()}}}},i.onerror=function(s){return a(i.error)}})},n.URL_SCHEME="indexeddb://",n}(),rO=function(n){return Y.get("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Of.URL_SCHEME)?wot(n.slice(Of.URL_SCHEME.length)):null};function wot(n){return new Of(n)}function Cot(n){return n.startsWith(Of.URL_SCHEME)?n.slice(Of.URL_SCHEME.length):n}Sc.registerSaveRouter(rO),Sc.registerLoadRouter(rO);var Sot=function(){function n(){this.indexedDB=gL()}return n.prototype.listModels=function(){return bn(this,void 0,void 0,function(){var t=this;return wn(this,function(e){return[2,new Promise(function(r,o){var a=t.indexedDB.open(qS,jS);a.onupgradeneeded=function(){return XS(a)},a.onsuccess=function(){var i=a.result,s=i.transaction(Gu,"readonly"),u=s.objectStore(Gu).getAll();u.onsuccess=function(){for(var l={},c=0,h=u.result;c<h.length;c++){var d=h[c];l[d.modelPath]=d.modelArtifactsInfo}r(l)},u.onerror=function(l){return i.close(),o(u.error)},s.oncomplete=function(){return i.close()}},a.onerror=function(i){return o(a.error)}})]})})},n.prototype.removeModel=function(t){return bn(this,void 0,void 0,function(){var e=this;return wn(this,function(r){return t=Cot(t),[2,new Promise(function(o,a){var i=e.indexedDB.open(qS,jS);i.onupgradeneeded=function(){return XS(i)},i.onsuccess=function(){var s,u=i.result,l=u.transaction(Gu,"readwrite"),c=l.objectStore(Gu),h=c.get(t);h.onsuccess=function(){if(h.result==null)return u.close(),a(new Error("Cannot find model with path '"+t+"' in IndexedDB."));var d=c.delete(t),p=function(){var g=(s=u.transaction(uc,"readwrite")).objectStore(uc).delete(t);g.onsuccess=function(){return o(h.result.modelArtifactsInfo)},g.onerror=function(x){return a(h.error)}};d.onsuccess=p,d.onerror=function(g){return p(),u.close(),a(h.error)}},h.onerror=function(d){return u.close(),a(h.error)},l.oncomplete=function(){s==null?u.close():s.oncomplete=function(){return u.close()}}},i.onerror=function(s){return a(i.error)}})]})})},n}();if(Y.get("IS_BROWSER"))try{mL.registerManager(Of.URL_SCHEME,new Sot)}catch{}var Bs="/",of="tensorflowjs_models",vL="info",Eot="model_topology",kot="weight_specs",Iot="weight_data",Rot="model_metadata";function xL(n){return{info:[of,n,vL].join(Bs),topology:[of,n,Eot].join(Bs),weightSpecs:[of,n,kot].join(Bs),weightData:[of,n,Iot].join(Bs),modelMetadata:[of,n,Rot].join(Bs)}}function Tot(n){var t=n.split(Bs);if(t.length<3)throw new Error("Invalid key format: "+n);return t.slice(1,t.length-1).join(Bs)}function Not(n){return n.startsWith(Ff.URL_SCHEME)?n.slice(Ff.URL_SCHEME.length):n}var Ff=function(){function n(t){if(!Y.get("IS_BROWSER")||window.localStorage===void 0)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,t==null||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=xL(this.modelPath)}return n.prototype.save=function(t){return bn(this,void 0,void 0,function(){var e,r,o;return wn(this,function(a){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");e=JSON.stringify(t.modelTopology),r=JSON.stringify(t.weightSpecs),o=Qy(t);try{return this.LS.setItem(this.keys.info,JSON.stringify(o)),this.LS.setItem(this.keys.topology,e),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,xot(t.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy})),[2,{modelArtifactsInfo:o}]}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+o.modelTopologyBytes+", weightSpecsBytes="+o.weightSpecsBytes+", weightDataBytes="+o.weightDataBytes+".")}return[2]})})},n.prototype.load=function(){return bn(this,void 0,void 0,function(){var t,e,r,o,a,i,s;return wn(this,function(u){if((t=JSON.parse(this.LS.getItem(this.keys.info)))==null)throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if(t.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(e={},(r=JSON.parse(this.LS.getItem(this.keys.topology)))==null)throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(e.modelTopology=r,(o=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))==null)throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(e.weightSpecs=o,(a=this.LS.getItem(this.keys.modelMetadata))!=null&&(i=JSON.parse(a),e.format=i.format,e.generatedBy=i.generatedBy,e.convertedBy=i.convertedBy),(s=this.LS.getItem(this.keys.weightData))==null)throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return e.weightData=yot(s),[2,e]})})},n.URL_SCHEME="localstorage://",n}(),oO=function(n){return Y.get("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Ff.URL_SCHEME)?Aot(n.slice(Ff.URL_SCHEME.length)):null};function Aot(n){return new Ff(n)}Sc.registerSaveRouter(oO),Sc.registerLoadRouter(oO);var _ot=function(){function n(){et(Y.get("IS_BROWSER"),function(){return"Current environment is not a web browser"}),et(window.localStorage!==void 0,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return n.prototype.listModels=function(){return bn(this,void 0,void 0,function(){var t,e,r,o,a,i;return wn(this,function(s){for(t={},e=of+Bs,r=Bs+vL,o=0;o<this.LS.length;++o)(a=this.LS.key(o)).startsWith(e)&&a.endsWith(r)&&(i=Tot(a),t[i]=JSON.parse(this.LS.getItem(a)));return[2,t]})})},n.prototype.removeModel=function(t){return bn(this,void 0,void 0,function(){var e,r;return wn(this,function(o){if(t=Not(t),e=xL(t),this.LS.getItem(e.info)==null)throw new Error("Cannot find model at path '"+t+"'");return r=JSON.parse(this.LS.getItem(e.info)),this.LS.removeItem(e.info),this.LS.removeItem(e.topology),this.LS.removeItem(e.weightSpecs),this.LS.removeItem(e.weightData),[2,r]})})},n}();if(Y.get("IS_BROWSER"))try{mL.registerManager(Ff.URL_SCHEME,new _ot)}catch{}var Dot="model",$ot=".json",Oot=".weights.bin",KS=function(){function n(t){if(!Y.get("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(n.URL_SCHEME)&&(t=t.slice(n.URL_SCHEME.length)),t!=null&&t.length!==0||(t=Dot),this.modelTopologyFileName=t+$ot,this.weightDataFileName=t+Oot}return n.prototype.save=function(t){return bn(this,void 0,void 0,function(){var e,r,o,a,i,s;return wn(this,function(u){if(e=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"})),t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");return r=[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}],o={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:r},a=window.URL.createObjectURL(new Blob([JSON.stringify(o)],{type:"application/json"})),(i=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,i.href=a,i.click(),t.weightData!=null&&((s=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,s.href=e,s.click()),[2,{modelArtifactsInfo:Qy(t)}]})})},n.URL_SCHEME="downloads://",n}(),Fot=function(n){return Y.get("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(KS.URL_SCHEME)?Mot(n.slice(KS.URL_SCHEME.length)):null};function Mot(n){return n===void 0&&(n="model"),new KS(n)}function aO(n,t,e,r){(function(a){et(a!=null&&Array.isArray(a)&&a.length>0,function(){return"promises must be a none empty array"})})(n),function(a,i){et(a>=0&&a<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+a}),et(i>=0&&i<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+i}),et(i>=a,function(){return"startFraction must be no more than endFraction, but got startFraction "+a+" and endFraction "+i})}(e=e??0,r=r??1);var o=0;return Promise.all(n.map(function(a){return a.then(function(i){var s=e+ ++o/n.length*(r-e);return t(s),i}),a}))}function Lot(n,t){return bn(this,void 0,void 0,function(){var e,r,o,a,i,s,u,l,c;return wn(this,function(h){switch(h.label){case 0:return t==null&&(t={}),e=t.fetchFunc==null?fetch:t.fetchFunc,r=n.map(function(d){return e(d,t.requestInit)}),o=0,a=.5,t.onProgress!=null?[3,2]:[4,Promise.all(r)];case 1:return i=h.sent(),[3,4];case 2:return[4,aO(r,t.onProgress,o,a)];case 3:i=h.sent(),h.label=4;case 4:return s=i.map(function(d){return d.arrayBuffer()}),u=.5,l=1,t.onProgress!=null?[3,6]:[4,Promise.all(s)];case 5:return c=h.sent(),[3,8];case 6:return[4,aO(s,t.onProgress,u,l)];case 7:c=h.sent(),h.label=8;case 8:return[2,c]}})})}Sc.registerSaveRouter(Fot);var Pot="application/octet-stream",Bot="application/json",yL=function(){function n(t,e){if(this.DEFAULT_METHOD="POST",e==null&&(e={}),this.weightPathPrefix=e.weightPathPrefix,this.onProgress=e.onProgress,e.fetchFunc==null){var r=Y.global.fetch;if(r===void 0)throw new Error("browserHTTPRequest is not supported outside the web browser without a fetch polyfill.");e.fetchFunc=r.bind(Y.global)}else et(typeof e.fetchFunc=="function",function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"});if(this.fetchFunc=function(o,a){return e.fetchFunc(o,a).catch(function(i){throw new Error("Request for "+o+" failed due to error: "+i)})},et(t!=null&&t.length>0,function(){return"URL path for browserHTTPRequest must not be null, undefined or empty."}),Array.isArray(t)&&et(t.length===2,function(){return"URL paths for browserHTTPRequest must have a length of 2, (actual length is "+t.length+")."}),this.path=t,e.requestInit!=null&&e.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=e.requestInit||{}}return n.prototype.save=function(t){return bn(this,void 0,void 0,function(){var e,r,o,a;return wn(this,function(i){switch(i.label){case 0:if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(e=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,r=[{paths:["./model.weights.bin"],weights:t.weightSpecs}],o={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:r},e.body.append("model.json",new Blob([JSON.stringify(o)],{type:Bot}),"model.json"),t.weightData!=null&&e.body.append("model.weights.bin",new Blob([t.weightData],{type:Pot}),"model.weights.bin"),[4,this.getFetchFunc()(this.path,e)];case 1:if((a=i.sent()).ok)return[2,{modelArtifactsInfo:Qy(t),responses:[a]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+a.status+".")}})})},n.prototype.load=function(){return bn(this,void 0,void 0,function(){var t,e,r,o,a,i,s,u;return wn(this,function(l){switch(l.label){case 0:return[4,this.getFetchFunc()(this.path,this.requestInit)];case 1:if(!(t=l.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+t.status+". Please verify this URL points to the model JSON of the model to load.");l.label=2;case 2:return l.trys.push([2,4,,5]),[4,t.json()];case 3:return e=l.sent(),[3,5];case 4:throw l.sent(),r="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 5:if(o=e.modelTopology,a=e.weightsManifest,o==null&&a==null)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return a==null?[3,7]:[4,this.loadWeights(a)];case 6:u=l.sent(),i=u[0],s=u[1],l.label=7;case 7:return[2,{modelTopology:o,weightSpecs:i,weightData:s}]}})})},n.prototype.loadWeights=function(t){return bn(this,void 0,void 0,function(){var e,r,o,a,i,s,u,l,c,h,d;return wn(this,function(p){switch(p.label){case 0:for(e=Array.isArray(this.path)?this.path[1]:this.path,r=zot(e),o=r[0],a=r[1],i=this.weightPathPrefix||o,s=[],u=0,l=t;u<l.length;u++)c=l[u],s.push.apply(s,c.weights);return h=[],t.forEach(function(g){g.paths.forEach(function(x){h.push(i+x+a)})}),[4,Lot(h,{requestInit:this.requestInit,fetchFunc:this.getFetchFunc(),onProgress:this.onProgress})];case 1:return d=p.sent(),[2,[s,bot(d)]]}})})},n.prototype.getFetchFunc=function(){return this.fetchFunc},n.URL_SCHEME_REGEX=/^https?:\/\//,n}();function zot(n){var t=n.lastIndexOf("/"),e=n.lastIndexOf("?");return[n.substring(0,t)+"/",e>t?n.substring(e):""]}function iO(n){return n.match(yL.URL_SCHEME_REGEX)!=null}var sO=function(n,t){return typeof fetch>"u"?null:(Array.isArray(n)?n.every(function(e){return iO(e)}):iO(n))?Uot(n,{onProgress:t}):null};function Uot(n,t){return new yL(n,t)}Sc.registerSaveRouter(sO),Sc.registerLoadRouter(sO);function Wot(n,t,e){var r=K(n,"labels","confusionMatrix"),o=K(t,"predictions","confusionMatrix");et(e==null||e>0&&Number.isInteger(e),function(){return"If provided, numClasses must be a positive integer, but got "+e}),et(r.rank===1,function(){return"Expected the rank of labels to be 1, but got "+r.rank}),et(o.rank===1,function(){return"Expected the rank of predictions to be 1, but got "+o.rank}),et(r.shape[0]===o.shape[0],function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+o.shape[0]+". Labels and predictions should have the same number of elements."}),et(e>0&&Number.isInteger(e),function(){return"numClasses is required to be a positive integer, but got "+e});var a=VS(r.asType("int32"),e),i=VS(o.asType("int32"),e);return a.transpose().matMul(i).asType("int32")}lt({confusionMatrix_:Wot});function Vot(n,t){if(t===void 0&&(t=3),t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");return Y.engine.fromPixels(n,t)}function Got(n,t){return bn(this,void 0,void 0,function(){var e,r,o,a,i,s,u,l,c,h,d,p,g,x,y,b,C,E,S,k;return wn(this,function(R){switch(R.label){case 0:if(e=K(n,"img","toPixels"),n instanceof Gt||(e=e.toInt()),e.rank!==2&&e.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+e.rank+".");if(r=e.shape.slice(0,2),o=r[0],a=r[1],(i=e.rank===2?1:e.shape[2])>4||i===2)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+i);return s=e.min(),u=e.max(),[4,s.data()];case 1:return l=R.sent()[0],[4,u.data()];case 2:if(c=R.sent()[0],s.dispose(),u.dispose(),e.dtype==="float32"){if(l<0||c>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+l+" - "+c+"].")}else{if(e.dtype!=="int32")throw new Error("Unsupported type for toPixels: "+e.dtype+". Please use float32 or int32 tensors.");if(l<0||c>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+l+" - "+c+"].")}return[4,e.data()];case 3:for(h=R.sent(),d=e.dtype==="float32"?255:1,p=new Uint8ClampedArray(a*o*4),g=0;g<o*a;++g)x=void 0,y=void 0,b=void 0,C=void 0,i===1?(x=h[g]*d,y=h[g]*d,b=h[g]*d,C=255):i===3?(x=h[3*g]*d,y=h[3*g+1]*d,b=h[3*g+2]*d,C=255):i===4&&(x=h[4*g]*d,y=h[4*g+1]*d,b=h[4*g+2]*d,C=h[4*g+3]*d),p[(E=4*g)+0]=Math.round(x),p[E+1]=Math.round(y),p[E+2]=Math.round(b),p[E+3]=Math.round(C);return t!=null&&(t.width=a,t.height=o,S=t.getContext("2d"),k=new ImageData(p,a,o),S.putImageData(k,0,0)),e!==n&&e.dispose(),[2,p]}})})}var Hot=lt({fromPixels_:Vot}),qot=Object.freeze({toPixels:Got,fromPixels:Hot}),jot=function(){function n(){}return n.prototype.getClassName=function(){return this.constructor.className},n.fromConfig=function(t,e){return new t(e)},n}(),Xot=function(){function n(){this.classNameMap={}}return n.getMap=function(){return n.instance==null&&(n.instance=new n),n.instance},n.register=function(t){n.getMap().classNameMap[t.className]=[t,t.fromConfig]},n}();function jc(n){et(n.className!=null,function(){return"Class being registered does not have the static className property defined."}),et(typeof n.className=="string",function(){return"className is required to be a string, but got type "+typeof n.className}),et(n.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),Xot.register(n)}var Xc=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return tu(t,n),t.prototype.minimize=function(e,r,o){r===void 0&&(r=!1);var a=this.computeGradients(e,o),i=a.value,s=a.grads;return this.applyGradients(s),Object.keys(s).forEach(function(u){return s[u].dispose()}),r?i:(i.dispose(),null)},t.prototype.computeGradients=function(e,r){return n8(e,r)},t.prototype.dispose=function(){},t}(jot);Object.defineProperty(Xc,Symbol.hasInstance,{value:function(n){return n.minimize!=null&&n.computeGradients!=null&&n.applyGradients!=null}});var Kot=function(n){function t(e,r,o){o===void 0&&(o=null);var a=n.call(this)||this;return a.learningRate=e,a.rho=r,a.epsilon=o,a.accumulatedGrads={},a.accumulatedUpdates={},a.c=Nn(zt(-e)),a.rhoScalar=Nn(zt(r)),a.oneMinusRho=Nn(zt(1-r)),o===null&&(o=Y.get("EPSILON")),a.epsilonScalar=Nn(zt(o)),a}return tu(t,n),t.prototype.applyGradients=function(e){var r=this,o=function(s){var u=Y.engine.registeredVariables[s];a.accumulatedGrads[s]==null&&he(function(){r.accumulatedGrads[s]=sn(u).variable(!1)}),a.accumulatedUpdates[s]==null&&he(function(){r.accumulatedUpdates[s]=sn(u).variable(!1)});var l=e[s],c=a.accumulatedGrads[s],h=a.accumulatedUpdates[s];he(function(){var d=r.rhoScalar.mul(c).add(r.oneMinusRho.mul(l.square())),p=h.add(r.epsilonScalar).sqrt().div(c.add(r.epsilonScalar).sqrt()).mul(l),g=r.rhoScalar.mul(h).add(r.oneMinusRho.mul(p.square()));r.accumulatedGrads[s].assign(d),r.accumulatedUpdates[s].assign(g);var x=r.c.mul(p).add(u);u.assign(x)})},a=this;for(var i in e)o(i)},t.prototype.dispose=function(){var e=this;this.c.dispose(),this.epsilonScalar.dispose(),this.rhoScalar.dispose(),this.oneMinusRho.dispose(),this.accumulatedUpdates!=null&&(Object.keys(this.accumulatedUpdates).forEach(function(r){return e.accumulatedUpdates[r].dispose()}),Object.keys(this.accumulatedGrads).forEach(function(r){return e.accumulatedGrads[r].dispose()}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},t.fromConfig=function(e,r){return new e(r.learningRate,r.rho,r.epsilon)},t.className="AdadeltaOptimizer",t}(Xc);jc(Kot);var Yot=function(n){function t(e,r){r===void 0&&(r=.1);var o=n.call(this)||this;return o.learningRate=e,o.initialAccumulatorValue=r,o.accumulatedGrads={},o.c=Nn(zt(-e)),o.epsilon=Nn(zt(Y.get("EPSILON"))),o}return tu(t,n),t.prototype.applyGradients=function(e){var r=this,o=function(s){var u=Y.engine.registeredVariables[s];a.accumulatedGrads[s]==null&&he(function(){r.accumulatedGrads[s]=jp(u.shape,r.initialAccumulatorValue).variable(!1)});var l=e[s],c=a.accumulatedGrads[s];he(function(){var h=c.add(l.square());r.accumulatedGrads[s].assign(h);var d=r.c.mul(l.div(h.add(r.epsilon).sqrt())).add(u);u.assign(d)})},a=this;for(var i in e)o(i)},t.prototype.dispose=function(){var e=this;this.epsilon.dispose(),this.c.dispose(),this.accumulatedGrads!=null&&Object.keys(this.accumulatedGrads).forEach(function(r){return e.accumulatedGrads[r].dispose()})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},t.fromConfig=function(e,r){return new e(r.learningRate,r.initialAccumulatorValue)},t.className="AdagradOptimizer",t}(Xc);jc(Yot);var Qot=function(n){function t(e,r,o,a){a===void 0&&(a=null);var i=n.call(this)||this;return i.learningRate=e,i.beta1=r,i.beta2=o,i.epsilon=a,i.accumulatedFirstMoment={},i.accumulatedSecondMoment={},i.c=Nn(zt(-e)),i.beta1Scalar=Nn(zt(r)),i.beta2Scalar=Nn(zt(o)),he(function(){i.accBeta1=zt(r).variable(),i.accBeta2=zt(o).variable()}),i.oneMinusBeta1=Nn(zt(1-r)),i.oneMinusBeta2=Nn(zt(1-o)),i.one=Nn(zt(1)),a===null&&(a=Y.get("EPSILON")),i.epsScalar=Nn(zt(a)),i}return tu(t,n),t.prototype.applyGradients=function(e){var r=this;he(function(){var o=r.one.sub(r.accBeta1),a=r.one.sub(r.accBeta2);for(var i in e){var s=Y.engine.registeredVariables[i];if(r.accumulatedFirstMoment[i]==null){var u=!1;r.accumulatedFirstMoment[i]=sn(s).variable(u)}r.accumulatedSecondMoment[i]==null&&(u=!1,r.accumulatedSecondMoment[i]=sn(s).variable(u));var l=e[i],c=r.accumulatedFirstMoment[i],h=r.accumulatedSecondMoment[i],d=r.beta1Scalar.mul(c).add(r.oneMinusBeta1.mul(l)),p=r.beta2Scalar.mul(h).add(r.oneMinusBeta2.mul(l.square())),g=d.div(o),x=p.div(a);r.accumulatedFirstMoment[i].assign(d),r.accumulatedSecondMoment[i].assign(p);var y=r.c.mul(g.div(r.epsScalar.add(x.sqrt()))).add(s);s.assign(y)}r.accBeta1.assign(r.accBeta1.mul(r.beta1Scalar)),r.accBeta2.assign(r.accBeta2.mul(r.beta2Scalar))})},t.prototype.dispose=function(){var e=this;this.c.dispose(),this.epsScalar.dispose(),this.beta1Scalar.dispose(),this.beta2Scalar.dispose(),this.accBeta1.dispose(),this.accBeta2.dispose(),this.oneMinusBeta1.dispose(),this.oneMinusBeta2.dispose(),this.one.dispose(),this.accumulatedFirstMoment!=null&&Object.keys(this.accumulatedFirstMoment).forEach(function(r){return e.accumulatedFirstMoment[r].dispose()}),this.accumulatedSecondMoment!=null&&Object.keys(this.accumulatedSecondMoment).forEach(function(r){return e.accumulatedSecondMoment[r].dispose()})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},t.fromConfig=function(e,r){return new e(r.learningRate,r.beta1,r.beta2,r.epsilon)},t.className="AdamOptimizer",t}(Xc);jc(Qot);var Zot=function(n){function t(e,r,o,a,i){a===void 0&&(a=null),i===void 0&&(i=0);var s=n.call(this)||this;return s.learningRate=e,s.beta1=r,s.beta2=o,s.epsilon=a,s.decay=i,s.accumulatedFirstMoment={},s.accumulatedWeightedInfNorm={},s.c=Nn(zt(-e)),s.beta1Scalar=Nn(zt(r)),s.beta2Scalar=Nn(zt(o)),s.decayScalar=Nn(zt(i)),he(function(){s.iteration=zt(0).variable(),s.accBeta1=zt(r).variable()}),s.oneMinusBeta1=Nn(zt(1-r)),s.one=Nn(zt(1)),a===null&&(a=Y.get("EPSILON")),s.epsScalar=Nn(zt(a)),s}return tu(t,n),t.prototype.applyGradients=function(e){var r=this;he(function(){var o=r.one.sub(r.accBeta1),a=r.c.div(r.one.add(r.decayScalar.mul(r.iteration)));for(var i in e){var s=Y.engine.registeredVariables[i];if(r.accumulatedFirstMoment[i]==null){var u=!1;r.accumulatedFirstMoment[i]=sn(s).variable(u)}r.accumulatedWeightedInfNorm[i]==null&&(u=!1,r.accumulatedWeightedInfNorm[i]=sn(s).variable(u));var l=e[i],c=r.accumulatedFirstMoment[i],h=r.accumulatedWeightedInfNorm[i],d=r.beta1Scalar.mul(c).add(r.oneMinusBeta1.mul(l)),p=r.beta2Scalar.mul(h),g=l.abs(),x=p.maximum(g);r.accumulatedFirstMoment[i].assign(d),r.accumulatedWeightedInfNorm[i].assign(x);var y=a.div(o).mul(d.div(r.epsScalar.add(x))).add(s);s.assign(y)}r.iteration.assign(r.iteration.add(r.one)),r.accBeta1.assign(r.accBeta1.mul(r.beta1Scalar))})},t.prototype.dispose=function(){var e=this;this.c.dispose(),this.epsScalar.dispose(),this.accBeta1.dispose(),this.beta1Scalar.dispose(),this.beta2Scalar.dispose(),this.oneMinusBeta1.dispose(),this.decayScalar.dispose(),this.iteration.dispose(),this.one.dispose(),this.accumulatedFirstMoment!=null&&Object.keys(this.accumulatedFirstMoment).forEach(function(r){return e.accumulatedFirstMoment[r].dispose()}),this.accumulatedWeightedInfNorm!=null&&Object.keys(this.accumulatedWeightedInfNorm).forEach(function(r){return e.accumulatedWeightedInfNorm[r].dispose()})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},t.fromConfig=function(e,r){return new e(r.learningRate,r.beta1,r.beta2,r.epsilon,r.decay)},t.className="AdamaxOptimizer",t}(Xc);jc(Zot);var bL=function(n){function t(e){var r=n.call(this)||this;return r.learningRate=e,r.setLearningRate(e),r}return tu(t,n),t.prototype.applyGradients=function(e){var r=this;Object.keys(e).forEach(function(o){var a=e[o],i=Y.engine.registeredVariables[o];he(function(){var s=r.c.mul(a).add(i);i.assign(s)})})},t.prototype.setLearningRate=function(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=Nn(zt(-e))},t.prototype.dispose=function(){this.c.dispose()},t.prototype.getConfig=function(){return{learningRate:this.learningRate}},t.fromConfig=function(e,r){return new e(r.learningRate)},t.className="SGDOptimizer",t}(Xc);jc(bL);var Jot=function(n){function t(e,r,o){o===void 0&&(o=!1);var a=n.call(this,e)||this;return a.learningRate=e,a.momentum=r,a.useNesterov=o,a.m=zt(a.momentum),a.accumulations={},a}return tu(t,n),t.prototype.applyGradients=function(e){var r=this,o=function(s){var u=Y.engine.registeredVariables[s];a.accumulations[s]==null&&he(function(){r.accumulations[s]=sn(u).variable(!1)});var l=a.accumulations[s],c=e[s];he(function(){var h,d=r.m.mul(l).add(c);h=r.useNesterov?r.c.mul(c.add(d.mul(r.m))).add(u):r.c.mul(d).add(u),r.accumulations[s].assign(d),u.assign(h)})},a=this;for(var i in e)o(i)},t.prototype.dispose=function(){if(n.prototype.dispose.call(this),this.m.dispose(),this.accumulations!=null)for(var e in this.accumulations)this.accumulations[e].dispose()},t.prototype.setMomentum=function(e){this.momentum=e},t.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},t.fromConfig=function(e,r){return new e(r.learningRate,r.momentum,r.useNesterov)},t.className="MomentumOptimizer",t}(bL);jc(Jot);var tat=function(n){function t(e,r,o,a,i){r===void 0&&(r=.9),o===void 0&&(o=0),a===void 0&&(a=null),i===void 0&&(i=!1);var s=n.call(this)||this;return s.learningRate=e,s.decay=r,s.momentum=o,s.epsilon=a,s.accumulatedMeanSquares={},s.accumulatedMeanGrads={},s.accumulatedMoments={},s.c=Nn(zt(e)),s.decayScalar=Nn(zt(r)),s.momentumScalar=Nn(zt(o)),s.oneMinusDecay=Nn(zt(1-r)),s.centered=i,a===null&&(a=Y.get("EPSILON")),s.epsilonScalar=Nn(zt(a)),s}return tu(t,n),t.prototype.applyGradients=function(e){var r=this,o=function(s){var u=Y.engine.registeredVariables[s];a.accumulatedMeanSquares[s]==null&&he(function(){r.accumulatedMeanSquares[s]=sn(u).variable(!1)}),a.accumulatedMeanGrads[s]==null&&a.centered&&he(function(){r.accumulatedMeanGrads[s]=sn(u).variable(!1)}),a.accumulatedMoments[s]==null&&he(function(){r.accumulatedMoments[s]=sn(u).variable(!1)});var l=a.accumulatedMeanSquares[s],c=a.accumulatedMeanGrads[s],h=a.accumulatedMoments[s],d=e[s];he(function(){var p=r.decayScalar.mul(l).add(r.oneMinusDecay.mul(d.square()));if(r.centered){var g=r.decayScalar.mul(c).add(r.oneMinusDecay.mul(d)),x=r.momentumScalar.mul(h).add(r.c.mul(d).div(p.sub(g.square().add(r.epsilonScalar)).sqrt()));r.accumulatedMeanSquares[s].assign(p),r.accumulatedMeanGrads[s].assign(g),r.accumulatedMoments[s].assign(x);var y=u.sub(x);u.assign(y)}else{var b=r.decayScalar.mul(l).add(r.oneMinusDecay.mul(d.square()));x=r.momentumScalar.mul(h).add(r.c.mul(d).div(b.add(r.epsilonScalar).sqrt())),r.accumulatedMeanSquares[s].assign(b),r.accumulatedMoments[s].assign(x),y=u.sub(x),u.assign(y)}})},a=this;for(var i in e)o(i)},t.prototype.dispose=function(){var e=this;this.c.dispose(),this.epsilonScalar.dispose(),this.decayScalar.dispose(),this.momentumScalar.dispose(),this.oneMinusDecay.dispose(),this.accumulatedMeanSquares!=null&&Object.keys(this.accumulatedMeanSquares).forEach(function(r){return e.accumulatedMeanSquares[r].dispose()}),this.accumulatedMeanGrads!=null&&this.centered&&Object.keys(this.accumulatedMeanGrads).forEach(function(r){return e.accumulatedMeanGrads[r].dispose()}),this.accumulatedMoments!=null&&Object.keys(this.accumulatedMoments).forEach(function(r){return e.accumulatedMoments[r].dispose()})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},t.fromConfig=function(e,r){return new e(r.learningRate,r.decay,r.momentum,r.epsilon,r.centered)},t.className="RMSPropOptimizer",t}(Xc);jc(tat);hs.setBackend;hs.getBackend;hs.disposeVariables;hs.memory;AK(mot);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var wL=function(n,t){return(wL=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var o in r)r.hasOwnProperty(o)&&(e[o]=r[o])})(n,t)};function wi(n,t){function e(){this.constructor=n}wL(n,t),n.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}function Qt(n,t,e,r){return new(e||(e=Promise))(function(o,a){function i(l){try{u(r.next(l))}catch(c){a(c)}}function s(l){try{u(r.throw(l))}catch(c){a(c)}}function u(l){l.done?o(l.value):new e(function(c){c(l.value)}).then(i,s)}u((r=r.apply(n,[])).next())})}function Zt(n,t){var e,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function s(u){return function(l){return function(c){if(e)throw new TypeError("Generator is already executing.");for(;i;)try{if(e=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(c[0]===6||c[0]===2)){i=0;continue}if(c[0]===3&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(c[0]===6&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(n,i)}catch(h){c=[6,h],r=0}finally{e=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([u,l])}}}var eat=function(){function n(t){this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return n.prototype.setPlatform=function(t,e){this.platform!=null&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+e+"."),this.platformName=t,this.platform=e},n.prototype.registerFlag=function(t,e,r){if(this.flagRegistry[t]={evaluationFn:e,setHook:r},this.urlFlags[t]!=null){var o=this.urlFlags[t];console.warn("Setting feature override from URL "+t+": "+o+"."),this.set(t,o)}},n.prototype.get=function(t){return t in this.flags?this.flags[t]:(this.flags[t]=this.evaluateFlag(t),this.flags[t])},n.prototype.getNumber=function(t){return this.get(t)},n.prototype.getBool=function(t){return this.get(t)},n.prototype.getFlags=function(){return this.flags},Object.defineProperty(n.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),n.prototype.set=function(t,e){if(this.flagRegistry[t]==null)throw new Error("Cannot set flag "+t+" as it has not been registered.");this.flags[t]=e,this.flagRegistry[t].setHook!=null&&this.flagRegistry[t].setHook(e)},n.prototype.evaluateFlag=function(t){if(this.flagRegistry[t]==null)throw new Error("Cannot evaluate flag '"+t+"': no evaluation function found.");return this.flagRegistry[t].evaluationFn()},n.prototype.setFlags=function(t){this.flags=Object.assign({},t)},n.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},n.prototype.populateURLFlags=function(){var t=this;if(this.global!==void 0&&this.global.location!==void 0&&this.global.location.search!==void 0){var e,r,o=(e=this.global.location.search,r={},e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(a){for(var i=[],s=1;s<arguments.length;s++)i[s-1]=arguments[s];return nat(r,i[0],i[1]),i.join("=")}),r);"tfjsflags"in o&&o.tfjsflags.split(",").forEach(function(a){var i=a.split(":"),s=i[0],u=i[1];t.urlFlags[s]=function(l,c){if((c=c.toLowerCase())==="true"||c==="false")return c==="true";if(""+ +c===c)return+c;throw new Error("Could not parse value flag value "+c+" for flag "+l+".")}(s,u)})}},n}();function nat(n,t,e){n[decodeURIComponent(t)]=decodeURIComponent(e||"")}function Nt(){return CL}var CL=null,X0=new Map,YS=new Map;function SL(n,t){var e=kL(n,t);return X0.get(e)}function uO(n){return YS.get(n)}function lO(n){for(var t=X0.entries(),e=[];;){var r=t.next(),o=r.done,a=r.value;if(o)break;var i=a[0],s=a[1];i.split("_")[0]===n&&e.push(s)}return e}function EL(n){var t=n.kernelName,e=n.backendName,r=kL(t,e);if(X0.has(r))throw new Error("The kernel '"+t+"' for backend '"+e+"' is already registered");X0.set(r,n)}function rat(n){var t=n.kernelName;YS.has(t)&&console.warn("Overriding the gradient for '"+t+"'"),YS.set(t,n)}function kL(n,t){return t+"_"+n}function QS(n,t,e){return Math.max(n,Math.min(t,e))}function IL(n){return n%2==0?n:n+1}function oat(n){for(var t=0,e=0;e<n.length;e++)t+=n[e];return t}function X(n,t){if(!n)throw new Error(typeof t=="string"?t:t())}function cn(n,t,e){e===void 0&&(e=""),X(zr(n,t),function(){return e+" Shapes "+n+" and "+t+" must match"})}function sd(n){X(n!=null,function(){return"The input to the tensor constructor must be a non-null value."})}function Mf(n,t,e){if(t===void 0&&(t=[]),e===void 0&&(e=!1),t==null&&(t=[]),Array.isArray(n)||Xi(n)&&!e)for(var r=0;r<n.length;++r)Mf(n[r],t,e);else t.push(n);return t}function Yt(n){if(n.length===0)return 1;for(var t=n[0],e=1;e<n.length;e++)t*=n[e];return t}function zr(n,t){if(n===t)return!0;if(n==null||t==null||n.length!==t.length)return!1;for(var e=0;e<n.length;e++)if(n[e]!==t[e])return!1;return!0}function ur(n){return n%1==0}function aat(n){if(Math.tanh!=null)return Math.tanh(n);if(n===1/0)return 1;if(n===-1/0)return-1;var t=Math.exp(2*n);return(t-1)/(t+1)}function ZS(n){var t=Math.ceil(Math.sqrt(n));return[t,Math.ceil(n/t)]}function vf(n,t){return t<=n.length?n:n+" ".repeat(t-n.length)}function cO(n,t,e){return t===void 0&&(t=function(r){return 0}),new Promise(function(r,o){var a=0,i=function(){if(n())r();else{a++;var s=t(a);e!=null&&a>=e?o():setTimeout(i,s)}};i()})}function iat(n,t){for(var e=1,r=-1,o=0;o<n.length;++o)if(n[o]>=0)e*=n[o];else if(n[o]===-1){if(r!==-1)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+o);r=o}else if(n[o]<0)throw Error("Shapes can not be < 0. Found "+n[o]+" at dim "+o);if(r===-1){if(t>0&&t!==e)throw Error("Size("+t+") must match the product of shape "+n);return n}if(e===0)throw Error("Cannot infer the missing size in ["+n+"] when there are 0 elements");if(t%e!=0)throw Error("The implicit shape can't be a fractional number. Got "+t+" / "+e);var a=n.slice();return a[r]=t/e,a}function _r(n,t){var e=t.length;return X((n=n==null?t.map(function(r,o){return o}):[].concat(n)).every(function(r){return r>=-e&&r<e}),function(){return"All values in axis param must be in range [-"+e+", "+e+") but got axis "+n}),X(n.every(function(r){return ur(r)}),function(){return"All values in axis param must be integers but got axis "+n}),n.map(function(r){return r<0?e+r:r})}function rc(n,t){for(var e=[],r=[],o=t!=null&&Array.isArray(t)&&t.length===0,a=t==null||o?null:_r(t,n).sort(),i=0,s=0;s<n.length;++s){if(a!=null){if(a[i]===s&&n[s]!==1)throw new Error("Can't squeeze axis "+s+" since its dim '"+n[s]+"' is not 1");(a[i]==null||a[i]>s)&&n[s]===1&&(e.push(n[s]),r.push(s)),a[i]<=s&&i++}n[s]!==1&&(e.push(n[s]),r.push(s))}return{newShape:e,keptDims:r}}function Lf(n,t){var e=null;if(n==null||n==="float32")e=new Float32Array(t);else if(n==="int32")e=new Int32Array(t);else{if(n!=="bool")throw new Error("Unknown data type "+n);e=new Uint8Array(t)}return e}function K0(n,t){var e=null;if(n==null||n==="float32")e=new Float32Array(t);else if(n==="int32")e=new Int32Array(t);else if(n==="bool")e=new Uint8Array(t);else{if(n!=="string")throw new Error("Unknown data type "+n);e=new Array(t)}return e}function sat(n,t){for(var e=0;e<n.length;e++){var r=n[e];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+t+" being uploaded contains "+r+".")}}function uat(n){return n==="bool"||n==="complex64"||n==="float32"||n==="int32"||n==="string"}function lat(n,t){return t!=="complex64"&&(t!=="float32"||n==="complex64")&&(t!=="int32"||n==="float32"||n==="complex64")&&(t!=="bool"||n!=="bool")}function Xi(n){return n instanceof Float32Array||n instanceof Int32Array||n instanceof Uint8Array}function RL(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error("Unknown dtype "+n)}function cat(n){if(n==null)return 0;var t=0;return n.forEach(function(e){return t+=e.length}),t}function Ak(n){return typeof n=="string"||n instanceof String}function hat(n){return typeof n=="boolean"}function fat(n){return typeof n=="number"}function Lm(n){return Array.isArray(n)?Lm(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array?"int32":fat(n)?"float32":Ak(n)?"string":hat(n)?"bool":"float32"}function JS(n){return!!(n&&n.constructor&&n.call&&n.apply)}function tE(n,t){for(var e=t;e<n;++e)if(n%e==0)return e;return n}function ya(n){var t=n.length;if(t<2)return[];var e=new Array(t-1);e[t-2]=n[t-1];for(var r=t-3;r>=0;--r)e[r]=e[r+1]*n[r+1];return e}function TL(n,t,e){if(t==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=Mf(n)),e&&sat(n,t),function(a,i){return a instanceof Float32Array&&i==="float32"||a instanceof Int32Array&&i==="int32"||a instanceof Uint8Array&&i==="bool"}(n,t))return n;if(t==null||t==="float32"||t==="complex64")return new Float32Array(n);if(t==="int32")return new Int32Array(n);if(t==="bool"){for(var r=new Uint8Array(n.length),o=0;o<r.length;++o)Math.round(n[o])!==0&&(r[o]=1);return r}throw new Error("Unknown data type "+t)}function hO(n,t){if(n.length===0)return t[0];var e=n.reduce(function(r,o){return r*o});if(e===0)return[];if(e!==t.length)throw new Error("["+n+"] does not match the input size.");return function r(o,a,i){var s=new Array;if(a.length===1)for(var u=a[0],l=0;l<u;l++)s[l]=i[o+l];else{u=a[0];var c=a.slice(1),h=c.reduce(function(d,p){return d*p});for(l=0;l<u;l++)s[l]=r(o+l*h,c,i)}return s}(0,n,t)}function NL(n,t){for(var e=Pm(n,t),r=0;r<e.length;r++)e[r]=1;return e}function Pm(n,t){if(t==null||t==="float32"||t==="complex64")return new Float32Array(n);if(t==="int32")return new Int32Array(n);if(t==="bool")return new Uint8Array(n);throw new Error("Unknown data type "+t)}function Li(){return Nt().platform.now()}function AL(n){n.forEach(function(t){X(Number.isInteger(t)&&t>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+n+"]."})})}function dat(n,t){return t===void 0&&(t="utf-8"),t=t||"utf-8",Nt().platform.encode(n,t)}function Y0(n,t){return t===void 0&&(t="utf-8"),t=t||"utf-8",Nt().platform.decode(n,t)}function eE(n,t,e){if(t===0)return 0;if(t===1)return n[0];for(var r=n[n.length-1],o=0;o<n.length-1;++o)r+=e[o]*n[o];return r}function _L(n,t,e){if(t===0)return[];if(t===1)return[n];for(var r=new Array(t),o=0;o<r.length-1;++o)r[o]=Math.floor(n/e[o]),n-=r[o]*e[o];return r[r.length-1]=n,r}var pat=function(){function n(t,e){this.backendTimer=t,this.logger=e,e==null&&(this.logger=new mat)}return n.prototype.profileKernel=function(t,e,r){var o,a=this,i=this.backendTimer.time(function(){o=r()});return o.forEach(function(s){s.data().then(function(u){(function(l,c,h){if(c!=="float32")return!1;for(var d=0;d<l.length;d++){var p=l[d];if(isNaN(p)||!isFinite(p))return console.warn("Found "+p+" in the result of '"+h+"'"),!0}})(u,s.dtype,t),i.then(function(l){var c="";l.getExtraProfileInfo!=null&&(c=l.getExtraProfileInfo()),a.logger.logKernelProfile(t,s,u,l.kernelMs,e,c)})})}),o},n}(),mat=function(){function n(){}return n.prototype.logKernelProfile=function(t,e,r,o,a,i){var s=typeof o=="number"?vf(o+"ms",9):o.error,u=vf(t,25),l=e.rank,c=e.size,h=vf(e.shape.toString(),14),d="";for(var p in a){var g=a[p].shape||e.shape,x=g.length;d+=p+": "+x+"D "+(x>0?g:"")+" "}console.log("%c"+u+"	%c"+s+"	%c"+l+"D "+h+"	%c"+c+"	%c"+d+"	%c"+i,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},n}(),fO=20,Np=3,_C=7;function gat(n,t,e,r){var o=ya(t),a=function(l,c,h,d){var p=Yt(c),g=d[d.length-1],x=new Array(g).fill(0),y=c.length,b=h==="complex64"?_p(l):l;if(y>1)for(var C=0;C<p/g;C++)for(var E=C*g,S=0;S<g;S++)x[S]=Math.max(x[S],Ap(b[E+S],0,h).length);return x}(n,t,e,o),i=t.length,s=function l(c,h,d,p,g,x){x===void 0&&(x=!0);var y=d==="complex64"?2:1,b=h[0],C=h.length;if(C===0)return d==="complex64"?[Ap(_p(c)[0],0,d)]:d==="bool"?[DL(c[0])]:[c[0].toString()];if(C===1){if(b>fO){var E=Np*y,S=Array.from(c.slice(0,E)),k=Array.from(c.slice((b-Np)*y,b*y));return d==="complex64"&&(S=_p(S),k=_p(k)),["["+S.map(function(W,F){return Ap(W,g[F],d)}).join(", ")+", ..., "+k.map(function(W,F){return Ap(W,g[b-Np+F],d)}).join(", ")+"]"]}return["["+(d==="complex64"?_p(c):Array.from(c)).map(function(W,F){return Ap(W,g[F],d)}).join(", ")+"]"]}var R=h.slice(1),A=p.slice(1),N=p[0]*y,_=[];if(b>fO){for(var $=0;$<Np;$++){var D=(O=$*N)+N;_.push.apply(_,l(c.slice(O,D),R,d,A,g,!1))}for(_.push("..."),$=b-Np;$<b;$++)D=(O=$*N)+N,_.push.apply(_,l(c.slice(O,D),R,d,A,g,$===b-1))}else for($=0;$<b;$++){var O;D=(O=$*N)+N,_.push.apply(_,l(c.slice(O,D),R,d,A,g,$===b-1))}var P=C===2?",":"";for(_[0]="["+_[0]+P,$=1;$<_.length-1;$++)_[$]=" "+_[$]+P;var z=`,
`;for($=2;$<C;$++)z+=`
`;return _[_.length-1]=" "+_[_.length-1]+"]"+(x?"":z),_}(n,t,e,o,a),u=["Tensor"];return r&&(u.push("  dtype: "+e),u.push("  rank: "+i),u.push("  shape: ["+t+"]"),u.push("  values:")),u.push(s.map(function(l){return"    "+l}).join(`
`)),u.join(`
`)}function Ap(n,t,e){return vf(Array.isArray(n)?parseFloat(n[0].toFixed(_C))+" + "+parseFloat(n[1].toFixed(_C))+"j":Ak(n)?"'"+n+"'":e==="bool"?DL(n):parseFloat(n.toFixed(_C)).toString(),t)}function DL(n){return n===0?"false":"true"}function _p(n){for(var t=[],e=0;e<n.length;e+=2)t.push([n[e],n[e+1]]);return t}var nm=function(){function n(t,e,r){var o=this;if(this.dtype=e,this.shape=t.slice(),this.size=Yt(t),r!=null){var a=r.length;X(a===this.size,function(){return"Length of values '"+a+"' does not match the size inferred by the shape '"+o.size+"'."})}if(e==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||K0(e,this.size),this.strides=ya(t)}return n.prototype.set=function(t){for(var e=this,r=[],o=1;o<arguments.length;o++)r[o-1]=arguments[o];r.length===0&&(r=[0]),X(r.length===this.rank,function(){return"The number of provided coordinates ("+r.length+") must match the rank ("+e.rank+")"});var a=this.locToIndex(r);this.values[a]=t},n.prototype.get=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];t.length===0&&(t=[0]);for(var r=0,o=0,a=t;o<a.length;o++){var i=a[o];if(i<0||i>=this.shape[r]){var s="Requested out of range element at "+t+".   Buffer shape="+this.shape;throw new Error(s)}r++}for(var u=t[t.length-1],l=0;l<t.length-1;++l)u+=this.strides[l]*t[l];return this.values[u]},n.prototype.locToIndex=function(t){if(this.rank===0)return 0;if(this.rank===1)return t[0];for(var e=t[t.length-1],r=0;r<t.length-1;++r)e+=this.strides[r]*t[r];return e},n.prototype.indexToLoc=function(t){if(this.rank===0)return[];if(this.rank===1)return[t];for(var e=new Array(this.shape.length),r=0;r<e.length-1;++r)e[r]=Math.floor(t/this.strides[r]),t-=e[r]*this.strides[r];return e[e.length-1]=t,e},Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),n.prototype.toTensor=function(){return Wi().makeTensor(this.values,this.shape,this.dtype)},n}(),Wi=null,Tt=null,$L=null,Tn=function(){function n(t,e,r,o){this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=e||"float32",this.size=Yt(t),this.strides=ya(t),this.dataId=r,this.id=o,this.rankType=this.rank<5?this.rank.toString():"higher"}return n.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},n.prototype.asScalar=function(){return this.throwIfDisposed(),X(this.size===1,function(){return"The array must have only 1 element."}),this.reshape([])},n.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},n.prototype.as2D=function(t,e){return this.throwIfDisposed(),this.reshape([t,e])},n.prototype.as3D=function(t,e,r){return this.throwIfDisposed(),this.reshape([t,e,r])},n.prototype.as4D=function(t,e,r,o){return this.throwIfDisposed(),this.reshape([t,e,r,o])},n.prototype.as5D=function(t,e,r,o,a){return this.throwIfDisposed(),this.reshape([t,e,r,o,a])},n.prototype.asType=function(t){return this.throwIfDisposed(),Tt.cast(this,t)},Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),n.prototype.buffer=function(){return Qt(this,void 0,void 0,function(){var t;return Zt(this,function(e){switch(e.label){case 0:return[4,this.data()];case 1:return t=e.sent(),[2,Tt.buffer(this.shape,this.dtype,t)]}})})},n.prototype.bufferSync=function(){return Tt.buffer(this.shape,this.dtype,this.dataSync())},n.prototype.array=function(){return Qt(this,void 0,void 0,function(){var t;return Zt(this,function(e){switch(e.label){case 0:return[4,this.data()];case 1:return t=e.sent(),[2,hO(this.shape,t)]}})})},n.prototype.arraySync=function(){return hO(this.shape,this.dataSync())},n.prototype.data=function(){return Qt(this,void 0,void 0,function(){var t,e;return Zt(this,function(r){switch(r.label){case 0:return this.throwIfDisposed(),t=Wi().read(this.dataId),this.dtype!=="string"?[3,2]:[4,t];case 1:e=r.sent();try{return[2,e.map(function(o){return Y0(o)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}r.label=2;case 2:return[2,t]}})})},n.prototype.dataSync=function(){this.throwIfDisposed();var t=Wi().readSync(this.dataId);if(this.dtype==="string")try{return t.map(function(e){return Y0(e)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return t},n.prototype.bytes=function(){return Qt(this,void 0,void 0,function(){var t;return Zt(this,function(e){switch(e.label){case 0:return this.throwIfDisposed(),[4,Wi().read(this.dataId)];case 1:return t=e.sent(),this.dtype==="string"?[2,t]:[2,new Uint8Array(t.buffer)]}})})},n.prototype.dispose=function(){this.isDisposed||(Wi().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(n.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),n.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},n.prototype.toFloat=function(){return this.asType("float32")},n.prototype.toInt=function(){return this.asType("int32")},n.prototype.toBool=function(){return this.asType("bool")},n.prototype.print=function(t){return t===void 0&&(t=!1),Tt.print(this,t)},n.prototype.reshape=function(t){return this.throwIfDisposed(),Tt.reshape(this,t)},n.prototype.reshapeAs=function(t){return this.throwIfDisposed(),this.reshape(t.shape)},n.prototype.expandDims=function(t){return t===void 0&&(t=0),Tt.expandDims(this,t)},n.prototype.cumsum=function(t,e,r){return t===void 0&&(t=0),e===void 0&&(e=!1),r===void 0&&(r=!1),Tt.cumsum(this,t,e,r)},n.prototype.squeeze=function(t){return this.throwIfDisposed(),Tt.squeeze(this,t)},n.prototype.clone=function(){return this.throwIfDisposed(),Tt.clone(this)},n.prototype.toString=function(t){return t===void 0&&(t=!1),gat(this.dataSync(),this.shape,this.dtype,t)},n.prototype.gather=function(t,e){return e===void 0&&(e=0),this.throwIfDisposed(),Tt.gather(this,t,e)},n.prototype.matMul=function(t,e,r){return e===void 0&&(e=!1),r===void 0&&(r=!1),this.throwIfDisposed(),Tt.matMul(this,t,e,r)},n.prototype.dot=function(t){return this.throwIfDisposed(),Tt.dot(this,t)},n.prototype.norm=function(t,e,r){return t===void 0&&(t="euclidean"),e===void 0&&(e=null),r===void 0&&(r=!1),this.throwIfDisposed(),Tt.norm(this,t,e,r)},n.prototype.slice=function(t,e){return this.throwIfDisposed(),Tt.slice(this,t,e)},n.prototype.reverse=function(t){return this.throwIfDisposed(),Tt.reverse(this,t)},n.prototype.concat=function(t,e){return e===void 0&&(e=0),this.throwIfDisposed(),t instanceof n&&(t=[t]),Tt.concat([this].concat(t),e)},n.prototype.split=function(t,e){return e===void 0&&(e=0),this.throwIfDisposed(),Tt.split(this,t,e)},n.prototype.stack=function(t,e){return e===void 0&&(e=0),Tt.stack([this,t],e)},n.prototype.unstack=function(t){return t===void 0&&(t=0),Tt.unstack(this,t)},n.prototype.batchNormalization=function(t,e,r,o,a){return r===void 0&&(r=.001),$L("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(t,e,a,o,r)},n.prototype.all=function(t,e){return t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),Tt.all(this,t,e)},n.prototype.any=function(t,e){return t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),Tt.any(this,t,e)},n.prototype.logSumExp=function(t,e){return t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),Tt.logSumExp(this,t,e)},n.prototype.sum=function(t,e){return t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),Tt.sum(this,t,e)},n.prototype.prod=function(t,e){return t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),Tt.prod(this,t,e)},n.prototype.mean=function(t,e){return t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),Tt.mean(this,t,e)},n.prototype.min=function(t,e){return t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),Tt.min(this,t,e)},n.prototype.max=function(t,e){return t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),Tt.max(this,t,e)},n.prototype.argMin=function(t){return t===void 0&&(t=null),this.throwIfDisposed(),Tt.argMin(this,t)},n.prototype.argMax=function(t){return t===void 0&&(t=null),this.throwIfDisposed(),Tt.argMax(this,t)},n.prototype.cast=function(t){return this.throwIfDisposed(),Tt.cast(this,t)},n.prototype.addStrict=function(t){return this.throwIfDisposed(),Tt.addStrict(this,t)},n.prototype.atan2=function(t){return this.throwIfDisposed(),Tt.atan2(this,t)},n.prototype.sub=function(t){return this.throwIfDisposed(),Tt.sub(this,t)},n.prototype.subStrict=function(t){return this.throwIfDisposed(),Tt.subStrict(this,t)},n.prototype.pow=function(t){return this.throwIfDisposed(),Tt.pow(this,t)},n.prototype.powStrict=function(t){return this.throwIfDisposed(),Tt.powStrict(this,t)},n.prototype.mul=function(t){return this.throwIfDisposed(),Tt.mul(this,t)},n.prototype.mulStrict=function(t){return this.throwIfDisposed(),Tt.mulStrict(this,t)},n.prototype.floorDiv=function(t){return this.throwIfDisposed(),Tt.floorDiv(this,t)},n.prototype.divStrict=function(t){return this.throwIfDisposed(),Tt.divStrict(this,t)},n.prototype.minimum=function(t){return this.throwIfDisposed(),Tt.minimum(this,t)},n.prototype.minimumStrict=function(t){return this.throwIfDisposed(),Tt.minimumStrict(this,t)},n.prototype.maximum=function(t){return this.throwIfDisposed(),Tt.maximum(this,t)},n.prototype.maximumStrict=function(t){return this.throwIfDisposed(),Tt.maximumStrict(this,t)},n.prototype.mod=function(t){return this.throwIfDisposed(),Tt.mod(this,t)},n.prototype.modStrict=function(t){return this.throwIfDisposed(),Tt.modStrict(this,t)},n.prototype.squaredDifferenceStrict=function(t){return this.throwIfDisposed(),Tt.squaredDifferenceStrict(this,t)},n.prototype.notEqual=function(t){return this.throwIfDisposed(),Tt.notEqual(this,t)},n.prototype.notEqualStrict=function(t){return this.throwIfDisposed(),Tt.notEqualStrict(this,t)},n.prototype.less=function(t){return this.throwIfDisposed(),Tt.less(this,t)},n.prototype.lessStrict=function(t){return this.throwIfDisposed(),Tt.lessStrict(this,t)},n.prototype.equal=function(t){return this.throwIfDisposed(),Tt.equal(this,t)},n.prototype.equalStrict=function(t){return this.throwIfDisposed(),Tt.equalStrict(this,t)},n.prototype.lessEqual=function(t){return this.throwIfDisposed(),Tt.lessEqual(this,t)},n.prototype.lessEqualStrict=function(t){return this.throwIfDisposed(),Tt.lessEqualStrict(this,t)},n.prototype.greater=function(t){return this.throwIfDisposed(),Tt.greater(this,t)},n.prototype.greaterStrict=function(t){return this.throwIfDisposed(),Tt.greaterStrict(this,t)},n.prototype.greaterEqual=function(t){return this.throwIfDisposed(),Tt.greaterEqual(this,t)},n.prototype.greaterEqualStrict=function(t){return this.throwIfDisposed(),Tt.greaterEqualStrict(this,t)},n.prototype.logicalAnd=function(t){return this.throwIfDisposed(),Tt.logicalAnd(this,t)},n.prototype.logicalOr=function(t){return this.throwIfDisposed(),Tt.logicalOr(this,t)},n.prototype.logicalNot=function(){return this.throwIfDisposed(),Tt.logicalNot(this)},n.prototype.logicalXor=function(t){return this.throwIfDisposed(),Tt.logicalXor(this,t)},n.prototype.where=function(t,e){return this.throwIfDisposed(),Tt.where(t,this,e)},n.prototype.neg=function(){return this.throwIfDisposed(),Tt.neg(this)},n.prototype.ceil=function(){return this.throwIfDisposed(),Tt.ceil(this)},n.prototype.floor=function(){return this.throwIfDisposed(),Tt.floor(this)},n.prototype.sign=function(){return this.throwIfDisposed(),Tt.sign(this)},n.prototype.isNaN=function(){return this.throwIfDisposed(),Tt.isNaN(this)},n.prototype.isInf=function(){return this.throwIfDisposed(),Tt.isInf(this)},n.prototype.isFinite=function(){return this.throwIfDisposed(),Tt.isFinite(this)},n.prototype.exp=function(){return this.throwIfDisposed(),Tt.exp(this)},n.prototype.expm1=function(){return this.throwIfDisposed(),Tt.expm1(this)},n.prototype.log=function(){return this.throwIfDisposed(),Tt.log(this)},n.prototype.log1p=function(){return this.throwIfDisposed(),Tt.log1p(this)},n.prototype.sqrt=function(){return this.throwIfDisposed(),Tt.sqrt(this)},n.prototype.rsqrt=function(){return this.throwIfDisposed(),Tt.rsqrt(this)},n.prototype.square=function(){return this.throwIfDisposed(),Tt.square(this)},n.prototype.reciprocal=function(){return this.throwIfDisposed(),Tt.reciprocal(this)},n.prototype.abs=function(){return this.throwIfDisposed(),Tt.abs(this)},n.prototype.clipByValue=function(t,e){return this.throwIfDisposed(),Tt.clipByValue(this,t,e)},n.prototype.relu=function(){return this.throwIfDisposed(),Tt.relu(this)},n.prototype.relu6=function(){return this.throwIfDisposed(),Tt.relu6(this)},n.prototype.elu=function(){return this.throwIfDisposed(),Tt.elu(this)},n.prototype.selu=function(){return this.throwIfDisposed(),Tt.selu(this)},n.prototype.leakyRelu=function(t){return t===void 0&&(t=.2),this.throwIfDisposed(),Tt.leakyRelu(this,t)},n.prototype.prelu=function(t){return this.throwIfDisposed(),Tt.prelu(this,t)},n.prototype.sigmoid=function(){return this.throwIfDisposed(),Tt.sigmoid(this)},n.prototype.logSigmoid=function(){return this.throwIfDisposed(),Tt.logSigmoid(this)},n.prototype.softplus=function(){return this.throwIfDisposed(),Tt.softplus(this)},n.prototype.zerosLike=function(){return this.throwIfDisposed(),Tt.zerosLike(this)},n.prototype.onesLike=function(){return this.throwIfDisposed(),Tt.onesLike(this)},n.prototype.sin=function(){return this.throwIfDisposed(),Tt.sin(this)},n.prototype.cos=function(){return this.throwIfDisposed(),Tt.cos(this)},n.prototype.tan=function(){return this.throwIfDisposed(),Tt.tan(this)},n.prototype.asin=function(){return this.throwIfDisposed(),Tt.asin(this)},n.prototype.acos=function(){return this.throwIfDisposed(),Tt.acos(this)},n.prototype.atan=function(){return this.throwIfDisposed(),Tt.atan(this)},n.prototype.sinh=function(){return this.throwIfDisposed(),Tt.sinh(this)},n.prototype.cosh=function(){return this.throwIfDisposed(),Tt.cosh(this)},n.prototype.tanh=function(){return this.throwIfDisposed(),Tt.tanh(this)},n.prototype.asinh=function(){return this.throwIfDisposed(),Tt.asinh(this)},n.prototype.acosh=function(){return this.throwIfDisposed(),Tt.acosh(this)},n.prototype.atanh=function(){return this.throwIfDisposed(),Tt.atanh(this)},n.prototype.erf=function(){return this.throwIfDisposed(),Tt.erf(this)},n.prototype.round=function(){return this.throwIfDisposed(),Tt.round(this)},n.prototype.step=function(t){return t===void 0&&(t=0),this.throwIfDisposed(),Tt.step(this,t)},n.prototype.softmax=function(t){return t===void 0&&(t=-1),this.throwIfDisposed(),Tt.softmax(this,t)},n.prototype.logSoftmax=function(t){return t===void 0&&(t=-1),this.throwIfDisposed(),Tt.logSoftmax(this,t)},n.prototype.resizeBilinear=function(t,e){return e===void 0&&(e=!1),this.throwIfDisposed(),Tt.image.resizeBilinear(this,t,e)},n.prototype.resizeNearestNeighbor=function(t,e){return e===void 0&&(e=!1),this.throwIfDisposed(),Tt.image.resizeNearestNeighbor(this,t,e)},n.prototype.conv1d=function(t,e,r,o,a,i){return o===void 0&&(o="NWC"),a===void 0&&(a=1),this.throwIfDisposed(),Tt.conv1d(this,t,e,r,o,a,i)},n.prototype.conv2d=function(t,e,r,o,a,i){return o===void 0&&(o="NHWC"),a===void 0&&(a=[1,1]),this.throwIfDisposed(),Tt.conv2d(this,t,e,r,o,a,i)},n.prototype.conv2dTranspose=function(t,e,r,o,a){return this.throwIfDisposed(),Tt.conv2dTranspose(this,t,e,r,o,a)},n.prototype.depthwiseConv2D=function(t,e,r,o,a,i){return o===void 0&&(o="NHWC"),a===void 0&&(a=[1,1]),this.throwIfDisposed(),Tt.depthwiseConv2d(this,t,e,r,o,a,i)},n.prototype.separableConv2d=function(t,e,r,o,a,i){return a===void 0&&(a=[1,1]),i===void 0&&(i="NHWC"),this.throwIfDisposed(),Tt.separableConv2d(this,t,e,r,o,a,i)},n.prototype.avgPool=function(t,e,r,o){return this.throwIfDisposed(),Tt.avgPool(this,t,e,r,o)},n.prototype.maxPool=function(t,e,r,o){return this.throwIfDisposed(),Tt.maxPool(this,t,e,r,o)},n.prototype.localResponseNormalization=function(t,e,r,o){return t===void 0&&(t=5),e===void 0&&(e=1),r===void 0&&(r=1),o===void 0&&(o=.5),Tt.localResponseNormalization(this,t,e,r,o)},n.prototype.pool=function(t,e,r,o,a){return this.throwIfDisposed(),Tt.pool(this,t,e,r,o,a)},n.prototype.variable=function(t,e,r){return t===void 0&&(t=!0),this.throwIfDisposed(),Wi().makeVariable(this,t,e,r)},n.prototype.unsortedSegmentSum=function(t,e){return this.throwIfDisposed(),Tt.unsortedSegmentSum(this,t,e)},n.prototype.batchToSpaceND=function(t,e){return this.throwIfDisposed(),Tt.batchToSpaceND(this,t,e)},n.prototype.spaceToBatchND=function(t,e){return this.throwIfDisposed(),Tt.spaceToBatchND(this,t,e)},n.prototype.topk=function(t,e){return t===void 0&&(t=1),e===void 0&&(e=!0),this.throwIfDisposed(),Tt.topk(this,t,e)},n.prototype.stridedSlice=function(t,e,r,o,a,i,s,u){return o===void 0&&(o=0),a===void 0&&(a=0),i===void 0&&(i=0),s===void 0&&(s=0),u===void 0&&(u=0),this.throwIfDisposed(),Tt.stridedSlice(this,t,e,r,o,a,i,s,u)},n.prototype.depthToSpace=function(t,e){return this.throwIfDisposed(),Tt.depthToSpace(this,t,e)},n.prototype.fft=function(){return this.throwIfDisposed(),Tt.spectral.fft(this)},n.prototype.ifft=function(){return this.throwIfDisposed(),Tt.spectral.ifft(this)},n.prototype.rfft=function(){return this.throwIfDisposed(),Tt.spectral.rfft(this)},n.prototype.irfft=function(){return this.throwIfDisposed(),Tt.spectral.irfft(this)},n}();Object.defineProperty(Tn,Symbol.hasInstance,{value:function(n){return!!n&&n.dataId!=null&&n.shape!=null&&n.dtype!=null}});var dO,nE,rE,oE,aE,Pf=function(n){function t(e,r,o,a){var i=n.call(this,e.shape,e.dtype,e.dataId,a)||this;return i.trainable=r,i.name=o,i}return wi(t,n),t.prototype.assign=function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value ("+e.dtype+") and previous value ("+this.dtype+") must match");if(!zr(e.shape,this.shape))throw new Error("shape of the new value ("+e.shape+") and previous value ("+this.shape+") must match");Wi().disposeTensor(this),this.dataId=e.dataId,Wi().incRef(this,null)},t.prototype.dispose=function(){Wi().disposeVariable(this),this.isDisposedInternal=!0},t}(Tn);Object.defineProperty(Pf,Symbol.hasInstance,{value:function(n){return n instanceof Tn&&n.assign!=null&&n.assign instanceof Function}}),function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"}(dO||(dO={})),function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"}(nE||(nE={})),function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"}(rE||(rE={})),function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"}(oE||(oE={})),function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"}(aE||(aE={}));var vat={float32:oE,int32:nE,bool:rE,complex64:aE};function Yr(n,t){if(n==="string"||t==="string"){if(n==="string"&&t==="string")return"string";throw new Error("Can not upcast "+n+" with "+t)}return vat[n][t]}function DC(n){return Yr(n,"int32")}function Vn(n,t){if(n.dtype===t.dtype)return[n,t];var e=Yr(n.dtype,t.dtype);return[n.cast(e),t.cast(e)]}function xat(n,t){X(n.dtype===t.dtype,function(){return"The dtypes of the first("+n.dtype+") and second("+t.dtype+") input must match"})}function OL(n){var t=[];return function e(r,o,a){if(r!=null){if(r instanceof Tn)return void o.push(r);if(i=r,!(!Array.isArray(i)&&typeof i!="object")){var i,s=r;for(var u in s){var l=s[u];a.has(l)||(a.add(l),e(l,o,a))}}}}(n,t,new Set),t}var $C,pO=function(){function n(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return n.prototype.dispose=function(){for(var t in this.registeredVariables)this.registeredVariables[t].dispose()},n}(),yat=function(){function n(t){this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new pO}return n.prototype.ready=function(){return Qt(this,void 0,void 0,function(){var t,e,r;return Zt(this,function(o){switch(o.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];t=this.getSortedBackends(),e=0,o.label=1;case 1:return e<t.length?(r=t[e],[4,this.initializeBackend(r).success]):[3,5];case 2:return o.sent()?[4,this.setBackend(r)]:[3,4];case 3:return o.sent(),[2];case 4:return e++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(n.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var t=this.initializeBackendsAndReturnBest(),e=t.name;if(t.asyncInit)throw new Error("The highest priority backend '"+e+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(e)}return this.backendInstance},enumerable:!0,configurable:!0}),n.prototype.backendNames=function(){return Object.keys(this.registryFactory)},n.prototype.findBackend=function(t){return!(t in this.registry)&&(!(t in this.registryFactory)||this.initializeBackend(t).asyncInit)?null:this.registry[t]},n.prototype.findBackendFactory=function(t){return t in this.registryFactory?this.registryFactory[t].factory:null},n.prototype.registerBackend=function(t,e,r){return r===void 0&&(r=1),t in this.registryFactory?(console.warn(t+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[t]={factory:e,priority:r},!0)},n.prototype.setBackend=function(t){return Qt(this,void 0,void 0,function(){var e,r,o;return Zt(this,function(a){switch(a.label){case 0:if(this.registryFactory[t]==null)throw new Error("Backend name '"+t+"' not found in registry");return this.backendName=t,this.registry[t]!=null?[3,4]:(this.backendInstance=null,e=this.initializeBackend(t),r=e.success,e.asyncInit?[4,r]:[3,2]);case 1:return o=a.sent(),[3,3];case 2:o=r,a.label=3;case 3:if(!o)return[2,!1];a.label=4;case 4:return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new pat(this.backendInstance),[2,!0]}})})},n.prototype.setupRegisteredKernels=function(){var t=this;lO(this.backendName).forEach(function(e){e.setupFunc!=null&&e.setupFunc(t.backendInstance)})},n.prototype.disposeRegisteredKernels=function(t){var e=this;lO(t).forEach(function(r){r.disposeFunc!=null&&r.disposeFunc(e.registry[t])})},n.prototype.initializeBackend=function(t){var e=this,r=this.registryFactory[t];if(r==null)throw new Error("Cannot initialize backend "+t+", no registration found.");try{var o=r.factory();if(Promise.resolve(o)===o){var a=++this.pendingBackendInitId,i=o.then(function(s){return!(a<e.pendingBackendInitId)&&(e.registry[t]=s,e.pendingBackendInit=null,!0)}).catch(function(s){return!(a<e.pendingBackendInitId)&&(e.pendingBackendInit=null,console.warn("Initialization of backend "+t+" failed"),console.warn(s.stack||s.message),!1)});return this.pendingBackendInit=i,{success:i,asyncInit:!0}}return this.registry[t]=o,{success:!0,asyncInit:!1}}catch(s){return console.warn("Initialization of backend "+t+" failed"),console.warn(s.stack||s.message),{success:!1,asyncInit:!1}}},n.prototype.removeBackend=function(t){if(!(t in this.registryFactory))throw new Error(t+" backend not found in registry");this.backendName===t&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,t in this.registry&&(this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t]),delete this.registryFactory[t],this.backendName===t&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},n.prototype.getSortedBackends=function(){var t=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(e,r){return t.registryFactory[r].priority-t.registryFactory[e].priority})},n.prototype.initializeBackendsAndReturnBest=function(){for(var t=this.getSortedBackends(),e=0;e<t.length;e++){var r=t[e],o=this.initializeBackend(r),a=o.success,i=o.asyncInit;if(i||a)return{name:r,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")},n.prototype.moveData=function(t,e){var r=this.state.tensorInfo.get(e),o=r.backend,a=this.readSync(e);o.disposeData(e),r.backend=t,t.move(e,a,r.shape,r.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},n.prototype.tidy=function(t,e){var r,o=this,a=null;if(e==null){if(typeof t!="function")throw new Error("Please provide a function to tidy()");e=t}else{if(typeof t!="string"&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof e!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=t}return this.scopedRun(function(){return o.startScope(a)},function(){return o.endScope(r)},function(){return(r=e())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r})},n.prototype.scopedRun=function(t,e,r){t();try{var o=r();return e(),o}catch(a){throw e(),a}},n.prototype.nextTensorId=function(){return n.nextTensorId++},n.prototype.nextVariableId=function(){return n.nextVariableId++},n.prototype.clone=function(t){var e=this.makeTensorFromDataId(t.dataId,t.shape,t.dtype),r={x:t};return this.addTapeNode(this.state.activeScope.name,r,[e],function(o){return{x:function(){return o.toFloat()}}},[],{}),e},n.prototype.runKernel=function(t,e,r,o,a){return this.runKernelFunc(null,e,null,t,r,o,a)},n.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},n.prototype.checkKernelForMemLeak=function(t,e,r){var o=this.backend.numDataIds(),a=0;r.forEach(function(u){a+=u.dtype==="complex64"?3:1});var i=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=o-e-a-i;if(s>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+s+" data ids) after running '"+t+"'")},n.prototype.runKernelFunc=function(t,e,r,o,a,i,s){var u,l=this,c=[],h=this.isTapeOn();o==null&&(o=this.state.activeScope!=null?this.state.activeScope.name:"");var d,p=this.state.numBytes,g=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var x,y=SL(o,this.backendName);if(y!=null)d=function(){var C=l.backend.numDataIds();x=y.kernelFunc({inputs:e,attrs:a,backend:l.backend});var E=Array.isArray(x)?x:[x];l.shouldCheckForMemLeaks()&&l.checkKernelForMemLeak(o,C,E);var S=E.map(function(A){var N=A.dataId,_=A.shape,$=A.dtype;return l.makeTensorFromDataId(N,_,$)});if(h){var k=l.getTensorsForGradient(o,e,S);if(k==null){s==null&&(s=[]);var R=S.filter(function(A,N){return s[N]});k=(i||[]).slice().concat(R)}c=l.saveTensorsForBackwardMode(k)}return S};else{var b=function(C){h&&(c=C.map(function(E){return l.keep(l.clone(E))}))};d=function(){var C=l.backend.numDataIds();x=l.tidy(function(){return t(l.backend,b)});var E=Array.isArray(x)?x:[x];return l.shouldCheckForMemLeaks()&&l.checkKernelForMemLeak(o,C,E),E}}return this.scopedRun(function(){return l.state.kernelDepth++},function(){return l.state.kernelDepth--},function(){u=l.ENV.getBool("DEBUG")?l.profiler.profileKernel(o,e,function(){return d()}):d()}),h&&this.addTapeNode(o,e,u,r,c,a),this.state.profiling&&this.state.activeProfile.kernels.push({name:o,bytesAdded:this.state.numBytes-p,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-g,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(e).map(function(C){return e[C].shape}),outputShapes:u.map(function(C){return C.shape})}),Array.isArray(x)?u:u[0]},n.prototype.saveTensorsForBackwardMode=function(t){var e=this;return t.map(function(r){return e.keep(e.clone(r))})},n.prototype.getTensorsForGradient=function(t,e,r){var o=uO(t);if(o!=null){var a=o.inputsToSave||[],i=o.outputsToSave||[],s=void 0;o.saveAllInputs?(X(Array.isArray(e),function(){return"saveAllInputs is true, expected inputs to be an array."}),s=Object.keys(e).map(function(l){return e[l]})):s=a.map(function(l){return e[l]});var u=r.filter(function(l,c){return i[c]});return s.concat(u)}return null},n.prototype.makeTensor=function(t,e,r,o){if(t==null)throw new Error("Values passed to engine.makeTensor() are null");r=r||"float32",o=o||this.backend;var a=t;r==="string"&&Ak(t[0])&&(a=t.map(function(c){return dat(c)}));var i=o.write(a,e,r),s=new Tn(e,r,i,this.nextTensorId());if(this.incRef(s,o),r==="string"){var u=this.state.tensorInfo.get(i),l=cat(a);this.state.numBytes+=l-u.bytes,u.bytes=l}return s},n.prototype.makeTensorFromDataId=function(t,e,r,o){var a=new Tn(e,r=r||"float32",t,this.nextTensorId());return this.incRef(a,o),a},n.prototype.makeVariable=function(t,e,r,o){e===void 0&&(e=!0),r=r||this.nextVariableId().toString(),o!=null&&o!==t.dtype&&(t=t.asType(o));var a=new Pf(t,e,r,this.nextTensorId());if(this.state.registeredVariables[a.name]!=null)throw new Error("Variable with name "+a.name+" was already registered");return this.state.registeredVariables[a.name]=a,this.incRef(a,this.backend),a},n.prototype.incRef=function(t,e){var r=this.state.tensorInfo.has(t.dataId)?this.state.tensorInfo.get(t.dataId).refCount:0;if(this.state.numTensors++,t.dtype==="string"&&this.state.numStringTensors++,r===0){this.state.numDataBuffers++;var o=0;t.dtype!=="complex64"&&t.dtype!=="string"&&(o=t.size*RL(t.dtype)),this.state.tensorInfo.set(t.dataId,{backend:e||this.backend,dtype:t.dtype,shape:t.shape,bytes:o,refCount:0}),this.state.numBytes+=o}this.state.tensorInfo.get(t.dataId).refCount++,t instanceof Pf||this.track(t)},n.prototype.disposeTensor=function(t){if(this.state.tensorInfo.has(t.dataId)){this.state.numTensors--,t.dtype==="string"&&this.state.numStringTensors--;var e=this.state.tensorInfo.get(t.dataId);e.refCount<=1?(t.dtype!=="complex64"&&(this.state.numBytes-=e.bytes),this.state.numDataBuffers--,e.backend.disposeData(t.dataId),this.state.tensorInfo.delete(t.dataId)):this.state.tensorInfo.get(t.dataId).refCount--}},n.prototype.disposeVariables=function(){for(var t in this.state.registeredVariables){var e=this.state.registeredVariables[t];this.disposeVariable(e)}},n.prototype.disposeVariable=function(t){this.disposeTensor(t),this.state.registeredVariables[t.name]!=null&&delete this.state.registeredVariables[t.name]},n.prototype.memory=function(){var t=this.backend.memory();return t.numTensors=this.state.numTensors,t.numDataBuffers=this.state.numDataBuffers,t.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(t.unreliable=!0,t.reasons==null&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t},n.prototype.profile=function(t){return Qt(this,void 0,void 0,function(){var e,r;return Zt(this,function(o){return this.state.profiling=!0,e=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=t(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(a){return a.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-e,this.state.activeProfile.newTensors=this.state.numTensors-r,[2,this.state.activeProfile]})})},n.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},n.prototype.addTapeNode=function(t,e,r,o,a,i){var s=this,u={id:this.state.nextTapeNodeId++,kernelName:t,inputs:e,outputs:r,saved:a},l=uO(t);l!=null&&(o=l.gradFunc),o!=null&&(u.gradient=function(c){return c=c.map(function(h,d){if(h==null){var p=r[d],g=Pm(p.size,p.dtype);return s.makeTensor(g,p.shape,p.dtype)}return h}),o(c.length>1?c:c[0],a,i)}),this.state.activeTape.push(u)},n.prototype.keep=function(t){return t.kept=!0,t},n.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},n.prototype.endTape=function(){this.state.gradientDepth--},n.prototype.startScope=function(t){var e={track:[],name:"unnamed scope",id:this.state.nextScopeId++};t&&(e.name=t),this.state.scopeStack.push(e),this.state.activeScope=e},n.prototype.endScope=function(t){for(var e=this,r=OL(t),o=new Set(r.map(function(u){return u.id})),a=0;a<this.state.activeScope.track.length;a++){var i=this.state.activeScope.track[a];i.kept||o.has(i.id)||i.dispose()}var s=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],r.forEach(function(u){u.kept||u.scopeId!==s.id||e.track(u)})},n.prototype.gradients=function(t,e,r,o){var a=this;if(o===void 0&&(o=!1),X(e.length>0,function(){return"gradients() received an empty list of xs."}),r!=null&&r.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+r.dtype+"'");var i=this.scopedRun(function(){return a.startTape()},function(){return a.endTape()},function(){return a.tidy("forward",t)});X(i instanceof Tn,function(){return"The result y returned by f() must be a tensor."});var s=function(u,l,c){for(var h={},d={},p=0;p<l.length;p++)h[l[p].id]=!0;for(p=0;p<u.length;p++){var g=(R=u[p]).inputs;for(var x in g){for(var y=g[x],b=!1,C=0;C<l.length;C++)if(h[y.id]){R.outputs.forEach(function($){return h[$.id]=!0}),b=!0,d[R.id]=!0;break}if(b)break}}var E={};E[c.id]=!0;var S={};for(p=u.length-1;p>=0;p--)for(g=(R=u[p]).inputs,C=0;C<R.outputs.length;C++)if(E[R.outputs[C].id]){for(var x in g)E[g[x].id]=!0,S[R.id]=!0;break}var k=[];for(p=0;p<u.length;p++){var R;if(d[(R=u[p]).id]&&S[R.id]){var A={};for(var x in R.inputs){var N=R.inputs[x];h[N.id]&&(A[x]=N)}var _=Object.assign({},R);_.inputs=A,_.outputs=R.outputs,k.push(_)}}return k}(this.state.activeTape,e,i);if(!o&&s.length===0&&e.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var u,l,c={};c[i.id]=r??(u=i.shape,l=NL(Yt(u),"float32"),st.makeTensor(l,u,"float32")),function(d,p,g){for(var x=function(b){var C=p[b],E=[];if(C.outputs.forEach(function(A){var N=d[A.id];N!=null?E.push(N):E.push(null)}),C.gradient==null)throw new Error("Cannot compute gradient: gradient function not found for "+C.kernelName+".");var S=C.gradient(E),k=function(A){if(!(A in S))throw new Error("Cannot backprop through input "+A+". Available gradients found: "+Object.keys(S)+".");var N=g(function(){return S[A]()});if(N.dtype!=="float32")throw new Error("Error in gradient for op "+C.kernelName+". The gradient of input "+A+" must have 'float32' dtype, but has '"+N.dtype+"'");var _=C.inputs[A];if(!zr(N.shape,_.shape))throw new Error("Error in gradient for op "+C.kernelName+". The gradient of input '"+A+"' has shape '"+N.shape+"', which does not match the shape of the input '"+_.shape+"'");if(d[_.id]==null)d[_.id]=N;else{var $=d[_.id];d[_.id]=$.add(N),$.dispose()}};for(var R in C.inputs)k(R)},y=p.length-1;y>=0;y--)x(y)}(c,s,function(d){return a.tidy(d)});var h=e.map(function(d){return c[d.id]});return a.state.gradientDepth===0&&(a.state.activeTape.forEach(function(d){for(var p=0,g=d.saved;p<g.length;p++)g[p].dispose()}),a.state.activeTape=null),{value:i,grads:h}})},n.prototype.customGrad=function(t){var e=this;return X(JS(t),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var r,o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];X(o.every(function(s){return s instanceof Tn}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var i={};return o.forEach(function(s,u){i[u]=s}),e.runKernelFunc(function(s,u){return X((r=t.apply(void 0,o.concat([u]))).value instanceof Tn,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),X(JS(r.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),r.value},i,function(s,u){var l=r.gradFunc(s,u),c=Array.isArray(l)?l:[l];X(c.length===o.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),X(c.every(function(d){return d instanceof Tn}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var h={};return c.forEach(function(d,p){h[p]=function(){return d}}),h})}},n.prototype.readSync=function(t){return this.state.tensorInfo.get(t).backend.readSync(t)},n.prototype.read=function(t){return this.state.tensorInfo.get(t).backend.read(t)},n.prototype.time=function(t){return Qt(this,void 0,void 0,function(){var e,r;return Zt(this,function(o){switch(o.label){case 0:return e=Li(),[4,this.backend.time(t)];case 1:return(r=o.sent()).wallMs=Li()-e,[2,r]}})})},n.prototype.track=function(t){return this.state.activeScope!=null&&(t.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(t)),t},Object.defineProperty(n.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),n.prototype.reset=function(){for(var t in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new pO,this.registry)this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},n.nextTensorId=0,n.nextVariableId=0,n}(),st=function(){var n=function(){if($C==null){var e=void 0;if(typeof window<"u")e=window;else if(typeof global<"u")e=global;else if(typeof process<"u")e=process;else{if(typeof self>"u")throw new Error("Could not find a global object");e=self}$C=e}return $C}();if(n._tfengine==null){var t=new eat(n);n._tfengine=new yat(t)}return function(e){CL=e}(n._tfengine.ENV),Wi=function(){return n._tfengine},n._tfengine}();function FL(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var Fs=Nt();Fs.registerFlag("DEBUG",function(){return!1},function(n){n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),Fs.registerFlag("IS_BROWSER",function(){return FL()}),Fs.registerFlag("IS_NODE",function(){return typeof process<"u"&&process.versions!==void 0&&process.versions.node!==void 0}),Fs.registerFlag("IS_CHROME",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),Fs.registerFlag("PROD",function(){return!1}),Fs.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return Fs.getBool("DEBUG")}),Fs.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),Fs.registerFlag("IS_TEST",function(){return!1});var rm,ma,ha,Jl={},OC={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function bat(n,t){Jl[n]=t}function ms(n){n in Jl||(Jl[n]=function(e){if(e!==1&&e!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var r=function(o){if(typeof OffscreenCanvas<"u"&&o===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(e);return r.addEventListener("webglcontextlost",function(o){o.preventDefault(),delete Jl[e]},!1),e===1?r.getContext("webgl",OC)||r.getContext("experimental-webgl",OC):r.getContext("webgl2",OC)}(n));var t=Jl[n];return t.isContextLost()?(delete Jl[n],ms(n)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),Jl[n])}function Zy(n,t){return[t,n]}function Xp(n){var t=Yt(n);return ZS(Math.ceil(t/4))}function Bm(n,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(n/2))]}function _k(n,t){var e,r,o,a,i,s,u,l,c,h=n;return Nt().getNumber("WEBGL_VERSION")===2?(e=h.R32F,r=h.R16F,o=h.RGBA16F,a=h.RGBA32F,i=h.RED,s=4,u=1,l=h.HALF_FLOAT,c=h.FLOAT):(e=n.RGBA,r=n.RGBA,o=n.RGBA,a=h.RGBA,i=n.RGBA,s=4,u=4,l=t!=null?t.HALF_FLOAT_OES:null,c=n.FLOAT),{internalFormatFloat:e,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:o,internalFormatPackedFloat:a,textureFormatFloat:i,downloadTextureFormat:n.RGBA,downloadUnpackNumChannels:s,defaultNumChannels:u,textureTypeHalfFloat:l,textureTypeFloat:c}}function oe(n,t,e){var r=e();return t&&function(o){var a=o.getError();if(a!==o.NO_ERROR)throw new Error("WebGL Error: "+Eat(o,a))}(n),r}(function(n){n[n.DENSE=0]="DENSE",n[n.SHARED_BATCH=1]="SHARED_BATCH"})(rm||(rm={})),function(n){n[n.RENDER=0]="RENDER",n[n.UPLOAD=1]="UPLOAD",n[n.PIXELS=2]="PIXELS",n[n.DOWNLOAD=3]="DOWNLOAD"}(ma||(ma={})),function(n){n[n.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",n[n.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",n[n.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",n[n.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",n[n.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(ha||(ha={}));var wat=596e-10,Cat=65504;function Sat(n){return!!(Nt().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||n===0||wat<Math.abs(n)&&Math.abs(n)<Cat)}function Eat(n,t){switch(t){case n.NO_ERROR:return"NO_ERROR";case n.INVALID_ENUM:return"INVALID_ENUM";case n.INVALID_VALUE:return"INVALID_VALUE";case n.INVALID_OPERATION:return"INVALID_OPERATION";case n.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case n.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case n.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+t}}function $x(n,t,e){return ou(n,t,function(){return n.getExtension(e)},'Extension "'+e+'" not supported on this browser.')}function kat(n,t,e){var r=ou(n,t,function(){return n.createShader(n.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(oe(n,t,function(){return n.shaderSource(r,e)}),oe(n,t,function(){return n.compileShader(r)}),n.getShaderParameter(r,n.COMPILE_STATUS)===!1)throw console.log(n.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function Iat(n,t,e){var r=ou(n,t,function(){return n.createShader(n.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(oe(n,t,function(){return n.shaderSource(r,e)}),oe(n,t,function(){return n.compileShader(r)}),n.getShaderParameter(r,n.COMPILE_STATUS)===!1)throw function(o,a){var i=Rat.exec(a);if(i==null)return console.log("Couldn't parse line number in error: "+a),void console.log(o);for(var s=+i[1],u=o.split(`
`),l=u.length.toString().length+2,c=u.map(function(y,b){return vf((b+1).toString(),l)+y}),h=0,d=0;d<c.length;d++)h=Math.max(c[d].length,h);var p=c.slice(0,s-1),g=c.slice(s-1,s),x=c.slice(s);console.log(p.join(`
`)),console.log(a.split(`
`)[0]),console.log("%c "+vf(g[0],h),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(x.join(`
`))}(e,n.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}var FC,MC,Rat=/ERROR: [0-9]+:([0-9]+):/g;function Tat(n,t){return ou(n,t,function(){return n.createProgram()},"Unable to create WebGLProgram.")}function Nat(n,t,e){if(oe(n,t,function(){return n.linkProgram(e)}),n.getProgramParameter(e,n.LINK_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function LC(n,t,e){if(oe(n,t,function(){return n.validateProgram(e)}),n.getProgramParameter(e,n.VALIDATE_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function Aat(n,t,e){var r=ou(n,t,function(){return n.createBuffer()},"Unable to create WebGLBuffer");return oe(n,t,function(){return n.bindBuffer(n.ARRAY_BUFFER,r)}),oe(n,t,function(){return n.bufferData(n.ARRAY_BUFFER,e,n.STATIC_DRAW)}),r}function _at(n,t,e){var r=ou(n,t,function(){return n.createBuffer()},"Unable to create WebGLBuffer");return oe(n,t,function(){return n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,r)}),oe(n,t,function(){return n.bufferData(n.ELEMENT_ARRAY_BUFFER,e,n.STATIC_DRAW)}),r}function Dat(n,t){return ou(n,t,function(){return n.createTexture()},"Unable to create WebGLTexture.")}function $at(n,t){var e=Nt().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n<=0||t<=0){var r="["+n+"x"+t+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(n>e||t>e)throw r="["+n+"x"+t+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+("["+e+"x"+e+"]")+".")}function Oat(n,t){return ou(n,t,function(){return n.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function mO(n,t,e,r,o,a,i,s){var u=n.getAttribLocation(e,r);return u!==-1&&(oe(n,t,function(){return n.bindBuffer(n.ARRAY_BUFFER,o)}),oe(n,t,function(){return n.vertexAttribPointer(u,a,n.FLOAT,!1,i,s)}),oe(n,t,function(){return n.enableVertexAttribArray(u)}),!0)}function Fat(n,t,e,r){zat(n,r),oe(n,t,function(){return n.activeTexture(n.TEXTURE0+r)}),oe(n,t,function(){return n.bindTexture(n.TEXTURE_2D,e)})}function Mat(n,t,e,r){return ou(n,t,function(){return n.getUniformLocation(e,r)},'uniform "'+r+'" not present in program.')}function Lat(n,t,e){return n.getUniformLocation(t,e)}function Pat(n,t,e,r,o,a){oe(n,t,function(){return Fat(n,t,r,a)}),oe(n,t,function(){return n.uniform1i(o,a)})}function PC(n,t,e,r){oe(n,t,function(){return n.bindFramebuffer(n.FRAMEBUFFER,r)}),oe(n,t,function(){return n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0)})}function gO(n,t,e){oe(n,t,function(){return n.bindFramebuffer(n.FRAMEBUFFER,e)}),oe(n,t,function(){return n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0)})}function Ox(n){var t=n.checkFramebufferStatus(n.FRAMEBUFFER);if(t!==n.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+Bat(n,t))}function Bat(n,t){switch(t){case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case n.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+t}}function ou(n,t,e,r){var o=oe(n,t,function(){return e()});if(o==null)throw new Error(r);return o}function zat(n,t){var e=n.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+n.TEXTURE0;if(r<n.TEXTURE0||r>e)throw new Error("textureUnit must be in "+("[gl.TEXTURE0, gl.TEXTURE"+e+"]")+".")}function Q0(n,t){return t===void 0&&(t=2),Yt(n.slice(0,n.length-t))}function Z0(n){if(n.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[n.length>1?n[n.length-2]:1,n[n.length-1]]}function BC(n){var t=[1,1,1];return n.length===0||n.length===1&&n[0]===1||(t=[Q0(n)].concat(Z0(n))),t}function Uat(n,t){var e;t===void 0&&(t=!1);var r=Nt().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t&&(r*=2,(n=n.map(function(l,c){return c>=n.length-2?IL(n[c]):n[c]})).length===1&&(n=[2,n[0]])),n.length!==2){var o=rc(n);n=o.newShape}var a=Yt(n);if(n.length<=1&&a<=r)return[1,a];if(n.length===2&&n[0]<=r&&n[1]<=r)return n;if(n.length===3&&n[0]*n[1]<=r&&n[2]<=r)return[n[0]*n[1],n[2]];if(n.length===3&&n[0]<=r&&n[1]*n[2]<=r)return[n[0],n[1]*n[2]];if(n.length===4&&n[0]*n[1]*n[2]<=r&&n[3]<=r)return[n[0]*n[1]*n[2],n[3]];if(n.length===4&&n[0]<=r&&n[1]*n[2]*n[3]<=r)return[n[0],n[1]*n[2]*n[3]];if(t){var i=Q0(n),s=2,u=2;return n.length&&(s=(e=Z0(n))[0],u=e[1]),ZS(a=i*(s/2)*(u/2)).map(function(l){return 2*l})}return ZS(a)}function Fx(n){return n%2==0}function Mx(n,t){if(zr(n=n.slice(-2),t=t.slice(-2))||!n.length||!t.length||n[0]===0||n[1]===0||t[0]===0||t[1]===0)return!0;if(n.length!==t.length){var e=n.slice(-1)[0],r=t.slice(-1)[0];if(e===r||Fx(e)&&Fx(r)&&(n[0]===1||t[0]===1))return!0}return n[1]===t[1]&&Fx(n[0])&&Fx(t[0])}function Wat(n){if(FC==null){var t=ms(n);FC=t.getParameter(t.MAX_TEXTURE_SIZE)}return FC}function Vat(n){if(MC==null){var t=ms(n);MC=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,MC)}function Gat(n){if(n===0)return 0;var t=ms(n);return za(t,"EXT_disjoint_timer_query_webgl2")&&n===2?2:za(t,"EXT_disjoint_timer_query")?1:0}function za(n,t){return n.getExtension(t)!=null}function vO(n){try{if(ms(n)!=null)return!0}catch{return!1}return!1}function Hat(n){if(n===0)return!1;var t=ms(n);if(n===1){if(!za(t,"OES_texture_float"))return!1}else if(!za(t,"EXT_color_buffer_float"))return!1;return iE(t)}function qat(n){if(n===0)return!1;var t=ms(n);if(n!==1){if(za(t,"EXT_color_buffer_float"))return iE(t);if(za(t,"EXT_color_buffer_half_float")){var e=t.getExtension("EXT_color_buffer_half_float");return function(r,o){var a=_k(r,o),i=r.createTexture();r.bindTexture(r.TEXTURE_2D,i),r.texImage2D(r.TEXTURE_2D,0,a.internalFormatHalfFloat,1,1,0,a.textureFormatFloat,a.textureTypeHalfFloat,null);var s=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,s),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,i,0);var u=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(i),r.deleteFramebuffer(s),u}(t,e)}return!1}return!!za(t,"OES_texture_float")&&!!za(t,"WEBGL_color_buffer_float")&&iE(t)}function iE(n){var t=_k(n),e=n.createTexture();n.bindTexture(n.TEXTURE_2D,e),n.texImage2D(n.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);var r=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,r),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0);var o=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(e),n.deleteFramebuffer(r),o}function jat(n){return n===2&&ms(n).fenceSync!=null}var be=Nt();function ML(n){Nt().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(n+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function an(n,t){return st.tidy(n,t)}function qo(n){OL(n).forEach(function(t){return t.dispose()})}function Xat(n){return st.keep(n)}function J0(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];Nt().getBool("IS_TEST")||console.warn.apply(console,n)}function vl(n,t){var e=n;if(Xi(n))return t==="string"?[]:[n.length];if(!Array.isArray(n))return[];for(var r=[];Array.isArray(e)||Xi(e)&&t!=="string";)r.push(e.length),e=e[0];return Array.isArray(n)&&Nt().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function o(a,i,s){if(s=s||[],!Array.isArray(a)&&!Xi(a))return void X(i.length===0,function(){return"Element arr["+s.join("][")+"] is a primitive, but should be an array/TypedArray of "+i[0]+" elements"});X(i.length>0,function(){return"Element arr["+s.join("][")+"] should be a primitive, but is an array of "+a.length+" elements"}),X(a.length===i[0],function(){return"Element arr["+s.join("][")+"] should have "+i[0]+" elements, but has "+a.length+" elements"});for(var u=i.slice(1),l=0;l<a.length;++l)o(a[l],u,s.concat(l))}(n,r,[]),r}function xO(n,t,e,r){if(n!=null&&(n!=="numeric"&&n!==t||n==="numeric"&&t==="string"))throw new Error("Argument '"+e+"' passed to '"+r+"' must be "+n+" tensor, but got "+t+" tensor")}function j(n,t,e,r){if(r===void 0&&(r="numeric"),n instanceof Tn)return xO(r,n.dtype,t,e),n;var o=Lm(n);if(o!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(o=r),xO(r,o,t,e),n==null||!Xi(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){var a=n==null?"null":n.constructor.name;throw new Error("Argument '"+t+"' passed to '"+e+"' must be a Tensor or TensorLike, but got '"+a+"'")}var i=vl(n,o);Xi(n)||Array.isArray(n)||(n=[n]);var s=o!=="string"?TL(n,o,Nt().getBool("DEBUG")):Mf(n,[],!0);return st.makeTensor(s,i,o)}function ty(n,t,e,r){if(r===void 0&&(r="numeric"),!Array.isArray(n))throw new Error("Argument "+t+" passed to "+e+" must be a `Tensor[]` or `TensorLike[]`");return n.map(function(o,a){return j(o,t+"["+a+"]",e)},r)}function LL(n,t){for(var e=0;e<n.length;++e)if(n[n.length-e-1]!==t-1-e)return!1;return!0}function Kat(n,t,e){for(var r=n.length+t.length,o=[],a=0,i=0,s=0;s<r;s++)e.indexOf(s)===-1?o.push(n[a++]):o.push(t[i++]);return o}function ho(n,t){for(var e=[],r=n.length,o=0;o<r;o++)t.indexOf(o)===-1&&e.push(n[o]);return[e,t.map(function(a){return n[a]})]}function Ko(n,t){return Kat(n,t.map(function(e){return 1}),t)}function ca(n,t,e){X(LL(t,e),function(){return n+" supports only inner-most axes for now. Got axes "+t+" and rank-"+e+" input."})}function gs(n,t){if(LL(n,t))return null;for(var e=[],r=0;r<t;++r)n.indexOf(r)===-1&&e.push(r);return n.forEach(function(o){return e.push(o)}),e}function Dk(n){return n.map(function(t,e){return[e,t]}).sort(function(t,e){return t[1]-e[1]}).map(function(t){return t[0]})}function vs(n,t){for(var e=[],r=t-n;r<t;++r)e.push(r);return e}function Yat(n,t){var e=n[0].length;n.forEach(function(o,a){X(o.length===e,function(){return"Error in concat"+e+"D: rank of tensors["+a+"] must be the same as the rank of the rest ("+e+")"})}),X(t>=0&&t<e,function(){return"Error in concat"+e+"D: axis must be between 0 and "+(e-1)+"."});var r=n[0];n.forEach(function(o,a){for(var i=0;i<e;i++)X(i===t||o[i]===r[i],function(){return"Error in concat"+e+"D: Shape of tensors["+a+"] ("+o+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+a+"."})})}function Bf(n,t){for(var e=n[0].slice(),r=1;r<n.length;r++)e[t]+=n[r][t];return e}function nt(n){var t=Object.keys(n);if(t.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+t.length+" keys.");var e=t[0],r=n[e];e.endsWith("_")&&(e=e.substring(0,e.length-1));var o=function(){for(var a=[],i=0;i<arguments.length;i++)a[i]=arguments[i];st.startScope(e);try{var s=r.apply(void 0,a);return s instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),st.endScope(s),s}catch(u){throw st.endScope(null),u}};return Object.defineProperty(o,"name",{value:e,configurable:!0}),o}be.registerFlag("HAS_WEBGL",function(){return be.getNumber("WEBGL_VERSION")>0}),be.registerFlag("WEBGL_VERSION",function(){return vO(2)?2:vO(1)?1:0}),be.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return be.get("WEBGL_VERSION")===2}),be.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),be.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1}),be.registerFlag("WEBGL_PACK",function(){return be.getBool("HAS_WEBGL")}),be.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return be.getBool("WEBGL_PACK")}),be.registerFlag("WEBGL_PACK_CLIP",function(){return be.getBool("WEBGL_PACK")}),be.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),be.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return be.getBool("WEBGL_PACK")}),be.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return be.getBool("WEBGL_PACK")}),be.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return be.getBool("WEBGL_PACK")}),be.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return be.getBool("WEBGL_PACK")}),be.registerFlag("WEBGL_PACK_REDUCE",function(){return be.getBool("WEBGL_PACK")}),be.registerFlag("WEBGL_LAZILY_UNPACK",function(){return be.getBool("WEBGL_PACK")}),be.registerFlag("WEBGL_CONV_IM2COL",function(){return be.getBool("WEBGL_PACK")}),be.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return Wat(be.getNumber("WEBGL_VERSION"))}),be.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return Vat(be.getNumber("WEBGL_VERSION"))}),be.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var n=be.getNumber("WEBGL_VERSION");return n===0?0:Gat(n)}),be.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return be.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(n=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(n)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(n.substr(0,4))));var n}),be.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return Hat(be.getNumber("WEBGL_VERSION"))}),be.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return!be.getBool("WEBGL_FORCE_F16_TEXTURES")&&be.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")}),be.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return qat(be.getNumber("WEBGL_VERSION"))}),be.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return jat(be.getNumber("WEBGL_VERSION"))}),be.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return be.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),$L=ML;var Kr=nt({complex_:function(n,t){var e=j(n,"real","complex"),r=j(t,"imag","complex");return cn(e.shape,r.shape,"real and imag shapes, "+e.shape+" and "+r.shape+", must match in call to tf.complex()."),st.runKernelFunc(function(o){return o.complex(e,r)},{$real:e,$imag:r})}}),Pa=nt({real_:function(n){var t=j(n,"input","real");return st.runKernelFunc(function(e){return e.real(t)},{$input:t})}}),Vi=nt({imag_:function(n){var t=j(n,"input","imag");return st.runKernelFunc(function(e){return e.imag(t)},{$input:t})}});function Qr(n,t,e){return xl(n,t,vl(n,e),e)}function xl(n,t,e,r){if(r==null&&(r=Lm(n)),r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!Xi(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(t!=null){AL(t);var o=Yt(t),a=Yt(e);X(o===a,function(){return"Based on the provided shape, ["+t+"], the tensor should have "+o+" values but has "+a});for(var i=0;i<e.length;++i){var s=e[i],u=i!==e.length-1||s!==Yt(t.slice(i));X(e[i]===t[i]||!u,function(){return"Error creating a new Tensor. Inferred shape ("+e+") does not match the provided shape ("+t+"). "})}}return Xi(n)||Array.isArray(n)||(n=[n]),t=t||e,n=r!=="string"?TL(n,r,Nt().getBool("DEBUG")):Mf(n,[],!0),st.makeTensor(n,t,r)}function ae(n,t){if((Xi(n)&&t!=="string"||Array.isArray(n))&&t!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(t==="string"&&Xi(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return xl(n,[],[],t)}function vi(n,t){sd(n);var e=vl(n,t);if(e.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return xl(n,null,e,t)}function mc(n,t,e){if(sd(n),t!=null&&t.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var r=vl(n,e);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return xl(n,t,r,e)}function PL(n,t,e){if(sd(n),t!=null&&t.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var r=vl(n,e);if(r.length!==3&&r.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return xl(n,t,r,e)}function Pi(n,t,e){if(sd(n),t!=null&&t.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var r=vl(n,e);if(r.length!==4&&r.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return xl(n,t,r,e)}function Qat(n,t,e){if(sd(n),t!=null&&t.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var r=vl(n,e);if(r.length!==5&&r.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return xl(n,t,r,e)}function Zat(n,t,e){if(sd(n),t!=null&&t.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var r=vl(n,e);if(r.length!==6&&r.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return xl(n,t=t||r,r,e)}function Jat(n,t,e,r){return t===void 0&&(t=!0),st.makeVariable(n,t,e,r)}function ud(n,t){if(t===void 0&&(t="float32"),t==="complex64"){var e=ud(n,"float32"),r=Yn(n,"float32");return Kr(e,r)}var o=NL(Yt(n),t);return st.makeTensor(o,n,t)}function Yn(n,t){if(t===void 0&&(t="float32"),t==="complex64"){var e=Yn(n,"float32"),r=Yn(n,"float32");return Kr(e,r)}var o=Pm(Yt(n),t);return st.makeTensor(o,n,t)}function gc(n,t,e){return st.runKernelFunc(function(r){return r.fill(n,t,e)},{})}function tit(n,t,e){if(e<=0)throw new Error("The number of values should be positive.");return st.runKernelFunc(function(r){return r.linspace(n,t,e)},{})}function ey(n,t,e,r){if(e===void 0&&(e=1),r===void 0&&(r="float32"),e===0)throw new Error("Cannot have a step of zero");if(n===t||n<t&&e<0||t<n&&e>1)return Yn([0],r);var o=Pm(Math.abs(Math.ceil((t-n)/e)),r);t<n&&e===1&&(e=-1),o[0]=n;for(var a=1;a<o.length;a++)o[a]=o[a-1]+e;return vi(o,r)}var BL=nt({onesLike_:function(n){var t=j(n,"x","onesLike");if(t.dtype==="complex64"){var e=BL(Pa(t)),r=je(Vi(t));return Kr(e,r)}return st.runKernelFunc(function(o){return o.onesLike(t)},{x:t},function(o,a){return{x:function(){return je(o)}}},"OnesLike")}}),je=nt({zerosLike_:function(n){var t=j(n,"x","zerosLike");return st.runKernelFunc(function(e){return e.zerosLike(t)},{x:t},function(e,r){return{x:function(){return je(e)}}},"ZerosLike")}}),Ha=nt({concat_:function(n,t){t===void 0&&(t=0),X(n.length>=1,function(){return"Pass at least one tensor to concat"});var e=ty(n,"tensors","concat");e[0].dtype==="complex64"&&e.forEach(function(s){if(s.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `+s.dtype+". ")}),t=_r(t,e[0].shape)[0];var r=Bf(e.map(function(s){return s.shape}),t);if(Yt(r)===0)return Qr([],r);if((e=e.filter(function(s){return s.size>0})).length===1)return e[0];var o=e.map(function(s){return s.shape});Yat(o,t);var a=e,i={axis:t};return st.runKernelFunc(function(s){return s.concat(e,t)},a,function(s){var u=o.map(function(l){return l[t]});return $k(s,u,t).map(function(l){return function(){return l}})},"Concat",i)}}),eit=nt({concat1d_:function(n){return Ha(n,0)}}),nit=nt({concat2d_:function(n,t){return Ha(n,t)}}),rit=nt({concat3d_:function(n,t){return Ha(n,t)}}),oit=nt({concat4d_:function(n,t){return Ha(n,t)}}),$k=nt({split_:function(n,t,e){e===void 0&&(e=0);var r,o=j(n,"x","split");return e=_r(e,o.shape)[0],typeof t=="number"?(X(o.shape[e]%t==0,function(){return"Number of splits must evenly divide the axis."}),r=new Array(t).fill(o.shape[e]/t)):(X(o.shape[e]===t.reduce(function(a,i){return a+i}),function(){return"The sum of sizes must match the size of the axis dimension."}),r=t),st.runKernelFunc(function(a){return a.split(o,r,e)},{$x:o},function(a){return{$x:function(){return Ha(a,e)}}})}});function Ce(n,t,e){return t===void 0&&(t="float32"),t=t||"float32",AL(n),new nm(n,t,e)}function ait(n,t){t===void 0&&(t=!1),console.log(n.toString(t))}var zL=nt({batchToSpaceND_:function(n,t,e){var r=j(n,"x","batchToSpaceND"),o=t.reduce(function(a,i){return a*i});return X(r.rank>=1+t.length,function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+t.length}),X(e.length===t.length,function(){return"crops.length is "+e.length+" but should be equal to blockShape.length  "+t.length}),X(r.shape[0]%o==0,function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+t.join(" * ")+" === "+o}),st.runKernelFunc(function(a){return a.batchToSpaceND(r,t,e)},{$x:r},function(a){return{$x:function(){return a.spaceToBatchND(t,e)}}})}}),iit=nt({cast_:function(n,t){var e=j(n,"x","cast");if(!uat(t))throw new Error("Failed to cast to unknown dtype "+t);if(t==="string"&&e.dtype!=="string"||t!=="string"&&e.dtype==="string")throw new Error("Only strings can be casted to strings");var r={dtype:t};return st.runKernelFunc(function(o){return o.cast(e,t)},{x:e},function(o){return{x:function(){return o.clone()}}},"Cast",r)}}),sit=nt({cumsum_:function(n,t,e,r){t===void 0&&(t=0),e===void 0&&(e=!1),r===void 0&&(r=!1);var o=j(n,"x","cumsum"),a=gs([t|=0],o.rank),i=o;a!=null&&(i=o.transpose(a));var s=vs(1,o.rank)[0],u=st.runKernelFunc(function(l){return l.cumsum(i,s,e,r)},{permutedX:i},function(l){return{permutedX:function(){return l.cumsum(t,e,!r)}}});return a!=null&&(u=u.transpose(a)),u}}),uit=nt({depthToSpace_:function(n,t,e){e===void 0&&(e="NHWC");var r=j(n,"x","depthToSpace"),o=e==="NHWC"?r.shape[1]:r.shape[2],a=e==="NHWC"?r.shape[2]:r.shape[3],i=e==="NHWC"?r.shape[3]:r.shape[1];return X(o*t>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+o+" and "+t+`  for depthToSpace with input shape
      `+r.shape}),X(a*t>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+a+" and "+t+` for depthToSpace with input shape
          `+r.shape}),X(i%(t*t)==0,function(){return"Dimension size must be evenly divisible by "+t*t+" but is "+i+" for depthToSpace with input shape "+r.shape}),st.runKernelFunc(function(s){return s.depthToSpace(r,t,e)},{$x:r})}}),zu=nt({expandDims_:function(n,t){t===void 0&&(t=0);var e=j(n,"x","expandDims",null);X(t<=e.rank,function(){return"Axis must be <= rank of the tensor"});var r=e.shape.slice();return t<0&&(X(-(e.rank+1)<=t,function(){return"Axis must be in the interval ["+-(e.rank+1)+", "+e.rank+"]"}),t=e.rank+t+1),r.splice(t,0,1),Ls(e,r)}}),Ls=nt({reshape_:function(n,t){var e=j(n,"x","reshape",null);t=iat(t,e.size),X(e.size===Yt(t),function(){return"new shape and old shape must have the same number of elements."});var r={shape:t};return st.runKernelFunc(function(o){return o.reshape(e,t)},{x:e},function(o){return{x:function(){return o.reshape(e.shape)}}},"Reshape",r)}}),UL=nt({spaceToBatchND_:function(n,t,e){var r=j(n,"x","spaceToBatchND");return X(r.rank>=1+t.length,function(){return"input rank "+r.rank+" should be > than [blockShape] "+t.length}),X(e.length===t.length,function(){return"paddings.shape[0] "+e.length+" must be equal to [blockShape] "+t.length}),X(r.shape.reduce(function(o,a,i){return i>0&&i<=t.length?o&&(a+e[i-1][0]+e[i-1][1])%t[i-1]==0:o},!0),function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+e.toString()+" must be divisible by blockShapes "+t.toString()}),st.runKernelFunc(function(o){return o.spaceToBatchND(r,t,e)},{$x:r},function(o){return{$x:function(){return o.batchToSpaceND(t,e)}}})}}),WL=nt({squeeze_:function(n,t){var e=j(n,"x","squeeze");return Ls(e,rc(e.shape,t).newShape)}}),ol=nt({stack_:function(n,t){t===void 0&&(t=0);var e=ty(n,"tensors","stack");if(X(e.length>=1,function(){return"Pass at least one tensor to tf.stack"}),e.length===1)return e[0].expandDims(t);var r=e[0].rank,o=e[0].shape,a=e[0].dtype;X(t<=r,function(){return"Axis must be <= rank of the tensor"}),e.forEach(function(s){cn(o,s.shape,"All tensors passed to stack must have matching shapes")}),e.forEach(function(s){X(a===s.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var i=e.map(function(s){return s.expandDims(t)});return Ha(i,t)}}),Jy=nt({unstack_:function(n,t){t===void 0&&(t=0),t=t||0;var e=j(n,"x","unstack");X(t>=-e.shape.length&&t<e.shape.length,function(){return"Axis = "+t+" is not in [-"+e.shape.length+", "+e.shape.length+")"}),t<0&&(t+=e.shape.length);var r={axis:t};return st.runKernelFunc(function(o){return o.unstack(e,t)},{x:e},function(o){return{x:function(){return ol(o,t)}}},"Unpack",r)}}),lit=function(n,t){return Qt(this,void 0,void 0,function(){var e,r,o,a,i,s,u,l,c,h;return Zt(this,function(d){switch(d.label){case 0:return e=j(n,"x","setdiff1d"),r=j(t,"y","setdiff1d"),X(e.dtype===r.dtype,function(){return"x and y should have the same dtype, but got x ("+e.dtype+") and y ("+r.dtype+")."}),X(e.rank===1,function(){return"x should be 1D tensor, but got x ("+e.shape+")."}),X(r.rank===1,function(){return"y should be 1D tensor, but got y ("+r.shape+")."}),[4,e.data()];case 1:return o=d.sent(),[4,r.data()];case 2:for(a=d.sent(),i=new Set(a),s=0,c=0;c<o.length;c++)i.has(o[c])||s++;for(u=new nm([s],e.dtype),l=new nm([s],"int32"),c=0,h=0;c<o.length;c++)i.has(o[c])||(u.values[h]=o[c],l.values[h]=c,h++);return[2,[u.toTensor(),l.toTensor()]]}})})};function ny(n,t,e,r){r===void 0&&(r=!0);var o=[];if(r)(o=o.concat(t.slice(0))).push(n[0]/e),o=o.concat(n.slice(1));else{o=o.concat(n[0]);for(var a=t.length,i=0;i<a;++i)o=o.concat([n[i+1]/t[i],t[i]]);o=o.concat(n.slice(a+1))}return o}function ry(n,t,e){e===void 0&&(e=!0);var r=[];if(e){r.push(t);for(var o=t+1;o<n;++o)o<=2*t?(r.push(o),r.push(o-(t+1))):r.push(o)}else{var a=[],i=[];for(o=1;o<n;++o)o>=2*t+1||o%2==1?i.push(o):a.push(o);r.push.apply(r,a),r.push(0),r.push.apply(r,i)}return r}function oy(n,t,e,r){r===void 0&&(r=!0);var o=[];r?o.push(n[0]/e):o.push(n[0]*e);for(var a=1;a<n.length;++a)a<=t.length?r?o.push(t[a-1]*n[a]):o.push(n[a]/t[a-1]):o.push(n[a]);return o}function VL(n,t){for(var e=[0],r=0;r<t;++r)e.push(n[r][0]);return e}function GL(n,t,e){for(var r=n.slice(0,1),o=0;o<e;++o)r.push(n[o+1]-t[o][0]-t[o][1]);return r}var HL="Add",t1="Div",e1="SquaredDifference",qL="BroadcastTo",jL="OneHot",XL="Identity",KL="Tile",YL="PadV2",qa=nt({add_:function(n,t){var e,r=j(n,"a","add"),o=j(t,"b","add");e=Vn(r,o),r=e[0],o=e[1];var a={a:r,b:o};return st.runKernelFunc(function(i,s){var u=i.add(r,o);return s([r,o]),u},a,null,HL)}});function Hu(n,t){for(var e=n.length,r=[],o=0;o<e;o++){var a=e-1-o,i=n[a]||1;(t[t.length-1-o]||1)>1&&i===1&&r.unshift(a)}return r}function Ir(n,t){for(var e=[],r=0;r<t.length;r++){var o=n[n.length-r-1],a=t.length-r-1,i=t[a];(o==null||o===1&&i>1)&&e.unshift(a)}return e}function Pe(n,t){for(var e=[],r=Math.max(n.length,t.length),o=0;o<r;o++){var a=n[n.length-o-1];a==null&&(a=1);var i=t[t.length-o-1];if(i==null&&(i=1),a===1)e.unshift(i);else if(i===1)e.unshift(a);else{if(a!==i)throw Error("Operands could not be broadcast together with shapes "+n+" and "+t+".");e.unshift(a)}}return e}var cit=nt({abs_:function(n){var t=j(n,"x","abs");return t.dtype==="complex64"?st.runKernelFunc(function(e){return e.complexAbs(t)},{$x:t}):st.runKernelFunc(function(e,r){var o=e.abs(t);return r([t]),o},{x:t},function(e,r){var o=r[0];return{x:function(){return e.mul(o.toFloat().step(-1))}}},"Abs")}}),hit=nt({acos_:function(n){var t=j(n,"x","acos");return st.runKernelFunc(function(e,r){var o=e.acos(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return e.divStrict(ae(1).sub(o.toFloat().square()).sqrt()).neg()}}})}}),fit=nt({acosh_:function(n){var t=j(n,"x","acosh");return st.runKernelFunc(function(e,r){var o=e.acosh(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return e.divStrict(o.toFloat().square().sub(1).sqrt())}}})}}),dit=nt({asin_:function(n){var t=j(n,"x","asin");return st.runKernelFunc(function(e,r){var o=e.asin(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return e.divStrict(ae(1).sub(o.toFloat().square()).sqrt())}}})}}),pit=nt({asinh_:function(n){var t=j(n,"x","asinh");return st.runKernelFunc(function(e,r){var o=e.asinh(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return e.divStrict(ae(1).add(o.toFloat().square()).sqrt())}}})}}),mit=nt({atan_:function(n){var t=j(n,"x","atan");return st.runKernelFunc(function(e,r){var o=e.atan(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return e.div(o.toFloat().square().add(1))}}})}}),git=nt({atanh_:function(n){var t=j(n,"x","atanh");return st.runKernelFunc(function(e,r){var o=e.atanh(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return e.div(ae(1).sub(o.toFloat().square()))}}})}}),vit=nt({ceil_:function(n){var t=j(n,"x","ceil");return st.runKernelFunc(function(e){return e.ceil(t)},{$x:t},function(e){return{$x:function(){return je(e)}}})}}),xit=nt({clipByValue_:function(n,t,e){var r=j(n,"x","clipByValue");X(t<=e,function(){return"Error in clip: min ("+t+") must be less than or equal to max ("+e+")."});var o=[r],a={min:t,max:e};return st.runKernelFunc(function(i,s){var u=i.clip(r,t,e);return s([r]),u},{x:r},function(i,s){var u=s[0];return{x:function(){return i.where(u.greaterEqual(t).logicalAnd(u.lessEqual(e)),je(i))}}},"ClipByValue",a,o)}}),yit=nt({cos_:function(n){var t=j(n,"x","cos"),e=[t];return st.runKernelFunc(function(r,o){var a=r.cos(t);return o([t]),a},{x:t},function(r,o){var a=o[0];return{x:function(){return a.toFloat().sin().neg().mul(r)}}},"Cos",{},e)}}),bit=nt({cosh_:function(n){var t=j(n,"x","cosh");return st.runKernelFunc(function(e,r){var o=e.cosh(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return o.toFloat().sinh().mulStrict(e)}}})}}),wit=nt({erf_:function(n){var t=j(n,"x","erf");return X(t.dtype==="int32"||t.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),t.dtype==="int32"&&(t=t.toFloat()),st.runKernelFunc(function(e,r){var o=e.erf(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return e.mul(o.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),Cit=nt({exp_:function(n){var t=j(n,"x","exp");return st.runKernelFunc(function(e,r){var o=e.exp(t);return r([o]),o},{x:t},function(e,r){return{x:function(){return e.mulStrict(r[0])}}},"Exp",{},[],[!0])}}),Sit=nt({expm1_:function(n){var t=j(n,"x","expm1");return st.runKernelFunc(function(e,r){var o=e.expm1(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return e.mul(o.exp())}}})}}),Eit=nt({floor_:function(n){var t=j(n,"x","floor");return st.runKernelFunc(function(e){return e.floor(t)},{$x:t},function(e){return{$x:function(){return je(e)}}})}}),kit=nt({log_:function(n){var t=j(n,"x","log"),e=[t];return st.runKernelFunc(function(r,o){var a=r.log(t);return o([t]),a},{x:t},function(r,o){var a=o[0];return{x:function(){return r.div(a.toFloat())}}},"Log",{},e)}}),Iit=nt({log1p_:function(n){var t=j(n,"x","log1p");return st.runKernelFunc(function(e,r){var o=e.log1p(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return e.div(o.add(1))}}})}}),Rit=nt({logSigmoid_:function(n){var t=j(n,"x","logSigmoid");return st.runKernelFunc(function(e,r){var o=e.softplus(t.neg()).neg();return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return e.mul(o.neg().sigmoid())}}})}}),Ok=nt({neg_:function(n){var t=j(n,"x","neg"),e=[t];return st.runKernelFunc(function(r){return r.neg(t)},{x:t},function(r){return{x:function(){return r.neg()}}},"Neg",{},e)}}),Tit=nt({reciprocal_:function(n){var t=j(n,"x","reciprocal");return st.runKernelFunc(function(e,r){var o=e.reciprocal(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return e.div(o.square().neg())}}})}}),Nit=nt({round_:function(n){var t=j(n,"x","round");return st.runKernelFunc(function(e){return e.round(t)},{$x:t},function(e){return{$x:function(){return je(e)}}})}}),QL=nt({rsqrt_:function(n){var t=j(n,"x","rsqrt"),e=[t];return st.runKernelFunc(function(r,o){var a=r.rsqrt(t);return o([t]),a},{x:t},function(r,o){var a=o[0];return{x:function(){return r.div(a.pow(1.5).mul(2)).neg()}}},"Rsqrt",{},e)}}),Ait=nt({sigmoid_:function(n){var t=j(n,"x","sigmoid");return st.runKernelFunc(function(e,r){var o=e.sigmoid(t);return r([o]),o},{x:t},function(e,r){var o=r[0];return{x:function(){return e.mul(o.mul(ae(1).sub(o)))}}},"Sigmoid")}}),_it=nt({sign_:function(n){var t=j(n,"x","sign");return st.runKernelFunc(function(e){return e.sign(t)},{$x:t},function(e){return{$x:function(){return je(e)}}})}}),Dit=nt({isNaN_:function(n){var t=j(n,"x","isNaN");return st.runKernelFunc(function(e){return e.isNaN(t)},{$x:t},function(e){return{$x:function(){return je(e)}}})}}),$it=nt({isInf_:function(n){var t=j(n,"x","isInf");return st.runKernelFunc(function(e){return e.isInf(t)},{$x:t},function(e){return{$x:function(){return je(e)}}})}}),Oit=nt({isFinite_:function(n){var t=j(n,"x","isFinite");return st.runKernelFunc(function(e){return e.isFinite(t)},{$x:t},function(e){return{$x:function(){return je(e)}}})}}),Fit=nt({sin_:function(n){var t=j(n,"x","sin"),e=[t];return st.runKernelFunc(function(r,o){var a=r.sin(t);return o([t]),a},{x:t},function(r,o){var a=o[0];return{x:function(){return a.toFloat().cos().mul(r)}}},"Sin",{},e)}}),Mit=nt({sinh_:function(n){var t=j(n,"x","sinh");return st.runKernelFunc(function(e,r){var o=e.sinh(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return o.toFloat().cosh().mulStrict(e)}}})}}),Lit=nt({softplus_:function(n){var t=j(n,"x","softplus");return st.runKernelFunc(function(e,r){var o=e.softplus(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return e.mul(o.sigmoid())}}})}}),Pit=nt({sqrt_:function(n){var t=j(n,"x","sqrt");return st.runKernelFunc(function(e,r){var o=e.sqrt(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return e.div(o.toFloat().sqrt().mul(2))}}})}}),Bit=nt({step_:function(n,t){t===void 0&&(t=0);var e=j(n,"x","step");return st.runKernelFunc(function(r){return r.step(e,t)},{$x:e},function(r){return{$x:function(){return je(r)}}})}}),zit=nt({tan_:function(n){var t=j(n,"x","tan");return st.runKernelFunc(function(e,r){var o=e.tan(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return e.div(o.cos().square())}}})}}),Uit=nt({tanh_:function(n){var t=j(n,"x","tanh");return st.runKernelFunc(function(e,r){var o=e.tanh(t);return r([o]),o},{x:t},function(e,r){var o=r[0];return{x:function(){return ae(1).sub(o.square()).mulStrict(e)}}},"Tanh",{},null,[!0])}}),Wit=nt({addStrict_:function(n,t){var e=j(n,"a","addStrict"),r=j(t,"b","addStrict");return cn(e.shape,r.shape,"Error in addStrict: "),e.add(r)}}),Vit=nt({atan2_:function(n,t){var e,r=j(n,"a","atan2"),o=j(t,"b","atan2");e=Vn(r,o),r=e[0],o=e[1];var a=Pe(r.shape,o.shape);return st.runKernelFunc(function(i,s){var u=i.atan2(r,o);return s([r,o]),u},{$a:r,$b:o},function(i,s){var u=s[0],l=s[1];return{$a:function(){var c=qa(u.square(),l.square()),h=i.mul(l.div(c)),d=Ir(u.shape,a);return d.length>0&&(h=h.sum(d)),h.reshape(u.shape)},$b:function(){var c=qa(u.square(),l.square()),h=Ok(i.mul(u.div(c))),d=Ir(l.shape,a);return d.length>0&&(h=h.sum(d)),h.reshape(l.shape)}}})}}),Git=nt({divStrict_:function(n,t){var e=j(n,"a","div"),r=j(t,"b","div");return cn(e.shape,r.shape,"Error in divideStrict: "),e.div(r)}}),ZL=nt({floorDiv_:function(n,t){var e,r=j(n,"a","floorDiv"),o=j(t,"b","floorDiv");e=Vn(r,o),r=e[0],o=e[1];var a=Pe(r.shape,o.shape);return st.runKernelFunc(function(i,s){var u=i.floorDiv(r,o);return s([r,o]),u},{a:r,b:o},function(i,s){var u=s[0],l=s[1];return{a:function(){var c=i.div(l.toFloat()),h=Ir(u.shape,a);return h.length>0?c.sum(h).reshape(u.shape):c},b:function(){var c=i.mul(u.toFloat()),h=Ir(l.shape,a);h.length>0&&(c=c.sum(h).reshape(l.shape));var d=l.square();return c.div(d.toFloat()).neg()}}},"FloorDiv")}}),Fk=nt({maximum_:function(n,t){var e,r=j(n,"a","maximum"),o=j(t,"b","maximum");return e=Vn(r,o),r=e[0],o=e[1],r.dtype==="bool"&&(r=r.toInt(),o=o.toInt()),Pe(r.shape,o.shape),st.runKernelFunc(function(a,i){var s=a.maximum(r,o);return i([r,o]),s},{a:r,b:o},function(a,i){var s=i[0],u=i[1];return{a:function(){return a.mul(s.greaterEqual(u).toFloat())},b:function(){return a.mul(s.less(u).toFloat())}}},"Maximum")}}),Hit=nt({maximumStrict_:function(n,t){var e=j(n,"a","maximumStrict"),r=j(t,"b","maximumStrict");return cn(e.shape,r.shape,"Error in maximumStrict: "),e.maximum(r)}}),JL=nt({minimum_:function(n,t){var e,r=j(n,"a","minimum"),o=j(t,"b","minimum");return e=Vn(r,o),r=e[0],o=e[1],r.dtype==="bool"&&(r=r.toInt(),o=o.toInt()),Pe(r.shape,o.shape),st.runKernelFunc(function(a,i){var s=a.minimum(r,o);return i([r,o]),s},{a:r,b:o},function(a,i){var s=i[0],u=i[1];return{a:function(){return a.mul(s.lessEqual(u).toFloat())},b:function(){return a.mul(s.greater(u).toFloat())}}},"Minimum")}}),qit=nt({minimumStrict_:function(n,t){var e=j(n,"a","minimumStrict"),r=j(t,"b","minimumStrict");return cn(e.shape,r.shape,"Error in minimumStrict: "),e.minimum(r)}}),jit=nt({mod_:function(n,t){var e,r=j(n,"a","mod"),o=j(t,"b","mod");e=Vn(r,o),r=e[0],o=e[1];var a=Pe(r.shape,o.shape);return st.runKernelFunc(function(i,s){var u=i.mod(r,o);return s([r,o]),u},{$a:r,$b:o},function(i,s){var u=s[0],l=s[1];return{$a:function(){var c=Ir(u.shape,a);return c.length>0?i.sum(c).reshape(u.shape):i},$b:function(){var c=i.mul(u.div(l).floor().neg()),h=Ir(l.shape,a);return h.length>0?c.sum(h).reshape(l.shape):c}}})}}),Xit=nt({modStrict_:function(n,t){var e=j(n,"a","modStrict"),r=j(t,"b","modStrict");return cn(e.shape,r.shape,"Error in modStrict: "),e.mod(r)}}),Kn=nt({mul_:function(n,t){var e,r=j(n,"a","mul"),o=j(t,"b","mul");e=Vn(r,o),r=e[0],o=e[1];var a=Pe(r.shape,o.shape);return st.runKernelFunc(function(i,s){var u=i.multiply(r,o);return s([r,o]),u},{a:r,b:o},function(i,s){var u=s[0],l=s[1];return{a:function(){var c=i.mul(l.toFloat()),h=Ir(u.shape,a);return h.length>0?c.sum(h).reshape(u.shape):c},b:function(){var c=i.mul(u.toFloat()),h=Ir(l.shape,a);return h.length>0?c.sum(h).reshape(l.shape):c}}},"Mul")}}),Kit=nt({mulStrict_:function(n,t){var e=j(n,"a","mul"),r=j(t,"b","mul");return cn(e.shape,r.shape,"Error in multiplyStrict: "),e.mul(r)}}),ay=nt({pow_:function(n,t){var e,r=j(n,"base","pow"),o=j(t,"exp","pow");e=Vn(r,o),r=e[0],o=e[1];var a=Pe(r.shape,o.shape),i=[r,o];return st.runKernelFunc(function(s,u){var l=s.pow(r,o);return u([r,o,l]),l},{a:r,b:o},function(s,u){var l=u[0],c=u[1],h=u[2];return{a:function(){var d=c.toFloat(),p=s.mul(d.mul(l.pow(d.sub(ae(1))))),g=Ir(l.shape,a);return g.length>0&&(p=p.sum(g)),p.reshape(l.shape)},b:function(){var d=l.greater(0),p=l.log().where(d,je(l)),g=s.mul(h.mul(p)),x=Ir(c.shape,a);return x.length>0&&(g=g.sum(x)),g.reshape(c.shape)}}},"Pow",{},i,[!0])}}),Yit=nt({powStrict_:function(n,t){return cn(n.shape,t.shape,"Error in powStrict: "),n.pow(t)}}),Qit=nt({squaredDifferenceStrict_:function(n,t){var e=j(n,"a","squaredDifferenceStrict"),r=j(t,"b","squaredDifferenceStrict");return cn(e.shape,r.shape,"Error in squaredDifferenceStrict: "),e.squaredDifference(r)}}),fi=nt({sub_:function(n,t){var e,r=j(n,"a","sub"),o=j(t,"b","sub");e=Vn(r,o),r=e[0],o=e[1];var a=Pe(r.shape,o.shape);return st.runKernelFunc(function(i){return i.subtract(r,o)},{a:r,b:o},function(i){return{a:function(){var s=i,u=Ir(r.shape,a);return u.length>0&&(s=s.sum(u)),s.reshape(r.shape)},b:function(){var s=i,u=Ir(o.shape,a);return u.length>0&&(s=s.sum(u)),s.neg().reshape(o.shape)}}},"Sub")}}),Zit=nt({subStrict_:function(n,t){var e=j(n,"a","subStrict"),r=j(t,"b","subStrict");return cn(e.shape,r.shape,"Error in subStrict: "),e.sub(r)}}),al=nt({div_:function(n,t){var e,r=j(n,"a","div"),o=j(t,"b","div");if(e=Vn(r,o),r=e[0],o=e[1],r.dtype==="int32"&&o.dtype==="int32")return ZL(r,o);var a={a:r,b:o};return st.runKernelFunc(function(i,s){var u=i.realDivide(r,o);return s([r,o]),u},a,null,t1,{})}});function tP(n,t){if(n.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+n.rank+".");if(t.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if(t.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+t.dtype+".");if(t.shape[t.rank-1]>n.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+t.shape[t.rank-1]+" vs. "+n.rank);if(n.size===0)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+n.shape+".");for(var e=t.shape,r=e[e.length-1],o=1,a=0;a<e.length-1;++a)o*=e[a];var i=n.shape,s=e.slice();s.pop();var u=1;for(a=r;a<n.rank;++a)u*=i[a],s.push(i[a]);var l=ya(n.shape).map(function(c){return c/u}).concat([1]).slice(0,r);return[s,o,u,l]}var eP=30;function zC(n){return n<=eP?n:tE(n,Math.floor(Math.sqrt(n)))}function Jit(n,t,e){var r=t.rank>1?t.shape[t.rank-1]:1,o=t.rank>1?t.rank-1:1,a="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+e.shape+", indices.shape: "+t.shape+", shape: "+n+", sliceDim: "+r+", and batchDim: "+o+".";if(e.rank<o)throw new Error(a+" update.rank < "+o+". ");if(n.length<r+(e.rank-o))throw new Error(a+" Output shape length < "+(r+(e.rank-o)));if(e.rank!==o+n.length-r)throw new Error(a+" update.rank != "+(o+n.length-r));for(var i=0;i<o;++i)if(e.shape[i]!==t.shape[i])throw new Error(a+" updates.shape["+i+"] ("+e.shape[i]+") != indices.shape["+i+"] ("+t.shape[i]+").");for(i=0;i<e.rank-o;++i)if(e.shape[i+o]!==n[i+r])throw new Error(a+" updates.shape["+(i+o)+"] ("+e.shape[i+o]+") != shape["+(i+o)+"] ("+n[i+o]+")")}function tst(n,t,e){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if(n.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+n.rank+".");if(t.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+t.dtype);if(e.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+e);if(e.length===0){if(t.size===0)throw new Error("Indices specified for empty output. indices shape: "+t.shape);if(n.size===0)throw new Error("Updates specified for empty output. updates shape: "+n.shape)}Jit(e,t,n)}function iy(n,t,e){for(var r=t.shape.length,o=r>1?t.shape[r-1]:1,a=e.length,i=1,s=o;s<a;++s)i*=e[s];var u=o<1?1:o;return{sliceRank:o,numUpdates:Yt(t.shape)/u,sliceSize:i,strides:ya(e.slice(0,o)).concat([1]),outputSize:Yt(e)}}function est(n,t,e){X(n.rank===t.length,function(){return"Error in slice"+n.rank+"D: Length of begin "+t+" must match the rank of the array ("+n.rank+")."}),X(n.rank===e.length,function(){return"Error in slice"+n.rank+"D: Length of size "+e+" must match the rank of the array ("+n.rank+")."});for(var r=function(a){X(t[a]+e[a]<=n.shape[a],function(){return"Error in slice"+n.rank+"D: begin["+a+"] + size["+a+"] ("+(t[a]+e[a])+") would overflow input.shape["+a+"] ("+n.shape[a]+")"})},o=0;o<n.rank;++o)r(o)}function yO(n){for(var t=[],e=0;n>0;)1&n&&t.push(e),n/=2,e++;return t}function Mk(n,t,e){for(var r=[],o=0;o<n.length;o++)r[o]=Math.ceil((t[o]-n[o])/e[o]);return r}function nst(n,t,e,r,o){var a=t[o],i=e[o]||1;(n&1<<o||a==null)&&(a=i>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var s=r[o];return a<0&&(a+=s),a=QS(0,a,s-1)}function rst(n,t,e,r,o){var a=t[o],i=e[o]||1;(n&1<<o||a==null)&&(a=i>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var s=r[o];return a<0&&(a+=s),a=i>0?QS(0,a,s):QS(-1,a,s-1)}function nP(n,t,e){for(var r=e.length,o=0;o<e.length;o++)if(e[o]>1){r=o;break}for(o=r+1;o<e.length;o++)if(t[o]>0||e[o]!==n[o])return!1;return!0}function rP(n,t){for(var e=n.length>0?n[n.length-1]:1,r=0;r<n.length-1;r++)e+=n[r]*t[r];return e}function ost(n,t){X(JS(n),function(){return"The f passed in variableGrads(f) must be a function"}),X(t==null||Array.isArray(t)&&t.every(function(c){return c instanceof Pf}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var e=t!=null;if(!e)for(var r in t=[],st.registeredVariables)t.push(st.registeredVariables[r]);var o=e?t.filter(function(c){return!c.trainable}):null,a=t.length;X((t=t.filter(function(c){return c.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+a+" variables is trainable."});var i=st.gradients(n,t,null,!0),s=i.value,u=i.grads;X(u.some(function(c){return c!=null}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),X(s.rank===0,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+s.rank+" tensor"});var l={};return t.forEach(function(c,h){u[h]!=null&&(l[c.name]=u[h])}),o?.forEach(function(c){return l[c.name]=null}),{value:s,grads:l}}function n1(n){return st.customGrad(n)}var r1=nt({softmax_:function(n,t){t===void 0&&(t=-1);var e=j(n,"logits","softmax","float32");if(t===-1&&(t=e.rank-1),t!==e.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+e.rank+" and dim was "+t);return st.runKernelFunc(function(r,o){var a=r.softmax(e,t);return o([a]),a},{logits:e},function(r,o){var a=o[0],i=r.mul(a);return{logits:function(){return i.sub(i.sum([t],!0).mul(a))}}},"Softmax",{dim:t},[],[!0])}}),ast=nt({logSoftmax_:function(n,t){t===void 0&&(t=-1);var e=j(n,"logits","logSoftmax");if(t===-1&&(t=e.rank-1),t!==e.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+e.rank+" and axis was "+t);return n1(function(r,o){var a=r.max(t,!0),i=r.sub(a),s=i.toFloat().sub(i.exp().sum(t,!0).log());return o([s]),{value:s,gradFunc:function(u,l){var c=l[0].exp();return u.sub(u.sum(t,!0).mul(c))}}})(e)}}),ai=nt({transpose_:function(n,t){var e=j(n,"x","transpose");if(t==null&&(t=e.shape.map(function(o,a){return a}).reverse()),X(e.rank===t.length,function(){return"Error in transpose: rank of input "+e.rank+" must match length of perm "+t+"."}),t.forEach(function(o){X(o>=0&&o<e.rank,function(){return"All entries in 'perm' must be between 0 and "+(e.rank-1)+" but got "+t})}),e.rank<=1)return e.clone();var r={perm:t};return st.runKernelFunc(function(o){return o.transpose(e,t)},{x:e},null,"Transpose",r)}}),oP=function(){function n(t,e){this.backend=t,this.dataMover=e,this.data=new WeakMap,this.dataIdsCount=0}return n.prototype.get=function(t){return this.data.has(t)||this.dataMover.moveData(this.backend,t),this.data.get(t)},n.prototype.set=function(t,e){this.dataIdsCount++,this.data.set(t,e)},n.prototype.has=function(t){return this.data.has(t)},n.prototype.delete=function(t){return this.dataIdsCount--,this.data.delete(t)},n.prototype.numDataIds=function(){return this.dataIdsCount},n}(),aP=function(){function n(){}return n.prototype.time=function(t){return wt("time")},n.prototype.read=function(t){return wt("read")},n.prototype.readSync=function(t){return wt("readSync")},n.prototype.numDataIds=function(){return wt("numDataIds")},n.prototype.disposeData=function(t){return wt("disposeData")},n.prototype.write=function(t,e,r){return wt("write")},n.prototype.move=function(t,e,r,o){return wt("move")},n.prototype.memory=function(){return wt("memory")},n.prototype.floatPrecision=function(){return wt("floatPrecision")},n.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},n.prototype.batchMatMul=function(t,e,r,o){return wt("batchMatMul")},n.prototype.fusedBatchMatMul=function(t){return t.a,t.b,t.transposeA,t.transposeB,t.bias,t.activation,t.preluActivationWeights,wt("fusedBatchMatMul")},n.prototype.slice=function(t,e,r){return wt("slice")},n.prototype.stridedSlice=function(t,e,r,o){return wt("stridedSlice")},n.prototype.unstack=function(t,e){return wt("unstack")},n.prototype.reverse=function(t,e){return wt("reverse")},n.prototype.concat=function(t,e){return wt("concat")},n.prototype.neg=function(t){return wt("neg")},n.prototype.add=function(t,e){return wt("add")},n.prototype.addN=function(t){return wt("addN")},n.prototype.subtract=function(t,e){return wt("subtract")},n.prototype.multiply=function(t,e){return wt("multiply")},n.prototype.realDivide=function(t,e){return wt("realDivide")},n.prototype.floorDiv=function(t,e){return wt("floorDiv")},n.prototype.sum=function(t,e){return wt("sum")},n.prototype.prod=function(t,e){return wt("prod")},n.prototype.unsortedSegmentSum=function(t,e,r){return wt("unsortedSegmentSum")},n.prototype.argMin=function(t,e){return wt("argMin")},n.prototype.argMax=function(t,e){return wt("argMax")},n.prototype.equal=function(t,e){return wt("equal")},n.prototype.notEqual=function(t,e){return wt("notEqual")},n.prototype.less=function(t,e){return wt("less")},n.prototype.lessEqual=function(t,e){return wt("lessEqual")},n.prototype.greater=function(t,e){return wt("greater")},n.prototype.greaterEqual=function(t,e){return wt("greaterEqual")},n.prototype.logicalNot=function(t){return wt("logicalNot")},n.prototype.logicalAnd=function(t,e){return wt("logicalAnd")},n.prototype.logicalOr=function(t,e){return wt("logicalOr")},n.prototype.where=function(t){return wt("where")},n.prototype.select=function(t,e,r){return wt("select")},n.prototype.topk=function(t,e,r){return wt("topk")},n.prototype.min=function(t,e){return wt("min")},n.prototype.minimum=function(t,e){return wt("minimum")},n.prototype.mod=function(t,e){return wt("mod")},n.prototype.max=function(t,e){return wt("max")},n.prototype.maximum=function(t,e){return wt("maximum")},n.prototype.all=function(t,e){return wt("all")},n.prototype.any=function(t,e){return wt("any")},n.prototype.squaredDifference=function(t,e){return wt("squaredDifference")},n.prototype.ceil=function(t){return wt("ceil")},n.prototype.floor=function(t){return wt("floor")},n.prototype.round=function(t){return wt("round")},n.prototype.sign=function(t){return wt("sign")},n.prototype.isNaN=function(t){return wt("isNaN")},n.prototype.isInf=function(t){return wt("isInf")},n.prototype.isFinite=function(t){return wt("isFinite")},n.prototype.pow=function(t,e){return wt("pow")},n.prototype.exp=function(t){return wt("exp")},n.prototype.expm1=function(t){return wt("expm1")},n.prototype.softmax=function(t,e){return wt("softmax")},n.prototype.log=function(t){return wt("log")},n.prototype.log1p=function(t){return wt("log1p")},n.prototype.sqrt=function(t){return wt("sqrt")},n.prototype.rsqrt=function(t){return wt("rsqrt")},n.prototype.square=function(t){return wt("square")},n.prototype.reciprocal=function(t){return wt("reciprocal")},n.prototype.relu=function(t){return wt("relu")},n.prototype.relu6=function(t){return wt("relu6")},n.prototype.prelu=function(t,e){return wt("prelu")},n.prototype.elu=function(t){return wt("elu")},n.prototype.eluDer=function(t,e){return wt("eluDer")},n.prototype.selu=function(t){return wt("selu")},n.prototype.int=function(t){return wt("int")},n.prototype.clip=function(t,e,r){return wt("clip")},n.prototype.abs=function(t){return wt("abs")},n.prototype.complexAbs=function(t){return wt("complexAbs")},n.prototype.sigmoid=function(t){return wt("sigmoid")},n.prototype.softplus=function(t){return wt("softplus")},n.prototype.sin=function(t){return wt("sin")},n.prototype.cos=function(t){return wt("cos")},n.prototype.tan=function(t){return wt("tan")},n.prototype.asin=function(t){return wt("asin")},n.prototype.acos=function(t){return wt("acos")},n.prototype.atan=function(t){return wt("atan")},n.prototype.atan2=function(t,e){return wt("atan2")},n.prototype.sinh=function(t){return wt("sinh")},n.prototype.cosh=function(t){return wt("cosh")},n.prototype.tanh=function(t){return wt("tanh")},n.prototype.asinh=function(t){return wt("asinh")},n.prototype.acosh=function(t){return wt("acosh")},n.prototype.atanh=function(t){return wt("atanh")},n.prototype.erf=function(t){return wt("erf")},n.prototype.step=function(t,e){return wt("step")},n.prototype.fusedConv2d=function(t){return t.input,t.filter,t.convInfo,t.bias,t.activation,t.preluActivationWeights,wt("fusedConv2d")},n.prototype.conv2d=function(t,e,r){return wt("conv2d")},n.prototype.conv2dDerInput=function(t,e,r){return wt("conv2dDerInput")},n.prototype.conv2dDerFilter=function(t,e,r){return wt("conv2dDerFilter")},n.prototype.fusedDepthwiseConv2D=function(t){return t.input,t.filter,t.convInfo,t.bias,t.activation,t.preluActivationWeights,wt("fusedDepthwiseConv2D")},n.prototype.depthwiseConv2D=function(t,e,r){return wt("depthwiseConv2D")},n.prototype.depthwiseConv2DDerInput=function(t,e,r){return wt("depthwiseConv2DDerInput")},n.prototype.depthwiseConv2DDerFilter=function(t,e,r){return wt("depthwiseConv2DDerFilter")},n.prototype.conv3d=function(t,e,r){return wt("conv3d")},n.prototype.conv3dDerInput=function(t,e,r){return wt("conv3dDerInput")},n.prototype.conv3dDerFilter=function(t,e,r){return wt("conv3dDerFilter")},n.prototype.maxPool=function(t,e){return wt("maxPool")},n.prototype.maxPoolBackprop=function(t,e,r,o){return wt("maxPoolBackprop")},n.prototype.avgPool=function(t,e){return wt("avgPool")},n.prototype.avgPoolBackprop=function(t,e,r){return wt("avgPoolBackprop")},n.prototype.avgPool3d=function(t,e){return wt("avgPool3d")},n.prototype.avgPool3dBackprop=function(t,e,r){return wt("avgPool3dBackprop")},n.prototype.maxPool3d=function(t,e){return wt("maxPool3d")},n.prototype.maxPool3dBackprop=function(t,e,r,o){return wt("maxPool3dBackprop")},n.prototype.reshape=function(t,e){return wt("reshape")},n.prototype.cast=function(t,e){return wt("cast")},n.prototype.tile=function(t,e){return wt("tile")},n.prototype.pad=function(t,e,r){return wt("pad")},n.prototype.transpose=function(t,e){return wt("transpose")},n.prototype.gather=function(t,e,r){return wt("gather")},n.prototype.gatherND=function(t,e){return wt("gatherND")},n.prototype.scatterND=function(t,e,r){return wt("scatterND")},n.prototype.batchToSpaceND=function(t,e,r){return wt("batchToSpaceND")},n.prototype.spaceToBatchND=function(t,e,r){return wt("spaceToBatchND")},n.prototype.resizeBilinear=function(t,e,r,o){return wt("resizeBilinear")},n.prototype.resizeBilinearBackprop=function(t,e,r){return wt("resizeBilinearBackprop")},n.prototype.resizeNearestNeighbor=function(t,e,r,o){return wt("resizeNearestNeighbor")},n.prototype.resizeNearestNeighborBackprop=function(t,e,r){return wt("resizeNearestNeighborBackprop")},n.prototype.batchNormalization=function(t,e,r,o,a,i){return wt("batchNormalization")},n.prototype.localResponseNormalization4D=function(t,e,r,o,a){return wt("localResponseNormalization4D")},n.prototype.LRNGrad=function(t,e,r,o,a,i,s){return wt("LRNGrad")},n.prototype.multinomial=function(t,e,r,o){return wt("multinomial")},n.prototype.oneHot=function(t,e,r,o){return wt("oneHot")},n.prototype.cumsum=function(t,e,r,o){return wt("cumsum")},n.prototype.nonMaxSuppression=function(t,e,r,o,a){return wt("nonMaxSuppression")},n.prototype.fft=function(t){return wt("fft")},n.prototype.ifft=function(t){return wt("ifft")},n.prototype.complex=function(t,e){return wt("complex")},n.prototype.real=function(t){return wt("real")},n.prototype.imag=function(t){return wt("imag")},n.prototype.cropAndResize=function(t,e,r,o,a,i){return wt("cropAndResize")},n.prototype.depthToSpace=function(t,e,r){return wt("depthToSpace")},n.prototype.split=function(t,e,r){return wt("split")},n.prototype.sparseToDense=function(t,e,r,o){return wt("sparseToDense")},n.prototype.diag=function(t){return wt("diag")},n.prototype.fill=function(t,e,r){return wt("fill")},n.prototype.onesLike=function(t){return wt("onesLike")},n.prototype.zerosLike=function(t){return wt("zerosLike")},n.prototype.linspace=function(t,e,r){return wt("linspace")},n.prototype.dispose=function(){return wt("dispose")},n}();function wt(n){throw new Error("'"+n+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function Ec(n,t,e,r,o,a,i){i===void 0&&(i="channelsLast");var s,u=ly(t),l=u[0],c=u[1];if(i==="channelsLast")s=[l,c,n[3],n[3]];else{if(i!=="channelsFirst")throw new Error("Unknown dataFormat "+i);s=[l,c,n[1],n[1]]}return Kc(n,s,e,r,o,a,!1,i)}function sy(n,t,e,r,o,a,i){i===void 0&&(i="NDHWC");var s,u,l=sE(t),c=l[0],h=l[1],d=l[2];if(i==="NDHWC")u="channelsLast",s=[c,h,d,n[4],n[4]];else{if(i!=="NCDHW")throw new Error("Unknown dataFormat "+i);u="channelsFirst",s=[c,h,d,n[1],n[1]]}return uy(n,s,e,r,o,!1,u,a)}function Kc(n,t,e,r,o,a,i,s){i===void 0&&(i=!1),s===void 0&&(s="channelsLast");var u=[-1,-1,-1,-1],l=u[0],c=u[1],h=u[2],d=u[3];if(s==="channelsLast")l=n[0],c=n[1],h=n[2],d=n[3];else{if(s!=="channelsFirst")throw new Error("Unknown dataFormat "+s);l=n[0],d=n[1],c=n[2],h=n[3]}var p,g=t[0],x=t[1],y=t[3],b=ly(e),C=b[0],E=b[1],S=ly(r),k=S[0],R=S[1],A=xf(g,k),N=xf(x,R),_=function(z,W,F,B,U,q,M,G){var Q,Z,rt;if(typeof z=="number"){Q={top:z,bottom:z,left:z,right:z,type:z===0?"VALID":"NUMBER"};var ct=function(Pt,Vt,Ht,ee,te){ee==null&&(ee=iP(Pt,Vt,Ht));var ne=Pt[0],ge=Pt[1],we=Kp((ne-Vt+2*ee)/Ht+1,te);X(ur(we),function(){return"The output # of rows ("+we+") must be an integer. Change the stride and/or zero pad parameters"});var en=Kp((ge-Vt+2*ee)/Ht+1,te);return X(ur(en),function(){return"The output # of columns ("+en+") must be an integer. Change the stride and/or zero pad parameters"}),[we,en]}([W,F],q,B,z,G);Z=ct[0],rt=ct[1]}else if(z==="same"){Z=Math.ceil(W/B),rt=Math.ceil(F/U);var pt=Math.max(0,(Z-1)*B+q-W),Rt=Math.max(0,(rt-1)*U+M-F),Ct=Math.floor(pt/2),Ft=pt-Ct,Ut=Math.floor(Rt/2);Q={top:Ct,bottom:Ft,left:Ut,right:Rt-Ut,type:"SAME"}}else{if(z!=="valid")throw Error("Unknown padding parameter: "+z);Q={top:0,bottom:0,left:0,right:0,type:"VALID"},Z=Math.ceil((W-q+1)/B),rt=Math.ceil((F-M+1)/U)}return{padInfo:Q,outHeight:Z,outWidth:rt}}(o,c,h,C,E,A,N,a),$=_.padInfo,D=_.outHeight,O=_.outWidth,P=i?y*d:y;return s==="channelsFirst"?p=[l,P,D,O]:s==="channelsLast"&&(p=[l,D,O,P]),{batchSize:l,dataFormat:s,inHeight:c,inWidth:h,inChannels:d,outHeight:D,outWidth:O,outChannels:P,padInfo:$,strideHeight:C,strideWidth:E,filterHeight:g,filterWidth:x,effectiveFilterHeight:A,effectiveFilterWidth:N,dilationHeight:k,dilationWidth:R,inShape:n,outShape:p,filterShape:t}}function uy(n,t,e,r,o,a,i,s){a===void 0&&(a=!1),i===void 0&&(i="channelsLast");var u=[-1,-1,-1,-1,-1],l=u[0],c=u[1],h=u[2],d=u[3],p=u[4];if(i==="channelsLast")l=n[0],c=n[1],h=n[2],d=n[3],p=n[4];else{if(i!=="channelsFirst")throw new Error("Unknown dataFormat "+i);l=n[0],p=n[1],c=n[2],h=n[3],d=n[4]}var g,x=t[0],y=t[1],b=t[2],C=t[4],E=sE(e),S=E[0],k=E[1],R=E[2],A=sE(r),N=A[0],_=A[1],$=A[2],D=xf(x,N),O=xf(y,_),P=xf(b,$),z=function(M,G,Q,Z,rt,ct,pt,Rt,Ct,Ft,Ut){var Pt,Vt,Ht,ee;if(typeof M=="number"){Pt={top:M,bottom:M,left:M,right:M,front:M,back:M,type:M===0?"VALID":"NUMBER"};var te=function(Dn,Bn,cr,Ge,mn,zn){mn==null&&(mn=iP(Dn,Bn,Ge));var Al=Dn[0],_l=Dn[1],Td=Dn[2],Jo=Kp((Al-Bn+2*mn)/Ge+1,zn);X(ur(Jo),function(){return"The output # of depths ("+Jo+") must be an integer. Change the stride and/or zero pad parameters"});var ki=Kp((_l-Bn+2*mn)/Ge+1,zn);X(ur(ki),function(){return"The output # of rows ("+ki+") must be an integer. Change the stride and/or zero pad parameters"});var ta=Kp((Td-Bn+2*mn)/Ge+1,zn);return X(ur(ta),function(){return"The output # of columns ("+ta+") must be an integer. Change the stride and/or zero pad parameters"}),[Jo,ki,ta,cr]}([G,Q,Z,1],Rt,1,rt,M,Ut);Vt=te[0],Ht=te[1],ee=te[2]}else if(M==="same"){Vt=Math.ceil(G/rt),Ht=Math.ceil(Q/ct),ee=Math.ceil(Z/pt);var ne=(Vt-1)*rt+Rt-G,ge=(Ht-1)*ct+Ct-Q,we=(ee-1)*pt+Ft-Z,en=Math.floor(ne/2),ze=ne-en,un=Math.floor(ge/2),nn=ge-un,Gn=Math.floor(we/2);Pt={top:un,bottom:nn,left:Gn,right:we-Gn,front:en,back:ze,type:"SAME"}}else{if(M!=="valid")throw Error("Unknown padding parameter: "+M);Pt={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},Vt=Math.ceil((G-Rt+1)/rt),Ht=Math.ceil((Q-Ct+1)/ct),ee=Math.ceil((Z-Ft+1)/pt)}return{padInfo:Pt,outDepth:Vt,outHeight:Ht,outWidth:ee}}(o,c,h,d,S,k,R,D,O,P,s),W=z.padInfo,F=z.outDepth,B=z.outHeight,U=z.outWidth,q=a?C*p:C;return i==="channelsFirst"?g=[l,q,F,B,U]:i==="channelsLast"&&(g=[l,F,B,U,q]),{batchSize:l,dataFormat:i,inDepth:c,inHeight:h,inWidth:d,inChannels:p,outDepth:F,outHeight:B,outWidth:U,outChannels:q,padInfo:W,strideDepth:S,strideHeight:k,strideWidth:R,filterDepth:x,filterHeight:y,filterWidth:b,effectiveFilterDepth:D,effectiveFilterHeight:O,effectiveFilterWidth:P,dilationDepth:N,dilationHeight:_,dilationWidth:$,inShape:n,outShape:g,filterShape:t}}function iP(n,t,e,r){r===void 0&&(r=1);var o=xf(t,r);return Math.floor((n[0]*(e-1)-e+o)/2)}function ly(n){return typeof n=="number"?[n,n,n]:n.length===2?[n[0],n[1],1]:n}function sE(n){return typeof n=="number"?[n,n,n]:n}function xf(n,t){return t<=1?n:n+(n-1)*(t-1)}function Kp(n,t){if(!t)return n;switch(t){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error("Unknown roundingMode "+t)}}function zf(n){var t=ly(n),e=t[0],r=t[1],o=t[2];return e===1&&r===1&&o===1}function _o(n,t){return zf(n)||zf(t)}function Lk(n){if(n==="NHWC")return"channelsLast";if(n==="NCHW")return"channelsFirst";throw new Error("Unknown dataFormat "+n)}function sP(n,t,e){if(t==="complex64"){if(n.dtype==="complex64")return n.clone();var r=Yn(n.shape),o=n.toFloat(),a=e.complex(o,r);return r.dispose(),o.dispose(),a}if(!lat(n.dtype,t))return st.makeTensorFromDataId(n.dataId,n.shape,t);if(n.dtype==="complex64"){var i=e.real(n);return a=i.cast(t),i.dispose(),a}if(t==="int32")return e.int(n);if(t==="bool"){var s=ae(0,n.dtype);return a=e.notEqual(n,s),s.dispose(),a}throw new Error("Error in Cast: failed to cast "+n.dtype+" to "+t)}function uE(n,t){return st.makeTensorFromDataId(n.dataId,t,n.dtype)}function uP(n,t,e){var r=(t-n)/(e-1),o=Pm(e,"float32");o[0]=n;for(var a=1;a<o.length;a++)o[a]=o[a-1]+r;return vi(o,"float32")}function lE(n,t){if(n.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+n.length+", imag: "+t.length+".");for(var e=new Float32Array(2*n.length),r=0;r<e.length;r+=2)e[r]=n[r/2],e[r+1]=t[r/2];return e}function bO(n,t){return{real:n[2*t],imag:n[2*t+1]}}function ist(n,t,e,r){n[2*r]=t,n[2*r+1]=e}function sst(n,t,e){var r=(e?2:-2)*Math.PI*(n/t);return{real:Math.cos(r),imag:Math.sin(r)}}function ust(n,t,e){var r=function(a,i,s){return function(u,l,c){for(var h=0,d=u.length,p=0,g=!1;h<d;){var x=c(l,u[p=h+(d-h>>>1)]);x>0?h=p+1:(d=p,g=!x)}return g?h:-h-1}(a,i,s||lst)}(n,t,e),o=r<0?-(r+1):r;n.splice(o,0,t)}function lst(n,t){return n>t?1:n<t?-1:0}function Pk(n,t,e,r,o){return lP(n,t,e,r,o,0).selectedIndices}function Bk(n,t,e,r,o,a){var i=lP(n,t,e,r,o,a);return i.numValidOutputs.dispose(),{selectedIndices:i.selectedIndices,selectedScores:i.selectedScores}}function lP(n,t,e,r,o,a,i,s){s===void 0&&(s=!1);for(var u=Array.from(t).map(function(S,k){return{score:S,boxIndex:k,suppressBeginIndex:0}}).filter(function(S){return S.score>o}).sort(wO),l=a>0?-.5/a:0,c=[],h=[];c.length<e&&u.length>0;){var d=u.pop(),p=d.score,g=d.boxIndex,x=d.suppressBeginIndex;if(p<o)break;for(var y=!1,b=c.length-1;b>=x;--b){var C=cst(n,g,c[b]);if(C>=r){y=!0;break}if(d.score=d.score*hst(r,l,C),d.score<=o)break}d.suppressBeginIndex=c.length,y||(d.score===p?(c.push(g),h.push(d.score)):d.score>o&&ust(u,d,wO))}var E=c.length;return s&&(c.fill(0,E),h.fill(0,E)),{selectedIndices:vi(c,"int32"),selectedScores:vi(h,"float32"),numValidOutputs:ae(E,"int32")}}function cst(n,t,e){var r=n.subarray(4*t,4*t+4),o=n.subarray(4*e,4*e+4),a=Math.min(r[0],r[2]),i=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),l=Math.min(o[0],o[2]),c=Math.min(o[1],o[3]),h=Math.max(o[0],o[2]),d=Math.max(o[1],o[3]),p=(s-a)*(u-i),g=(h-l)*(d-c);if(p<=0||g<=0)return 0;var x=Math.max(a,l),y=Math.max(i,c),b=Math.min(s,h),C=Math.min(u,d),E=Math.max(b-x,0)*Math.max(C-y,0);return E/(p+g-E)}function hst(n,t,e){var r=Math.exp(t*e*e);return e<=n?r:0}function wO(n,t){return n.score-t.score||n.score===t.score&&t.boxIndex-n.boxIndex}function cP(n,t,e){var r=new Array(n.rank).fill(0),o=n.shape.slice();return t.map(function(a){o[e]=a;var i=n.slice(r,o);return r[e]+=a,i})}function hP(n,t){for(var e=new Array(n.rank),r=0;r<e.length;r++)e[r]=n.shape[r]*t[r];var o=Ce(e,n.dtype);for(r=0;r<o.values.length;++r){for(var a=o.indexToLoc(r),i=new Array(n.rank),s=0;s<i.length;s++)i[s]=a[s]%n.shape[s];var u=n.locToIndex(i);o.values[r]=n.values[u]}return o.toTensor()}function fP(n,t,e,r,o){for(var a=t[t.length-1],i=[n.length/a,a],s=i[0],u=i[1],l=Lf(e,s*r),c=Lf("int32",s*r),h=0;h<s;h++){for(var d=h*u,p=n.subarray(d,d+u),g=[],x=0;x<p.length;x++)g.push({value:p[x],index:x});g.sort(function(S,k){return k.value-S.value});var y=h*r,b=l.subarray(y,y+r),C=c.subarray(y,y+r);for(x=0;x<r;x++)b[x]=g[x].value,C[x]=g[x].index}var E=t.slice();return E[E.length-1]=r,[Qr(l,E,e),Qr(c,E,"int32")]}function zk(n,t){for(var e=[],r=0;r<t.length;r++)t[r]&&e.push(r);var o=Ce(n,"int32"),a=Ce([e.length,n.length],"int32");for(r=0;r<e.length;r++){var i=o.indexToLoc(e[r]),s=r*n.length;a.values.set(i,s)}return a.toTensor()}var fst=function(n,t){this.outputShape=[],this.outputShape=n,this.variableNames=t.map(function(o,a){return"T"+a});var e=[];this.variableNames.forEach(function(o){e.push("float v"+o+" = get"+o+"AtOutCoords();")});var r=this.variableNames.map(function(o){return"v"+o}).join(" + ");this.userCode=`
      void main() {
        `+e.join(`
        `)+`

        float result = `+r+`;
        setOutput(result);
      }
    `},dst=function(n,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.variableNames=t.map(function(o,a){return"T"+a});var e=[];this.variableNames.forEach(function(o){e.push("vec4 v"+o+" = get"+o+"AtOutCoords();")});var r=this.variableNames.map(function(o){return"v"+o}).join(" + ");this.userCode=`
      void main() {
        `+e.join(`
        `)+`

        vec4 result = `+r+`;
        setOutput(result);
      }
    `},pst=function(n,t,e){this.variableNames=["A"];var r=n.windowSize,o=n.batchSize,a=n.inSize,i=Math.ceil(a/r);e||this.variableNames.push("bestIndicesA"),this.outputShape=[o,i];var s=t==="max"?">":"<",u=e?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+r+`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `+r+`; i++) {
          int inIdx = `+u+`;
          float candidate = getA(batch, inIdx);
          if (candidate `+s+` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `};function dP(n,t){return["x","y","z","w","u","v"].slice(0,t).map(function(e){return n+"."+e})}function Wo(n,t){return t===1?[n]:dP(n,t)}function go(){var n,t,e,r,o,a,i,s,u,l;return Nt().getNumber("WEBGL_VERSION")===2?(n="#version 300 es",t="in",e="out",r="in",o="texture",a="outputColor",i="out vec4 outputColor;",s=`
      bool isnan_custom(float val) {
        return (val > 0.0 || val < 0.0) ? false : val != 0.0;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `,u="",l=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(n="",t="attribute",e="varying",r="varying",o="texture2D",a="gl_FragColor",i="",s=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,u=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,l=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:n,attribute:t,varyingVs:e,varyingFs:r,texture2D:o,output:a,defineOutput:i,defineSpecialNaN:s,defineSpecialInf:u,defineRound:l}}function lc(n,t,e){e===void 0&&(e="index");var r=ya(t);return r.map(function(o,a){return"int "+n[a]+" = "+e+" / "+o+"; "+(a===r.length-1?"int "+n[a+1]+" = "+e+" - "+n[a]+" * "+o:"index -= "+n[a]+" * "+o)+";"}).join("")}function Uk(n){var t=ya(n).map(function(e){return e.toString()});return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * `+t[0]+" + coords.y * "+t[1]+` + coords.z;
  }
`}var pP=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;function mst(n,t,e,r){var o=[];n.forEach(function(p){var g=Yt(p.shapeInfo.logicalShape);p.shapeInfo.isUniform?o.push("uniform float "+p.name+(g>1?"["+g+"]":"")+";"):(o.push("uniform sampler2D "+p.name+";"),o.push("uniform int offset"+p.name+";"))});var a,i,s=o.join(`
`),u=n.map(function(p){return function(g,x,y){y===void 0&&(y=!1);var b="";b+=y?mP(g):af(g);var C=g.shapeInfo.logicalShape,E=x.logicalShape;return C.length<=E.length&&(b+=y?function(S,k){var R,A=S.name,N=A.charAt(0).toUpperCase()+A.slice(1),_="get"+N+"AtOutCoords",$=S.shapeInfo.logicalShape.length,D=k.logicalShape.length,O=Hu(S.shapeInfo.logicalShape,k.logicalShape),P=_n(D),z=D-$,W=["x","y","z","w","u","v"];R=$===0?"":D<2&&O.length>=1?"coords = 0;":O.map(function(Q){return"coords."+W[Q+z]+" = 0;"}).join(`
`);var F="";F=D<2&&$>0?"coords":S.shapeInfo.logicalShape.map(function(Q,Z){return"coords."+W[Z+z]}).join(", ");var B="return outputValue;",U=Yt(S.shapeInfo.logicalShape)===1,q=Yt(k.logicalShape)===1;if($!==1||U||q){if(U&&!q)B=D===1?`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:`
        return vec4(outputValue.x);
      `;else if(O.length){var M=$-2,G=$-1;O.indexOf(M)>-1&&O.indexOf(G)>-1?B="return vec4(outputValue.x);":O.indexOf(M)>-1?B="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":O.indexOf(G)>-1&&(B="return vec4(outputValue.xx, outputValue.zz);")}}else B=`
      return vec4(outputValue.xy, outputValue.xy);
    `;return`
    vec4 `+_+`() {
      `+P+` coords = getOutputCoords();
      `+R+`
      vec4 outputValue = get`+N+"("+F+`);
      `+B+`
    }
  `}(g,x):function(S,k){var R=S.name,A=R.charAt(0).toUpperCase()+R.slice(1),N="get"+A+"AtOutCoords",_=k.texShape,$=S.shapeInfo.texShape,D=S.shapeInfo.logicalShape.length,O=k.logicalShape.length;if(!S.shapeInfo.isUniform&&D===O&&S.shapeInfo.flatOffset==null&&zr($,_))return`
      float `+N+`() {
        return sampleTexture(`+R+`, resultUV);
      }
    `;var P,z=_n(O),W=Hu(S.shapeInfo.logicalShape,k.logicalShape),F=O-D,B=["x","y","z","w","u","v"];P=D===0?"":O<2&&W.length>=1?"coords = 0;":W.map(function(q){return"coords."+B[q+F]+" = 0;"}).join(`
`);var U="";return U=O<2&&D>0?"coords":S.shapeInfo.logicalShape.map(function(q,M){return"coords."+B[M+F]}).join(", "),`
    float `+N+`() {
      `+z+` coords = getOutputCoords();
      `+P+`
      return get`+A+"("+U+`);
    }
  `}(g,x)),b}(p,t,r)}).join(`
`),l=t.texShape,c=go(),h=function(p){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return `+p.texture2D+`(textureSampler, uv).r;
    }
  `}(c),d=function(p){return p.version+`
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    `+p.varyingFs+` vec2 resultUV;
    `+p.defineOutput+`
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    `+p.defineSpecialNaN+`
    `+p.defineSpecialInf+`
    `+p.defineRound+`

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    `+gst+`
    `+vst+`
    `+xst+`
  `}(c);return t.isPacked?(a=function(p,g){switch(p.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(S,k){var R=[Math.ceil(k[0]/2),Math.ceil(k[1]/2)];return R[0]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `+R[1]+`.0);
      }
    `:R[1]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `+R[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+R[0]+", "+R[1]+`));
      return 2 * (resTexRC.x * `+R[1]+` + resTexRC.y);
    }
  `}(0,g);case 2:return function(S,k){var R=[Math.ceil(k[0]/2),Math.ceil(k[1]/2)];if(zr(S,k))return`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`+R[0]+", "+R[1]+`));
      }
    `;var A=Math.ceil(S[1]/2);return`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+R[0]+", "+R[1]+`));

      int index = resTexRC.x * `+R[1]+` + resTexRC.y;
      int r = 2 * (index / `+A+`);
      int c = imod(index, `+A+`) * 2;

      return ivec2(r, c);
    }
  `}(p,g);case 3:return x=p,y=g,b=[Math.ceil(y[0]/2),Math.ceil(y[1]/2)],C=Math.ceil(x[2]/2),E=C*Math.ceil(x[1]/2),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+b[0]+", "+b[1]+`));
      int index = resTexRC.x * `+b[1]+` + resTexRC.y;

      int b = index / `+E+`;
      index -= b * `+E+`;

      int r = 2 * (index / `+C+`);
      int c = imod(index, `+C+`) * 2;

      return ivec3(b, r, c);
    }
  `;default:return function(S,k){for(var R=[Math.ceil(k[0]/2),Math.ceil(k[1]/2)],A=Math.ceil(S[S.length-1]/2),N=A*Math.ceil(S[S.length-2]/2),_=N,$="",D="b, r, c",O=2;O<S.length-1;O++)_*=S[S.length-O-1],$=`
      int b`+O+" = index / "+_+`;
      index -= b`+O+" * "+_+`;
    `+$,D="b"+O+", "+D;return`
    ivec`+S.length+` getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+R[0]+", "+R[1]+`));
      int index = resTexRC.x * `+R[1]+` + resTexRC.y;

      `+$+`

      int b = index / `+N+`;
      index -= b * `+N+`;

      int r = 2 * (index / `+A+`);
      int c = imod(index, `+A+`) * 2;

      return ivec`+S.length+"("+D+`);
    }
  `}(p,g)}var x,y,b,C,E}(t.logicalShape,l),i=function(p){return`
    void setOutput(vec4 val) {
      `+p.output+` = val;
    }
  `}(c)):(a=function(p,g){switch(p.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(b,C){return C[0]===1?`
      int getOutputCoords() {
        return int(resultUV.x * `+C[1]+`.0);
      }
    `:C[1]===1?`
      int getOutputCoords() {
        return int(resultUV.y * `+C[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+C[0]+", "+C[1]+`));
      return resTexRC.x * `+C[1]+` + resTexRC.y;
    }
  `}(0,g);case 2:return function(b,C){return zr(b,C)?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`+C[0]+", "+C[1]+`));
      }
    `:b[1]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+C[0]+", "+C[1]+`));
        int index = resTexRC.x * `+C[1]+` + resTexRC.y;
        return ivec2(index, 0);
      }
    `:b[0]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+C[0]+", "+C[1]+`));
        int index = resTexRC.x * `+C[1]+` + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+C[0]+", "+C[1]+`));
      int index = resTexRC.x * `+C[1]+` + resTexRC.y;
      int r = index / `+b[1]+`;
      int c = index - r * `+b[1]+`;
      return ivec2(r, c);
    }
  `}(p,g);case 3:return x=g,y=lc(["r","c","d"],p),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+x[0]+", "+x[1]+`));
      int index = resTexRC.x * `+x[1]+` + resTexRC.y;
      `+y+`
      return ivec3(r, c, d);
    }
  `;case 4:return function(b,C){var E=lc(["r","c","d","d2"],b);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+C[0]+", "+C[1]+`));
      int index = resTexRC.x * `+C[1]+` + resTexRC.y;
      `+E+`
      return ivec4(r, c, d, d2);
    }
  `}(p,g);case 5:return function(b,C){var E=lc(["r","c","d","d2","d3"],b);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`+C[0]+`,
                             `+C[1]+`));

      int index = resTexRC.x * `+C[1]+` + resTexRC.y;

      `+E+`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}(p,g);case 6:return function(b,C){var E=lc(["r","c","d","d2","d3","d4"],b);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+C[0]+", "+C[1]+`));
      int index = resTexRC.x * `+C[1]+` + resTexRC.y;

      `+E+`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}(p,g);default:throw new Error(p.length+"-D output sampling is not yet supported")}var x,y}(t.logicalShape,l),i=function(p){return`
    void setOutput(float val) {
      `+p.output+` = vec4(val, 0, 0, 0);
    }
  `}(c)),r&&(d+=yst),[d,h,i,s,a,u,e].join(`
`)}function af(n){var t=n.shapeInfo.logicalShape;switch(t.length){case 0:return function(e){var r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1);if(e.shapeInfo.isUniform)return"float "+o+"() {return "+r+";}";var a=e.shapeInfo.texShape,i=a[0],s=a[1];if(i===1&&s===1)return`
      float `+o+`() {
        return sampleTexture(`+r+`, halfCR);
      }
    `;var u=e.shapeInfo.texShape,l=u[0],c=u[1],h=Kl(r);return`
    float `+o+`() {
      vec2 uv = uvFromFlat(`+l+", "+c+", "+h+`);
      return sampleTexture(`+r+`, uv);
    }
  `}(n);case 1:return function(e){var r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1);if(e.shapeInfo.isUniform)return`
      float `+o+`(int index) {
        `+Kh(e)+`
      }
    `;var a=e.shapeInfo.texShape,i=a[0],s=a[1];if(s===1&&i===1)return`
      float `+o+`(int index) {
        return sampleTexture(`+r+`, halfCR);
      }
    `;var u=Kl(r);return s===1?`
      float `+o+`(int index) {
        vec2 uv = vec2(0.5, (float(index + `+u+") + 0.5) / "+i+`.0);
        return sampleTexture(`+r+`, uv);
      }
    `:i===1?`
      float `+o+`(int index) {
        vec2 uv = vec2((float(index + `+u+") + 0.5) / "+s+`.0, 0.5);
        return sampleTexture(`+r+`, uv);
      }
    `:`
    float `+o+`(int index) {
      vec2 uv = uvFromFlat(`+i+", "+s+", index + "+u+`);
      return sampleTexture(`+r+`, uv);
    }
  `}(n);case 2:return function(e){var r=e.shapeInfo.logicalShape,o=e.name,a="get"+o.charAt(0).toUpperCase()+o.slice(1),i=e.shapeInfo.texShape;if(i!=null&&zr(r,i)){var s=i[0],u=i[1];return`
    float `+a+`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`+u+".0, "+s+`.0);
      return sampleTexture(`+o+`, uv);
    }
  `}var l=rc(r),c=l.newShape,h=l.keptDims,d=c;if(d.length<r.length){var p=sf(e,d);return`
      `+af(p)+`
      float `+a+`(int row, int col) {
        return `+a+"("+uf(["row","col"],h)+`);
      }
    `}if(e.shapeInfo.isUniform)return`
      float `+a+`(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(`+r[1]+`, 1)));
        `+Kh(e)+`
      }
    `;var g=i[0],x=i[1],y=Kl(o);return x===1?`
    float `+a+`(int row, int col) {
      float index = dot(vec3(row, col, `+y+"), vec3("+r[1]+`, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `+g+`.0);
      return sampleTexture(`+o+`, uv);
    }
  `:g===1?`
    float `+a+`(int row, int col) {
      float index = dot(vec3(row, col, `+y+"), vec3("+r[1]+`, 1, 1));
      vec2 uv = vec2((index + 0.5) / `+x+`.0, 0.5);
      return sampleTexture(`+o+`, uv);
    }
  `:`
  float `+a+`(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * `+r[1]+" + col + "+y+`;
    vec2 uv = uvFromFlat(`+g+", "+x+`, index);
    return sampleTexture(`+o+`, uv);
  }
`}(n);case 3:return function(e){var r=e.shapeInfo.logicalShape,o=e.name,a="get"+o.charAt(0).toUpperCase()+o.slice(1),i=r[1]*r[2],s=r[2],u=rc(r),l=u.newShape,c=u.keptDims,h=l;if(h.length<r.length){var d=sf(e,h);return`
        `+af(d)+`
        float `+a+`(int row, int col, int depth) {
          return `+a+"("+uf(["row","col","depth"],c)+`);
        }
      `}if(e.shapeInfo.isUniform)return`
      float `+a+`(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(`+i+", "+s+`, 1)));
        `+Kh(e)+`
      }
    `;var p=e.shapeInfo.texShape,g=p[0],x=p[1],y=e.shapeInfo.flatOffset;if(x===i&&y==null)return`
        float `+a+`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`+s+`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`+x+".0, "+g+`.0);
          return sampleTexture(`+o+`, uv);
        }
      `;if(x===s&&y==null)return`
    float `+a+`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`+r[1]+`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+x+".0, "+g+`.0);
      return sampleTexture(`+o+`, uv);
    }
  `;var b=Kl(o);return`
      float `+a+`(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `+i+" + col * "+s+" + depth + "+b+`;
        vec2 uv = uvFromFlat(`+g+", "+x+`, index);
        return sampleTexture(`+o+`, uv);
      }
  `}(n);case 4:return function(e){var r=e.shapeInfo.logicalShape,o=e.name,a="get"+o.charAt(0).toUpperCase()+o.slice(1),i=r[3],s=r[2]*i,u=r[1]*s,l=rc(r),c=l.newShape,h=l.keptDims;if(c.length<r.length){var d=sf(e,c);return`
      `+af(d)+`
      float `+a+`(int row, int col, int depth, int depth2) {
        return `+a+"("+uf(["row","col","depth","depth2"],h)+`);
      }
    `}if(e.shapeInfo.isUniform)return`
      float `+a+`(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(`+u+", "+s+", "+i+`, 1)));
        `+Kh(e)+`
      }
    `;var p=e.shapeInfo.flatOffset,g=e.shapeInfo.texShape,x=g[0],y=g[1];if(y===u&&p==null)return`
      float `+a+`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(`+s+", "+i+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+y+".0, "+x+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;if(y===i&&p==null)return`
      float `+a+`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`+r[1]*r[2]+", "+r[2]+`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+y+".0, "+x+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;var b=Kl(o);return`
    float `+a+`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+u+" + col * "+s+` +
          depth * `+i+` + depth2;
      vec2 uv = uvFromFlat(`+x+", "+y+", index + "+b+`);
      return sampleTexture(`+o+`, uv);
    }
  `}(n);case 5:return function(e){var r=e.shapeInfo.logicalShape,o=e.name,a="get"+o.charAt(0).toUpperCase()+o.slice(1),i=r[4],s=r[3]*i,u=r[2]*s,l=r[1]*u,c=rc(r),h=c.newShape,d=c.keptDims;if(h.length<r.length){var p=sf(e,h);return`
      `+af(p)+`
      float `+a+`(int row, int col, int depth, int depth2, int depth3) {
        return `+a+"("+uf(["row","col","depth","depth2","depth3"],d)+`);
      }
    `}if(e.shapeInfo.isUniform)return`
      float `+a+`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`+l+", "+u+", "+s+", "+i+`)) +
          depth3;
        `+Kh(e)+`
      }
    `;var g=e.shapeInfo.flatOffset,x=e.shapeInfo.texShape,y=x[0],b=x[1];if(b===l&&g==null)return`
      float `+a+`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(`+u+", "+s+", "+i+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+b+".0, "+y+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;if(b===i&&g==null)return`
      float `+a+`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`+r[1]*r[2]*r[3]+`,
               `+r[2]*r[3]+", "+r[3]+`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+b+".0, "+y+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;var C=Kl(o);return`
    float `+a+`(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+l+" + col * "+u+" + depth * "+s+` +
          depth2 * `+i+" + depth3 + "+C+`;
      vec2 uv = uvFromFlat(`+y+", "+b+`, index);
      return sampleTexture(`+o+`, uv);
    }
  `}(n);case 6:return function(e){var r=e.shapeInfo.logicalShape,o=e.name,a="get"+o.charAt(0).toUpperCase()+o.slice(1),i=rc(r),s=i.newShape,u=i.keptDims;if(s.length<r.length){var l=sf(e,s);return`
      `+af(l)+`
      float `+a+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `+a+"("+uf(["row","col","depth","depth2","depth3","depth4"],u)+`);
      }
    `}var c=r[5],h=r[4]*c,d=r[3]*h,p=r[2]*d,g=r[1]*p;if(e.shapeInfo.isUniform)return`
      float `+a+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(`+g+", "+p+", "+d+", "+h+`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`+c+`, 1)));
        `+Kh(e)+`
      }
    `;var x=e.shapeInfo.flatOffset,y=e.shapeInfo.texShape,b=y[0],C=y[1];if(C===g&&x==null)return`
      float `+a+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(`+p+", "+d+", "+h+", "+c+`)) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+C+".0, "+b+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;if(C===c&&x==null)return`
      float `+a+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(`+r[1]*r[2]*r[3]*r[4]+`,
               `+r[2]*r[3]*r[4]+`,
               `+r[3]*r[4]+`,
               `+r[4]+`)) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+C+".0, "+b+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;var E=Kl(o);return`
    float `+a+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+g+" + col * "+p+" + depth * "+d+` +
          depth2 * `+h+" + depth3 * "+c+" + depth4 + "+E+`;
      vec2 uv = uvFromFlat(`+b+", "+C+`, index);
      return sampleTexture(`+o+`, uv);
    }
  `}(n);default:throw new Error(t.length+"-D input sampling is not yet supported")}}function mP(n){var t,e,r;switch(n.shapeInfo.logicalShape.length){case 0:return t=n.name,e="get"+t.charAt(0).toUpperCase()+t.slice(1),r=go(),`
    vec4 `+e+`() {
      return `+r.texture2D+"("+t+`, halfCR);
    }
  `;case 1:return function(o){var a=o.name,i="get"+a.charAt(0).toUpperCase()+a.slice(1),s=o.shapeInfo.texShape,u=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],l=go();return`
    vec4 `+i+`(int index) {
      vec2 uv = packedUVfrom1D(
        `+u[0]+", "+u[1]+`, index);
      return `+l.texture2D+"("+a+`, uv);
    }
  `}(n);case 2:return function(o){var a=o.shapeInfo.logicalShape,i=o.name,s="get"+i.charAt(0).toUpperCase()+i.slice(1),u=o.shapeInfo.texShape,l=u[0],c=u[1],h=go();if(u!=null&&zr(a,u))return`
      vec4 `+s+`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`+c+".0, "+l+`.0);

        return `+h.texture2D+"("+i+`, uv);
      }
    `;var d=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)],p=Math.ceil(a[1]/2);return`
    vec4 `+s+`(int row, int col) {
      vec2 uv = packedUVfrom2D(`+p+", "+d[0]+", "+d[1]+`, row, col);
      return `+h.texture2D+"("+i+`, uv);
    }
  `}(n);case 3:return function(o){var a=o.shapeInfo.logicalShape,i=o.name,s="get"+i.charAt(0).toUpperCase()+i.slice(1),u=o.shapeInfo.texShape,l=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];if(a[0]===1){var c=a.slice(1),h=sf(o,c);return`
        `+mP(h)+`
        vec4 `+s+`(int b, int row, int col) {
          return `+s+"("+uf(["b","row","col"],[1,2])+`);
        }
      `}var d=l[0],p=l[1],g=Math.ceil(a[2]/2),x=g*Math.ceil(a[1]/2),y=go();return`
    vec4 `+s+`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `+d+", "+p+", "+x+", "+g+`, b, row, col);
      return `+y.texture2D+"("+i+`, uv);
    }
  `}(n);default:return function(o){for(var a=o.shapeInfo.logicalShape,i=a.length,s=o.name,u="get"+s.charAt(0).toUpperCase()+s.slice(1),l=o.shapeInfo.texShape,c=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)],h=c[0],d=c[1],p=Math.ceil(a[i-1]/2),g=p*Math.ceil(a[i-2]/2),x="int b, int row, int col",y="b * "+g+" + (row / 2) * "+p+" + (col / 2)",b=2;b<i-1;b++)x="int b"+b+", "+x,g*=a[i-b-1],y="b"+b+" * "+g+" + "+y;var C=go();return`
    vec4 `+u+"("+x+`) {
      int index = `+y+`;
      int texR = index / `+d+`;
      int texC = index - texR * `+d+`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+d+", "+h+`);
      return `+C.texture2D+"("+s+`, uv);
    }
  `}(n)}}var gst=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,vst=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,xst=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,yst=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function Kl(n){return"offset"+n}function Kh(n){var t=n.name,e=Yt(n.shapeInfo.logicalShape);return e<2?"return "+t+";":`
    for (int i = 0; i < `+e+`; i++) {
      if (i == index) {
        return `+t+`[i];
      }
    }
  `}function _n(n){if(n<=1)return"int";if(n===2)return"ivec2";if(n===3)return"ivec3";if(n===4)return"ivec4";if(n===5)return"ivec5";if(n===6)return"ivec6";throw Error("GPU for rank "+n+" is not yet supported")}function sf(n,t){var e=JSON.parse(JSON.stringify(n));return e.shapeInfo.logicalShape=t,e}function uf(n,t){return t.map(function(e){return n[e]}).join(", ")}var bst=function(n,t,e,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,X(n.length>2,function(){return"Packed arg"+(e.charAt(0).toUpperCase()+e.slice(1))+" supports only inputs with rank above 2."});var o=n[n.length-1],a=Math.ceil(o/t);this.outputShape=n.slice(0,-1),a>1&&this.outputShape.push(a),r||this.variableNames.push("bestIndicesA");var i,s,u=this.outputShape,l=u.length,c=_n(l),h=Wo("coords",l);if(a===1){var d=_n(s=l+1);i=`
        `+d+" sourceLocR = "+d+"("+h.join()+`, 0);
        ++`+h[l-1]+`;
        `+d+" sourceLocG = "+d+"("+h.join()+`, 0);
        ++`+h[l-2]+`;
        `+d+" sourceLocA = "+d+"("+h.join()+`, 0);
        --`+h[l-1]+`;
        `+d+" sourceLocB = "+d+"("+h.join()+`, 0);
        --`+h[l-2]+";"}else s=l,i=`
        `+c+` sourceLocR = coords;
        ++`+h[l-1]+`;
        `+c+` sourceLocG = coords;
        ++`+h[l-2]+`;
        `+c+` sourceLocA = coords;
        --`+h[l-1]+`;
        `+c+` sourceLocB = coords;
        --`+h[l-2]+";";var p=["x","y","z","w","u","v"].slice(0,s),g="."+p[s-1],x=p.map(function(N){return"int "+N}),y=Wo("sourceLocR",s-1).concat("inIdx.r"),b=Wo("sourceLocG",s-1).concat("inIdx.g"),C=Wo("sourceLocB",s-1).concat("inIdx.b"),E=Wo("sourceLocA",s-1).concat("inIdx.a"),S=e==="max"?"greaterThan":"lessThan",k=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(`+y.join()+`),
                             getBestIndicesAChannel(`+b.join()+`),
                             getBestIndicesAChannel(`+C.join()+`),
                             getBestIndicesAChannel(`+E.join()+")));",R=`vec4(
            getAChannel(`+y.join()+`),
            hasNextCol ? getAChannel(`+b.join()+`) : 0.,
            hasNextRow ? getAChannel(`+C.join()+`) : 0.,
            hasNextRow && hasNextCol ? getAChannel(`+E.join()+") : 0.)",A=r?"":`
      float getBestIndicesAChannel(`+x.join()+`) {
        return getChannel(getBestIndicesA(`+p.join()+`),
                                          vec2(`+p.slice(-2).join()+`));
      }`;this.userCode=`
      float getAChannel(`+x.join()+`) {
        return getChannel(getA(`+p.join()+`),
                               vec2(`+p.slice(-2).join()+`));
      }
      `+A+`
      void main() {
        `+c+` coords = getOutputCoords();
        bool hasNextCol = `+h[l-1]+" < "+(u[l-1]-1)+`;
        bool hasNextRow = `+h[l-2]+" < "+(u[l-2]-1)+`;
        `+i+`
        ivec4 srcIdx = ivec4(sourceLocR`+g+", sourceLocG"+g+`,
          sourceLocB`+g+", sourceLocA"+g+") * "+t+`;
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = `+R+`;

        for (int i = 0; i < `+t+`; i++) {
          inIdx = srcIdx;
          `+k+`
          vec4 candidate = `+R+`;
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(`+S+`(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `},wst=function(n){this.variableNames=["dy"],this.outputShape=n.inShape;var t=n.filterHeight,e=n.filterWidth,r=n.strideHeight,o=n.strideWidth,a=n.dilationHeight,i=n.dilationWidth,s=n.effectiveFilterHeight,u=n.effectiveFilterWidth,l=s-1-n.padInfo.top,c=u-1-n.padInfo.left,h=1/(t*e);this.userCode=`
      const ivec2 pads = ivec2(`+l+", "+c+`);
      const float avgMultiplier = float(`+h+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+s+`;
            wR += `+a+`) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+u+`;
            wC+= `+i+`) {
            float dyC = float(dyCCorner + wC) / `+o+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `},Cst=function(n){this.variableNames=["dy"],this.outputShape=n.inShape;var t=n.filterDepth,e=n.filterHeight,r=n.filterWidth,o=n.strideDepth,a=n.strideHeight,i=n.strideWidth,s=n.dilationDepth,u=n.dilationHeight,l=n.dilationWidth,c=n.effectiveFilterDepth,h=n.effectiveFilterHeight,d=n.effectiveFilterWidth,p=c-1-n.padInfo.front,g=h-1-n.padInfo.top,x=d-1-n.padInfo.left,y=1/(t*e*r);this.userCode=`
      const ivec3 pads = ivec3(`+p+", "+g+", "+x+`);
      const float avgMultiplier = float(`+y+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+c+`;
            wD += `+s+`) {
          float dyD = float(dyDCorner + wD) / `+o+`.0;

          if (dyD < 0.0 || dyD >= `+n.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+h+`;
              wR += `+u+`) {
            float dyR = float(dyRCorner + wR) / `+a+`.0;

            if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+d+`;
                wC += `+l+`) {
              float dyC = float(dyCCorner + wC) / `+i+`.0;

              if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `},Sst=function(n,t,e,r,o,a){this.outputShape=[],this.variableNames=["x","mean","variance"],Pe(n,t),Pe(n,e);var i="0.0";r!=null&&(Pe(n,r),this.variableNames.push("offset"),i="getOffsetAtOutCoords()");var s="1.0";o!=null&&(Pe(n,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=n,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `+i+`;
        float scale = `+s+`;
        float inv = scale * inversesqrt(variance + float(`+a+`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `},Est=function(n,t,e,r,o,a){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Pe(n,t),Pe(n,e);var i="vec4(0.0)";r!=null&&(Pe(n,r),this.variableNames.push("offset"),i="getOffsetAtOutCoords()");var s="vec4(1.0)";o!=null&&(Pe(n,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=n,this.userCode=`
      void main() {
        vec4 offset = `+i+`;
        vec4 scale = `+s+`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`+a+`));

        setOutput((x - mean) * inv + offset);
      }
    `},kst="return areal * breal - aimag * bimag;",Ist="return areal * bimag + aimag * breal;",CO=function(n,t,e){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Pe(t,e),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `+n+`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `},UC="return a + b;",WC="return a - b;",SO="return a * b;",Rst=`
if (a == b) {
  return 1.0;
};
return a / b;`,gP="return (a < 0.) ? b * a : a;",Xn=function(n,t,e){this.variableNames=["A","B"],this.outputShape=Pe(t,e),this.userCode=`
      float binaryOperation(float a, float b) {
        `+n+`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `},Tst=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,vP=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`,$i=function(n,t,e,r){r===void 0&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Pe(t,e);var o=this.outputShape.length,a="";if(r)if(o===0||Yt(this.outputShape)===1)a=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(a=`
          `+_n(o)+` coords = getOutputCoords();
        `,o===1)a+=`
            result.y = (coords + 1) >= `+this.outputShape[0]+` ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{var i=Wo("coords",o);a+=`
            bool nextRowOutOfBounds =
              (`+i[o-2]+" + 1) >= "+this.outputShape[o-2]+`;
            bool nextColOutOfBounds =
              (`+i[o-1]+" + 1) >= "+this.outputShape[o-1]+`;
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        `+n+`
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        `+a+`

        setOutput(result);
      }
    `},Nst=function(){function n(t){this.variableNames=["A"],this.outputShape=t,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}return n.prototype.getCustomSetupFunc=function(t,e){var r=this;return function(o,a){r.minLoc==null&&(r.minLoc=o.getUniformLocationNoThrow(a,"minVal"),r.maxLoc=o.getUniformLocationNoThrow(a,"maxVal")),o.gl.uniform1f(r.minLoc,t),o.gl.uniform1f(r.maxLoc,e)}},n}(),Ast=function(){function n(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}return n.prototype.getCustomSetupFunc=function(t,e){var r=this;return function(o,a){r.minLoc==null&&(r.minLoc=o.getUniformLocationNoThrow(a,"minVal"),r.maxLoc=o.getUniformLocationNoThrow(a,"maxVal")),o.gl.uniform1f(r.minLoc,t),o.gl.uniform1f(r.maxLoc,e)}},n}(),_st=function(n){this.variableNames=["real","imag"],this.outputShape=n,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `},Dst=function(n){this.outputShape=[],this.outputShape=Bf(n,1),this.variableNames=n.map(function(s,u){return"T"+u});var t=new Array(n.length-1);t[0]=n[0][1];for(var e=1;e<t.length;e++)t[e]=t[e-1]+n[e][1];var r=["if (yC < "+t[0]+") setOutput(getT0(yR, yC));"];for(e=1;e<t.length;e++){var o=t[e-1];r.push("else if (yC < "+t[e]+") setOutput(getT"+e+"(yR, yC-"+o+"));")}var a=t.length,i=t[t.length-1];r.push("else setOutput(getT"+a+"(yR, yC-"+i+"));"),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        `+r.join(`
        `)+`
      }
    `},$st=function(n,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Bf(n,t);var e=this.outputShape,r=e.length,o=_n(r),a=Wo("coords",r),i=["x","y","z","w","u","v"].slice(0,r);this.variableNames=n.map(function(y,b){return"T"+b});var s=new Array(n.length-1);s[0]=n[0][t];for(var u=1;u<s.length;u++)s[u]=s[u-1]+n[u][t];var l=i[t],c=i.slice(-2),h=i.join(),d="if ("+l+" < "+s[0]+`) {
        return getChannel(
            getT0(`+h+"), vec2("+c.join()+`));
        }`;for(u=1;u<s.length;u++){var p=s[u-1];d+=`
        if (`+l+" < "+s[u]+"  && "+l+" >= "+s[u-1]+`) {
          return getChannel(
            getT`+u+"("+Lx(i,l,p)+`),
            vec2(`+Lx(c,l,p)+`));
        }`}var g=s.length,x=s[s.length-1];d+=`
        return getChannel(
          getT`+g+"("+Lx(i,l,x)+`),
          vec2(`+Lx(c,l,x)+"));",this.userCode=`
      float getValue(`+i.map(function(y){return"int "+y})+`) {
        `+d+`
      }

      void main() {
        `+o+` coords = getOutputCoords();
        vec4 result = vec4(getValue(`+a+`), 0., 0., 0.);

        `+a[r-1]+" = "+a[r-1]+` + 1;
        if (`+a[r-1]+" < "+e[r-1]+`) {
          result.g = getValue(`+a+`);
        }

        `+a[r-2]+" = "+a[r-2]+` + 1;
        if (`+a[r-2]+" < "+e[r-2]+`) {
          result.a = getValue(`+a+`);
        }

        `+a[r-1]+" = "+a[r-1]+` - 1;
        if (`+a[r-2]+" < "+e[r-2]+` &&
            `+a[r-1]+" < "+e[r-1]+`) {
          result.b = getValue(`+a+`);
        }
        setOutput(result);
      }
    `};function Lx(n,t,e){var r=n.indexOf(t);return n.map(function(o,a){return a===r?o+" - "+e:o}).join()}var Ost=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;var t=n.strideHeight,e=n.strideWidth,r=n.padInfo.top,o=n.padInfo.left,a=n.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `+n.batchSize+`; b++) {
          for (int yR = 0; yR < `+n.outHeight+`; yR++) {
            int xR = wR + yR * `+t+" - "+r+`;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+n.outWidth+`; yC++) {
              int xC = wC + yC * `+e+" - "+o+`;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              if (`+a+`) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},Fst=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var t=n.filterHeight,e=n.filterWidth,r=n.strideHeight,o=n.strideWidth,a=n.dataFormat==="channelsLast",i=t-1-n.padInfo.top,s=e-1-n.padInfo.left,u=a?1:2,l=a?2:3,c=a?3:1;this.userCode=`
      const ivec2 pads = ivec2(`+i+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[`+c+`];

        ivec2 dyCorner = ivec2(coords[`+u+"], coords["+l+`]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+t+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+t+` - 1 - wR;

          for (int wC = 0; wC < `+e+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+o+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+e+` - 1 - wC;

            for (int d2 = 0; d2 < `+n.outChannels+`; d2++) {

              if (`+a+`) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},Mst=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;var t=n.strideDepth,e=n.strideHeight,r=n.strideWidth,o=n.padInfo.front,a=n.padInfo.top,i=n.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `+n.batchSize+`; b++) {
          for (int yF = 0; yF < `+n.outDepth+`; yF++) {
            int xF = wF + yF * `+t+" - "+o+`;

            if (xF < 0 || xF >= `+n.inDepth+`) {
              continue;
            }

            for (int yR = 0; yR < `+n.outHeight+`; yR++) {
              int xR = wR + yR * `+e+" - "+a+`;

              if (xR < 0 || xR >= `+n.inHeight+`) {
                continue;
              }

              for (int yC = 0; yC < `+n.outWidth+`; yC++) {
                int xC = wC + yC * `+r+" - "+i+`;

                if (xC < 0 || xC >= `+n.inWidth+`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},Lst=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var t=n.filterDepth,e=n.filterHeight,r=n.filterWidth,o=n.strideDepth,a=n.strideHeight,i=n.strideWidth,s=t-1-n.padInfo.front,u=e-1-n.padInfo.top,l=r-1-n.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`+s+", "+u+", "+l+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `+t+`; wF++) {
          float dyF = float(dyFCorner + wF) / `+o+`.0;

          if (dyF < 0.0 || dyF >= `+n.outDepth+`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `+t+` - 1 - wF;

          for (int wR = 0; wR < `+e+`; wR++) {
            float dyR = float(dyRCorner + wR) / `+a+`.0;

            if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `+e+` - 1 - wR;

            for (int wC = 0; wC < `+r+`; wC++) {
              float dyC = float(dyCCorner + wC) / `+i+`.0;

              if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `+r+` - 1 - wC;

              for (int d2 = 0; d2 < `+n.outChannels+`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},Pst=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;var t=n.strideHeight,e=n.strideWidth,r=n.padInfo.top,o=n.padInfo.left,a=n.outChannels/n.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `+a+` + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < `+n.batchSize+`; b++) {
          for (int yR = 0; yR < `+n.outHeight+`; yR++) {
            int xR = wR + yR * `+t+" - "+r+`;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+n.outWidth+`; yC++) {
              int xC = wC + yC * `+e+" - "+o+`;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `},Bst=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var t=n.filterHeight,e=n.filterWidth,r=n.strideHeight,o=n.strideWidth,a=t-1-n.padInfo.top,i=e-1-n.padInfo.left,s=n.outChannels/n.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`+a+", "+i+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `+t+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+t+` - 1 - wR;

          for (int wC = 0; wC < `+e+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+o+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+e+` - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < `+s+`; dm++) {
              int d2 = d1 * `+s+` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `},EO=function(n,t,e,r){t===void 0&&(t=!1),e===void 0&&(e=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.outputShape=n.outShape;var o=n.padInfo.top,a=n.padInfo.left,i=n.strideHeight,s=n.strideWidth,u=n.dilationHeight,l=n.dilationWidth,c=n.filterHeight,h=n.filterWidth,d=4*Math.floor(n.inChannels/4),p=n.inChannels%4,g=n.dataFormat==="channelsLast",x=g?1:2,y=g?2:3,b=g?3:1,C="",E="";e&&(C=r?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+e+`
        }`:`
          float activation(float x) {
            `+e+`
          }
        `,E="result = activation(result);");var S=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+C+`

      const ivec2 strides = ivec2(`+i+", "+s+`);
      const ivec2 pads = ivec2(`+o+", "+a+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[`+b+`];

        ivec2 xRCCorner =
            ivec2(coords[`+x+"], coords["+y+`]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+c+`; wR++) {
          int xR = xRCorner + wR * `+u+`;

          if (xR < 0 || xR >= `+n.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+h+`; wC++) {
            int xC = xCCorner + wC * `+l+`;

            if (xC < 0 || xC >= `+n.inWidth+`) {
              continue;
            }

            for (int d1 = 0; d1 < `+d+`; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (`+g+`) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (`+(p===1)+`) {

              if (`+g+`) {
                dotProd +=
                    getX(batch, xR, xC, `+d+`) *
                    getW(wR, wC, `+d+`, d2);
              } else {
                dotProd +=
                    getX(batch, `+d+`, xR, xC) *
                    getW(wR, wC, `+d+`, d2);
              }

            } else if (`+(p===2)+`) {
              vec2 wValues = vec2(
                getW(wR, wC, `+d+`, d2),
                getW(wR, wC, `+d+` + 1, d2)
              );

              if (`+g+`) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, `+d+`),
                  getX(batch, xR, xC, `+d+` + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, `+d+`, xR, xC),
                  getX(batch, `+d+` + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (`+(p===3)+`) {
              vec3 wValues = vec3(
                getW(wR, wC, `+d+`, d2),
                getW(wR, wC, `+d+` + 1, d2),
                getW(wR, wC, `+d+` + 2, d2)
              );

              if (`+g+`) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, `+d+`),
                  getX(batch, xR, xC, `+d+` + 1),
                  getX(batch, xR, xC, `+d+` + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, `+d+`, xR, xC),
                  getX(batch, `+d+` + 1, xR, xC),
                  getX(batch, `+d+` + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        `+S+`
        `+E+`
        setOutput(result);
      }
    `},zst=function(n){this.variableNames=["x","W"],this.outputShape=n.outShape;var t=n.padInfo.front,e=n.padInfo.top,r=n.padInfo.left,o=n.strideDepth,a=n.strideHeight,i=n.strideWidth,s=n.dilationDepth,u=n.dilationHeight,l=n.dilationWidth,c=n.filterDepth,h=n.filterHeight,d=n.filterWidth,p=4*Math.floor(n.inChannels/4),g=n.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`+o+", "+a+", "+i+`);
      const ivec3 pads = ivec3(`+t+", "+e+", "+r+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `+c+`; wF++) {
          int xF = xFCorner + wF * `+s+`;

          if (xF < 0 || xF >= `+n.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+h+`; wR++) {
            int xR = xRCorner + wR * `+u+`;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+d+`; wC++) {
              int xC = xCCorner + wC * `+l+`;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              for (int d1 = 0; d1 < `+p+`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`+(g===1)+`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `+p+`) *
                  getW(wF, wR, wC, `+p+`, d2);
              } else if (`+(g===2)+`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `+p+`),
                  getX(batch, xF, xR, xC, `+p+` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `+p+`, d2),
                  getW(wF, wR, wC, `+p+` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`+(g===3)+`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `+p+`),
                  getX(batch, xF, xR, xC, `+p+` + 1),
                  getX(batch, xF, xR, xC, `+p+` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `+p+`, d2),
                  getW(wF, wR, wC, `+p+` + 1, d2),
                  getW(wF, wR, wC, `+p+` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},kO=function(n,t,e,r){t===void 0&&(t=!1),e===void 0&&(e=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.outputShape=n.outShape;var o=n.inHeight,a=n.inWidth,i=n.padInfo.top,s=n.padInfo.left,u=n.strideHeight,l=n.strideWidth,c=n.dilationHeight,h=n.dilationWidth,d=n.filterHeight,p=n.filterWidth,g=n.outChannels/n.inChannels,x="",y="";e&&(x=r?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+e+`
        }`:`
          float activation(float x) {
            `+e+`
          }
        `,y="result = activation(result);");var b=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+x+`

      const ivec2 strides = ivec2(`+u+", "+l+`);
      const ivec2 pads = ivec2(`+i+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `+g+`;
        int q = d2 - d1 * `+g+`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `+d+`; wR++) {
          int xR = xRCorner + wR * `+c+`;

          if (xR < 0 || xR >= `+o+`) {
            continue;
          }

          for (int wC = 0; wC < `+p+`; wC++) {
            int xC = xCCorner + wC * `+h+`;

            if (xC < 0 || xC >= `+a+`) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        `+b+`
        `+y+`
        setOutput(result);
      }
    `},IO=function(n,t,e,r){t===void 0&&(t=!1),e===void 0&&(e=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.outShape;for(var o=n.inHeight,a=n.inWidth,i=n.padInfo.top,s=n.padInfo.left,u=n.strideHeight,l=n.strideWidth,c=n.dilationHeight,h=n.dilationWidth,d=n.filterHeight,p=n.filterWidth,g=p,x="int xR; int xC; int xCOffset;",y=0;y<d;y++)for(var b=0;b<p;b++)x+=`
          vec4 xTexelR`+y+"C"+2*b+` = vec4(0.);
          vec4 wR`+y+"C"+b+` = vec4(0.);
          vec4 xR`+y+"C"+b+" = vec4(0.);";for(y=0;y<d;y++)for(var C=0;C<g;C++){if(x+=`
          xR = xRCorner + `+y*c+`;
          xC = xCCorner + `+(b=2*C)*h+`;
        `,l===1){if(b<p&&(x+=s%2==1?`
                xCOffset = xC + 1;
                if(xR >= 0 && xR < `+o+" && xCOffset >= 0 && xCOffset < "+a+`) {
                  xTexelR`+y+"C"+b+` = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+a+`) {
                    xTexelR`+y+"C"+b+`.zw = vec2(0.);
                  }
                } else {
                  xTexelR`+y+"C"+b+` = vec4(0.);
                }

                xCOffset = xC + 1 - 2;
                if(xR >= 0 && xR < `+o+" && xCOffset >= 0 && xCOffset < "+a+`) {
                  vec4 previous = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+a+`) {
                    previous.zw = vec2(0.);
                  }

                  xR`+y+"C"+b+" = vec4(previous.zw, xTexelR"+y+"C"+b+`.xy);
                } else {
                  xR`+y+"C"+b+" = vec4(0, 0, xTexelR"+y+"C"+b+`.xy);
                }
              `:`
                if(xR >= 0 && xR < `+o+" && xC >= 0 && xC < "+a+`) {
                  xTexelR`+y+"C"+b+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+y+"C"+b+` = vec4(0.);
                }

                xR`+y+"C"+b+" = xTexelR"+y+"C"+b+`;
              `,b+1<p)){var E=s%2==0?IL(h):h;h%2==0&&s%2==1||h%2!=0&&s%2!=1?(x+=`
                  xCOffset = xC + `+s%2+" + "+E+`;

                  if(xR >= 0 && xR < `+o+` &&
                    xCOffset >= 0 && xCOffset < `+a+`) {
                    xTexelR`+y+"C"+(b+2)+` = getX(batch, xR, xCOffset, d1);
                  }
                `,h>1&&(x+=`
                    xCOffset -= 2;
                    if(xR >= 0 && xR < `+o+` &&
                      xCOffset >= 0 && xCOffset < `+a+`) {
                      xTexelR`+y+"C"+b+` = getX(batch, xR, xCOffset, d1);
                    } else {
                      xTexelR`+y+"C"+b+` = vec4(0.);
                    }
                  `),x+=`
                  xR`+y+"C"+(b+1)+` = vec4(
                    xTexelR`+y+"C"+b+".zw, xTexelR"+y+"C"+(b+2)+`.xy);
                `):x+=`
                  xCOffset = xC + `+E+`;

                  if(xR >= 0 && xR < `+o+` &&
                    xCOffset >= 0 && xCOffset < `+a+`) {
                    xTexelR`+y+"C"+(b+2)+` = getX(batch, xR, xCOffset, d1);
                  }

                  xR`+y+"C"+(b+1)+" = xTexelR"+y+"C"+(b+2)+`;
                `}}else b<p&&(x+=`
              if(xR >= 0 && xR < `+o+`) {
            `,s%2==1?(x+=`
                xCOffset = xC + 1 - `+l+`;
                if(xCOffset >= 0 && xCOffset < `+a+`) {
                  xTexelR`+y+"C"+b+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+y+"C"+b+` = vec4(0.);
                }

                if(xC + 1 >= 0 && xC + 1 < `+a+`) {
                  xTexelR`+y+"C"+(b+2)+` = getX(batch, xR, xC + 1, d1);
                } else {
                  xTexelR`+y+"C"+(b+2)+` = vec4(0.);
                }

                xR`+y+"C"+b+` = vec4(
                  xTexelR`+y+"C"+b+".zw, xTexelR"+y+"C"+(b+2)+`.zw);
              `,b+1<p&&(x+=`
                  vec4 final = vec4(0.);
                  xCOffset = xC + 1 + `+l+`;
                  if(xCOffset >= 0 && xCOffset < `+a+`) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xR`+y+"C"+(b+1)+" = vec4(xTexelR"+y+"C"+(b+2)+`.xy, final.xy);
                `)):(x+=`
                if(xC >= 0 && xC < `+a+`) {
                  xTexelR`+y+"C"+b+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+y+"C"+b+` = vec4(0.);
                }

                xCOffset = xC + `+l+`;
                if(xCOffset >= 0 && xCOffset < `+a+`) {
                  xTexelR`+y+"C"+(b+2)+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+y+"C"+(b+2)+` = vec4(0.);
                }

                xR`+y+"C"+b+` = vec4(
                  xTexelR`+y+"C"+b+".xy, xTexelR"+y+"C"+(b+2)+`.xy);
              `,b+1<p&&(x+=`
                  xR`+y+"C"+(b+1)+` = vec4(
                    xTexelR`+y+"C"+b+".zw, xTexelR"+y+"C"+(b+2)+`.zw);
                `)),x+="}");b<p&&(x+=`
            vec4 wTexelR`+y+"C"+b+" = getW("+y+", "+b+`, d1, q);
            wR`+y+"C"+b+" = vec4(wTexelR"+y+"C"+b+".xz, wTexelR"+y+"C"+b+`.xz);
          `,b+1<p&&(x+=`
              vec4 wTexelR`+y+"C"+(b+1)+" = getW("+y+", "+(b+1)+`, d1, q);
              wR`+y+"C"+(b+1)+` =
                vec4(wTexelR`+y+"C"+(b+1)+".xz, wTexelR"+y+"C"+(b+1)+".xz);"))}for(y=0;y<d;y++)for(b=0;b<p;b++)x+="dotProd += xR"+y+"C"+b+" * wR"+y+"C"+b+";";var S="",k="";e&&(S=r?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+e+`
        }`:`vec4 activation(vec4 x) {
          `+e+`
        }`,k="result = activation(result);");var R=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+S+`

      const ivec2 strides = ivec2(`+u+", "+l+`);
      const ivec2 pads = ivec2(`+i+", "+s+`);

      void main() {

        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2;
        int q = 0;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        vec4 dotProd = vec4(0.);

        `+x+`

        vec4 result = dotProd;
        `+R+`
        `+k+`
        setOutput(result);
      }
    `},Ust=function(n,t,e,r,o){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var a=n[0],i=n[1],s=n[2],u=n[3],l=t[0],c=e[0],h=e[1];this.outputShape=[l,c,h,u];var d=r==="bilinear"?1:0,p=[i-1+".0",s-1+".0"],g=p[0],x=p[1],y=c>1?[""+(i-1)/(c-1),"(y2-y1) * height_ratio","y1*"+g+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+g],b=y[0],C=y[1],E=y[2],S=h>1?[""+(s-1)/(h-1),"(x2-x1) * width_ratio","x1*"+x+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+x],k=S[0],R=S[1],A=S[2];this.userCode=`
      const float height_ratio = float(`+b+`);
      const float width_ratio = float(`+k+`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `+a+`) {
          return;
        }

        float height_scale = `+C+`;
        float width_scale = `+R+`;

        float in_y = `+E+`;
        if( in_y < 0.0 || in_y > `+g+` ) {
          setOutput(float(`+o+`));
          return;
        }
        float in_x = `+A+`;
        if( in_x < 0.0 || in_x > `+x+` ) {
          setOutput(float(`+o+`));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(`+d+` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `},Wst=function(n,t,e){this.variableNames=["x"],this.outputShape=n;var r=n.length,o=n[n.length-1],a=e?"<":">";this.userCode=`
      int getIndex(int i) {
        `+(e?"return "+o+" -i - 1;":"return i;")+`
      }

      void main() {
        `+_n(r)+` coords = getOutputCoords();
        int end = `+RO(r,"coords")+`;
        float val = 0.0;
        for (int i = `+o+` - 1; i >= 0; i -= 1) {
          int idx = getIndex(i);
          if (idx `+a+` end) {
            continue;
          }
          if (idx == end && `+t+`) {
            continue;
          }
          `+RO(r,"coords")+` = idx;
          val += getX(`+function(i,s){if(i===1)return""+s;if(i===2)return s+".x, "+s+".y";if(i===3)return s+".x, "+s+".y, "+s+".z";if(i===4)return s+".x, "+s+".y, "+s+".z, "+s+".w";throw Error("Cumulative sum for rank "+i+" is not yet supported")}(r,"coords")+`);
        }
        setOutput(val);
      }
    `};function RO(n,t){if(n===1)return""+t;if(n===2)return t+".y";if(n===3)return t+".z";if(n===4)return t+".w";throw Error("Cumulative sum for rank "+n+" is not yet supported")}var Vst=function(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=rm.DENSE;var t=Xp(n),e=go();this.outputShape=n,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+lc(["r","c","d"],n)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+t[0]+", "+t[1]+`));
        int index = 4 * (resTexRC.x * `+t[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        `+e.output+` = result;
      }
    `},Gst=function(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=rm.DENSE;var t=Xp(n),e=go();this.outputShape=n,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+lc(["r","c","d"],n)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+t[0]+", "+t[1]+`));
        int index = 4 * (resTexRC.x * `+t[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        `+e.output+` = result;
      }
    `},Hst=function(){function n(t,e,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=e,this.dataFormat=r,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `+this.getHeightCoordString()+`;
      int w = `+this.getWidthCoordString()+`;
      int d = `+this.getDepthCoordString()+`;

      int in_h = h / `+e+`;
      int offset_h = imod(h, `+e+`);
      int in_w = w / `+e+`;
      int offset_w = imod(w, `+e+`);
      int offset_d = (offset_h * `+e+` + offset_w) *
        `+this.getOutputDepthSize()+`;
      int in_d = d + offset_d;

      float result = `+this.getInputSamplingString()+`;
      setOutput(result);
    }
  `}return n.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},n.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},n.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},n.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},n.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},n}(),qst=function(n){this.variableNames=["X"],this.outputShape=[n,n],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `},jst=function(n){this.variableNames=["A"],this.outTexUsage=ma.DOWNLOAD;var t=go();this.outputShape=n,this.userCode=`
      `+pP+`

      void main() {
        float x = getAAtOutCoords();
        `+t.output+` = encode_float(x);
      }
    `},Xst=function(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=ma.DOWNLOAD;var t=go();this.outputShape=n,this.userCode=`
      `+pP+`

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        `+t.output+` = encode_float(x);
      }
    `},Kst=function(n,t,e){e===void 0&&(e=!1),this.variableNames=["A"];var r=go(),o=t[0],a=t[1];this.outputShape=n;var i="result";e&&(i="floor(result * 255. + 0.5)"),this.userCode=`
      `+Uk(n)+`

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex = idiv(flatIndex, 4, 1.);
        
        int r = flatIndex / `+a+`;
        int c = imod(flatIndex, `+a+`);
        vec2 uv = (vec2(c, r) + halfCR) / vec2(`+a+".0, "+o+`.0);
        vec4 values = `+r.texture2D+`(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        `+r.output+" = vec4("+i+`, 0., 0., 0.);
      }
    `},Yst=function(n,t,e){e===void 0&&(e=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var r=go(),o=t[0],a=t[1];this.outputShape=n;var i="",s="result";e&&(s="floor(result * 255. + 0.5)");for(var u=0;u<=1;u++)for(var l=0;l<=1;l++){var c=2*u+l;i+=`
          localCoords = coords;
          if(localCoords[2] + `+l+" < "+n[2]+`) {
            localCoords[2] += `+l+`;
            if(localCoords[1] + `+u+" < "+n[1]+`) {
              localCoords[1] += `+u+`;

              flatIndex = getFlatIndex(localCoords);
              offset = imod(flatIndex, 4);

              flatIndex = idiv(flatIndex, 4, 1.);

              r = flatIndex / `+a+`;
              c = imod(flatIndex, `+a+`);
              uv = (vec2(c, r) + halfCR) / vec2(`+a+".0, "+o+`.0);
              values = `+r.texture2D+`(A, uv);

              if(offset == 0) {
                result[`+c+`] = values[0];
              } else if(offset == 1) {
                result[`+c+`] = values[1];
              } else if(offset == 2) {
                result[`+c+`] = values[2];
              } else {
                result[`+c+`] = values[3];
              }
            }
          }
        `}this.userCode=`
      `+Uk(n)+`

      void main() {
        ivec3 coords = getOutputCoords();

        vec4 result = vec4(0.);
        int flatIndex, r, c, offset;
        ivec3 localCoords;
        vec2 uv;
        vec4 values;

        `+i+`

        `+r.output+" = "+s+`;
      }
    `},Qst="return real * expR - imag * expI;",Zst="return real * expI + imag * expR;",TO=function(n,t,e){this.variableNames=["real","imag"];var r=t[1];this.outputShape=t;var o=e?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,a=e?r+".0":"1.0";this.userCode=`
      const float exponentMultiplier = `+o+`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `+n+`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`+r+`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `+r+`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `+a+`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `},Jst=function(){function n(t,e){this.outputShape=[],this.variableNames=["x"],this.outputShape=t,this.userCode=`
      uniform float value;
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}return n.prototype.getCustomSetupFunc=function(t){var e=this;return function(r,o){e.valueLoc==null&&(e.valueLoc=r.getUniformLocationNoThrow(o,"value")),r.gl.uniform1f(e.valueLoc,t)}},n}(),tut=function(n,t,e){this.variableNames=["A","indices"];var r=n.slice();r[e]=t,this.outputShape=r,this.rank=r.length;var o=_n(this.rank),a=function(i,s){var u=i.length;if(u>4)throw Error("Gather for rank "+u+" is not yet supported");if(u===1)return"int(getIndices(resRC))";for(var l=["resRC.x","resRC.y","resRC.z","resRC.w"],c=[],h=0;h<i.length;h++)h===s?c.push("int(getIndices("+l[h]+"))"):c.push(""+l[h]);return c.join()}(n,e);this.userCode=`
      void main() {
        `+o+` resRC = getOutputCoords();
        setOutput(getA(`+a+`));
      }
    `},eut=function(n,t,e){this.sliceDim=n,this.strides=t,this.variableNames=["x","indices"],this.outputShape=e;var r=_n(t.length),o=_n(e.length),a=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        `+r+" strides = "+r+"("+this.strides+`);
         void main() {
          `+o+` coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < `+this.sliceDim+`; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * `+a+`;
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `};function nut(n,t){var e=go();return kat(n,t,e.version+`
    precision highp float;
    `+e.attribute+` vec3 clipSpacePos;
    `+e.attribute+` vec2 uv;
    `+e.varyingVs+` vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`)}function rut(n,t){return Aat(n,t,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function out(n,t){return _at(n,t,new Uint16Array([0,1,2,2,1,3]))}function zm(n,t,e,r,o,a,i){$at(e,r);var s=Dat(n,t),u=n.TEXTURE_2D;return oe(n,t,function(){return n.bindTexture(u,s)}),oe(n,t,function(){return n.texParameteri(u,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE)}),oe(n,t,function(){return n.texParameteri(u,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)}),oe(n,t,function(){return n.texParameteri(u,n.TEXTURE_MIN_FILTER,n.NEAREST)}),oe(n,t,function(){return n.texParameteri(u,n.TEXTURE_MAG_FILTER,n.NEAREST)}),oe(n,t,function(){return n.texImage2D(u,0,o,e,r,0,a,i,null)}),oe(n,t,function(){return n.bindTexture(n.TEXTURE_2D,null)}),s}function aut(n,t,e,r,o){var a=Zy(e,r);return zm(n,t,a[0],a[1],o.internalFormatFloat,o.textureFormatFloat,n.FLOAT)}function iut(n,t,e,r,o){var a=Zy(e,r);return zm(n,t,a[0],a[1],o.internalFormatHalfFloat,o.textureFormatFloat,o.textureTypeHalfFloat)}function sut(n,t,e,r,o){var a=Zy(e,r);return zm(n,t,a[0],a[1],n.RGBA,n.RGBA,n.UNSIGNED_BYTE)}function uut(n,t,e,r,o){var a=Bm(e,r);return zm(n,t,a[0],a[1],o.internalFormatPackedFloat,n.RGBA,n.FLOAT)}function lut(n,t,e,r,o){var a=Bm(e,r);return zm(n,t,a[0],a[1],o.internalFormatPackedHalfFloat,n.RGBA,o.textureTypeHalfFloat)}function cut(n,t,e,r){return oe(n,t,function(){return n.bindBuffer(n.ARRAY_BUFFER,r)}),mO(n,t,e,"clipSpacePos",r,3,20,0)&&mO(n,t,e,"uv",r,2,20,12)}function hut(n,t,e,r,o,a,i){var s,u,l;oe(n,t,function(){return n.bindTexture(n.TEXTURE_2D,e)}),a instanceof Uint8Array?(s=new Uint8Array(r*o*4),u=n.UNSIGNED_BYTE,l=n.RGBA):(s=new Float32Array(r*o*4),u=n.FLOAT,l=i.internalFormatPackedFloat),s.set(a),oe(n,t,function(){return n.texImage2D(n.TEXTURE_2D,0,l,r,o,0,n.RGBA,u,s)}),oe(n,t,function(){return n.bindTexture(n.TEXTURE_2D,null)})}function fut(n,t,e,r){oe(n,t,function(){return n.bindTexture(n.TEXTURE_2D,e)}),r.data instanceof Uint8Array?oe(n,t,function(){return n.texImage2D(n.TEXTURE_2D,0,n.RGBA,r.width,r.height,0,n.RGBA,n.UNSIGNED_BYTE,r.data)}):oe(n,t,function(){return n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,r)}),oe(n,t,function(){return n.bindTexture(n.TEXTURE_2D,null)})}function dut(n,t,e,r,o){var a=n.createBuffer();oe(n,t,function(){return n.bindBuffer(n.PIXEL_PACK_BUFFER,a)});var i=16*e*r;return oe(n,t,function(){return n.bufferData(n.PIXEL_PACK_BUFFER,i,n.STREAM_READ)}),oe(n,t,function(){return n.readPixels(0,0,r,e,n.RGBA,n.FLOAT,0)}),oe(n,t,function(){return n.bindBuffer(n.PIXEL_PACK_BUFFER,null)}),a}function put(n,t,e){var r=n,o=new Float32Array(e);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,o),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),o}function mut(n,t,e,r,o){var a=Zy(e,r),i=a[0],s=a[1],u=new Uint8Array(e*r*4);return oe(n,t,function(){return n.readPixels(0,0,i,s,o.downloadTextureFormat,n.UNSIGNED_BYTE,u)}),new Float32Array(u.buffer)}function gut(n,t,e,r,o,a,i,s){var u=n,l=new Float32Array(function(c,h){var d=Bm(c,h);return d[0]*d[1]*4}(a,i));return u.bindBuffer(u.PIXEL_PACK_BUFFER,t),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,l),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),l}function vut(n,t,e,r){var o=new Float32Array(e*r*4);return oe(n,t,function(){return n.readPixels(0,0,r,e,n.RGBA,n.FLOAT,o)}),o}var xut=function(){function n(t){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var e=Nt().getNumber("WEBGL_VERSION");t!=null?(this.gl=t,bat(e,t)):this.gl=ms(e);var r="WEBGL_color_buffer_float";if(Nt().getNumber("WEBGL_VERSION")===1){if(this.textureFloatExtension=$x(this.gl,this.debug,"OES_texture_float"),za(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=$x(this.gl,this.debug,"OES_texture_half_float");else if(Nt().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),za(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=$x(this.gl,this.debug,"EXT_color_buffer_half_float");else if(Nt().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",za(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else{if(!za(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=rut(this.gl,this.debug),this.indexBuffer=out(this.gl,this.debug),this.framebuffer=Oat(this.gl,this.debug),this.textureConfig=_k(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(n.prototype,"debug",{get:function(){return Nt().getBool("DEBUG")},enumerable:!0,configurable:!0}),n.prototype.dispose=function(){var t=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var e=this.gl;oe(e,this.debug,function(){return e.finish()}),oe(e,this.debug,function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)}),oe(e,this.debug,function(){return e.deleteFramebuffer(t.framebuffer)}),oe(e,this.debug,function(){return e.bindBuffer(e.ARRAY_BUFFER,null)}),oe(e,this.debug,function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}),oe(e,this.debug,function(){return e.deleteBuffer(t.indexBuffer)}),this.disposed=!0}},n.prototype.createFloat32MatrixTexture=function(t,e){return this.throwIfDisposed(),aut(this.gl,this.debug,t,e,this.textureConfig)},n.prototype.createFloat16MatrixTexture=function(t,e){return this.throwIfDisposed(),iut(this.gl,this.debug,t,e,this.textureConfig)},n.prototype.createUnsignedBytesMatrixTexture=function(t,e){return this.throwIfDisposed(),sut(this.gl,this.debug,t,e,this.textureConfig)},n.prototype.uploadPixelDataToTexture=function(t,e){this.throwIfDisposed(),fut(this.gl,this.debug,t,e)},n.prototype.uploadDenseMatrixToTexture=function(t,e,r,o){this.throwIfDisposed(),hut(this.gl,this.debug,t,e,r,o,this.textureConfig)},n.prototype.createFloat16PackedMatrixTexture=function(t,e){return this.throwIfDisposed(),lut(this.gl,this.debug,t,e,this.textureConfig)},n.prototype.createPackedMatrixTexture=function(t,e){return this.throwIfDisposed(),uut(this.gl,this.debug,t,e,this.textureConfig)},n.prototype.deleteMatrixTexture=function(t){var e=this;this.throwIfDisposed(),this.outputTexture===t&&(gO(this.gl,this.debug,this.framebuffer),this.outputTexture=null),oe(this.gl,this.debug,function(){return e.gl.deleteTexture(t)})},n.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(t,e,r){var o=this;return this.downloadMatrixDriver(t,function(){return mut(o.gl,o.debug,e,r,o.textureConfig)})},n.prototype.downloadPackedMatrixFromBuffer=function(t,e,r,o,a,i){return gut(this.gl,t,0,0,0,a,i,this.textureConfig)},n.prototype.downloadFloat32MatrixFromBuffer=function(t,e){return put(this.gl,t,e)},n.prototype.createBufferFromTexture=function(t,e,r){this.bindTextureToFrameBuffer(t);var o=dut(this.gl,this.debug,e,r,this.textureConfig);return this.unbindTextureToFrameBuffer(),o},n.prototype.createAndWaitForFence=function(){var t=this.createFence(this.gl);return this.pollFence(t)},n.prototype.createFence=function(t){var e,r,o=this;if(Nt().getBool("WEBGL_FENCE_API_ENABLED")){var a=t,i=a.fenceSync(a.SYNC_GPU_COMMANDS_COMPLETE,0);t.flush(),r=function(){var s=a.clientWaitSync(i,0,0);return s===a.ALREADY_SIGNALED||s===a.CONDITION_SATISFIED},e=i}else Nt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(e=this.beginQuery(),this.endQuery(),r=function(){return o.isQueryAvailable(e,Nt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):r=function(){return!0};return{query:e,isFencePassed:r}},n.prototype.downloadMatrixFromPackedTexture=function(t,e,r){var o=this;return this.downloadMatrixDriver(t,function(){return vut(o.gl,o.debug,e,r)})},n.prototype.createProgram=function(t){this.throwIfDisposed();var e=this.gl,r=Iat(e,this.debug,t),o=nut(e,this.debug),a=Tat(e,this.debug);return oe(e,this.debug,function(){return e.attachShader(a,o)}),oe(e,this.debug,function(){return e.attachShader(a,r)}),Nat(e,this.debug,a),this.debug&&LC(e,this.debug,a),this.vertexAttrsAreBound||(this.setProgram(a),this.vertexAttrsAreBound=cut(e,this.debug,this.program,this.vertexBuffer)),a},n.prototype.deleteProgram=function(t){var e=this;this.throwIfDisposed(),t===this.program&&(this.program=null),t!=null&&oe(this.gl,this.debug,function(){return e.gl.deleteProgram(t)})},n.prototype.setProgram=function(t){var e=this;this.throwIfDisposed(),this.program=t,this.program!=null&&this.debug&&LC(this.gl,this.debug,this.program),oe(this.gl,this.debug,function(){return e.gl.useProgram(t)})},n.prototype.getUniformLocation=function(t,e,r){return r===void 0&&(r=!0),this.throwIfDisposed(),r?Mat(this.gl,this.debug,t,e):Lat(this.gl,t,e)},n.prototype.getAttributeLocation=function(t,e){var r=this;return this.throwIfDisposed(),oe(this.gl,this.debug,function(){return r.gl.getAttribLocation(t,e)})},n.prototype.getUniformLocationNoThrow=function(t,e){return this.throwIfDisposed(),this.gl.getUniformLocation(t,e)},n.prototype.setInputMatrixTexture=function(t,e,r){this.throwIfDisposed(),this.throwIfNoProgram(),Pat(this.gl,this.debug,this.program,t,e,r)},n.prototype.setOutputMatrixTexture=function(t,e,r){this.setOutputMatrixTextureDriver(t,r,e)},n.prototype.setOutputPackedMatrixTexture=function(t,e,r){this.throwIfDisposed();var o=Bm(e,r),a=o[0],i=o[1];this.setOutputMatrixTextureDriver(t,a,i)},n.prototype.setOutputMatrixWriteRegion=function(t,e,r,o){this.setOutputMatrixWriteRegionDriver(r,t,o,e)},n.prototype.setOutputPackedMatrixWriteRegion=function(t,e,r,o){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},n.prototype.debugValidate=function(){this.program!=null&&LC(this.gl,this.debug,this.program),Ox(this.gl)},n.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var t=this.gl;this.debug&&this.debugValidate(),oe(t,this.debug,function(){return t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0)})},n.prototype.blockUntilAllProgramsCompleted=function(){var t=this;this.throwIfDisposed(),oe(this.gl,this.debug,function(){return t.gl.finish()})},n.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=$x(this.gl,this.debug,Nt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},n.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},n.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},n.prototype.beginQuery=function(){if(Nt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var t=this.gl,e=this.getQueryTimerExtensionWebGL2(),r=t.createQuery();return t.beginQuery(e.TIME_ELAPSED_EXT,r),r}var o=this.getQueryTimerExtensionWebGL1(),a=o.createQueryEXT();return o.beginQueryEXT(o.TIME_ELAPSED_EXT,a),a},n.prototype.endQuery=function(){if(Nt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")!==2){var t=this.getQueryTimerExtensionWebGL1();t.endQueryEXT(t.TIME_ELAPSED_EXT)}else{var e=this.gl,r=this.getQueryTimerExtensionWebGL2();e.endQuery(r.TIME_ELAPSED_EXT)}},n.prototype.waitForQueryAndGetTime=function(t){return Qt(this,void 0,void 0,function(){var e=this;return Zt(this,function(r){switch(r.label){case 0:return[4,cO(function(){return e.disposed||e.isQueryAvailable(t,Nt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return r.sent(),[2,this.getQueryTime(t,Nt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},n.prototype.getQueryTime=function(t,e){if(e===0)return null;if(e===2){var r=this.gl;return r.getQueryParameter(t,r.QUERY_RESULT)/1e6}var o=this.getQueryTimerExtensionWebGL1();return o.getQueryObjectEXT(t,o.QUERY_RESULT_EXT)/1e6},n.prototype.isQueryAvailable=function(t,e){if(e===0)return!0;if(e===2){var r=this.gl,o=this.getQueryTimerExtensionWebGL2(),a=r.getQueryParameter(t,r.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(o.GPU_DISJOINT_EXT)),a&&!this.disjoint}return a=(o=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(t,o.QUERY_RESULT_AVAILABLE_EXT),this.disjoint==null&&(this.disjoint=this.gl.getParameter(o.GPU_DISJOINT_EXT)),a&&!this.disjoint},n.prototype.pollFence=function(t){var e=this;return new Promise(function(r){e.addItemToPoll(function(){return t.isFencePassed()},function(){return r()})})},n.prototype.pollItems=function(){for(var t=function(r){for(var o=0;o<r.length&&r[o]();++o);return o-1}(this.itemsToPoll.map(function(r){return r.isDoneFn})),e=0;e<=t;++e)(0,this.itemsToPoll[e].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(t+1)},n.prototype.addItemToPoll=function(t,e){var r=this;this.itemsToPoll.push({isDoneFn:t,resolveFn:e}),this.itemsToPoll.length>1||cO(function(){return r.pollItems(),r.itemsToPoll.length===0})},n.prototype.bindTextureToFrameBuffer=function(t){this.throwIfDisposed(),PC(this.gl,this.debug,t,this.framebuffer),this.debug&&Ox(this.gl)},n.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(PC(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&Ox(this.gl)):gO(this.gl,this.debug,this.framebuffer)},n.prototype.downloadMatrixDriver=function(t,e){this.bindTextureToFrameBuffer(t);var r=e();return this.unbindTextureToFrameBuffer(),r},n.prototype.setOutputMatrixTextureDriver=function(t,e,r){this.throwIfDisposed();var o=this.gl;PC(o,this.debug,t,this.framebuffer),this.debug&&Ox(o),this.outputTexture=t,oe(o,this.debug,function(){return o.viewport(0,0,e,r)}),oe(o,this.debug,function(){return o.scissor(0,0,e,r)})},n.prototype.setOutputMatrixWriteRegionDriver=function(t,e,r,o){var a=this;this.throwIfDisposed(),oe(this.gl,this.debug,function(){return a.gl.scissor(t,e,r,o)})},n.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},n.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},n}();function NO(n,t){if(n.length!==t.length)throw Error("Binary was compiled with "+n.length+" inputs, but was executed with "+t.length+" inputs");n.forEach(function(e,r){var o=e.logicalShape,a=t[r],i=a.shape;if(!zr(o,i))throw Error("Binary was compiled with different shapes than the current args. Shapes "+o+" and "+i+" must match");if(!e.isUniform||!a.isUniform){var s=e.texShape,u=a.isUniform?null:a.texData.texShape;if(!zr(s,u))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+s+" and "+u+" must match")}})}var yut=function(n,t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;for(var r=e.filterWidth,o=e.inChannels,a=e.strideWidth,i=e.strideHeight,s=e.padInfo,u=e.outWidth,l=e.dilationWidth,c=e.dilationHeight,h=e.dataFormat,d=s.left,p=s.top,g=o*r,x=go(),y=h==="channelsLast",b=y?0:1,C=y?1:2,E="",S=0;S<=1;S++)for(var k=0;k<=1;k++)E+=`
          blockIndex = rc.y + `+k+`;
          pos = rc.x + `+S+`;

          if(blockIndex < `+n[1]+" && pos < "+n[0]+`) {
            offsetY = int(blockIndex / (`+u+")) * "+i+" - "+p+`;
            d0 = offsetY + `+c+" * (pos / "+g+`);

            if(d0 < `+t[b]+` && d0 >= 0) {

              offsetX = int(mod(float(blockIndex), `+u+".) * "+a+". - "+d+`.);
              d1 = offsetX + `+l+" * (int(mod(float(pos), "+g+".) / "+o+`.));

              if(d1 < `+t[C]+` && d1 >= 0) {

                ch = int(mod(float(pos), `+o+`.));

                if (`+y+`) {
                  innerDims = vec2(d1, ch);
                  result[`+(2*S+k)+`] = getChannel(
                    getA(d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[`+(2*S+k)+`] = getChannel(
                    getA(ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        `+E+`

        `+x.output+` = result;
      }
    `},but=function(n,t,e,r,o){this.variableNames=["x"],this.outputShape=[];var a,i=t,s=n[3]-1;this.outputShape=n;var u="float("+e+") + float("+r+") * sum";a=o===.5?"inversesqrt("+u+")":o===1?"1.0/("+u+")":"exp(log("+u+") * float(-"+o+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`+i+"; j <= "+i+`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `+s+`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `+a+`;
        setOutput(val);
      }
    `},wut=function(n,t,e,r,o){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=n,this.depth=n[3],this.depthRadius=t,this.bias=e,this.alpha=r,this.beta=o,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `+this.depth+`; ++d) {
          int depthBegin = int(max(0.0, float(d - `+t+`)));
          int depthEnd = int(min(float(`+this.depth+`),
              float(d + `+t+` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `+this.depth+`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`+r+") * norm + float("+e+`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`+r+`)
                * float(`+o+`)
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `+o+`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `},Cut=function(n,t,e,r,o){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var a,i=t,s=n[3]-1;this.outputShape=n;var u="float("+e+") + float("+r+") * sum";a=o===.5?"inversesqrt("+u+")":o===1?"1.0/("+u+")":"exp(log("+u+") * float(-"+o+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < `+this.outputShape[3]+`;
        bool hasNextRow = c < `+this.outputShape[2]+`;

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - `+i+`;
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - `+i+"; j <= "+i+`; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(`+s+`));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * `+a+`;
        setOutput(result);
      }
    `},Sut=function(n){this.variableNames=["dy","maxPos"],this.outputShape=n.inShape;var t=n.strideHeight,e=n.strideWidth,r=n.dilationHeight,o=n.effectiveFilterHeight,a=n.effectiveFilterWidth,i=o-1-n.padInfo.top,s=a-1-n.padInfo.left,u=o*a-1;this.userCode=`
      const ivec2 pads = ivec2(`+i+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+o+`;
          wR += `+r+`) {
          float dyR = float(dyRCorner + wR) / `+t+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+a+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+e+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `+u+` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `+a+` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `},Eut=function(n){this.variableNames=["dy","maxPos"],this.outputShape=n.inShape;var t=n.strideDepth,e=n.strideHeight,r=n.strideWidth,o=n.dilationDepth,a=n.dilationHeight,i=n.dilationWidth,s=n.effectiveFilterDepth,u=n.effectiveFilterHeight,l=n.effectiveFilterWidth,c=s-1-n.padInfo.front,h=u-1-n.padInfo.top,d=l-1-n.padInfo.left,p=s*u*l-1;this.userCode=`
      const ivec3 pads = ivec3(`+c+", "+h+", "+d+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+s+`;
           wD += `+o+`) {
          float dyD = float(dyDCorner + wD) / `+t+`.0;

          if (dyD < 0.0 || dyD >= `+n.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+u+`;
              wR += `+a+`) {
            float dyR = float(dyRCorner + wR) / `+e+`.0;

            if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+l+`;
                wC += `+i+`) {
              float dyC = float(dyCCorner + wC) / `+r+`.0;

              if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = `+p+` -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * `+u+" * "+l+` +
                  wR * `+l+` + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `},VC=function(n,t,e,r,o,a,i){e===void 0&&(e=!1),r===void 0&&(r=!1),o===void 0&&(o=!1),a===void 0&&(a=null),i===void 0&&(i=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;var s=e?n[1]:n[2],u=Math.ceil(s/2),l=e?"i * 2, rc.y":"rc.y, i * 2",c=r?"rc.z, i * 2":"i * 2, rc.z",h=e?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],d=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],p="",g="";a&&(p=i?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+a+`
        }`:`vec4 activation(vec4 x) {
          `+a+`
        }`,g="result = activation(result);");var x=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+p+`

      const float sharedDimension = `+u+`.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < `+u+`; i++) {
          vec4 a = getMatrixA(rc.x, `+l+`);
          vec4 b = getMatrixB(rc.x, `+c+`);

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (`+h[0]+" * "+d[0]+`);
          result += (`+h[1]+" * "+d[1]+`);
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        `+x+`

        `+g+`

        setOutput(result);
      }
    `},kut=function(){function n(t,e,r){this.variableNames=["probs"],this.outputShape=[t,r],this.userCode=`
      uniform float seed;

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `+(e-1)+`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`+(e-1)+`));
      }
    `}return n.prototype.getCustomSetupFunc=function(t){var e=this;return function(r,o){e.seedLoc==null&&(e.seedLoc=r.getUniformLocation(o,"seed")),r.gl.uniform1f(e.seedLoc,t)}},n}(),Iut=function(n,t,e,r){this.variableNames=["indices"],this.outputShape=[n,t],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`+r+"), float("+e+`),
                      float(index == coords.y)));
      }
    `},Rut=function(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=n;var t=n.length;if(t===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var e=Wo("rc",t),r=_n(t),o=function(s,u,l){if(s===1)return"rc > "+u[0];for(var c="",h=s-2;h<s;h++)c+=l[h]+" >= "+u[h],h<s-1&&(c+="||");return c}(t,n,e),a=function(s,u,l,c){if(s===1)return"";var h=c.slice(-2);return`
    int r = `+h[0]+`;
    int c = `+h[1]+`;
    int rp1 = r + 1;
    int cp1 = c + 1;

    bool cEdge = cp1 >= `+u+`;
    bool rEdge = rp1 >= `+l+`;
  `}(t,n[n.length-1],n[n.length-2],e),i=function(s,u){var l=s.length,c=function(h,d){for(var p=[],g=0;g<=1;g++)for(var x=0;x<=1;x++){for(var y=(g===0?"r":"rp1")+", "+(x===0?"c":"cp1"),b=2;b<h;b++)y=d[d.length-1-b]+","+y;p.push(y)}return p}(l,u);return l===1?`getA(rc),
            rc + 1 >= `+s[0]+` ? 0. : getA(rc + 1),
            0, 0`:"getA("+c[0]+`),
          cEdge ? 0. : getA(`+c[1]+`),
          rEdge ? 0. : getA(`+c[2]+`),
          rEdge || cEdge ? 0. : getA(`+c[3]+")"}(n,e);this.userCode=`
        void main() {
          `+r+` rc = getOutputCoords();

          if(`+o+`) {
            setOutput(vec4(0));
          } else {
            `+a+`

            setOutput(vec4(`+i+`));
          }
        }
      `}},Tut=function(n,t,e){this.variableNames=["x"],this.outputShape=t.map(function(u,l){return u[0]+n[l]+u[1]});var r=n.length,o=_n(r),a=t.map(function(u){return u[0]}).join(","),i=t.map(function(u,l){return u[0]+n[l]}).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=r!==1?`
      `+o+" start = "+o+"("+a+`);
      `+o+" end = "+o+"("+i+`);

      void main() {
        `+o+` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(float(`+e+`));
        } else {
          `+o+` coords = outC - start;
          setOutput(getX(`+s+`));
        }
      }
    `:`
        int start = `+a+`;
        int end = `+i+`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(float(`+e+`));
          } else {
            setOutput(getX(outC - start));
          }
        }
      `},Nut=function(n,t,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map(function(y,b){return y[0]+n[b]+y[1]});for(var r=n.length,o=_n(r),a=t.map(function(y){return y[0]}).join(","),i=t.map(function(y,b){return y[0]+n[b]}).join(","),s=Wo("rc",r),u=Wo("source",r),l=s[r-1]+" < "+this.outputShape[r-1],c=r===1?"source":"vec2("+u.slice(-2).join()+")",h=[o+" rc = outputLoc;",s[r-1]+` += 1;
       if(`+l+`) {
      `,r===1?"":`}
       rc = outputLoc;
       `+s[r-2]+` += 1;
       if(`+s[r-2]+" < "+this.outputShape[r-2]+") {",r===1?"":"  "+s[r-1]+` += 1;
         if(`+l+") {"],d=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",p="",g=0,x=r===1?2:4;g<x;g++)p+=`
        `+h[g]+`
        if (`+d+`) {
          result[`+g+"] = float("+e+`);
        } else {
          `+o+` source = rc - start;
          result[`+g+"] = getChannel(getX("+u.join()+"), "+c+`);
        }
      `;p+=r===1?"} ":"}}",this.userCode=`
      const `+o+" start = "+o+"("+a+`);
      const `+o+" end = "+o+"("+i+`);

      void main() {
        `+o+` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `+p+`
        setOutput(result);
      }
    `},Yp=function(n,t,e,r,o){if(r===void 0&&(r=!1),o===void 0&&(o=!1),this.variableNames=["x"],t==="avg"&&e)throw new Error("Cannot compute positions for average pool.");var a=n.filterWidth,i=n.strideHeight,s=n.strideWidth,u=n.dilationHeight,l=n.dilationWidth,c=n.effectiveFilterHeight,h=n.effectiveFilterWidth,d=n.padInfo.top,p=n.padInfo.left;this.outputShape=n.outShape;var g=t==="avg",x="((batch  * "+n.inHeight+" + xR) * "+n.inWidth+" + xC) * "+n.inChannels+" + d",y="(xR * "+n.inWidth+" + xC) * "+n.inChannels+" + d",b="0.0";if(g||(b="-1.0 / 1e-20"),e)this.userCode=`
        const ivec2 strides = ivec2(`+i+", "+s+`);
        const ivec2 pads = ivec2(`+d+", "+p+`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `+c+`;
              wR += `+u+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+h+`;
                wC += `+l+`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = `+(r?o?x:y:"wR * "+h+" + wC")+`;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var C=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="avg"&&(C="avgValue / count");var E=4*Math.floor(a/4),S=a%4,k=`
      if (`+g+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(`+i+", "+s+`);
      const ivec2 pads = ivec2(`+d+", "+p+`);
      const float initializationValue = `+b+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `+n.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+b+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `+c+`;
            wR += `+u+`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `+n.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+E+`; wC += 4) {
            int xC = xCCorner + wC * `+l+`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+l+`, d),
              getValue(batch, xR, xC + 2 * `+l+`, d),
              getValue(batch, xR, xC + 3 * `+l+`, d)
            );

            `+k+`
          }

          int xC = xCCorner + `+E+`;
          if (`+(S===1)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `+k+`
          } else if (`+(S===2)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+l+`, d),
              initializationValue,
              initializationValue
            );

            `+k+`
          } else if (`+(S===3)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+l+`, d),
              getValue(batch, xR, xC + 2 * `+l+`, d),
              initializationValue
            );

            `+k+`
          }
        }
        setOutput(`+C+`);
      }
    `}},GC=function(n,t,e,r,o){if(r===void 0&&(r=!1),o===void 0&&(o=!1),this.variableNames=["x"],t==="avg"&&e)throw new Error("Cannot compute positions for average pool.");var a=n.filterWidth,i=n.strideDepth,s=n.strideHeight,u=n.strideWidth,l=n.dilationDepth,c=n.dilationHeight,h=n.dilationWidth,d=n.effectiveFilterDepth,p=n.effectiveFilterHeight,g=n.effectiveFilterWidth,x=n.padInfo.front,y=n.padInfo.top,b=n.padInfo.left;this.outputShape=n.outShape;var C=t==="avg",E="0.0";if(C||(E="-1.0 / 1e-20"),e)this.userCode=`
        const ivec3 strides =
            ivec3(`+i+", "+s+", "+u+`);
        const ivec3 pads = ivec3(`+x+", "+y+", "+b+`);

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < `+d+`;
              wD += `+l+`) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= `+n.inDepth+`) {
              continue;
            }

            for (int wR = 0; wR < `+p+`;
                wR += `+c+`) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= `+n.inHeight+`) {
                continue;
              }

              for (int wC = 0; wC < `+g+`;
                  wC += `+h+`) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= `+n.inWidth+`) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value >= currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = `+(r?o?"(((batch * "+n.inDepth+" + xD) * "+n.inHeight+" + xR) * "+n.inWidth+" + xC) * "+n.inChannels+" + ch":"((xD * "+n.inHeight+" + xR) * "+n.inWidth+" + xC) * "+n.inChannels+" + ch":"wD * "+p+" * "+g+` +
                      wR * `+g+" + wC")+`;
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var S=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="avg"&&(S="avgValue / count");var k=4*Math.floor(a/4),R=a%4,A=`
      if (`+C+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(`+i+", "+s+", "+u+`);
      const ivec3 pads = ivec3(`+x+", "+y+", "+b+`);
      const float initializationValue = `+E+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= `+n.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+E+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < `+d+`;
            wD += `+l+`) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= `+n.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+p+`;
            wR += `+c+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+k+`; wC += 4) {
              int xC = xCCorner + wC * `+h+`;

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+h+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+h+`, ch),
                getValue(batch, xD, xR, xC + 3 * `+h+`, ch)
              );

              `+A+`
            }

            int xC = xCCorner + `+k+`;
            if (`+(R===1)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              `+A+`
            } else if (`+(R===2)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+h+`, ch),
                initializationValue,
                initializationValue
              );

              `+A+`
            } else if (`+(R===3)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+h+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+h+`, ch),
                initializationValue
              );

              `+A+`
            }
          }
          setOutput(`+S+`);
        }
      }
    `}},Aut=function(n,t){this.variableNames=["x"];var e=n.windowSize,r=n.batchSize,o=n.inSize,a=Math.ceil(o/e);this.outputShape=[r,a];var i="0.0",s="";t==="prod"?i="1.0":t==="min"?(i="1.0 / 1e-20",s="min"):t==="max"&&(i="-1.0 / 1e-20",s="max");var u=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="sum"?u="sumValue":t==="prod"?u="prodValue":t==="all"?u="allValue":t==="any"&&(u="anyValue");var l=4*Math.floor(e/4),c=e%4,h=`
      if (`+(t==="sum")+`) {
        sumValue += dot(values, ones);
      } else if (`+(t==="prod")+`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `+s+`(values, minMaxValue);
      }
    `,d="vec4";t==="all"?(i="1.0",h=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,d="bvec4"):t==="any"&&(i="0.0",h=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,d="bvec4");var p="";o%e>0&&(p=`
        if (inIdx < 0 || inIdx >= `+o+`) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = `+i+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `+p+`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+e+`;

        vec4 minMaxValue = vec4(`+i+`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `+l+`; i += 4) {
          int inIdx = inOffset + i;
          `+d+" values = "+d+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `+h+`
        }

        int inIdx = inOffset + `+l+`;
        if (`+(c===1)+`) {
          `+d+" values = "+d+`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `+h+`
        } else if (`+(c===2)+`) {
          `+d+" values = "+d+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `+h+`
        } else if (`+(c===3)+`) {
          `+d+" values = "+d+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `+h+`
        }
        setOutput(`+u+`);
      }
    `},_ut=function(n,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;for(var e="",r=0;r<4;r++){var o="thisRC = rc;";r%2==1&&(o+="thisRC.z += 1;"),r>1&&(o+="thisRC.y += 1;"),e+=`
        `+o+`
        `+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`+r+`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `+(r>0?"}":"")+`
      `}this.userCode=`
      
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `+lc(["r","c","d"],t)+`
      return ivec3(r, c, d);
    }
  
      `+Uk(n)+`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `+n[1]+`;
        int cols = `+n[2]+`;

        `+e+`

        setOutput(result);
      }
    `},Dut=function(n,t,e){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,o=r[1],a=r[2],i=n.shape,s=i[1],u=i[2],l=[e&&s>1?o-1:o,e&&u>1?a-1:a],c=[e&&s>1?s-1:s,e&&u>1?u-1:u],h=l[0]/c[0],d=l[1]/c[1],p=1/h,g=1/d,x=2*Math.ceil(p)+2,y=2*Math.ceil(g)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+h+`);
        const float widthScale = float(`+d+`);

        const float invHeightScale = float(`+p+`);
        const float invWidthScale = float(`+g+`);

        const int winHeight = int(`+x+`);
        const int winWidth = int(`+y+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+s+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+u+`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `+(o-1)+`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `+(a-1)+`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},$ut=function(n,t,e,r){this.variableNames=["A"],this.outputShape=[];var o=n[0],a=n[1],i=n[2],s=n[3];this.outputShape=[o,t,e,s];var u=[r&&t>1?a-1:a,r&&e>1?i-1:i],l=[r&&t>1?t-1:t,r&&e>1?e-1:e];this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+u[0]/l[0]+`,
          `+u[1]/l[1]+`);
      const vec2 inputShapeRC = vec2(`+a+".0, "+i+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `},Out=function(n,t,e,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=n[0],a=n[1],i=n[2],s=n[3];this.outputShape=[o,t,e,s];var u=[r&&t>1?a-1:a,r&&e>1?i-1:i],l=[r&&t>1?t-1:t,r&&e>1?e-1:e];this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `+u[0]/l[0]+`,
          `+u[1]/l[1]+`,
          `+u[1]/l[1]+`);
      const vec3 inputShapeRC = vec3(`+a+".0, "+i+`.0,
                                     `+i+`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `+(s-1)+`;
        bool hasNextRow = coords.z < `+(e-1)+`;

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `},Fut=function(n,t,e){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,o=r[1],a=r[2],i=n.shape,s=i[1],u=i[2],l=[e&&s>1?o-1:o,e&&u>1?a-1:a],c=[e&&s>1?s-1:s,e&&u>1?u-1:u],h=l[0]/c[0],d=l[1]/c[1],p=1/h,g=1/d,x=2*Math.ceil(p)+2,y=2*Math.ceil(g)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+h+`);
        const float widthScale = float(`+d+`);

        const float invHeightScale = float(`+p+`);
        const float invWidthScale = float(`+g+`);

        const int winHeight = int(`+x+`);
        const int winWidth = int(`+y+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+s+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+u+`) {
              continue;
            }

            float sourceFracRow =
              float(`+l[0]+`) *
                (float(dyR) / float(`+c[0]+`));

            float sourceFracCol =
                float(`+l[1]+`) *
                  (float(dyC) / float(`+c[1]+`));

            int sourceNearestRow = int(min(
                float(int(`+o+`) - 1),
                `+e+` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`+a+`) - 1),
                `+e+` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},Mut=function(n,t,e,r){this.variableNames=["A"],this.outputShape=[];var o=n[0],a=n[1],i=n[2],s=n[3];this.outputShape=[o,t,e,s];var u=[r&&t>1?a-1:a,r&&e>1?i-1:i],l=[r&&t>1?t-1:t,r&&e>1?e-1:e],c=r?"0.5":"0.0";this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+u[0]/l[0]+`,
          `+u[1]/l[1]+`);
      const vec2 inputShapeRC = vec2(`+a+".0, "+i+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `+c+`)));

        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `},Lut=function(n,t){this.variableNames=["x"];var e=n.length;if(e>4)throw new Error("WebGL backend: Reverse of rank-"+e+" tensor is not yet supported");if(this.outputShape=n,e!==1){var r=n.map(function(a,i){return function(s){return t.indexOf(s)!==-1&&n[s]!==1?n[s]+" - coords["+s+"] - 1":"coords["+s+"]"}(i)}).join(","),o=_n(e);this.userCode=`
      void main() {
        `+o+` coords = getOutputCoords();
        setOutput(getX(`+r+`));
      }
    `}else this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`+n[0]+` - coord - 1));
        }
      `},Put=function(n,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var e=n.length;if(e>4)throw new Error("WebGL backend: Reverse of rank-"+e+" tensor is not yet supported");this.outputShape=n;var r=Wo("rc",e),o=r[e-1]+" + 1 < "+this.outputShape[e-1],a=r[e-2]+" + 1 < "+this.outputShape[e-2],i=_n(e);function s(u){var l=n.map(function(c,h){return function(d,p){return t.indexOf(d)!==-1&&n[d]!==1?n[d]+" - "+p[d]+" - 1":""+p[d]}(h,u)});return"getChannel(getX("+l.join(",")+"), vec2("+l.slice(-2).join(",")+"))"}this.userCode=e===1?`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(`+n[0]+` - rc - 1),
            `+n[0]+` - rc - 1);
          if(`+o+`){
              result.g = getChannel(getX(`+n[0]+` - (rc  + 1) - 1),
                `+n[0]+` - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:`
        void main() {
          `+i+` rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = `+function(u){return s(u)}(r.slice())+`;
          if(`+o+`){
            result.g = `+function(u){return u[e-1]="("+u[e-1]+" + 1)",s(u)}(r.slice())+`;
          }
          if(`+a+`) {
            result.b = `+function(u){return u[e-2]="("+u[e-2]+" + 1)",s(u)}(r.slice())+`;
            if(`+o+`) {
              result.a = `+function(u){return u[e-1]="("+u[e-1]+" + 1)",u[e-2]="("+u[e-2]+" + 1)",s(u)}(r.slice())+`;
            }
          }
          setOutput(result);
        }
    `},AO=function(n,t,e,r,o,a,i){this.variableNames=["updates","indices","defaultValue"],this.outputShape=a;var s=_n(o.length),u=_n(a.length),l="";e===1?l="i":e===2&&(l="i, j");var c="getIndices("+l+")",h="";r===1?h="i":r===2&&(h="i, coords[1]");var d="getUpdates("+h+")",p=t>1?"strides[j]":"strides";this.userCode=`
        `+s+" strides = "+s+"("+o+`);

        void main() {
          `+u+` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `+n+`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `+t+`; j++) {
              int index = round(`+c+`);
              flattenedIndex += index * `+p+`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `+d+`;
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `},But=function(n,t){this.variableNames=["x","segmentIds"];var e=n.windowSize,r=n.batchSize,o=n.inSize,a=n.numSegments,i=a*Math.ceil(o/e);this.outputShape=[r,i];var s=4*Math.floor(e/4),u=e%4,l=`
        sumValue += dot(values, segFilter);
    `,c="";o%e>0&&(c=`
        if (inIdx < 0 || inIdx >= `+o+`) {
          return initializationValue;
        }
      `);var h="";o%e>0&&(h=`
        if (inIdx < 0 || inIdx >= `+o+`) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = 0.0;

      float getValue(int batch, int inIdx) {
        `+c+`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `+h+`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `+a+")) * float("+e+`));
        int currentSeg = int(mod(float(outIdx), float(`+a+`)));

        float sumValue = 0.0;

        for (int i = 0; i < `+s+`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `+l+`
        }

        int inIdx = inOffset + `+s+`;
        if (`+(u===1)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `+l+`
        } else if (`+(u===2)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `+l+`
        } else if (`+(u===3)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `+l+`
        }
        setOutput(sumValue);
      }
    `},zut=function(n,t,e){var r,o;if(this.variableNames=["c","a","b"],this.outputShape=t,e>4)throw Error("Where for rank "+e+" is not yet supported");if(e===1)o="resRC",r="resRC";else{for(var a=["resRC.x","resRC.y","resRC.z","resRC.w"],i=[],s=[],u=0;u<t.length;u++)s.push(""+a[u]),u<n&&i.push(""+a[u]);r=i.join(),o=s.join()}var l=_n(e);this.userCode=`
      void main() {
        `+l+` resRC = getOutputCoords();
        float cVal = getC(`+r+`);
        if (cVal >= 1.0) {
          setOutput(getA(`+o+`));
        } else {
          setOutput(getB(`+o+`));
        }
      }
    `},Uut=function(){function n(t){this.variableNames=["source"],this.outputShape=t,this.rank=t.length;var e,r=_n(this.rank),o="uniform int start["+this.rank+"];",a=function(i){if(i===1)return"sourceLoc";if(i<=6)return HC.slice(0,i).map(function(s){return"sourceLoc."+s}).join(",");throw Error("Slicing for rank "+i+" is not yet supported")}(this.rank);e=`
        `+r+` sourceLoc;
        `+r+` coords = getOutputCoords();
        `+t.map(function(i,s){return"sourceLoc."+HC[s]+" = start["+s+"] + coords."+HC[s]+";"}).join(`
`)+`
      `,this.userCode=`
      `+o+`
      void main() {
        `+e+`
        setOutput(getSource(`+a+`));
      }
    `}return n.prototype.getCustomSetupFunc=function(t){var e=this;if(t.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+t.length+")");return function(r,o){e.startLoc==null&&(e.startLoc=r.getUniformLocationNoThrow(o,"start"),e.startLoc==null)||r.gl.uniform1iv(e.startLoc,t)}},n}(),HC=["x","y","z","w","u","v"],Wut=function(){function n(t){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length;var e=_n(this.rank),r=Wo("coords",this.rank),o=Wo("sourceLoc",this.rank),a=this.rank===1?"sourceLoc":"vec2("+o.slice(-2).join()+")",i="getChannel(getSource("+o.join()+"), "+a+")",s=`
      result.x = `+i+`;
      if (++`+r[this.rank-1]+" < "+t[this.rank-1]+`) {
        ++`+o[this.rank-1]+`;
        result.y = `+i+`;
        --`+o[this.rank-1]+`;
      }
    `,u=this.rank===1?"":`
      --`+r[this.rank-1]+`;
      if (++`+r[this.rank-2]+" < "+t[this.rank-2]+`) {
        ++`+o[this.rank-2]+`;
        result.z = `+i+`;
        if (++`+r[this.rank-1]+" < "+t[this.rank-1]+`) {
          ++`+o[this.rank-1]+`;
          result.w = `+i+`;
        }
      }
    `,l=this.rank<=4?`sourceLoc = coords +
            `+e+"("+t.map(function(c,h){return"start["+h+"]"}).join()+");":t.map(function(c,h){return o[h]+" = "+r[h]+" + start["+h+"];"}).join(`
`);this.userCode=`
      uniform int start[`+this.rank+`];
      void main() {
        `+e+` coords = getOutputCoords();
        `+e+` sourceLoc;
        `+l+`
        vec4 result = vec4(0.);
        `+s+`
        `+u+`
        setOutput(result);
      }
    `}return n.prototype.getCustomSetupFunc=function(t){var e=this;if(t.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+t.length+")");return function(r,o){e.startLoc==null&&(e.startLoc=r.getUniformLocationNoThrow(o,"start"),e.startLoc==null)||r.gl.uniform1iv(e.startLoc,t)}},n}(),Vut=function(n,t,e){this.variableNames=["x"],this.outputShape=e;var r=e.length,o=_n(e.length),a=_n(e.length),i="";if(r===1)i="coords * strides + begin";else{var s=0;i=e.map(function(u,l){return s++,e.length===1?"coords * strides["+l+"] + begin["+l+"]":"coords["+(s-1)+"] * strides["+l+"] + begin["+l+"]"}).join(",")}this.userCode=`
      `+o+" begin = "+o+"("+n+`);
      `+o+" strides = "+o+"("+t+`);

      void main() {
        `+a+` coords = getOutputCoords();
        setOutput(getX(`+i+`));
      }
    `},Gut=function(){function n(t){this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return n.prototype.acquireTexture=function(t,e,r){var o,a=_O(e,r),i=DO(t,a,r);if(i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]),this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var s=this.freeTextures[i].shift();return this.usedTextures[i].push(s),s}return this.numUsedTextures++,this.log(),a===ha.PACKED_2X2_FLOAT32?o=this.gpgpu.createPackedMatrixTexture(t[0],t[1]):a===ha.PACKED_2X2_FLOAT16?o=this.gpgpu.createFloat16PackedMatrixTexture(t[0],t[1]):a===ha.UNPACKED_FLOAT32?o=this.gpgpu.createFloat32MatrixTexture(t[0],t[1]):a===ha.UNPACKED_FLOAT16?o=this.gpgpu.createFloat16MatrixTexture(t[0],t[1]):a===ha.PACKED_4X1_UNSIGNED_BYTE&&(o=this.gpgpu.createUnsignedBytesMatrixTexture(t[0],t[1])),this.usedTextures[i].push(o),o},n.prototype.releaseTexture=function(t,e,r,o){if(this.freeTextures!=null){var a=DO(e,_O(r,o),o);a in this.freeTextures||(this.freeTextures[a]=[]),this.freeTextures[a].push(t),this.numFreeTextures++,this.numUsedTextures--;var i=this.usedTextures[a],s=i.indexOf(t);if(s<0)throw new Error("Cannot release a texture that was never provided by this texture manager");i.splice(s,1),this.log()}},n.prototype.log=function(){if(this.logEnabled){var t=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+t+")")}},n.prototype.getNumUsedTextures=function(){return this.numUsedTextures},n.prototype.getNumFreeTextures=function(){return this.numFreeTextures},n.prototype.dispose=function(){var t=this;if(this.freeTextures!=null){for(var e in this.freeTextures)this.freeTextures[e].forEach(function(r){t.gpgpu.deleteMatrixTexture(r)});for(var e in this.usedTextures)this.usedTextures[e].forEach(function(o){t.gpgpu.deleteMatrixTexture(o)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},n}();function _O(n,t){if(n===ma.UPLOAD)return ha.PACKED_2X2_FLOAT32;if(n===ma.RENDER||n==null)return function(e){return Nt().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?ha.PACKED_2X2_FLOAT32:ha.UNPACKED_FLOAT32:e?ha.PACKED_2X2_FLOAT16:ha.UNPACKED_FLOAT16}(t);if(n===ma.DOWNLOAD||n===ma.PIXELS)return ha.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+n)}function DO(n,t,e){return n[0]+"_"+n[1]+"_"+t+"_"+e}var Hut=function(n,t){this.variableNames=["A"];for(var e=new Array(n.length),r=0;r<e.length;r++)e[r]=n[r]*t[r];this.outputShape=e,this.rank=e.length;var o=_n(this.rank),a=function(i){var s=i.length;if(s>5)throw Error("Tile for rank "+s+" is not yet supported");if(s===1)return"imod(resRC, "+i[0]+")";for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],l=[],c=0;c<i.length;c++)l.push("imod("+u[c]+", "+i[c]+")");return l.join()}(n);this.userCode=`
      void main() {
        `+o+` resRC = getOutputCoords();
        setOutput(getA(`+a+`));
      }
    `},Wk=1.7580993408473768,Vk=1.0507009873554805,Te=function(n,t){this.variableNames=["A"],this.outputShape=n,this.userCode=`
      float unaryOperation(float x) {
        `+t+`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `},Ci="if (isnan(x)) return x;",qut="return x;",$O="return abs(x);",xP=Ci+`
  return (x < 0.0) ? 0.0 : x;
`,yP=Ci+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,bP="return (x >= 0.0) ? x : (exp(x) - 1.0);",jut=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = `+Wk+`;
  float scale = `+Vk+`;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,OO="return -x;",FO="return ceil(x);",MO="return floor(x);",LO="return exp(x);",PO="return exp(x) - 1.0;",Xut=Ci+`
  return sin(x);
`,Kut=Ci+`
  return cos(x);
`,Yut=Ci+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,Qut=Ci+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,Zut=Ci+`
  return atan(x);
`,Jut=Ci+"return log(x + sqrt(x * x + 1.0));",tlt=Ci+`
  if (x < 1.0) return NAN;
  return log(x + sqrt(x * x - 1.0));`,elt=Ci+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
  return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,Px="return x;",nlt="return x;",wP=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,CP=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,SP=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,Dp=function(n,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.userCode=`
      vec4 unaryOperation(vec4 x) {
        `+t+`
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `},rlt=function(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=n;var t=n.length,e=Wo("rc",t),r=_n(t),o=function(s,u){if(s===1)return"rc";for(var l="",c=0;c<s;c++)l+=u[c],c<s-1&&(l+=",");return l}(t,e),a=e.slice(-2),i=t<=1?"rc":"vec2("+a.join(",")+")";this.userCode=`
      void main() {
        `+r+` rc = getOutputCoords();
        vec4 packedInput = getA(`+o+`);

        setOutput(getChannel(packedInput, `+i+`));
      }
    `},Bx={};function zx(n,t){if(t===void 0&&(t=!1),n==="linear")return t?nlt:qut;if(n==="relu")return t?wP:xP;if(n==="elu")return t?SP:bP;if(n==="relu6")return t?CP:yP;if(n==="prelu")return t?vP:gP;throw new Error("Activation "+n+" has not been implemented for the WebGL backend.")}var olt=600,alt=function(n){function t(e){var r,o=n.call(this)||this;if(o.pendingRead=new WeakMap,o.pendingDisposal=new WeakSet,o.dataRefCount=new WeakMap,o.numBytesInGPU=0,o.uploadWaitMs=0,o.downloadWaitMs=0,o.warnedAboutMemory=!1,o.pendingDeletes=0,o.disposed=!1,!Nt().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(e==null){var a=ms(Nt().getNumber("WEBGL_VERSION"));o.binaryCache=((r=Nt().getNumber("WEBGL_VERSION"))in Bx||(Bx[r]={}),Bx[r]),o.gpgpu=new xut(a),o.canvas=a.canvas,o.gpgpuCreatedLocally=!0}else o.gpgpu=e,o.binaryCache={},o.gpgpuCreatedLocally=!1,o.canvas=e.gl.canvas;return o.textureManager=new Gut(o.gpgpu),o.numMBBeforeWarning=Nt().global.screen==null?1024:Nt().global.screen.height*Nt().global.screen.width*window.devicePixelRatio*olt/1024/1024,o.texData=new oP(o,st),o}return wi(t,n),t.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},t.prototype.write=function(e,r,o){if(Nt().getBool("DEBUG")&&this.checkNumericalProblems(e),o==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var a={};return this.texData.set(a,{shape:r,dtype:o,values:e,usage:ma.UPLOAD}),a},t.prototype.move=function(e,r,o,a){if(Nt().getBool("DEBUG")&&this.checkNumericalProblems(r),a==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:o,dtype:a,values:r,usage:ma.UPLOAD})},t.prototype.readSync=function(e){var r=this.texData.get(e),o=r.values,a=r.dtype,i=r.complexTensors,s=r.slice,u=r.shape,l=r.isPacked;if(s!=null){var c=void 0;c=l?new Dp(u,Px):new Te(u,Px);var h=this.runWebGLProgram(c,[{dataId:e,shape:u,dtype:a}],a),d=this.readSync(h.dataId);return this.disposeData(h.dataId),d}if(o!=null)return this.convertAndCacheOnCPU(e);if(a==="string")return o;var p,g,x=this.activeTimers!=null;return x&&(p=Li()),a==="complex64"?g=lE(i.real.dataSync(),i.imag.dataSync()):g=this.getValuesFromTexture(e),x&&(this.downloadWaitMs+=Li()-p),this.convertAndCacheOnCPU(e,g)},t.prototype.read=function(e){return Qt(this,void 0,void 0,function(){var r,o,a,i,s,u,l,c,h,d,p,g,x,y,b,C,E,S,k,R,A,N;return Zt(this,function(_){switch(_.label){case 0:if(this.pendingRead.has(e))return r=this.pendingRead.get(e),[2,new Promise(function($){return r.push($)})];if(o=this.texData.get(e),a=o.values,i=o.shape,s=o.slice,u=o.dtype,l=o.complexTensors,c=o.isPacked,s!=null)return h=void 0,h=c?new Dp(i,Px):new Te(i,Px),d=this.runWebGLProgram(h,[{dataId:e,shape:i,dtype:u}],u),p=this.read(d.dataId),this.disposeData(d.dataId),[2,p];if(a!=null)return[2,this.convertAndCacheOnCPU(e)];if(!Nt().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&Nt().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return g=null,u!=="complex64"&&Nt().get("WEBGL_BUFFER_SUPPORTED")&&(x=this.decode(e),y=this.texData.get(x.dataId),g=(N=this.gpgpu).createBufferFromTexture.apply(N,[y.texture].concat(Xp(i)))),this.pendingRead.set(e,[]),u==="complex64"?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:_.sent(),_.label=2;case 2:return u!=="complex64"?[3,4]:[4,Promise.all([l.real.data(),l.imag.data()])];case 3:return C=_.sent(),E=C[0],S=C[1],b=lE(E,S),[3,5];case 4:g==null?b=this.getValuesFromTexture(e):(k=Yt(i),b=this.gpgpu.downloadFloat32MatrixFromBuffer(g,k)),_.label=5;case 5:return x!=null&&this.disposeData(x.dataId),R=this.convertAndCacheOnCPU(e,b),A=this.pendingRead.get(e),this.pendingRead.delete(e),A.forEach(function($){return $(R)}),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e),this.pendingDeletes--),[2,R]}})})},t.prototype.checkNumericalProblems=function(e){if(e!=null)for(var r=0;r<e.length;r++){var o=e[r];if(!Sat(o))throw Nt().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value "+o+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value "+o+" cannot be represented on this device.")}},t.prototype.getValuesFromTexture=function(e){var r,o=this.texData.get(e),a=o.shape,i=o.dtype,s=o.isPacked,u=Yt(a);if(Nt().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var l=this.decode(e),c=this.texData.get(l.dataId),h=(r=this.gpgpu).downloadMatrixFromPackedTexture.apply(r,[c.texture].concat(Xp(a))).subarray(0,u);return this.disposeData(l.dataId),h}var d=Nt().getBool("WEBGL_PACK")&&s===!0,p=d?BC(a):a,g=d?new Xst(p):new jst(p),x=this.runWebGLProgram(g,[{shape:p,dtype:i,dataId:e}],"float32"),y=this.texData.get(x.dataId),b=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(y.texture,y.texShape[0],y.texShape[1]).subarray(0,u);return this.disposeData(x.dataId),b},t.prototype.time=function(e){return Qt(this,void 0,void 0,function(){var r,o,a,i,s,u,l;return Zt(this,function(c){switch(c.label){case 0:return r=this.activeTimers,o=[],a=!1,this.programTimersStack==null?(this.programTimersStack=o,a=!0):this.activeTimers.push(o),this.activeTimers=o,e(),i=Mf(this.activeTimers.map(function(h){return h.query})).filter(function(h){return h!=null}),s=Mf(this.activeTimers.map(function(h){return h.name})).filter(function(h){return h!=null}),this.activeTimers=r,a&&(this.programTimersStack=null),u={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},Nt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(i)]:[3,2];case 1:return l=c.sent(),u.kernelMs=oat(l),u.getExtraProfileInfo=function(){return l.map(function(h,d){return{name:s[d],ms:h}}).map(function(h){return h.name+": "+h.ms}).join(", ")},[3,3];case 2:u.kernelMs={error:"WebGL query timers are not supported in this environment."},c.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,u]}})})},t.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},t.prototype.startTimer=function(){return Nt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Li(),endMs:null}},t.prototype.endTimer=function(e){return Nt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=Li(),e)},t.prototype.getQueryTime=function(e){return Qt(this,void 0,void 0,function(){var r;return Zt(this,function(o){return Nt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(e)]:[2,(r=e).endMs-r.startMs]})})},t.prototype.disposeData=function(e){if(!this.pendingDisposal.has(e)){if(this.pendingRead.has(e))return this.pendingDisposal.add(e),void this.pendingDeletes++;if(this.texData.has(e)){this.releaseGPUData(e);var r=this.texData.get(e).complexTensors;r!=null&&(r.real.dispose(),r.imag.dispose()),this.texData.delete(e)}}},t.prototype.releaseGPUData=function(e){var r=this.texData.get(e),o=r.texture,a=r.dtype,i=r.texShape,s=r.usage,u=r.isPacked,l=r.slice,c=l&&l.origDataId||e,h=this.dataRefCount.get(c);h>1?this.dataRefCount.set(c,h-1):(this.dataRefCount.delete(c),o!=null&&(this.numBytesInGPU-=this.computeBytes(i,a),this.textureManager.releaseTexture(o,i,s,u)));var d=this.texData.get(e);d.texture=null,d.texShape=null,d.isPacked=!1,d.slice=null},t.prototype.getTexture=function(e){return this.uploadToGPU(e),this.texData.get(e).texture},t.prototype.getDataInfo=function(e){return this.texData.get(e)},t.prototype.getCPUBackend=function(){return Nt().getBool("WEBGL_CPU_FORWARD")?(this.cpuBackend==null&&(this.cpuBackend=st.findBackend("cpu")),this.cpuBackend):null},t.prototype.shouldExecuteOnCPU=function(e,r){var o=this;return r===void 0&&(r=128),this.getCPUBackend()!=null&&e.every(function(a){return o.texData.get(a.dataId).texture==null&&Yt(a.shape)<r})},t.prototype.getGPGPUContext=function(){return this.gpgpu},t.prototype.complex=function(e,r){var o=this.makeOutput(e.shape,"complex64");return this.texData.get(o.dataId).complexTensors={real:st.keep(e.clone()),imag:st.keep(r.clone())},o},t.prototype.real=function(e){return this.texData.get(e.dataId).complexTensors.real.clone()},t.prototype.imag=function(e){return this.texData.get(e.dataId).complexTensors.imag.clone()},t.prototype.slice=function(e,r,o){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.slice(e,r,o);if(Yt(o)===0)return Qr([],o,e.dtype);var a=this.texData.get(e.dataId).isPacked,i=nP(e.shape,r,o);if(a||!i){var s=Nt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Wut(o):new Uut(o),u=s.getCustomSetupFunc(r);return this.compileAndRun(s,[e],null,u)}return this.uploadToGPU(e.dataId),this.shallowSlice(e,r,o)},t.prototype.shallowSlice=function(e,r,o){var a=this.texData.get(e.dataId),i=this.makeOutput(o,e.dtype),s=this.texData.get(i.dataId);Object.assign(s,a),s.shape=o,s.dtype=e.dtype;var u=rP(r,e.strides);a.slice&&(u+=a.slice.flatOffset),s.slice={flatOffset:u,origDataId:a.slice&&a.slice.origDataId||e.dataId};var l=this.dataRefCount.get(s.slice.origDataId)||1;return this.dataRefCount.set(s.slice.origDataId,l+1),i},t.prototype.stridedSlice=function(e,r,o,a){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.stridedSlice(e,r,o,a);var i=Mk(r,o,a);if(i.some(function(u){return u===0}))return Qr([],i);var s=new Vut(r,a,i);return this.compileAndRun(s,[e])},t.prototype.reverse=function(e,r){var o=Nt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Put(e.shape,r):new Lut(e.shape,r);return this.compileAndRun(o,[e])},t.prototype.concat=function(e,r){if(e[0].dtype==="complex64"){var o=e.map(function(p){return Pa(p)}),a=e.map(function(p){return Vi(p)});return Kr(this.concat(o,r),this.concat(a,r))}if(this.shouldExecuteOnCPU(e))return this.cpuBackend.concat(e,r);if(e.length===1)return e[0];if(e.length>Nt().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var i=Math.floor(e.length/2),s=this.concat(e.slice(0,i),r),u=this.concat(e.slice(i),r);return this.concat([s,u],r)}if(Nt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&e[0].rank>1){var l=new $st(e.map(function(p){return p.shape}),r);return this.compileAndRun(l,e)}var c=Bf(e.map(function(p){return p.shape}),r),h=e.map(function(p){return p.as2D(-1,Yt(p.shape.slice(r)))}),d=new Dst(h.map(function(p){return p.shape}));return this.compileAndRun(d,h).reshape(c)},t.prototype.neg=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.neg(e);if(Nt().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,OO,e.dtype);var r=new Te(e.shape,OO);return this.compileAndRun(r,[e])},t.prototype.batchMatMul=function(e,r,o,a){var i=o?e.shape[2]:e.shape[1],s=a?r.shape[1]:r.shape[2],u=o?e.shape[1]:e.shape[2],l=e.shape[0];if((i===1||s===1)&&u>1e3){o&&(e=ai(e,[0,2,1])),a&&(r=ai(r,[0,2,1]));var c=s===1?e:e.as3D(l,u,1),h=s===1?2:1,d=s===1?r.as3D(l,1,u):r;return this.multiply(c,d).sum(h,!0)}var p=Yr(e.dtype,r.dtype),g=new VC(e.shape,[l,i,s],o,a);return this.compileAndRun(g,[e,r],p)},t.prototype.fusedBatchMatMul=function(e){var r=e.a,o=e.b,a=e.transposeA,i=e.transposeB,s=e.bias,u=e.activation,l=e.preluActivationWeights,c=a?r.shape[2]:r.shape[1],h=i?o.shape[1]:o.shape[2],d=r.shape[0],p=Yr(r.dtype,o.dtype),g=s!=null,x=l!=null,y=u?zx(u,!0):null,b=new VC(r.shape,[d,c,h],a,i,g,y,x),C=[r,o];return s&&C.push(s),l&&C.push(l),this.compileAndRun(b,C,p)},t.prototype.multiply=function(e,r){if(e.dtype==="complex64"){var o=this.texData.get(e.dataId),a=this.texData.get(r.dataId),i=new CO(kst,e.shape,r.shape),s=new CO(Ist,e.shape,r.shape),u=[this.makeComplexComponentTensorInfo(e,o.complexTensors.real),this.makeComplexComponentTensorInfo(e,o.complexTensors.imag),this.makeComplexComponentTensorInfo(r,a.complexTensors.real),this.makeComplexComponentTensorInfo(r,a.complexTensors.imag)],l=this.compileAndRun(i,u),c=this.compileAndRun(s,u),h=this.complex(l,c);return l.dispose(),c.dispose(),h}if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.multiply(e,r);if(Nt().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,SO,e.dtype);var d=new Xn(SO,e.shape,r.shape);return this.compileAndRun(d,[e,r],e.dtype)},t.prototype.batchNormalization=function(e,r,o,a,i,s){var u=[e,r,o],l=null;s!=null&&(l=s.shape,u.push(s));var c=null;if(i!=null&&(c=i.shape,u.push(i)),Nt().getBool("WEBGL_PACK_NORMALIZATION")){var h=new Est(e.shape,r.shape,o.shape,l,c,a);return this.compileAndRun(h,u)}var d=new Sst(e.shape,r.shape,o.shape,l,c,a);return this.compileAndRun(d,u)},t.prototype.localResponseNormalization4D=function(e,r,o,a,i){var s=Nt().getBool("WEBGL_PACK_NORMALIZATION")?new Cut(e.shape,r,o,a,i):new but(e.shape,r,o,a,i);return this.compileAndRun(s,[e])},t.prototype.LRNGrad=function(e,r,o,a,i,s,u){var l=new wut(r.shape,a,i,s,u);return this.compileAndRun(l,[r,o,e])},t.prototype.tile=function(e,r){if(e.dtype==="string"){var o=this.readSync(e.dataId).map(function(i){return Y0(i)});return hP(Ce(e.shape,e.dtype,o),r)}var a=new Hut(e.shape,r);return this.compileAndRun(a,[e])},t.prototype.pad=function(e,r,o){var a=Nt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Nut(e.shape,r,o):new Tut(e.shape,r,o);return this.compileAndRun(a,[e])},t.prototype.gather=function(e,r,o){if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.gather(e,r,o);var a=new tut(e.shape,r.size,o);return this.compileAndRun(a,[e,r])},t.prototype.batchToSpaceND=function(e,r,o){X(e.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var a=r.reduce(function(h,d){return h*d}),i=ny(e.shape,r,a),s=ry(i.length,r.length),u=oy(e.shape,r,a),l=VL(o,r.length),c=GL(u,o,r.length);return ai(e.reshape(i),s).reshape(u).slice(l,c)},t.prototype.spaceToBatchND=function(e,r,o){X(e.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var a=r.reduce(function(d,p){return d*p}),i=[[0,0]];i.push.apply(i,o);for(var s=1+r.length;s<e.shape.length;++s)i.push([0,0]);var u=e.pad(i),l=ny(u.shape,r,a,!1),c=ry(l.length,r.length,!1),h=oy(u.shape,r,a,!1);return ai(u.reshape(l),c).reshape(h)},t.prototype.reduce=function(e,r,o){var a=e.shape[0],i=e.shape[1],s=zC(i),u=new Aut({windowSize:s,inSize:i,batchSize:a},r),l=this.compileAndRun(u,[e],o);return l.shape[1]===1?l:this.reduce(l,r,o)},t.prototype.argReduce=function(e,r,o){o===void 0&&(o=null);var a=e.shape[0],i=e.shape[1];o!=null&&(a=o.shape[0],i=o.shape[1]);var s=zC(i),u=new pst({windowSize:s,inSize:i,batchSize:a},r,o==null),l=[e];o!=null&&l.push(o);var c=this.compileAndRun(u,l,"int32");return c.shape[1]===1?c:this.argReduce(e,r,c)},t.prototype.argReducePacked=function(e,r,o){o===void 0&&(o=null);var a=o!=null?o.shape:e.shape,i=zC(a[a.length-1]),s=new bst(a,i,r,o==null),u=o==null?[e]:[e,o],l=this.compileAndRun(s,u,"int32");return l.rank===e.rank?this.argReducePacked(e,r,l):l},t.prototype.sum=function(e,r){ca("sum",r,e.rank);var o=ho(e.shape,r),a=o[0],i=Yt(o[1]),s=e.as2D(-1,i),u=DC(e.dtype);return this.reduce(s,"sum",u).reshape(a)},t.prototype.prod=function(e,r){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.prod(e,r);var o=ho(e.shape,r),a=o[0],i=Yt(o[1]),s=e.as2D(-1,i),u=DC(e.dtype);return this.reduce(s,"prod",u).reshape(a)},t.prototype.unsortedSegmentSum=function(e,r,o){var a=0,i=gs([a],e.rank),s=e;i!=null&&(s=ai(e,i),a=vs(1,e.rank)[0]);var u=function(p,g,x){for(var y=[],b=p.length,C=0;C<b;C++)C!==g?y.push(p[C]):y.push(x);return y}(s.shape,a,o),l=Yt([s.shape[a]]),c=s.as2D(-1,l),h=DC(e.dtype),d=this.segOpCompute(c,"unsortedSegmentSum",r,h,o).reshape(u);return i!=null&&(d=ai(d,Dk(i))),d},t.prototype.segOpCompute=function(e,r,o,a,i){var s=e.shape[0],u=e.shape[1],l=function(d,p){var g,x=!1;for(d<=eP?(g=d,x=!0):g=tE(d,Math.floor(Math.sqrt(d)));!x;)g>p||g===d?x=!0:g=tE(d,g+1);return g}(u,i),c=new But({windowSize:l,inSize:u,batchSize:s,numSegments:i}),h=this.compileAndRun(c,[e,o],a);return h.shape[1]===i?h:(o=ey(0,i).tile([u/l]),this.segOpCompute(h,r,o,a,i))},t.prototype.argMinMaxReduce=function(e,r,o){var a=[r];if(ca("arg"+o.charAt(0).toUpperCase()+o.slice(1),a,e.rank),!Nt().getBool("WEBGL_PACK_REDUCE")||e.rank<=2){var i=ho(e.shape,a),s=i[0],u=Yt(i[1]),l=e.as2D(-1,u);return this.argReduce(l,o).reshape(s)}return this.argReducePacked(e,o)},t.prototype.argMin=function(e,r){return this.argMinMaxReduce(e,r,"min")},t.prototype.argMax=function(e,r){return this.argMinMaxReduce(e,r,"max")},t.prototype.cumsum=function(e,r,o,a){if(r!==e.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(e.rank-1)+" but got axis="+r);var i=new Wst(e.shape,o,a);return this.compileAndRun(i,[e])},t.prototype.equal=function(e,r){if(Nt().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,`
  return vec4(equal(a, b));
`,"bool");var o=new Xn("return float(a == b);",e.shape,r.shape);return this.compileAndRun(o,[e,r],"bool")},t.prototype.notEqual=function(e,r){if(Nt().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,`
  return vec4(notEqual(a, b));
`,"bool");var o=new Xn("return float(a != b);",e.shape,r.shape);return this.compileAndRun(o,[e,r],"bool")},t.prototype.less=function(e,r){if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.less(e,r);if(Nt().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,`
  return vec4(lessThan(a, b));
`,"bool");var o=new Xn("return float(a < b);",e.shape,r.shape);return this.compileAndRun(o,[e,r],"bool")},t.prototype.lessEqual=function(e,r){if(Nt().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,`
  return vec4(lessThanEqual(a, b));
`,"bool");var o=new Xn("return float(a <= b);",e.shape,r.shape);return this.compileAndRun(o,[e,r],"bool")},t.prototype.greater=function(e,r){if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.greater(e,r);if(Nt().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,`
  return vec4(greaterThan(a, b));
`,"bool");var o=new Xn("return float(a > b);",e.shape,r.shape);return this.compileAndRun(o,[e,r],"bool")},t.prototype.greaterEqual=function(e,r){if(Nt().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,`
  return vec4(greaterThanEqual(a, b));
`,"bool");var o=new Xn("return float(a >= b);",e.shape,r.shape);return this.compileAndRun(o,[e,r],"bool")},t.prototype.logicalNot=function(e){var r=new Te(e.shape,"return float(!(x >= 1.0));");return this.compileAndRun(r,[e])},t.prototype.logicalAnd=function(e,r){if(Nt().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,"bool");var o=new Xn("return float(a >= 1.0 && b >= 1.0);",e.shape,r.shape);return this.compileAndRun(o,[e,r],"bool")},t.prototype.logicalOr=function(e,r){if(Nt().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,"bool");var o=new Xn("return float(a >= 1.0 || b >= 1.0);",e.shape,r.shape);return this.compileAndRun(o,[e,r],"bool")},t.prototype.select=function(e,r,o){var a=new zut(e.rank,r.shape,r.rank);return this.compileAndRun(a,[e,r,o],Yr(r.dtype,o.dtype))},t.prototype.where=function(e){J0("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var r=e.dataSync();return zk(e.shape,r)},t.prototype.topk=function(e,r,o){return fP(e.dataSync(),e.shape,e.dtype,r)},t.prototype.min=function(e,r){ca("min",r,e.rank);var o=ho(e.shape,r),a=o[0],i=Yt(o[1]),s=e.as2D(-1,i);return this.reduce(s,"min",s.dtype).reshape(a)},t.prototype.minimum=function(e,r){if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.minimum(e,r);var o=Nt().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new $i(`
  vec4 result = vec4(min(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,e.shape,r.shape):new Xn(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return min(a, b);
`,e.shape,r.shape);return this.compileAndRun(o,[e,r])},t.prototype.mod=function(e,r){var o=Nt().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new $i(`
  vec4 result = mod(a, b);
  vec4 isNaN = vec4(equal(b, vec4(0.0)));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,e.shape,r.shape):new Xn(`if (b == 0.0) return NAN;
  return mod(a, b);`,e.shape,r.shape);return this.compileAndRun(o,[e,r])},t.prototype.max=function(e,r){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.max(e,r);ca("max",r,e.rank);var o=ho(e.shape,r),a=o[0],i=Yt(o[1]),s=e.as2D(-1,i);return this.reduce(s,"max",s.dtype).reshape(a)},t.prototype.maximum=function(e,r){if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.maximum(e,r);var o=Nt().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new $i(`
  vec4 result = vec4(max(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,e.shape,r.shape):new Xn(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return max(a, b);
`,e.shape,r.shape);return this.compileAndRun(o,[e,r])},t.prototype.all=function(e,r){ca("all",r,e.rank);var o=ho(e.shape,r),a=o[0],i=Yt(o[1]),s=e.as2D(-1,i);return this.reduce(s,"all",s.dtype).reshape(a)},t.prototype.any=function(e,r){ca("any",r,e.rank);var o=ho(e.shape,r),a=o[0],i=Yt(o[1]),s=e.as2D(-1,i);return this.reduce(s,"any",s.dtype).reshape(a)},t.prototype.floorDiv=function(e,r){if(Nt().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,"int32");var o=new Xn(`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,e.shape,r.shape);return this.compileAndRun(o,[e,r],"int32")},t.prototype.add=function(e,r){if(e.dtype==="complex64"&&r.dtype==="complex64")return this.complexSeparableBinaryOp(e,r,UC);if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.add(e,r);var o=Yr(e.dtype,r.dtype);if(Nt().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,UC,o);var a=new Xn(UC,e.shape,r.shape);return this.compileAndRun(a,[e,r],o)},t.prototype.packedUnaryOp=function(e,r,o){var a=new Dp(e.shape,r);return this.compileAndRun(a,[e],o)},t.prototype.packedBinaryOp=function(e,r,o,a,i){i===void 0&&(i=!1);var s=new $i(o,e.shape,r.shape,i);return this.compileAndRun(s,[e,r],a)},t.prototype.complexSeparableBinaryOp=function(e,r,o){var a=this,i=this.texData.get(e.dataId),s=this.texData.get(r.dataId),u=[[i.complexTensors.real,s.complexTensors.real],[i.complexTensors.imag,s.complexTensors.imag]].map(function(d){var p=d[0],g=d[1],x=a.makeComplexComponentTensorInfo(e,p),y=a.makeComplexComponentTensorInfo(r,g),b=new Xn(o,e.shape,r.shape);return a.compileAndRun(b,[x,y],Yr(p.dtype,g.dtype))}),l=u[0],c=u[1],h=this.complex(l,c);return l.dispose(),c.dispose(),h},t.prototype.makeComplexComponentTensorInfo=function(e,r){return{dataId:r.dataId,dtype:r.dtype,shape:e.shape}},t.prototype.addN=function(e){if(e.length===1)return e[0];if(e.length>Nt().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var r=Math.floor(e.length/2),o=this.addN(e.slice(0,r)),a=this.addN(e.slice(r));return this.addN([o,a])}var i=e.map(function(l){return l.dtype}).reduce(function(l,c){return Yr(l,c)}),s=e.map(function(l){return l.shape}),u=Nt().getBool("WEBGL_PACK")?new dst(e[0].shape,s):new fst(e[0].shape,s);return this.compileAndRun(u,e,i)},t.prototype.subtract=function(e,r){if(e.dtype==="complex64"&&r.dtype==="complex64")return this.complexSeparableBinaryOp(e,r,WC);if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.subtract(e,r);var o=Yr(e.dtype,r.dtype);if(Nt().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,WC,e.dtype);var a=new Xn(WC,e.shape,r.shape);return this.compileAndRun(a,[e,r],o)},t.prototype.pow=function(e,r){var o=Nt().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new $i(`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,e.shape,r.shape):new Xn(`
if(a < 0.0 && floor(b) < b){
  return NAN;
}
if (b == 0.0) {
  return 1.0;
}
return (round(mod(b, 2.0)) != 1) ?
    pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,e.shape,r.shape),a=Yr(e.dtype,r.dtype);return this.compileAndRun(o,[e,r],a)},t.prototype.ceil=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.ceil(e);if(Nt().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,FO,e.dtype);var r=new Te(e.shape,FO);return this.compileAndRun(r,[e])},t.prototype.floor=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.floor(e);if(Nt().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,MO,e.dtype);var r=new Te(e.shape,MO);return this.compileAndRun(r,[e])},t.prototype.sign=function(e){var r=new Te(e.shape,`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`);return this.compileAndRun(r,[e])},t.prototype.isNaN=function(e){var r=new Te(e.shape,"return float(isnan(x));");return this.compileAndRun(r,[e],"bool")},t.prototype.isInf=function(e){var r=new Te(e.shape,"return float(isinf(x));");return this.compileAndRun(r,[e],"bool")},t.prototype.isFinite=function(e){var r=new Te(e.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(r,[e],"bool")},t.prototype.round=function(e){var r=new Te(e.shape,`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`);return this.compileAndRun(r,[e])},t.prototype.exp=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.exp(e);if(Nt().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,LO,e.dtype);var r=new Te(e.shape,LO);return this.compileAndRun(r,[e])},t.prototype.expm1=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.expm1(e);if(Nt().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,PO,e.dtype);var r=new Te(e.shape,PO);return this.compileAndRun(r,[e])},t.prototype.softmax=function(e,r){var o=_r([r],e.shape),a=this.max(e,o),i=Ko(a.shape,o),s=this.subtract(e,a.reshape(i)),u=this.exp(s),l=this.sum(u,o).reshape(i);return al(u,l)},t.prototype.log=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.log(e);if(Nt().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,`
  vec4 result = log(x);
  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));
  result.r = isNaN.r == 1.0 ? NAN : result.r;
  result.g = isNaN.g == 1.0 ? NAN : result.g;
  result.b = isNaN.b == 1.0 ? NAN : result.b;
  result.a = isNaN.a == 1.0 ? NAN : result.a;

  return result;
`,e.dtype);var r=new Te(e.shape,`if (x < 0.0) return NAN;
  return log(x);`);return this.compileAndRun(r,[e])},t.prototype.log1p=function(e){var r=new Te(e.shape,"return log(1.0 + x);");return this.compileAndRun(r,[e])},t.prototype.sqrt=function(e){var r=new Te(e.shape,"return sqrt(x);");return this.compileAndRun(r,[e])},t.prototype.rsqrt=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.rsqrt(e);var r=new Te(e.shape,"return inversesqrt(x);");return this.compileAndRun(r,[e])},t.prototype.reciprocal=function(e){var r=new Te(e.shape,"return 1.0 / x;");return this.compileAndRun(r,[e])},t.prototype.relu=function(e){var r;return r=Nt().getBool("WEBGL_PACK")?new Dp(e.shape,wP):new Te(e.shape,xP),this.compileAndRun(r,[e])},t.prototype.relu6=function(e){var r;return r=Nt().getBool("WEBGL_PACK")?new Dp(e.shape,CP):new Te(e.shape,yP),this.compileAndRun(r,[e])},t.prototype.prelu=function(e,r){var o=Nt().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new $i(vP,e.shape,r.shape):new Xn(gP,e.shape,r.shape);return this.compileAndRun(o,[e,r])},t.prototype.elu=function(e){if(Nt().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,SP,e.dtype);var r=new Te(e.shape,bP);return this.compileAndRun(r,[e])},t.prototype.eluDer=function(e,r){var o=Nt().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new $i(`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,e.shape,r.shape):new Xn("return (b >= 1.0) ? a : a * (b + 1.0);",e.shape,r.shape);return this.compileAndRun(o,[e,r])},t.prototype.selu=function(e){var r=new Te(e.shape,jut);return this.compileAndRun(r,[e])},t.prototype.int=function(e){var r=new Te(e.shape,"return float(int(x));");return this.compileAndRun(r,[e],"int32")},t.prototype.clip=function(e,r,o){var a,i=(a=Nt().getBool("WEBGL_PACK_CLIP")?new Ast(e.shape):new Nst(e.shape)).getCustomSetupFunc(r,o);return this.compileAndRun(a,[e],null,i)},t.prototype.abs=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.abs(e);if(Nt().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,$O,e.dtype);var r=new Te(e.shape,$O);return this.compileAndRun(r,[e])},t.prototype.complexAbs=function(e){var r=this.texData.get(e.dataId),o=new _st(e.shape),a=[this.makeComplexComponentTensorInfo(e,r.complexTensors.real),this.makeComplexComponentTensorInfo(e,r.complexTensors.imag)];return this.compileAndRun(o,a)},t.prototype.sigmoid=function(e){var r=new Te(e.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(r,[e])},t.prototype.softplus=function(e){var r=new Te(e.shape,`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`);return this.compileAndRun(r,[e])},t.prototype.sin=function(e){var r=new Te(e.shape,Xut);return this.compileAndRun(r,[e])},t.prototype.cos=function(e){var r=new Te(e.shape,Kut);return this.compileAndRun(r,[e])},t.prototype.tan=function(e){var r=new Te(e.shape,"return tan(x);");return this.compileAndRun(r,[e])},t.prototype.asin=function(e){var r=new Te(e.shape,Yut);return this.compileAndRun(r,[e])},t.prototype.acos=function(e){var r=new Te(e.shape,Qut);return this.compileAndRun(r,[e])},t.prototype.atan=function(e){var r=new Te(e.shape,Zut);return this.compileAndRun(r,[e])},t.prototype.atan2=function(e,r){var o=Nt().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new $i(`
  vec4 result = atan(a, b);
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,e.shape,r.shape):new Xn(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return atan(a, b);
`,e.shape,r.shape);return this.compileAndRun(o,[e,r])},t.prototype.sinh=function(e){var r=new Te(e.shape,`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`);return this.compileAndRun(r,[e])},t.prototype.cosh=function(e){var r=new Te(e.shape,`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`);return this.compileAndRun(r,[e])},t.prototype.tanh=function(e){var r=new Te(e.shape,`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`);return this.compileAndRun(r,[e])},t.prototype.asinh=function(e){var r=new Te(e.shape,Jut);return this.compileAndRun(r,[e])},t.prototype.acosh=function(e){var r=new Te(e.shape,tlt);return this.compileAndRun(r,[e])},t.prototype.atanh=function(e){var r=new Te(e.shape,elt);return this.compileAndRun(r,[e])},t.prototype.erf=function(e){var r=new Te(e.shape,`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = 0.3275911;
  float a1 = 0.254829592;
  float a2 = -0.284496736;
  float a3 = 1.421413741;
  float a4 = -1.453152027;
  float a5 = 1.061405429;

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`);return this.compileAndRun(r,[e])},t.prototype.step=function(e,r){var o=new Te(e.shape,function(a){return a===void 0&&(a=0),Ci+`
    return x > 0.0 ? 1.0 : float(`+a+`);
  `}(r));return this.compileAndRun(o,[e])},t.prototype.conv2dByMatMul=function(e,r,o,a,i,s){var u=e.shape,l=this.texData.get(e.dataId),c=o.inChannels,h=u[0]*u[1]*u[2],d=o.outChannels,p=o.dataFormat==="channelsLast",g=(h===1||d===1)&&c>1e3,x=u[2]%2!=0&&!!l.isPacked;if(g||!Nt().getBool("WEBGL_LAZILY_UNPACK")||!Nt().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!x){var y=p?u[0]*u[1]*u[2]:u[0]*u[2]*u[3],b=this.reshape(e,[1,y,o.inChannels]),C=this.reshape(r,[1,o.inChannels,o.outChannels]);return this.reshape(this.fusedBatchMatMul({a:b,b:C,transposeA:!1,transposeB:!1,bias:a,activation:i,preluActivationWeights:s}),o.outShape)}var E=p?u[0]*u[1]*(u[2]+1):u[0]*u[2]*(u[3]+1),S={dataId:e.dataId,shape:[1,E,o.inChannels],dtype:e.dtype},k=l.shape;l.shape=l.shape.slice(),l.shape[l.shape.length-2]++,X(Mx(l.shape,S.shape),function(){return"packed reshape "+l.shape+" to "+S.shape+" isn't free"});var R=this.reshape(r,[1,o.inChannels,o.outChannels]),A=this.fusedBatchMatMul({a:S,b:R,transposeA:!1,transposeB:!1,bias:a,activation:i,preluActivationWeights:s}),N=this.texData.get(A.dataId);return X(N.isPacked,function(){return"batchMatMul result is expected to be packed"}),l.shape=k,N.shape=o.outShape,st.makeTensorFromDataId(A.dataId,o.outShape,A.dtype)},t.prototype.conv2dWithIm2Row=function(e,r,o,a,i,s){var u=o.filterWidth,l=o.filterHeight,c=o.inChannels,h=o.outWidth,d=o.outHeight,p=o.dataFormat==="channelsLast",g=u*l*c,x=d*h,y=[g,x],b=e.squeeze([0]),C=r.reshape([1,g,-1]),E=new yut(y,b.shape,o),S=this.compileAndRun(E,[b]).reshape([1,y[0],y[1]]),k=a!=null,R=s!=null,A=i?zx(i,!0):null,N=new VC(S.shape,[1,x,o.outChannels],!0,!1,k,A,R),_=[S,C];a&&_.push(a),R&&_.push(s);var $=this.compileAndRun(N,_);return p?$.reshape([1,d,h,o.outChannels]):$.reshape([1,o.outChannels,d,h])},t.prototype.fusedConv2d=function(e){var r=e.input,o=e.filter,a=e.convInfo,i=e.bias,s=e.activation,u=e.preluActivationWeights;if(a.filterHeight===1&&a.filterWidth===1&&a.dilationHeight===1&&a.dilationWidth===1&&a.strideHeight===1&&a.strideWidth===1&&(a.padInfo.type==="SAME"||a.padInfo.type==="VALID"))return this.conv2dByMatMul(r,o,a,i,s,u);if(Nt().getBool("WEBGL_CONV_IM2COL")&&r.shape[0]===1)return this.conv2dWithIm2Row(r,o,a,i,s,u);var l=i!=null,c=u!=null,h=s?zx(s,!1):null,d=new EO(a,l,h,c),p=[r,o];return i&&p.push(i),u&&p.push(u),this.compileAndRun(d,p)},t.prototype.conv2d=function(e,r,o){if(o.filterHeight===1&&o.filterWidth===1&&o.dilationHeight===1&&o.dilationWidth===1&&o.strideHeight===1&&o.strideWidth===1&&(o.padInfo.type==="SAME"||o.padInfo.type==="VALID"))return this.conv2dByMatMul(e,r,o);if(Nt().getBool("WEBGL_CONV_IM2COL")&&e.shape[0]===1)return this.conv2dWithIm2Row(e,r,o);var a=new EO(o);return this.compileAndRun(a,[e,r])},t.prototype.conv2dDerInput=function(e,r,o){var a=new Fst(o);return this.compileAndRun(a,[e,r])},t.prototype.conv2dDerFilter=function(e,r,o){var a=new Ost(o);return this.compileAndRun(a,[e,r])},t.prototype.fusedDepthwiseConv2D=function(e){var r,o=e.input,a=e.filter,i=e.convInfo,s=e.bias,u=e.activation,l=e.preluActivationWeights,c=Nt().getBool("WEBGL_PACK_DEPTHWISECONV")&&i.strideWidth<=2&&i.outChannels/i.inChannels==1,h=u?zx(u,c):null,d=[o,a],p=s!=null,g=l!=null;return p&&d.push(s),g&&d.push(l),c?(r=new IO(i,p,h,g),this.compileAndRun(r,d)):(r=new kO(i,p,h,g),this.compileAndRun(r,d))},t.prototype.depthwiseConv2D=function(e,r,o){var a;return Nt().getBool("WEBGL_PACK_DEPTHWISECONV")&&o.strideWidth<=2&&o.outChannels/o.inChannels==1?(a=new IO(o),this.compileAndRun(a,[e,r])):(a=new kO(o),this.compileAndRun(a,[e,r]))},t.prototype.depthwiseConv2DDerInput=function(e,r,o){var a=new Bst(o);return this.compileAndRun(a,[e,r])},t.prototype.depthwiseConv2DDerFilter=function(e,r,o){var a=new Pst(o);return this.compileAndRun(a,[e,r])},t.prototype.conv3d=function(e,r,o){var a=new zst(o);return this.compileAndRun(a,[e,r])},t.prototype.conv3dDerInput=function(e,r,o){var a=new Lst(o);return this.compileAndRun(a,[e,r])},t.prototype.conv3dDerFilter=function(e,r,o){var a=new Mst(o);return this.compileAndRun(a,[e,r])},t.prototype.maxPool=function(e,r){var o=new Yp(r,"max",!1);return this.compileAndRun(o,[e])},t.prototype.avgPool=function(e,r){var o=new Yp(r,"avg",!1);return this.compileAndRun(o,[e],"float32")},t.prototype.maxPoolBackprop=function(e,r,o,a){var i=new Yp(a,"max",!0),s=this.compileAndRun(i,[r]),u=new Sut(a),l=this.compileAndRun(u,[e,s],r.dtype);return s.dispose(),l},t.prototype.avgPoolBackprop=function(e,r,o){var a=new wst(o);return this.compileAndRun(a,[e],r.dtype)},t.prototype.cast=function(e,r){return sP(e,r,this)},t.prototype.unstack=function(e,r){for(var o=e.shape[r],a=new Array(e.rank-1),i=0,s=0;s<e.rank;s++)s!==r&&(a[i++]=e.shape[s]);var u=new Array(e.rank).fill(0),l=e.shape.slice();l[r]=1;var c=new Array(o);for(s=0;s<c.length;s++)u[r]=s,c[s]=this.slice(e,u,l).reshape(a);return c},t.prototype.avgPool3d=function(e,r){var o=new GC(r,"avg",!1);return this.compileAndRun(o,[e],"float32")},t.prototype.avgPool3dBackprop=function(e,r,o){var a=new Cst(o);return this.compileAndRun(a,[e],r.dtype)},t.prototype.maxPool3d=function(e,r){var o=new GC(r,"max",!1);return this.compileAndRun(o,[e],"float32")},t.prototype.maxPool3dBackprop=function(e,r,o,a){var i=new GC(a,"max",!0),s=this.compileAndRun(i,[r]),u=new Eut(a),l=this.compileAndRun(u,[e,s],r.dtype);return s.dispose(),l},t.prototype.reshape=function(e,r){var o=this.texData.get(e.dataId);if(o.isPacked&&!Mx(e.shape,r)&&(o.texture===null||!Mx(o.shape,r))){var a=this.packedReshape(e,r);return st.makeTensorFromDataId(a.dataId,a.shape,a.dtype)}return uE(e,r)},t.prototype.resizeBilinear=function(e,r,o,a){var i=Nt().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new Out(e.shape,r,o,a):new $ut(e.shape,r,o,a);return this.compileAndRun(i,[e],"float32")},t.prototype.resizeBilinearBackprop=function(e,r,o){var a=new Dut(e,r,o);return this.compileAndRun(a,[e])},t.prototype.resizeNearestNeighbor=function(e,r,o,a){var i=new Mut(e.shape,r,o,a);return this.compileAndRun(i,[e])},t.prototype.resizeNearestNeighborBackprop=function(e,r,o){var a=new Fut(e,r,o);return this.compileAndRun(a,[e])},t.prototype.multinomial=function(e,r,o,a){var i=r?e:r1(e),s=i.shape[0],u=i.shape[1],l=new kut(s,u,o),c=l.getCustomSetupFunc(a);return this.compileAndRun(l,[i],"int32",c)},t.prototype.oneHot=function(e,r,o,a){var i=new Iut(e.size,r,o,a);return this.compileAndRun(i,[e])},t.prototype.diag=function(e){var r=new qst(e.size);return this.compileAndRun(r,[e])},t.prototype.nonMaxSuppression=function(e,r,o,a,i){return J0("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),Pk(e.dataSync(),r.dataSync(),o,a,i)},t.prototype.cropAndResize=function(e,r,o,a,i,s){var u=new Ust(e.shape,r.shape,a,i,s);return this.compileAndRun(u,[e,r,o],"float32")},t.prototype.depthToSpace=function(e,r,o){X(r>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+r});var a=e.shape[0],i=o==="NHWC"?e.shape[1]:e.shape[2],s=o==="NHWC"?e.shape[2]:e.shape[3],u=o==="NHWC"?e.shape[3]:e.shape[1],l=i*r,c=s*r,h=u/(r*r),d=new Hst(o==="NHWC"?[a,l,c,h]:[a,h,l,c],r,o);return this.compileAndRun(d,[e])},t.prototype.split=function(e,r,o){return cP(e,r,o)},t.prototype.scatterND=function(e,r,o){var a=iy(0,e,o),i=a.sliceRank,s=a.numUpdates,u=a.sliceSize,l=a.strides,c=a.outputSize,h=[c/u,u],d=e.reshape([s,i]),p=r.reshape([s,u]);if(c===0)return uE(Qr([]),o);var g=ae(0),x=new AO(s,i,d.rank,p.rank,l,h);return this.compileAndRun(x,[p,d,g]).reshape(o)},t.prototype.sparseToDense=function(e,r,o,a){var i=iy(0,e,o),s=i.sliceRank,u=i.numUpdates,l=i.strides,c=i.outputSize,h=new AO(u,s,e.rank,r.rank,l,[c,1]);return this.compileAndRun(h,[r,e,a]).reshape(o)},t.prototype.fft=function(e){return this.fftImpl(e,!1)},t.prototype.ifft=function(e){return this.fftImpl(e,!0)},t.prototype.fftImpl=function(e,r){var o=this.texData.get(e.dataId),a=new TO(Qst,e.shape,r),i=new TO(Zst,e.shape,r),s=[this.makeComplexComponentTensorInfo(e,o.complexTensors.real),this.makeComplexComponentTensorInfo(e,o.complexTensors.imag)],u=this.compileAndRun(a,s),l=this.compileAndRun(i,s),c=this.complex(u,l).as2D(e.shape[0],e.shape[1]);return u.dispose(),l.dispose(),c},t.prototype.gatherND=function(e,r){var o=r.shape,a=o[o.length-1],i=tP(e,r),s=i[0],u=i[1],l=i[2],c=i[3],h=r.reshape([u,a]),d=e.reshape([e.size/l,l]),p=new eut(a,c,[u,l]);return this.compileAndRun(p,[d,h]).reshape(s)},t.prototype.fill=function(e,r,o){if((o=o||Lm(r))==="string"){var a=K0(o,Yt(e));return a.fill(r),st.makeTensor(a,e,o,this)}var i=new Jst(e,r),s=i.getCustomSetupFunc(r);return this.compileAndRun(i,[],o,s)},t.prototype.onesLike=function(e){if(e.dtype==="string")throw new Error("onesLike is not supported under string dtype");return this.fill(e.shape,1,e.dtype)},t.prototype.zerosLike=function(e){return this.fill(e.shape,e.dtype==="string"?"":0,e.dtype)},t.prototype.linspace=function(e,r,o){return uP(e,r,o)},t.prototype.makeTensorInfo=function(e,r){var o=this.write(null,e,r);return this.texData.get(o).usage=null,{dataId:o,shape:e,dtype:r}},t.prototype.makeOutput=function(e,r){var o=this.makeTensorInfo(e,r).dataId;return st.makeTensorFromDataId(o,e,r,this)},t.prototype.unpackTensor=function(e){var r=new rlt(e.shape);return this.runWebGLProgram(r,[e],e.dtype)},t.prototype.packTensor=function(e){var r=new Rut(e.shape);return this.runWebGLProgram(r,[e],e.dtype,null,!0)},t.prototype.packedReshape=function(e,r){var o=[Q0(e.shape)].concat(Z0(e.shape)),a={dtype:e.dtype,shape:o,dataId:e.dataId},i=[Q0(r)].concat(Z0(r)),s=new _ut(i,o),u=this.runWebGLProgram(s,[a],e.dtype,null,!0);return{dataId:u.dataId,shape:r,dtype:u.dtype}},t.prototype.decode=function(e){var r,o=this.texData.get(e),a=o.isPacked,i=o.shape,s=o.dtype,u=BC(i);return r=a?new Gst(u):new Vst(u),{dtype:s,shape:i,dataId:this.runWebGLProgram(r,[{shape:u,dtype:s,dataId:e}],s,null,!0).dataId}},t.prototype.runWebGLProgram=function(e,r,o,a,i){var s=this;i===void 0&&(i=!1);var u=this.makeTensorInfo(e.outputShape,o),l=this.texData.get(u.dataId);if(e.packedOutput&&(l.isPacked=!0),e.outPackingScheme===rm.DENSE){var c=Xp(e.outputShape);l.texShape=c.map(function(E){return 2*E})}if(e.outTexUsage!=null&&(l.usage=e.outTexUsage),Yt(u.shape)===0)return l.values=Lf(u.dtype,0),u;var h=[],d=r.map(function(E){if(E.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var S=s.texData.get(E.dataId);if(S.texture==null){if(!e.packedInputs&&Yt(E.shape)<=Nt().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:E.shape,texData:null,isUniform:!0,uniformValues:S.values};e.packedInputs&&(S.isPacked=!0,S.shape=E.shape)}else if(!!S.isPacked!=!!e.packedInputs)E=S.isPacked?s.unpackTensor(E):s.packTensor(E),h.push(E),S=s.texData.get(E.dataId);else if(S.isPacked&&!Mx(S.shape,E.shape)){var k=E,R=E.shape;E.shape=S.shape,E=s.packedReshape(E,R),h.push(E),S=s.texData.get(E.dataId),k.shape=R}return s.uploadToGPU(E.dataId),{shape:E.shape,texData:S,isUniform:!1}});this.uploadToGPU(u.dataId);var p,g={shape:u.shape,texData:l,isUniform:!1},x=function(E,S,k){var R="";S.concat(k).forEach(function(_){var $=_.texData!=null&&_.texData.slice!=null&&_.texData.slice.flatOffset>0,D=_.isUniform?"uniform":_.texData.texShape;R+=_.shape+"_"+D+"_"+$});var A=E.userCode,N=E.constructor.name;return N+="_"+R+"_"+A}(e,d,g),y=this.getAndSaveBinary(x,function(){return function(E,S,k,R){var A=S.userCode,N=k.map(function(U,q){var M={logicalShape:U.shape,texShape:U.isUniform?null:U.texData.texShape,isUniform:U.isUniform,isPacked:!U.isUniform&&U.texData.isPacked,flatOffset:null};return U.texData!=null&&U.texData.slice!=null&&U.texData.slice.flatOffset>0&&(M.flatOffset=U.texData.slice.flatOffset),{name:S.variableNames[q],shapeInfo:M}}),_=N.map(function(U){return U.shapeInfo}),$={logicalShape:R.shape,texShape:R.texData.texShape,isUniform:!1,isPacked:R.texData.isPacked,flatOffset:null},D=mst(N,$,A,S.packedInputs),O=E.createProgram(D),P=null,z=E.getUniformLocation(O,"NAN",!1);Nt().getNumber("WEBGL_VERSION")===1&&(P=E.getUniformLocation(O,"INFINITY",!1));for(var W={},F=0;F<S.variableNames.length;F++){var B=S.variableNames[F];W[B]=E.getUniformLocation(O,B,!1),W["offset"+B]=E.getUniformLocation(O,"offset"+B,!1)}return{program:S,source:D,webGLProgram:O,uniformLocations:W,inShapeInfos:_,outShapeInfo:$,infLoc:P,nanLoc:z}}(s.gpgpu,e,d,g)}),b=this.activeTimers!=null;if(b&&(p=this.startTimer()),function(E,S,k,R,A){NO(S.inShapeInfos,k),NO([S.outShapeInfo],[R]);var N=R.texData.texture,_=R.texData.texShape;R.texData.isPacked?E.setOutputPackedMatrixTexture(N,_[0],_[1]):E.setOutputMatrixTexture(N,_[0],_[1]),E.setProgram(S.webGLProgram),Nt().getNumber("WEBGL_VERSION")===1&&S.infLoc!==null&&E.gl.uniform1f(S.infLoc,1/0),S.nanLoc!==null&&E.gl.uniform1f(S.nanLoc,NaN),k.forEach(function($,D){var O=S.program.variableNames[D],P=S.uniformLocations[O],z=S.uniformLocations["offset"+O];if(P!=null)if($.isUniform)if(Yt($.shape)<2)E.gl.uniform1f(P,$.uniformValues[0]);else{var W=$.uniformValues;W instanceof Float32Array||(W=new Float32Array(W)),E.gl.uniform1fv(P,W)}else $.texData.slice!=null&&z!=null&&E.gl.uniform1i(z,$.texData.slice.flatOffset),E.setInputMatrixTexture($.texData.texture,P,D)}),A?.(E,S.webGLProgram),E.executeProgram()}(this.gpgpu,y,d,g,a),h.forEach(function(E){return s.disposeData(E.dataId)}),b&&(p=this.endTimer(p),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(p)})),!Nt().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&i===!1){var C=this.unpackTensor(u);return this.disposeData(u.dataId),C}return u},t.prototype.compileAndRun=function(e,r,o,a,i){i===void 0&&(i=!1),o=o||r[0].dtype;var s=this.runWebGLProgram(e,r,o,a,i);return st.makeTensorFromDataId(s.dataId,s.shape,s.dtype)},t.prototype.getAndSaveBinary=function(e,r){return e in this.binaryCache||(this.binaryCache[e]=r()),this.binaryCache[e]},t.prototype.getTextureManager=function(){return this.textureManager},t.prototype.dispose=function(){var e=this;this.disposed||(Nt().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(function(r){e.gpgpu.deleteProgram(e.binaryCache[r].webGLProgram),delete e.binaryCache[r]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},t.prototype.floatPrecision=function(){var e=this;return this.floatPrecisionValue==null&&(this.floatPrecisionValue=an(function(){if(!Nt().get("WEBGL_RENDER_FLOAT32_ENABLED")){var r=Nt().getBool("DEBUG");Nt().set("DEBUG",!1);var o=e.abs(ae(1e-8)).dataSync()[0];if(Nt().set("DEBUG",r),o>0)return 32}return 16})),this.floatPrecisionValue},t.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},t.prototype.uploadToGPU=function(e){var r,o=this.texData.get(e),a=o.shape,i=o.dtype,s=o.values,u=o.texture,l=o.usage,c=o.isPacked;if(u==null){var h,d=this.activeTimers!=null;d&&(h=Li());var p=o.texShape;if(p==null&&(p=Uat(a,c),o.texShape=p),s!=null){var g=BC(a),x=void 0,y=p[1],b=p[0],C=s instanceof Uint8Array;c?(y=(r=Bm(p[0],p[1]))[0],b=r[1],x=new Yst(g,[b,y],C)):x=new Kst(g,[b,y],C);var E=this.makeTensorInfo([b,y],i);this.texData.get(E.dataId).usage=C?ma.PIXELS:ma.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(E.dataId),y,b,s);var S=this.runWebGLProgram(x,[E],i,null,!0),k=this.texData.get(S.dataId);o.texture=k.texture,o.texShape=k.texShape,o.isPacked=k.isPacked,o.usage=k.usage,this.disposeData(E.dataId),this.texData.delete(S.dataId),o.values=null,d&&(this.uploadWaitMs+=Li()-h)}else{var R=this.acquireTexture(p,l,i,c);o.texture=R}}},t.prototype.convertAndCacheOnCPU=function(e,r){var o=this.texData.get(e),a=o.dtype;return this.releaseGPUData(e),r!=null&&(o.values=function(i,s){if(s==="float32"||s==="complex64")return i;if(s==="int32"||s==="bool"){for(var u=s==="int32"?new Int32Array(i.length):new Uint8Array(i.length),l=0;l<u.length;++l)u[l]=Math.round(i[l]);return u}throw new Error("Unknown dtype "+s)}(r,a)),o.values},t.prototype.acquireTexture=function(e,r,o,a){if(this.numBytesInGPU+=this.computeBytes(e,o),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var i=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+i+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(e,r,a)},t.prototype.computeBytes=function(e,r){return e[0]*e[1]*RL(r)},t}(aP);FL()&&st.registerBackend("webgl",function(){return new alt},2);function Yc(n,t){return n(t={exports:{}},t.exports),t.exports}var ilt=Yc(function(n){(function(t,e,r){function o(s){var u,l=this,c=(u=4022871197,function(h){h=h.toString();for(var d=0;d<h.length;d++){var p=.02519603282416938*(u+=h.charCodeAt(d));p-=u=p>>>0,u=(p*=u)>>>0,u+=4294967296*(p-=u)}return 23283064365386963e-26*(u>>>0)});l.next=function(){var h=2091639*l.s0+23283064365386963e-26*l.c;return l.s0=l.s1,l.s1=l.s2,l.s2=h-(l.c=0|h)},l.c=1,l.s0=c(" "),l.s1=c(" "),l.s2=c(" "),l.s0-=c(s),l.s0<0&&(l.s0+=1),l.s1-=c(s),l.s1<0&&(l.s1+=1),l.s2-=c(s),l.s2<0&&(l.s2+=1),c=null}function a(s,u){return u.c=s.c,u.s0=s.s0,u.s1=s.s1,u.s2=s.s2,u}function i(s,u){var l=new o(s),c=u&&u.state,h=l.next;return h.int32=function(){return 4294967296*l.next()|0},h.double=function(){return h()+11102230246251565e-32*(2097152*h()|0)},h.quick=h,c&&(typeof c=="object"&&a(c,l),h.state=function(){return a(l,{})}),h}e&&e.exports?e.exports=i:this.alea=i})(0,n)}),slt=Yc(function(n){(function(t,e,r){function o(s){var u=this,l="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var h=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^h^h>>>8},s===(0|s)?u.x=s:l+=s;for(var c=0;c<l.length+64;c++)u.x^=0|l.charCodeAt(c),u.next()}function a(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function i(s,u){var l=new o(s),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var d=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(d===0);return d},h.int32=l.next,h.quick=h,c&&(typeof c=="object"&&a(c,l),h.state=function(){return a(l,{})}),h}e&&e.exports?e.exports=i:this.xor128=i})(0,n)}),ult=Yc(function(n){(function(t,e,r){function o(s){var u=this,l="";u.next=function(){var h=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^h^h<<1)|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(0|s)?u.x=s:l+=s;for(var c=0;c<l.length+64;c++)u.x^=0|l.charCodeAt(c),c==l.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function a(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function i(s,u){var l=new o(s),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var d=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(d===0);return d},h.int32=l.next,h.quick=h,c&&(typeof c=="object"&&a(c,l),h.state=function(){return a(l,{})}),h}e&&e.exports?e.exports=i:this.xorwow=i})(0,n)}),llt=Yc(function(n){(function(t,e,r){function o(s){var u=this;u.next=function(){var l,c,h=u.x,d=u.i;return l=h[d],c=(l^=l>>>7)^l<<24,c^=(l=h[d+1&7])^l>>>10,c^=(l=h[d+3&7])^l>>>3,c^=(l=h[d+4&7])^l<<7,l=h[d+7&7],c^=(l^=l<<13)^l<<9,h[d]=c,u.i=d+1&7,c},function(l,c){var h,d=[];if(c===(0|c))d[0]=c;else for(c=""+c,h=0;h<c.length;++h)d[7&h]=d[7&h]<<15^c.charCodeAt(h)+d[h+1&7]<<13;for(;d.length<8;)d.push(0);for(h=0;h<8&&d[h]===0;++h);for(h==8?d[7]=-1:d[h],l.x=d,l.i=0,h=256;h>0;--h)l.next()}(u,s)}function a(s,u){return u.x=s.x.slice(),u.i=s.i,u}function i(s,u){s==null&&(s=+new Date);var l=new o(s),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var d=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(d===0);return d},h.int32=l.next,h.quick=h,c&&(c.x&&a(c,l),h.state=function(){return a(l,{})}),h}e&&e.exports?e.exports=i:this.xorshift7=i})(0,n)}),clt=Yc(function(n){(function(t,e,r){function o(s){var u=this;u.next=function(){var l,c,h=u.w,d=u.X,p=u.i;return u.w=h=h+1640531527|0,c=d[p+34&127],l=d[p=p+1&127],c^=c<<13,l^=l<<17,c^=c>>>15,l^=l>>>12,c=d[p]=c^l,u.i=p,c+(h^h>>>16)|0},function(l,c){var h,d,p,g,x,y=[],b=128;for(c===(0|c)?(d=c,c=null):(c+="\0",d=0,b=Math.max(b,c.length)),p=0,g=-32;g<b;++g)c&&(d^=c.charCodeAt((g+32)%c.length)),g===0&&(x=d),d^=d<<10,d^=d>>>15,d^=d<<4,d^=d>>>13,g>=0&&(x=x+1640531527|0,p=(h=y[127&g]^=d+x)==0?p+1:0);for(p>=128&&(y[127&(c&&c.length||0)]=-1),p=127,g=512;g>0;--g)d=y[p+34&127],h=y[p=p+1&127],d^=d<<13,h^=h<<17,d^=d>>>15,h^=h>>>12,y[p]=d^h;l.w=x,l.X=y,l.i=p}(u,s)}function a(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function i(s,u){s==null&&(s=+new Date);var l=new o(s),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var d=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(d===0);return d},h.int32=l.next,h.quick=h,c&&(c.X&&a(c,l),h.state=function(){return a(l,{})}),h}e&&e.exports?e.exports=i:this.xor4096=i})(0,n)}),hlt=Yc(function(n){(function(t,e,r){function o(s){var u=this,l="";u.next=function(){var h=u.b,d=u.c,p=u.d,g=u.a;return h=h<<25^h>>>7^d,d=d-p|0,p=p<<24^p>>>8^g,g=g-h|0,u.b=h=h<<20^h>>>12^d,u.c=d=d-p|0,u.d=p<<16^d>>>16^g,u.a=g-h|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=0|s):l+=s;for(var c=0;c<l.length+20;c++)u.b^=0|l.charCodeAt(c),u.next()}function a(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function i(s,u){var l=new o(s),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var d=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(d===0);return d},h.int32=l.next,h.quick=h,c&&(typeof c=="object"&&a(c,l),h.state=function(){return a(l,{})}),h}e&&e.exports?e.exports=i:this.tychei=i})(0,n)}),tc=Yc(function(n){(function(t,e){var r,o=this,a=256,i=6,s="random",u=e.pow(a,i),l=e.pow(2,52),c=2*l,h=a-1;function d(b,C,E){var S=[],k=x(function N(_,$){var D,O=[],P=typeof _;if($&&P=="object")for(D in _)try{O.push(N(_[D],$-1))}catch{}return O.length?O:P=="string"?_:_+"\0"}((C=C==1?{entropy:!0}:C||{}).entropy?[b,y(t)]:b??function(){try{var N;return r&&(N=r.randomBytes)?N=N(a):(N=new Uint8Array(a),(o.crypto||o.msCrypto).getRandomValues(N)),y(N)}catch{var _=o.navigator,$=_&&_.plugins;return[+new Date,o,$,o.screen,y(t)]}}(),3),S),R=new p(S),A=function(){for(var N=R.g(i),_=u,$=0;N<l;)N=(N+$)*a,_*=a,$=R.g(1);for(;N>=c;)N/=2,_/=2,$>>>=1;return(N+$)/_};return A.int32=function(){return 0|R.g(4)},A.quick=function(){return R.g(4)/4294967296},A.double=A,x(y(R.S),t),(C.pass||E||function(N,_,$,D){return D&&(D.S&&g(D,R),N.state=function(){return g(R,{})}),$?(e[s]=N,_):N})(A,k,"global"in C?C.global:this==e,C.state)}function p(b){var C,E=b.length,S=this,k=0,R=S.i=S.j=0,A=S.S=[];for(E||(b=[E++]);k<a;)A[k]=k++;for(k=0;k<a;k++)A[k]=A[R=h&R+b[k%E]+(C=A[k])],A[R]=C;(S.g=function(N){for(var _,$=0,D=S.i,O=S.j,P=S.S;N--;)_=P[D=h&D+1],$=$*a+P[h&(P[D]=P[O=h&O+_])+(P[O]=_)];return S.i=D,S.j=O,$})(a)}function g(b,C){return C.i=b.i,C.j=b.j,C.S=b.S.slice(),C}function x(b,C){for(var E,S=b+"",k=0;k<S.length;)C[h&k]=h&(E^=19*C[h&k])+S.charCodeAt(k++);return y(C)}function y(b){return String.fromCharCode.apply(0,b)}if(e["seed"+s]=d,x(e.random(),t),n.exports){n.exports=d;try{r=require("crypto")}catch{}}})([],Math)});tc.alea=ilt,tc.xor128=slt,tc.xorwow=ult,tc.xorshift7=llt,tc.xor4096=clt,tc.tychei=hlt;var o1=tc.alea,flt=nt({addN_:function(n){X(Array.isArray(n),function(){return"The argument passed to tf.addN() must be a list of tensors"}),X(n.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+n.length});var t=n.map(function(o,a){return j(o,"tensors"+a,"addN")}),e=t[0];t.forEach(function(o){if(o.dtype!==e.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),t.forEach(function(o){if(!zr(o.shape,e.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var r=t;return st.runKernelFunc(function(o,a){return o.addN(t)},r,null,"AddN")}});function a1(){ML("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}function EP(n){return n.rank===0||n.rank===1?n.as4D(1,1,1,n.size):n.rank===2?n.as4D(1,1,n.shape[0],n.shape[1]):n.rank===3?n.as4D(1,n.shape[0],n.shape[1],n.shape[2]):n}function kP(n,t,e,r,o,a){a==null&&(a=.001);var i,s,u=j(n,"x","batchNorm"),l=j(t,"mean","batchNorm"),c=j(e,"variance","batchNorm");o!=null&&(i=j(o,"scale","batchNorm")),r!=null&&(s=j(r,"offset","batchNorm")),X(l.rank===c.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),X(s==null||l.rank===s.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),X(i==null||l.rank===i.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."});var h={x:u,scale:i,offset:s,mean:l,variance:c},d={varianceEpsilon:a};return st.runKernelFunc(function(p,g){var x=EP(u),y=p.batchNormalization(x,Ux(l),Ux(c),a,Ux(i),Ux(s));return g([u,l,c,i]),y},h,null,"FusedBatchNorm",d).reshape(u.shape)}function Ux(n){return n==null?null:n.rank===0?n.as1D():n.rank===1?n:n.rank===2?n.as4D(1,1,n.shape[0],n.shape[1]):n.rank===3?n.as4D(1,n.shape[0],n.shape[1],n.shape[2]):n}var dlt=nt({batchNormalization_:function(n,t,e,r,o,a){return r===void 0&&(r=.001),a1(),kP(n,t,e,a,o,r)}}),Um=nt({batchNorm_:kP});function IP(n,t,e,r,o,a){var i,s,u=j(n,"x","batchNorm"),l=j(t,"mean","batchNorm"),c=j(e,"variance","batchNorm");return o!=null&&(i=j(o,"scale","batchNorm")),r!=null&&(s=j(r,"offset","batchNorm")),X(u.rank===2,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),X(l.rank===2||l.rank===1,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+l.rank+"."}),X(c.rank===2||c.rank===1,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+c.rank+"."}),i!=null&&X(i.rank===2||i.rank===1,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+i.rank+"."}),s!=null&&X(s.rank===2||s.rank===1,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+s.rank+"."}),Um(u,l,c,s,i,a)}var plt=nt({batchNormalization2d_:function(n,t,e,r,o,a){return r===void 0&&(r=.001),a1(),IP(n,t,e,a,o,r)}}),mlt=nt({batchNorm2d_:IP});function RP(n,t,e,r,o,a){var i,s,u=j(n,"x","batchNorm"),l=j(t,"mean","batchNorm"),c=j(e,"variance","batchNorm");return o!=null&&(i=j(o,"scale","batchNorm")),r!=null&&(s=j(r,"offset","batchNorm")),X(u.rank===3,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),X(l.rank===3||l.rank===1,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+l.rank+"."}),X(c.rank===3||c.rank===1,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+c.rank+"."}),i!=null&&X(i.rank===3||i.rank===1,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+i.rank+"."}),s!=null&&X(s.rank===3||s.rank===1,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+s.rank+"."}),Um(u,l,c,s,i,a)}var glt=nt({batchNormalization3d_:function(n,t,e,r,o,a){return r===void 0&&(r=.001),a1(),RP(n,t,e,a,o,r)}}),vlt=nt({batchNorm3d_:RP});function TP(n,t,e,r,o,a){var i,s,u=j(n,"x","batchNorm"),l=j(t,"mean","batchNorm"),c=j(e,"variance","batchNorm");return o!=null&&(i=j(o,"scale","batchNorm")),r!=null&&(s=j(r,"offset","batchNorm")),X(u.rank===4,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."}),X(l.rank===4||l.rank===1,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+l.rank+"."}),X(c.rank===4||c.rank===1,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+c.rank+"."}),i!=null&&X(i.rank===4||i.rank===1,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+i.rank+"."}),s!=null&&X(s.rank===4||s.rank===1,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+s.rank+"."}),Um(u,l,c,s,i,a)}var xlt=nt({batchNormalization4d_:function(n,t,e,r,o,a){return r===void 0&&(r=.001),a1(),TP(n,t,e,a,o,r)}}),ylt=nt({batchNorm4d_:TP}),NP=nt({broadcastTo_:function(n,t){var e=j(n,"broadcastTo","x"),r=e.shape;if(t.some(function(h){return!(h>0)||h%1!=0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+t+"].");if(t.length<e.rank)throw new Error("broadcastTo(): shape.length="+t.length+" < input.rank="+e.rank+".");if(t.length>e.rank){for(var o=e.shape.slice();o.length<t.length;)o.unshift(1);e=e.reshape(o)}for(var a=e.shape,i=Array.from(t),s=t.length-1;s>=0;s--)if(a[s]===t[s])i[s]=1;else if(e.shape[s]!==1)throw new Error("broadcastTo(): ["+r+"] cannot be broadcast to ["+t+"].");var u=i.map(function(h,d){return h>1?d:-1}).filter(function(h){return h>=0});if(u.length===0)return e.clone();var l={x:e},c={shape:t,inputShape:a};return st.runKernelFunc(function(h){return h.tile(e,i)},l,function(h){return{x:function(){return h.sum(u,!0)}}},qL,c)}}),blt=nt({clone_:function(n){var t=j(n,"x","clone",null);return st.runKernelFunc(function(){return st.makeTensorFromDataId(t.dataId,t.shape,t.dtype)},{x:t},null,XL)}}),i1=nt({logicalAnd_:function(n,t){var e=j(n,"a","logicalAnd","bool"),r=j(t,"b","logicalAnd","bool");return Pe(e.shape,r.shape),st.runKernelFunc(function(o){return o.logicalAnd(e,r)},{a:e,b:r},null,"LogicalAnd")}}),wlt=nt({logicalNot_:function(n){var t=j(n,"x","logicalNot","bool");return st.runKernelFunc(function(e){return e.logicalNot(t)},{$x:t})}}),AP=nt({logicalOr_:function(n,t){var e=j(n,"a","logicalOr","bool"),r=j(t,"b","logicalOr","bool");return Pe(e.shape,r.shape),st.runKernelFunc(function(o){return o.logicalOr(e,r)},{$a:e,$b:r})}}),Clt=nt({logicalXor_:function(n,t){var e=j(n,"a","logicalXor","bool"),r=j(t,"b","logicalXor","bool");return Pe(e.shape,r.shape),AP(n,t).logicalAnd(i1(n,t).logicalNot())}}),kc=nt({where_:function(n,t,e){var r=j(t,"a","where"),o=j(e,"b","where"),a=j(n,"condition","where","bool");return cn(r.shape,o.shape,"Error in where: "),a.rank===1?X(a.shape[0]===r.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):cn(a.shape,o.shape,"Error in where: "),st.runKernelFunc(function(i,s){var u=i.select(a,r,o);return s([a]),u},{$condition:a,$a:r,$b:o},function(i,s){var u=s[0];return{$condition:function(){return je(u).toFloat()},$a:function(){return i.mul(u.cast(i.dtype))},$b:function(){return i.mul(u.logicalNot().cast(i.dtype))}}})}}),_P=function(n){return Qt(this,void 0,void 0,function(){var t,e,r;return Zt(this,function(o){switch(o.label){case 0:return[4,(t=j(n,"condition","whereAsync","bool")).data()];case 1:return e=o.sent(),r=zk(t.shape,e),n!==t&&t.dispose(),[2,r]}})})},DP=nt({divNoNan_:function(n,t){var e,r=j(n,"a","div"),o=j(t,"b","div");r=(e=Vn(r,o))[0],o=e[1];var a=al(r,o),i=je(a),s=o.equal(i);return kc(s,i,a)}}),yf=nt({tile_:function(n,t){var e=j(n,"x","tile",null);X(e.rank===t.length,function(){return"Error in transpose: rank of input "+e.rank+" must match length of reps "+t+"."});var r=[e],o={x:e},a={reps:t};return st.runKernelFunc(function(i,s){var u=i.tile(e,t);return s([e]),u},o,null,KL,a,r)}}),$P=nt({eye_:function(n,t,e,r){r===void 0&&(r="float32"),t==null&&(t=n);for(var o=Ce([n,t],r),a=n<=t?n:t,i=0;i<a;++i)o.set(1,i,i);var s=o.toTensor().as2D(n,t);if(e==null)return s;if(e.length===1)return yf(zu(s,0),[e[0],1,1]);if(e.length===2)return yf(zu(zu(s,0),0),[e[0],e[1],1,1]);if(e.length===3)return yf(zu(zu(zu(s,0),0),0),[e[0],e[1],e[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+e.length+"D.")}}),Slt=nt({multinomial_:function(n,t,e,r){r===void 0&&(r=!1);var o=j(n,"logits","multinomial"),a=o.size,i=o.rank;if(a<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+a+".");if(i>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+i);e=e||Math.random();var s=i===1?o.as2D(1,-1):o,u=st.runKernelFunc(function(l){return l.multinomial(s,r,t,e)},{logits2D:s});return i===1?u.as1D():u}}),cy=nt({oneHot_:function(n,t,e,r){if(e===void 0&&(e=1),r===void 0&&(r=0),t<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+t);var o=j(n,"indices","oneHot","int32"),a=o.shape.concat([t]),i={indices:o=o.flatten()},s={depth:t,onValue:e,offValue:r};return st.runKernelFunc(function(u,l){return l([o]),u.oneHot(o,t,e,r)},i,null,jL,s).reshape(a)}}),au=nt({pad_:function(n,t,e){e===void 0&&(e=0);var r=j(n,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var o={paddings:t,constantValue:e},a={x:r};return st.runKernelFunc(function(i,s){return s([r]),i.pad(r,t,e)},a,null,YL,o)}}),Elt=nt({pad1d_:function(n,t,e){return e===void 0&&(e=0),X(t.length===2,function(){return"Invalid number of paddings. Must be length of 2."}),au(n,[t],e)}}),klt=nt({pad2d_:function(n,t,e){return e===void 0&&(e=0),X(t.length===2&&t[0].length===2&&t[1].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),au(n,t,e)}}),Ilt=nt({pad3d_:function(n,t,e){return e===void 0&&(e=0),X(t.length===3&&t[0].length===2&&t[1].length===2&&t[2].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),au(n,t,e)}}),Rlt=nt({pad4d_:function(n,t,e){return e===void 0&&(e=0),X(t.length===4&&t[0].length===2&&t[1].length===2&&t[2].length===2&&t[3].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),au(n,t,e)}}),Tlt=nt({rand_:function(n,t,e){var r=Yt(n),o=null;if(e==null||e==="float32")o=new Float32Array(r);else if(e==="int32")o=new Int32Array(r);else{if(e!=="bool")throw new Error("Unknown data type "+e);o=new Uint8Array(r)}for(var a=0;a<r;a++)o[a]=t();return st.makeTensor(o,n,e)}}),Gk=function(){function n(t,e,r,o,a){this.mean=t,this.stdDev=e,this.dtype=r,this.nextVal=NaN,this.truncated=o,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var i=a||Math.random();this.random=o1(i.toString())}return n.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var t=this.nextVal;return this.nextVal=NaN,t}for(var e,r,o=!1;!o;){var a=void 0,i=void 0,s=void 0;do s=(a=2*this.random()-1)*a+(i=2*this.random()-1)*i;while(s>=1||s===0);var u=Math.sqrt(-2*Math.log(s)/s);e=this.mean+this.stdDev*a*u,r=this.mean+this.stdDev*i*u,this.truncated&&!this.isValidTruncated(e)||(o=!0)}return this.truncated&&!this.isValidTruncated(r)||(this.nextVal=this.convertValue(r)),this.convertValue(e)},n.prototype.convertValue=function(t){return this.dtype==null||this.dtype==="float32"?t:Math.round(t)},n.prototype.isValidTruncated=function(t){return t<=this.upper&&t>=this.lower},n}(),Nlt=function(){function n(t,e,r,o){this.alpha=t,this.beta=1/e,this.dtype=r;var a=o||Math.random();this.randu=o1(a.toString()),this.randn=new Gk(0,1,r,!1,this.randu()),this.d=t<1?t+2/3:t-1/3,this.c=1/Math.sqrt(9*this.d)}return n.prototype.nextValue=function(){for(var t,e,r,o,a,i;;){do o=this.randn.nextValue(),i=1+this.c*o;while(i<=0);if(i*=i*i,e=1-.331*(t=o*o)*t,r=.5*t+this.d*(1-i+Math.log(i)),(a=this.randu())<e||Math.log(a)<r)break}return i=1/this.beta*this.d*i,this.alpha<1&&(i*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(i)},n.prototype.convertValue=function(t){return this.dtype==="float32"?t:Math.round(t)},n}(),Alt=function(){function n(t,e,r,o){var a=this;if(t===void 0&&(t=0),e===void 0&&(e=1),this.canReturnFloat=function(){return a.dtype==null||a.dtype==="float32"},this.min=t,this.range=e-t,this.dtype=r,o==null&&(o=Math.random()),typeof o=="number"&&(o=o.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+t+" - "+e+" <= 1 and dtype is not float");this.random=o1(o)}return n.prototype.convertValue=function(t){return this.canReturnFloat()?t:Math.round(t)},n.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},n}(),_lt=nt({randomGamma_:function(n,t,e,r,o){if(e===void 0&&(e=1),r===void 0&&(r="float32"),e==null&&(e=1),r==null&&(r="float32"),r!=="float32"&&r!=="int32")throw new Error("Unsupported data type "+r);for(var a=new Nlt(t,e,r,o),i=Ce(n,r),s=0;s<i.values.length;s++)i.values[s]=a.nextValue();return i.toTensor()}}),Dlt=nt({randomNormal_:function(n,t,e,r,o){if(t===void 0&&(t=0),e===void 0&&(e=1),r!=null&&r==="bool")throw new Error("Unsupported data type "+r);for(var a=new Gk(t,e,r,!1,o),i=Ce(n,r),s=0;s<i.values.length;s++)i.values[s]=a.nextValue();return i.toTensor()}}),OP=nt({randomUniform_:function(n,t,e,r,o){t===void 0&&(t=0),e===void 0&&(e=1),r===void 0&&(r="float32");for(var a=Ce(n,r),i=new Alt(t,e,null,o),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),FP=nt({square_:function(n){var t=j(n,"x","square"),e=[t];return st.runKernelFunc(function(r,o){return o([t]),r.square(t)},{x:t},null,"Square",{},e,[])}}),MP=nt({squaredDifference_:function(n,t){var e,r=j(n,"a","squaredDifference"),o=j(t,"b","squaredDifference");e=Vn(r,o),r=e[0],o=e[1],Pe(r.shape,o.shape);var a={a:r,b:o},i=[r,o];return st.runKernelFunc(function(s,u){var l=s.squaredDifference(r,o);return u([r,o]),l},a,function(s,u){var l=u[0],c=u[1],h=ae(2);return{a:function(){return s.mul(l.sub(c).mul(h))},b:function(){return s.mul(c.sub(l).mul(h))}}},e1,{},i,[])}}),$lt=nt({truncatedNormal_:function(n,t,e,r,o){if(t===void 0&&(t=0),e===void 0&&(e=1),r!=null&&r==="bool")throw new Error("Unsupported data type $ { dtype }");for(var a=new Gk(t,e,r,!0,o),i=Ce(n,r),s=0;s<i.values.length;s++)i.values[s]=a.nextValue();return i.toTensor()}}),LP=nt({equal_:function(n,t){var e,r=j(n,"a","equal"),o=j(t,"b","equal");return e=Vn(r,o),r=e[0],o=e[1],Pe(r.shape,o.shape),st.runKernelFunc(function(a){return a.equal(r,o)},{$a:r,$b:o})}}),Olt=nt({equalStrict_:function(n,t){var e=j(n,"a","equalStrict"),r=j(t,"b","equalStrict");return cn(e.shape,r.shape,"Error in equalStrict: "),e.equal(r)}}),Flt=nt({greater_:function(n,t){var e,r=j(n,"a","greater"),o=j(t,"b","greater");return e=Vn(r,o),r=e[0],o=e[1],Pe(r.shape,o.shape),st.runKernelFunc(function(a){return a.greater(r,o)},{a:r,b:o},null,"Greater")}}),PP=nt({greaterEqual_:function(n,t){var e,r=j(n,"a","greaterEqual"),o=j(t,"b","greaterEqual");return e=Vn(r,o),r=e[0],o=e[1],Pe(r.shape,o.shape),st.runKernelFunc(function(a,i){var s=a.greaterEqual(r,o);return i([r,o]),s},{a:r,b:o},function(a,i){var s=i[0],u=i[1];return{a:function(){return je(s)},b:function(){return je(u)}}},"GreaterEqual")}}),Mlt=nt({greaterEqualStrict_:function(n,t){var e=j(n,"a","greaterEqualStrict"),r=j(t,"b","greaterEqualStrict");return cn(e.shape,r.shape,"Error in greaterEqualStrict: "),e.greaterEqual(r)}}),Llt=nt({greaterStrict_:function(n,t){var e=j(n,"a","greaterStrict"),r=j(t,"b","greaterStrict");return cn(e.shape,r.shape,"Error in greaterStrict: "),e.greater(r)}}),Plt=nt({less_:function(n,t){var e,r=j(n,"a","less"),o=j(t,"b","less");return e=Vn(r,o),r=e[0],o=e[1],Pe(r.shape,o.shape),st.runKernelFunc(function(a){return a.less(r,o)},{a:r,b:o},null,"Less")}}),Blt=nt({lessEqual_:function(n,t){var e,r=j(n,"a","lessEqual"),o=j(t,"b","lessEqual");return e=Vn(r,o),r=e[0],o=e[1],Pe(r.shape,o.shape),st.runKernelFunc(function(a,i){var s=a.lessEqual(r,o);return i([r,o]),s},{a:r,b:o},null,"LessEqual")}}),zlt=nt({lessEqualStrict_:function(n,t){var e=j(n,"a","lessEqualStrict"),r=j(t,"b","lessEqualStrict");return cn(e.shape,r.shape,"Error in lessEqualStrict: "),e.lessEqual(r)}}),Ult=nt({lessStrict_:function(n,t){var e=j(n,"a","lessStrict"),r=j(t,"b","lessStrict");return cn(e.shape,r.shape,"Error in lessStrict: "),e.less(r)}}),Wlt=nt({notEqual_:function(n,t){var e,r=j(n,"a","notEqual"),o=j(t,"b","notEqual");return e=Vn(r,o),r=e[0],o=e[1],Pe(r.shape,o.shape),st.runKernelFunc(function(a){return a.notEqual(r,o)},{a:r,b:o},null,"NotEqual")}}),Vlt=nt({notEqualStrict_:function(n,t){var e=j(n,"a","notEqualStrict"),r=j(t,"b","notEqualStrict");return cn(e.shape,r.shape,"Error in notEqualStrict: "),e.notEqual(r)}});function BO(n,t){for(var e=[],r=n;r<t;++r)e.push(r);return e}function zO(n){for(var t=[],e=0;e<n.length;++e)for(var r=0;r<n[e].length;++r)t.push(n[e][r]);return t}var Hk=nt({gather_:function(n,t,e){e===void 0&&(e=0);var r=j(n,"x","gather"),o=j(t,"indices","gather","int32");e=_r(e,r.shape)[0];var a=function(i,s,u){for(var l=i.shape[u],c=[],h=1,d=1,p=0;p<u;p++)c.push(i.shape[p]),h*=i.shape[p];for(p=0;p<s.rank;p++)c.push(s.shape[p]);for(p=u+1;p<i.rank;p++)c.push(i.shape[p]),d*=i.shape[p];return{batchSize:h,sliceSize:d,dimSize:l,outputShape:c}}(r,o,e);return st.runKernelFunc(function(i,s){var u=i.gather(r,o.flatten(),e);return s([o]),u},{x:r,indices:o},function(i,s){var u=s[0];return{x:function(){var l=r.shape,c=u.size,h=l.slice(0,e),d=h.length,p=l.slice(e,l.length).slice(1),g=p.length,x=BO(0,d),y=BO(d+1,d+1+g),b=zO([h,[c],p]),C=i.reshape(b),E=u.reshape([c]),S=zO([[d],x,y]),k=C.transpose(S),R=BP(k,E,r.shape[e]),A=Dk(S);return R=R.transpose(A)},indices:function(){return u}}},"Gather",{axis:e}).reshape(a.outputShape)}}),BP=nt({unsortedSegmentSum_:function(n,t,e){var r=j(n,"x","unsortedSegmentSum"),o=j(t,"segmentIds","unsortedSegmentSum","int32");return X(ur(e),function(){return"numSegments must be of dtype int"}),st.runKernelFunc(function(a,i){var s=a.unsortedSegmentSum(r,o,e);return i([o]),s},{$x:r},function(a,i){var s=i[0];return{$x:function(){return function(u,l){for(var c=Fk(l,je(l)),h=Hk(u,c),d=PP(l,ae(0,"int32")),p=h.rank-d.rank,g=0;g<p;++g)d=zu(d,g+1);d=i1(d,ud(h.shape,"bool"));var x=je(h);return kc(d,h,x)}(a,s)}}})}}),Glt=function(n,t,e){return Qt(this,void 0,void 0,function(){var r,o,a,i,s,u,l,c,h,d,p,g,x;return Zt(this,function(y){switch(y.label){case 0:for(r=j(n,"tensor","boolMask"),o=j(t,"mask","boolMask","bool"),a=e??0,i=o.rank,s=r.shape,X(i>0,function(){return"mask cannot be scalar"}),cn(s.slice(a,a+i),o.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,l=a;l<a+i;l++)u*=s[l];return c=s.slice(0,a).concat([u],s.slice(a+i)),h=r.reshape(c),d=o.reshape([-1]),[4,_P(d)];case 1:return p=y.sent(),g=p.squeeze([1]),x=Hk(h,g,a),n!==r&&r.dispose(),t!==o&&o.dispose(),g.dispose(),h.dispose(),d.dispose(),p.dispose(),[2,x]}})})};function zP(n,t,e,r,o,a,i){a===void 0&&(a="NHWC"),X(n.length===t.rank,function(){return"Length of inShape ("+n.length+") and rank of dy ("+t.rank+") must match"});var s=n,u=t,l=!1;t.rank===3&&(l=!0,u=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]),s=[1,n[0],n[1],n[2]]),X(s.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+s.length+"."}),X(u.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+u.rank}),X(e.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+e.rank});var c=a==="NHWC"?s[3]:s[1],h=a==="NHWC"?u.shape[3]:u.shape[1];X(c===e.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+c+") must match input depth for filter "+e.shape[2]+"."}),X(h===e.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+h+") must match output depth for filter "+e.shape[3]+"."}),i!=null&&X(ur(o),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."});var d=Lk(a),p=Kc(s,e.shape,r,1,o,i,!1,d),g=st.runKernelFunc(function(x,y){var b=x.conv2dDerInput(u,e,p);return y([e,u]),b},{dy4D:u,filter:e},function(x,y){var b=y[0],C=y[1];return{dy4D:function(){return Qc(x,b,r,o,a,1,i)},filter:function(){return qk(x,C,b.shape,r,o,a,i)}}});return l?g.as3D(g.shape[1],g.shape[2],g.shape[3]):g}function qC(n){var t=function(a){return typeof a=="number"?[a,a,a]:a.length===2?[a[0],a[1],1]:a}(n),e=t[0],r=t[1],o=t[2];return e===1&&r===1&&o===1}function UP(n,t,e,r,o){X(n.length===t.rank,function(){return"Length of inShape ("+n.length+") and rank of dy ("+t.rank+") must match"});var a=n,i=t,s=!1;t.rank===4&&(s=!0,i=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]),a=[1,n[0],n[1],n[2],n[3]]);var u=a[4],l=i.shape[4];X(a.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+a.length+"."}),X(i.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+i.rank}),X(e.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+e.rank}),X(u===e.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+u+") must match input depth for filter "+e.shape[3]+"."}),X(l===e.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+l+") must match output depth for filter "+e.shape[4]+"."});var c=uy(a,e.shape,r,1,o),h=st.runKernelFunc(function(d){return d.conv3dDerInput(i,e,c)},{dy5D:i});return s?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}var Hlt=nt({conv1d_:function(n,t,e,r,o,a,i){o===void 0&&(o="NWC"),a===void 0&&(a=1);var s=j(n,"x","conv1d"),u=j(t,"filter","conv1d"),l=s,c=!1;s.rank===2&&(c=!0,l=s.as3D(1,s.shape[0],s.shape[1])),X(l.rank===3,function(){return"Error in conv1d: input must be rank 3, but got rank "+l.rank+"."}),X(u.rank===3,function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."}),i!=null&&X(ur(r),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."}),X(l.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input ("+l.shape[2]+") must match input depth for filter "+u.shape[1]+"."}),X(_o(e,a),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+e+" and dilation '"+a+"'"}),X(o==="NWC",function(){return"Error in conv1d: got dataFormat of "+o+" but only NWC is currently supported."});var h=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),d=l.as4D(l.shape[0],1,l.shape[1],l.shape[2]),p=Qc(d,h,[1,e],r,"NHWC",[1,a],i);return c?p.as2D(p.shape[2],p.shape[3]):p.as3D(p.shape[0],p.shape[2],p.shape[3])}}),Qc=nt({conv2d_:function(n,t,e,r,o,a,i){o===void 0&&(o="NHWC"),a===void 0&&(a=[1,1]);var s=j(n,"x","conv2d"),u=j(t,"filter","conv2d"),l=s,c=!1;s.rank===3&&(c=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),X(l.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank "+l.rank+"."}),X(u.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."}),i!=null&&X(ur(r),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."});var h=o==="NHWC"?l.shape[3]:l.shape[1];X(h===u.shape[2],function(){return"Error in conv2d: depth of input ("+h+") must match input depth for filter "+u.shape[2]+"."}),X(_o(e,a),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+a+"'"});var d=Lk(o),p=Kc(l.shape,u.shape,e,a,r,i,!1,d),g=[u,l],x=st.runKernelFunc(function(y,b){var C=y.conv2d(l,u,p);return b([u,l]),C},{x:l,filter:u},function(y,b){var C=b,E=C[0],S=C[1];return X(zf(a),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+a+"'"}),{x:function(){return WP(S.shape,y,E,e,r,o)},filter:function(){return qk(S,y,E.shape,e,r,o)}}},"Conv2D",p,g);return c?x.as3D(x.shape[1],x.shape[2],x.shape[3]):x}}),qlt=nt({conv3d_:function(n,t,e,r,o,a){o===void 0&&(o="NDHWC"),a===void 0&&(a=[1,1,1]);var i=j(n,"x","conv3d"),s=j(t,"filter","conv3d"),u=i,l=!1;i.rank===4&&(l=!0,u=i.as5D(1,i.shape[0],i.shape[1],i.shape[2],i.shape[3])),X(u.rank===5,function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."}),X(s.rank===5,function(){return"Error in conv3d: filter must be rank 5, but got rank "+s.rank+"."}),X(u.shape[4]===s.shape[3],function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match input depth for filter "+s.shape[3]+"."}),X(function(d,p){return qC(d)||qC(p)}(e,a),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+a+"'"}),X(o==="NDHWC",function(){return"Error in conv3d: got dataFormat of "+o+" but only NDHWC is currently supported."});var c=uy(u.shape,s.shape,e,a,r),h=st.runKernelFunc(function(d,p){var g=d.conv3d(u,s,c);return p([u,s]),g},{x:u,$filter:s},function(d,p){X(qC(a),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+a+"'"});var g=p[0],x=p[1];return{x:function(){return UP(g.shape,d,x,e,r)},$filter:function(){return function(y,b,C,E,S){var k=y;y.rank===4&&(k=y.as5D(1,y.shape[0],y.shape[1],y.shape[2],y.shape[3]));var R=b;R.rank===4&&(R=b.as5D(1,b.shape[0],b.shape[1],b.shape[2],b.shape[3])),X(k.rank===5,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+k.shape+"."}),X(R.rank===5,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+R.shape+"."}),X(C.length===5,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+C+"."}),X(k.shape[4]===C[3],function(){return"Error in conv3dDerFilter: depth of input "+k.shape[4]+") must match input depth in filter ("+C[3]+"."}),X(R.shape[4]===C[4],function(){return"Error in conv3dDerFilter: depth of dy ("+R.shape[4]+") must match output depth for filter ("+C[4]+")."});var A=uy(k.shape,C,E,1,S);return st.runKernelFunc(function(N){return N.conv3dDerFilter(k,R,A)},{x5D:k,dy5D:R})}(g,d,x.shape,e,r)}}});return l?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),qk=nt({conv2dDerFilter_:function(n,t,e,r,o,a,i){a===void 0&&(a="NHWC");var s=n;n.rank===3&&(s=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var u=t;u.rank===3&&(u=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),X(s.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+s.shape+"."}),X(u.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+u.shape+"."}),X(e.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+e+"."});var l=a==="NHWC"?s.shape[3]:s.shape[1],c=a==="NHWC"?u.shape[3]:u.shape[1];X(l===e[2],function(){return"Error in conv2dDerFilter: depth of input "+l+") must match input depth in filter ("+e[2]+"."}),X(c===e[3],function(){return"Error in conv2dDerFilter: depth of dy ("+c+") must match output depth for filter ("+e[3]+")."}),i!=null&&X(ur(o),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."});var h=Lk(a),d=Kc(s.shape,e,r,1,o,i,!1,h);return st.runKernelFunc(function(p){return p.conv2dDerFilter(s,u,d)},{x4D:s,dy4D:u})}}),WP=nt({conv2dDerInput_:zP}),jk=nt({depthwiseConv2d_:function(n,t,e,r,o,a,i){a===void 0&&(a=[1,1]);var s=j(n,"x","depthwiseConv2d"),u=j(t,"filter","depthwiseConv2d"),l=s,c=!1;s.rank===3&&(c=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),X(l.rank===4,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+l.rank+"."}),X(u.rank===4,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."}),X(l.shape[3]===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+l.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."}),a==null&&(a=[1,1]),X(_o(e,a),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+a+"'"}),i!=null&&X(ur(r),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."});var h=Kc(l.shape,u.shape,e,a,r,i,!0),d=[l,u],p=st.runKernelFunc(function(g,x){var y=g.depthwiseConv2D(l,u,h);return x([l,u]),y},{x:l,filter:u},function(g,x){X(zf(a),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+a+"'"});var y=x[0],b=x[1];return{x:function(){return VP(y.shape,g,b,h)},filter:function(){return GP(y,g,b.shape,h)}}},"DepthwiseConv2dNative",h,d);return c?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}}),VP=nt({depthwiseConv2dDerInput_:function(n,t,e,r){var o=t,a=!1;t.rank===3&&(a=!0,o=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var i=st.runKernelFunc(function(s){return s.depthwiseConv2DDerInput(o,e,r)},{dy4D:o});return a?i.as3D(i.shape[1],i.shape[2],i.shape[3]):i}}),GP=nt({depthwiseConv2dDerFilter_:function(n,t,e,r){var o=n;n.rank===3&&(o=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var a=t;return a.rank===3&&(a=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),st.runKernelFunc(function(i){return i.depthwiseConv2DDerFilter(o,a,r)},{x4D:o,dy4D:a})}}),HP=nt({separableConv2d_:function(n,t,e,r,o,a,i){a===void 0&&(a=[1,1]),i===void 0&&(i="NHWC");var s=j(n,"x","separableConv2d"),u=j(t,"depthwiseFilter","separableConv2d"),l=j(e,"pointwiseFilter","separableConv2d"),c=s,h=!1;if(s.rank===3&&(h=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),i==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");X(c.rank===4,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+c.rank+"."}),X(u.rank===4,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."}),X(l.rank===4,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."}),X(l.shape[0]===1,function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+l.shape[0]+"."}),X(l.shape[1]===1,function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+l.shape[1]+"."});var d=u.shape[2],p=u.shape[3];X(l.shape[2]===d*p,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+d*p+", but got "+l.shape[2]+"."});var g=jk(c,u,r,o,i,a),x=Qc(g,l,1,"valid",i);return h?x.as3D(x.shape[1],x.shape[2],x.shape[3]):x}}),jlt=nt({conv2dTranspose_:function(n,t,e,r,o,a){return zP(e,j(n,"x","conv2dTranspose"),j(t,"filter","conv2dTranspose"),r,o,"NHWC",a)}}),Xlt=nt({conv3dTranspose_:function(n,t,e,r,o){return UP(e,j(n,"x","conv3dTranspose"),j(t,"filter","conv3dTranspose"),r,o)}}),qP=nt({matMul_:function(n,t,e,r){var o;e===void 0&&(e=!1),r===void 0&&(r=!1);var a=j(n,"a","matMul"),i=j(t,"b","matMul");o=Vn(a,i),a=o[0],i=o[1];var s=e?a.shape[a.rank-2]:a.shape[a.rank-1],u=r?i.shape[i.rank-1]:i.shape[i.rank-2],l=e?a.shape[a.rank-1]:a.shape[a.rank-2],c=r?i.shape[i.rank-2]:i.shape[i.rank-1],h=a.shape.slice(0,-2),d=i.shape.slice(0,-2),p=Yt(h),g=Yt(d);X(a.rank>=2&&i.rank>=2&&a.rank===i.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+a.rank+" and "+i.rank+"."}),X(zr(h,d),function(){return"Error in matMul: outer dimensions ("+h+") and ("+d+") of Tensors with shapes "+a.shape+" and "+i.shape+" must match."}),X(s===u,function(){return"Error in matMul: inner shapes ("+s+") and ("+u+") of Tensors with shapes "+a.shape+" and "+i.shape+" and transposeA="+e+" and transposeB="+r+" must match."});var x=a.shape.slice(0,-2).concat([l,c]),y=e?a.as3D(p,s,l):a.as3D(p,l,s),b=r?i.as3D(g,c,u):i.as3D(g,u,c),C={transposeA:e,transposeB:r};return st.runKernelFunc(function(E,S){var k=E.batchMatMul(y,b,e,r);return S([y,b]),k},{a:y,b},function(E,S){var k=S,R=k[0],A=k[1];return e||r?!e&&r?{a:function(){return E.matMul(A,!1,!1)},b:function(){return E.matMul(R,!0,!1)}}:e&&!r?{a:function(){return A.matMul(E,!1,!0)},b:function(){return R.matMul(E,!1,!1)}}:{a:function(){return A.matMul(E,!0,!0)},b:function(){return E.matMul(R,!0,!0)}}:{a:function(){return E.matMul(A,!1,!0)},b:function(){return R.matMul(E,!0,!1)}}},"BatchMatMul",C).reshape(x)}}),Klt=nt({dot_:function(n,t){var e=j(n,"t1","dot"),r=j(t,"t2","dot");X(!(e.rank!==1&&e.rank!==2||r.rank!==1&&r.rank!==2),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+e.rank+" and "+r.rank+"."});var o=e.rank===1?e.size:e.shape[1],a=r.rank===1?r.size:r.shape[0];return X(o===a,function(){return"Error in dot: inner dimensions of inputs must match, but got "+o+" and "+a+"."}),e.rank===1&&r.rank===1?e.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():e.rank===1&&r.rank===2?e.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():e.rank===2&&r.rank===1?e.matMul(r.as2D(-1,1)).as1D():e.matMul(r.as2D(r.shape[0],r.shape[1]))}}),Ylt=nt({outerProduct_:function(n,t){var e=j(n,"v1","outerProduct"),r=j(t,"v2","outerProduct");return X(e.rank===1&&r.rank===1,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+e.rank+" and "+r.rank+"."}),e.as2D(-1,1).matMul(r.as2D(1,-1))}}),Wm=nt({reverse_:function(n,t){var e=j(n,"x","reverse");if(e.rank===0)return e.clone();var r=_r(t,e.shape);return st.runKernelFunc(function(o){return o.reverse(e,r)},{$x:e},function(o){return{$x:function(){return o.reverse(r)}}}).reshapeAs(e)}}),Qlt=nt({reverse1d_:function(n){var t=j(n,"x","reverse");return X(t.rank===1,function(){return"Error in reverse1D: x must be rank 1 but got rank "+t.rank+"."}),Wm(t,0)}}),Zlt=nt({reverse2d_:function(n,t){var e=j(n,"x","reverse");return X(e.rank===2,function(){return"Error in reverse2D: x must be rank 2 but got rank "+e.rank+"."}),Wm(e,t)}}),Jlt=nt({reverse3d_:function(n,t){var e=j(n,"x","reverse");return X(e.rank===3,function(){return"Error in reverse3D: x must be rank 3 but got rank "+e.rank+"."}),Wm(e,t)}}),tct=nt({reverse4d_:function(n,t){var e=j(n,"x","reverse");return X(e.rank===4,function(){return"Error in reverse4D: x must be rank 4 but got rank "+e.rank+"."}),Wm(e,t)}});function jP(n,t,e,r,o,a){var i=j(n,"x","maxPool"),s=i,u=!1;i.rank===3&&(u=!0,s=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),X(s.rank===4,function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."}),X(_o(e,r),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+r+"'"}),a!=null&&X(ur(o),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."});var l=Ec(s.shape,t,e,r,o,a);if(l.filterWidth===1&&l.filterHeight===1&&zr(l.inShape,l.outShape))return i.clone();var c=[s],h=st.runKernelFunc(function(d,p){var g=d.maxPool(s,l);return p([s,g]),g},{x:s},function(d,p){var g=p[0],x=p[1];return{x:function(){return function(y,b,C,E,S,k,R,A){var N=j(y,"dy","maxPoolBackprop"),_=j(b,"input","maxPoolBackprop"),$=j(C,"output","maxPoolBackprop");X(_.rank===N.rank,function(){return"Rank of input ("+_.rank+") does not match rank of dy ("+N.rank+")"}),X(_o(S,k),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+S+" and dilations '"+k+"'"}),X(N.rank===4,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+N.rank+"."}),X(_.rank===4,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+_.rank+"."});var D=Ec(_.shape,E,S,k,R,A);return st.runKernelFunc(function(O){return O.maxPoolBackprop(N,_,$,D)},{$dy:N,$input:_})}(d,g,x,t,e,r,o)}}},"MaxPool",l,c);return u?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}function XP(n,t,e,r,o,a){var i=j(n,"x","avgPool","float32");X(_o(e,r),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+r+"'"});var s=i,u=!1;i.rank===3&&(u=!0,s=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),X(s.rank===4,function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."}),a!=null&&X(ur(o),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."});var l=Ec(s.shape,t,e,r,o,a);if(l.filterWidth===1&&l.filterHeight===1&&zr(l.inShape,l.outShape))return i.clone();var c=st.runKernelFunc(function(h){return h.avgPool(s,l)},{x:s},function(h){return{x:function(){return function(d,p,g,x,y,b){var C=j(d,"dy","avgPoolBackprop"),E=j(p,"input","avgPoolBackprop");X(E.rank===C.rank,function(){return"Rank of input ("+E.rank+") does not match rank of dy ("+C.rank+")"}),X(_o(x,y),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+x+" and dilations '"+y+"'"});var S=E,k=C,R=!1;E.rank===3&&(R=!0,S=E.as4D(1,E.shape[0],E.shape[1],E.shape[2]),k=C.as4D(1,C.shape[0],C.shape[1],C.shape[2])),X(k.rank===4,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+k.rank+"."}),X(S.rank===4,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+S.rank+"."});var A=Ec(S.shape,g,x,y,b),N=st.runKernelFunc(function(_){return _.avgPoolBackprop(k,S,A)},{dy4D:k,input4D:S});return R?N.as3D(N.shape[1],N.shape[2],N.shape[3]):N}(h,s,t,e,r,o)}}},"AvgPool",l);return c=c.cast(i.dtype),u?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}var ua=nt({maxPool_:function(n,t,e,r,o){return jP(n,t,e,1,r,o)}}),ect=nt({avgPool_:function(n,t,e,r,o){return XP(n,t,e,1,r,o)}}),nct=nt({pool_:function(n,t,e,r,o,a){o==null&&(o=[1,1]),a==null&&(a=1),r===0&&(r="valid");var i=j(n,"x","maxPool"),s=i,u=!1;i.rank===3&&(u=!0,s=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),X(_o(a,o),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+a+" and dilations '"+o+"'"});var l,c=Ec(s.shape,t,a,o,r),h=[c.dilationHeight,c.dilationWidth];l=r==="same"?function(S,k){var R=S.map(function(_,$){return _+(_-1)*(k[$]-1)}).map(function(_){return _-1}),A=R.map(function(_){return Math.floor(_/2)}),N=R.map(function(_,$){return _-A[$]});return R.map(function(_,$){return[A[$],N[$]]})}([c.filterHeight,c.filterWidth],h):[[0,0],[0,0]];var d=h[0]===1&&h[1]===1,p=function(S,k,R){var A=R.map(function(z){return z[0]}),N=R.map(function(z){return z[1]}),_=S.concat(A,N),$=k.map(function(z,W){return(z-_[W]%z)%z}),D=N.map(function(z,W){return z+$[W]}),O=k.map(function(z,W){return[A[W],D[W]]}),P=k.map(function(z,W){return[0,$[W]]});return[O,P]}([c.inHeight,c.inWidth],h,l),g=p[0],x=p[1],y=d?r:"valid",b=d?s:UL(s,h,g),C=(e==="avg"?function(){return XP(b,t,a,1,y)}:function(){return jP(b,t,a,1,y)})(),E=d?C:zL(C,h,x);return u?E.as3D(E.shape[1],E.shape[2],E.shape[3]):E}}),rct=nt({maxPool3d_:function(n,t,e,r,o,a,i){a===void 0&&(a="NDHWC");var s=j(n,"x","maxPool3d"),u=s,l=!1;s.rank===4&&(l=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),i==null&&(i=[1,1,1]),X(u.rank===5,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+u.rank+"."}),X(a==="NDHWC",function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+a}),X(_o(e,i),function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+i+"'"}),o!=null&&X(ur(r),function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."});var c=sy(u.shape,t,e,i,r,o,a),h=st.runKernelFunc(function(d,p){var g=d.maxPool3d(u,c);return p([u,g]),g},{x:u},function(d,p){var g=p[0],x=p[1];return{x:function(){return function(y,b,C,E,S,k,R,A){var N=j(y,"dy","maxPool3dBackprop"),_=j(b,"input","maxPool3dBackprop"),$=j(C,"output","maxPool3dBackprop"),D=N,O=_,P=$,z=!1;_.rank===4&&(z=!0,D=N.as5D(1,N.shape[0],N.shape[1],N.shape[2],N.shape[3]),O=_.as5D(1,_.shape[0],_.shape[1],_.shape[2],_.shape[3]),P=$.as5D(1,$.shape[0],$.shape[1],$.shape[2],$.shape[3])),X(D.rank===5,function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+D.rank+"."}),X(O.rank===5,function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+O.rank+"."}),X(P.rank===5,function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+P.rank+"."}),k==null&&(k=[1,1,1]),X(_o(S,k),function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+S+" and dilations '"+k+"'"}),A!=null&&X(ur(R),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+A+" but got pad "+R+"."});var W=sy(O.shape,E,S,k,R,A),F=st.runKernelFunc(function(B){return B.maxPool3dBackprop(D,O,P,W)},{dy5D:D,input5D:O});return z?F.as4D(F.shape[1],F.shape[2],F.shape[3],F.shape[4]):F}(d,g,x,t,e,i,r,o)}}});return l?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),oct=nt({avgPool3d_:function(n,t,e,r,o,a,i){a===void 0&&(a="NDHWC");var s=j(n,"x","avgPool3d","float32"),u=s,l=!1;s.rank===4&&(l=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),i==null&&(i=[1,1,1]),X(u.rank===5,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+u.rank+"."}),X(a==="NDHWC",function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+a}),X(_o(e,i),function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+i+"'"}),o!=null&&X(ur(r),function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."});var c=sy(u.shape,t,e,i,r,o,a),h=st.runKernelFunc(function(d){return d.avgPool3d(u,c)},{x:u},function(d){return{x:function(){return function(p,g,x,y,b,C,E){var S=j(p,"dy","avgPool3dBackprop"),k=j(g,"input","avgPool3dBackprop"),R=S,A=k,N=!1;k.rank===4&&(N=!0,R=S.as5D(1,S.shape[0],S.shape[1],S.shape[2],S.shape[3]),A=k.as5D(1,k.shape[0],k.shape[1],k.shape[2],k.shape[3])),X(R.rank===5,function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+R.rank+"."}),X(A.rank===5,function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+A.rank+"."}),b==null&&(b=[1,1,1]),X(_o(y,b),function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+y+" and dilations '"+b+"'"}),E!=null&&X(ur(C),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+E+" but got pad "+C+"."});var _=sy(A.shape,x,y,b,C,E),$=st.runKernelFunc(function(D){return D.avgPool3dBackprop(R,A,_)},{dy5D:R,input5D:A});return N?$.as4D($.shape[1],$.shape[2],$.shape[3],$.shape[4]):$}(d,u,t,e,i,r,o)}}});return h=h.cast(u.dtype),l?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),act=nt({maxPoolWithArgmax_:function(n,t,e,r,o){o===void 0&&(o=!1);var a=j(n,"x","maxPoolWithArgmax"),i={filterSize:t,strides:e,pad:r,includeBatchInIndex:o},s=st.runKernel("MaxPoolWithArgmax",{x:a},i);return{result:s[0],indexes:s[1]}}}),il=nt({slice_:function(n,t,e){var r,o,a=j(n,"x","slice");if(a.rank===0)throw new Error("Slicing scalar is not possible");(r=typeof t=="number"?[t].concat(new Array(a.rank-1).fill(0)):t.length<a.rank?t.concat(new Array(a.rank-t.length).fill(0)):t.slice()).forEach(function(u){X(u!==-1,function(){return"slice() does not support negative begin indexing."})}),o=(o=e==null?new Array(a.rank).fill(-1):typeof e=="number"?[e].concat(new Array(a.rank-1).fill(-1)):e.length<a.rank?e.concat(new Array(a.rank-e.length).fill(-1)):e).map(function(u,l){return u>=0?u:(X(u===-1,function(){return"Negative size values should be exactly -1 but got "+u+" for the slice() size at index "+l+"."}),a.shape[l]-r[l])}),est(a,r,o);var i=a.shape,s={begin:r,size:o};return st.runKernelFunc(function(u){return u.slice(a,r,o)},{x:a},function(u){for(var l=[],c=0;c<u.rank;c++)l.push([r[c],i[c]-r[c]-o[c]]);return{x:function(){return au(u,l)}}},"Slice",s)}}),ict=nt({slice1d_:function(n,t,e){var r=j(n,"x","slice1d");return X(r.rank===1,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"}),il(r,[t],[e])}}),sct=nt({slice2d_:function(n,t,e){var r=j(n,"x","slice2d");return X(r.rank===2,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"}),il(r,t,e)}}),uct=nt({slice3d_:function(n,t,e){var r=j(n,"x","slice3d");return X(r.rank===3,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"}),il(r,t,e)}}),lct=nt({slice4d_:function(n,t,e){var r=j(n,"x","slice4d");return X(r.rank===4,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"}),il(r,t,e)}});function KP(n,t,e,r,o){return t.rank<e.rank&&(t=t.reshape(Ko(t.shape,r))),n.rank<e.rank&&(n=n.reshape(Ko(n.shape,r))),{x:function(){var a=n.mul(e.equal(t).cast(n.dtype));return o==null?a:a.transpose(o)}}}var cct=nt({all_:function(n,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var r=j(n,"x","all","bool"),o=_r(t,r.shape),a=o,i=gs(a,r.rank);i!=null&&(r=r.transpose(i),a=vs(a.length,r.rank));var s=st.runKernelFunc(function(l){return l.all(r,a)},{$x:r});if(e){var u=Ko(s.shape,o);return s.reshape(u)}return s}}),hct=nt({any_:function(n,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var r=j(n,"x","any","bool"),o=_r(t,r.shape),a=o,i=gs(a,r.rank);i!=null&&(r=r.transpose(i),a=vs(a.length,r.rank));var s=st.runKernelFunc(function(l){return l.any(r,a)},{$x:r});if(e){var u=Ko(s.shape,o);return s.reshape(u)}return s}}),fct=nt({argMax_:function(n,t){t===void 0&&(t=0);var e=j(n,"x","argMax");t==null&&(t=0);var r=_r(t,e.shape),o=gs(r,e.rank);o!=null&&(e=e.transpose(o),r=vs(r.length,e.rank));var a={axis:r[0]},i=[e];return st.runKernelFunc(function(s,u){var l=s.argMax(e,r[0]);return u([e]),l},{x:e},function(s,u){var l=u[0];return{x:function(){return je(l)}}},"ArgMax",a,i)}}),dct=nt({argMin_:function(n,t){t===void 0&&(t=0);var e=j(n,"x","argMin");t==null&&(t=0);var r=_r(t,e.shape),o=gs(r,e.rank);return o!=null&&(e=e.transpose(o),r=vs(r.length,e.rank)),st.runKernelFunc(function(a,i){var s=a.argMin(e,r[0]);return i([e]),s},{$x:e},function(a,i){var s=i[0];return{$x:function(){return je(s)}}})}}),pct=nt({logSumExp_:function(n,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var r=j(n,"x","logSumExp"),o=_r(t,r.shape),a=r.max(o,!0),i=r.sub(a).exp().sum(o).log(),s=a.reshape(i.shape).add(i);if(e){var u=Ko(s.shape,o);return s.reshape(u)}return s}}),mct=nt({max_:function(n,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var r=j(n,"x","max"),o=r,a=_r(t,r.shape),i=a,s=gs(i,r.rank);s!=null&&(r=r.transpose(s),i=vs(i.length,r.rank));var u=[r],l=st.runKernelFunc(function(h,d){var p=h.max(r,i);return d([o,p]),p},{x:r},function(h,d){return KP(h,d[1],d[0],a,s)},"Max",{axes:i},u,[!0]);if(e){var c=Ko(l.shape,a);l=l.reshape(c)}return l}}),gct=nt({mean_:function(n,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var r=j(n,"x","mean"),o=_r(t,r.shape),a=Yt(ho(r.shape,o)[1]);return n1(function(i){var s=ae(a);return{value:(s.dtype===i.dtype?i:i.cast(s.dtype)).div(s).sum(t,e),gradFunc:function(u){var l=i.shape.slice();return o.forEach(function(c){l[c]=1}),u.reshape(l).mul(ud(i.shape,"float32")).div(a)}}})(r)}}),vct=nt({min_:function(n,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var r=j(n,"x","min"),o=r,a=_r(t,r.shape),i=a,s=gs(i,r.rank);s!=null&&(r=r.transpose(s),i=vs(i.length,r.rank));var u=[r],l=st.runKernelFunc(function(h,d){var p=h.min(r,i);return d([o,p]),p},{x:r},function(h,d){return KP(h,d[1],d[0],a,s)},"Min",{axes:i},u,[!0]);if(e){var c=Ko(l.shape,a);l=l.reshape(c)}return l}}),xct=nt({moments_:function(n,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var r=_r(t,(n=j(n,"x","moments")).shape),o=n.mean(r,e),a=o.shape;e||(a=Ko(o.shape,r));var i=n.toFloat().sub(o.reshape(a)).square();return{mean:o,variance:i.mean(r,e)}}}),Uu=nt({sum_:function(n,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var r=j(n,"x","sum");r.dtype==="bool"&&(r=r.toInt());var o=_r(t,r.shape);return n1(function(a){var i=gs(o,a.rank),s=o,u=a;i!=null&&(u=a.transpose(i),s=vs(s.length,a.rank));var l=function(p){var g=a.shape.slice();return o.forEach(function(x){g[x]=1}),p.reshape(g).mul(ud(a.shape,"float32"))},c={axes:s},h=st.runKernelFunc(function(p){return p.sum(u,s)},{x:u},function(p){return{x:function(){return l(p)}}},"Sum",c);if(e){var d=Ko(h.shape,o);h=h.reshape(d)}return{value:h,gradFunc:l}})(r)}}),yct=nt({prod_:function(n,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var r=j(n,"x","prod");r.dtype==="bool"&&(r=r.toInt());var o=_r(t,r.shape),a=gs(o,r.rank),i=o,s=r;a!=null&&(s=r.transpose(a),i=vs(i.length,r.rank));var u=st.runKernelFunc(function(c){return c.prod(s,i)},{permutedX:s});if(e){var l=Ko(u.shape,o);u=u.reshape(l)}return u}}),YP=nt({elu_:function(n){var t=j(n,"x","elu");return st.runKernelFunc(function(e,r){var o=e.elu(t);return r([o]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return st.runKernelFunc(function(a){return a.eluDer(e,o)},{dy:e,y:o})}}})}}),bct=nt({leakyRelu_:function(n,t){t===void 0&&(t=.2);var e=j(n,"x","leakyRelu");return Fk(ae(t).mul(e),e)}}),QP=nt({prelu_:function(n,t){var e=j(n,"x","prelu"),r=j(t,"alpha","prelu");return st.runKernelFunc(function(o,a){var i=o.prelu(e,r);return a([e,r]),i},{x:e,alpha:r},function(o,a){var i=a[0],s=a[1],u=i.greater(0);return{x:function(){return kc(u,o,o.mul(s))},alpha:function(){var l=kc(u,je(o),o.mul(i)),c=Ir(s.shape,o.shape);return c.length>0&&(l=l.sum(c)),l.reshape(s.shape)}}},"Prelu")}}),s1=nt({relu_:function(n){var t=j(n,"x","relu");return t.dtype==="bool"?t.toInt():st.runKernelFunc(function(e,r){var o=e.relu(t);return r([t]),o},{x:t},function(e,r){var o=r[0];return{x:function(){return e.mulStrict(o.step().toFloat())}}},"Relu")}}),ZP=nt({relu6_:function(n){var t=j(n,"x","relu6");return t.dtype==="bool"?t.toInt():st.runKernelFunc(function(e,r){var o=e.relu6(t);return r([t]),o},{x:t},function(e,r){var o=r[0],a=o.lessEqual(6).mul(o.step());return{x:function(){return e.mulStrict(a.toFloat())}}},"Relu6")}}),wct=nt({selu_:function(n){var t=j(n,"x","selu");return st.runKernelFunc(function(e,r){var o=e.selu(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){var a=o.greater(ae(0)),i=ae(Wk),s=ae(Vk),u=e.mul(s),l=e.mul(i).mul(o.toFloat().exp());return kc(a,u,l)}}})}}),Cct=nt({localResponseNormalization_:function(n,t,e,r,o){t===void 0&&(t=5),e===void 0&&(e=1),r===void 0&&(r=1),o===void 0&&(o=.5);var a=j(n,"x","localResponseNormalization");X(a.rank===4||a.rank===3,function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `+a.rank+"."}),X(ur(t),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+t+"."});var i=a,s=!1;a.rank===3&&(s=!0,i=a.as4D(1,a.shape[0],a.shape[1],a.shape[2]));var u=st.runKernelFunc(function(l,c){var h=l.localResponseNormalization4D(i,t,e,r,o);return c([i,h]),h},{x4D:i},function(l,c){var h=c[0],d=c[1];return{x4D:function(){return st.runKernelFunc(function(p){return p.LRNGrad(l,h,d,t,e,r,o)},{})}}});return s?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),JP=nt({norm_:function(n,t,e,r){t===void 0&&(t="euclidean"),e===void 0&&(e=null),r===void 0&&(r=!1);var o=function s(u,l,c){if(c===void 0&&(c=null),u.rank===0)return u.abs();if(u.rank!==1&&c===null)return s(u.reshape([-1]),l,c);if(u.rank===1||typeof c=="number"||Array.isArray(c)&&c.length===1){if(l===1)return u.abs().sum(c);if(l===1/0)return u.abs().max(c);if(l===-1/0)return u.abs().min(c);if(l==="euclidean"||l===2)return u.abs().pow(ae(2,"int32")).sum(c).sqrt();throw new Error("Error in norm: invalid ord value: "+l)}if(Array.isArray(c)&&c.length===2){if(l===1)return u.abs().sum(c[0]).max(c[1]-1);if(l===1/0)return u.abs().sum(c[1]).max(c[0]);if(l===-1/0)return u.abs().sum(c[1]).min(c[0]);if(l==="fro"||l==="euclidean")return u.square().sum(c).sqrt();throw new Error("Error in norm: invalid ord value: "+l)}throw new Error("Error in norm: invalid axis: "+c)}(n=j(n,"x","norm"),t,e),a=o.shape;if(r){var i=_r(e,n.shape);a=Ko(o.shape,i)}return o.reshape(a)}}),Sct=nt({basicLSTMCell_:function(n,t,e,r,o,a){var i=j(n,"forgetBias","basicLSTMCell"),s=j(t,"lstmKernel","basicLSTMCell"),u=j(e,"lstmBias","basicLSTMCell"),l=j(r,"data","basicLSTMCell"),c=j(o,"c","basicLSTMCell"),h=j(a,"h","basicLSTMCell"),d=l.concat(h,1).matMul(s).add(u),p=d.shape[0],g=d.shape[1]/4,x=[p,g],y=d.slice([0,0],x),b=d.slice([0,g],x),C=d.slice([0,2*g],x),E=d.slice([0,3*g],x),S=y.sigmoid().mulStrict(b.tanh()).addStrict(c.mulStrict(i.add(C).sigmoid())),k=S.tanh().mulStrict(E.sigmoid());return[S,k]}}),Ect=nt({multiRNNCell_:function(n,t,e,r){for(var o=j(t,"data","multiRNNCell"),a=ty(e,"c","multiRNNCell"),i=ty(r,"h","multiRNNCell"),s=o,u=[],l=0;l<n.length;l++){var c=n[l](s,a[l],i[l]);u.push(c[0]),u.push(c[1]),s=c[1]}var h=[],d=[];for(l=0;l<u.length;l+=2)h.push(u[l]),d.push(u[l+1]);return[h,d]}}),kct=nt({movingAverage_:function(n,t,e,r,o){o===void 0&&(o=!0);var a=j(n,"v","movingAverage"),i=j(t,"x","movingAverage"),s=j(e,"decay","movingAverage");xat(a,i),X(zr(a.shape,i.shape),function(){return"Shape mismatch in v and x"});var u=ae(1),l=u.sub(s),c=i.sub(a).mul(l);if(o){X(r!=null,function(){return"When using zeroDebias: true, step is required."});var h=j(r,"step","movingAverage");c=c.div(u.sub(ay(s,h)))}return a.add(c)}}),Ict=nt({stridedSlice_:function(n,t,e,r,o,a,i,s,u){if(o===void 0&&(o=0),a===void 0&&(a=0),i===void 0&&(i=0),s===void 0&&(s=0),u===void 0&&(u=0),r==null&&(r=new Array(t.length)),i!==0)throw new Error("ellipsis mask is not yet supported");var l=j(n,"x","stridedSlice"),c=yO(s),h=l.shape.slice();c.forEach(function(y){t[y]=0,e[y]=1,h.splice(y,0,1)}),l=l.reshape(h);for(var d=0;d<l.rank;d++)t[d]=nst(o,t,r,l.shape,d),e[d]=rst(a,e,r,l.shape,d),r[d]=r[d]||1;var p=yO(u);p.forEach(function(y){e[y]=t[y]+1,r[y]=1});var g=Mk(t,e,r),x=g.filter(function(y,b){return p.indexOf(b)===-1});return r.every(function(y){return y===1})?il(l,t,g).reshape(x):st.runKernelFunc(function(y){return y.stridedSlice(l,t,e,r)},{$x:l}).reshape(x)}}),Rct=nt({topk_:function(n,t,e){t===void 0&&(t=1),e===void 0&&(e=!0);var r=j(n,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var o=r.shape[r.shape.length-1];if(t>o)throw new Error("'k' passed to topk() must be <= the last dimension ("+o+") but got "+t);var a=st.runKernelFunc(function(i){return i.topk(r,t,e)},{$x:r});return{values:a[0],indices:a[1]}}}),Tct=nt({scatterND_:function(n,t,e){var r=j(n,"indices","scatterND","int32"),o=j(t,"updates","scatterND");return tst(o,r,e),st.runKernelFunc(function(a){return a.scatterND(r,o,e)},{indices:r,updates:o},null,"ScatterNd",{shape:e})}}),Xk=nt({fft_:function(n){X(n.dtype==="complex64",function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+n.dtype+"."});var t=n.shape[n.shape.length-1],e=n.size/t,r=n.as2D(e,t);return st.runKernelFunc(function(o){return o.fft(r)},{input:n}).reshape(n.shape)}}),hy=nt({ifft_:function(n){X(n.dtype==="complex64",function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+n.dtype+"."});var t=n.shape[n.shape.length-1],e=n.size/t,r=n.as2D(e,t);return st.runKernelFunc(function(o){return o.ifft(r)},{input:n}).reshape(n.shape)}}),Kk=nt({rfft_:function(n,t){X(n.dtype==="float32",function(){return"The dtype for rfft() must be real value but got "+n.dtype});var e,r=n.shape[n.shape.length-1],o=n.size/r;if(t!=null&&t<r){var a=n.shape.map(function(b){return 0}),i=n.shape.map(function(b){return b});i[n.shape.length-1]=t,e=n.slice(a,i),r=t}else if(t!=null&&t>r){var s=n.shape.map(function(b){return b});s[n.shape.length-1]=t-r,e=n.concat(Yn(s),n.shape.length-1),r=t}else e=n;var u=e.zerosLike(),l=Kr(e,u).as2D(o,r),c=Xk(l),h=Math.floor(r/2)+1,d=Pa(c),p=Vi(c),g=d.split([h,r-h],d.shape.length-1),x=p.split([h,r-h],p.shape.length-1),y=e.shape.slice();return y[e.shape.length-1]=h,Kr(g[0],x[0]).reshape(y)}}),tB=nt({irfft_:function(n){var t=n.shape[n.shape.length-1],e=n.size/t;if(t<=2){var r=n.as2D(e,t),o=hy(r);return Pa(o)}var a=[e,2*(t-1)],i=Pa(n).as2D(e,t),s=Vi(n).as2D(e,t),u=i.slice([0,1],[e,t-2]).reverse(1),l=s.slice([0,1],[e,t-2]).reverse(1).mul(ae(-1)),c=i.concat(u,1),h=s.concat(l,1);return r=Kr(c,h).as2D(a[0],a[1]),o=hy(r),Pa(o)}}),Nct=Object.freeze({fft:Xk,ifft:hy,rfft:Kk,irfft:tB}),Act=nt({sparseToDense_:function(n,t,e,r){r===void 0&&(r=0);var o=j(n,"sparseIndices","sparseToDense","int32"),a=j(t,"sparseValues","sparseToDense"),i=j(r,"defaultValue","sparseToDense",a.dtype);return function(s,u,l,c){if(s.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+s.dtype+".");if(s.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+s.shape+".");var h=s.rank>0?s.shape[0]:1,d=s.rank>1?s.shape[1]:1;if(l.length!==d)throw new Error("outputShape has incorrect number of elements:, "+l.length+", should be: "+d+".");var p=u.size;if(u.rank!==0&&(u.rank!==1||p!==h))throw new Error("sparseValues has incorrect shape "+u.shape+", should be [] or ["+h+"]");if(u.dtype!==c.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(o,a,e,i),st.runKernelFunc(function(s){return s.sparseToDense(o,a,e,i)},{$sparseIndices:o,$sparseValues:a,$defaultValue:i})}}),_ct=nt({gatherND_:function(n,t){var e=j(t,"indices","gatherND","int32"),r=j(n,"x","gatherND");return st.runKernelFunc(function(o){return o.gatherND(r,e)},{x:r,indices:e},null,"GatherNd")}}),Dct=nt({diag_:function(n){var t=j(n,"x","diag").flatten(),e=n.shape.concat(n.shape);return st.runKernelFunc(function(r){return r.diag(t)},{$x:t}).reshape(e)}}),$ct=nt({dropout_:function(n,t,e,r){var o=j(n,"x","dropout");if(X(o.dtype==="float32",function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+o.dtype+" tensor instead."}),X(t>=0&&t<1,function(){return"rate must be a float in the range [0, 1), but got "+t+"."}),t===0)return n instanceof Tn?o.clone():o;var a=function(u,l){if(l==null)return u.shape.slice();if(zr(u.shape,l))return l;if(u.shape.length===l.length){for(var c=[],h=0;h<u.shape.length;h++)l[h]==null&&u.shape[h]!=null?c.push(u.shape[h]):c.push(l[h]);return c}return l}(o,e),i=1-t,s=OP(a,0,1,"float32",r).add(i).floor().div(i);return o.mul(s)}});function eB(n,t,e){for(var r=1-n%2,o=new Float32Array(n),a=0;a<n;++a){var i=2*Math.PI*a/(n+r-1);o[a]=t-e*Math.cos(i)}return vi(o,"float32")}var Yk=nt({hannWindow_:function(n){return eB(n,.5,.5)}}),nB=nt({hammingWindow_:function(n){return eB(n,.54,.46)}}),Qk=nt({frame_:function(n,t,e,r,o){r===void 0&&(r=!1),o===void 0&&(o=0);for(var a=0,i=[];a+t<=n.size;)i.push(il(n,a,t)),a+=e;if(r)for(;a<n.size;){var s=a+t-n.size,u=Ha([il(n,a,t-s),gc([s],o)]);i.push(u),a+=e}return i.length===0?mc([],[0,t]):Ha(i).as2D(i.length,t)}}),rB=nt({stft_:function(n,t,e,r,o){var a;o===void 0&&(o=Yk),r==null&&(a=t,r=Math.floor(Math.pow(2,Math.ceil(Math.log(a)/Math.log(2)))));for(var i=Qk(n,t,e),s=Kn(i,o(t)),u=[],l=0;l<i.shape[0];l++)u.push(Kk(s.slice([l,0],[1,t]),r));return Ha(u)}}),Oct=Object.freeze({hannWindow:Yk,hammingWindow:nB,frame:Qk,stft:rB}),vo,Fct=function(n,t,e){return e===void 0&&(e=1),Qt(this,void 0,void 0,function(){var r,o,a,i,s,u,l,c,h,d,p,g,x,y;return Zt(this,function(b){switch(b.label){case 0:return r=j(n,"predictions","inTopK"),o=j(t,"targets","inTopK"),X(r.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+r.rank}),X(r.rank-1===o.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+r.rank+" and targets rank "+o.rank}),cn(r.shape.slice(0,r.shape.length-1),o.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),a=r.shape[r.shape.length-1],X(e>0&&e<=a,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+a+"), but got "+e}),[4,r.data()];case 1:return i=b.sent(),[4,o.data()];case 2:for(s=b.sent(),u=[i.length/a,a],c=u[1],h=Lf("bool",l=u[0]),d=0;d<l;d++){for(p=d*c,g=i.subarray(p,p+c),x=[],y=0;y<g.length;y++)x.push({value:g[y],index:y});for(x.sort(function(C,E){return E.value-C.value}),h[d]=0,y=0;y<e;y++)if(x[y].index===s[d]){h[d]=1;break}}return n!==r&&r.dispose(),t!==o&&o.dispose(),[2,Qr(h,o.shape,"bool")]}})})};(function(n){n[n.NONE=0]="NONE",n[n.MEAN=1]="MEAN",n[n.SUM=2]="SUM",n[n.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(vo||(vo={}));var Mct=nt({absoluteDifference_:function(n,t,e,r){r===void 0&&(r=vo.SUM_BY_NONZERO_WEIGHTS);var o=j(n,"labels","absoluteDifference"),a=j(t,"predictions","absoluteDifference"),i=null;e!=null&&(i=j(e,"weights","absoluteDifference")),cn(o.shape,a.shape,"Error in absoluteDifference: ");var s=o.sub(a).abs();return iu(s,i,r)}}),iu=nt({computeWeightedLoss_:function(n,t,e){e===void 0&&(e=vo.SUM_BY_NONZERO_WEIGHTS);var r=j(n,"losses","computeWeightedLoss"),o=null;t!=null&&(o=j(t,"weights","computeWeightedLoss"));var a=o==null?r:r.mul(o);if(e===vo.NONE)return a;if(e===vo.SUM)return a.sum();if(e===vo.MEAN){if(o==null)return a.mean();var i=r.size/o.size,s=a.sum().div(o.sum());return i>1?s.div(ae(i)):s}if(e===vo.SUM_BY_NONZERO_WEIGHTS){if(o==null)return a.sum().div(ae(r.size));var u=o.mul(ud(r.shape)).notEqual(ae(0)).sum().toFloat();return a.sum().div(u)}throw Error("Unknown reduction: "+e)}}),Lct=nt({cosineDistance_:function(n,t,e,r,o){o===void 0&&(o=vo.SUM_BY_NONZERO_WEIGHTS);var a=j(n,"labels","cosineDistance"),i=j(t,"predictions","cosineDistance"),s=null;r!=null&&(s=j(r,"weights","cosineDistance")),cn(a.shape,i.shape,"Error in cosineDistance: ");var u=ae(1).sub(a.mul(i).sum(e,!0));return iu(u,s,o)}}),Pct=nt({hingeLoss_:function(n,t,e,r){r===void 0&&(r=vo.SUM_BY_NONZERO_WEIGHTS);var o=j(n,"labels","hingeLoss"),a=j(t,"predictions","hingeLoss"),i=null;e!=null&&(i=j(e,"weights","hingeLoss")),cn(o.shape,a.shape,"Error in hingeLoss: ");var s=ae(1);o=ae(2).mul(o).sub(s);var u=s.sub(o.mul(a)).relu();return iu(u,i,r)}}),Bct=nt({huberLoss_:function(n,t,e,r,o){r===void 0&&(r=1),o===void 0&&(o=vo.SUM_BY_NONZERO_WEIGHTS);var a=j(n,"labels","huberLoss"),i=j(t,"predictions","huberLoss"),s=null;e!=null&&(s=j(e,"weights","huberLoss")),cn(a.shape,i.shape,"Error in huberLoss: ");var u=ae(r),l=i.sub(a).abs(),c=JL(l,u),h=l.sub(c),d=ae(.5).mul(c.square()).add(u.mul(h));return iu(d,s,o)}}),zct=nt({logLoss_:function(n,t,e,r,o){r===void 0&&(r=1e-7),o===void 0&&(o=vo.SUM_BY_NONZERO_WEIGHTS);var a=j(n,"labels","logLoss"),i=j(t,"predictions","logLoss"),s=null;e!=null&&(s=j(e,"weights","logLoss")),cn(a.shape,i.shape,"Error in logLoss: ");var u=ae(1),l=ae(r),c=a.mul(i.add(l).log()).neg().sub(u.sub(a).mul(u.sub(i).add(l).log()));return iu(c,s,o)}}),Uct=nt({meanSquaredError_:function(n,t,e,r){r===void 0&&(r=vo.SUM_BY_NONZERO_WEIGHTS);var o=j(n,"labels","meanSquaredError"),a=j(t,"predictions","meanSquaredError"),i=null;e!=null&&(i=j(e,"weights","meanSquaredError")),cn(o.shape,a.shape,"Error in meanSquaredError: ");var s=o.squaredDifference(a);return iu(s,i,r)}}),Wct=nt({sigmoidCrossEntropy_:function(n,t,e,r,o){r===void 0&&(r=0),o===void 0&&(o=vo.SUM_BY_NONZERO_WEIGHTS);var a=j(n,"multiClassLabels","sigmoidCrossEntropy"),i=j(t,"logits","sigmoidCrossEntropy"),s=null;if(e!=null&&(s=j(e,"weights","sigmoidCrossEntropy")),cn(a.shape,i.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=ae(r),l=ae(1),c=ae(.5);a=a.mul(l.sub(u)).add(c.mul(u))}var h=function(d,p){var g=j(d,"labels","sigmoidCrossEntropyWithLogits"),x=j(p,"logits","sigmoidCrossEntropyWithLogits");cn(g.shape,x.shape,"Error in sigmoidCrossEntropyWithLogits: ");var y=x.relu(),b=x.mul(g),C=x.abs().neg().exp().log1p();return y.sub(b).add(C)}(a,i);return iu(h,s,o)}}),Vct=nt({softmaxCrossEntropy_:function(n,t,e,r,o){r===void 0&&(r=0),o===void 0&&(o=vo.SUM_BY_NONZERO_WEIGHTS);var a=j(n,"onehotLabels","softmaxCrossEntropy"),i=j(t,"logits","softmaxCrossEntropy"),s=null;if(e!=null&&(s=j(e,"weights","softmaxCrossEntropy")),cn(a.shape,i.shape,"Error in softmaxCrossEntropy: "),r>0){var u=ae(r),l=ae(1),c=ae(a.shape[1]);a=a.mul(l.sub(u)).add(u.div(c))}var h=function(d,p,g){if(g===void 0&&(g=-1),g===-1&&(g=p.rank-1),g!==p.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+p.rank+" and dim was "+g);return n1(function(x,y,b){var C=y.logSumExp([g],!0),E=y.toFloat().sub(C);return b([x,E]),{value:E.mul(x).neg().sum([g]),gradFunc:function(S,k){var R=k[0],A=k[1],N=Ko(S.shape,[g]);return[S.reshape(N).mul(R.toFloat().sub(A.exp())),S.reshape(N).mul(A.exp().sub(R.toFloat()))]}}})(d,p)}(a,i);return iu(h,s,o)}}),Gct=Object.freeze({get Reduction(){return vo},absoluteDifference:Mct,computeWeightedLoss:iu,cosineDistance:Lct,hingeLoss:Pct,huberLoss:Bct,logLoss:zct,meanSquaredError:Uct,sigmoidCrossEntropy:Wct,softmaxCrossEntropy:Vct});function UO(n,t){return t===void 0&&(t=!1),st.tidy(function(){if(n.shape.length!==2)throw new Error("qr2d() requires a 2D Tensor, but got a "+n.shape.length+"D Tensor.");for(var e=n.shape[0],r=n.shape[1],o=$P(e),a=n.clone(),i=mc([[1]],[1,1]),s=i.clone(),u=e>=r?r:e,l=function(h){var d,p=a,g=s,x=o;d=st.tidy(function(){var y=a.slice([h,h],[e-h,1]),b=y.norm(),C=a.slice([h,h],[1,1]),E=mc([[-1]]).where(C.greater(0),mc([[1]])),S=C.sub(E.mul(b)),k=y.div(S);s=k.shape[0]===1?i.clone():i.concat(k.slice([1,0],[k.shape[0]-1,k.shape[1]]),0);var R=E.matMul(S).div(b).neg(),A=a.slice([h,0],[e-h,r]),N=R.mul(s),_=s.transpose();if(h===0)a=A.sub(N.matMul(_.matMul(A)));else{var $=A.sub(N.matMul(_.matMul(A)));a=a.slice([0,0],[h,r]).concat($,0)}var D=N.transpose(),O=o.slice([0,h],[e,o.shape[1]-h]);if(h===0)o=O.sub(O.matMul(s).matMul(D));else{var P=O.sub(O.matMul(s).matMul(D));o=o.slice([0,0],[e,h]).concat(P,1)}return[s,a,o]}),s=d[0],a=d[1],o=d[2],qo([p,g,x])},c=0;c<u;++c)l(c);return!t&&e>r&&(o=o.slice([0,0],[e,r]),a=a.slice([0,0],[r,r])),[o,a]})}var Hct=nt({bandPart_:function(n,t,e){if(t%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+t+".");if(e%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+e+".");var r=j(n,"a","bandPart");if(r.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+r.rank+".");var o=r.shape,a=r.shape.slice(-2),i=a[0],s=a[1];if(!(t<=i))throw new Error("bandPart(): numLower ("+t+") must not be greater than the number of rows ("+i+").");if(!(e<=s))throw new Error("bandPart(): numUpper ("+e+") must not be greater than the number of columns ("+s+").");t<0&&(t=i),e<0&&(e=s);var u=ey(0,i,1,"int32").reshape([-1,1]),l=ey(0,s,1,"int32"),c=fi(u,l),h=i1(c.lessEqual(ae(+t,"int32")),c.greaterEqual(ae(-e,"int32"))),d=Yn([i,s],r.dtype);return ol(Jy(r.reshape([-1,i,s])).map(function(p){return kc(h,p,d)})).reshape(o)}}),qct=nt({gramSchmidt_:function(n){var t;if(Array.isArray(n)){t=!1,X(n!=null&&n.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var e=n[0].shape[0],r=function(u){X(n[u].shape[0]===e,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+n[u].shape[0]+" vs. "+e+")"})},o=1;o<n.length;++o)r(o)}else t=!0,n=$k(n,n.shape[0],0).map(function(u){return WL(u,[0])});X(n.length<=n[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+n.length+") exceeds number of dimensions ("+n[0].shape[0]+")."});var a=[],i=n,s=function(u){a.push(st.tidy(function(){var l=i[u];if(u>0)for(var c=0;c<u;++c){var h=Uu(a[c].mulStrict(l)).mul(a[c]);l=l.sub(h)}return l.div(JP(l,"euclidean"))}))};for(o=0;o<n.length;++o)s(o);return t?ol(a,0):a}}),jct=nt({qr_:function(n,t){if(t===void 0&&(t=!1),n.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+n.rank);if(n.rank===2)return UO(n,t);var e=n.shape.slice(0,n.shape.length-2).reduce(function(i,s){return i*s}),r=Jy(n.reshape([e,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0),o=[],a=[];return r.forEach(function(i){var s=UO(i,t),u=s[0],l=s[1];o.push(u),a.push(l)}),[ol(o,0).reshape(n.shape),ol(a,0).reshape(n.shape)]}}),Xct=Object.freeze({bandPart:Hct,gramSchmidt:qct,qr:jct});function u1(n,t,e,r,o,a){r==null&&(r=.5),o==null&&(o=Number.NEGATIVE_INFINITY),a==null&&(a=0);var i=n.shape[0];return e=Math.min(e,i),X(0<=r&&r<=1,function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"}),X(n.rank===2,function(){return"boxes must be a 2D tensor, but was of rank '"+n.rank+"'"}),X(n.shape[1]===4,function(){return"boxes must have 4 columns, but 2nd dimension was "+n.shape[1]}),X(t.rank===1,function(){return"scores must be a 1D tensor"}),X(t.shape[0]===i,function(){return"scores has incompatible shape with boxes. Expected "+i+", but was "+t.shape[0]}),X(0<=a&&a<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+a+"'"}),{maxOutputSize:e,iouThreshold:r,scoreThreshold:o,softNmsSigma:a}}var Kct=nt({resizeBilinear_:function(n,t,e){e===void 0&&(e=!1);var r=j(n,"images","resizeBilinear");X(r.rank===3||r.rank===4,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."}),X(t.length===2,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+t+"."});var o=r,a=!1;r.rank===3&&(a=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var i=t[0],s=t[1],u=st.runKernelFunc(function(l,c){return c([o]),l.resizeBilinear(o,i,s,e)},{x:o},function(l,c){return{x:function(){return st.runKernelFunc(function(h){return h.resizeBilinearBackprop(l,c[0],e)},{})}}},"ResizeBilinear",{alignCorners:e,newHeight:i,newWidth:s});return a?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),Yct=nt({resizeNearestNeighbor_:function(n,t,e){e===void 0&&(e=!1);var r=j(n,"images","resizeNearestNeighbor");X(r.rank===3||r.rank===4,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."}),X(t.length===2,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+t+"."}),X(r.dtype==="float32"||r.dtype==="int32",function(){return"`images` must have `int32` or `float32` as dtype"});var o=r,a=!1;r.rank===3&&(a=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var i=t[0],s=t[1],u=st.runKernelFunc(function(l,c){return c([o]),l.resizeNearestNeighbor(o,i,s,e)},{batchImages:o},function(l,c){return{batchImages:function(){return st.runKernelFunc(function(h){return h.resizeNearestNeighborBackprop(l,c[0],e)},{})}}});return a?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),Qct=nt({nonMaxSuppression_:function(n,t,e,r,o){r===void 0&&(r=.5),o===void 0&&(o=Number.NEGATIVE_INFINITY);var a=j(n,"boxes","nonMaxSuppression"),i=j(t,"scores","nonMaxSuppression"),s=u1(a,i,e,r,o);e=s.maxOutputSize,r=s.iouThreshold,o=s.scoreThreshold;var u={maxOutputSize:e,iouThreshold:r,scoreThreshold:o};return st.runKernelFunc(function(l){return l.nonMaxSuppression(a,i,e,r,o)},{boxes:a,scores:i},null,"NonMaxSuppressionV3",u)}}),Zct=function(n,t,e,r,o){return r===void 0&&(r=.5),o===void 0&&(o=Number.NEGATIVE_INFINITY),Qt(this,void 0,void 0,function(){var a,i,s,u,l,c,h;return Zt(this,function(d){switch(d.label){case 0:return a=j(n,"boxes","nonMaxSuppressionAsync"),i=j(t,"scores","nonMaxSuppressionAsync"),s=u1(a,i,e,r,o),e=s.maxOutputSize,r=s.iouThreshold,o=s.scoreThreshold,[4,Promise.all([a.data(),i.data()])];case 1:return u=d.sent(),l=u[0],c=u[1],h=Pk(l,c,e,r,o),a!==n&&a.dispose(),i!==t&&i.dispose(),[2,h]}})})},Jct=nt({nonMaxSuppressionWithScore_:function(n,t,e,r,o,a){r===void 0&&(r=.5),o===void 0&&(o=Number.NEGATIVE_INFINITY),a===void 0&&(a=0);var i=j(n,"boxes","nonMaxSuppression"),s=j(t,"scores","nonMaxSuppression"),u=u1(i,s,e,r,o,a),l={maxOutputSize:e=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:o=u.scoreThreshold,softNmsSigma:a=u.softNmsSigma},c=st.runKernel("NonMaxSuppressionV5",{boxes:i,scores:s},l);return{selectedIndices:c[0],selectedScores:c[1]}}}),tht=function(n,t,e,r,o,a){return r===void 0&&(r=.5),o===void 0&&(o=Number.NEGATIVE_INFINITY),a===void 0&&(a=0),Qt(this,void 0,void 0,function(){var i,s,u,l,c,h,d;return Zt(this,function(p){switch(p.label){case 0:return i=j(n,"boxes","nonMaxSuppressionAsync"),s=j(t,"scores","nonMaxSuppressionAsync"),u=u1(i,s,e,r,o,a),e=u.maxOutputSize,r=u.iouThreshold,o=u.scoreThreshold,a=u.softNmsSigma,[4,Promise.all([i.data(),s.data()])];case 1:return l=p.sent(),c=l[0],h=l[1],d=Bk(c,h,e,r,o,a),i!==n&&i.dispose(),s!==t&&s.dispose(),[2,d]}})})},eht=nt({cropAndResize_:function(n,t,e,r,o,a){var i=j(n,"image","cropAndResize"),s=j(t,"boxes","cropAndResize","float32"),u=j(e,"boxInd","cropAndResize","int32");o=o||"bilinear",a=a||0;var l=s.shape[0];return X(i.rank===4,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+i.rank+"."}),X(s.rank===2&&s.shape[1]===4,function(){return"Error in cropAndResize: boxes must be have size ["+l+",4] but had shape "+s.shape+"."}),X(u.rank===1&&u.shape[0]===l,function(){return"Error in cropAndResize: boxInd must be have size ["+l+"] but had shape "+s.shape+"."}),X(r.length===2,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."}),X(r[0]>=1&&r[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+r}),X(o==="bilinear"||o==="nearest",function(){return"method must be bilinear or nearest, but was "+o}),st.runKernelFunc(function(c,h){return c.cropAndResize(i,s,u,r,o,a)},{images:i,boxes:s,boxInd:u},null,"CropAndResize",{method:o,extrapolationValue:a,cropSize:r})}}),oB=Object.freeze({resizeBilinear:Kct,resizeNearestNeighbor:Yct,nonMaxSuppression:Qct,nonMaxSuppressionAsync:Zct,nonMaxSuppressionWithScore:Jct,nonMaxSuppressionWithScoreAsync:tht,cropAndResize:eht}),Zk=function(n,t){return!(n>0)||t==="linear"},Jk=function(n,t,e){if(e==null||e==="linear")return n;if(e==="relu")return n.mul(t.step());throw new Error("Gradient for activation "+e+" has not been implemented yet.")},tI=function(n,t){var e=t,r=Ir(n.shape,t.shape);return r.length>0&&(e=e.sum(r)),e.reshape(n.shape)},eI=function(n,t,e){if(t==="linear")return n;if(t==="relu")return s1(n);if(t==="elu")return YP(n);if(t==="relu6")return ZP(n);if(t==="prelu")return QP(n,e);throw new Error("Unknown fused activation "+t+".")},nht=nt({fusedMatMul_:function(n){var t,e=n.a,r=n.b,o=n.transposeA,a=o!==void 0&&o,i=n.transposeB,s=i!==void 0&&i,u=n.bias,l=n.activation,c=l===void 0?"linear":l,h=n.preluActivationWeights;if(Zk(st.state.gradientDepth,c)===!1){var d=qP(e,r,a,s);return u!=null&&(d=qa(d,u)),eI(d,c,h)}var p=j(e,"a","fused matMul"),g=j(r,"b","fused matMul");t=Vn(p,g),p=t[0],g=t[1];var x=a?p.shape[p.rank-2]:p.shape[p.rank-1],y=s?g.shape[g.rank-1]:g.shape[g.rank-2],b=a?p.shape[p.rank-1]:p.shape[p.rank-2],C=s?g.shape[g.rank-2]:g.shape[g.rank-1],E=p.shape.slice(0,-2),S=g.shape.slice(0,-2),k=Yt(E),R=Yt(S);X(p.rank>=2&&g.rank>=2&&p.rank===g.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+p.rank+" and "+g.rank+"."}),X(zr(E,S),function(){return"Error in fused matMul: outer dimensions ("+E+") and ("+S+") of Tensors with shapes "+p.shape+" and "+g.shape+" must match."}),X(x===y,function(){return"Error in fused matMul: inner shapes ("+x+") and ("+y+") of Tensors with shapes "+p.shape+" and "+g.shape+" and transposeA="+a+" and transposeB="+s+" must match."});var A,N,_=p.shape.slice(0,-2).concat([b,C]),$=a?p.as3D(k,x,b):p.as3D(k,b,x),D=s?g.as3D(R,C,y):g.as3D(R,y,C);u!=null&&Pe(_,(A=Vn(A=j(u,"bias","fused matMul"),p)[0]).shape),h!=null&&(N=j(h,"prelu weights","fused matMul"));var O={a:$,b:D};u!=null&&(O.bias=A),h!=null&&(O.preluActivationWeights=N);var P=[$,D];return st.runKernelFunc(function(z,W){var F=z.fusedBatchMatMul({a:$,b:D,transposeA:a,transposeB:s,bias:A,activation:c,preluActivationWeights:N});return W([$,D,F]),F},O,function(z,W){var F=W[0],B=W[1],U=W[2],q=Jk(z,U,c),M={};return u!=null&&(M={bias:function(){return tI(A,q)}}),Object.assign(a||s?!a&&s?{a:function(){return q.matMul(B,!1,!1)},b:function(){return q.matMul(F,!0,!1)}}:a&&!s?{a:function(){return B.matMul(q,!1,!0)},b:function(){return F.matMul(q,!1,!1)}}:{a:function(){return B.matMul(q,!0,!0)},b:function(){return q.matMul(F,!0,!0)}}:{a:function(){return q.matMul(B,!1,!0)},b:function(){return F.matMul(q,!0,!1)}},M)},"_FusedMatMul",{transposeA:a,transposeB:s,activation:c},P,[!0]).reshape(_)}}),rht=nt({fusedConv2d_:function(n){var t=n.x,e=n.filter,r=n.strides,o=n.pad,a=n.dataFormat,i=a===void 0?"NHWC":a,s=n.dilations,u=s===void 0?[1,1]:s,l=n.dimRoundingMode,c=n.bias,h=n.activation,d=h===void 0?"linear":h,p=n.preluActivationWeights;if(d=d||"linear",Zk(st.state.gradientDepth,d)===!1){var g=Qc(t,e,r,o,i,u,l);return c!=null&&(g=qa(g,c)),eI(g,d,p)}var x=j(t,"x","conv2d"),y=j(e,"filter","conv2d"),b=x,C=!1;x.rank===3&&(C=!0,b=x.as4D(1,x.shape[0],x.shape[1],x.shape[2])),X(b.rank===4,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+b.rank+"."}),X(y.rank===4,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+y.rank+"."}),l!=null&&X(ur(o),function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+l+" but got pad "+o+"."}),X(b.shape[3]===y.shape[2],function(){return"Error in conv2d: depth of input ("+b.shape[3]+") must match input depth for filter "+y.shape[2]+"."}),X(_o(r,u),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"}),X(i==="NHWC",function(){return"Error in conv2d: got dataFormat of "+i+" but only NHWC is currently supported."});var E,S,k=Kc(b.shape,y.shape,r,u,o,l);c!=null&&(E=Vn(E=j(c,"bias","fused conv2d"),x)[0],Pe(k.outShape,E.shape)),p!=null&&(S=j(p,"prelu weights","fused conv2d"));var R={x:b,filter:y};c!=null&&(R.bias=E),p!=null&&(R.preluActivationWeights=S);var A=[y,b],N=st.runKernelFunc(function(_,$){var D=_.fusedConv2d({input:b,filter:y,convInfo:k,bias:E,activation:d,preluActivationWeights:S});return $([y,b,D]),D},R,function(_,$){var D=$,O=D[0],P=D[1],z=D[2],W=Jk(_,z,d);X(zf(u),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+u+"'"});var F={};return c!=null&&(F={bias:function(){return tI(E,W)}}),Object.assign({x:function(){return WP(P.shape,W,O,r,o)},filter:function(){return qk(P,W,O.shape,r,o)}},F)},"FusedConv2D",{convInfo:k,activation:d},A,[!0]);return C?N.as3D(N.shape[1],N.shape[2],N.shape[3]):N}}),oht=nt({fusedDepthwiseConv2d_:function(n){var t=n.x,e=n.filter,r=n.strides,o=n.pad,a=n.dataFormat,i=a===void 0?"NHWC":a,s=n.dilations,u=s===void 0?[1,1]:s,l=n.dimRoundingMode,c=n.bias,h=n.activation,d=h===void 0?"linear":h,p=n.preluActivationWeights;if(Zk(st.state.gradientDepth,d)===!1){var g=jk(t,e,r,o,i,u,l);return c!=null&&(g=qa(g,c)),eI(g,d,p)}var x=j(t,"x","depthwiseConv2d"),y=j(e,"filter","depthwiseConv2d"),b=x,C=!1;x.rank===3&&(C=!0,b=x.as4D(1,x.shape[0],x.shape[1],x.shape[2])),X(b.rank===4,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+b.rank+"."}),X(y.rank===4,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+y.rank+"."}),X(b.shape[3]===y.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels ("+b.shape[3]+") must match the inChannels dimension in filter "+y.shape[2]+"."}),u==null&&(u=[1,1]),X(_o(r,u),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"}),l!=null&&X(ur(o),function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+l+" but got pad "+o+"."});var E,S,k=Kc(b.shape,y.shape,r,u,o,l,!0);c!=null&&(E=Vn(E=j(c,"bias","fused conv2d"),x)[0],Pe(k.outShape,E.shape)),p!=null&&(S=j(p,"prelu weights","fused depthwiseConv2d"));var R={x:b,filter:y};c!=null&&(R.bias=E),p!=null&&(R.preluActivationWeights=S);var A=[y,b],N=st.runKernelFunc(function(_,$){var D=_.fusedDepthwiseConv2D({input:b,filter:y,convInfo:k,bias:E,activation:d,preluActivationWeights:S});return $([y,b,D]),D},R,function(_,$){X(zf(u),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+u+"'"});var D=$[0],O=$[1],P=$[2],z=Jk(_,P,d),W={};return c!=null&&(W={bias:function(){return tI(E,z)}}),Object.assign({x:function(){return VP(O.shape,z,D,k)},filter:function(){return GP(O,z,D.shape,k)}},W)},"FusedDepthwiseConv2D",{convInfo:k,activation:d},A,[!0]);return C?N.as3D(N.shape[1],N.shape[2],N.shape[3]):N}}),aht=Object.freeze({matMul:nht,conv2d:rht,depthwiseConv2d:oht}),iht=Object.freeze({image:oB,linalg:Xct,losses:Gct,spectral:Nct,fused:aht,signal:Oct,add:qa,addN:flt,batchNorm:Um,batchNormalization:dlt,batchNorm2d:mlt,batchNormalization2d:plt,batchNorm3d:vlt,batchNormalization3d:glt,batchNorm4d:ylt,batchNormalization4d:xlt,broadcastTo:NP,clone:blt,div:al,divNoNan:DP,eye:$P,multinomial:Slt,oneHot:cy,pad:au,pad1d:Elt,pad2d:klt,pad3d:Ilt,pad4d:Rlt,rand:Tlt,randomGamma:_lt,randomNormal:Dlt,randomUniform:OP,square:FP,squaredDifference:MP,tile:yf,truncatedNormal:$lt,conv1d:Hlt,conv2d:Qc,conv3d:qlt,depthwiseConv2d:jk,separableConv2d:HP,conv2dTranspose:jlt,conv3dTranspose:Xlt,op:nt,booleanMaskAsync:Glt,complex:Kr,real:Pa,imag:Vi,concat:Ha,concat1d:eit,concat2d:nit,concat3d:rit,concat4d:oit,split:$k,matMul:qP,dot:Klt,outerProduct:Ylt,reverse:Wm,reverse1d:Qlt,reverse2d:Zlt,reverse3d:Jlt,reverse4d:tct,maxPool:ua,avgPool:ect,pool:nct,maxPool3d:rct,avgPool3d:oct,maxPoolWithArgmax:act,slice:il,slice1d:ict,slice2d:sct,slice3d:uct,slice4d:lct,abs:cit,acos:hit,acosh:fit,asin:dit,asinh:pit,atan:mit,atanh:git,ceil:vit,clipByValue:xit,cos:yit,cosh:bit,erf:wit,exp:Cit,expm1:Sit,floor:Eit,log:kit,log1p:Iit,logSigmoid:Rit,neg:Ok,reciprocal:Tit,round:Nit,rsqrt:QL,sigmoid:Ait,sign:_it,isNaN:Dit,isInf:$it,isFinite:Oit,sin:Fit,sinh:Mit,softplus:Lit,sqrt:Pit,step:Bit,tan:zit,tanh:Uit,all:cct,any:hct,argMax:fct,argMin:dct,logSumExp:pct,max:mct,mean:gct,min:vct,moments:xct,sum:Uu,prod:yct,equal:LP,equalStrict:Olt,greater:Flt,greaterEqual:PP,greaterEqualStrict:Mlt,greaterStrict:Llt,less:Plt,lessEqual:Blt,lessEqualStrict:zlt,lessStrict:Ult,notEqual:Wlt,notEqualStrict:Vlt,addStrict:Wit,atan2:Vit,divStrict:Git,floorDiv:ZL,maximum:Fk,maximumStrict:Hit,minimum:JL,minimumStrict:qit,mod:jit,modStrict:Xit,mul:Kn,mulStrict:Kit,pow:ay,powStrict:Yit,squaredDifferenceStrict:Qit,sub:fi,subStrict:Zit,elu:YP,leakyRelu:bct,prelu:QP,relu:s1,relu6:ZP,selu:wct,logicalAnd:i1,logicalNot:wlt,logicalOr:AP,logicalXor:Clt,where:kc,whereAsync:_P,buffer:Ce,print:ait,batchToSpaceND:zL,cast:iit,cumsum:sit,depthToSpace:uit,expandDims:zu,reshape:Ls,spaceToBatchND:UL,squeeze:WL,stack:ol,unstack:Jy,setdiff1dAsync:lit,fill:gc,linspace:tit,ones:ud,range:ey,scalar:ae,tensor:Qr,tensor1d:vi,tensor2d:mc,tensor3d:PL,tensor4d:Pi,tensor5d:Qat,tensor6d:Zat,variable:Jat,zeros:Yn,onesLike:BL,zerosLike:je,transpose:ai,softmax:r1,logSoftmax:ast,localResponseNormalization:Cct,norm:JP,gather:Hk,unsortedSegmentSum:BP,basicLSTMCell:Sct,multiRNNCell:Ect,movingAverage:kct,stridedSlice:Ict,topk:Rct,scatterND:Tct,fft:Xk,ifft:hy,rfft:Kk,irfft:tB,sparseToDense:Act,gatherND:_ct,diag:Dct,dropout:$ct,hannWindow:Yk,hammingWindow:nB,frame:Qk,stft:rB,inTopKAsync:Fct});function Mt(n,t){Array.isArray(n)||(n=[n]),n.forEach(function(e){e!=null&&X(e.dtype!=="complex64",function(){return t+" does not support complex64 tensors."})})}function cE(n,t,e,r,o,a){for(var i=o.strideHeight,s=o.strideWidth,u=o.dilationHeight,l=o.dilationWidth,c=o.effectiveFilterHeight,h=o.effectiveFilterWidth,d=o.padInfo.top,p=o.padInfo.left,g=a==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,x=Ce(o.outShape,e),y=x.values,b=o.outShape[1]*o.outShape[2]*o.outShape[3],C=o.outShape[2]*o.outShape[3],E=o.outShape[3],S=0;S<o.batchSize;++S)for(var k=S*b,R=S*r[0],A=0;A<o.inChannels;++A)for(var N=0;N<o.outHeight;++N)for(var _=N*i-d,$=Math.max(0,_),D=Math.min(o.inHeight,c+_),O=k+N*C,P=0;P<o.outWidth;++P){for(var z=P*s-p,W=Math.max(0,z),F=Math.min(o.inWidth,h+z),B=g,U=0,q=0,M=$;M<D;M+=u){for(var G=R+M*r[1],Q=W;Q<F;Q+=l){var Z=n[G+Q*r[2]+A];a==="max"&&Z>B?B=Z:a==="avg"&&(U+=Z,q++)}if(isNaN(B))break}y[O+P*E+A]=a==="avg"?U/q:B}return x}function aB(n,t,e,r,o,a){o===void 0&&(o=!1),a===void 0&&(a=!1);for(var i=Ce(r.outShape,"int32"),s=r.strideHeight,u=r.strideWidth,l=r.dilationHeight,c=r.dilationWidth,h=r.effectiveFilterHeight,d=r.effectiveFilterWidth,p=r.padInfo.top,g=r.padInfo.left,x=Ce(t,e,n),y=0;y<r.batchSize;++y)for(var b=0;b<r.inChannels;++b)for(var C=0;C<r.outHeight;++C){for(var E=C*s-p,S=E;S<0;)S+=l;for(var k=Math.min(r.inHeight,h+E),R=0;R<r.outWidth;++R){for(var A=R*u-g,N=A;N<0;)N+=c;for(var _=Math.min(r.inWidth,d+A),$=Number.NEGATIVE_INFINITY,D=-1,O=S;O<k;O+=l)for(var P=O-E,z=N;z<_;z+=c){var W=z-A,F=x.get(y,O,z,b);F>$&&($=F,D=o?a?((y*r.inHeight+O)*r.inWidth+z)*r.inChannels+b:(O*r.inWidth+z)*r.inChannels+b:P*d+W)}i.set(D,y,C,R,b)}}return i}function jC(n,t,e,r){if(e==="linear")return n.linear(t);if(e==="relu")return n.relu(t);if(e==="elu")return n.elu(t);if(e==="relu6")return n.relu6(t);if(e==="prelu")return n.prelu(t,r);throw new Error("Activation "+e+" has not been implemented for the CPU backend.")}var sht=function(n){function t(){var e=n.call(this)||this;return e.blockSize=48,e.firstUse=!0,e.data=new oP(e,st),e}return wi(t,n),t.prototype.write=function(e,r,o){this.firstUse&&(this.firstUse=!1,Nt().get("IS_NODE")&&J0(`
============================
Hi there 👋. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================`));var a={};return this.data.set(a,{values:e,dtype:o}),a},t.prototype.move=function(e,r,o,a){this.data.set(e,{values:r,dtype:a})},t.prototype.numDataIds=function(){return this.data.numDataIds()},t.prototype.read=function(e){return Qt(this,void 0,void 0,function(){return Zt(this,function(r){return[2,this.readSync(e)]})})},t.prototype.readSync=function(e){var r=this.data.get(e),o=r.dtype,a=r.complexTensors;return o==="complex64"?lE(this.readSync(a.real.dataId),this.readSync(a.imag.dataId)):this.data.get(e).values},t.prototype.bufferSync=function(e){var r=this.readSync(e.dataId),o=r;if(e.dtype==="string")try{o=r.map(function(a){return Y0(a)})}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Ce(e.shape,e.dtype,o)},t.prototype.makeOutput=function(e,r,o){var a=this.write(e,r,o);return st.makeTensorFromDataId(a,r,o,this)},t.prototype.disposeData=function(e){if(this.data.has(e)){var r=this.data.get(e).complexTensors;r!=null&&(r.real.dispose(),r.imag.dispose()),this.data.delete(e)}},t.prototype.time=function(e){return Qt(this,void 0,void 0,function(){var r;return Zt(this,function(o){return r=Li(),e(),[2,{kernelMs:Li()-r}]})})},t.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},t.prototype.complex=function(e,r){var o=this.makeOutput(null,e.shape,"complex64");return this.data.get(o.dataId).complexTensors={real:st.keep(e.clone()),imag:st.keep(r.clone())},o},t.prototype.real=function(e){return this.data.get(e.dataId).complexTensors.real.clone()},t.prototype.imag=function(e){return this.data.get(e.dataId).complexTensors.imag.clone()},t.prototype.slice=function(e,r,o){if(Mt(e,"slice"),nP(e.shape,r,o)){var a=rP(r,e.strides),i=Yt(o);return Qr(this.readSync(e.dataId).subarray(a,a+i),o,e.dtype)}for(var s=Ce(o,e.dtype),u=this.bufferSync(e),l=0;l<s.size;++l){var c=s.indexToLoc(l).map(function(h,d){return h+r[d]});s.values[l]=u.get.apply(u,c)}return s.toTensor()},t.prototype.stridedSlice=function(e,r,o,a){Mt(e,"stridedSlice");var i=Mk(r,o,a);if(i.some(function(p){return p===0}))return Qr([],i);for(var s=Ce(i,e.dtype),u=this.bufferSync(e),l=0;l<s.size;l++){for(var c=s.indexToLoc(l),h=new Array(c.length),d=0;d<h.length;d++)h[d]=c[d]*a[d]+r[d];s.set.apply(s,[u.get.apply(u,h)].concat(c))}return s.toTensor()},t.prototype.diag=function(e){for(var r=this.readSync(e.dataId),o=Ce([e.size,e.size],e.dtype),a=o.values,i=0;i<r.length;i++)a[i*e.size+i]=r[i];return o.toTensor()},t.prototype.unstack=function(e,r){for(var o=e.shape[r],a=new Array(e.rank-1),i=0,s=0;s<e.rank;s++)s!==r&&(a[i++]=e.shape[s]);var u=new Array(e.rank).fill(0),l=e.shape.slice();l[r]=1;var c=new Array(o);for(s=0;s<c.length;s++)u[r]=s,c[s]=this.slice(e,u,l).reshape(a);return c},t.prototype.reverse=function(e,r){Mt(e,"reverse");for(var o=Ce(e.shape,e.dtype),a=this.bufferSync(e),i=function(u){var l=o.indexToLoc(u),c=l.slice();r.forEach(function(h){return c[h]=e.shape[h]-1-c[h]}),o.set.apply(o,[a.get.apply(a,c)].concat(l))},s=0;s<o.size;s++)i(s);return o.toTensor()},t.prototype.concat=function(e,r){var o=this;if(e[0].dtype==="complex64"){var a=e.map(function(p){return Pa(p)}),i=e.map(function(p){return Vi(p)});return Kr(this.concat(a,r),this.concat(i,r))}var s=e.map(function(p){var g=Yt(p.shape.slice(r));return p.as2D(-1,g)}),u=Bf(s.map(function(p){return p.shape}),1),l=Ce(u,e[0].dtype).values;if(s[0].shape[0]===1){var c=0;s.forEach(function(p){l.set(o.readSync(p.dataId),c),c+=p.size})}else{var h=0;s.forEach(function(p){for(var g=o.readSync(p.dataId),x=0,y=0;y<p.shape[0];++y)for(var b=y*u[1]+h,C=0;C<p.shape[1];++C)l[b+C]=g[x++];h+=p.shape[1]})}var d=Bf(e.map(function(p){return p.shape}),r);return Qr(l,d,e[0].dtype)},t.prototype.neg=function(e){return Mt(e,"neg"),this.multiply(ae(-1),e)},t.prototype.add=function(e,r){return e.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(e.cast("complex64"),r.cast("complex64"),function(o,a,i,s){return{real:o+i,imag:a+s}}):this.broadcastedBinaryOp(e,r,Yr(e.dtype,r.dtype),function(o,a){return o+a})},t.prototype.addN=function(e){var r=this;Mt(e,"addN");for(var o=e.map(function(c){return r.readSync(c.dataId)}),a=Ce(e[0].shape,e[0].dtype),i=a.values,s=0;s<e.length;s++)for(var u=o[s],l=0;l<i.length;l++)i[l]+=u[l];return a.toTensor()},t.prototype.softmax=function(e,r){var o=_r([r],e.shape),a=this.max(e,o),i=Ko(a.shape,o),s=this.subtract(e,a.reshape(i)),u=this.exp(s),l=this.sum(u,o).reshape(i);return al(u,l)},t.prototype.subtract=function(e,r){return e.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(e.cast("complex64"),r.cast("complex64"),function(o,a,i,s){return{real:o-i,imag:a-s}}):this.broadcastedBinaryOp(e,r,Yr(e.dtype,r.dtype),function(o,a){return o-a})},t.prototype.pow=function(e,r){return Mt([e,r],"pow"),this.broadcastedBinaryOp(e,r,e.dtype,function(o,a){return Math.pow(o,a)})},t.prototype.batchMatMul=function(e,r,o,a){Mt([e,r],"matMul");for(var i=o?e.shape[1]:e.shape[2],s=o?e.shape[2]:e.shape[1],u=a?r.shape[1]:r.shape[2],l=e.shape[0],c=this.readSync(e.dataId),h=this.readSync(r.dataId),d=o?[e.strides[0],1,e.strides[1]]:[e.strides[0],e.strides[1],1],p=d[0],g=d[1],x=d[2],y=a?[1,r.strides[1],r.strides[0]]:[r.strides[1],1,r.strides[0]],b=y[0],C=y[1],E=y[2],S=s*u,k=Ce([l,s,u],e.dtype),R=k.values,A=this.blockSize,N=0;N<l;N++)for(var _=0;_<s;_+=A)for(var $=0;$<u;$+=A)for(var D=0;D<i;D+=A)for(var O=Math.min(_+A,s),P=Math.min($+A,u),z=Math.min(D+A,i),W=_;W<O;W++)for(var F=$;F<P;F++){for(var B=0,U=D;U<z;U++)B+=c[N*p+W*g+U*x]*h[U*b+F*C+N*E];R[N*S+(W*u+F)]+=B}return k.toTensor()},t.prototype.fusedBatchMatMul=function(e){var r=e.a,o=e.b,a=e.transposeA,i=e.transposeB,s=e.bias,u=e.activation,l=e.preluActivationWeights,c=this.batchMatMul(r,o,a,i);return s&&(c=this.add(c,s)),u&&(c=jC(this,c,u,l)),c},t.prototype.multiply=function(e,r){return e.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(e.cast("complex64"),r.cast("complex64"),function(o,a,i,s){return{real:o*i-a*s,imag:o*s+a*i}}):this.broadcastedBinaryOp(e,r,Yr(e.dtype,r.dtype),function(o,a){return o*a})},t.prototype.floorDiv=function(e,r){return Mt([e,r],"floorDiv"),this.broadcastedBinaryOp(e,r,"int32",function(o,a){return Math.floor(o/a)})},t.prototype.sum=function(e,r){Mt(e,"sum"),ca("sum",r,e.rank);for(var o=ho(e.shape,r),a=o[0],i=o[1],s=Yn(a,Yr(e.dtype,"int32")),u=Yt(i),l=this.readSync(s.dataId),c=this.readSync(e.dataId),h=0;h<l.length;++h){for(var d=h*u,p=0,g=0;g<u;++g)p+=c[d+g];l[h]=p}return s},t.prototype.prod=function(e,r){Mt(e,"sum");for(var o=ho(e.shape,r),a=o[0],i=o[1],s=Yn(a,Yr(e.dtype,"int32")),u=Yt(i),l=this.readSync(s.dataId),c=this.readSync(e.dataId),h=0;h<l.length;++h){for(var d=h*u,p=1,g=0;g<u;++g)p*=c[d+g];l[h]=p}return s},t.prototype.unsortedSegmentSum=function(e,r,o){Mt(e,"unsortedSegmentSum");for(var a=[],i=e.rank-r.rank,s=0;s<i;++s)r=r.expandDims(s+1);for(s=0;s<o;++s){var u=ae(s,"int32"),l=LP(u,r).asType("float32").mul(e).sum(0);a.push(l)}return ol(a)},t.prototype.argMin=function(e,r){Mt(e,"argMin");var o=[r];ca("argMin",o,e.rank);for(var a=ho(e.shape,o),i=a[0],s=a[1],u=Yn(i,"int32"),l=Yt(s),c=this.readSync(u.dataId),h=this.readSync(e.dataId),d=0;d<c.length;++d){for(var p=d*l,g=h[p],x=0,y=0;y<l;++y){var b=h[p+y];b<g&&(g=b,x=y)}c[d]=x}return u},t.prototype.argMax=function(e,r){Mt(e,"argMax");var o=[r];ca("argMax",o,e.rank);for(var a=ho(e.shape,o),i=a[0],s=a[1],u=Yn(i,"int32"),l=Yt(s),c=this.readSync(u.dataId),h=this.readSync(e.dataId),d=0;d<c.length;++d){for(var p=d*l,g=h[p],x=0,y=0;y<l;++y){var b=h[p+y];b>g&&(g=b,x=y)}c[d]=x}return u},t.prototype.cumsum=function(e,r,o,a){if(Mt(e,"cumsum"),r!==e.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(e.rank-1)+" but got axis="+r);for(var i=Yr(e.dtype,"int32"),s=Yn(e.shape,i),u=this.readSync(s.dataId),l=this.readSync(e.dataId),c=e.shape[e.rank-1],h=a?function(y,b){return y+c-b-1}:function(y,b){return y+b},d=0;d<l.length;d+=c)for(var p=0;p<c;p++){var g=h(d,p);if(p===0)u[g]=o?0:l[g];else{var x=h(d,p-1);u[g]=o?l[x]+u[x]:l[g]+u[x]}}return s},t.prototype.equal=function(e,r){return Mt([e,r],"equal"),this.broadcastedBinaryOp(e,r,"bool",function(o,a){return o===a?1:0})},t.prototype.notEqual=function(e,r){return Mt([e,r],"notEqual"),this.broadcastedBinaryOp(e,r,"bool",function(o,a){return o!==a?1:0})},t.prototype.less=function(e,r){return Mt([e,r],"less"),this.broadcastedBinaryOp(e,r,"bool",function(o,a){return o<a?1:0})},t.prototype.lessEqual=function(e,r){return Mt([e,r],"lessEqual"),this.broadcastedBinaryOp(e,r,"bool",function(o,a){return o<=a?1:0})},t.prototype.greater=function(e,r){return Mt([e,r],"greater"),this.broadcastedBinaryOp(e,r,"bool",function(o,a){return o>a?1:0})},t.prototype.greaterEqual=function(e,r){return Mt([e,r],"greaterEqual"),this.broadcastedBinaryOp(e,r,"bool",function(o,a){return o>=a?1:0})},t.prototype.logicalNot=function(e){Mt(e,"logicalNot");for(var r=this.readSync(e.dataId),o=new Uint8Array(r.length),a=0;a<r.length;++a)o[a]=r[a]?0:1;return this.makeOutput(o,e.shape,"bool")},t.prototype.logicalAnd=function(e,r){return Mt([e,r],"logicalAnd"),this.broadcastedBinaryOp(e,r,"bool",function(o,a){return o&&a})},t.prototype.logicalOr=function(e,r){return Mt([e,r],"logicalOr"),this.broadcastedBinaryOp(e,r,"bool",function(o,a){return o||a})},t.prototype.select=function(e,r,o){Mt([e,r,o],"select");for(var a=this.readSync(e.dataId),i=this.readSync(r.dataId),s=this.readSync(o.dataId),u=Yn(r.shape,Yr(r.dtype,o.dtype)),l=this.readSync(u.dataId),c=0,h=e.rank===0||e.rank>1||r.rank===1?1:Yt(r.shape.slice(1)),d=0;d<a.length;d++)for(var p=0;p<h;p++)a[d]===1?l[c++]=i[d]:l[c++]=s[d];return u},t.prototype.where=function(e){Mt([e],"where");var r=this.readSync(e.dataId);return zk(e.shape,r)},t.prototype.topk=function(e,r,o){return Mt(e,"topk"),fP(this.readSync(e.dataId),e.shape,e.dtype,r)},t.prototype.min=function(e,r){Mt(e,"min"),ca("min",r,e.rank);for(var o=ho(e.shape,r),a=o[0],i=o[1],s=Yn(a,e.dtype),u=Yt(i),l=this.readSync(s.dataId),c=this.readSync(e.dataId),h=0;h<l.length;++h){for(var d=h*u,p=c[d],g=0;g<u;++g){var x=c[d+g];x<p&&(p=x)}l[h]=p}return s},t.prototype.minimum=function(e,r){return Mt([e,r],"minimum"),this.broadcastedBinaryOp(e,r,e.dtype,function(o,a){return Math.min(o,a)})},t.prototype.mod=function(e,r){return Mt([e,r],"mod"),this.broadcastedBinaryOp(e,r,e.dtype,function(o,a){var i=o%a;return o<0&&a<0||o>=0&&a>=0?i:(i+a)%a})},t.prototype.max=function(e,r){Mt(e,"max"),ca("max",r,e.rank);for(var o=ho(e.shape,r),a=o[0],i=o[1],s=Yn(a,e.dtype),u=Yt(i),l=this.readSync(s.dataId),c=this.readSync(e.dataId),h=0;h<l.length;++h){for(var d=h*u,p=c[d],g=0;g<u;++g){var x=c[d+g];x>p&&(p=x)}l[h]=p}return s},t.prototype.maximum=function(e,r){return Mt([e,r],"maximum"),this.broadcastedBinaryOp(e,r,e.dtype,function(o,a){return Math.max(o,a)})},t.prototype.all=function(e,r){Mt(e,"all"),ca("all",r,e.rank);for(var o=ho(e.shape,r),a=o[0],i=o[1],s=Yn(a,e.dtype),u=Yt(i),l=this.readSync(s.dataId),c=this.readSync(e.dataId),h=0;h<l.length;++h){for(var d=h*u,p=c[d],g=0;g<u;++g){var x=c[d+g];p=p&&x}l[h]=p}return s},t.prototype.any=function(e,r){Mt(e,"any"),ca("any",r,e.rank);for(var o=ho(e.shape,r),a=o[0],i=o[1],s=Yn(a,e.dtype),u=Yt(i),l=this.readSync(s.dataId),c=this.readSync(e.dataId),h=0;h<l.length;++h){for(var d=h*u,p=c[d],g=0;g<u;++g){var x=c[d+g];p=p||x}l[h]=p}return s},t.prototype.squaredDifference=function(e,r){return Mt([e,r],"squaredDifference"),this.broadcastedBinaryOp(e,r,e.dtype,function(o,a){var i=o-a;return i*i})},t.prototype.ceil=function(e){Mt(e,"ceil");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),a=0;a<r.length;++a)o[a]=Math.ceil(r[a]);return this.makeOutput(o,e.shape,"float32")},t.prototype.floor=function(e){Mt(e,"floor");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),a=0;a<r.length;++a)o[a]=Math.floor(r[a]);return this.makeOutput(o,e.shape,"float32")},t.prototype.sign=function(e){Mt(e,"x");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),a=0;a<r.length;++a)r[a]<0?o[a]=-1:r[a]>0?o[a]=1:o[a]=0;return this.makeOutput(o,e.shape,"float32")},t.prototype.isNaN=function(e){Mt(e,"x");for(var r=this.readSync(e.dataId),o=new Uint8Array(r.length),a=0;a<r.length;++a)Number.isNaN(r[a])&&(o[a]=1);return this.makeOutput(o,e.shape,"bool")},t.prototype.isInf=function(e){Mt(e,"x");for(var r=this.readSync(e.dataId),o=new Uint8Array(r.length),a=0;a<r.length;++a)Math.abs(r[a])===1/0&&(o[a]=1);return this.makeOutput(o,e.shape,"bool")},t.prototype.isFinite=function(e){Mt(e,"x");for(var r=this.readSync(e.dataId),o=new Uint8Array(r.length),a=0;a<r.length;++a)Number.isFinite(r[a])&&(o[a]=1);return this.makeOutput(o,e.shape,"bool")},t.prototype.round=function(e){Mt(e,"round");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),a=0;a<r.length;++a){var i=Math.floor(r[a]);r[a]-i<.5?o[a]=Math.floor(r[a]):r[a]-i>.5?o[a]=Math.ceil(r[a]):o[a]=i%2==0?i:i+1}return this.makeOutput(o,e.shape,"float32")},t.prototype.exp=function(e){Mt(e,"exp");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),a=0;a<r.length;++a)o[a]=Math.exp(r[a]);return this.makeOutput(o,e.shape,"float32")},t.prototype.expm1=function(e){Mt(e,"expm1");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),a=0;a<r.length;++a)o[a]=Math.expm1(r[a]);return this.makeOutput(o,e.shape,"float32")},t.prototype.log=function(e){Mt(e,"log");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),a=0;a<r.length;++a){var i=r[a];o[a]=Math.log(i)}return this.makeOutput(o,e.shape,"float32")},t.prototype.log1p=function(e){Mt(e,"log1p");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),a=0;a<r.length;++a){var i=r[a];o[a]=Math.log1p(i)}return this.makeOutput(o,e.shape,"float32")},t.prototype.sqrt=function(e){Mt(e,"sqrt");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),a=0;a<r.length;++a){var i=r[a];o[a]=Math.sqrt(i)}return this.makeOutput(o,e.shape,"float32")},t.prototype.rsqrt=function(e){Mt(e,"rsqrt");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),a=0;a<r.length;++a){var i=r[a];o[a]=1/Math.sqrt(i)}return this.makeOutput(o,e.shape,"float32")},t.prototype.reciprocal=function(e){Mt(e,"reciprocal");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),a=0;a<r.length;++a)o[a]=1/r[a];return this.makeOutput(o,e.shape,"float32")},t.prototype.linear=function(e){return e},t.prototype.relu=function(e){Mt(e,"relu");for(var r=Yn(e.shape,e.dtype),o=this.readSync(r.dataId),a=this.readSync(e.dataId),i=0;i<a.length;++i)o[i]=Math.max(0,a[i]);return r},t.prototype.relu6=function(e){Mt(e,"relu");for(var r=Yn(e.shape,e.dtype),o=this.readSync(r.dataId),a=this.readSync(e.dataId),i=0;i<a.length;++i)o[i]=Math.min(Math.max(0,a[i]),6);return r},t.prototype.prelu=function(e,r){return Mt([e,r],"prelu"),this.broadcastedBinaryOp(e,r,e.dtype,function(o,a){return o<0?a*o:o})},t.prototype.elu=function(e){Mt(e,"elu");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a){var i=o[a];r[a]=i>=0?i:Math.exp(i)-1}return this.makeOutput(r,e.shape,"float32")},t.prototype.eluDer=function(e,r){Mt([e,r],"eluDer");for(var o=new Float32Array(r.size),a=this.readSync(r.dataId),i=this.readSync(e.dataId),s=0;s<a.length;++s){var u=a[s];o[s]=u>=1?i[s]:i[s]*(u+1)}return this.makeOutput(o,r.shape,"float32")},t.prototype.selu=function(e){Mt(e,"selu");for(var r=Wk,o=Vk,a=new Float32Array(e.size),i=this.readSync(e.dataId),s=0;s<i.length;++s){var u=i[s];a[s]=u>=0?o*u:r*(Math.exp(u)-1)}return this.makeOutput(a,e.shape,"float32")},t.prototype.clip=function(e,r,o){Mt(e,"clip");for(var a=new Float32Array(e.size),i=this.readSync(e.dataId),s=0;s<i.length;++s){var u=i[s];a[s]=u>o?o:u<r?r:u}return this.makeOutput(a,e.shape,"float32")},t.prototype.abs=function(e){for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a)r[a]=Math.abs(o[a]);return this.makeOutput(r,e.shape,"float32")},t.prototype.complexAbs=function(e){for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<e.size;++a){var i=o[2*a],s=o[2*a+1];r[a]=Math.hypot(i,s)}return this.makeOutput(r,e.shape,"float32")},t.prototype.int=function(e){Mt(e,"int");for(var r=new Int32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a)r[a]=o[a];return this.makeOutput(r,e.shape,"int32")},t.prototype.sigmoid=function(e){Mt(e,"sigmoid");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a)r[a]=1/(1+Math.exp(-o[a]));return this.makeOutput(r,e.shape,"float32")},t.prototype.softplus=function(e){Mt(e,"softplus");for(var r=Math.log(11920928955078125e-23)+2,o=new Float32Array(e.size),a=this.readSync(e.dataId),i=0;i<a.length;++i){var s=a[i]>-r,u=a[i]<r,l=Math.exp(a[i]),c=void 0;c=u?l:s?a[i]:Math.log(1+l),o[i]=c}return this.makeOutput(o,e.shape,"float32")},t.prototype.sin=function(e){Mt(e,"sin");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a)r[a]=Math.sin(o[a]);return this.makeOutput(r,e.shape,"float32")},t.prototype.cos=function(e){Mt(e,"cos");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a)r[a]=Math.cos(o[a]);return this.makeOutput(r,e.shape,"float32")},t.prototype.tan=function(e){Mt(e,"tan");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a)r[a]=Math.tan(o[a]);return this.makeOutput(r,e.shape,"float32")},t.prototype.asin=function(e){Mt(e,"asin");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a)r[a]=Math.asin(o[a]);return this.makeOutput(r,e.shape,"float32")},t.prototype.acos=function(e){Mt(e,"acos");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a)r[a]=Math.acos(o[a]);return this.makeOutput(r,e.shape,"float32")},t.prototype.atan=function(e){Mt(e,"atan");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a)r[a]=Math.atan(o[a]);return this.makeOutput(r,e.shape,"float32")},t.prototype.atan2=function(e,r){return Mt([e,r],"atan2"),this.broadcastedBinaryOp(e,r,e.dtype,function(o,a){return Math.atan2(o,a)})},t.prototype.sinh=function(e){Mt(e,"sinh");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a)r[a]=Math.sinh(o[a]);return this.makeOutput(r,e.shape,"float32")},t.prototype.cosh=function(e){Mt(e,"cosh");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a)r[a]=Math.cosh(o[a]);return this.makeOutput(r,e.shape,"float32")},t.prototype.tanh=function(e){Mt(e,"tanh");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a)r[a]=aat(o[a]);return this.makeOutput(r,e.shape,"float32")},t.prototype.asinh=function(e){Mt(e,"asinh");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a)r[a]=Math.asinh(o[a]);return this.makeOutput(r,e.shape,"float32")},t.prototype.acosh=function(e){Mt(e,"acosh");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a)r[a]=Math.acosh(o[a]);return this.makeOutput(r,e.shape,"float32")},t.prototype.atanh=function(e){Mt(e,"atanh");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a)r[a]=Math.atanh(o[a]);return this.makeOutput(r,e.shape,"float32")},t.prototype.erf=function(e){Mt(e,"erf");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a){var i=Math.sign(o[a]),s=Math.abs(o[a]),u=1/(1+.3275911*s);r[a]=i*(1-((((1.061405429*u-1.453152027)*u+1.421413741)*u-.284496736)*u+.254829592)*u*Math.exp(-s*s))}return this.makeOutput(r,e.shape,"float32")},t.prototype.step=function(e,r){r===void 0&&(r=0),Mt(e,"step");for(var o=new Float32Array(e.size),a=this.readSync(e.dataId),i=0;i<a.length;++i){var s=a[i];isNaN(s)?o[i]=NaN:o[i]=s>0?1:r}return this.makeOutput(o,e.shape,"float32")},t.prototype.fusedConv2d=function(e){var r=e.input,o=e.filter,a=e.convInfo,i=e.bias,s=e.activation,u=e.preluActivationWeights,l=this.conv2d(r,o,a);return i&&(l=this.add(l,i)),s&&(l=jC(this,l,s,u)),l},t.prototype.conv2d=function(e,r,o){Mt([e,r],"conv2d");for(var a=o.filterHeight,i=o.filterWidth,s=o.dilationHeight,u=o.dilationWidth,l=o.padInfo.left,c=o.padInfo.top,h=o.dataFormat==="channelsLast",d=Ce(o.outShape,e.dtype),p=e.strides[0],g=h?e.strides[1]:e.strides[2],x=h?e.strides[2]:1,y=h?1:e.strides[1],b=d.strides[0],C=h?d.strides[1]:d.strides[2],E=h?d.strides[2]:1,S=h?1:d.strides[1],k=this.readSync(e.dataId),R=this.readSync(r.dataId),A=d.values,N=0;N<o.batchSize;++N)for(var _=N*p,$=N*b,D=0;D<o.outHeight;++D)for(var O=$+D*C,P=D*o.strideHeight-c,z=0;z<a;z++){var W=P+z*s;if(!(W<0||W>=o.inHeight))for(var F=z*r.strides[0],B=_+W*g,U=0;U<o.outWidth;++U)for(var q=O+U*E,M=U*o.strideWidth-l,G=0;G<i;G++){var Q=M+G*u;if(!(Q<0||Q>=o.inWidth))for(var Z=B+Q*x,rt=F+G*r.strides[1],ct=0;ct<o.inChannels;++ct){for(var pt=k[Z+ct*y],Rt=0;Rt<o.outChannels;++Rt)A[q+Rt*S]+=pt*R[rt+Rt];rt+=o.outChannels}}}return d.toTensor()},t.prototype.conv3d=function(e,r,o){for(var a=o.filterDepth,i=o.filterHeight,s=o.filterWidth,u=o.dilationDepth,l=o.dilationHeight,c=o.dilationWidth,h=o.padInfo.front,d=o.padInfo.left,p=o.padInfo.top,g=Ce(o.outShape,e.dtype),x=this.readSync(e.dataId),y=this.readSync(r.dataId),b=g.values,C=0;C<o.batchSize;++C)for(var E=C*e.strides[0],S=C*g.strides[0],k=0;k<o.outDepth;++k)for(var R=S+k*g.strides[1],A=k*o.strideDepth-h,N=0;N<a;N++){var _=A+N*u;if(!(_<0||_>=o.inDepth))for(var $=N*r.strides[0],D=E+_*e.strides[1],O=0;O<o.outHeight;++O)for(var P=R+O*g.strides[2],z=O*o.strideHeight-p,W=0;W<i;W++){var F=z+W*l;if(!(F<0||F>=o.inHeight))for(var B=$+W*r.strides[1],U=D+F*e.strides[2],q=0;q<o.outWidth;++q)for(var M=P+q*o.outChannels,G=q*o.strideWidth-d,Q=0;Q<s;Q++){var Z=G+Q*c;if(!(Z<0||Z>=o.inWidth))for(var rt=B+Q*r.strides[2],ct=U+Z*o.inChannels,pt=rt,Rt=0;Rt<o.inChannels;++Rt){for(var Ct=x[ct+Rt],Ft=0;Ft<o.outChannels;++Ft)b[M+Ft]+=Ct*y[pt+Ft];pt+=o.outChannels}}}}return g.toTensor()},t.prototype.conv2dDerInput=function(e,r,o){Mt([e,r],"conv2dDerInput");for(var a=Ce(o.inShape,"float32"),i=a.values,s=this.readSync(e.dataId),u=this.readSync(r.dataId),l=r.strides,c=l[0],h=l[1],d=l[2],p=o.batchSize,g=o.filterHeight,x=o.filterWidth,y=o.inChannels,b=o.inHeight,C=o.inWidth,E=o.outChannels,S=o.outHeight,k=o.outWidth,R=o.strideHeight,A=o.strideWidth,N=o.dataFormat,_=g-1-o.padInfo.top,$=x-1-o.padInfo.left,D=N==="channelsLast",O=a.strides[0],P=D?a.strides[1]:a.strides[2],z=D?a.strides[2]:1,W=D?1:a.strides[1],F=e.strides[0],B=D?e.strides[1]:e.strides[2],U=D?e.strides[2]:1,q=D?1:e.strides[1],M=0;M<p;++M)for(var G=0;G<y;++G)for(var Q=0;Q<b;++Q)for(var Z=Q-_,rt=Math.max(0,Math.ceil(Z/R)),ct=Math.min(S,(g+Z)/R),pt=0;pt<C;++pt){for(var Rt=pt-$,Ct=Math.max(0,Math.ceil(Rt/A)),Ft=Math.min(k,(x+Rt)/A),Ut=0,Pt=rt;Pt<ct;++Pt)for(var Vt=Pt*R-Z,Ht=Ct;Ht<Ft;++Ht)for(var ee=F*M+B*Pt+U*Ht,te=c*(g-1-Vt)+h*(x-1-(Ht*A-Rt))+d*G,ne=0;ne<E;++ne)Ut+=s[ee+q*ne]*u[te+ne];i[O*M+P*Q+z*pt+W*G]=Ut}return a.toTensor()},t.prototype.conv3dDerInput=function(e,r,o){for(var a=Ce(o.inShape,"float32"),i=a.values,s=a.strides,u=s[0],l=s[1],c=s[2],h=s[3],d=this.readSync(e.dataId),p=e.strides,g=p[0],x=p[1],y=p[2],b=p[3],C=this.readSync(r.dataId),E=r.strides,S=E[0],k=E[1],R=E[2],A=E[3],N=o.batchSize,_=o.filterDepth,$=o.filterHeight,D=o.filterWidth,O=o.inChannels,P=o.inDepth,z=o.inHeight,W=o.inWidth,F=o.outChannels,B=o.outDepth,U=o.outHeight,q=o.outWidth,M=o.strideDepth,G=o.strideHeight,Q=o.strideWidth,Z=_-1-o.padInfo.front,rt=$-1-o.padInfo.top,ct=D-1-o.padInfo.left,pt=0;pt<N;++pt)for(var Rt=0;Rt<O;++Rt)for(var Ct=0;Ct<P;++Ct)for(var Ft=Ct-Z,Ut=Math.max(0,Math.ceil(Ft/M)),Pt=Math.min(B,(_+Ft)/M),Vt=0;Vt<z;++Vt)for(var Ht=Vt-rt,ee=Math.max(0,Math.ceil(Ht/G)),te=Math.min(U,($+Ht)/G),ne=0;ne<W;++ne){for(var ge=ne-ct,we=Math.max(0,Math.ceil(ge/Q)),en=Math.min(q,(D+ge)/Q),ze=0,un=Ut;un<Pt;++un)for(var nn=un*M-Ft,Gn=ee;Gn<te;++Gn)for(var Dn=Gn*G-Ht,Bn=we;Bn<en;++Bn)for(var cr=g*pt+x*un+y*Gn+b*Bn,Ge=S*(_-1-nn)+k*($-1-Dn)+R*(D-1-(Bn*Q-ge))+A*Rt,mn=0;mn<F;++mn)ze+=d[cr+mn]*C[Ge+mn];i[u*pt+l*Ct+c*Vt+h*ne+Rt]=ze}return a.toTensor()},t.prototype.conv2dDerFilter=function(e,r,o){Mt([e,r],"conv2dDerFilter");for(var a=o.strideHeight,i=o.strideWidth,s=o.filterHeight,u=o.filterWidth,l=o.dataFormat==="channelsLast",c=Ce(o.filterShape,"float32"),h=o.padInfo.left,d=o.padInfo.top,p=this.bufferSync(e),g=this.bufferSync(r),x=0;x<s;++x)for(var y=Math.max(0,Math.ceil((d-x)/a)),b=Math.min(o.outHeight,(o.inHeight+d-x)/a),C=0;C<u;++C)for(var E=Math.max(0,Math.ceil((h-C)/i)),S=Math.min(o.outWidth,(o.inWidth+h-C)/i),k=0;k<o.inChannels;++k)for(var R=0;R<o.outChannels;++R){for(var A=0,N=0;N<o.batchSize;++N)for(var _=y;_<b;++_)for(var $=x+_*a-d,D=E;D<S;++D){var O=C+D*i-h;A+=l?p.get(N,$,O,k)*g.get(N,_,D,R):p.get(N,k,$,O)*g.get(N,R,_,D)}c.set(A,x,C,k,R)}return c.toTensor()},t.prototype.conv3dDerFilter=function(e,r,o){for(var a=o.strideDepth,i=o.strideHeight,s=o.strideWidth,u=o.filterDepth,l=o.filterHeight,c=o.filterWidth,h=Ce(o.filterShape,"float32"),d=h.values,p=h.strides,g=p[0],x=p[1],y=p[2],b=p[3],C=this.readSync(r.dataId),E=r.strides,S=E[0],k=E[1],R=E[2],A=E[3],N=this.readSync(e.dataId),_=e.strides,$=_[0],D=_[1],O=_[2],P=_[3],z=o.padInfo.front,W=o.padInfo.left,F=o.padInfo.top,B=0;B<u;++B)for(var U=Math.max(0,Math.ceil((z-B)/a)),q=Math.min(o.outDepth,(o.inDepth+z-B)/a),M=B*g,G=0;G<l;++G)for(var Q=Math.max(0,Math.ceil((F-G)/i)),Z=Math.min(o.outHeight,(o.inHeight+F-G)/i),rt=G*x+M,ct=0;ct<c;++ct)for(var pt=Math.max(0,Math.ceil((W-ct)/s)),Rt=Math.min(o.outWidth,(o.inWidth+W-ct)/s),Ct=ct*y+rt,Ft=0;Ft<o.inChannels;++Ft)for(var Ut=Ft*b+Ct,Pt=0;Pt<o.outChannels;++Pt){for(var Vt=0,Ht=0;Ht<o.batchSize;++Ht)for(var ee=Ht*$,te=Ht*S,ne=U;ne<q;++ne)for(var ge=(B+ne*a-z)*D+ee,we=ne*k+te,en=Q;en<Z;++en)for(var ze=(G+en*i-F)*O+ge,un=en*R+we,nn=pt;nn<Rt;++nn){var Gn=nn*A+un;Vt+=N[(ct+nn*s-W)*P+ze+Ft]*C[Gn+Pt]}d[Ut+Pt]=Vt}return h.toTensor()},t.prototype.fusedDepthwiseConv2D=function(e){var r=e.input,o=e.filter,a=e.convInfo,i=e.bias,s=e.activation,u=e.preluActivationWeights,l=this.depthwiseConv2D(r,o,a);return i&&(l=this.add(l,i)),s&&(l=jC(this,l,s,u)),l},t.prototype.depthwiseConv2D=function(e,r,o){Mt([e,r],"depthwiseConv2D");for(var a=o.filterHeight,i=o.filterWidth,s=o.dilationHeight,u=o.dilationWidth,l=o.padInfo.left,c=o.padInfo.top,h=o.outChannels/o.inChannels,d=Ce(o.outShape,e.dtype),p=this.readSync(e.dataId),g=this.readSync(r.dataId),x=d.values,y=0;y<o.batchSize;++y)for(var b=y*e.strides[0],C=y*d.strides[0],E=0;E<o.outHeight;++E)for(var S=C+E*d.strides[1],k=E*o.strideHeight-l,R=0;R<a;++R){var A=k+R*s;if(!(A<0||A>=o.inHeight))for(var N=R*r.strides[0],_=b+A*e.strides[1],$=0;$<o.outWidth;++$)for(var D=S+$*d.strides[2],O=$*o.strideWidth-c,P=0;P<i;++P){var z=O+P*u;if(!(z<0||z>=o.inWidth))for(var W=N+P*r.strides[1],F=_+z*o.inChannels,B=D,U=W,q=0;q<o.inChannels;++q){for(var M=p[F+q],G=0;G<h;++G)x[B+G]+=M*g[U+G];B+=h,U+=h}}}return d.toTensor()},t.prototype.depthwiseConv2DDerInput=function(e,r,o){Mt([e,r],"depthwiseConv2DDerInput");for(var a=Ce(o.inShape,"float32"),i=a.values,s=a.strides,u=s[0],l=s[1],c=s[2],h=this.readSync(e.dataId),d=e.strides,p=d[0],g=d[1],x=d[2],y=this.readSync(r.dataId),b=r.strides,C=b[0],E=b[1],S=b[2],k=o.batchSize,R=o.filterHeight,A=o.filterWidth,N=o.inChannels,_=o.inHeight,$=o.inWidth,D=o.outChannels,O=o.outHeight,P=o.outWidth,z=o.strideHeight,W=o.strideWidth,F=R-1-o.padInfo.top,B=A-1-o.padInfo.left,U=D/N,q=0;q<k;++q)for(var M=0;M<N;++M)for(var G=0;G<_;++G)for(var Q=G-F,Z=Math.max(0,Math.ceil(Q/z)),rt=Math.min(O,(R+Q)/z),ct=0;ct<$;++ct){for(var pt=ct-B,Rt=Math.max(0,Math.ceil(pt/W)),Ct=Math.min(P,(A+pt)/W),Ft=0,Ut=Z;Ut<rt;++Ut)for(var Pt=Ut*z-Q,Vt=Rt;Vt<Ct;++Vt)for(var Ht=p*q+g*Ut+x*Vt,ee=C*(R-1-Pt)+E*(A-1-(Vt*W-pt))+S*M,te=0;te<U;++te)Ft+=h[Ht+(M*U+te)]*y[ee+te];i[u*q+l*G+c*ct+M]=Ft}return a.toTensor()},t.prototype.depthwiseConv2DDerFilter=function(e,r,o){Mt([e,r],"depthwiseConv2DDerFilter");for(var a=o.strideHeight,i=o.strideWidth,s=o.filterHeight,u=o.filterWidth,l=Ce(o.filterShape,"float32"),c=o.padInfo.left,h=o.padInfo.top,d=o.outChannels/o.inChannels,p=this.bufferSync(e),g=this.bufferSync(r),x=0;x<s;++x)for(var y=Math.max(0,Math.ceil((h-x)/a)),b=Math.min(o.outHeight,(o.inHeight+h-x)/a),C=0;C<u;++C)for(var E=Math.max(0,Math.ceil((c-C)/i)),S=Math.min(o.outWidth,(o.inWidth+c-C)/i),k=0;k<o.outChannels;++k){for(var R=Math.trunc(k/d),A=k%d,N=0,_=0;_<o.batchSize;++_)for(var $=y;$<b;++$)for(var D=x+$*a-h,O=E;O<S;++O){var P=C+O*i-c;N+=p.get(_,D,P,R)*g.get(_,$,O,k)}l.set(N,x,C,R,A)}return l.toTensor()},t.prototype.tile=function(e,r){return Mt(e,"tile"),hP(this.bufferSync(e),r)},t.prototype.pad=function(e,r,o){Mt(e,"pad");var a=r.map(function(d,p){return d[0]+e.shape[p]+d[1]}),i=r.map(function(d){return d[0]}),s=this.bufferSync(e),u=Ce(a,e.dtype);o!==0&&u.values.fill(o);for(var l=0;l<e.size;l++){var c=s.indexToLoc(l),h=c.map(function(d,p){return d+i[p]});u.set.apply(u,[s.get.apply(s,c)].concat(h))}return u.toTensor()},t.prototype.gather=function(e,r,o){Mt([e,r],"gather");var a=e.shape.slice(),i=this.readSync(r.dataId);a[o]=i.length;for(var s=Ce(a,e.dtype),u=this.bufferSync(e),l=0;l<s.size;++l){var c=s.indexToLoc(l),h=c.slice();h[o]=i[c[o]];var d=u.locToIndex(h);s.values[l]=u.values[d]}return s.toTensor()},t.prototype.batchToSpaceND=function(e,r,o){Mt([e],"batchToSpaceND");var a=r.reduce(function(h,d){return h*d}),i=ny(e.shape,r,a),s=ry(i.length,r.length),u=oy(e.shape,r,a),l=VL(o,r.length),c=GL(u,o,r.length);return ai(e.reshape(i),s).reshape(u).slice(l,c)},t.prototype.spaceToBatchND=function(e,r,o){Mt([e],"spaceToBatchND");var a=r.reduce(function(d,p){return d*p}),i=[[0,0]];i.push.apply(i,o);for(var s=1+r.length;s<e.shape.length;++s)i.push([0,0]);var u=e.pad(i),l=ny(u.shape,r,a,!1),c=ry(l.length,r.length,!1),h=oy(u.shape,r,a,!1);return ai(u.reshape(l),c).reshape(h)},t.prototype.maxPool=function(e,r){return Mt(e,"maxPool"),cE(this.readSync(e.dataId),e.shape,e.dtype,e.strides,r,"max").toTensor()},t.prototype.maxPoolBackprop=function(e,r,o,a){Mt([r,o],"maxPoolBackprop");for(var i=this.readSync(r.dataId),s=Ce(a.outShape,r.dtype,aB(i,r.shape,r.dtype,a).values),u=a.strideHeight,l=a.strideWidth,c=a.dilationHeight,h=a.dilationWidth,d=a.effectiveFilterHeight,p=a.effectiveFilterWidth,g=p-1-a.padInfo.left,x=d-1-a.padInfo.top,y=Ce(r.shape,"float32"),b=this.bufferSync(e),C=0;C<a.batchSize;++C)for(var E=0;E<a.inChannels;++E)for(var S=0;S<a.inHeight;++S)for(var k=0;k<a.inWidth;++k){for(var R=S-x,A=k-g,N=0,_=0;_<d;_+=c){var $=(R+_)/u;if(!($<0||$>=a.outHeight||Math.floor($)!==$))for(var D=0;D<p;D+=h){var O=(A+D)/l;if(!(O<0||O>=a.outWidth||Math.floor(O)!==O)){var P=d*p-1-s.get(C,$,O,E)===_*p+D?1:0;P!==0&&(N+=b.get(C,$,O,E)*P)}}}y.set(N,C,S,k,E)}return y.toTensor()},t.prototype.avgPoolBackprop=function(e,r,o){Mt([e,r],"avgPoolBackprop");for(var a=o.strideHeight,i=o.strideWidth,s=o.filterHeight,u=o.filterWidth,l=o.dilationHeight,c=o.dilationWidth,h=o.effectiveFilterHeight,d=o.effectiveFilterWidth,p=d-1-o.padInfo.left,g=h-1-o.padInfo.top,x=Ce(r.shape,"float32"),y=1/(s*u),b=this.bufferSync(e),C=0;C<o.batchSize;++C)for(var E=0;E<o.inChannels;++E)for(var S=0;S<o.inHeight;++S)for(var k=0;k<o.inWidth;++k){for(var R=S-g,A=k-p,N=0,_=0;_<h;_+=l){var $=(R+_)/a;if(!($<0||$>=o.outHeight||Math.floor($)!==$))for(var D=0;D<d;D+=c){var O=(A+D)/i;O<0||O>=o.outWidth||Math.floor(O)!==O||(N+=b.get(C,$,O,E))}}x.set(N*y,C,S,k,E)}return x.toTensor()},t.prototype.pool3d=function(e,r,o){Mt(e,"pool3d");for(var a=r.strideDepth,i=r.strideHeight,s=r.strideWidth,u=r.dilationDepth,l=r.dilationHeight,c=r.dilationWidth,h=r.effectiveFilterDepth,d=r.effectiveFilterHeight,p=r.effectiveFilterWidth,g=r.padInfo.front,x=r.padInfo.top,y=r.padInfo.left,b=o==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,C=this.readSync(e.dataId),E=Ce(r.outShape,e.dtype),S=E.values,k=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],R=r.outShape[2]*r.outShape[3]*r.outShape[4],A=r.outShape[3]*r.outShape[4],N=r.outShape[4],_=0;_<r.batchSize;++_)for(var $=_*k,D=_*e.strides[0],O=0;O<r.inChannels;++O)for(var P=0;P<r.outDepth;++P){for(var z=P*a-g,W=z;W<0;)W+=u;for(var F=Math.min(r.inDepth,h+z),B=$+P*R,U=0;U<r.outHeight;++U){for(var q=U*i-x,M=q;M<0;)M+=l;for(var G=Math.min(r.inHeight,d+q),Q=B+U*A,Z=0;Z<r.outWidth;++Z){for(var rt=Z*s-y,ct=rt;ct<0;)ct+=c;for(var pt=Math.min(r.inWidth,p+rt),Rt=Q+Z*N,Ct=b,Ft=0,Ut=0,Pt=W;Pt<F;Pt+=u){for(var Vt=D+Pt*e.strides[1],Ht=M;Ht<G;Ht+=l){for(var ee=Vt+Ht*e.strides[2],te=ct;te<pt;te+=c){var ne=C[ee+te*e.strides[3]+O];if(o==="max"&&ne>Ct?Ct=ne:o==="avg"&&(Ft+=ne,Ut++),isNaN(Ct))break}if(isNaN(Ct))break}if(isNaN(Ct))break}S[Rt+O]=o==="avg"?Ft/Ut:Ct}}}return E.toTensor()},t.prototype.avgPool3d=function(e,r){return Mt(e,"avgPool3d"),this.pool3d(e,r,"avg").toFloat()},t.prototype.avgPool3dBackprop=function(e,r,o){Mt([e,r],"avgPool3dBackprop");for(var a=o.strideDepth,i=o.strideHeight,s=o.strideWidth,u=o.filterDepth,l=o.filterHeight,c=o.filterWidth,h=o.dilationDepth,d=o.dilationHeight,p=o.dilationWidth,g=o.effectiveFilterDepth,x=o.effectiveFilterHeight,y=o.effectiveFilterWidth,b=g-1-o.padInfo.front,C=y-1-o.padInfo.left,E=x-1-o.padInfo.top,S=Ce(r.shape,"float32"),k=1/(u*l*c),R=this.bufferSync(e),A=0;A<o.batchSize;++A)for(var N=0;N<o.inChannels;++N)for(var _=0;_<o.inDepth;++_)for(var $=0;$<o.inHeight;++$)for(var D=0;D<o.inWidth;++D){for(var O=_-b,P=$-E,z=D-C,W=0,F=0;F<g;F+=h){var B=(O+F)/a;if(!(B<0||B>=o.outDepth||Math.floor(B)!==B))for(var U=0;U<x;U+=d){var q=(P+U)/i;if(!(q<0||q>=o.outHeight||Math.floor(q)!==q))for(var M=0;M<y;M+=p){var G=(z+M)/s;G<0||G>=o.outWidth||Math.floor(G)!==G||(W+=R.get(A,B,q,G,N))}}}S.set(W*k,A,_,$,D,N)}return S.toTensor()},t.prototype.maxPool3d=function(e,r){return Mt(e,"maxPool3d"),this.pool3d(e,r,"max").toFloat()},t.prototype.maxPool3dPositions=function(e,r){for(var o=Ce(r.outShape,"int32"),a=r.strideDepth,i=r.strideHeight,s=r.strideWidth,u=r.dilationDepth,l=r.dilationHeight,c=r.dilationWidth,h=r.effectiveFilterDepth,d=r.effectiveFilterHeight,p=r.effectiveFilterWidth,g=r.padInfo.front,x=r.padInfo.top,y=r.padInfo.left,b=this.bufferSync(e),C=0;C<r.batchSize;++C)for(var E=0;E<r.inChannels;++E)for(var S=0;S<r.outDepth;++S){for(var k=S*a-g,R=k;R<0;)R+=u;for(var A=Math.min(r.inDepth,h+k),N=0;N<r.outHeight;++N){for(var _=N*i-x,$=_;$<0;)$+=l;for(var D=Math.min(r.inHeight,d+_),O=0;O<r.outWidth;++O){for(var P=O*s-y,z=P;z<0;)z+=c;for(var W=Math.min(r.inWidth,p+P),F=Number.NEGATIVE_INFINITY,B=-1,U=R;U<A;U+=u)for(var q=U-k,M=$;M<D;M+=l)for(var G=M-_,Q=z;Q<W;Q+=c){var Z=Q-P,rt=b.get(C,U,M,Q,E);rt>=F&&(F=rt,B=q*d*p+G*d+Z)}o.set(B,C,S,N,O,E)}}}return o.toTensor()},t.prototype.maxPool3dBackprop=function(e,r,o,a){Mt([r,o],"maxPool3dBackprop");for(var i=this.maxPool3dPositions(r,a),s=a.strideDepth,u=a.strideHeight,l=a.strideWidth,c=a.dilationDepth,h=a.dilationHeight,d=a.dilationWidth,p=a.effectiveFilterDepth,g=a.effectiveFilterHeight,x=a.effectiveFilterWidth,y=p-1-a.padInfo.front,b=x-1-a.padInfo.left,C=g-1-a.padInfo.top,E=Ce(r.shape,"float32"),S=this.bufferSync(i),k=this.bufferSync(e),R=0;R<a.batchSize;++R)for(var A=0;A<a.inChannels;++A)for(var N=0;N<a.inDepth;++N)for(var _=0;_<a.inHeight;++_)for(var $=0;$<a.inWidth;++$){for(var D=N-y,O=_-C,P=$-b,z=0,W=0;W<p;W+=c){var F=(D+W)/s;if(!(F<0||F>=a.outDepth||Math.floor(F)!==F))for(var B=0;B<g;B+=h){var U=(O+B)/u;if(!(U<0||U>=a.outHeight||Math.floor(U)!==U))for(var q=0;q<x;q+=d){var M=(P+q)/l;if(!(M<0||M>=a.outWidth||Math.floor(M)!==M)){var G=p*g*x-1-S.get(R,F,U,M,A)===W*g*x+B*x+q?1:0;G!==0&&(z+=k.get(R,F,U,M,A)*G)}}}}E.set(z,R,N,_,$,A)}return E.toTensor()},t.prototype.cast=function(e,r){return sP(e,r,this)},t.prototype.reshape=function(e,r){return uE(e,r)},t.prototype.avgPool=function(e,r){return Mt(e,"avgPool"),Mt(e,"maxPool"),cE(this.readSync(e.dataId),e.shape,e.dtype,e.strides,r,"avg").toTensor().toFloat()},t.prototype.resizeBilinear=function(e,r,o,a){Mt(e,"resizeBilinear");for(var i=e.shape,s=i[0],u=i[1],l=i[2],c=i[3],h=this.readSync(e.dataId),d=new Float32Array(Yt([s,r,o,c])),p=[a&&r>1?u-1:u,a&&o>1?l-1:l],g=[a&&r>1?r-1:r,a&&o>1?o-1:o],x=0,y=p[0]/g[0],b=p[1]/g[1],C=0;C<s;C++)for(var E=0;E<r;E++)for(var S=y*E,k=Math.floor(S),R=S-k,A=Math.min(u-1,Math.ceil(S)),N=C*e.strides[0]+k*e.strides[1],_=C*e.strides[0]+A*e.strides[1],$=0;$<o;$++)for(var D=b*$,O=Math.floor(D),P=D-O,z=Math.min(l-1,Math.ceil(D)),W=N+O*e.strides[2],F=_+O*e.strides[2],B=N+z*e.strides[2],U=_+z*e.strides[2],q=0;q<c;q++){var M=h[W+q],G=h[F+q],Q=M+(h[B+q]-M)*P,Z=Q+(G+(h[U+q]-G)*P-Q)*R;d[x++]=Z}return Qr(d,[s,r,o,c])},t.prototype.resizeBilinearBackprop=function(e,r,o){Mt([e,r],"resizeBilinearBackprop");for(var a=r.shape,i=a[0],s=a[1],u=a[2],l=a[3],c=e.shape,h=c[1],d=c[2],p=new Float32Array(i*s*u*l),g=[o&&h>1?s-1:s,o&&d>1?u-1:u],x=[o&&h>1?h-1:h,o&&d>1?d-1:d],y=g[0]/x[0],b=g[1]/x[1],C=this.readSync(e.dataId),E=0,S=0;S<i;S++)for(var k=S*r.strides[0],R=0;R<h;R++)for(var A=R*y,N=Math.floor(A),_=Math.min(Math.ceil(A),s-1),$=k+N*r.strides[1],D=k+_*r.strides[1],O=A-N,P=1-O,z=0;z<d;z++)for(var W=z*b,F=Math.floor(W),B=Math.min(Math.ceil(W),u-1),U=W-F,q=1-U,M=$+F*r.strides[2],G=$+B*r.strides[2],Q=D+F*r.strides[2],Z=D+B*r.strides[2],rt=P*q,ct=P*U,pt=O*q,Rt=O*U,Ct=0;Ct<l;Ct++){var Ft=C[E++];p[M+Ct]+=Ft*rt,p[G+Ct]+=Ft*ct,p[Q+Ct]+=Ft*pt,p[Z+Ct]+=Ft*Rt}return Pi(p,[i,u,s,l],r.dtype)},t.prototype.resizeNearestNeighbor=function(e,r,o,a){Mt(e,"resizeNearestNeighbor");for(var i=e.shape,s=i[0],u=i[1],l=i[2],c=i[3],h=this.readSync(e.dataId),d=new Float32Array(s*r*o*c),p=[a&&r>1?u-1:u,a&&o>1?l-1:l],g=[a&&r>1?r-1:r,a&&o>1?o-1:o],x=p[0]/g[0],y=p[1]/g[1],b=0,C=0;C<s;C++)for(var E=C*e.strides[0],S=0;S<r;S++)for(var k=x*S,R=E+Math.min(u-1,a?Math.round(k):Math.floor(k))*e.strides[1],A=0;A<o;A++)for(var N=y*A,_=R+Math.min(l-1,a?Math.round(N):Math.floor(N))*e.strides[2],$=0;$<c;$++){var D=h[_+$];d[b++]=D}return Qr(d,[s,r,o,c],e.dtype)},t.prototype.resizeNearestNeighborBackprop=function(e,r,o){Mt([e,r],"resizeNearestNeighborBackprop");for(var a=r.shape,i=a[0],s=a[1],u=a[2],l=a[3],c=e.shape,h=c[1],d=c[2],p=new Float32Array(i*s*u*l),g=this.readSync(e.dataId),x=[o&&h>1?s-1:s,o&&d>1?u-1:u],y=[o&&h>1?h-1:h,o&&d>1?d-1:d],b=x[0]/y[0],C=x[1]/y[1],E=1/b,S=1/C,k=2*Math.ceil(E)+2,R=2*Math.ceil(S)+2,A=0;A<i;A++)for(var N=A*r.strides[0],_=0;_<s;_++)for(var $=N+_*r.strides[1],D=Math.floor(_*E),O=Math.floor(D-k/2),P=0;P<u;P++)for(var z=$+P*r.strides[2],W=Math.floor(P*S),F=Math.floor(W-R/2),B=0;B<l;B++){for(var U=0,q=0;q<k;q++){var M=q+O;if(!(M<0||M>=h)){var G=N+M*e.strides[1],Q=M*b;if(_===Math.min(s-1,o?Math.round(Q):Math.floor(Q)))for(var Z=0;Z<R;Z++){var rt=Z+F;if(!(rt<0||rt>=d)){var ct=G+rt*e.strides[2],pt=rt*C;P===Math.min(u-1,o?Math.round(pt):Math.floor(pt))&&(U+=g[ct+B])}}}}p[z+B]=U}return Pi(p,r.shape,r.dtype)},t.prototype.batchNormalization=function(e,r,o,a,i,s){Mt([e,r,o,i,s],"batchNorm");for(var u=this.readSync(e.dataId),l=this.readSync(r.dataId),c=this.readSync(o.dataId),h=i?this.readSync(i.dataId):new Float32Array([1]),d=s?this.readSync(s.dataId):new Float32Array([0]),p=new Float32Array(u.length),g=d.length,x=h.length,y=c.length,b=l.length,C=0,E=0,S=0,k=0,R=0;R<u.length;++R)p[R]=d[C++]+(u[R]-l[E++])*h[S++]/Math.sqrt(c[k++]+a),C>=g&&(C=0),E>=b&&(E=0),S>=x&&(S=0),k>=y&&(k=0);return Pi(p,e.shape)},t.prototype.localResponseNormalization4D=function(e,r,o,a,i){Mt(e,"localResponseNormalization4D");var s=e.shape[3],u=s-1,l=this.readSync(e.dataId),c=e.size,h=new Float32Array(c);function d(y){for(var b=y%s,C=y-b+Math.max(0,b-r),E=y-b+Math.min(b+r,u),S=0;C<=E;C++){var k=l[C];S+=k*k}return S}for(var p=0;p<c;p++){var g=d(p),x=l[p]*Math.pow(o+a*g,-i);h[p]=x}return Pi(h,e.shape)},t.prototype.LRNGrad=function(e,r,o,a,i,s,u){Mt(e,"LRNGrad");for(var l=e.shape[3],c=this.readSync(e.dataId),h=this.readSync(r.dataId),d=this.readSync(o.dataId),p=new Float32Array(e.size),g=e.size,x=0;x<g;x++){for(var y=x%l,b=x-y+Math.max(0,y-a),C=x-y+Math.min(l,y+a+1),E=0,S=b;S<C;S++)E+=Math.pow(h[S],2);for(E=s*E+i,S=b;S<C;S++){var k=-2*s*u*h[S]*d[x]/E;x===S&&(k+=Math.pow(E,-u)),k*=c[x],p[S]+=k}}return Pi(p,e.shape)},t.prototype.multinomial=function(e,r,o,a){Mt(e,"multinomial");for(var i=r?e:r1(e),s=i.shape[0],u=i.shape[1],l=Yn([s,o],"int32"),c=this.readSync(l.dataId),h=this.readSync(i.dataId),d=0;d<s;++d){var p=d*u,g=new Float32Array(u-1);g[0]=h[p];for(var x=1;x<g.length;++x)g[x]=g[x-1]+h[p+x];for(var y=o1(a.toString()),b=d*o,C=0;C<o;++C){var E=y();c[b+C]=g.length;for(var S=0;S<g.length;S++)if(E<g[S]){c[b+C]=S;break}}}return l},t.prototype.oneHot=function(e,r,o,a){Mt(e,"oneHot");var i=new Float32Array(e.size*r);i.fill(a);for(var s=this.readSync(e.dataId),u=0;u<e.size;++u)s[u]>=0&&s[u]<r&&(i[u*r+s[u]]=o);return mc(i,[e.size,r],"int32")},t.prototype.nonMaxSuppression=function(e,r,o,a,i){return Mt(e,"nonMaxSuppression"),Pk(this.readSync(e.dataId),this.readSync(r.dataId),o,a,i)},t.prototype.fft=function(e){return this.fftBatch(e,!1)},t.prototype.ifft=function(e){return this.fftBatch(e,!0)},t.prototype.fftBatch=function(e,r){for(var o=e.shape[0],a=e.shape[1],i=Ce(e.shape,"float32"),s=Ce(e.shape,"float32"),u=Pa(e).as2D(o,a),l=Vi(e).as2D(o,a),c=0;c<o;c++)for(var h=u.slice([c,0],[1,a]),d=l.slice([c,0],[1,a]),p=Kr(h,d),g=this.readSync(this.fftImpl(p,r).dataId),x=0;x<a;x++){var y=bO(g,x);i.values[c*a+x]=y.real,s.values[c*a+x]=y.imag}return Kr(i.toTensor(),s.toTensor()).as2D(o,a)},t.prototype.fftImpl=function(e,r){var o=e.as1D(),a=o.size;if(this.isExponentOf2(a)){var i=this.fftRadix2(o,a,r).as2D(e.shape[0],e.shape[1]);return r&&(i=Kr(Pa(i).div(ae(a)),Vi(i).div(ae(a)))),i}var s=this.readSync(e.dataId),u=function(l){for(var c=new Float32Array(l.length/2),h=new Float32Array(l.length/2),d=0;d<l.length;d+=2)c[d/2]=l[d],h[d/2]=l[d+1];return{real:c,imag:h}}(this.fourierTransformByMatmul(s,a,r));return Kr(u.real,u.imag).as2D(e.shape[0],e.shape[1])},t.prototype.isExponentOf2=function(e){return(e&e-1)==0},t.prototype.fftRadix2=function(e,r,o){if(r===1)return e;var a=this.readSync(e.dataId),i=r/2,s=function(b){for(var C=Math.ceil(b.length/4),E=new Float32Array(C),S=new Float32Array(C),k=0;k<b.length;k+=4)E[Math.floor(k/4)]=b[k],S[Math.floor(k/4)]=b[k+1];return{real:E,imag:S}}(a),u=Kr(s.real,s.imag).as1D(),l=function(b){for(var C=Math.floor(b.length/4),E=new Float32Array(C),S=new Float32Array(C),k=2;k<b.length;k+=4)E[Math.floor(k/4)]=b[k],S[Math.floor(k/4)]=b[k+1];return{real:E,imag:S}}(a),c=Kr(l.real,l.imag).as1D();u=this.fftRadix2(u,i,o),c=this.fftRadix2(c,i,o);var h=function(b,C){for(var E=new Float32Array(b/2),S=new Float32Array(b/2),k=0;k<Math.ceil(b/2);k++){var R=(C?2:-2)*Math.PI*(k/b);E[k]=Math.cos(R),S[k]=Math.sin(R)}return{real:E,imag:S}}(r,o),d=Kr(h.real,h.imag).mul(c),p=u.add(d),g=u.sub(d),x=Pa(p).concat(Pa(g)),y=Vi(p).concat(Vi(g));return Kr(x,y).as1D()},t.prototype.fourierTransformByMatmul=function(e,r,o){for(var a=new Float32Array(2*r),i=0;i<r;i++){for(var s=0,u=0,l=0;l<r;l++){var c=sst(i*l,r,o),h=bO(e,l);s+=h.real*c.real-h.imag*c.imag,u+=h.real*c.imag+h.imag*c.real}o&&(s/=r,u/=r),ist(a,s,u,i)}return a},t.prototype.depthToSpace=function(e,r,o){X(o==="NHWC",function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+o}),X(r>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+r});for(var a=e.shape[0],i=e.shape[1],s=e.shape[2],u=e.shape[3],l=i*r,c=s*r,h=u/(r*r),d=this.readSync(e.dataId),p=new Float32Array(a*l*c*h),g=0,x=0;x<a;++x)for(var y=0;y<l;++y)for(var b=Math.floor(y/r),C=y%r,E=0;E<c;++E)for(var S=Math.floor(E/r),k=(C*r+E%r)*h,R=0;R<h;++R){var A=R+k+u*(S+s*(b+i*x));p[g++]=d[A]}return Pi(p,[a,l,c,h])},t.prototype.broadcastedBinaryOp=function(e,r,o,a){var i=Pe(e.shape,r.shape),s=Ce(i,o),u=this.readSync(e.dataId),l=this.readSync(r.dataId),c=Hu(e.shape,i),h=Hu(r.shape,i),d=s.values;if(c.length+h.length===0)for(var p=0;p<d.length;++p)d[p]=a(u[p%u.length],l[p%l.length]);else{var g=this.bufferSync(e),x=this.bufferSync(r),y=function(b){var C=s.indexToLoc(b),E=C.slice(-e.rank);c.forEach(function(A){return E[A]=0});var S=g.locToIndex(E),k=C.slice(-r.rank);h.forEach(function(A){return k[A]=0});var R=x.locToIndex(k);d[b]=a(u[S],l[R])};for(p=0;p<d.length;++p)y(p)}return s.toTensor()},t.prototype.broadcastedBinaryComplexOp=function(e,r,o){var a=Pe(e.shape,r.shape),i=Ce(a,"float32"),s=Ce(a,"float32"),u=this.readSync(e.dataId),l=this.readSync(r.dataId),c=Hu(e.shape,a),h=Hu(r.shape,a),d=i.values,p=s.values;if(c.length+h.length===0)for(var g=0;g<d.length;g++){var x=g%u.length,y=g%l.length,b=o(u[2*x],u[2*x+1],l[2*y],l[2*y+1]);d[g]=b.real,p[g]=b.imag}else{var C=this.bufferSync(this.data.get(e.dataId).complexTensors.real),E=this.bufferSync(this.data.get(r.dataId).complexTensors.real),S=function(k){var R=i.indexToLoc(k),A=R.slice(-e.rank);c.forEach(function(O){return A[O]=0});var N=C.locToIndex(A),_=R.slice(-r.rank);h.forEach(function(O){return _[O]=0});var $=E.locToIndex(_),D=o(u[2*N],u[2*N+1],l[2*$],l[2*$+1]);d[k]=D.real,p[k]=D.imag};for(g=0;g<d.length;g++)S(g)}return this.complex(i.toTensor(),s.toTensor())},t.prototype.split=function(e,r,o){return cP(e,r,o)},t.prototype.dispose=function(){},t.prototype.floatPrecision=function(){return 32},t.prototype.epsilon=function(){return 1e-7},t.prototype.cropAndResize=function(e,r,o,a,i,s){for(var u=e.shape,l=u[0],c=u[1],h=u[2],d=u[3],p=r.shape[0],g=a[0],x=a[1],y=Ce([p,g,x,d],"float32"),b=this.readSync(r.dataId),C=this.readSync(o.dataId),E=this.readSync(e.dataId),S=e.strides,k=y.strides,R=0;R<p;R++){var A=4*R,N=b[A],_=b[A+1],$=b[A+2],D=b[A+3],O=C[R];if(!(O>=l))for(var P=g>1?($-N)*(c-1)/(g-1):0,z=x>1?(D-_)*(h-1)/(x-1):0,W=0;W<g;W++){var F=g>1?N*(c-1)+W*P:.5*(N+$)*(c-1);if(F<0||F>c-1)for(var B=0;B<x;B++)for(var U=0;U<d;U++){var q=U+B*k[2]+W*k[1]+R*k[0];y.values[q]=s}else if(i==="bilinear"){var M=Math.floor(F),G=Math.ceil(F),Q=F-M;for(B=0;B<x;B++)if((Pt=x>1?_*(h-1)+B*z:.5*(_+D)*(h-1))<0||Pt>h-1)for(U=0;U<d;U++)q=U+B*k[2]+W*k[1]+R*k[0],y.values[q]=s;else{var Z=Math.floor(Pt),rt=Math.ceil(Pt),ct=Pt-Z;for(U=0;U<d;U++){var pt=E[q=U+Z*S[2]+M*S[1]+O*S[0]],Rt=E[q=U+rt*S[2]+M*S[1]+O*S[0]],Ct=E[q=U+Z*S[2]+G*S[1]+O*S[0]],Ft=pt+(Rt-pt)*ct,Ut=Ct+(E[q=U+rt*S[2]+G*S[1]+O*S[0]]-Ct)*ct;q=U+B*k[2]+W*k[1]+R*k[0],y.values[q]=Ft+(Ut-Ft)*Q}}}else for(B=0;B<x;++B){var Pt;if((Pt=x>1?_*(h-1)+B*z:.5*(_+D)*(h-1))<0||Pt>h-1)for(U=0;U<d;U++)q=U+B*k[2]+W*k[1]+R*k[0],y.values[q]=s;else{var Vt=Math.round(Pt),Ht=Math.round(F);for(U=0;U<d;U++){var ee=U+Vt*S[2]+Ht*S[1]+O*S[0],te=U+B*k[2]+W*k[1]+R*k[0];y.values[te]=E[ee]}}}}}return y.toTensor()},t.prototype.sparseToDense=function(e,r,o,a){var i=iy(0,e,o),s=i.sliceRank,u=i.numUpdates,l=i.sliceSize,c=i.strides,h=i.outputSize;return this.scatter(e,r,o,h,l,u,s,c,a,!1)},t.prototype.gatherND=function(e,r){var o=r.shape,a=o[o.length-1],i=tP(e,r),s=i[0],u=i[1],l=i[2],c=i[3];if(u===0)return Qr([],s,e.dtype);for(var h=new nm([u,l],e.dtype),d=this.readSync(r.dataId),p=this.readSync(e.dataId),g=0;g<u;g++){for(var x=[],y=0,b=0;b<a;b++){var C=d[g*a+b];y+=C*c[b],x.push(C)}if(y<0||y>=e.size/l)throw new Error("Invalid indices: "+x+" does not index into "+e.shape);for(var E=0;E<l;E++)h.values[g*l+E]=p[y*l+E]}return h.toTensor().reshape(s)},t.prototype.scatterND=function(e,r,o){var a=iy(0,e,o),i=a.sliceRank,s=a.numUpdates,u=a.sliceSize,l=a.strides,c=a.outputSize,h=ae(0);return this.scatter(e,r,o,c,u,s,i,l,h,!0)},t.prototype.fill=function(e,r,o){var a=K0(o=o||Lm(r),Yt(e));return a.fill(r),st.makeTensor(a,e,o,this)},t.prototype.onesLike=function(e){if(e.dtype==="string")throw new Error("onesLike is not supported for string tensors");return this.fill(e.shape,1,e.dtype)},t.prototype.zerosLike=function(e){var r=K0(e.dtype,Yt(e.shape));return this.makeOutput(r,e.shape,e.dtype)},t.prototype.linspace=function(e,r,o){return uP(e,r,o)},t.prototype.scatter=function(e,r,o,a,i,s,u,l,c,h){var d=[a/i,i],p=this.readSync(e.dataId),g=this.readSync(r.dataId);if(a===0)return Qr([],o,r.dtype);var x=new nm(d,r.dtype);x.values.fill(this.readSync(c.dataId)[0]);for(var y=0;y<s;y++){for(var b=[],C=0,E=0;E<u;E++){var S=p[y*u+E];b.push(S),C+=S*l[E]}if(C<0||C>=a/i)throw new Error("Invalid indices: "+b+" does not index into "+o);for(var k=0;k<i;k++)h?x.values[C*i+k]+=g[y*i+k]:x.values[C*i+k]=r.rank===0?g[0]:g[y*i+k]}return x.toTensor().reshape(o)},t}(aP);function iB(n,t){return{kernelName:n,backendName:"cpu",kernelFunc:function(e){var r=e.inputs,o=e.backend,a=r,i=a.a,s=a.b,u=o;Mt([i,s],n);var l=u.data.get(i.dataId).values,c=u.data.get(s.dataId).values,h=t(i.shape,s.shape,l,c,i.dtype),d=h[0],p=h[1];return{dataId:u.write(d,p,i.dtype),shape:p,dtype:i.dtype}}}}function sB(n){return function(t,e,r,o,a){var i=Pe(t,e),s=i.length,u=ya(i),l=Lf(a,Yt(i)),c=t.length,h=e.length,d=ya(t),p=ya(e),g=Hu(t,i),x=Hu(e,i);if(g.length+x.length===0)for(var y=0;y<l.length;++y)l[y]=n(r[y%r.length],o[y%o.length]);else{var b=function(C){var E=_L(C,s,u),S=E.slice(-c);g.forEach(function(N){return S[N]=0});var k=eE(S,c,d),R=E.slice(-h);x.forEach(function(N){return R[N]=0});var A=eE(R,h,p);l[C]=n(r[k],o[A])};for(y=0;y<l.length;++y)b(y)}return[l,i]}}st.registerBackend("cpu",function(){return new sht},1);var uht=sB(function(n,t){return n/t}),lht=iB(t1,uht),cht={kernelName:"MaxPoolWithArgmax",backendName:"cpu",kernelFunc:function(n){var t=n.inputs,e=n.attrs,r=n.backend,o=t.x,a=e,i=a.filterSize,s=a.strides,u=a.pad,l=a.includeBatchInIndex,c=r;Mt(o,"MaxPoolWithArgmax");var h=c.data.get(o.dataId).values,d=Ec(o.shape,i,s,[1,1],u),p=function(C,E,S,k,R){var A=cE(C,0,S,ya(E),R,"max"),N=aB(C,E,S,R,!0,k);return[A.values,N.values]}(h,o.shape,o.dtype,l,d),g=p[0],x=p[1],y=c.write(g,d.outShape,o.dtype),b=c.write(x,d.outShape,o.dtype);return[{dataId:y,shape:d.outShape,dtype:o.dtype},{dataId:b,shape:d.outShape,dtype:"int32"}]}},hht={kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(n){var t=n.inputs,e=n.backend,r=n.attrs,o=t,a=o.boxes,i=o.scores,s=r,u=s.maxOutputSize,l=s.iouThreshold,c=s.scoreThreshold,h=s.softNmsSigma,d=e;Mt(a,"NonMaxSuppressionWithScore");var p=Bk(d.data.get(a.dataId).values,d.data.get(i.dataId).values,u,l,c,h);return[p.selectedIndices,p.selectedScores]}},fht={kernelName:"Square",backendName:"cpu",kernelFunc:function(n){var t=n.inputs,e=n.backend,r=t.x,o=e;Mt(r,"square");for(var a=o.data.get(r.dataId).values,i=new Float32Array(a.length),s=0;s<a.length;++s){var u=a[s];i[s]=u*u}return{dataId:o.write(i,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},dht=sB(function(n,t){var e=n-t;return e*e});function uB(n,t,e,r,o){for(var a=Yt(t),i=t.length,s=ya(t),u=ya(o),l=Lf(e,Yt(o)),c=0;c<a;++c){for(var h=_L(c,i,s),d=new Array(h.length),p=0;p<d.length;p++)d[p]=h[r[p]];l[eE(d,i,u)]=n[c]}return l}for(var XC=0,WO=[hht,fht,iB(e1,dht),lht,{kernelName:"Transpose",backendName:"cpu",kernelFunc:function(n){var t=n.inputs,e=n.attrs,r=n.backend,o=t.x,a=e.perm,i=r;Mt(o,"transpose");for(var s=o.shape.length,u=new Array(s),l=0;l<u.length;l++)u[l]=o.shape[a[l]];var c=uB(i.data.get(o.dataId).values,o.shape,o.dtype,a,u);return{dataId:i.write(c,u,o.dtype),shape:u,dtype:o.dtype}}},cht];XC<WO.length;XC++)EL(WO[XC]);var Yh,pht=function(n){this.variableNames=["A"];var t=go(),e=n[0],r=n[1];this.outputShape=n,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+r+".0, "+e+`.0);

        vec4 values = `+t.texture2D+`(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `},mht=function(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var t=go(),e=n[0],r=n[1];this.outputShape=n,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(`+r+".0, "+e+`.0);
            vec4 values = `+t.texture2D+`(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        `+t.output+` = result;
      }
    `},ght=function(n,t){this.variableNames=["A"];for(var e=new Array(n.length),r=0;r<e.length;r++)e[r]=n[t[r]];this.outputShape=e,this.rank=e.length;var o=_n(this.rank),a=function(i){var s=i.length;if(s>6)throw Error("Transpose for rank "+s+" is not yet supported");for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],l=new Array(s),c=0;c<i.length;c++)l[i[c]]=u[c];return l.join()}(t);this.userCode=`
    void main() {
      `+o+` resRC = getOutputCoords();
      setOutput(getA(`+a+`));
    }
    `},vht=function(n,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var e=new Array(n.length),r=0;r<e.length;r++)e[r]=n[t[r]];if(this.outputShape=e,this.rank=e.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var o=_n(this.rank),a=dP("rc",this.rank),i=new Array(this.rank);for(r=0;r<t.length;r++)i[t[r]]=a[r];var s="vec2("+i.slice(-2).join()+")",u="++"+a[this.rank-1]+" < "+e[this.rank-1],l="getChannel(getA("+i.join()+"), "+s+")";this.userCode=`
    void main() {
      `+o+` rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = `+l+`;
      if(`+u+`) {
        result[1] = `+l+`;
      }
      --`+a[this.rank-1]+`;
      if(++`+a[this.rank-2]+" < "+e[this.rank-2]+`) {
        result[2] = `+l+`;
        if(`+u+`) {
          result[3] = `+l+`;
        }
      }
      setOutput(result);
    }
    `};for(var KC=0,VO=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(n){var t=n.inputs,e=n.backend,r=n.attrs,o=t.pixels,a=r.numChannels,i=typeof HTMLVideoElement<"u"&&o instanceof HTMLVideoElement,s=typeof HTMLImageElement<"u"&&o instanceof HTMLImageElement,u=i?[o.videoWidth,o.videoHeight]:[o.width,o.height],l=u[0],c=u[1],h=[c,l],d=[c,l,a];(s||i)&&(Yh==null&&(Yh=document.createElement("canvas").getContext("2d")),Yh.canvas.width=l,Yh.canvas.height=c,Yh.drawImage(o,0,0,l,c),o=Yh.canvas);var p=e.makeTensorInfo(h,"int32");e.texData.get(p.dataId).usage=ma.PIXELS,e.gpgpu.uploadPixelDataToTexture(e.getTexture(p.dataId),o);var g=Nt().getBool("WEBGL_PACK")?new mht(d):new pht(d),x=e.runWebGLProgram(g,[p],"int32");return e.disposeData(p.dataId),x}},{kernelName:t1,backendName:"webgl",kernelFunc:function(n){var t=n.inputs,e=n.backend,r=t;return function(o,a,i){var s=new Xn(Rst,o.shape,a.shape);return Nt().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&(s=new $i(Tst,o.shape,a.shape,!0)),i.runWebGLProgram(s,[o,a],"float32")}(r.a,r.b,e)}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(n){var t=n.inputs,e=n.backend,r=n.attrs;J0("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var o=t,a=o.boxes,i=o.scores,s=r,u=s.maxOutputSize,l=s.iouThreshold,c=s.scoreThreshold,h=s.softNmsSigma,d=e,p=Bk(d.readSync(a.dataId),d.readSync(i.dataId),u,l,c,h);return[p.selectedIndices,p.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(n){var t=n.inputs,e=n.backend,r=t.x,o=e,a=new Te(r.shape,"return x * x;");return o.runWebGLProgram(a,[r],r.dtype)}},{kernelName:e1,backendName:"webgl",kernelFunc:function(n){var t=n.inputs,e=n.backend,r=t,o=r.a,a=r.b,i=e,s=Nt().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new $i("return (a - b) * (a - b);",o.shape,a.shape):new Xn("return (a - b) * (a - b);",o.shape,a.shape);return i.compileAndRun(s,[o,a])}},{kernelName:"Transpose",backendName:"webgl",kernelFunc:function(n){for(var t,e=n.inputs,r=n.attrs,o=n.backend,a=e.x,i=r.perm,s=o,u=a.shape.length,l=new Array(u),c=0;c<l.length;c++)l[c]=a.shape[i[c]];if(s.shouldExecuteOnCPU([a])){var h=uB(s.texData.get(a.dataId).values,a.shape,a.dtype,i,l);t=s.makeTensorInfo(l,a.dtype),s.texData.get(t.dataId).values=h}else t=function(d,p,g){var x=Nt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new vht(d.shape,p):new ght(d.shape,p);return g.runWebGLProgram(x,[d],d.dtype)}(a,i,s);return t}},{kernelName:"MaxPoolWithArgmax",backendName:"webgl",kernelFunc:function(n){var t=n.inputs,e=n.attrs,r=n.backend,o=t.x,a=e,i=a.filterSize,s=a.strides,u=a.pad,l=a.includeBatchInIndex,c=r;X(o.shape.length===4,function(){return"Error in maxPool: input must be rank 4 but got rank "+o.shape.length+"."});var h=[1,1];X(_o(s,h),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+s+" and dilations '"+h+"'"});var d=Ec(o.shape,i,s,h,u),p=function(g,x,y,b){var C=new Yp(y,"max",!1),E=b.runWebGLProgram(C,[g],"float32");return C=new Yp(y,"max",!0,!0,x),[E,b.runWebGLProgram(C,[g],"float32")]}(o,l,d,c);return[p[0],p[1]]}}];KC<VO.length;KC++)EL(VO[KC]);for(var YC=0,GO=[{kernelName:HL,inputsToSave:["a","b"],gradFunc:function(n,t){var e=t[0],r=t[1],o=Pe(e.shape,r.shape);return{a:function(){var a=n,i=Ir(e.shape,o);return i.length>0&&(a=a.sum(i)),a.reshape(e.shape)},b:function(){var a=n,i=Ir(r.shape,o);return i.length>0&&(a=a.sum(i)),a.reshape(r.shape)}}}},{kernelName:"AddN",saveAllInputs:!0,gradFunc:function(n,t){var e={};return t.forEach(function(r,o){e[o]=function(){return n.clone()}}),e}},{kernelName:qL,gradFunc:function(n,t,e){for(var r=e,o=r.inputShape,a=r.shape,i=Array.from(a),s=o.length-1;s>=0;s--)if(o[s]===a[s])i[s]=1;else if(o[s]!==1)throw new Error("broadcastTo(): ["+o+"] cannot be broadcast to ["+a+"].");var u=[];for(s=0;s<i.length;s++)i[s]>1&&u.push(s);return{x:function(){return n.sum(u,!0)}}}},{kernelName:t1,inputsToSave:["a","b"],gradFunc:function(n,t){var e=t[0],r=t[1],o=Pe(e.shape,r.shape);return{a:function(){var a=al(n,r.toFloat()),i=Ir(e.shape,o);return i.length>0?Uu(a,i).reshape(e.shape):a},b:function(){var a=n.mul(e.toFloat()),i=Ir(r.shape,o);i.length>0&&(a=Uu(a,i).reshape(r.shape));var s=FP(r);return Ok(al(a,s.toFloat()))}}}},{kernelName:"FusedBatchNorm",inputsToSave:["x","mean","variance","scale"],gradFunc:function(n,t,e){var r=e.varianceEpsilon,o=t[0],a=t[1],i=t[2],s=t[3],u=EP(o),l=s??ae(1),c=Ir(a.shape,u.shape),h=[];if(a.rank===1){for(var d=0;d<u.shape.length-1;++d)h.push(u.shape[d]);h.push(1)}var p=fi(o,a),g=Kn(n,l),x=QL(qa(i,ae(r))),y=Kn(Kn(Kn(x,x),x),ae(-.5));return{x:function(){return a.rank===1?Ls(Kn(Kn(n,yf(x.as4D(1,1,1,a.shape[0]),h)),l),o.shape):Ls(Kn(Kn(n,x),l),o.shape)},mean:function(){var b=Kn(Kn(x,ae(-1)),g);return a.rank===1&&(b=Uu(b,c)),Ls(b,a.shape)},variance:function(){var b=Kn(Kn(y,p),g);return a.rank===1&&(b=Uu(b,c)),Ls(b,a.shape)},scale:function(){var b=Kn(p,x),C=Kn(n,b);return a.rank===1&&(C=Uu(C,c)),Ls(C,a.shape)},offset:function(){var b=n;return a.rank===1&&(b=Uu(b,c)),Ls(b,a.shape)}}}},{kernelName:XL,gradFunc:function(n){return{x:function(){return n.toFloat()}}}},{kernelName:jL,inputsToSave:["indices"],gradFunc:function(n,t){var e=t[0];return{indices:function(){return Yn(e.shape,"float32")}}}},{kernelName:YL,inputsToSave:["x"],gradFunc:function(n,t,e){var r=t[0],o=e.paddings.map(function(a){return a[0]});return{x:function(){return n.slice(o,r.shape)}}}},{kernelName:"Square",inputsToSave:["x"],gradFunc:function(n,t){var e=t[0];return{x:function(){return n.mul(e.toFloat().mul(2))}}}},{kernelName:e1,inputsToSave:["a","b"],gradFunc:function(n,t){var e=t[0],r=t[1],o=ae(2);return{a:function(){return Kn(n,Kn(o,fi(e,r)))},b:function(){return Kn(n,Kn(o,fi(r,e)))}}}},{kernelName:KL,inputsToSave:["x"],gradFunc:function(n,t,e){var r=t[0],o=e.reps;return{x:function(){var a=je(r);if(r.rank===1)for(var i=0;i<o[0];++i)a=a.add(n.slice([i*r.shape[0]],[r.shape[0]]));else if(r.rank===2)for(i=0;i<o[0];++i)for(var s=0;s<o[1];++s)a=a.add(n.slice([i*r.shape[0],s*r.shape[1]],[r.shape[0],r.shape[1]]));else if(r.rank===3)for(i=0;i<o[0];++i)for(s=0;s<o[1];++s)for(var u=0;u<o[2];++u)a=a.add(n.slice([i*r.shape[0],s*r.shape[1],u*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(r.rank!==4)throw new Error("Gradient for tile operation is not implemented for rank-"+r.rank+" tensors yet.");for(i=0;i<o[0];++i)for(s=0;s<o[1];++s)for(u=0;u<o[2];++u)for(var l=0;l<o[3];++l)a=a.add(n.slice([i*r.shape[0],s*r.shape[1],u*r.shape[2],l*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return a}}}},{kernelName:"Transpose",gradFunc:function(n,t,e){var r=Dk(e.perm);return{x:function(){return ai(n,r)}}}}];YC<GO.length;YC++)rat(GO[YC]);var xht=function(){function n(){}return n.prototype.fetch=function(t,e){return fetch(t,e)},n.prototype.now=function(){return performance.now()},n.prototype.encode=function(t,e){if(e!=="utf-8"&&e!=="utf8")throw new Error("Browser's encoder only supports utf-8, but got "+e);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(t)},n.prototype.decode=function(t,e){return new TextDecoder(e).decode(t)},n}();Nt().get("IS_BROWSER")&&Nt().setPlatform("browser",new xht);var QC,yht=function(){return require("node-fetch")},bht=function(){function n(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}return n.prototype.fetch=function(t,e){return Nt().global.fetch!=null?Nt().global.fetch(t,e):(QC==null&&(QC=yht()),QC(t,e))},n.prototype.now=function(){var t=process.hrtime();return 1e3*t[0]+t[1]/1e6},n.prototype.encode=function(t,e){if(e!=="utf-8"&&e!=="utf8")throw new Error("Node built-in encoder only supports utf-8, but got "+e);return this.textEncoder.encode(t)},n.prototype.decode=function(t,e){return t.length===0?"":new this.util.TextDecoder(e).decode(t)},n}();Nt().get("IS_NODE")&&Nt().setPlatform("node",new bht);var hE={float32:4,int32:4,uint16:2,uint8:1,bool:1},fy=4;function lB(n,t){for(var e={},r=0,o=function(s){var u=s.name,l=s.dtype,c=s.shape,h=Yt(c),d=void 0;if("quantization"in s){var p=s.quantization;if(p.dtype!=="uint8"&&p.dtype!=="uint16")throw new Error("Weight "+s.name+" has unknown quantization dtype "+p.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var g=hE[p.dtype],x=n.slice(r,r+h*g),y=p.dtype==="uint8"?new Uint8Array(x):new Uint16Array(x);if(l==="float32")d=Float32Array.from(y,function(R){return R*p.scale+p.min});else{if(l!=="int32")throw new Error("Unsupported dtype in weight '"+u+"': "+l);d=Int32Array.from(y,function(R){return Math.round(R*p.scale+p.min)})}r+=h*g}else if(l==="string"){var b=Yt(s.shape);d=[];for(var C=0;C<b;C++){var E=new Uint32Array(n.slice(r,r+fy))[0];r+=fy;var S=new Uint8Array(n.slice(r,r+E));d.push(S),r+=E}}else{var k=hE[l];if(x=n.slice(r,r+h*k),l==="float32")d=new Float32Array(x);else if(l==="int32")d=new Int32Array(x);else{if(l!=="bool")throw new Error("Unsupported dtype in weight '"+u+"': "+l);d=new Uint8Array(x)}r+=h*k}e[u]=Qr(d,c,l)},a=0,i=t;a<i.length;a++)o(i[a]);return e}function wht(n){if(n===null)throw new Error("Invalid input value: "+JSON.stringify(n));var t=0,e=[];n.forEach(function(a){if(t+=a.byteLength,e.push(a.byteLength===a.buffer.byteLength?a:new a.constructor(a)),!(a instanceof Float32Array||a instanceof Int32Array||a instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+a.constructor.name)});var r=new Uint8Array(t),o=0;return e.forEach(function(a){r.set(new Uint8Array(a.buffer),o),o+=a.byteLength}),r.buffer}var fE=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function HO(n){return fE?Buffer.byteLength(n):new Blob([n]).size}function nI(n){var t=0;n.forEach(function(o){t+=o.byteLength});var e=new Uint8Array(t),r=0;return n.forEach(function(o){e.set(new Uint8Array(o),r),r+=o.byteLength}),e.buffer}function qO(n){for(n=n.trim();n.endsWith("/");)n=n.slice(0,n.length-1);var t=n.split("/");return t[t.length-1]}function Vm(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:n.modelTopology==null?0:HO(JSON.stringify(n.modelTopology)),weightSpecsBytes:n.weightSpecs==null?0:HO(JSON.stringify(n.weightSpecs)),weightDataBytes:n.weightData==null?0:n.weightData.byteLength}}var ga=function(){function n(){this.saveRouters=[],this.loadRouters=[]}return n.getInstance=function(){return n.instance==null&&(n.instance=new n),n.instance},n.registerSaveRouter=function(t){n.getInstance().saveRouters.push(t)},n.registerLoadRouter=function(t){n.getInstance().loadRouters.push(t)},n.getSaveHandlers=function(t){return n.getHandlers(t,"save")},n.getLoadHandlers=function(t,e){return n.getHandlers(t,"load",e)},n.getHandlers=function(t,e,r){var o=[];return(e==="load"?n.getInstance().loadRouters:n.getInstance().saveRouters).forEach(function(a){var i=a(t,r);i!==null&&o.push(i)}),o},n}(),bf="://",Yu=function(){function n(){this.managers={}}return n.getInstance=function(){return n.instance==null&&(n.instance=new n),n.instance},n.registerManager=function(t,e){X(t!=null,function(){return"scheme must not be undefined or null."}),t.endsWith(bf)&&(t=t.slice(0,t.indexOf(bf))),X(t.length>0,function(){return"scheme must not be an empty string."});var r=n.getInstance();X(r.managers[t]==null,function(){return"A model store manager is already registered for scheme '"+t+"'."}),r.managers[t]=e},n.getManager=function(t){var e=this.getInstance().managers[t];if(e==null)throw new Error("Cannot find model manager for scheme '"+t+"'");return e},n.getSchemes=function(){return Object.keys(this.getInstance().managers)},n}();function l0(n){if(n.indexOf(bf)===-1)throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+Yu.getSchemes().join(","));return{scheme:n.split(bf)[0],path:n.split(bf)[1]}}function jO(n,t,e){return e===void 0&&(e=!1),Qt(this,void 0,void 0,function(){var r,o,a,i,s,u,l,c,h;return Zt(this,function(d){switch(d.label){case 0:return X(n!==t,function(){return"Old path and new path are the same: '"+n+"'"}),X((r=ga.getLoadHandlers(n)).length>0,function(){return"Copying failed because no load handler is found for source URL "+n+"."}),X(r.length<2,function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+n+"."}),o=r[0],X((a=ga.getSaveHandlers(t)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+t+"."}),X(a.length<2,function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+t+"."}),i=a[0],s=l0(n).scheme,u=l0(n).path,l=s===l0(n).scheme,[4,o.load()];case 1:return c=d.sent(),e&&l?[4,Yu.getManager(s).removeModel(u)]:[3,3];case 2:d.sent(),d.label=3;case 3:return[4,i.save(c)];case 4:return h=d.sent(),!e||l?[3,6]:[4,Yu.getManager(s).removeModel(u)];case 5:d.sent(),d.label=6;case 6:return[2,h.modelArtifactsInfo]}})})}var cc="models_store",qu="model_info_store";function cB(){if(!Nt().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var n=window||self,t=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(t==null)throw new Error("The current browser does not appear to support IndexedDB.");return t}function dE(n){var t=n.result;t.createObjectStore(cc,{keyPath:"modelPath"}),t.createObjectStore(qu,{keyPath:"modelPath"})}var wf=function(){function n(t){if(this.indexedDB=cB(),t==null||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}return n.prototype.save=function(t){return Qt(this,void 0,void 0,function(){return Zt(this,function(e){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,t)]})})},n.prototype.load=function(){return Qt(this,void 0,void 0,function(){return Zt(this,function(t){return[2,this.databaseAction(this.modelPath)]})})},n.prototype.databaseAction=function(t,e){var r=this;return new Promise(function(o,a){var i=r.indexedDB.open("tensorflowjs",1);i.onupgradeneeded=function(){return dE(i)},i.onsuccess=function(){var s=i.result;if(e==null){var u=s.transaction(cc,"readonly"),l=u.objectStore(cc).get(r.modelPath);l.onsuccess=function(){if(l.result==null)return s.close(),a(new Error("Cannot find model with path '"+r.modelPath+"' in IndexedDB."));o(l.result.modelArtifacts)},l.onerror=function(x){return s.close(),a(l.error)},u.oncomplete=function(){return s.close()}}else{var c,h=Vm(e),d=s.transaction(qu,"readwrite"),p=d.objectStore(qu),g=p.put({modelPath:r.modelPath,modelArtifactsInfo:h});g.onsuccess=function(){var x=(c=s.transaction(cc,"readwrite")).objectStore(cc).put({modelPath:r.modelPath,modelArtifacts:e,modelArtifactsInfo:h});x.onsuccess=function(){return o({modelArtifactsInfo:h})},x.onerror=function(y){var b=(p=d.objectStore(qu)).delete(r.modelPath);b.onsuccess=function(){return s.close(),a(x.error)},b.onerror=function(C){return s.close(),a(x.error)}}},g.onerror=function(x){return s.close(),a(g.error)},d.oncomplete=function(){c==null?s.close():c.oncomplete=function(){return s.close()}}}},i.onerror=function(s){return a(i.error)}})},n.URL_SCHEME="indexeddb://",n}(),XO=function(n){return Nt().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(wf.URL_SCHEME)?(t=n.slice(wf.URL_SCHEME.length),new wf(t)):null;var t};ga.registerSaveRouter(XO),ga.registerLoadRouter(XO);var Cht=function(){function n(){this.indexedDB=cB()}return n.prototype.listModels=function(){return Qt(this,void 0,void 0,function(){var t=this;return Zt(this,function(e){return[2,new Promise(function(r,o){var a=t.indexedDB.open("tensorflowjs",1);a.onupgradeneeded=function(){return dE(a)},a.onsuccess=function(){var i=a.result,s=i.transaction(qu,"readonly"),u=s.objectStore(qu).getAll();u.onsuccess=function(){for(var l={},c=0,h=u.result;c<h.length;c++){var d=h[c];l[d.modelPath]=d.modelArtifactsInfo}r(l)},u.onerror=function(l){return i.close(),o(u.error)},s.oncomplete=function(){return i.close()}},a.onerror=function(i){return o(a.error)}})]})})},n.prototype.removeModel=function(t){return Qt(this,void 0,void 0,function(){var e=this;return Zt(this,function(r){var o;return t=(o=t).startsWith(wf.URL_SCHEME)?o.slice(wf.URL_SCHEME.length):o,[2,new Promise(function(a,i){var s=e.indexedDB.open("tensorflowjs",1);s.onupgradeneeded=function(){return dE(s)},s.onsuccess=function(){var u,l=s.result,c=l.transaction(qu,"readwrite"),h=c.objectStore(qu),d=h.get(t);d.onsuccess=function(){if(d.result==null)return l.close(),i(new Error("Cannot find model with path '"+t+"' in IndexedDB."));var p=h.delete(t),g=function(){var x=(u=l.transaction(cc,"readwrite")).objectStore(cc).delete(t);x.onsuccess=function(){return a(d.result.modelArtifactsInfo)},x.onerror=function(y){return i(d.error)}};p.onsuccess=g,p.onerror=function(x){return g(),l.close(),i(d.error)}},d.onerror=function(p){return l.close(),i(d.error)},c.oncomplete=function(){u==null?l.close():u.oncomplete=function(){return l.close()}}},s.onerror=function(u){return i(s.error)}})]})})},n}();if(Nt().getBool("IS_BROWSER"))try{Yu.registerManager(wf.URL_SCHEME,new Cht)}catch{}var zs="/",lf="tensorflowjs_models",hB="info",Sht="model_topology",Eht="weight_specs",kht="weight_data",Iht="model_metadata";function fB(n){return{info:[lf,n,hB].join(zs),topology:[lf,n,Sht].join(zs),weightSpecs:[lf,n,Eht].join(zs),weightData:[lf,n,kht].join(zs),modelMetadata:[lf,n,Iht].join(zs)}}function Rht(n){var t=n.split(zs);if(t.length<3)throw new Error("Invalid key format: "+n);return t.slice(1,t.length-1).join(zs)}var Cf=function(){function n(t){if(!Nt().getBool("IS_BROWSER")||typeof window>"u"||window.localStorage===void 0)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,t==null||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=fB(this.modelPath)}return n.prototype.save=function(t){return Qt(this,void 0,void 0,function(){var e,r,o;return Zt(this,function(a){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");e=JSON.stringify(t.modelTopology),r=JSON.stringify(t.weightSpecs),o=Vm(t);try{return this.LS.setItem(this.keys.info,JSON.stringify(o)),this.LS.setItem(this.keys.topology,e),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,function(i){if(fE)return Buffer.from(i).toString("base64");for(var s=new Uint8Array(i),u="",l=0,c=s.length;l<c;l++)u+=String.fromCharCode(s[l]);return btoa(u)}(t.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,userDefinedMetadata:t.userDefinedMetadata})),[2,{modelArtifactsInfo:o}]}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+o.modelTopologyBytes+", weightSpecsBytes="+o.weightSpecsBytes+", weightDataBytes="+o.weightDataBytes+".")}return[2]})})},n.prototype.load=function(){return Qt(this,void 0,void 0,function(){var t,e,r,o,a,i,s;return Zt(this,function(u){if((t=JSON.parse(this.LS.getItem(this.keys.info)))==null)throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if(t.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(e={},(r=JSON.parse(this.LS.getItem(this.keys.topology)))==null)throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(e.modelTopology=r,(o=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))==null)throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(e.weightSpecs=o,(a=this.LS.getItem(this.keys.modelMetadata))!=null&&(i=JSON.parse(a),e.format=i.format,e.generatedBy=i.generatedBy,e.convertedBy=i.convertedBy,e.userDefinedMetadata=i.userDefinedMetadata),(s=this.LS.getItem(this.keys.weightData))==null)throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return e.weightData=function(l){if(fE){var c=Buffer.from(l,"base64");return c.buffer.slice(c.byteOffset,c.byteOffset+c.byteLength)}for(var h=atob(l),d=new Uint8Array(h.length),p=0;p<h.length;++p)d.set([h.charCodeAt(p)],p);return d.buffer}(s),[2,e]})})},n.URL_SCHEME="localstorage://",n}(),KO=function(n){return Nt().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Cf.URL_SCHEME)?(t=n.slice(Cf.URL_SCHEME.length),new Cf(t)):null;var t};ga.registerSaveRouter(KO),ga.registerLoadRouter(KO);var Tht=function(){function n(){X(Nt().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),X(typeof window>"u"||window.localStorage!==void 0,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return n.prototype.listModels=function(){return Qt(this,void 0,void 0,function(){var t,e,r,o,a,i;return Zt(this,function(s){for(t={},e=lf+zs,r=zs+hB,o=0;o<this.LS.length;++o)(a=this.LS.key(o)).startsWith(e)&&a.endsWith(r)&&(i=Rht(a),t[i]=JSON.parse(this.LS.getItem(a)));return[2,t]})})},n.prototype.removeModel=function(t){return Qt(this,void 0,void 0,function(){var e,r;return Zt(this,function(o){var a;if(t=(a=t).startsWith(Cf.URL_SCHEME)?a.slice(Cf.URL_SCHEME.length):a,e=fB(t),this.LS.getItem(e.info)==null)throw new Error("Cannot find model at path '"+t+"'");return r=JSON.parse(this.LS.getItem(e.info)),this.LS.removeItem(e.info),this.LS.removeItem(e.topology),this.LS.removeItem(e.weightSpecs),this.LS.removeItem(e.weightData),[2,r]})})},n}();if(Nt().getBool("IS_BROWSER"))try{Yu.registerManager(Cf.URL_SCHEME,new Tht)}catch{}var Nht="model",Aht=".json",_ht=".weights.bin";function YO(n){return new Promise(function(t){return setTimeout(t)}).then(n)}var ZC=function(){function n(t){if(!Nt().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(n.URL_SCHEME)&&(t=t.slice(n.URL_SCHEME.length)),t!=null&&t.length!==0||(t=Nht),this.modelTopologyFileName=t+Aht,this.weightDataFileName=t+_ht}return n.prototype.save=function(t){return Qt(this,void 0,void 0,function(){var e,r,o,a,i,s;return Zt(this,function(u){switch(u.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(e=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"})),!(t.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return r=[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}],o={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:r},a=window.URL.createObjectURL(new Blob([JSON.stringify(o)],{type:"application/json"})),(i=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,i.href=a,[4,YO(function(){return i.dispatchEvent(new MouseEvent("click"))})];case 2:return u.sent(),t.weightData==null?[3,4]:((s=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,s.href=e,[4,YO(function(){return s.dispatchEvent(new MouseEvent("click"))})]);case 3:u.sent(),u.label=4;case 4:return[2,{modelArtifactsInfo:Vm(t)}]}})})},n.URL_SCHEME="downloads://",n}(),Dht=function(){function n(t){if(t==null||t.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+t);this.files=t}return n.prototype.load=function(){return Qt(this,void 0,void 0,function(){var t,e,r=this;return Zt(this,function(o){return t=this.files[0],e=this.files.slice(1),[2,new Promise(function(a,i){var s=new FileReader;s.onload=function(u){var l=JSON.parse(u.target.result),c=l.modelTopology;if(c!=null){e.length===0&&a({modelTopology:c});var h=l.weightsManifest;if(h!=null){var d;try{d=r.checkManifestAndWeightFiles(h,e)}catch(y){return void i(y)}var p=[],g=[],x=[];h.forEach(function(y){y.paths.forEach(function(b){g.push(b),x.push(null)}),p.push.apply(p,y.weights)}),h.forEach(function(y){y.paths.forEach(function(b){var C=new FileReader;C.onload=function(E){var S=E.target.result,k=g.indexOf(b);x[k]=S,x.indexOf(null)===-1&&a({modelTopology:c,weightSpecs:p,weightData:nI(x),format:l.format,generatedBy:l.generatedBy,convertedBy:l.convertedBy,userDefinedMetadata:l.userDefinedMetadata})},C.onerror=function(E){return i("Failed to weights data from file of path '"+b+"'.")},C.readAsArrayBuffer(d[b])})})}else i(new Error("weightManifest field is missing from file "+t.name))}else i(new Error("modelTopology field is missing from file "+t.name))},s.onerror=function(u){return i("Failed to read model topology and weights manifest JSON from file '"+t.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},s.readAsText(t)})]})})},n.prototype.checkManifestAndWeightFiles=function(t,e){for(var r=[],o=e.map(function(u){return qO(u.name)}),a={},i=0,s=t;i<s.length;i++)s[i].paths.forEach(function(u){var l=qO(u);if(r.indexOf(l)!==-1)throw new Error("Duplicate file basename found in weights manifest: '"+l+"'");if(r.push(l),o.indexOf(l)===-1)throw new Error("Weight file with basename '"+l+"' is not provided.");a[u]=e[o.indexOf(l)]});if(r.length!==e.length)throw new Error("Mismatch in the number of files in weights manifest ("+r.length+") and the number of weight files provided ("+e.length+").");return a},n}();function QO(n,t,e,r){(function(a){X(a!=null&&Array.isArray(a)&&a.length>0,function(){return"promises must be a none empty array"})})(n),function(a,i){X(a>=0&&a<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+a}),X(i>=0&&i<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+i}),X(i>=a,function(){return"startFraction must be no more than endFraction, but got startFraction "+a+" and endFraction "+i})}(e=e??0,r=r??1);var o=0;return Promise.all(n.map(function(a){return a.then(function(i){var s=e+ ++o/n.length*(r-e);return t(s),i}),a}))}function dB(n,t){return Qt(this,void 0,void 0,function(){var e,r,o,a,i,s,u,l,c;return Zt(this,function(h){switch(h.label){case 0:return t==null&&(t={}),e=t.fetchFunc==null?Nt().platform.fetch:t.fetchFunc,r=n.map(function(d){return e(d,t.requestInit,{isBinary:!0})}),o=0,a=.5,t.onProgress!=null?[3,2]:[4,Promise.all(r)];case 1:return i=h.sent(),[3,4];case 2:return[4,QO(r,t.onProgress,o,a)];case 3:i=h.sent(),h.label=4;case 4:return s=i.map(function(d){return d.arrayBuffer()}),u=.5,l=1,t.onProgress!=null?[3,6]:[4,Promise.all(s)];case 5:return c=h.sent(),[3,8];case 6:return[4,QO(s,t.onProgress,u,l)];case 7:c=h.sent(),h.label=8;case 8:return[2,c]}})})}function ZO(n){var t=this;return function(e,r,o){return r===void 0&&(r=""),Qt(t,void 0,void 0,function(){var a,i,s,u,l,c,h,d,p,g;return Zt(this,function(x){switch(x.label){case 0:if(a=e.map(function(){return!1}),i={},s=o!=null?o.map(function(){return!1}):[],u=[],e.forEach(function(y,b){var C=0;y.weights.forEach(function(E){var S="quantization"in E?E.quantization.dtype:E.dtype,k=hE[S]*Yt(E.shape),R=function(){a[b]=!0,i[b]==null&&(i[b]=[]),i[b].push({manifestEntry:E,groupOffset:C,sizeBytes:k})};o!=null?o.forEach(function(A,N){A===E.name&&(R(),s[N]=!0)}):R(),u.push(E.name),C+=k})}),!s.every(function(y){return y}))throw l=o.filter(function(y,b){return!s[b]}),new Error("Could not find weights in manifest with names: "+l.join(", ")+`. 
Manifest JSON has weights with names: `+u.join(", ")+".");return c=a.reduce(function(y,b,C){return b&&y.push(C),y},[]),h=[],c.forEach(function(y){e[y].paths.forEach(function(b){var C=r+(r.endsWith("/")?"":"/")+b;h.push(C)})}),[4,n(h)];case 1:return d=x.sent(),p={},g=0,c.forEach(function(y){for(var b=e[y].paths.length,C=0,E=0;E<b;E++)C+=d[g+E].byteLength;for(var S=new ArrayBuffer(C),k=new Uint8Array(S),R=0,A=0;A<b;A++){var N=new Uint8Array(d[g+A]);k.set(N,R),R+=N.byteLength}i[y].forEach(function(_){var $=lB(S.slice(_.groupOffset,_.groupOffset+_.sizeBytes),[_.manifestEntry]);for(var D in $)p[D]=$[D]}),g+=b}),[2,p]}})})}}ga.registerSaveRouter(function(n){return Nt().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(ZC.URL_SCHEME)?function(t){return t===void 0&&(t="model"),new ZC(t)}(n.slice(ZC.URL_SCHEME.length)):null});var pB=function(){function n(t,e){if(this.DEFAULT_METHOD="POST",e==null&&(e={}),this.weightPathPrefix=e.weightPathPrefix,this.onProgress=e.onProgress,e.fetchFunc!=null?(X(typeof e.fetchFunc=="function",function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=e.fetchFunc):this.fetch=Nt().platform.fetch,X(t!=null&&t.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(t)&&X(t.length===2,function(){return"URL paths for http must have a length of 2, (actual length is "+t.length+")."}),this.path=t,e.requestInit!=null&&e.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=e.requestInit||{}}return n.prototype.save=function(t){return Qt(this,void 0,void 0,function(){var e,r,o,a;return Zt(this,function(i){switch(i.label){case 0:if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(e=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,r=[{paths:["./model.weights.bin"],weights:t.weightSpecs}],o={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,userDefinedMetadata:t.userDefinedMetadata,weightsManifest:r},e.body.append("model.json",new Blob([JSON.stringify(o)],{type:"application/json"}),"model.json"),t.weightData!=null&&e.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,e)];case 1:if((a=i.sent()).ok)return[2,{modelArtifactsInfo:Vm(t),responses:[a]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+a.status+".")}})})},n.prototype.load=function(){return Qt(this,void 0,void 0,function(){var t,e,r,o,a,i,s,u,l,c,h,d;return Zt(this,function(p){switch(p.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(t=p.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+t.status+". Please verify this URL points to the model JSON of the model to load.");p.label=2;case 2:return p.trys.push([2,4,,5]),[4,t.json()];case 3:return e=p.sent(),[3,5];case 4:throw p.sent(),r="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 5:if(o=e.modelTopology,a=e.weightsManifest,i=e.generatedBy,s=e.convertedBy,u=e.format,l=e.userDefinedMetadata,o==null&&a==null)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return a==null?[3,7]:[4,this.loadWeights(a)];case 6:d=p.sent(),c=d[0],h=d[1],p.label=7;case 7:return[2,{modelTopology:o,weightSpecs:c,weightData:h,userDefinedMetadata:l,generatedBy:i,convertedBy:s,format:u}]}})})},n.prototype.loadWeights=function(t){return Qt(this,void 0,void 0,function(){var e,r,o,a,i,s,u,l,c,h,d;return Zt(this,function(p){switch(p.label){case 0:for(e=Array.isArray(this.path)?this.path[1]:this.path,r=function(g){var x=g.lastIndexOf("/"),y=g.lastIndexOf("?"),b=g.substring(0,x),C=y>x?g.substring(y):"";return[b+"/",C]}(e),o=r[0],a=r[1],i=this.weightPathPrefix||o,s=[],u=0,l=t;u<l.length;u++)c=l[u],s.push.apply(s,c.weights);return h=[],t.forEach(function(g){g.paths.forEach(function(x){h.push(i+x+a)})}),[4,dB(h,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return d=p.sent(),[2,[s,nI(d)]]}})})},n.URL_SCHEME_REGEX=/^https?:\/\//,n}();function pE(n){return n.match(pB.URL_SCHEME_REGEX)!=null}var JO=function(n,t){return typeof fetch>"u"?null:(Array.isArray(n)?n.every(function(e){return pE(e)}):pE(n))?mE(n,{onProgress:t}):null};function mE(n,t){return new pB(n,t)}ga.registerSaveRouter(JO),ga.registerLoadRouter(JO);var JC=function(){function n(t){this.modelArtifacts=t}return n.prototype.load=function(){return Qt(this,void 0,void 0,function(){return Zt(this,function(t){return[2,this.modelArtifacts]})})},n}(),$ht=function(){function n(t){this.saveHandler=t}return n.prototype.save=function(t){return Qt(this,void 0,void 0,function(){return Zt(this,function(e){return[2,this.saveHandler(t)]})})},n}(),mB=Object.freeze({browserFiles:function(n){return new Dht(n)},browserHTTPRequest:function(n,t){return mE(n,t)},concatenateArrayBuffers:nI,decodeWeights:lB,encodeWeights:function(n,t){return Qt(this,void 0,void 0,function(){var e,r,o,a,i,s=this;return Zt(this,function(u){switch(u.label){case 0:for(e=[],r=[],o=Array.isArray(n)?n.map(function(l){return l.name}):Object.keys(n),a=function(l){var c=o[l],h=Array.isArray(n)?n[l].tensor:n[c];if(h.dtype!=="float32"&&h.dtype!=="int32"&&h.dtype!=="bool"&&h.dtype!=="string")throw new Error("Unsupported dtype in weight '"+c+"': "+h.dtype);var d={name:c,shape:h.shape,dtype:h.dtype};if(h.dtype==="string"){var p=new Promise(function(g){return Qt(s,void 0,void 0,function(){var x,y,b,C,E,S,k;return Zt(this,function(R){switch(R.label){case 0:return[4,h.bytes()];case 1:for(x=R.sent(),y=x.reduce(function(A,N){return A+N.length},0)+fy*x.length,b=new Uint8Array(y),C=0,E=0;E<x.length;E++)S=x[E],k=new Uint8Array(new Uint32Array([S.length]).buffer),b.set(k,C),C+=fy,b.set(S,C),C+=S.length;return g(b),[2]}})})});r.push(p)}else r.push(h.data());t!=null&&(d.group=t),e.push(d)},i=0;i<o.length;++i)a(i);return[4,Promise.all(r)];case 1:return[2,{data:wht(u.sent()),specs:e}]}})})},fromMemory:function(n,t,e,r){return arguments.length===1?n.modelTopology!=null||n.weightSpecs!=null?new JC(n):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new JC({modelTopology:n})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new JC({modelTopology:n,weightSpecs:t,weightData:e,trainingConfig:r}))},getLoadHandlers:function(n,t){return ga.getLoadHandlers(n,t)},getModelArtifactsInfoForJSON:Vm,getSaveHandlers:function(n){return ga.getSaveHandlers(n)},http:mE,isHTTPScheme:pE,loadWeights:function(n,t,e,r){return t===void 0&&(t=""),Qt(this,void 0,void 0,function(){return Zt(this,function(o){return[2,ZO(function(a){return dB(a,{requestInit:r})})(n,t,e)]})})},registerLoadRouter:function(n){return ga.registerLoadRouter(n)},registerSaveRouter:function(n){return ga.registerSaveRouter(n)},weightsLoaderFactory:ZO,withSaveHandler:function(n){return new $ht(n)},copyModel:function(n,t){return Qt(this,void 0,void 0,function(){return Zt(this,function(e){return[2,jO(n,t,!1)]})})},listModels:function(){return Qt(this,void 0,void 0,function(){var n,t,e,r,o,a,i;return Zt(this,function(s){switch(s.label){case 0:n=Yu.getSchemes(),t={},e=0,r=n,s.label=1;case 1:return e<r.length?(o=r[e],[4,Yu.getManager(o).listModels()]):[3,4];case 2:for(i in a=s.sent())t[o+bf+i]=a[i];s.label=3;case 3:return e++,[3,1];case 4:return[2,t]}})})},moveModel:function(n,t){return Qt(this,void 0,void 0,function(){return Zt(this,function(e){return[2,jO(n,t,!0)]})})},removeModel:function(n){return Qt(this,void 0,void 0,function(){var t;return Zt(this,function(e){return t=l0(n),[2,Yu.getManager(t.scheme).removeModel(t.path)]})})}}),Qh;nt({confusionMatrix_:function(n,t,e){var r=j(n,"labels","confusionMatrix"),o=j(t,"predictions","confusionMatrix");X(e==null||e>0&&Number.isInteger(e),function(){return"If provided, numClasses must be a positive integer, but got "+e}),X(r.rank===1,function(){return"Expected the rank of labels to be 1, but got "+r.rank}),X(o.rank===1,function(){return"Expected the rank of predictions to be 1, but got "+o.rank}),X(r.shape[0]===o.shape[0],function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+o.shape[0]+". Labels and predictions should have the same number of elements."}),X(e>0&&Number.isInteger(e),function(){return"numClasses is required to be a positive integer, but got "+e});var a=cy(r.asType("int32"),e),i=cy(o.asType("int32"),e);return a.transpose().matMul(i).asType("int32")}});var Oht=nt({fromPixels_:function(n,t){if(t===void 0&&(t=3),t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(n==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var e=!1,r=!1,o=!1,a=!1,i=!1;if(n.data instanceof Uint8Array)e=!0;else if(typeof ImageData<"u"&&n instanceof ImageData)r=!0;else if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement)o=!0;else if(typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement)a=!0;else{if(n.getContext==null)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+n.constructor.name);i=!0}if(o&&o&&n.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(SL("FromPixels",st.backendName)!=null)return st.runKernel("FromPixels",{pixels:n},{numChannels:t});var s,u,l=o?[n.videoWidth,n.videoHeight]:[n.width,n.height],c=l[0],h=l[1];if(i?s=n.getContext("2d").getImageData(0,0,c,h).data:r||e?s=n.data:(a||o)&&(Qh==null&&(Qh=document.createElement("canvas").getContext("2d")),Qh.canvas.width=c,Qh.canvas.height=h,Qh.drawImage(n,0,0,c,h),s=Qh.getImageData(0,0,c,h).data),t===4)u=new Int32Array(s);else{var d=c*h;u=new Int32Array(d*t);for(var p=0;p<d;p++)for(var g=0;g<t;++g)u[p*t+g]=s[4*p+g]}return PL(u,[h,c,t],"int32")}}),gB=Object.freeze({toPixels:function(n,t){return Qt(this,void 0,void 0,function(){var e,r,o,a,i,s,u,l,c,h,d,p,g,x,y,b,C,E,S,k,R,A,N;return Zt(this,function(_){switch(_.label){case 0:if(e=j(n,"img","toPixels"),n instanceof Tn||(e=e.toInt()),e.rank!==2&&e.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+e.rank+".");if(r=e.shape.slice(0,2),o=r[0],a=r[1],(i=e.rank===2?1:e.shape[2])>4||i===2)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+i);return[4,e.data()];case 1:return s=_.sent(),u=e.min(),l=e.max(),[4,Promise.all([u.data(),l.data()])];case 2:if(c=_.sent(),h=c[0],d=c[1],p=h[0],g=d[0],u.dispose(),l.dispose(),e.dtype==="float32"){if(p<0||g>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+p+" - "+g+"].")}else{if(e.dtype!=="int32")throw new Error("Unsupported type for toPixels: "+e.dtype+". Please use float32 or int32 tensors.");if(p<0||g>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+p+" - "+g+"].")}for(x=e.dtype==="float32"?255:1,y=new Uint8ClampedArray(a*o*4),b=0;b<o*a;++b)C=void 0,E=void 0,S=void 0,k=void 0,i===1?(C=s[b]*x,E=s[b]*x,S=s[b]*x,k=255):i===3?(C=s[3*b]*x,E=s[3*b+1]*x,S=s[3*b+2]*x,k=255):i===4&&(C=s[4*b]*x,E=s[4*b+1]*x,S=s[4*b+2]*x,k=s[4*b+3]*x),y[(R=4*b)+0]=Math.round(C),y[R+1]=Math.round(E),y[R+2]=Math.round(S),y[R+3]=Math.round(k);return t!=null&&(t.width=a,t.height=o,A=t.getContext("2d"),N=new ImageData(y,a,o),A.putImageData(N,0,0)),e!==n&&e.dispose(),[2,y]}})})},fromPixels:Oht}),Fht=function(){function n(){}return n.prototype.getClassName=function(){return this.constructor.className},n.fromConfig=function(t,e){return new t(e)},n}(),Mht=function(){function n(){this.classNameMap={}}return n.getMap=function(){return n.instance==null&&(n.instance=new n),n.instance},n.register=function(t){n.getMap().classNameMap[t.className]=[t,t.fromConfig]},n}();function Zc(n){X(n.className!=null,function(){return"Class being registered does not have the static className property defined."}),X(typeof n.className=="string",function(){return"className is required to be a string, but got type "+typeof n.className}),X(n.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),Mht.register(n)}var Jc=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return wi(t,n),t.prototype.minimize=function(e,r,o){r===void 0&&(r=!1);var a=this.computeGradients(e,o),i=a.value,s=a.grads;if(o!=null){var u=o.map(function(l){return{name:l.name,tensor:s[l.name]}});this.applyGradients(u)}else this.applyGradients(s);return qo(s),r?i:(i.dispose(),null)},Object.defineProperty(t.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),t.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},t.prototype.computeGradients=function(e,r){return ost(e,r)},t.prototype.dispose=function(){this.iterations_!=null&&qo(this.iterations_)},t.prototype.saveIterations=function(){return Qt(this,void 0,void 0,function(){return Zt(this,function(e){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:ae(this.iterations_,"int32")}]})})},t.prototype.getWeights=function(){return Qt(this,void 0,void 0,function(){return Zt(this,function(e){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},t.prototype.setWeights=function(e){return Qt(this,void 0,void 0,function(){return Zt(this,function(r){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},t.prototype.extractIterations=function(e){return Qt(this,void 0,void 0,function(){var r;return Zt(this,function(o){switch(o.label){case 0:return r=this,[4,e[0].tensor.data()];case 1:return r.iterations_=o.sent()[0],[2,e.slice(1)]}})})},t}(Fht);Object.defineProperty(Jc,Symbol.hasInstance,{value:function(n){return n.minimize!=null&&n.computeGradients!=null&&n.applyGradients!=null}});var Lht=function(n){function t(e,r,o){o===void 0&&(o=null);var a=n.call(this)||this;return a.learningRate=e,a.rho=r,a.epsilon=o,a.accumulatedGrads=[],a.accumulatedUpdates=[],o==null&&(a.epsilon=st.backend.epsilon()),a}return wi(t,n),t.prototype.applyGradients=function(e){var r=this;(Array.isArray(e)?e.map(function(o){return o.name}):Object.keys(e)).forEach(function(o,a){var i=st.registeredVariables[o];r.accumulatedGrads[a]==null&&(r.accumulatedGrads[a]={originalName:o+"/accum_grad",variable:an(function(){return je(i).variable(!1)})}),r.accumulatedUpdates[a]==null&&(r.accumulatedUpdates[a]={originalName:o+"/accum_var",variable:an(function(){return je(i).variable(!1)})});var s=Array.isArray(e)?e[a].tensor:e[o];if(s!=null){var u=r.accumulatedGrads[a].variable,l=r.accumulatedUpdates[a].variable;an(function(){var c=u.mul(r.rho).add(s.square().mul(1-r.rho)),h=l.add(r.epsilon).sqrt().div(u.add(r.epsilon).sqrt()).mul(s),d=l.mul(r.rho).add(h.square().mul(1-r.rho));u.assign(c),l.assign(d);var p=h.mul(-r.learningRate).add(i);i.assign(p)})}}),this.incrementIterations()},t.prototype.dispose=function(){this.accumulatedUpdates!=null&&(qo(this.accumulatedGrads.map(function(e){return e.variable})),qo(this.accumulatedUpdates.map(function(e){return e.variable})))},t.prototype.getWeights=function(){return Qt(this,void 0,void 0,function(){var e;return Zt(this,function(r){switch(r.label){case 0:return e=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(e.map(function(o){return{name:o.originalName,tensor:o.variable}}))]}})})},t.prototype.setWeights=function(e){return Qt(this,void 0,void 0,function(){var r;return Zt(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(e)];case 1:return e=o.sent(),r=e.length/2,this.accumulatedGrads=e.slice(0,r).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),this.accumulatedUpdates=e.slice(r,2*r).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},t.fromConfig=function(e,r){return new e(r.learningRate,r.rho,r.epsilon)},t.className="Adadelta",t}(Jc);Zc(Lht);var Pht=function(n){function t(e,r){r===void 0&&(r=.1);var o=n.call(this)||this;return o.learningRate=e,o.initialAccumulatorValue=r,o.accumulatedGrads=[],o}return wi(t,n),t.prototype.applyGradients=function(e){var r=this;(Array.isArray(e)?e.map(function(o){return o.name}):Object.keys(e)).forEach(function(o,a){var i=st.registeredVariables[o];r.accumulatedGrads[a]==null&&(r.accumulatedGrads[a]={originalName:o+"/accumulator",variable:an(function(){return gc(i.shape,r.initialAccumulatorValue).variable(!1)})});var s=Array.isArray(e)?e[a].tensor:e[o];if(s!=null){var u=r.accumulatedGrads[a].variable;an(function(){var l=u.add(s.square());u.assign(l);var c=s.div(l.add(st.backend.epsilon()).sqrt()).mul(-r.learningRate).add(i);i.assign(c)})}}),this.incrementIterations()},t.prototype.dispose=function(){this.accumulatedGrads!=null&&qo(this.accumulatedGrads.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return Qt(this,void 0,void 0,function(){return Zt(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulatedGrads.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},t.prototype.setWeights=function(e){return Qt(this,void 0,void 0,function(){return Zt(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(e)];case 1:return e=r.sent(),this.accumulatedGrads=e.map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},t.fromConfig=function(e,r){return new e(r.learningRate,r.initialAccumulatorValue)},t.className="Adagrad",t}(Jc);Zc(Pht);var Bht=function(n){function t(e,r,o,a){a===void 0&&(a=null);var i=n.call(this)||this;return i.learningRate=e,i.beta1=r,i.beta2=o,i.epsilon=a,i.accumulatedFirstMoment=[],i.accumulatedSecondMoment=[],an(function(){i.accBeta1=ae(r).variable(),i.accBeta2=ae(o).variable()}),a==null&&(i.epsilon=st.backend.epsilon()),i}return wi(t,n),t.prototype.applyGradients=function(e){var r=this,o=Array.isArray(e)?e.map(function(a){return a.name}):Object.keys(e);an(function(){var a=fi(1,r.accBeta1),i=fi(1,r.accBeta2);o.forEach(function(s,u){var l=st.registeredVariables[s];r.accumulatedFirstMoment[u]==null&&(r.accumulatedFirstMoment[u]={originalName:s+"/m",variable:an(function(){return je(l).variable(!1)})}),r.accumulatedSecondMoment[u]==null&&(r.accumulatedSecondMoment[u]={originalName:s+"/v",variable:an(function(){return je(l).variable(!1)})});var c=Array.isArray(e)?e[u].tensor:e[s];if(c!=null){var h=r.accumulatedFirstMoment[u].variable,d=r.accumulatedSecondMoment[u].variable,p=h.mul(r.beta1).add(c.mul(1-r.beta1)),g=d.mul(r.beta2).add(c.square().mul(1-r.beta2)),x=p.div(a),y=g.div(i);h.assign(p),d.assign(g);var b=x.div(y.sqrt().add(r.epsilon)).mul(-r.learningRate).add(l);l.assign(b)}}),r.accBeta1.assign(r.accBeta1.mul(r.beta1)),r.accBeta2.assign(r.accBeta2.mul(r.beta2))}),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&qo(this.accumulatedFirstMoment.map(function(e){return e.variable})),this.accumulatedSecondMoment!=null&&qo(this.accumulatedSecondMoment.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return Qt(this,void 0,void 0,function(){var e;return Zt(this,function(r){switch(r.label){case 0:return e=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(e.map(function(o){return{name:o.originalName,tensor:o.variable}}))]}})})},t.prototype.setWeights=function(e){return Qt(this,void 0,void 0,function(){var r,o=this;return Zt(this,function(a){switch(a.label){case 0:return[4,this.extractIterations(e)];case 1:return e=a.sent(),an(function(){o.accBeta1.assign(ay(o.beta1,o.iterations_+1)),o.accBeta2.assign(ay(o.beta2,o.iterations_+1))}),r=e.length/2,this.accumulatedFirstMoment=e.slice(0,r).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),this.accumulatedSecondMoment=e.slice(r,2*r).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},t.fromConfig=function(e,r){return new e(r.learningRate,r.beta1,r.beta2,r.epsilon)},t.className="Adam",t}(Jc);Zc(Bht);var zht=function(n){function t(e,r,o,a,i){a===void 0&&(a=null),i===void 0&&(i=0);var s=n.call(this)||this;return s.learningRate=e,s.beta1=r,s.beta2=o,s.epsilon=a,s.decay=i,s.accumulatedFirstMoment=[],s.accumulatedWeightedInfNorm=[],an(function(){s.iteration=ae(0).variable(),s.accBeta1=ae(r).variable()}),a==null&&(s.epsilon=st.backend.epsilon()),s}return wi(t,n),t.prototype.applyGradients=function(e){var r=this,o=Array.isArray(e)?e.map(function(a){return a.name}):Object.keys(e);an(function(){var a=fi(1,r.accBeta1),i=al(-r.learningRate,r.iteration.mul(r.decay).add(1));o.forEach(function(s,u){var l=st.registeredVariables[s];r.accumulatedFirstMoment[u]==null&&(r.accumulatedFirstMoment[u]={originalName:s+"/m",variable:je(l).variable(!1)}),r.accumulatedWeightedInfNorm[u]==null&&(r.accumulatedWeightedInfNorm[u]={originalName:s+"/v",variable:je(l).variable(!1)});var c=Array.isArray(e)?e[u].tensor:e[s];if(c!=null){var h=r.accumulatedFirstMoment[u].variable,d=r.accumulatedWeightedInfNorm[u].variable,p=h.mul(r.beta1).add(c.mul(1-r.beta1)),g=d.mul(r.beta2),x=c.abs(),y=g.maximum(x);h.assign(p),d.assign(y);var b=i.div(a).mul(p.div(y.add(r.epsilon))).add(l);l.assign(b)}}),r.iteration.assign(r.iteration.add(1)),r.accBeta1.assign(r.accBeta1.mul(r.beta1))}),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&qo(this.accumulatedFirstMoment.map(function(e){return e.variable})),this.accumulatedWeightedInfNorm!=null&&qo(this.accumulatedWeightedInfNorm.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return Qt(this,void 0,void 0,function(){return Zt(this,function(e){throw new Error("getWeights() is not implemented for Adamax yet.")})})},t.prototype.setWeights=function(e){return Qt(this,void 0,void 0,function(){return Zt(this,function(r){throw new Error("setWeights() is not implemented for Adamax yet.")})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},t.fromConfig=function(e,r){return new e(r.learningRate,r.beta1,r.beta2,r.epsilon,r.decay)},t.className="Adamax",t}(Jc);Zc(zht);var vB=function(n){function t(e){var r=n.call(this)||this;return r.learningRate=e,r.setLearningRate(e),r}return wi(t,n),t.prototype.applyGradients=function(e){var r=this;(Array.isArray(e)?e.map(function(o){return o.name}):Object.keys(e)).forEach(function(o,a){var i=Array.isArray(e)?e[a].tensor:e[o];if(i!=null){var s=st.registeredVariables[o];an(function(){var u=r.c.mul(i).add(s);s.assign(u)})}}),this.incrementIterations()},t.prototype.setLearningRate=function(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=Xat(ae(-e))},t.prototype.dispose=function(){this.c.dispose()},t.prototype.getWeights=function(){return Qt(this,void 0,void 0,function(){return Zt(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()]]}})})},t.prototype.setWeights=function(e){return Qt(this,void 0,void 0,function(){return Zt(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(e)];case 1:if((e=r.sent()).length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate}},t.fromConfig=function(e,r){return new e(r.learningRate)},t.className="SGD",t}(Jc);Zc(vB);var Uht=function(n){function t(e,r,o){o===void 0&&(o=!1);var a=n.call(this,e)||this;return a.learningRate=e,a.momentum=r,a.useNesterov=o,a.accumulations=[],a.m=ae(a.momentum),a}return wi(t,n),t.prototype.applyGradients=function(e){var r=this;(Array.isArray(e)?e.map(function(o){return o.name}):Object.keys(e)).forEach(function(o,a){var i=st.registeredVariables[o];r.accumulations[a]==null&&(r.accumulations[a]={originalName:o+"/momentum",variable:an(function(){return je(i).variable(!1)})});var s=r.accumulations[a].variable,u=Array.isArray(e)?e[a].tensor:e[o];u!=null&&an(function(){var l,c=r.m.mul(s).add(u);l=r.useNesterov?r.c.mul(u.add(c.mul(r.m))).add(i):r.c.mul(c).add(i),s.assign(c),i.assign(l)})}),this.incrementIterations()},t.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&qo(this.accumulations.map(function(e){return e.variable}))},t.prototype.setMomentum=function(e){this.momentum=e},t.prototype.getWeights=function(){return Qt(this,void 0,void 0,function(){return Zt(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulations.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},t.prototype.setWeights=function(e){return Qt(this,void 0,void 0,function(){return Zt(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(e)];case 1:return e=r.sent(),this.accumulations=e.map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},t.fromConfig=function(e,r){return new e(r.learningRate,r.momentum,r.useNesterov)},t.className="Momentum",t}(vB);Zc(Uht);var Wht=function(n){function t(e,r,o,a,i){r===void 0&&(r=.9),o===void 0&&(o=0),a===void 0&&(a=null),i===void 0&&(i=!1);var s=n.call(this)||this;if(s.learningRate=e,s.decay=r,s.momentum=o,s.epsilon=a,s.accumulatedMeanSquares=[],s.accumulatedMoments=[],s.accumulatedMeanGrads=[],s.centered=i,a==null&&(s.epsilon=st.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return s}return wi(t,n),t.prototype.applyGradients=function(e){var r=this;(Array.isArray(e)?e.map(function(o){return o.name}):Object.keys(e)).forEach(function(o,a){var i=st.registeredVariables[o];r.accumulatedMeanSquares[a]==null&&(r.accumulatedMeanSquares[a]={originalName:o+"/rms",variable:an(function(){return je(i).variable(!1)})}),r.accumulatedMoments[a]==null&&(r.accumulatedMoments[a]={originalName:o+"/momentum",variable:an(function(){return je(i).variable(!1)})}),r.accumulatedMeanGrads[a]==null&&r.centered&&(r.accumulatedMeanGrads[a]={originalName:o+"/mg",variable:an(function(){return je(i).variable(!1)})});var s=Array.isArray(e)?e[a].tensor:e[o];if(s!=null){var u=r.accumulatedMeanSquares[a].variable,l=r.accumulatedMoments[a].variable;an(function(){var c=u.mul(r.decay).add(s.square().mul(1-r.decay));if(r.centered){var h=r.accumulatedMeanGrads[a].variable,d=h.mul(r.decay).add(s.mul(1-r.decay)),p=l.mul(r.momentum).add(s.mul(r.learningRate).div(c.sub(d.square().add(r.epsilon)).sqrt()));u.assign(c),h.assign(d),l.assign(p);var g=i.sub(p);i.assign(g)}else{var x=u.mul(r.decay).add(s.square().mul(1-r.decay));p=l.mul(r.momentum).add(s.mul(r.learningRate).div(x.add(r.epsilon).sqrt())),u.assign(x),l.assign(p),g=i.sub(p),i.assign(g)}})}}),this.incrementIterations()},t.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&qo(this.accumulatedMeanSquares.map(function(e){return e.variable})),this.accumulatedMeanGrads!=null&&this.centered&&qo(this.accumulatedMeanGrads.map(function(e){return e.variable})),this.accumulatedMoments!=null&&qo(this.accumulatedMoments.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return Qt(this,void 0,void 0,function(){var e;return Zt(this,function(r){switch(r.label){case 0:return e=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&e.push.apply(e,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(e.map(function(o){return{name:o.originalName,tensor:o.variable}}))]}})})},t.prototype.setWeights=function(e){return Qt(this,void 0,void 0,function(){var r;return Zt(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(e)];case 1:return e=o.sent(),r=this.centered?e.length/3:e.length/2,this.accumulatedMeanSquares=e.slice(0,r).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),this.accumulatedMoments=e.slice(r,2*r).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=e.slice(2*r,3*r).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}})),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},t.fromConfig=function(e,r){return new e(r.learningRate,r.decay,r.momentum,r.epsilon,r.centered)},t.className="RMSProp",t}(Jc);Zc(Wht);Tn.prototype.add=function(n){return qa(this,n)},Tn.prototype.broadcastTo=function(n){return NP(this,n)},Tn.prototype.div=function(n){return al(this,n)},Tn.prototype.divNoNan=function(n){return DP(this,n)},Tn.prototype.squaredDifference=function(n){return MP(this,n)},Tn.prototype.tile=function(n){return yf(this,n)},Tn.prototype.oneHot=function(n,t,e){return t===void 0&&(t=1),e===void 0&&(e=0),cy(this,n,t,e)},Tn.prototype.transpose=function(n){return ai(this,n)},Tn.prototype.pad=function(n,t){return au(this,n,t)},Tn.prototype.batchNorm=function(n,t,e,r,o){return Um(this,n,t,e,r,o)},Tt=iht;var Sf=function(){function n(t,e){if(!vc(t)||!vc(e))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:t,height:e}));this._width=t,this._height=e}return Object.defineProperty(n.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),n.prototype.reverse=function(){return new n(1/this.width,1/this.height)},n}(),Ze=function(){function n(t,e){this._x=t,this._y=e}return Object.defineProperty(n.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),n.prototype.add=function(t){return new n(this.x+t.x,this.y+t.y)},n.prototype.sub=function(t){return new n(this.x-t.x,this.y-t.y)},n.prototype.mul=function(t){return new n(this.x*t.x,this.y*t.y)},n.prototype.div=function(t){return new n(this.x/t.x,this.y/t.y)},n.prototype.abs=function(){return new n(Math.abs(this.x),Math.abs(this.y))},n.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},n.prototype.floor=function(){return new n(Math.floor(this.x),Math.floor(this.y))},n}();function l1(n,t){return n instanceof Tn&&n.shape.length===t}function Vht(n){return l1(n,2)}function c1(n){return l1(n,3)}function Qu(n){return l1(n,4)}function Ght(n){return n%1!==0}function t3(n){return n%2===0}function rI(n,t){t===void 0&&(t=2);var e=Math.pow(10,t);return Math.floor(n*e)/e}function e3(n){return n&&n.width&&n.height}function Hht(n,t){var e=n.width,r=n.height,o=t/Math.max(r,e);return new Sf(Math.round(e*o),Math.round(r*o))}function oI(n){return n.reduce(function(t,e){return t.add(e)},new Ze(0,0)).div(new Ze(n.length,n.length))}function om(n,t,e){return Array(n).fill(0).map(function(r,o){return t+o*e})}function vc(n){return!!n&&n!==1/0&&n!==-1/0&&!isNaN(n)||n===0}function n3(n){return vc(n)&&0<=n&&n<=1}var ns=function(){function n(t,e){e===void 0&&(e=!0);var r=t||{},o=[r.left,r.top,r.right,r.bottom].every(vc),a=[r.x,r.y,r.width,r.height].every(vc);if(!a&&!o)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(r));var i=a?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top],s=i[0],u=i[1],l=i[2],c=i[3];n.assertIsValidBox({x:s,y:u,width:l,height:c},"Box.constructor",e),this._x=s,this._y=u,this._width=l,this._height=c}return n.isRect=function(t){return!!t&&[t.x,t.y,t.width,t.height].every(vc)},n.assertIsValidBox=function(t,e,r){if(r===void 0&&(r=!1),!n.isRect(t))throw new Error(e+" - invalid box: "+JSON.stringify(t)+", expected object with properties x, y, width, height");if(!r&&(t.width<0||t.height<0))throw new Error(e+" - width ("+t.width+") and height ("+t.height+") must be positive numbers")},Object.defineProperty(n.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"topLeft",{get:function(){return new Ze(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"topRight",{get:function(){return new Ze(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bottomLeft",{get:function(){return new Ze(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bottomRight",{get:function(){return new Ze(this.right,this.bottom)},enumerable:!0,configurable:!0}),n.prototype.round=function(){var t=[this.x,this.y,this.width,this.height].map(function(i){return Math.round(i)}),e=t[0],r=t[1],o=t[2],a=t[3];return new n({x:e,y:r,width:o,height:a})},n.prototype.floor=function(){var t=[this.x,this.y,this.width,this.height].map(function(i){return Math.floor(i)}),e=t[0],r=t[1],o=t[2],a=t[3];return new n({x:e,y:r,width:o,height:a})},n.prototype.toSquare=function(){var t=this,e=t.x,r=t.y,o=t.width,a=t.height,i=Math.abs(o-a);return o<a&&(e-=i/2,o+=i),a<o&&(r-=i/2,a+=i),new n({x:e,y:r,width:o,height:a})},n.prototype.rescale=function(t){var e=e3(t)?t.width:t,r=e3(t)?t.height:t;return new n({x:this.x*e,y:this.y*r,width:this.width*e,height:this.height*r})},n.prototype.pad=function(t,e){var r=[this.x-t/2,this.y-e/2,this.width+t,this.height+e],o=r[0],a=r[1],i=r[2],s=r[3];return new n({x:o,y:a,width:i,height:s})},n.prototype.clipAtImageBorders=function(t,e){var r=this,o=r.x,a=r.y,i=r.right,s=r.bottom,u=Math.max(o,0),l=Math.max(a,0),c=i-u,h=s-l,d=Math.min(c,t-u),p=Math.min(h,e-l);return new n({x:u,y:l,width:d,height:p}).floor()},n.prototype.shift=function(t,e){var r=this,o=r.width,a=r.height,i=this.x+t,s=this.y+e;return new n({x:i,y:s,width:o,height:a})},n.prototype.padAtBorders=function(t,e){var r=this.width+1,o=this.height+1,a=1,i=1,s=r,u=o,l=this.left,c=this.top,h=this.right,d=this.bottom;return h>e&&(s=-h+e+r,h=e),d>t&&(u=-d+t+o,d=t),l<1&&(u=2-l,l=1),c<1&&(u=2-c,c=1),{dy:i,edy:u,dx:a,edx:s,y:c,ey:d,x:l,ex:h,w:r,h:o}},n.prototype.calibrate=function(t){return new n({left:this.left+t.left*this.width,top:this.top+t.top*this.height,right:this.right+t.right*this.width,bottom:this.bottom+t.bottom*this.height}).toSquare().round()},n}(),h1=function(n){Se(t,n);function t(e,r,o,a,i){return i===void 0&&(i=!1),n.call(this,{left:e,top:r,right:o,bottom:a},i)||this}return t}(ns),r3=function(n){Se(t,n);function t(e,r){var o=n.call(this,e)||this;return o._label=r,o}return t.assertIsValidLabeledBox=function(e,r){if(ns.assertIsValidBox(e,r),!vc(e.label))throw new Error(r+" - expected property label ("+e.label+") to be a number")},Object.defineProperty(t.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),t}(ns),xB=function(){function n(t,e,r,o,a){this._imageDims=new Sf(a.width,a.height),this._score=t,this._classScore=e,this._className=r,this._box=new ns(o).rescale(this._imageDims)}return Object.defineProperty(n.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"relativeBox",{get:function(){return new ns(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),n.prototype.forSize=function(t,e){return new n(this.score,this.classScore,this.className,this.relativeBox,{width:t,height:e})},n}();(function(n){Se(t,n);function t(e,r,o,a){var i=n.call(this,e,r)||this;return i._score=o,i._classScore=a,i}return t.assertIsValidPredictedBox=function(e,r){if(r3.assertIsValidLabeledBox(e,r),!n3(e.score)||!n3(e.classScore))throw new Error(r+" - expected properties score ("+e.score+") and ("+e.classScore+") to be a number between [0, 1]")},Object.defineProperty(t.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),t})(r3);var aI=function(n){Se(t,n);function t(e,r,o,a,i){return i===void 0&&(i=!1),n.call(this,{x:e,y:r,width:o,height:a},i)||this}return t}(ns);function yB(){var n=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")},t=function(){throw new Error("readFile - filesystem not available for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D,Image:HTMLImageElement,ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:n,readFile:t}}function bB(n){var t="";if(!n)try{n=require("fs")}catch(r){t=r.toString()}var e=n?function(r){return new Promise(function(o,a){n.readFile(r,function(i,s){return i?a(i):o(s)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+t)};return{readFile:e}}function wB(){var n=global.Canvas||global.HTMLCanvasElement,t=global.Image||global.HTMLImageElement,e=function(){if(n)return new n;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},r=function(){if(t)return new t;throw new Error("createImageElement - missing Image implementation for nodejs environment")},o=global.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},a=bB();return ci({Canvas:n||function(){function i(){}return i}(),CanvasRenderingContext2D:global.CanvasRenderingContext2D||function(){function i(){}return i}(),Image:t||function(){function i(){}return i}(),ImageData:global.ImageData||function(){function i(){}return i}(),Video:global.HTMLVideoElement||function(){function i(){}return i}(),createCanvasElement:e,createImageElement:r,fetch:o},a)}function CB(){return typeof window=="object"&&typeof document<"u"&&typeof HTMLImageElement<"u"&&typeof HTMLCanvasElement<"u"&&typeof HTMLVideoElement<"u"&&typeof ImageData<"u"&&typeof CanvasRenderingContext2D<"u"}function SB(){return typeof global=="object"&&typeof require=="function"&&typeof pq<"u"&&typeof process<"u"&&!!process.version}var Er;function qht(){if(!Er)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return Er}function gE(n){Er=n}function iI(){CB()&&gE(yB()),SB()&&gE(wB())}function jht(n){if(Er||iI(),!Er)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var t=n.Canvas,e=t===void 0?Er.Canvas:t,r=n.Image,o=r===void 0?Er.Image:r;Er.Canvas=e,Er.Image=o,Er.createCanvasElement=n.createCanvasElement||function(){return new e},Er.createImageElement=n.createImageElement||function(){return new o},Er.ImageData=n.ImageData||Er.ImageData,Er.Video=n.Video||Er.Video,Er.fetch=n.fetch||Er.fetch,Er.readFile=n.readFile||Er.readFile}var wo={getEnv:qht,setEnv:gE,initialize:iI,createBrowserEnv:yB,createFileSystem:bB,createNodejsEnv:wB,monkeyPatch:jht,isBrowser:CB,isNodejs:SB};iI();function sI(n){return!wo.isNodejs()&&typeof n=="string"?document.getElementById(n):n}function rs(n){var t=wo.getEnv(),e=t.Canvas,r=t.CanvasRenderingContext2D;if(n instanceof r)return n;var o=sI(n);if(!(o instanceof e))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var a=o.getContext("2d");if(!a)throw new Error("resolveContext2d - canvas 2d context is null");return a}var Vs;(function(n){n.TOP_LEFT="TOP_LEFT",n.TOP_RIGHT="TOP_RIGHT",n.BOTTOM_LEFT="BOTTOM_LEFT",n.BOTTOM_RIGHT="BOTTOM_RIGHT"})(Vs||(Vs={}));var uI=function(){function n(t){t===void 0&&(t={});var e=t.anchorPosition,r=t.backgroundColor,o=t.fontColor,a=t.fontSize,i=t.fontStyle,s=t.padding;this.anchorPosition=e||Vs.TOP_LEFT,this.backgroundColor=r||"rgba(0, 0, 0, 0.5)",this.fontColor=o||"rgba(255, 255, 255, 1)",this.fontSize=a||14,this.fontStyle=i||"Georgia",this.padding=s||4}return n}(),lI=function(){function n(t,e,r){r===void 0&&(r={}),this.text=typeof t=="string"?[t]:t instanceof n?t.text:t,this.anchor=e,this.options=new uI(r)}return n.prototype.measureWidth=function(t){var e=this.options.padding;return this.text.map(function(r){return t.measureText(r).width}).reduce(function(r,o){return r<o?o:r},0)+2*e},n.prototype.measureHeight=function(){var t=this.options,e=t.fontSize,r=t.padding;return this.text.length*e+2*r},n.prototype.getUpperLeft=function(t,e){var r=this.options.anchorPosition,o=r===Vs.BOTTOM_RIGHT||r===Vs.TOP_RIGHT,a=r===Vs.BOTTOM_LEFT||r===Vs.BOTTOM_RIGHT,i=this.measureWidth(t),s=this.measureHeight(),u=o?this.anchor.x-i:this.anchor.x,l=a?this.anchor.y-s:this.anchor.y;if(e){var c=e.width,h=e.height,d=Math.max(Math.min(u,c-i),0),p=Math.max(Math.min(l,h-s),0);return{x:d,y:p}}return{x:u,y:l}},n.prototype.draw=function(t){var e=sI(t),r=rs(e),o=this.options,a=o.backgroundColor,i=o.fontColor,s=o.fontSize,u=o.fontStyle,l=o.padding;r.font=s+"px "+u;var c=this.measureWidth(r),h=this.measureHeight();r.fillStyle=a;var d=this.getUpperLeft(r,e);r.fillRect(d.x,d.y,c,h),r.fillStyle=i,this.text.forEach(function(p,g){var x=l+d.x,y=l+d.y+(g+1)*s;r.fillText(p,x,y)})},n}(),EB=function(){function n(t){t===void 0&&(t={});var e=t.boxColor,r=t.lineWidth,o=t.label,a=t.drawLabelOptions;this.boxColor=e||"rgba(0, 0, 255, 1)",this.lineWidth=r||2,this.label=o;var i={anchorPosition:Vs.BOTTOM_LEFT,backgroundColor:this.boxColor};this.drawLabelOptions=new uI(Object.assign({},i,a))}return n}(),kB=function(){function n(t,e){e===void 0&&(e={}),this.box=new ns(t),this.options=new EB(e)}return n.prototype.draw=function(t){var e=rs(t),r=this.options,o=r.boxColor,a=r.lineWidth,i=this.box,s=i.x,u=i.y,l=i.width,c=i.height;e.strokeStyle=o,e.lineWidth=a,e.strokeRect(s,u,l,c);var h=this.options.label;h&&new lI([h],{x:s-a/2,y:u},this.options.drawLabelOptions).draw(t)},n}();const Xht=Object.freeze(Object.defineProperty({__proto__:null,get AnchorPosition(){return Vs},DrawBox:kB,DrawBoxOptions:EB,DrawTextField:lI,DrawTextFieldOptions:uI},Symbol.toStringTag,{value:"Module"}));function di(n,t,e,r){return e===void 0&&(e="same"),r===void 0&&(r=!1),an(function(){var o=qa(Qc(n,t.filters,[1,1],e),t.bias);return r?s1(o):o})}function su(n,t){Object.keys(n).forEach(function(e){t.some(function(r){return r.originalPath===e})||n[e].dispose()})}function f1(n,t){return function(e,r,o,a){var i=Pi(n(e*r*o*o),[o,o,e,r]),s=vi(n(r));return t.push({paramPath:a+"/filters"},{paramPath:a+"/bias"}),{filters:i,bias:s}}}function cI(n,t){return function(e,r,o){var a=mc(n(e*r),[e,r]),i=vi(n(r));return t.push({paramPath:o+"/weights"},{paramPath:o+"/bias"}),{weights:a,bias:i}}}var IB=function(){function n(t,e,r){this.depthwise_filter=t,this.pointwise_filter=e,this.bias=r}return n}();function hI(n,t){return function(e,r,o){var a=Pi(n(9*e),[3,3,e,1]),i=Pi(n(e*r),[1,1,e,r]),s=vi(n(r));return t.push({paramPath:o+"/depthwise_filter"},{paramPath:o+"/pointwise_filter"},{paramPath:o+"/bias"}),new IB(a,i,s)}}function fI(n){return function(t){var e=n(t+"/depthwise_filter",4),r=n(t+"/pointwise_filter",4),o=n(t+"/bias",1);return new IB(e,r,o)}}function yl(n,t){return function(e,r,o){var a=n[e];if(!l1(a,r))throw new Error("expected weightMap["+e+"] to be a Tensor"+r+"D, instead have "+a);return t.push({originalPath:e,paramPath:o||e}),a}}function uu(n){var t=n;function e(o){var a=t.slice(0,o);return t=t.slice(o),a}function r(){return t}return{extractWeights:e,getRemainingWeights:r}}function RB(n,t){var e=t+"-weights_manifest.json";if(!n)return{modelBaseUri:"",manifestUri:e};if(n==="/")return{modelBaseUri:"/",manifestUri:"/"+e};var r=n.startsWith("http://")?"http://":n.startsWith("https://")?"https://":"";n=n.replace(r,"");var o=n.split("/").filter(function(s){return s}),a=n.endsWith(".json")?o[o.length-1]:e,i=r+(n.endsWith(".json")?o.slice(0,o.length-1):o).join("/");return i=n.startsWith("/")?"/"+i:i,{modelBaseUri:i,manifestUri:i==="/"?"/"+a:i+"/"+a}}function TB(n){var t=wo.getEnv(),e=t.Image,r=t.Video;return n instanceof e&&n.complete||n instanceof r&&n.readyState>=3}function Kht(n){return new Promise(function(t,e){if(n instanceof wo.getEnv().Canvas||TB(n))return t();function r(a){a.currentTarget&&(a.currentTarget.removeEventListener("load",r),a.currentTarget.removeEventListener("error",o),t(a))}function o(a){a.currentTarget&&(a.currentTarget.removeEventListener("load",r),a.currentTarget.removeEventListener("error",o),e(a))}n.addEventListener("load",r),n.addEventListener("error",o)})}function NB(n){var t=wo.getEnv(),e=t.Image,r=t.Video;return n instanceof e?new Sf(n.naturalWidth,n.naturalHeight):n instanceof r?new Sf(n.videoWidth,n.videoHeight):new Sf(n.width,n.height)}function d1(n){var t=n.width,e=n.height,r=wo.getEnv().createCanvasElement,o=r();return o.width=t,o.height=e,o}function dI(n,t){var e=wo.getEnv().ImageData;if(!(n instanceof e)&&!TB(n))throw new Error("createCanvasFromMedia - media has not finished loading yet");var r=NB(n),o=r.width,a=r.height,i=d1({width:o,height:a});return n instanceof e?rs(i).putImageData(n,0,0):rs(i).drawImage(n,0,0,o,a),i}function Yht(n,t){return ie(this,void 0,void 0,function(){var e,r;return se(this,function(o){switch(o.label){case 0:return e=wo.getEnv().fetch,[4,e(n,t)];case 1:if(r=o.sent(),!(r.status<400))throw new Error("failed to fetch: ("+r.status+") "+r.statusText+", from url: "+r.url);return[2,r]}})})}function Qht(n){return ie(this,void 0,void 0,function(){return se(this,function(t){switch(t.label){case 0:return[4,Yht(n)];case 1:return[2,t.sent().json()]}})})}function Zht(n,t){return ie(this,void 0,void 0,function(){var e,r,o,a,i,s;return se(this,function(u){switch(u.label){case 0:return e=wo.getEnv().createCanvasElement(),r=n.shape.slice(Qu(n)?1:0),o=r[0],a=r[1],i=r[2],s=an(function(){return n.as3D(o,a,i).toInt()}),[4,gB.toPixels(s,e)];case 1:return u.sent(),s.dispose(),[2,e]}})})}function Jht(n,t,e){e===void 0&&(e=!1);var r=wo.getEnv(),o=r.Image,a=r.Canvas;if(!(n instanceof o||n instanceof a))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var i=NB(n),s=t/Math.max(i.height,i.width),u=s*i.width,l=s*i.height,c=d1({width:t,height:t}),h=n instanceof a?n:dI(n),d=Math.abs(u-l)/2,p=e&&u<l?d:0,g=e&&l<u?d:0;return rs(c).drawImage(h,p,g,u,l),c}function o3(n){var t=wo.getEnv(),e=t.Image,r=t.Canvas,o=t.Video;return n instanceof e||n instanceof r||n instanceof o}function tft(n,t){return ie(this,void 0,void 0,function(){var e,r,o,a;return se(this,function(i){switch(i.label){case 0:return e=RB(n,t),r=e.manifestUri,o=e.modelBaseUri,[4,Qht(r)];case 1:return a=i.sent(),[2,mB.loadWeights(a,o)]}})})}function eft(n,t){return t===void 0&&(t=!1),an(function(){var e=n.shape.slice(1),r=e[0],o=e[1];if(r===o)return n;var a=Math.abs(r-o),i=Math.round(a*(t?.5:1)),s=r>o?2:1,u=function(p){var g=n.shape.slice();return g[s]=p,gc(g,0)},l=u(i),c=a-l.shape[s],h=t&&c?u(c):null,d=[h,n,l].filter(function(p){return!!p}).map(function(p){return p.toFloat()});return Ha(d,s)})}var dy=function(){function n(t,e){var r=this;if(e===void 0&&(e=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(t))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+t);this._treatAsBatchInput=e,this._batchSize=t.length,t.forEach(function(o,a){if(c1(o)){r._imageTensors[a]=o,r._inputDimensions[a]=o.shape;return}if(Qu(o)){var i=o.shape[0];if(i!==1)throw new Error("NetInput - tf.Tensor4D with batchSize "+i+" passed, but not supported in input array");r._imageTensors[a]=o,r._inputDimensions[a]=o.shape.slice(1);return}var s=o instanceof wo.getEnv().Canvas?o:dI(o);r._canvases[a]=s,r._inputDimensions[a]=[s.height,s.width,3]})}return Object.defineProperty(n.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"reshapedInputDimensions",{get:function(){var t=this;return om(this.batchSize,0,1).map(function(e,r){return t.getReshapedInputDimensions(r)})},enumerable:!0,configurable:!0}),n.prototype.getInput=function(t){return this.canvases[t]||this.imageTensors[t]},n.prototype.getInputDimensions=function(t){return this._inputDimensions[t]},n.prototype.getInputHeight=function(t){return this._inputDimensions[t][0]},n.prototype.getInputWidth=function(t){return this._inputDimensions[t][1]},n.prototype.getReshapedInputDimensions=function(t){if(typeof this.inputSize!="number")throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");var e=this.getInputWidth(t),r=this.getInputHeight(t);return Hht({width:e,height:r},this.inputSize)},n.prototype.toBatchTensor=function(t,e){var r=this;return e===void 0&&(e=!0),this._inputSize=t,an(function(){var o=om(r.batchSize,0,1).map(function(i){var s=r.getInput(i);if(s instanceof Tn){var u=Qu(s)?s:s.expandDims();return u=eft(u,e),(u.shape[1]!==t||u.shape[2]!==t)&&(u=oB.resizeBilinear(u,[t,t])),u.as3D(t,t,3)}if(s instanceof wo.getEnv().Canvas)return gB.fromPixels(Jht(s,t,e));throw new Error("toBatchTensor - at batchIdx "+i+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+s)}),a=ol(o.map(function(i){return i.toFloat()})).as4D(r.batchSize,t,t,3);return a})},n}();function Wr(n){return ie(this,void 0,void 0,function(){var t,e,r;return se(this,function(o){switch(o.label){case 0:if(n instanceof dy)return[2,n];if(t=Array.isArray(n)?n:[n],!t.length)throw new Error("toNetInput - empty array passed as input");return e=function(a){return Array.isArray(n)?" at input index "+a+":":""},r=t.map(sI),r.forEach(function(a,i){if(!o3(a)&&!c1(a)&&!Qu(a))throw typeof t[i]=="string"?new Error("toNetInput -"+e(i)+" string passed, but could not resolve HTMLElement for element id "+t[i]):new Error("toNetInput -"+e(i)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id");if(Qu(a)){var s=a.shape[0];if(s!==1)throw new Error("toNetInput -"+e(i)+" tf.Tensor4D with batchSize "+s+" passed, but not supported in input array")}}),[4,Promise.all(r.map(function(a){return o3(a)&&Kht(a)}))];case 1:return o.sent(),[2,new dy(r,Array.isArray(n))]}})})}var lu=function(){function n(t){this._name=t,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(n.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),n.prototype.getParamFromPath=function(t){var e=this.traversePropertyPath(t),r=e.obj,o=e.objProp;return r[o]},n.prototype.reassignParamFromPath=function(t,e){var r=this.traversePropertyPath(t),o=r.obj,a=r.objProp;o[a].dispose(),o[a]=e},n.prototype.getParamList=function(){var t=this;return this._paramMappings.map(function(e){var r=e.paramPath;return{path:r,tensor:t.getParamFromPath(r)}})},n.prototype.getTrainableParams=function(){return this.getParamList().filter(function(t){return t.tensor instanceof Pf})},n.prototype.getFrozenParams=function(){return this.getParamList().filter(function(t){return!(t.tensor instanceof Pf)})},n.prototype.variable=function(){var t=this;this.getFrozenParams().forEach(function(e){var r=e.path,o=e.tensor;t.reassignParamFromPath(r,o.variable())})},n.prototype.freeze=function(){var t=this;this.getTrainableParams().forEach(function(e){var r=e.path,o=e.tensor,a=Qr(o.dataSync());o.dispose(),t.reassignParamFromPath(r,a)})},n.prototype.dispose=function(t){t===void 0&&(t=!0),this.getParamList().forEach(function(e){if(t&&e.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+e.path);e.tensor.dispose()}),this._params=void 0},n.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(t){var e=t.tensor;return Array.from(e.dataSync())}).reduce(function(t,e){return t.concat(e)}))},n.prototype.load=function(t){return ie(this,void 0,void 0,function(){return se(this,function(e){switch(e.label){case 0:return t instanceof Float32Array?(this.extractWeights(t),[2]):[4,this.loadFromUri(t)];case 1:return e.sent(),[2]}})})},n.prototype.loadFromUri=function(t){return ie(this,void 0,void 0,function(){var e;return se(this,function(r){switch(r.label){case 0:if(t&&typeof t!="string")throw new Error(this._name+".loadFromUri - expected model uri");return[4,tft(t,this.getDefaultModelName())];case 1:return e=r.sent(),this.loadFromWeightMap(e),[2]}})})},n.prototype.loadFromDisk=function(t){return ie(this,void 0,void 0,function(){var e,r,o,a,i,s,u,l,c,h;return se(this,function(d){switch(d.label){case 0:if(t&&typeof t!="string")throw new Error(this._name+".loadFromDisk - expected model file path");return e=wo.getEnv().readFile,r=RB(t,this.getDefaultModelName()),o=r.manifestUri,a=r.modelBaseUri,i=function(p){return Promise.all(p.map(function(g){return e(g).then(function(x){return x.buffer})}))},s=mB.weightsLoaderFactory(i),c=(l=JSON).parse,[4,e(o)];case 1:return u=c.apply(l,[d.sent().toString()]),[4,s(u,a)];case 2:return h=d.sent(),this.loadFromWeightMap(h),[2]}})})},n.prototype.loadFromWeightMap=function(t){var e=this.extractParamsFromWeigthMap(t),r=e.paramMappings,o=e.params;this._paramMappings=r,this._params=o},n.prototype.extractWeights=function(t){var e=this.extractParams(t),r=e.paramMappings,o=e.params;this._paramMappings=r,this._params=o},n.prototype.traversePropertyPath=function(t){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var e=t.split("/").reduce(function(a,i){if(!a.nextObj.hasOwnProperty(i))throw new Error("traversePropertyPath - object does not have property "+i+", for path "+t);return{obj:a.nextObj,objProp:i,nextObj:a.nextObj[i]}},{nextObj:this.params}),r=e.obj,o=e.objProp;if(!r||!o||!(r[o]instanceof Tn))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+t);return{obj:r,objProp:o}},n}();function nft(n,t,e){e===void 0&&(e=!0);var r=Math.max(0,Math.min(n.right,t.right)-Math.max(n.left,t.left)),o=Math.max(0,Math.min(n.bottom,t.bottom)-Math.max(n.top,t.top)),a=r*o;return e?a/(n.area+t.area-a):a/Math.min(n.area,t.area)}function am(n,t,e,r){r===void 0&&(r=!0);for(var o=t.map(function(s,u){return{score:s,boxIndex:u}}).sort(function(s,u){return s.score-u.score}).map(function(s){return s.boxIndex}),a=[],i=function(){var s=o.pop();a.push(s);for(var u=o,l=[],c=0;c<u.length;c++){var h=u[c],d=n[s],p=n[h];l.push(nft(d,p,r))}o=o.filter(function(g,x){return l[x]<=e})};o.length>0;)i();return a}function Gm(n,t){return an(function(){var e=t[0],r=t[1],o=t[2],a=gc(gC(n.shape.slice(0,3),[1]),e),i=gc(gC(n.shape.slice(0,3),[1]),r),s=gc(gC(n.shape.slice(0,3),[1]),o),u=Ha([a,i,s],3);return fi(n,u)})}function tS(n){return 1/(1+Math.exp(-n))}var Wx=function(n){return typeof n=="number"};function rft(n){if(!n)throw new Error("invalid config: "+n);if(typeof n.withSeparableConvs!="boolean")throw new Error("config.withSeparableConvs has to be a boolean, have: "+n.withSeparableConvs);if(!Wx(n.iouThreshold)||n.iouThreshold<0||n.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+n.iouThreshold);if(!Array.isArray(n.classes)||!n.classes.length||!n.classes.every(function(t){return typeof t=="string"}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(n.classes));if(!Array.isArray(n.anchors)||!n.anchors.length||!n.anchors.map(function(t){return t||{}}).every(function(t){return Wx(t.x)&&Wx(t.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(n.anchors));if(n.meanRgb&&(!Array.isArray(n.meanRgb)||n.meanRgb.length!==3||!n.meanRgb.every(Wx)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(n.meanRgb))}function pI(n){return an(function(){var t=Kn(n,ae(.10000000149011612));return qa(s1(fi(n,t)),t)})}function Lu(n,t){return an(function(){var e=au(n,[[0,0],[1,1],[1,1],[0,0]]);return e=Qc(e,t.conv.filters,[1,1],"valid"),e=fi(e,t.bn.sub),e=Kn(e,t.bn.truediv),e=qa(e,t.conv.bias),pI(e)})}function Pu(n,t){return an(function(){var e=au(n,[[0,0],[1,1],[1,1],[0,0]]);return e=HP(e,t.depthwise_filter,t.pointwise_filter,[1,1],"valid"),e=qa(e,t.bias),pI(e)})}function oft(n,t){var e=f1(n,t);function r(i,s){var u=vi(n(i)),l=vi(n(i));return t.push({paramPath:s+"/sub"},{paramPath:s+"/truediv"}),{sub:u,truediv:l}}function o(i,s,u){var l=e(i,s,3,u+"/conv"),c=r(s,u+"/bn");return{conv:l,bn:c}}var a=hI(n,t);return{extractConvParams:e,extractConvWithBatchNormParams:o,extractSeparableConvParams:a}}function aft(n,t,e,r){var o=uu(n),a=o.extractWeights,i=o.getRemainingWeights,s=[],u=oft(a,s),l=u.extractConvParams,c=u.extractConvWithBatchNormParams,h=u.extractSeparableConvParams,d;if(t.withSeparableConvs){var p=r[0],g=r[1],x=r[2],y=r[3],b=r[4],C=r[5],E=r[6],S=r[7],k=r[8],R=t.isFirstLayerConv2d?l(p,g,3,"conv0"):h(p,g,"conv0"),A=h(g,x,"conv1"),N=h(x,y,"conv2"),_=h(y,b,"conv3"),$=h(b,C,"conv4"),D=h(C,E,"conv5"),O=S?h(E,S,"conv6"):void 0,P=k?h(S,k,"conv7"):void 0,z=l(k||S||E,5*e,1,"conv8");d={conv0:R,conv1:A,conv2:N,conv3:_,conv4:$,conv5:D,conv6:O,conv7:P,conv8:z}}else{var p=r[0],g=r[1],x=r[2],y=r[3],b=r[4],C=r[5],E=r[6],S=r[7],k=r[8],R=c(p,g,"conv0"),A=c(g,x,"conv1"),N=c(x,y,"conv2"),_=c(y,b,"conv3"),$=c(b,C,"conv4"),D=c(C,E,"conv5"),O=c(E,S,"conv6"),P=c(S,k,"conv7"),z=l(k,5*e,1,"conv8");d={conv0:R,conv1:A,conv2:N,conv3:_,conv4:$,conv5:D,conv6:O,conv7:P,conv8:z}}if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{params:d,paramMappings:s}}function ift(n,t){var e=yl(n,t);function r(s){var u=e(s+"/sub",1),l=e(s+"/truediv",1);return{sub:u,truediv:l}}function o(s){var u=e(s+"/filters",4),l=e(s+"/bias",1);return{filters:u,bias:l}}function a(s){var u=o(s+"/conv"),l=r(s+"/bn");return{conv:u,bn:l}}var i=fI(e);return{extractConvParams:o,extractConvWithBatchNormParams:a,extractSeparableConvParams:i}}function sft(n,t){var e=[],r=ift(n,e),o=r.extractConvParams,a=r.extractConvWithBatchNormParams,i=r.extractSeparableConvParams,s;if(t.withSeparableConvs){var u=t.filterSizes&&t.filterSizes.length||9;s={conv0:t.isFirstLayerConv2d?o("conv0"):i("conv0"),conv1:i("conv1"),conv2:i("conv2"),conv3:i("conv3"),conv4:i("conv4"),conv5:i("conv5"),conv6:u>7?i("conv6"):void 0,conv7:u>8?i("conv7"):void 0,conv8:o("conv8")}}else s={conv0:a("conv0"),conv1:a("conv1"),conv2:a("conv2"),conv3:a("conv3"),conv4:a("conv4"),conv5:a("conv5"),conv6:a("conv6"),conv7:a("conv7"),conv8:o("conv8")};return su(n,e),{params:s,paramMappings:e}}var a3;(function(n){n[n.XS=224]="XS",n[n.SM=320]="SM",n[n.MD=416]="MD",n[n.LG=608]="LG"})(a3||(a3={}));var mI=function(){function n(t){var e=t===void 0?{}:t,r=e.inputSize,o=e.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=r||416,this._scoreThreshold=o||.5,typeof this._inputSize!="number"||this._inputSize%32!==0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if(typeof this._scoreThreshold!="number"||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(n.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),n}(),AB=function(n){Se(t,n);function t(e){var r=n.call(this,"TinyYolov2")||this;return rft(e),r._config=e,r}return Object.defineProperty(t.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),t.prototype.runTinyYolov2=function(e,r){var o=Lu(e,r.conv0);return o=ua(o,[2,2],[2,2],"same"),o=Lu(o,r.conv1),o=ua(o,[2,2],[2,2],"same"),o=Lu(o,r.conv2),o=ua(o,[2,2],[2,2],"same"),o=Lu(o,r.conv3),o=ua(o,[2,2],[2,2],"same"),o=Lu(o,r.conv4),o=ua(o,[2,2],[2,2],"same"),o=Lu(o,r.conv5),o=ua(o,[2,2],[1,1],"same"),o=Lu(o,r.conv6),o=Lu(o,r.conv7),di(o,r.conv8,"valid",!1)},t.prototype.runMobilenet=function(e,r){var o=this.config.isFirstLayerConv2d?pI(di(e,r.conv0,"valid",!1)):Pu(e,r.conv0);return o=ua(o,[2,2],[2,2],"same"),o=Pu(o,r.conv1),o=ua(o,[2,2],[2,2],"same"),o=Pu(o,r.conv2),o=ua(o,[2,2],[2,2],"same"),o=Pu(o,r.conv3),o=ua(o,[2,2],[2,2],"same"),o=Pu(o,r.conv4),o=ua(o,[2,2],[2,2],"same"),o=Pu(o,r.conv5),o=ua(o,[2,2],[1,1],"same"),o=r.conv6?Pu(o,r.conv6):o,o=r.conv7?Pu(o,r.conv7):o,di(o,r.conv8,"valid",!1)},t.prototype.forwardInput=function(e,r){var o=this,a=this.params;if(!a)throw new Error("TinyYolov2 - load model before inference");return an(function(){var i=e.toBatchTensor(r,!1).toFloat();return i=o.config.meanRgb?Gm(i,o.config.meanRgb):i,i=i.div(ae(256)),o.config.withSeparableConvs?o.runMobilenet(i,a):o.runTinyYolov2(i,a)})},t.prototype.forward=function(e,r){return ie(this,void 0,void 0,function(){var o;return se(this,function(a){switch(a.label){case 0:return o=this.forwardInput,[4,Wr(e)];case 1:return[4,o.apply(this,[a.sent(),r])];case 2:return[2,a.sent()]}})})},t.prototype.detect=function(e,r){return r===void 0&&(r={}),ie(this,void 0,void 0,function(){var o,a,i,s,u,l,c,h,d,p,g,x,y,b,C=this;return se(this,function(E){switch(E.label){case 0:return o=new mI(r),a=o.inputSize,i=o.scoreThreshold,[4,Wr(e)];case 1:return s=E.sent(),[4,this.forwardInput(s,a)];case 2:return u=E.sent(),l=an(function(){return Jy(u)[0].expandDims()}),c={width:s.getInputWidth(0),height:s.getInputHeight(0)},[4,this.extractBoxes(l,s.getReshapedInputDimensions(0),i)];case 3:return h=E.sent(),u.dispose(),l.dispose(),d=h.map(function(S){return S.box}),p=h.map(function(S){return S.score}),g=h.map(function(S){return S.classScore}),x=h.map(function(S){return C.config.classes[S.label]}),y=am(d.map(function(S){return S.rescale(a)}),p,this.config.iouThreshold,!0),b=y.map(function(S){return new xB(p[S],g[S],x[S],d[S],c)}),[2,b]}})})},t.prototype.getDefaultModelName=function(){return""},t.prototype.extractParamsFromWeigthMap=function(e){return sft(e,this.config)},t.prototype.extractParams=function(e){var r=this.config.filterSizes||t.DEFAULT_FILTER_SIZES,o=r?r.length:void 0;if(o!==7&&o!==8&&o!==9)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+o+" filterSizes in config");return aft(e,this.config,this.boxEncodingSize,r)},t.prototype.extractBoxes=function(e,r,o){return ie(this,void 0,void 0,function(){var a,i,s,u,l,c,h,d,p,g,x,y,b,C,E,S,k,R,A,N,_,$,D,O,P,z,W,F,B,U=this;return se(this,function(q){switch(q.label){case 0:return a=r.width,i=r.height,s=Math.max(a,i),u=s/a,l=s/i,c=e.shape[1],h=this.config.anchors.length,d=an(function(){var M=e.reshape([c,c,h,U.boxEncodingSize]),G=M.slice([0,0,0,0],[c,c,h,4]),Q=M.slice([0,0,0,4],[c,c,h,1]),Z=U.withClassScores?r1(M.slice([0,0,0,5],[c,c,h,U.config.classes.length]),3):ae(0);return[G,Q,Z]}),p=d[0],g=d[1],x=d[2],y=[],[4,g.array()];case 1:return b=q.sent(),[4,p.array()];case 2:C=q.sent(),E=0,q.label=3;case 3:if(!(E<c))return[3,12];S=0,q.label=4;case 4:if(!(S<c))return[3,11];k=0,q.label=5;case 5:return k<h?(R=tS(b[E][S][k][0]),!o||R>o?(A=(S+tS(C[E][S][k][0]))/c*u,N=(E+tS(C[E][S][k][1]))/c*l,_=Math.exp(C[E][S][k][2])*this.config.anchors[k].x/c*u,$=Math.exp(C[E][S][k][3])*this.config.anchors[k].y/c*l,D=A-_/2,O=N-$/2,P={row:E,col:S,anchor:k},this.withClassScores?[4,this.extractPredictedClass(x,P)]:[3,7]):[3,9]):[3,10];case 6:return B=q.sent(),[3,8];case 7:B={classScore:1,label:0},q.label=8;case 8:z=B,W=z.classScore,F=z.label,y.push(ci({box:new h1(D,O,D+_,O+$),score:R,classScore:R*W,label:F},P)),q.label=9;case 9:return k++,[3,5];case 10:return S++,[3,4];case 11:return E++,[3,3];case 12:return p.dispose(),g.dispose(),x.dispose(),[2,y]}})})},t.prototype.extractPredictedClass=function(e,r){return ie(this,void 0,void 0,function(){var o,a,i,s;return se(this,function(u){switch(u.label){case 0:return o=r.row,a=r.col,i=r.anchor,[4,e.array()];case 1:return s=u.sent(),[2,Array(this.config.classes.length).fill(0).map(function(l,c){return s[o][a][i][c]}).map(function(l,c){return{classScore:l,label:c}}).reduce(function(l,c){return l.classScore>c.classScore?l:c})]}})})},t.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],t}(lu);function Bu(n,t,e){if(e===void 0&&(e=!1),n.beginPath(),t.slice(1).forEach(function(a,i){var s=a.x,u=a.y,l=t[i];n.moveTo(l.x,l.y),n.lineTo(s,u)}),e){var r=t[t.length-1],o=t[0];if(!r||!o)return;n.moveTo(r.x,r.y),n.lineTo(o.x,o.y)}n.stroke()}var ja=function(n){Se(t,n);function t(e,r,o){return n.call(this,e,e,"",r,o)||this}return t.prototype.forSize=function(e,r){var o=n.prototype.forSize.call(this,e,r),a=o.score,i=o.relativeBox,s=o.imageDims;return new t(a,i,s)},t}(xB);function py(n){return n.detection instanceof ja}function gI(n,t){var e={detection:t};return Object.assign({},n,e)}function uft(n,t){var e=Array.isArray(t)?t:[t];e.forEach(function(r){var o=r instanceof ja?r.score:py(r)?r.detection.score:void 0,a=r instanceof ja?r.box:py(r)?r.detection.box:new ns(r),i=o?""+rI(o):void 0;new kB(a,{label:i}).draw(n)})}function va(n,t,e){return he(function(){var r=K4(n,t.depthwise_filter,t.pointwise_filter,e,"same");return r=on(r,t.bias),r})}function eS(n,t,e){return e===void 0&&(e=!1),he(function(){var r=mr(e?on(nu(n,t.conv0.filters,[2,2],"same"),t.conv0.bias):va(n,t.conv0,[2,2])),o=va(r,t.conv1,[1,1]),a=mr(on(r,o)),i=va(a,t.conv2,[1,1]);return mr(on(r,on(o,i)))})}function Vx(n,t,e,r){return e===void 0&&(e=!1),r===void 0&&(r=!0),he(function(){var o=mr(e?on(nu(n,t.conv0.filters,r?[2,2]:[1,1],"same"),t.conv0.bias):va(n,t.conv0,r?[2,2]:[1,1])),a=va(o,t.conv1,[1,1]),i=mr(on(o,a)),s=va(i,t.conv2,[1,1]),u=mr(on(o,on(a,s))),l=va(u,t.conv3,[1,1]);return mr(on(o,on(a,on(s,l))))})}function _B(n,t){var e=f1(n,t),r=hI(n,t);function o(i,s,u,l){l===void 0&&(l=!1);var c=l?e(i,s,3,u+"/conv0"):r(i,s,u+"/conv0"),h=r(s,s,u+"/conv1"),d=r(s,s,u+"/conv2");return{conv0:c,conv1:h,conv2:d}}function a(i,s,u,l){l===void 0&&(l=!1);var c=o(i,s,u,l),h=c.conv0,d=c.conv1,p=c.conv2,g=r(s,s,u+"/conv3");return{conv0:h,conv1:d,conv2:p,conv3:g}}return{extractDenseBlock3Params:o,extractDenseBlock4Params:a}}function lft(n){var t=[],e=uu(n),r=e.extractWeights,o=e.getRemainingWeights,a=_B(r,t).extractDenseBlock4Params,i=a(3,32,"dense0",!0),s=a(32,64,"dense1"),u=a(64,128,"dense2"),l=a(128,256,"dense3");if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:t,params:{dense0:i,dense1:s,dense2:u,dense3:l}}}function DB(n){return function(t){var e=n(t+"/filters",4),r=n(t+"/bias",1);return{filters:e,bias:r}}}function $B(n,t){var e=yl(n,t),r=DB(e),o=fI(e);function a(s,u){u===void 0&&(u=!1);var l=u?r(s+"/conv0"):o(s+"/conv0"),c=o(s+"/conv1"),h=o(s+"/conv2");return{conv0:l,conv1:c,conv2:h}}function i(s,u){u===void 0&&(u=!1);var l=u?r(s+"/conv0"):o(s+"/conv0"),c=o(s+"/conv1"),h=o(s+"/conv2"),d=o(s+"/conv3");return{conv0:l,conv1:c,conv2:h,conv3:d}}return{extractDenseBlock3Params:a,extractDenseBlock4Params:i}}function cft(n){var t=[],e=$B(n,t).extractDenseBlock4Params,r={dense0:e("dense0",!0),dense1:e("dense1"),dense2:e("dense2"),dense3:e("dense3")};return su(n,t),{params:r,paramMappings:t}}var OB=function(n){Se(t,n);function t(){return n.call(this,"FaceFeatureExtractor")||this}return t.prototype.forwardInput=function(e){var r=this.params;if(!r)throw new Error("FaceFeatureExtractor - load model before inference");return he(function(){var o=e.toBatchTensor(112,!0),a=[122.782,117.001,104.298],i=Gm(o,a).div(zt(255)),s=Vx(i,r.dense0,!0);return s=Vx(s,r.dense1),s=Vx(s,r.dense2),s=Vx(s,r.dense3),s=Mm(s,[7,7],[2,2],"valid"),s})},t.prototype.forward=function(e){return ie(this,void 0,void 0,function(){var r;return se(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,Wr(e)];case 1:return[2,r.apply(this,[o.sent()])]}})})},t.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},t.prototype.extractParamsFromWeigthMap=function(e){return cft(e)},t.prototype.extractParams=function(e){return lft(e)},t}(lu);function qi(n,t){return he(function(){return on(kk(n,t.weights),t.bias)})}function hft(n,t,e){var r=[],o=uu(n),a=o.extractWeights,i=o.getRemainingWeights,s=cI(a,r),u=s(t,e,"fc");if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:r,params:{fc:u}}}function fft(n){var t=[],e=yl(n,t);function r(a){var i=e(a+"/weights",2),s=e(a+"/bias",1);return{weights:i,bias:s}}var o={fc:r("fc")};return su(n,t),{params:o,paramMappings:t}}function FB(n){var t={},e={};return Object.keys(n).forEach(function(r){var o=r.startsWith("fc")?e:t;o[r]=n[r]}),{featureExtractorMap:t,classifierMap:e}}var MB=function(n){Se(t,n);function t(e,r){var o=n.call(this,e)||this;return o._faceFeatureExtractor=r,o}return Object.defineProperty(t.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),t.prototype.runNet=function(e){var r=this,o=this.params;if(!o)throw new Error(this._name+" - load model before inference");return he(function(){var a=e instanceof dy?r.faceFeatureExtractor.forwardInput(e):e;return qi(a.as2D(a.shape[0],-1),o.fc)})},t.prototype.dispose=function(e){e===void 0&&(e=!0),this.faceFeatureExtractor.dispose(e),n.prototype.dispose.call(this,e)},t.prototype.loadClassifierParams=function(e){var r=this.extractClassifierParams(e),o=r.params,a=r.paramMappings;this._params=o,this._paramMappings=a},t.prototype.extractClassifierParams=function(e){return hft(e,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},t.prototype.extractParamsFromWeigthMap=function(e){var r=FB(e),o=r.featureExtractorMap,a=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(o),fft(a)},t.prototype.extractParams=function(e){var r=this.getClassifierChannelsIn(),o=this.getClassifierChannelsOut(),a=o*r+o,i=e.slice(0,e.length-a),s=e.slice(e.length-a);return this.faceFeatureExtractor.extractWeights(i),this.extractClassifierParams(s)},t}(lu),i3=["neutral","happy","sad","angry","fearful","disgusted","surprised"],vI=function(){function n(t){var e=this;if(t.length!==7)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+t.length);i3.forEach(function(r,o){e[r]=t[o]})}return n.prototype.asSortedArray=function(){var t=this;return i3.map(function(e){return{expression:e,probability:t[e]}}).sort(function(e,r){return r.probability-e.probability})},n}(),dft=function(n){Se(t,n);function t(e){return e===void 0&&(e=new OB),n.call(this,"FaceExpressionNet",e)||this}return t.prototype.forwardInput=function(e){var r=this;return he(function(){return ml(r.runNet(e))})},t.prototype.forward=function(e){return ie(this,void 0,void 0,function(){var r;return se(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,Wr(e)];case 1:return[2,r.apply(this,[o.sent()])]}})})},t.prototype.predictExpressions=function(e){return ie(this,void 0,void 0,function(){var r,o,a,i,s=this;return se(this,function(u){switch(u.label){case 0:return[4,Wr(e)];case 1:return r=u.sent(),[4,this.forwardInput(r)];case 2:return o=u.sent(),[4,Promise.all(Zr(o).map(function(l){return ie(s,void 0,void 0,function(){var c;return se(this,function(h){switch(h.label){case 0:return[4,l.data()];case 1:return c=h.sent(),l.dispose(),[2,c]}})})}))];case 3:return a=u.sent(),o.dispose(),i=a.map(function(l){return new vI(l)}),[2,r.isBatchInput?i:i[0]]}})})},t.prototype.getDefaultModelName=function(){return"face_expression_model"},t.prototype.getClassifierChannelsIn=function(){return 256},t.prototype.getClassifierChannelsOut=function(){return 7},t}(MB);function pft(n){return n.expressions instanceof vI}function LB(n,t){var e={expressions:t};return Object.assign({},n,e)}function mft(n,t,e,r){e===void 0&&(e=.1);var o=Array.isArray(t)?t:[t];o.forEach(function(a){var i=a instanceof vI?a:pft(a)?a.expressions:void 0;if(!i)throw new Error("drawFaceExpressions - expected faceExpressions to be FaceExpressions | WithFaceExpressions<{}> or array thereof");var s=i.asSortedArray(),u=s.filter(function(h){return h.probability>e}),l=py(a)?a.detection.box.bottomLeft:r||new Ze(0,0),c=new lI(u.map(function(h){return h.expression+" ("+rI(h.probability)+")"}),l);c.draw(n)})}function gft(n){var t=n.map(function(s){return s.x}),e=n.map(function(s){return s.y}),r=t.reduce(function(s,u){return u<s?u:s},1/0),o=e.reduce(function(s,u){return u<s?u:s},1/0),a=t.reduce(function(s,u){return s<u?u:s},0),i=e.reduce(function(s,u){return s<u?u:s},0);return new h1(r,o,a,i)}var vft=.5,xft=.43,yft=.45,im=function(){function n(t,e,r){r===void 0&&(r=new Ze(0,0));var o=e.width,a=e.height;this._imgDims=new Sf(o,a),this._shift=r,this._positions=t.map(function(i){return i.mul(new Ze(o,a)).add(r)})}return Object.defineProperty(n.prototype,"shift",{get:function(){return new Ze(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"relativePositions",{get:function(){var t=this;return this._positions.map(function(e){return e.sub(t._shift).div(new Ze(t.imageWidth,t.imageHeight))})},enumerable:!0,configurable:!0}),n.prototype.forSize=function(t,e){return new this.constructor(this.relativePositions,{width:t,height:e})},n.prototype.shiftBy=function(t,e){return new this.constructor(this.relativePositions,this._imgDims,new Ze(t,e))},n.prototype.shiftByPoint=function(t){return this.shiftBy(t.x,t.y)},n.prototype.align=function(t,e){if(e===void 0&&(e={}),t){var r=t instanceof ja?t.box.floor():new ns(t);return this.shiftBy(r.x,r.y).align(null,e)}var o=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},e),a=o.useDlibAlignment,i=o.minBoxPadding;return a?this.alignDlib():this.alignMinBbox(i)},n.prototype.alignDlib=function(){var t=this.getRefPointsForAlignment(),e=t[0],r=t[1],o=t[2],a=function(h){return o.sub(h).magnitude()},i=(a(e)+a(r))/2,s=Math.floor(i/yft),u=oI(t),l=Math.floor(Math.max(0,u.x-vft*s)),c=Math.floor(Math.max(0,u.y-xft*s));return new aI(l,c,Math.min(s,this.imageWidth+l),Math.min(s,this.imageHeight+c))},n.prototype.alignMinBbox=function(t){var e=gft(this.positions);return e.pad(e.width*t,e.height*t)},n.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},n}(),PB=function(n){Se(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.getJawOutline=function(){return this.positions.slice(0,17)},t.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},t.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},t.prototype.getNose=function(){return this.positions.slice(27,36)},t.prototype.getLeftEye=function(){return this.positions.slice(36,42)},t.prototype.getRightEye=function(){return this.positions.slice(42,48)},t.prototype.getMouth=function(){return this.positions.slice(48,68)},t.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(oI)},t}(im);function BB(n){return py(n)&&n.landmarks instanceof im&&n.unshiftedLandmarks instanceof im&&n.alignedRect instanceof ja}function xI(n,t){var e=n.detection.box,r=t.shiftBy(e.x,e.y),o=r.align(),a=n.detection.imageDims,i=new ja(n.detection.score,o.rescale(a.reverse()),a),s={landmarks:r,unshiftedLandmarks:t,alignedRect:i};return Object.assign({},n,s)}var zB=function(){function n(t){t===void 0&&(t={});var e=t.drawLines,r=e===void 0?!0:e,o=t.drawPoints,a=o===void 0?!0:o,i=t.lineWidth,s=t.lineColor,u=t.pointSize,l=t.pointColor;this.drawLines=r,this.drawPoints=a,this.lineWidth=i||1,this.pointSize=u||2,this.lineColor=s||"rgba(0, 255, 255, 1)",this.pointColor=l||"rgba(255, 0, 255, 1)"}return n}(),UB=function(){function n(t,e){e===void 0&&(e={}),this.faceLandmarks=t,this.options=new zB(e)}return n.prototype.draw=function(t){var e=rs(t),r=this.options,o=r.drawLines,a=r.drawPoints,i=r.lineWidth,s=r.lineColor,u=r.pointSize,l=r.pointColor;if(o&&this.faceLandmarks instanceof PB&&(e.strokeStyle=s,e.lineWidth=i,Bu(e,this.faceLandmarks.getJawOutline()),Bu(e,this.faceLandmarks.getLeftEyeBrow()),Bu(e,this.faceLandmarks.getRightEyeBrow()),Bu(e,this.faceLandmarks.getNose()),Bu(e,this.faceLandmarks.getLeftEye(),!0),Bu(e,this.faceLandmarks.getRightEye(),!0),Bu(e,this.faceLandmarks.getMouth(),!0)),a){e.strokeStyle=l,e.fillStyle=l;var c=function(h){e.beginPath(),e.arc(h.x,h.y,u,0,2*Math.PI),e.fill()};this.faceLandmarks.positions.forEach(c)}},n}();function bft(n,t){var e=Array.isArray(t)?t:[t];e.forEach(function(r){var o=r instanceof im?r:BB(r)?r.landmarks:void 0;if(!o)throw new Error("drawFaceLandmarks - expected faceExpressions to be FaceLandmarks | WithFaceLandmarks<WithFaceDetection<{}>> or array thereof");new UB(o).draw(n)})}const wft=Object.freeze(Object.defineProperty({__proto__:null,DrawFaceLandmarks:UB,DrawFaceLandmarksOptions:zB,drawContour:Bu,drawDetections:uft,drawFaceExpressions:mft,drawFaceLandmarks:bft},Symbol.toStringTag,{value:"Module"}));function Cft(n,t){var e=f1(n,t),r=hI(n,t);function o(i,s,u){var l=r(i,s,u+"/separable_conv0"),c=r(s,s,u+"/separable_conv1"),h=e(i,s,1,u+"/expansion_conv");return{separable_conv0:l,separable_conv1:c,expansion_conv:h}}function a(i,s){var u=r(i,i,s+"/separable_conv0"),l=r(i,i,s+"/separable_conv1"),c=r(i,i,s+"/separable_conv2");return{separable_conv0:u,separable_conv1:l,separable_conv2:c}}return{extractConvParams:e,extractSeparableConvParams:r,extractReductionBlockParams:o,extractMainBlockParams:a}}function Sft(n,t){var e=[],r=uu(n),o=r.extractWeights,a=r.getRemainingWeights,i=Cft(o,e),s=i.extractConvParams,u=i.extractSeparableConvParams,l=i.extractReductionBlockParams,c=i.extractMainBlockParams,h=s(3,32,3,"entry_flow/conv_in"),d=l(32,64,"entry_flow/reduction_block_0"),p=l(64,128,"entry_flow/reduction_block_1"),g={conv_in:h,reduction_block_0:d,reduction_block_1:p},x={};om(t,0,1).forEach(function(E){x["main_block_"+E]=c(128,"middle_flow/main_block_"+E)});var y=l(128,256,"exit_flow/reduction_block"),b=u(256,512,"exit_flow/separable_conv"),C={reduction_block:y,separable_conv:b};if(a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:e,params:{entry_flow:g,middle_flow:x,exit_flow:C}}}function Eft(n,t){var e=yl(n,t),r=DB(e),o=fI(e);function a(s){var u=o(s+"/separable_conv0"),l=o(s+"/separable_conv1"),c=r(s+"/expansion_conv");return{separable_conv0:u,separable_conv1:l,expansion_conv:c}}function i(s){var u=o(s+"/separable_conv0"),l=o(s+"/separable_conv1"),c=o(s+"/separable_conv2");return{separable_conv0:u,separable_conv1:l,separable_conv2:c}}return{extractConvParams:r,extractSeparableConvParams:o,extractReductionBlockParams:a,extractMainBlockParams:i}}function kft(n,t){var e=[],r=Eft(n,e),o=r.extractConvParams,a=r.extractSeparableConvParams,i=r.extractReductionBlockParams,s=r.extractMainBlockParams,u=o("entry_flow/conv_in"),l=i("entry_flow/reduction_block_0"),c=i("entry_flow/reduction_block_1"),h={conv_in:u,reduction_block_0:l,reduction_block_1:c},d={};om(t,0,1).forEach(function(y){d["main_block_"+y]=s("middle_flow/main_block_"+y)});var p=i("exit_flow/reduction_block"),g=a("exit_flow/separable_conv"),x={reduction_block:p,separable_conv:g};return su(n,e),{params:{entry_flow:h,middle_flow:d,exit_flow:x},paramMappings:e}}function WB(n,t,e){return on(nu(n,t.filters,e,"same"),t.bias)}function nS(n,t,e){e===void 0&&(e=!0);var r=e?mr(n):n;return r=va(r,t.separable_conv0,[1,1]),r=va(mr(r),t.separable_conv1,[1,1]),r=$f(r,[3,3],[2,2],"same"),r=on(r,WB(n,t.expansion_conv,[2,2])),r}function Ift(n,t){var e=va(mr(n),t.separable_conv0,[1,1]);return e=va(mr(e),t.separable_conv1,[1,1]),e=va(mr(e),t.separable_conv2,[1,1]),e=on(e,n),e}var Rft=function(n){Se(t,n);function t(e){var r=n.call(this,"TinyXception")||this;return r._numMainBlocks=e,r}return t.prototype.forwardInput=function(e){var r=this,o=this.params;if(!o)throw new Error("TinyXception - load model before inference");return he(function(){var a=e.toBatchTensor(112,!0),i=[122.782,117.001,104.298],s=Gm(a,i).div(zt(256)),u=mr(WB(s,o.entry_flow.conv_in,[2,2]));return u=nS(u,o.entry_flow.reduction_block_0,!1),u=nS(u,o.entry_flow.reduction_block_1),om(r._numMainBlocks,0,1).forEach(function(l){u=Ift(u,o.middle_flow["main_block_"+l])}),u=nS(u,o.exit_flow.reduction_block),u=mr(va(u,o.exit_flow.separable_conv,[1,1])),u})},t.prototype.forward=function(e){return ie(this,void 0,void 0,function(){var r;return se(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,Wr(e)];case 1:return[2,r.apply(this,[o.sent()])]}})})},t.prototype.getDefaultModelName=function(){return"tiny_xception_model"},t.prototype.extractParamsFromWeigthMap=function(e){return kft(e,this._numMainBlocks)},t.prototype.extractParams=function(e){return Sft(e,this._numMainBlocks)},t}(lu);function Tft(n){var t=[],e=uu(n),r=e.extractWeights,o=e.getRemainingWeights,a=cI(r,t),i=a(512,1,"fc/age"),s=a(512,2,"fc/gender");if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:t,params:{fc:{age:i,gender:s}}}}function Nft(n){var t=[],e=yl(n,t);function r(a){var i=e(a+"/weights",2),s=e(a+"/bias",1);return{weights:i,bias:s}}var o={fc:{age:r("fc/age"),gender:r("fc/gender")}};return su(n,t),{params:o,paramMappings:t}}var my;(function(n){n.FEMALE="female",n.MALE="male"})(my||(my={}));var Aft=function(n){Se(t,n);function t(e){e===void 0&&(e=new Rft(2));var r=n.call(this,"AgeGenderNet")||this;return r._faceFeatureExtractor=e,r}return Object.defineProperty(t.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),t.prototype.runNet=function(e){var r=this,o=this.params;if(!o)throw new Error(this._name+" - load model before inference");return he(function(){var a=e instanceof dy?r.faceFeatureExtractor.forwardInput(e):e,i=Mm(a,[7,7],[2,2],"valid").as2D(a.shape[0],-1),s=qi(i,o.fc.age).as1D(),u=qi(i,o.fc.gender);return{age:s,gender:u}})},t.prototype.forwardInput=function(e){var r=this;return he(function(){var o=r.runNet(e),a=o.age,i=o.gender;return{age:a,gender:ml(i)}})},t.prototype.forward=function(e){return ie(this,void 0,void 0,function(){var r;return se(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,Wr(e)];case 1:return[2,r.apply(this,[o.sent()])]}})})},t.prototype.predictAgeAndGender=function(e){return ie(this,void 0,void 0,function(){var r,o,a,i,s,u,l=this;return se(this,function(c){switch(c.label){case 0:return[4,Wr(e)];case 1:return r=c.sent(),[4,this.forwardInput(r)];case 2:return o=c.sent(),a=Zr(o.age),i=Zr(o.gender),s=a.map(function(h,d){return{ageTensor:h,genderTensor:i[d]}}),[4,Promise.all(s.map(function(h){var d=h.ageTensor,p=h.genderTensor;return ie(l,void 0,void 0,function(){var g,x,y,b,C;return se(this,function(E){switch(E.label){case 0:return[4,d.data()];case 1:return g=E.sent()[0],[4,p.data()];case 2:return x=E.sent()[0],y=x>.5,b=y?my.MALE:my.FEMALE,C=y?x:1-x,d.dispose(),p.dispose(),[2,{age:g,gender:b,genderProbability:C}]}})})}))];case 3:return u=c.sent(),o.age.dispose(),o.gender.dispose(),[2,r.isBatchInput?u:u[0]]}})})},t.prototype.getDefaultModelName=function(){return"age_gender_model"},t.prototype.dispose=function(e){e===void 0&&(e=!0),this.faceFeatureExtractor.dispose(e),n.prototype.dispose.call(this,e)},t.prototype.loadClassifierParams=function(e){var r=this.extractClassifierParams(e),o=r.params,a=r.paramMappings;this._params=o,this._paramMappings=a},t.prototype.extractClassifierParams=function(e){return Tft(e)},t.prototype.extractParamsFromWeigthMap=function(e){var r=FB(e),o=r.featureExtractorMap,a=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(o),Nft(a)},t.prototype.extractParams=function(e){var r=1539,o=e.slice(0,e.length-r),a=e.slice(e.length-r);return this.faceFeatureExtractor.extractWeights(o),this.extractClassifierParams(a)},t}(lu),_ft=function(n){Se(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.getRefPointsForAlignment=function(){var e=this.positions;return[e[0],e[1],oI([e[3],e[4]])]},t}(im),s3=function(){function n(t,e){this._label=t,this._distance=e}return Object.defineProperty(n.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),n.prototype.toString=function(t){return t===void 0&&(t=!0),""+this.label+(t?" ("+rI(this.distance)+")":"")},n}(),rS=function(){function n(t,e){if(typeof t!="string")throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(e)||e.some(function(r){return!(r instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=t,this._descriptors=e}return Object.defineProperty(n.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),n}();function yI(n,t){return ie(this,void 0,void 0,function(){var e,r,o,a,i,s,u;return se(this,function(l){switch(l.label){case 0:return e=wo.getEnv().Canvas,r=n,n instanceof e?[3,5]:[4,Wr(n)];case 1:if(o=l.sent(),o.batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return a=o.getInput(0),a instanceof e?(i=a,[3,4]):[3,2];case 2:return[4,Zht(a)];case 3:i=l.sent(),l.label=4;case 4:r=i,l.label=5;case 5:return s=rs(r),u=t.map(function(c){return c instanceof ja?c.forSize(r.width,r.height).box.floor():c}).map(function(c){return c.clipAtImageBorders(r.width,r.height)}),[2,u.map(function(c){var h=c.x,d=c.y,p=c.width,g=c.height,x=d1({width:p,height:g});return rs(x).putImageData(s.getImageData(h,d,p,g),0,0),x})]}})})}function bI(n,t){return ie(this,void 0,void 0,function(){return se(this,function(e){if(!c1(n)&&!Qu(n))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(Qu(n)&&n.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,he(function(){var r=n.shape.slice(Qu(n)?1:0),o=r[0],a=r[1],i=r[2],s=t.map(function(l){return l instanceof ja?l.forSize(a,o).box:l}).map(function(l){return l.clipAtImageBorders(a,o)}),u=s.map(function(l){var c=l.x,h=l.y,d=l.width,p=l.height;return Z4(n.as3D(o,a,i),[h,c,0],[p,d,i])});return u})]})})}var VB=function(n){Se(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.postProcess=function(e,r,o){var a=o.map(function(s){var u=s.width,l=s.height,c=r/Math.max(l,u);return{width:u*c,height:l*c}}),i=a.length;return he(function(){var s=function(d,p){return hi([jp([68],d),jp([68],p)],1).as2D(1,136).as1D()},u=function(d,p){var g=a[d],x=g.width,y=g.height;return p(x,y)?Math.abs(x-y)/2:0},l=function(d){return u(d,function(p,g){return p<g})},c=function(d){return u(d,function(p,g){return g<p})},h=e.mul(jp([i,136],r)).sub(hi(Array.from(Array(i),function(d,p){return s(l(p),c(p))}))).div(hi(Array.from(Array(i),function(d,p){return s(a[p].width,a[p].height)})));return h})},t.prototype.forwardInput=function(e){var r=this;return he(function(){var o=r.runNet(e);return r.postProcess(o,e.inputSize,e.inputDimensions.map(function(a){var i=a[0],s=a[1];return{height:i,width:s}}))})},t.prototype.forward=function(e){return ie(this,void 0,void 0,function(){var r;return se(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,Wr(e)];case 1:return[2,r.apply(this,[o.sent()])]}})})},t.prototype.detectLandmarks=function(e){return ie(this,void 0,void 0,function(){var r,o,a,i=this;return se(this,function(s){switch(s.label){case 0:return[4,Wr(e)];case 1:return r=s.sent(),o=he(function(){return Zr(i.forwardInput(r))}),[4,Promise.all(o.map(function(u,l){return ie(i,void 0,void 0,function(){var c,h,d,p,g;return se(this,function(x){switch(x.label){case 0:return d=(h=Array).from,[4,u.data()];case 1:return c=d.apply(h,[x.sent()]),p=c.filter(function(y,b){return t3(b)}),g=c.filter(function(y,b){return!t3(b)}),[2,new PB(Array(68).fill(0).map(function(y,b){return new Ze(p[b],g[b])}),{height:r.getInputHeight(l),width:r.getInputWidth(l)})]}})})}))];case 2:return a=s.sent(),o.forEach(function(u){return u.dispose()}),[2,r.isBatchInput?a:a[0]]}})})},t.prototype.getClassifierChannelsOut=function(){return 136},t}(MB),GB=function(n){Se(t,n);function t(e){return e===void 0&&(e=new OB),n.call(this,"FaceLandmark68Net",e)||this}return t.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},t.prototype.getClassifierChannelsIn=function(){return 256},t}(VB);function Dft(n){var t=[],e=$B(n,t).extractDenseBlock3Params,r={dense0:e("dense0",!0),dense1:e("dense1"),dense2:e("dense2")};return su(n,t),{params:r,paramMappings:t}}function $ft(n){var t=[],e=uu(n),r=e.extractWeights,o=e.getRemainingWeights,a=_B(r,t).extractDenseBlock3Params,i=a(3,32,"dense0",!0),s=a(32,64,"dense1"),u=a(64,128,"dense2");if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:t,params:{dense0:i,dense1:s,dense2:u}}}var Oft=function(n){Se(t,n);function t(){return n.call(this,"TinyFaceFeatureExtractor")||this}return t.prototype.forwardInput=function(e){var r=this.params;if(!r)throw new Error("TinyFaceFeatureExtractor - load model before inference");return he(function(){var o=e.toBatchTensor(112,!0),a=[122.782,117.001,104.298],i=Gm(o,a).div(zt(255)),s=eS(i,r.dense0,!0);return s=eS(s,r.dense1),s=eS(s,r.dense2),s=Mm(s,[14,14],[2,2],"valid"),s})},t.prototype.forward=function(e){return ie(this,void 0,void 0,function(){var r;return se(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,Wr(e)];case 1:return[2,r.apply(this,[o.sent()])]}})})},t.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},t.prototype.extractParamsFromWeigthMap=function(e){return Dft(e)},t.prototype.extractParams=function(e){return $ft(e)},t}(lu),Fft=function(n){Se(t,n);function t(e){return e===void 0&&(e=new Oft),n.call(this,"FaceLandmark68TinyNet",e)||this}return t.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},t.prototype.getClassifierChannelsIn=function(){return 128},t}(VB);(function(n){Se(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t})(GB);function Mft(n,t){return on(Ws(n,t.weights),t.biases)}function wI(n,t,e,r,o){o===void 0&&(o="same");var a=t.conv,i=a.filters,s=a.bias,u=nu(n,i,e,o);return u=on(u,s),u=Mft(u,t.scale),r?mr(u):u}function Lft(n,t){return wI(n,t,[1,1],!0)}function HB(n,t){return wI(n,t,[1,1],!1)}function qB(n,t){return wI(n,t,[2,2],!0,"valid")}function Pft(n,t){function e(s,u,l){var c=n(s),h=c.length/(u*l*l);if(Ght(h))throw new Error("depth has to be an integer: "+h+", weights.length: "+c.length+", numFilters: "+u+", filterSize: "+l);return he(function(){return rl(oi(c,[u,h,l,l]),[2,3,1,0])})}function r(s,u,l,c){var h=e(s,u,l),d=fa(n(u));return t.push({paramPath:c+"/filters"},{paramPath:c+"/bias"}),{filters:h,bias:d}}function o(s,u){var l=fa(n(s)),c=fa(n(s));return t.push({paramPath:u+"/weights"},{paramPath:u+"/biases"}),{weights:l,biases:c}}function a(s,u,l,c){var h=r(s,u,l,c+"/conv"),d=o(u,c+"/scale");return{conv:h,scale:d}}function i(s,u,l,c,h){h===void 0&&(h=!1);var d=a((h?.5:1)*s,u,l,c+"/conv1"),p=a(s,u,l,c+"/conv2");return{conv1:d,conv2:p}}return{extractConvLayerParams:a,extractResidualLayerParams:i}}function Bft(n){var t=uu(n),e=t.extractWeights,r=t.getRemainingWeights,o=[],a=Pft(e,o),i=a.extractConvLayerParams,s=a.extractResidualLayerParams,u=i(4704,32,7,"conv32_down"),l=s(9216,32,3,"conv32_1"),c=s(9216,32,3,"conv32_2"),h=s(9216,32,3,"conv32_3"),d=s(36864,64,3,"conv64_down",!0),p=s(36864,64,3,"conv64_1"),g=s(36864,64,3,"conv64_2"),x=s(36864,64,3,"conv64_3"),y=s(147456,128,3,"conv128_down",!0),b=s(147456,128,3,"conv128_1"),C=s(147456,128,3,"conv128_2"),E=s(589824,256,3,"conv256_down",!0),S=s(589824,256,3,"conv256_1"),k=s(589824,256,3,"conv256_2"),R=s(589824,256,3,"conv256_down_out"),A=he(function(){return rl(Xy(e(256*128),[128,256]),[1,0])});if(o.push({paramPath:"fc"}),r().length!==0)throw new Error("weights remaing after extract: "+r().length);var N={conv32_down:u,conv32_1:l,conv32_2:c,conv32_3:h,conv64_down:d,conv64_1:p,conv64_2:g,conv64_3:x,conv128_down:y,conv128_1:b,conv128_2:C,conv256_down:E,conv256_1:S,conv256_2:k,conv256_down_out:R,fc:A};return{params:N,paramMappings:o}}function zft(n,t){var e=yl(n,t);function r(i){var s=e(i+"/scale/weights",1),u=e(i+"/scale/biases",1);return{weights:s,biases:u}}function o(i){var s=e(i+"/conv/filters",4),u=e(i+"/conv/bias",1),l=r(i);return{conv:{filters:s,bias:u},scale:l}}function a(i){return{conv1:o(i+"/conv1"),conv2:o(i+"/conv2")}}return{extractConvLayerParams:o,extractResidualLayerParams:a}}function Uft(n){var t=[],e=zft(n,t),r=e.extractConvLayerParams,o=e.extractResidualLayerParams,a=r("conv32_down"),i=o("conv32_1"),s=o("conv32_2"),u=o("conv32_3"),l=o("conv64_down"),c=o("conv64_1"),h=o("conv64_2"),d=o("conv64_3"),p=o("conv128_down"),g=o("conv128_1"),x=o("conv128_2"),y=o("conv256_down"),b=o("conv256_1"),C=o("conv256_2"),E=o("conv256_down_out"),S=n.fc;if(t.push({originalPath:"fc",paramPath:"fc"}),!Vht(S))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+S);var k={conv32_down:a,conv32_1:i,conv32_2:s,conv32_3:u,conv64_down:l,conv64_1:c,conv64_2:h,conv64_3:d,conv128_down:p,conv128_1:g,conv128_2:x,conv256_down:y,conv256_1:b,conv256_2:C,conv256_down_out:E,fc:S};return su(n,t),{params:k,paramMappings:t}}function _i(n,t){var e=Lft(n,t.conv1);return e=HB(e,t.conv2),e=on(e,n),e=mr(e),e}function Gx(n,t){var e=qB(n,t.conv1);e=HB(e,t.conv2);var r=Mm(n,2,2,"valid"),o=ir(r.shape),a=r.shape[3]!==e.shape[3],i=r.shape[1]!==e.shape[1]||r.shape[2]!==e.shape[2];if(i){var s=e.shape.slice();s[1]=1;var u=ir(s);e=Ho([e,u],1);var l=e.shape.slice();l[2]=1;var c=ir(l);e=Ho([e,c],2)}return r=a?Ho([r,o],3):r,e=on(r,e),e=mr(e),e}var Wft=function(n){Se(t,n);function t(){return n.call(this,"FaceRecognitionNet")||this}return t.prototype.forwardInput=function(e){var r=this.params;if(!r)throw new Error("FaceRecognitionNet - load model before inference");return he(function(){var o=e.toBatchTensor(150,!0).toFloat(),a=[122.782,117.001,104.298],i=Gm(o,a).div(zt(256)),s=qB(i,r.conv32_down);s=$f(s,3,2,"valid"),s=_i(s,r.conv32_1),s=_i(s,r.conv32_2),s=_i(s,r.conv32_3),s=Gx(s,r.conv64_down),s=_i(s,r.conv64_1),s=_i(s,r.conv64_2),s=_i(s,r.conv64_3),s=Gx(s,r.conv128_down),s=_i(s,r.conv128_1),s=_i(s,r.conv128_2),s=Gx(s,r.conv256_down),s=_i(s,r.conv256_1),s=_i(s,r.conv256_2),s=Gx(s,r.conv256_down_out);var u=s.mean([1,2]),l=kk(u,r.fc);return l})},t.prototype.forward=function(e){return ie(this,void 0,void 0,function(){var r;return se(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,Wr(e)];case 1:return[2,r.apply(this,[o.sent()])]}})})},t.prototype.computeFaceDescriptor=function(e){return ie(this,void 0,void 0,function(){var r,o,a,i=this;return se(this,function(s){switch(s.label){case 0:return[4,Wr(e)];case 1:return r=s.sent(),o=he(function(){return Zr(i.forwardInput(r))}),[4,Promise.all(o.map(function(u){return u.data()}))];case 2:return a=s.sent(),o.forEach(function(u){return u.dispose()}),[2,r.isBatchInput?a:a[0]]}})})},t.prototype.getDefaultModelName=function(){return"face_recognition_model"},t.prototype.extractParamsFromWeigthMap=function(e){return Uft(e)},t.prototype.extractParams=function(e){return Bft(e)},t}(lu);function jB(n,t){var e={descriptor:t};return Object.assign({},n,e)}var XB=function(){function n(t){var e=t===void 0?{}:t,r=e.minFaceSize,o=e.scaleFactor,a=e.maxNumScales,i=e.scoreThresholds,s=e.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=r||20,this._scaleFactor=o||.709,this._maxNumScales=a||10,this._scoreThresholds=i||[.6,.7,.7],this._scaleSteps=s,typeof this._minFaceSize!="number"||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if(typeof this._scaleFactor!="number"||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if(typeof this._maxNumScales!="number"||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||this._scoreThresholds.length!==3||this._scoreThresholds.some(function(u){return typeof u!="number"}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(u){return typeof u!="number"})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(n.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),n}();function Vft(n,t){function e(u,l){var c=oi(n(9*u),[3,3,u,1]),h=fa(n(u)),d=fa(n(u)),p=fa(n(u)),g=fa(n(u));return t.push({paramPath:l+"/filters"},{paramPath:l+"/batch_norm_scale"},{paramPath:l+"/batch_norm_offset"},{paramPath:l+"/batch_norm_mean"},{paramPath:l+"/batch_norm_variance"}),{filters:c,batch_norm_scale:h,batch_norm_offset:d,batch_norm_mean:p,batch_norm_variance:g}}function r(u,l,c,h,d){var p=oi(n(u*l*c*c),[c,c,u,l]),g=fa(n(l));return t.push({paramPath:h+"/filters"},{paramPath:h+"/"+(d?"batch_norm_offset":"bias")}),{filters:p,bias:g}}function o(u,l,c,h){var d=r(u,l,c,h,!0),p=d.filters,g=d.bias;return{filters:p,batch_norm_offset:g}}function a(u,l,c){var h=e(u,c+"/depthwise_conv"),d=o(u,l,1,c+"/pointwise_conv");return{depthwise_conv:h,pointwise_conv:d}}function i(){var u=o(3,32,3,"mobilenetv1/conv_0"),l=a(32,64,"mobilenetv1/conv_1"),c=a(64,128,"mobilenetv1/conv_2"),h=a(128,128,"mobilenetv1/conv_3"),d=a(128,256,"mobilenetv1/conv_4"),p=a(256,256,"mobilenetv1/conv_5"),g=a(256,512,"mobilenetv1/conv_6"),x=a(512,512,"mobilenetv1/conv_7"),y=a(512,512,"mobilenetv1/conv_8"),b=a(512,512,"mobilenetv1/conv_9"),C=a(512,512,"mobilenetv1/conv_10"),E=a(512,512,"mobilenetv1/conv_11"),S=a(512,1024,"mobilenetv1/conv_12"),k=a(1024,1024,"mobilenetv1/conv_13");return{conv_0:u,conv_1:l,conv_2:c,conv_3:h,conv_4:d,conv_5:p,conv_6:g,conv_7:x,conv_8:y,conv_9:b,conv_10:C,conv_11:E,conv_12:S,conv_13:k}}function s(){var u=o(1024,256,1,"prediction_layer/conv_0"),l=o(256,512,3,"prediction_layer/conv_1"),c=o(512,128,1,"prediction_layer/conv_2"),h=o(128,256,3,"prediction_layer/conv_3"),d=o(256,128,1,"prediction_layer/conv_4"),p=o(128,256,3,"prediction_layer/conv_5"),g=o(256,64,1,"prediction_layer/conv_6"),x=o(64,128,3,"prediction_layer/conv_7"),y=r(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),b=r(512,9,1,"prediction_layer/box_predictor_0/class_predictor"),C=r(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),E=r(1024,18,1,"prediction_layer/box_predictor_1/class_predictor"),S=r(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),k=r(512,18,1,"prediction_layer/box_predictor_2/class_predictor"),R=r(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),A=r(256,18,1,"prediction_layer/box_predictor_3/class_predictor"),N=r(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),_=r(256,18,1,"prediction_layer/box_predictor_4/class_predictor"),$=r(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),D=r(128,18,1,"prediction_layer/box_predictor_5/class_predictor"),O={box_encoding_predictor:y,class_predictor:b},P={box_encoding_predictor:C,class_predictor:E},z={box_encoding_predictor:S,class_predictor:k},W={box_encoding_predictor:R,class_predictor:A},F={box_encoding_predictor:N,class_predictor:_},B={box_encoding_predictor:$,class_predictor:D};return{conv_0:u,conv_1:l,conv_2:c,conv_3:h,conv_4:d,conv_5:p,conv_6:g,conv_7:x,box_predictor_0:O,box_predictor_1:P,box_predictor_2:z,box_predictor_3:W,box_predictor_4:F,box_predictor_5:B}}return{extractMobilenetV1Params:i,extractPredictionLayerParams:s}}function Gft(n){var t=[],e=uu(n),r=e.extractWeights,o=e.getRemainingWeights,a=Vft(r,t),i=a.extractMobilenetV1Params,s=a.extractPredictionLayerParams,u=i(),l=s(),c=pk(r(5118*4),[1,5118,4]),h={extra_dim:c};if(t.push({paramPath:"output_layer/extra_dim"}),o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{params:{mobilenetv1:u,prediction_layer:l,output_layer:h},paramMappings:t}}function Hft(n,t){var e=yl(n,t);function r(l,c,h){var d=e(l+"/Conv2d_"+c+"_pointwise/weights",4,h+"/filters"),p=e(l+"/Conv2d_"+c+"_pointwise/convolution_bn_offset",1,h+"/batch_norm_offset");return{filters:d,batch_norm_offset:p}}function o(l){var c="mobilenetv1/conv_"+l,h="MobilenetV1/Conv2d_"+l+"_depthwise",d=c+"/depthwise_conv",p=c+"/pointwise_conv",g=e(h+"/depthwise_weights",4,d+"/filters"),x=e(h+"/BatchNorm/gamma",1,d+"/batch_norm_scale"),y=e(h+"/BatchNorm/beta",1,d+"/batch_norm_offset"),b=e(h+"/BatchNorm/moving_mean",1,d+"/batch_norm_mean"),C=e(h+"/BatchNorm/moving_variance",1,d+"/batch_norm_variance");return{depthwise_conv:{filters:g,batch_norm_scale:x,batch_norm_offset:y,batch_norm_mean:b,batch_norm_variance:C},pointwise_conv:r("MobilenetV1",l,p)}}function a(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:o(1),conv_2:o(2),conv_3:o(3),conv_4:o(4),conv_5:o(5),conv_6:o(6),conv_7:o(7),conv_8:o(8),conv_9:o(9),conv_10:o(10),conv_11:o(11),conv_12:o(12),conv_13:o(13)}}function i(l,c){var h=e(l+"/weights",4,c+"/filters"),d=e(l+"/biases",1,c+"/bias");return{filters:h,bias:d}}function s(l){var c=i("Prediction/BoxPredictor_"+l+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+l+"/box_encoding_predictor"),h=i("Prediction/BoxPredictor_"+l+"/ClassPredictor","prediction_layer/box_predictor_"+l+"/class_predictor");return{box_encoding_predictor:c,class_predictor:h}}function u(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:s(0),box_predictor_1:s(1),box_predictor_2:s(2),box_predictor_3:s(3),box_predictor_4:s(4),box_predictor_5:s(5)}}return{extractMobilenetV1Params:a,extractPredictionLayerParams:u}}function qft(n){var t=[],e=Hft(n,t),r=e.extractMobilenetV1Params,o=e.extractPredictionLayerParams,a=n["Output/extra_dim"];if(t.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!c1(a))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+a);var i={mobilenetv1:r(),prediction_layer:o(),output_layer:{extra_dim:a}};return su(n,t),{params:i,paramMappings:t}}function Oi(n,t,e){return he(function(){var r=nu(n,t.filters,e,"same");return r=on(r,t.batch_norm_offset),Ck(r,0,6)})}var jft=.0010000000474974513;function Xft(n,t,e){return he(function(){var r=Ek(n,t.filters,e,"same");return r=H4(r,t.batch_norm_mean,t.batch_norm_variance,t.batch_norm_offset,t.batch_norm_scale,jft),Ck(r,0,6)})}function Kft(n){return[2,4,6,12].some(function(t){return t===n})?[2,2]:[1,1]}function Yft(n,t){return he(function(){var e=null,r=Oi(n,t.conv_0,[2,2]),o=[t.conv_1,t.conv_2,t.conv_3,t.conv_4,t.conv_5,t.conv_6,t.conv_7,t.conv_8,t.conv_9,t.conv_10,t.conv_11,t.conv_12,t.conv_13];if(o.forEach(function(a,i){var s=i+1,u=Kft(s);r=Xft(r,a.depthwise_conv,u),r=Oi(r,a.pointwise_conv,[1,1]),s===11&&(e=r)}),e===null)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:e}})}function Qft(n,t,e,r,o){var a=n.shape[0],i=Math.min(e,a),s=t.map(function(c,h){return{score:c,boxIndex:h}}).filter(function(c){return c.score>o}).sort(function(c,h){return h.score-c.score}),u=function(c){return c<=r?1:0},l=[];return s.forEach(function(c){if(!(l.length>=i)){for(var h=c.score,d=l.length-1;d>=0;--d){var p=Zft(n,c.boxIndex,l[d]);if(p!==0&&(c.score*=u(p),c.score<=o))break}h===c.score&&l.push(c.boxIndex)}}),l}function Zft(n,t,e){var r=n.arraySync(),o=Math.min(r[t][0],r[t][2]),a=Math.min(r[t][1],r[t][3]),i=Math.max(r[t][0],r[t][2]),s=Math.max(r[t][1],r[t][3]),u=Math.min(r[e][0],r[e][2]),l=Math.min(r[e][1],r[e][3]),c=Math.max(r[e][0],r[e][2]),h=Math.max(r[e][1],r[e][3]),d=(i-o)*(s-a),p=(c-u)*(h-l);if(d<=0||p<=0)return 0;var g=Math.max(o,u),x=Math.max(a,l),y=Math.min(i,c),b=Math.min(s,h),C=Math.max(y-g,0)*Math.max(b-x,0);return C/(d+p-C)}function Jft(n){var t=Zr(rl(n,[1,0])),e=[es(t[2],t[0]),es(t[3],t[1])],r=[on(t[0],Ms(e[0],zt(2))),on(t[1],Ms(e[1],zt(2)))];return{sizes:e,centers:r}}function tdt(n,t){var e=Jft(n),r=e.sizes,o=e.centers,a=Zr(rl(t,[1,0])),i=Ms(Ws(GS(Ms(a[2],zt(5))),r[0]),zt(2)),s=on(Ws(Ms(a[0],zt(10)),r[0]),o[0]),u=Ms(Ws(GS(Ms(a[3],zt(5))),r[1]),zt(2)),l=on(Ws(Ms(a[1],zt(10)),r[1]),o[1]);return rl(hi([es(s,i),es(l,u),on(s,i),on(l,u)]),[1,0])}function edt(n,t,e){return he(function(){var r=n.shape[0],o=tdt(ui(mf(e.extra_dim,[r,1,1]),[-1,4]),ui(n,[-1,4]));o=ui(o,[r,o.shape[0]/r,4]);var a=U4(nl(t,[0,0,1],[-1,-1,-1])),i=nl(a,[0,0,0],[-1,-1,1]);i=ui(i,[r,i.shape[1]]);var s=Zr(o),u=Zr(i);return{boxes:s,scores:u}})}function Zh(n,t){return he(function(){var e=n.shape[0],r=ui(di(n,t.box_encoding_predictor),[e,-1,1,4]),o=ui(di(n,t.class_predictor),[e,-1,3]);return{boxPredictionEncoding:r,classPrediction:o}})}function ndt(n,t,e){return he(function(){var r=Oi(n,e.conv_0,[1,1]),o=Oi(r,e.conv_1,[2,2]),a=Oi(o,e.conv_2,[1,1]),i=Oi(a,e.conv_3,[2,2]),s=Oi(i,e.conv_4,[1,1]),u=Oi(s,e.conv_5,[2,2]),l=Oi(u,e.conv_6,[1,1]),c=Oi(l,e.conv_7,[2,2]),h=Zh(t,e.box_predictor_0),d=Zh(n,e.box_predictor_1),p=Zh(o,e.box_predictor_2),g=Zh(i,e.box_predictor_3),x=Zh(u,e.box_predictor_4),y=Zh(c,e.box_predictor_5),b=Ho([h.boxPredictionEncoding,d.boxPredictionEncoding,p.boxPredictionEncoding,g.boxPredictionEncoding,x.boxPredictionEncoding,y.boxPredictionEncoding],1),C=Ho([h.classPrediction,d.classPrediction,p.classPrediction,g.classPrediction,x.classPrediction,y.classPrediction],1);return{boxPredictions:b,classPredictions:C}})}var p1=function(){function n(t){var e=t===void 0?{}:t,r=e.minConfidence,o=e.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=r||.5,this._maxResults=o||100,typeof this._minConfidence!="number"||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if(typeof this._maxResults!="number")throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(n.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),n}(),KB=function(n){Se(t,n);function t(){return n.call(this,"SsdMobilenetv1")||this}return t.prototype.forwardInput=function(e){var r=this.params;if(!r)throw new Error("SsdMobilenetv1 - load model before inference");return he(function(){var o=e.toBatchTensor(512,!1).toFloat(),a=es(Ws(o,zt(.007843137718737125)),zt(1)),i=Yft(a,r.mobilenetv1),s=ndt(i.out,i.conv11,r.prediction_layer),u=s.boxPredictions,l=s.classPredictions;return edt(u,l,r.output_layer)})},t.prototype.forward=function(e){return ie(this,void 0,void 0,function(){var r;return se(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,Wr(e)];case 1:return[2,r.apply(this,[o.sent()])]}})})},t.prototype.locateFaces=function(e,r){return r===void 0&&(r={}),ie(this,void 0,void 0,function(){var o,a,i,s,u,l,c,h,d,p,g,x,y,b,C,E,S,k,R,A,N;return se(this,function(_){switch(_.label){case 0:return o=new p1(r),a=o.maxResults,i=o.minConfidence,[4,Wr(e)];case 1:for(s=_.sent(),u=this.forwardInput(s),l=u.boxes,c=u.scores,h=l[0],d=c[0],p=1;p<l.length;p++)l[p].dispose(),c[p].dispose();return y=(x=Array).from,[4,d.data()];case 2:return g=y.apply(x,[_.sent()]),b=.5,C=Qft(h,g,a,b,i),E=s.getReshapedInputDimensions(0),S=s.inputSize,k=S/E.width,R=S/E.height,A=h.arraySync(),N=C.map(function($){var D=[Math.max(0,A[$][0]),Math.min(1,A[$][2])].map(function(B){return B*R}),O=D[0],P=D[1],z=[Math.max(0,A[$][1]),Math.min(1,A[$][3])].map(function(B){return B*k}),W=z[0],F=z[1];return new ja(g[$],new aI(W,O,F-W,P-O),{height:s.getInputHeight(0),width:s.getInputWidth(0)})}),h.dispose(),d.dispose(),[2,N]}})})},t.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},t.prototype.extractParamsFromWeigthMap=function(e){return qft(e)},t.prototype.extractParams=function(e){return Gft(e)},t}(lu);(function(n){Se(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t})(KB);var YB=function(n){Se(t,n);function t(){var e=n!==null&&n.apply(this,arguments)||this;return e._name="TinyFaceDetectorOptions",e}return t}(mI),Hm=function(){function n(){}return n.prototype.then=function(t){return ie(this,void 0,void 0,function(){var e;return se(this,function(r){switch(r.label){case 0:return e=t,[4,this.run()];case 1:return[2,e.apply(void 0,[r.sent()])]}})})},n.prototype.run=function(){return ie(this,void 0,void 0,function(){return se(this,function(t){throw new Error("ComposableTask - run is not implemented")})})},n}();function m1(n,t,e,r,o){return o===void 0&&(o=function(a){var i=a.alignedRect;return i}),ie(this,void 0,void 0,function(){var a,i,s,u,l;return se(this,function(c){switch(c.label){case 0:return a=n.map(function(h){return BB(h)?o(h):h.detection}),s=r,s?[3,5]:t instanceof Gt?[4,bI(t,a)]:[3,2];case 1:return u=c.sent(),[3,4];case 2:return[4,yI(t,a)];case 3:u=c.sent(),c.label=4;case 4:s=u,c.label=5;case 5:return i=s,[4,e(i)];case 6:return l=c.sent(),i.forEach(function(h){return h instanceof Gt&&h.dispose()}),[2,l]}})})}function CI(n,t,e,r,o){return ie(this,void 0,void 0,function(){var a=this;return se(this,function(i){return[2,m1([n],t,function(s){return ie(a,void 0,void 0,function(){return se(this,function(u){return[2,e(s[0])]})})},r,o)]})})}function rdt(n){return he(function(){return hi(Zr(n,3).reverse(),3)})}var Hx=2,gy=12;function odt(n,t){var e=f1(n,t),r=cI(n,t);function o(l,c){var h=fa(n(l));return t.push({paramPath:c}),h}function a(l,c,h){h===void 0&&(h=!1);var d=e(l[0],l[1],3,c+"/conv1"),p=o(l[1],c+"/prelu1_alpha"),g=e(l[1],l[2],3,c+"/conv2"),x=o(l[2],c+"/prelu2_alpha"),y=e(l[2],l[3],h?2:3,c+"/conv3"),b=o(l[3],c+"/prelu3_alpha");return{conv1:d,prelu1_alpha:p,conv2:g,prelu2_alpha:x,conv3:y,prelu3_alpha:b}}function i(){var l=a([3,10,16,32],"pnet"),c=e(32,2,1,"pnet/conv4_1"),h=e(32,4,1,"pnet/conv4_2");return ci({},l,{conv4_1:c,conv4_2:h})}function s(){var l=a([3,28,48,64],"rnet",!0),c=r(576,128,"rnet/fc1"),h=o(128,"rnet/prelu4_alpha"),d=r(128,2,"rnet/fc2_1"),p=r(128,4,"rnet/fc2_2");return ci({},l,{fc1:c,prelu4_alpha:h,fc2_1:d,fc2_2:p})}function u(){var l=a([3,32,64,64],"onet"),c=e(64,128,2,"onet/conv4"),h=o(128,"onet/prelu4_alpha"),d=r(1152,256,"onet/fc1"),p=o(256,"onet/prelu5_alpha"),g=r(256,2,"onet/fc2_1"),x=r(256,4,"onet/fc2_2"),y=r(256,10,"onet/fc2_3");return ci({},l,{conv4:c,prelu4_alpha:h,fc1:d,prelu5_alpha:p,fc2_1:g,fc2_2:x,fc2_3:y})}return{extractPNetParams:i,extractRNetParams:s,extractONetParams:u}}function adt(n){var t=uu(n),e=t.extractWeights,r=t.getRemainingWeights,o=[],a=odt(e,o),i=a.extractPNetParams,s=a.extractRNetParams,u=a.extractONetParams,l=i(),c=s(),h=u();if(r().length!==0)throw new Error("weights remaing after extract: "+r().length);return{params:{pnet:l,rnet:c,onet:h},paramMappings:o}}function idt(n,t){var e=yl(n,t);function r(c){var h=e(c+"/weights",4,c+"/filters"),d=e(c+"/bias",1);return{filters:h,bias:d}}function o(c){var h=e(c+"/weights",2),d=e(c+"/bias",1);return{weights:h,bias:d}}function a(c){return e(c,1)}function i(c){var h=r(c+"/conv1"),d=a(c+"/prelu1_alpha"),p=r(c+"/conv2"),g=a(c+"/prelu2_alpha"),x=r(c+"/conv3"),y=a(c+"/prelu3_alpha");return{conv1:h,prelu1_alpha:d,conv2:p,prelu2_alpha:g,conv3:x,prelu3_alpha:y}}function s(){var c=i("pnet"),h=r("pnet/conv4_1"),d=r("pnet/conv4_2");return ci({},c,{conv4_1:h,conv4_2:d})}function u(){var c=i("rnet"),h=o("rnet/fc1"),d=a("rnet/prelu4_alpha"),p=o("rnet/fc2_1"),g=o("rnet/fc2_2");return ci({},c,{fc1:h,prelu4_alpha:d,fc2_1:p,fc2_2:g})}function l(){var c=i("onet"),h=r("onet/conv4"),d=a("onet/prelu4_alpha"),p=o("onet/fc1"),g=a("onet/prelu5_alpha"),x=o("onet/fc2_1"),y=o("onet/fc2_2"),b=o("onet/fc2_3");return ci({},c,{conv4:h,prelu4_alpha:d,fc1:p,prelu5_alpha:g,fc2_1:x,fc2_2:y,fc2_3:b})}return{extractPNetParams:s,extractRNetParams:u,extractONetParams:l}}function sdt(n){var t=[],e=idt(n,t),r=e.extractPNetParams,o=e.extractRNetParams,a=e.extractONetParams,i=r(),s=o(),u=a();return su(n,t),{params:{pnet:i,rnet:s,onet:u},paramMappings:t}}function vE(n,t){var e=t[0],r=t[1];return{height:Math.floor(e*n),width:Math.floor(r*n)}}function udt(n,t,e){for(var r=e[0],o=e[1],a=gy/n,i=[],s=Math.min(r,o)*a,u=0;s>=12;)i.push(a*Math.pow(t,u)),s=s*t,u+=1;return i}var SI=function(n){Se(t,n);function t(e,r,o,a){return n.call(this,{left:e,top:r,right:o,bottom:a},!0)||this}return t}(ns);function QB(n){return he(function(){return Ws(es(n,zt(127.5)),zt(.0078125))})}function Ef(n,t){return he(function(){return on(mr(n),Ws(t,G0(mr(G0(n)))))})}function EI(n,t,e){return e===void 0&&(e=!1),he(function(){var r=di(n,t.conv1,"valid");return r=Ef(r,t.prelu1_alpha),r=$f(r,e?[2,2]:[3,3],[2,2],"same"),r=di(r,t.conv2,"valid"),r=Ef(r,t.prelu2_alpha),r=e?r:$f(r,[3,3],[2,2],"valid"),r=di(r,t.conv3,"valid"),r=Ef(r,t.prelu3_alpha),r})}function ldt(n,t){return he(function(){var e=EI(n,t,!0),r=di(e,t.conv4_1,"valid"),o=La(Yy(r,3),3),a=ml(es(r,o),3),i=di(e,t.conv4_2,"valid");return{prob:a,regions:i}})}function cdt(n,t){return he(function(){var e=vE(t,n.shape.slice(1)),r=e.height,o=e.width,a=pL.resizeBilinear(n,[r,o]),i=QB(a);return rl(i,[0,2,1,3])})}function hdt(n,t,e,r){for(var o=[],a=n.arraySync(),i=0;i<n.shape[0];i++)for(var s=0;s<n.shape[1];s++)a[i][s]>=r&&o.push(new Ze(s,i));var u=o.map(function(l){var c=new h1(Math.round((l.y*Hx+1)/e),Math.round((l.x*Hx+1)/e),Math.round((l.y*Hx+gy)/e),Math.round((l.x*Hx+gy)/e)),h=a[l.y][l.x],d=t.arraySync(),p=new SI(d[l.y][l.x][0],d[l.y][l.x][1],d[l.y][l.x][2],d[l.y][l.x][3]);return{cell:c,score:h,region:p}});return u}function fdt(n,t,e,r,o){o.stage1=[];var a=t.map(function(d){return he(function(){var p={scale:d},g=cdt(n,d),x=Date.now(),y=ldt(g,r),b=y.prob,C=y.regions;p.pnet=Date.now()-x;var E=Zr(Zr(b,3)[1])[0],S=Zr(C)[0];return{scoresTensor:E,regionsTensor:S,scale:d,statsForScale:p}})}),i=a.map(function(d){var p=d.scoresTensor,g=d.regionsTensor,x=d.scale,y=d.statsForScale,b=hdt(p,g,x,e);if(p.dispose(),g.dispose(),!b.length)return o.stage1.push(y),[];var C=Date.now(),E=am(b.map(function(S){return S.cell}),b.map(function(S){return S.score}),.5);return y.nms=Date.now()-C,y.numBoxes=E.length,o.stage1.push(y),E.map(function(S){return b[S]})}),s=i.reduce(function(d,p){return d.concat(p)},[]),u=[],l=[];if(s.length>0){var c=Date.now(),h=am(s.map(function(d){return d.cell}),s.map(function(d){return d.score}),.7);o.stage1_nms=Date.now()-c,l=h.map(function(d){return s[d].score}),u=h.map(function(d){return s[d]}).map(function(d){var p=d.cell,g=d.region;return new h1(p.left+g.left*p.width,p.top+g.top*p.height,p.right+g.right*p.width,p.bottom+g.bottom*p.height).toSquare().round()})}return{boxes:u,scores:l}}function ZB(n,t,e){var r=e.width,o=e.height;return ie(this,void 0,void 0,function(){var a,i,s,u=this;return se(this,function(l){switch(l.label){case 0:return a=rs(n),[4,Promise.all(t.map(function(c){return ie(u,void 0,void 0,function(){var h,d,p,g,x,y,b,C;return se(this,function(E){return h=c.padAtBorders(n.height,n.width),d=h.y,p=h.ey,g=h.x,x=h.ex,y=g-1,b=d-1,C=a.getImageData(y,b,x-y,p-b),[2,wo.isNodejs()?dI(C):createImageBitmap(C)]})})}))];case 1:return i=l.sent(),s=[],i.forEach(function(c){var h=d1({width:r,height:o}),d=rs(h);d.drawImage(c,0,0,r,o);for(var p=d.getImageData(0,0,r,o).data,g=[],x=0;x<p.length;x+=4)g.push(p[x+2]),g.push(p[x+1]),g.push(p[x]);s.push(g)}),[2,s.map(function(c){var h=he(function(){var d=rl(oi(c,[1,r,o,3]),[0,2,1,3]).toFloat();return QB(d)});return h})]}})})}function ddt(n,t){return he(function(){var e=EI(n,t),r=ui(e,[e.shape[0],t.fc1.weights.shape[0]]),o=qi(r,t.fc1),a=Ef(o,t.prelu4_alpha),i=qi(a,t.fc2_1),s=La(Yy(i,1),1),u=ml(es(i,s),1),l=qi(a,t.fc2_2),c=Zr(u,1)[1];return{scores:c,regions:l}})}function pdt(n,t,e,r,o){return ie(this,void 0,void 0,function(){var a,i,s,u,l,c,h,d,p,g,x,y,b,C;return se(this,function(E){switch(E.label){case 0:return a=Date.now(),[4,ZB(n,t,{width:24,height:24})];case 1:return i=E.sent(),o.stage2_extractImagePatches=Date.now()-a,a=Date.now(),s=i.map(function(S){var k=ddt(S,r);return S.dispose(),k}),o.stage2_rnet=Date.now()-a,u=s.length>1?Ho(s.map(function(S){return S.scores})):s[0].scores,h=(c=Array).from,[4,u.data()];case 2:return l=h.apply(c,[E.sent()]),u.dispose(),d=l.map(function(S,k){return{score:S,idx:k}}).filter(function(S){return S.score>e}).map(function(S){var k=S.idx;return k}),p=d.map(function(S){return t[S]}),g=d.map(function(S){return l[S]}),x=[],y=[],p.length>0&&(a=Date.now(),b=am(p,g,.7),o.stage2_nms=Date.now()-a,C=b.map(function(S){var k=s[d[S]].regions.arraySync();return new SI(k[0][0],k[0][1],k[0][2],k[0][3])}),y=b.map(function(S){return g[S]}),x=b.map(function(S,k){return p[S].calibrate(C[k])})),s.forEach(function(S){S.regions.dispose(),S.scores.dispose()}),[2,{boxes:x,scores:y}]}})})}function mdt(n,t){return he(function(){var e=EI(n,t);e=$f(e,[2,2],[2,2],"same"),e=di(e,t.conv4,"valid"),e=Ef(e,t.prelu4_alpha);var r=ui(e,[e.shape[0],t.fc1.weights.shape[0]]),o=qi(r,t.fc1),a=Ef(o,t.prelu5_alpha),i=qi(a,t.fc2_1),s=La(Yy(i,1),1),u=ml(es(i,s),1),l=qi(a,t.fc2_2),c=qi(a,t.fc2_3),h=Zr(u,1)[1];return{scores:h,regions:l,points:c}})}function gdt(n,t,e,r,o){return ie(this,void 0,void 0,function(){var a,i,s,u,l,c,h,d,p,g,x,y,b,C,E;return se(this,function(S){switch(S.label){case 0:return a=Date.now(),[4,ZB(n,t,{width:48,height:48})];case 1:return i=S.sent(),o.stage3_extractImagePatches=Date.now()-a,a=Date.now(),s=i.map(function(k){var R=mdt(k,r);return k.dispose(),R}),o.stage3_onet=Date.now()-a,u=s.length>1?Ho(s.map(function(k){return k.scores})):s[0].scores,h=(c=Array).from,[4,u.data()];case 2:return l=h.apply(c,[S.sent()]),u.dispose(),d=l.map(function(k,R){return{score:k,idx:R}}).filter(function(k){return k.score>e}).map(function(k){var R=k.idx;return R}),p=d.map(function(k){var R=s[k].regions.arraySync();return new SI(R[0][0],R[0][1],R[0][2],R[0][3])}),g=d.map(function(k,R){return t[k].calibrate(p[R])}),x=d.map(function(k){return l[k]}),y=[],b=[],C=[],g.length>0&&(a=Date.now(),E=am(g,x,.7,!1),o.stage3_nms=Date.now()-a,y=E.map(function(k){return g[k]}),b=E.map(function(k){return x[k]}),C=E.map(function(k,R){return Array(5).fill(0).map(function(A,N){var _=s[k].points.arraySync();return new Ze(_[0][N]*(y[R].width+1)+y[R].left,_[0][N+5]*(y[R].height+1)+y[R].top)})})),s.forEach(function(k){k.regions.dispose(),k.scores.dispose(),k.points.dispose()}),[2,{boxes:y,scores:b,points:C}]}})})}var vdt=function(n){Se(t,n);function t(){return n.call(this,"Mtcnn")||this}return t.prototype.forwardInput=function(e,r){return r===void 0&&(r={}),ie(this,void 0,void 0,function(){var o,a,i,s,u,l,c,h,d,p,g,x,y,b,C,E,S,k,R,A,N;return se(this,function(_){switch(_.label){case 0:if(o=this.params,!o)throw new Error("Mtcnn - load model before inference");if(a=e.canvases[0],!a)throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return i={},s=Date.now(),u=he(function(){return rdt(La(qot.fromPixels(a)).toFloat())}),l=function($){return u.dispose(),i.total=Date.now()-s,$},c=u.shape.slice(1),h=c[0],d=c[1],p=new XB(r),g=p.minFaceSize,x=p.scaleFactor,y=p.maxNumScales,b=p.scoreThresholds,C=p.scaleSteps,E=(C||udt(g,x,[h,d])).filter(function($){var D=vE($,[h,d]);return Math.min(D.width,D.height)>gy}).slice(0,y),i.scales=E,i.pyramid=E.map(function($){return vE($,[h,d])}),S=Date.now(),[4,fdt(u,E,b[0],o.pnet,i)];case 1:return k=_.sent(),i.total_stage1=Date.now()-S,k.boxes.length?(i.stage2_numInputBoxes=k.boxes.length,S=Date.now(),[4,pdt(a,k.boxes,b[1],o.rnet,i)]):[2,l({results:[],stats:i})];case 2:return R=_.sent(),i.total_stage2=Date.now()-S,R.boxes.length?(i.stage3_numInputBoxes=R.boxes.length,S=Date.now(),[4,gdt(a,R.boxes,b[2],o.onet,i)]):[2,l({results:[],stats:i})];case 3:return A=_.sent(),i.total_stage3=Date.now()-S,N=A.boxes.map(function($,D){return xI(gI({},new ja(A.scores[D],new aI($.left/d,$.top/h,$.width/d,$.height/h),{height:h,width:d})),new _ft(A.points[D].map(function(O){return O.sub(new Ze($.left,$.top)).div(new Ze($.width,$.height))}),{width:$.width,height:$.height}))}),[2,l({results:N,stats:i})]}})})},t.prototype.forward=function(e,r){return r===void 0&&(r={}),ie(this,void 0,void 0,function(){var o;return se(this,function(a){switch(a.label){case 0:return o=this.forwardInput,[4,Wr(e)];case 1:return[4,o.apply(this,[a.sent(),r])];case 2:return[2,a.sent().results]}})})},t.prototype.forwardWithStats=function(e,r){return r===void 0&&(r={}),ie(this,void 0,void 0,function(){var o;return se(this,function(a){switch(a.label){case 0:return o=this.forwardInput,[4,Wr(e)];case 1:return[2,o.apply(this,[a.sent(),r])]}})})},t.prototype.getDefaultModelName=function(){return"mtcnn_model"},t.prototype.extractParamsFromWeigthMap=function(e){return sdt(e)},t.prototype.extractParams=function(e){return adt(e)},t}(lu),xdt=.4,ydt=[new Ze(1.603231,2.094468),new Ze(6.041143,7.080126),new Ze(2.882459,3.518061),new Ze(4.266906,5.178857),new Ze(9.041765,10.66308)],bdt=[117.001,114.697,97.404],wdt=function(n){Se(t,n);function t(){var e=this,r={withSeparableConvs:!0,iouThreshold:xdt,classes:["face"],anchors:ydt,meanRgb:bdt,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return e=n.call(this,r)||this,e}return Object.defineProperty(t.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),t.prototype.locateFaces=function(e,r){return ie(this,void 0,void 0,function(){var o;return se(this,function(a){switch(a.label){case 0:return[4,this.detect(e,r)];case 1:return o=a.sent(),[2,o.map(function(i){return new ja(i.score,i.relativeBox,{width:i.imageWidth,height:i.imageHeight})})]}})})},t.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},t.prototype.extractParamsFromWeigthMap=function(e){return n.prototype.extractParamsFromWeigthMap.call(this,e)},t}(AB),Cdt=.4,Sdt=[new Ze(.738768,.874946),new Ze(2.42204,2.65704),new Ze(4.30971,7.04493),new Ze(10.246,4.59428),new Ze(12.6868,11.8741)],Edt=[new Ze(1.603231,2.094468),new Ze(6.041143,7.080126),new Ze(2.882459,3.518061),new Ze(4.266906,5.178857),new Ze(9.041765,10.66308)],kdt=[117.001,114.697,97.404],Idt="tiny_yolov2_model",Rdt="tiny_yolov2_separable_conv_model",Tdt=function(n){Se(t,n);function t(e){e===void 0&&(e=!0);var r=this,o=Object.assign({},{withSeparableConvs:e,iouThreshold:Cdt,classes:["face"]},e?{anchors:Edt,meanRgb:kdt}:{anchors:Sdt,withClassScores:!0});return r=n.call(this,o)||this,r}return Object.defineProperty(t.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),t.prototype.locateFaces=function(e,r){return ie(this,void 0,void 0,function(){var o;return se(this,function(a){switch(a.label){case 0:return[4,this.detect(e,r)];case 1:return o=a.sent(),[2,o.map(function(i){return new ja(i.score,i.relativeBox,{width:i.imageWidth,height:i.imageHeight})})]}})})},t.prototype.getDefaultModelName=function(){return this.withSeparableConvs?Rdt:Idt},t.prototype.extractParamsFromWeigthMap=function(e){return n.prototype.extractParamsFromWeigthMap.call(this,e)},t}(AB),Pr={ssdMobilenetv1:new KB,tinyFaceDetector:new wdt,tinyYolov2:new Tdt,mtcnn:new vdt,faceLandmark68Net:new GB,faceLandmark68TinyNet:new Fft,faceRecognitionNet:new Wft,faceExpressionNet:new dft,ageGenderNet:new Aft};function JB(n,t){var e={age:t};return Object.assign({},n,e)}function tz(n,t,e){var r={gender:t,genderProbability:e};return Object.assign({},n,r)}var ez=function(n){Se(t,n);function t(e,r,o){var a=n.call(this)||this;return a.parentTask=e,a.input=r,a.extractedFaces=o,a}return t}(Hm),kI=function(n){Se(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.run=function(){return ie(this,void 0,void 0,function(){var e,r,o=this;return se(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return e=a.sent(),[4,m1(e,this.input,function(i){return ie(o,void 0,void 0,function(){return se(this,function(s){switch(s.label){case 0:return[4,Promise.all(i.map(function(u){return Pr.faceExpressionNet.predictExpressions(u)}))];case 1:return[2,s.sent()]}})})},this.extractedFaces)];case 2:return r=a.sent(),[2,e.map(function(i,s){return LB(i,r[s])})]}})})},t.prototype.withAgeAndGender=function(){return new NI(this,this.input)},t}(ez),II=function(n){Se(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.run=function(){return ie(this,void 0,void 0,function(){var e,r;return se(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return e=o.sent(),e?[4,CI(e,this.input,function(a){return Pr.faceExpressionNet.predictExpressions(a)},this.extractedFaces)]:[2];case 2:return r=o.sent(),[2,LB(e,r)]}})})},t.prototype.withAgeAndGender=function(){return new AI(this,this.input)},t}(ez),RI=function(n){Se(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.withAgeAndGender=function(){return new _I(this,this.input)},t.prototype.withFaceDescriptors=function(){return new $I(this,this.input)},t}(kI),TI=function(n){Se(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.withAgeAndGender=function(){return new DI(this,this.input)},t.prototype.withFaceDescriptor=function(){return new OI(this,this.input)},t}(II),nz=function(n){Se(t,n);function t(e,r,o){var a=n.call(this)||this;return a.parentTask=e,a.input=r,a.extractedFaces=o,a}return t}(Hm),NI=function(n){Se(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.run=function(){return ie(this,void 0,void 0,function(){var e,r,o=this;return se(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return e=a.sent(),[4,m1(e,this.input,function(i){return ie(o,void 0,void 0,function(){return se(this,function(s){switch(s.label){case 0:return[4,Promise.all(i.map(function(u){return Pr.ageGenderNet.predictAgeAndGender(u)}))];case 1:return[2,s.sent()]}})})},this.extractedFaces)];case 2:return r=a.sent(),[2,e.map(function(i,s){var u=r[s],l=u.age,c=u.gender,h=u.genderProbability;return JB(tz(i,c,h),l)})]}})})},t.prototype.withFaceExpressions=function(){return new kI(this,this.input)},t}(nz),AI=function(n){Se(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.run=function(){return ie(this,void 0,void 0,function(){var e,r,o,a,i;return se(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return e=s.sent(),e?[4,CI(e,this.input,function(u){return Pr.ageGenderNet.predictAgeAndGender(u)},this.extractedFaces)]:[2];case 2:return r=s.sent(),o=r.age,a=r.gender,i=r.genderProbability,[2,JB(tz(e,a,i),o)]}})})},t.prototype.withFaceExpressions=function(){return new II(this,this.input)},t}(nz),_I=function(n){Se(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.withFaceExpressions=function(){return new RI(this,this.input)},t.prototype.withFaceDescriptors=function(){return new $I(this,this.input)},t}(NI),DI=function(n){Se(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.withFaceExpressions=function(){return new TI(this,this.input)},t.prototype.withFaceDescriptor=function(){return new OI(this,this.input)},t}(AI),rz=function(n){Se(t,n);function t(e,r){var o=n.call(this)||this;return o.parentTask=e,o.input=r,o}return t}(Hm),$I=function(n){Se(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.run=function(){return ie(this,void 0,void 0,function(){var e,r;return se(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return e=o.sent(),[4,m1(e,this.input,function(a){return Promise.all(a.map(function(i){return Pr.faceRecognitionNet.computeFaceDescriptor(i)}))},null,function(a){return a.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return r=o.sent(),[2,r.map(function(a,i){return jB(e[i],a)})]}})})},t.prototype.withFaceExpressions=function(){return new RI(this,this.input)},t.prototype.withAgeAndGender=function(){return new _I(this,this.input)},t}(rz),OI=function(n){Se(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.run=function(){return ie(this,void 0,void 0,function(){var e,r;return se(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return e=o.sent(),e?[4,CI(e,this.input,function(a){return Pr.faceRecognitionNet.computeFaceDescriptor(a)},null,function(a){return a.landmarks.align(null,{useDlibAlignment:!0})})]:[2];case 2:return r=o.sent(),[2,jB(e,r)]}})})},t.prototype.withFaceExpressions=function(){return new TI(this,this.input)},t.prototype.withAgeAndGender=function(){return new DI(this,this.input)},t}(rz),oz=function(n){Se(t,n);function t(e,r,o){var a=n.call(this)||this;return a.parentTask=e,a.input=r,a.useTinyLandmarkNet=o,a}return Object.defineProperty(t.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?Pr.faceLandmark68TinyNet:Pr.faceLandmark68Net},enumerable:!0,configurable:!0}),t}(Hm),Ndt=function(n){Se(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.run=function(){return ie(this,void 0,void 0,function(){var e,r,o,a,i,s=this;return se(this,function(u){switch(u.label){case 0:return[4,this.parentTask];case 1:return e=u.sent(),r=e.map(function(l){return l.detection}),this.input instanceof Gt?[4,bI(this.input,r)]:[3,3];case 2:return a=u.sent(),[3,5];case 3:return[4,yI(this.input,r)];case 4:a=u.sent(),u.label=5;case 5:return o=a,[4,Promise.all(o.map(function(l){return s.landmarkNet.detectLandmarks(l)}))];case 6:return i=u.sent(),o.forEach(function(l){return l instanceof Gt&&l.dispose()}),[2,e.map(function(l,c){return xI(l,i[c])})]}})})},t.prototype.withFaceExpressions=function(){return new RI(this,this.input)},t.prototype.withAgeAndGender=function(){return new _I(this,this.input)},t.prototype.withFaceDescriptors=function(){return new $I(this,this.input)},t}(oz),Adt=function(n){Se(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.run=function(){return ie(this,void 0,void 0,function(){var e,r,o,a,i;return se(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return e=s.sent(),e?(r=e.detection,this.input instanceof Gt?[4,bI(this.input,[r])]:[3,3]):[2];case 2:return a=s.sent(),[3,5];case 3:return[4,yI(this.input,[r])];case 4:a=s.sent(),s.label=5;case 5:return o=a,[4,this.landmarkNet.detectLandmarks(o[0])];case 6:return i=s.sent(),o.forEach(function(u){return u instanceof Gt&&u.dispose()}),[2,xI(e,i)]}})})},t.prototype.withFaceExpressions=function(){return new TI(this,this.input)},t.prototype.withAgeAndGender=function(){return new DI(this,this.input)},t.prototype.withFaceDescriptor=function(){return new OI(this,this.input)},t}(oz),az=function(n){Se(t,n);function t(e,r){r===void 0&&(r=new p1);var o=n.call(this)||this;return o.input=e,o.options=r,o}return t}(Hm),iz=function(n){Se(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.run=function(){return ie(this,void 0,void 0,function(){var e,r,o,a;return se(this,function(i){switch(i.label){case 0:return e=this,r=e.input,o=e.options,o instanceof XB?[4,Pr.mtcnn.forward(r,o)]:[3,2];case 1:return[2,i.sent().map(function(s){return s.detection})];case 2:if(a=o instanceof YB?function(s){return Pr.tinyFaceDetector.locateFaces(s,o)}:o instanceof p1?function(s){return Pr.ssdMobilenetv1.locateFaces(s,o)}:o instanceof mI?function(s){return Pr.tinyYolov2.locateFaces(s,o)}:null,!a)throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,a(r)]}})})},t.prototype.runAndExtendWithFaceDetections=function(){var e=this;return new Promise(function(r){return ie(e,void 0,void 0,function(){var o;return se(this,function(a){switch(a.label){case 0:return[4,this.run()];case 1:return o=a.sent(),[2,r(o.map(function(i){return gI({},i)}))]}})})})},t.prototype.withFaceLandmarks=function(e){return e===void 0&&(e=!1),new Ndt(this.runAndExtendWithFaceDetections(),this.input,e)},t.prototype.withFaceExpressions=function(){return new kI(this.runAndExtendWithFaceDetections(),this.input)},t.prototype.withAgeAndGender=function(){return new NI(this.runAndExtendWithFaceDetections(),this.input)},t}(az);(function(n){Se(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.run=function(){return ie(this,void 0,void 0,function(){var e,r;return se(this,function(o){switch(o.label){case 0:return[4,new iz(this.input,this.options)];case 1:return e=o.sent(),r=e[0],e.forEach(function(a){a.score>r.score&&(r=a)}),[2,r]}})})},t.prototype.runAndExtendWithFaceDetection=function(){var e=this;return new Promise(function(r){return ie(e,void 0,void 0,function(){var o;return se(this,function(a){switch(a.label){case 0:return[4,this.run()];case 1:return o=a.sent(),[2,r(o?gI({},o):void 0)]}})})})},t.prototype.withFaceLandmarks=function(e){return e===void 0&&(e=!1),new Adt(this.runAndExtendWithFaceDetection(),this.input,e)},t.prototype.withFaceExpressions=function(){return new II(this.runAndExtendWithFaceDetection(),this.input)},t.prototype.withAgeAndGender=function(){return new AI(this.runAndExtendWithFaceDetection(),this.input)},t})(az);function _dt(n,t){return t===void 0&&(t=new p1),new iz(n,t)}function Ddt(n,t){if(n.length!==t.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var e=Array.from(n),r=Array.from(t);return Math.sqrt(e.map(function(o,a){return o-r[a]}).reduce(function(o,a){return o+Math.pow(a,2)},0))}(function(){function n(t,e){e===void 0&&(e=.6),this._distanceThreshold=e;var r=Array.isArray(t)?t:[t];if(!r.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var o=1,a=function(){return"person "+o++};this._labeledDescriptors=r.map(function(i){if(i instanceof rS)return i;if(i instanceof Float32Array)return new rS(a(),[i]);if(i.descriptor&&i.descriptor instanceof Float32Array)return new rS(a(),[i.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}return Object.defineProperty(n.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),n.prototype.computeMeanDistance=function(t,e){return e.map(function(r){return Ddt(r,t)}).reduce(function(r,o){return r+o},0)/(e.length||1)},n.prototype.matchDescriptor=function(t){var e=this;return this.labeledDescriptors.map(function(r){var o=r.descriptors,a=r.label;return new s3(a,e.computeMeanDistance(t,o))}).reduce(function(r,o){return r.distance<o.distance?r:o})},n.prototype.findBestMatch=function(t){var e=this.matchDescriptor(t);return e.distance<this.distanceThreshold?e:new s3("unknown",e.distance)},n})();ci({},Xht,wft);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $dt=1e-7,Odt=1e-4;class sz{constructor(t,e){this.backend=t,this.dataMover=e,this.data=new WeakMap,this.dataIdsCount=0}get(t){return this.data.has(t)||this.dataMover.moveData(this.backend,t),this.data.get(t)}set(t,e){this.dataIdsCount++,this.data.set(t,e)}has(t){return this.data.has(t)}delete(t){return this.dataIdsCount--,this.data.delete(t)}numDataIds(){return this.dataIdsCount}}class FI{refCount(t){return zo("refCount")}incRef(t){return zo("incRef")}timerAvailable(){return!0}time(t){return zo("time")}read(t){return zo("read")}readSync(t){return zo("readSync")}readToGPU(t,e){return zo("readToGPU")}numDataIds(){return zo("numDataIds")}disposeData(t,e){return zo("disposeData")}write(t,e,r){return zo("write")}move(t,e,r,o,a){return zo("move")}createTensorFromGPUData(t,e,r){return zo("createTensorFromGPUData")}memory(){return zo("memory")}floatPrecision(){return zo("floatPrecision")}epsilon(){return this.floatPrecision()===32?$dt:Odt}dispose(){return zo("dispose")}}function zo(n){throw new Error(`'${n}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fdt(n){let t=n.length,e=0;for(;t>0;)e=Math.random()*t|0,t--,cf(n,t,e)}function Ic(n,t,e){return Math.max(n,Math.min(t,e))}function MI(n){return n%2===0?n:n+1}function cf(n,t,e){const r=n[t];n[t]=n[e],n[e]=r}function Mdt(n){let t=0;for(let e=0;e<n.length;e++)t+=n[e];return t}function H(n,t){if(!n)throw new Error(typeof t=="string"?t:t())}function LI(n,t,e=""){H(tn(n,t),()=>e+` Shapes ${n} and ${t} must match`)}function uz(n){H(n!=null,()=>"The input to the tensor constructor must be a non-null value.")}function It(n){if(n.length===0)return 1;let t=n[0];for(let e=1;e<n.length;e++)t*=n[e];return t}function tn(n,t){if(n===t)return!0;if(n==null||t==null||n.length!==t.length)return!1;for(let e=0;e<n.length;e++)if(n[e]!==t[e])return!1;return!0}function Uf(n){return n%1===0}function xE(n){const t=Math.ceil(Math.sqrt(n));return[t,Math.ceil(n/t)]}function kf(n,t){return t<=n.length?n:n+" ".repeat(t-n.length)}function u3(n,t=o=>0,e,r){return new Promise((o,a)=>{let i=0;const s=()=>{if(n()){o();return}i++;const u=t(i);if(e!=null&&i>=e){a();return}r!=null?r(s,u):setTimeout(s,u)};s()})}function lz(n,t){let e=1,r=-1;for(let a=0;a<n.length;++a)if(n[a]>=0)e*=n[a];else if(n[a]===-1){if(r!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${r} and dim ${a}`);r=a}else if(n[a]<0)throw Error(`Shapes can not be < 0. Found ${n[a]} at dim ${a}`);if(r===-1){if(t>0&&t!==e)throw Error(`Size(${t}) must match the product of shape ${n}`);return n}if(e===0)throw Error(`Cannot infer the missing size in [${n}] when there are 0 elements`);if(t%e!==0)throw Error(`The implicit shape can't be a fractional number. Got ${t} / ${e}`);const o=n.slice();return o[r]=t/e,o}function _e(n,t){const e=t.length;return n=n==null?t.map((r,o)=>o):[].concat(n),H(n.every(r=>r>=-e&&r<e),()=>`All values in axis param must be in range [-${e}, ${e}) but got axis ${n}`),H(n.every(r=>Uf(r)),()=>`All values in axis param must be integers but got axis ${n}`),n.map(r=>r<0?e+r:r)}function bl(n,t){const e=[],r=[],o=t!=null&&Array.isArray(t)&&t.length===0,a=t==null||o?null:_e(t,n).sort();let i=0;for(let s=0;s<n.length;++s){if(a!=null){if(a[i]===s&&n[s]!==1)throw new Error(`Can't squeeze axis ${s} since its dim '${n[s]}' is not 1`);(a[i]==null||a[i]>s)&&n[s]===1&&(e.push(n[s]),r.push(s)),a[i]<=s&&i++}n[s]!==1&&(e.push(n[s]),r.push(s))}return{newShape:e,keptDims:r}}function Jr(n,t){return Qn(n,t)}function Qn(n,t){let e=null;if(n==null||n==="float32")e=new Float32Array(t);else if(n==="int32")e=new Int32Array(t);else if(n==="bool")e=new Uint8Array(t);else if(n==="string")e=new Array(t);else throw new Error(`Unknown data type ${n}`);return e}function Ldt(n,t){for(let e=0;e<n.length;e++){const r=n[e];if(isNaN(r)||!isFinite(r))throw Error(`A tensor of type ${t} being uploaded contains ${r}.`)}}function Pdt(n){return n==="bool"||n==="complex64"||n==="float32"||n==="int32"||n==="string"}function cz(n,t){return!(t==="complex64"||t==="float32"&&n!=="complex64"||t==="int32"&&n!=="float32"&&n!=="complex64"||t==="bool"&&n==="bool")}function vy(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error(`Unknown dtype ${n}`)}function Bdt(n){if(n==null)return 0;let t=0;return n.forEach(e=>t+=e.length),t}function qm(n){return typeof n=="string"||n instanceof String}function zdt(n){return typeof n=="boolean"}function yE(n){return typeof n=="number"}function ld(n){return Array.isArray(n)?ld(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray?"int32":yE(n)?"float32":qm(n)?"string":zdt(n)?"bool":"float32"}function bE(n){return!!(n&&n.constructor&&n.call&&n.apply)}function wE(n,t){for(let e=t;e<n;++e)if(n%e===0)return e;return n}function ue(n){const t=n.length;if(t<2)return[];const e=new Array(t-1);e[t-2]=n[t-1];for(let r=t-3;r>=0;--r)e[r]=e[r+1]*n[r+1];return e}function hz(n,t,e,r=!1){const o=new Array;if(t.length===1){const a=t[0]*(r?2:1);for(let i=0;i<a;i++)o[i]=e[n+i]}else{const a=t[0],i=t.slice(1),s=i.reduce((u,l)=>u*l)*(r?2:1);for(let u=0;u<a;u++)o[u]=hz(n+u*s,i,e,r)}return o}function pi(n,t,e=!1){if(n.length===0)return t[0];const r=n.reduce((o,a)=>o*a)*(e?2:1);if(r===0)return[];if(r!==t.length)throw new Error(`[${n}] does not match the input size ${t.length}${e?" for a complex tensor":""}.`);return hz(0,n,t,e)}function Udt(n,t){if(Array.isArray(n))return n;if(t==="float32")return n instanceof Float32Array?n:new Float32Array(n);if(t==="int32")return n instanceof Int32Array?n:new Int32Array(n);if(t==="bool"||t==="string")return Uint8Array.from(new Int32Array(n));throw new Error(`Unknown dtype ${t}`)}function PI(n,t){const e=to(n,t);for(let r=0;r<e.length;r++)e[r]=1;return e}function to(n,t){if(t==null||t==="float32"||t==="complex64")return new Float32Array(n);if(t==="int32")return new Int32Array(n);if(t==="bool")return new Uint8Array(n);throw new Error(`Unknown data type ${t}`)}function fz(n,t){const e=n.reduce((r,o)=>r*o,1);if(t==null||t==="float32")return pi(n,new Float32Array(e));if(t==="int32")return pi(n,new Int32Array(e));if(t==="bool")return pi(n,new Uint8Array(e));throw new Error(`Unknown data type ${t}`)}function cu(n){n.forEach(t=>{H(Number.isInteger(t)&&t>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${n}].`)})}function Ki(n,t,e){if(t===0)return 0;if(t===1)return n[0];let r=n[n.length-1];for(let o=0;o<n.length-1;++o)r+=e[o]*n[o];return r}function cd(n,t,e){if(t===0)return[];if(t===1)return[n];const r=new Array(t);for(let o=0;o<r.length-1;++o)r[o]=Math.floor(n/e[o]),n-=r[o]*e[o];return r[r.length-1]=n,r}function BI(n){return n&&n.then&&typeof n.then=="function"}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const l3="tfjsflags";class Wdt{constructor(t){this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=Vdt,this.populateURLFlags()}setPlatform(t,e){this.platform!=null&&(yt().getBool("IS_TEST")||yt().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${t}.`)),this.platformName=t,this.platform=e}registerFlag(t,e,r){if(this.flagRegistry[t]={evaluationFn:e,setHook:r},this.urlFlags[t]!=null){const o=this.urlFlags[t];yt().getBool("IS_TEST")||yt().getBool("PROD")||console.warn(`Setting feature override from URL ${t}: ${o}.`),this.set(t,o)}}async getAsync(t){return t in this.flags?this.flags[t]:(this.flags[t]=await this.evaluateFlag(t),this.flags[t])}get(t){if(t in this.flags)return this.flags[t];const e=this.evaluateFlag(t);if(BI(e))throw new Error(`Flag ${t} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[t]=e,this.flags[t]}getNumber(t){return this.get(t)}getBool(t){return this.get(t)}getString(t){return this.get(t)}getFlags(){return this.flags}get features(){return this.flags}set(t,e){if(this.flagRegistry[t]==null)throw new Error(`Cannot set flag ${t} as it has not been registered.`);this.flags[t]=e,this.flagRegistry[t].setHook!=null&&this.flagRegistry[t].setHook(e)}evaluateFlag(t){if(this.flagRegistry[t]==null)throw new Error(`Cannot evaluate flag '${t}': no evaluation function found.`);return this.flagRegistry[t].evaluationFn()}setFlags(t){this.flags=Object.assign({},t)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;const t=this.getQueryParams(this.global.location.search);l3 in t&&t[l3].split(",").forEach(r=>{const[o,a]=r.split(":");this.urlFlags[o]=Hdt(o,a)})}}function Vdt(n){const t={};return n.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(e,...r)=>(Gdt(t,r[0],r[1]),r.join("="))),t}function Gdt(n,t,e){n[decodeURIComponent(t)]=decodeURIComponent(e||"")}function Hdt(n,t){const e=t.toLowerCase();return e==="true"||e==="false"?e==="true":`${+e}`===e?+e:t}function yt(){return dz}let dz=null;function qdt(n){dz=n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let oS;function pz(){if(oS==null){let n;if(typeof window<"u")n=window;else if(typeof global<"u")n=global;else if(typeof process<"u")n=process;else if(typeof self<"u")n=self;else throw new Error("Could not find a global object");oS=n}return oS}function jdt(){const n=pz();return n._tfGlobals==null&&(n._tfGlobals=new Map),n._tfGlobals}function zI(n,t){const e=jdt();if(e.has(n))return e.get(n);{const r=t();return e.set(n,r),e.get(n)}}const g1="Abs",jm="Acos",Xm="Acosh",hd="Add",UI="AddN",WI="All",VI="Any",v1="ArgMax",x1="ArgMin",Km="Asin",Ym="Asinh",Qm="Atan",Zm="Atanh",Jm="Atan2",y1="AvgPool",GI="AvgPoolGrad",b1="AvgPool3D",HI="AvgPool3DGrad",w1="BatchMatMul",C1="BatchToSpaceND",qI="Bincount",jI="BitwiseAnd",Xdt="BroadcastTo",mz="BroadcastArgs",tg="Cast",eg="Ceil",ng="ClipByValue",XI="Complex",S1="ComplexAbs",E1="Concat",k1="Conv2D",KI="Conv2DBackpropFilter",I1="Conv2DBackpropInput",R1="Conv3D",YI="Conv3DBackpropFilterV2",QI="Conv3DBackpropInputV2",rg="Cos",og="Cosh",ZI="Cumprod",T1="Cumsum",JI="CropAndResize",tR="DenseBincount",eR="DepthToSpace",N1="DepthwiseConv2dNative",nR="DepthwiseConv2dNativeBackpropFilter",rR="DepthwiseConv2dNativeBackpropInput",gz="Diag",A1="Dilation2D",CE="Dilation2DBackpropInput",SE="Dilation2DBackpropFilter",Kdt="Draw",ag="RealDiv",oR="Einsum",ig="Elu",aR="EluGrad",sg="Erf",_1="Equal",ug="Exp",D1="ExpandDims",lg="Expm1",iR="FFT",sR="Fill",uR="FlipLeftRight",cg="Floor",hg="FloorDiv",$1="FusedBatchNorm",O1="GatherV2",vz="GatherNd",F1="Greater",fg="GreaterEqual",dg="Identity",lR="IFFT",cR="Imag",pg="IsFinite",mg="IsInf",gg="IsNan",M1="LeakyRelu",L1="Less",P1="LessEqual",xz="LinSpace",vg="Log",xg="Log1p",B1="LogicalAnd",z1="LogicalNot",U1="LogicalOr",Ydt="LogSoftmax",W1="LRN",hR="LRNGrad",V1="Max",yg="Maximum",G1="MaxPool",fR="MaxPoolGrad",H1="MaxPool3D",dR="MaxPool3DGrad",yz="MaxPoolWithArgmax",q1="Mean",j1="Min",bg="Minimum",X1="MirrorPad",wg="Mod",bz="Multinomial",Cg="Multiply",K1="Neg",Y1="NotEqual",pR="NonMaxSuppressionV3",mR="NonMaxSuppressionV4",gR="NonMaxSuppressionV5",Q1="OnesLike",Z1="OneHot",J1="Pack",tb="PadV2",Sg="Pow",eb="Prelu",nb="Prod",wz="RaggedGather",Cz="RaggedRange",Sz="RaggedTensorToTensor",vR="Range",xR="Real",Eg="Reciprocal",kg="Relu",rb="Reshape",ob="ResizeNearestNeighbor",yR="ResizeNearestNeighborGrad",ab="ResizeBilinear",bR="ResizeBilinearGrad",Ig="Relu6",ib="Reverse",Rg="Round",Tg="Rsqrt",Ez="ScatterNd",kz="TensorScatterUpdate",Iz="SearchSorted",sb="Select",Ng="Selu",ub="Slice",Ag="Sin",_g="Sinh",Dg="Sign",$g="Sigmoid",Og="Softplus",Fg="Sqrt",lb="Sum",cb="SpaceToBatchND",hb="SplitV",fb="Softmax",Rz="SparseFillEmptyRows",Tz="SparseReshape",Nz="SparseSegmentMean",Az="SparseSegmentSum",_z="SparseToDense",Mg="SquaredDifference",wR="Square",CR="StaticRegexReplace",SR="StridedSlice",Dz="StringNGrams",$z="StringSplit",Oz="StringToHashBucketFast",Lg="Sub",Pg="Tan",Bg="Tanh",zg="Tile",ER="TopK",kR="Transform",If="Transpose",IR="Unique",db="Unpack",pb="UnsortedSegmentSum",mb="ZerosLike",Ug="Step",Qdt="FromPixels",RR="RotateWithOffset",xy="_FusedMatMul",yy="FusedConv2D",Fz="FusedDepthwiseConv2D";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pa(...n){yt().getBool("IS_TEST")||yt().getBool("PROD")||console.warn(...n)}function Zdt(...n){yt().getBool("IS_TEST")||yt().getBool("PROD")||console.log(...n)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const by=zI("kernelRegistry",()=>new Map),EE=zI("gradRegistry",()=>new Map);function c3(n,t){const e=Lz(n,t);return by.get(e)}function h3(n){return EE.get(n)}function f3(n){const t=by.entries(),e=[];for(;;){const{done:r,value:o}=t.next();if(r)break;const[a,i]=o,[s]=a.split("_");s===n&&e.push(i)}return e}function Mz(n){const{kernelName:t,backendName:e}=n,r=Lz(t,e);by.has(r)&&pa(`The kernel '${t}' for backend '${e}' is already registered`),by.set(r,n)}function Jdt(n){const{kernelName:t}=n;EE.has(t)&&yt().getBool("DEBUG")&&pa(`Overriding the gradient for '${t}'`),EE.set(t,n)}function Lz(n,t){return`${t}_${n}`}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pz(n){return n instanceof Float32Array||n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray}var aS,d3;function tpt(){if(d3)return aS;d3=1,aS=t;var n=null;try{n=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function t($,D,O){this.low=$|0,this.high=D|0,this.unsigned=!!O}t.prototype.__isLong__,Object.defineProperty(t.prototype,"__isLong__",{value:!0});function e($){return($&&$.__isLong__)===!0}t.isLong=e;var r={},o={};function a($,D){var O,P,z;return D?($>>>=0,(z=0<=$&&$<256)&&(P=o[$],P)?P:(O=s($,($|0)<0?-1:0,!0),z&&(o[$]=O),O)):($|=0,(z=-128<=$&&$<128)&&(P=r[$],P)?P:(O=s($,$<0?-1:0,!1),z&&(r[$]=O),O))}t.fromInt=a;function i($,D){if(isNaN($))return D?C:b;if(D){if($<0)return C;if($>=g)return A}else{if($<=-x)return N;if($+1>=x)return R}return $<0?i(-$,D).neg():s($%p|0,$/p|0,D)}t.fromNumber=i;function s($,D,O){return new t($,D,O)}t.fromBits=s;var u=Math.pow;function l($,D,O){if($.length===0)throw Error("empty string");if($==="NaN"||$==="Infinity"||$==="+Infinity"||$==="-Infinity")return b;if(typeof D=="number"?(O=D,D=!1):D=!!D,O=O||10,O<2||36<O)throw RangeError("radix");var P;if((P=$.indexOf("-"))>0)throw Error("interior hyphen");if(P===0)return l($.substring(1),D,O).neg();for(var z=i(u(O,8)),W=b,F=0;F<$.length;F+=8){var B=Math.min(8,$.length-F),U=parseInt($.substring(F,F+B),O);if(B<8){var q=i(u(O,B));W=W.mul(q).add(i(U))}else W=W.mul(z),W=W.add(i(U))}return W.unsigned=D,W}t.fromString=l;function c($,D){return typeof $=="number"?i($,D):typeof $=="string"?l($,D):s($.low,$.high,typeof D=="boolean"?D:$.unsigned)}t.fromValue=c;var h=65536,d=1<<24,p=h*h,g=p*p,x=g/2,y=a(d),b=a(0);t.ZERO=b;var C=a(0,!0);t.UZERO=C;var E=a(1);t.ONE=E;var S=a(1,!0);t.UONE=S;var k=a(-1);t.NEG_ONE=k;var R=s(-1,2147483647,!1);t.MAX_VALUE=R;var A=s(-1,-1,!0);t.MAX_UNSIGNED_VALUE=A;var N=s(0,-2147483648,!1);t.MIN_VALUE=N;var _=t.prototype;return _.toInt=function(){return this.unsigned?this.low>>>0:this.low},_.toNumber=function(){return this.unsigned?(this.high>>>0)*p+(this.low>>>0):this.high*p+(this.low>>>0)},_.toString=function(D){if(D=D||10,D<2||36<D)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(N)){var O=i(D),P=this.div(O),z=P.mul(O).sub(this);return P.toString(D)+z.toInt().toString(D)}else return"-"+this.neg().toString(D);for(var W=i(u(D,6),this.unsigned),F=this,B="";;){var U=F.div(W),q=F.sub(U.mul(W)).toInt()>>>0,M=q.toString(D);if(F=U,F.isZero())return M+B;for(;M.length<6;)M="0"+M;B=""+M+B}},_.getHighBits=function(){return this.high},_.getHighBitsUnsigned=function(){return this.high>>>0},_.getLowBits=function(){return this.low},_.getLowBitsUnsigned=function(){return this.low>>>0},_.getNumBitsAbs=function(){if(this.isNegative())return this.eq(N)?64:this.neg().getNumBitsAbs();for(var D=this.high!=0?this.high:this.low,O=31;O>0&&(D&1<<O)==0;O--);return this.high!=0?O+33:O+1},_.isZero=function(){return this.high===0&&this.low===0},_.eqz=_.isZero,_.isNegative=function(){return!this.unsigned&&this.high<0},_.isPositive=function(){return this.unsigned||this.high>=0},_.isOdd=function(){return(this.low&1)===1},_.isEven=function(){return(this.low&1)===0},_.equals=function(D){return e(D)||(D=c(D)),this.unsigned!==D.unsigned&&this.high>>>31===1&&D.high>>>31===1?!1:this.high===D.high&&this.low===D.low},_.eq=_.equals,_.notEquals=function(D){return!this.eq(D)},_.neq=_.notEquals,_.ne=_.notEquals,_.lessThan=function(D){return this.comp(D)<0},_.lt=_.lessThan,_.lessThanOrEqual=function(D){return this.comp(D)<=0},_.lte=_.lessThanOrEqual,_.le=_.lessThanOrEqual,_.greaterThan=function(D){return this.comp(D)>0},_.gt=_.greaterThan,_.greaterThanOrEqual=function(D){return this.comp(D)>=0},_.gte=_.greaterThanOrEqual,_.ge=_.greaterThanOrEqual,_.compare=function(D){if(e(D)||(D=c(D)),this.eq(D))return 0;var O=this.isNegative(),P=D.isNegative();return O&&!P?-1:!O&&P?1:this.unsigned?D.high>>>0>this.high>>>0||D.high===this.high&&D.low>>>0>this.low>>>0?-1:1:this.sub(D).isNegative()?-1:1},_.comp=_.compare,_.negate=function(){return!this.unsigned&&this.eq(N)?N:this.not().add(E)},_.neg=_.negate,_.add=function(D){e(D)||(D=c(D));var O=this.high>>>16,P=this.high&65535,z=this.low>>>16,W=this.low&65535,F=D.high>>>16,B=D.high&65535,U=D.low>>>16,q=D.low&65535,M=0,G=0,Q=0,Z=0;return Z+=W+q,Q+=Z>>>16,Z&=65535,Q+=z+U,G+=Q>>>16,Q&=65535,G+=P+B,M+=G>>>16,G&=65535,M+=O+F,M&=65535,s(Q<<16|Z,M<<16|G,this.unsigned)},_.subtract=function(D){return e(D)||(D=c(D)),this.add(D.neg())},_.sub=_.subtract,_.multiply=function(D){if(this.isZero())return b;if(e(D)||(D=c(D)),n){var O=n.mul(this.low,this.high,D.low,D.high);return s(O,n.get_high(),this.unsigned)}if(D.isZero())return b;if(this.eq(N))return D.isOdd()?N:b;if(D.eq(N))return this.isOdd()?N:b;if(this.isNegative())return D.isNegative()?this.neg().mul(D.neg()):this.neg().mul(D).neg();if(D.isNegative())return this.mul(D.neg()).neg();if(this.lt(y)&&D.lt(y))return i(this.toNumber()*D.toNumber(),this.unsigned);var P=this.high>>>16,z=this.high&65535,W=this.low>>>16,F=this.low&65535,B=D.high>>>16,U=D.high&65535,q=D.low>>>16,M=D.low&65535,G=0,Q=0,Z=0,rt=0;return rt+=F*M,Z+=rt>>>16,rt&=65535,Z+=W*M,Q+=Z>>>16,Z&=65535,Z+=F*q,Q+=Z>>>16,Z&=65535,Q+=z*M,G+=Q>>>16,Q&=65535,Q+=W*q,G+=Q>>>16,Q&=65535,Q+=F*U,G+=Q>>>16,Q&=65535,G+=P*M+z*q+W*U+F*B,G&=65535,s(Z<<16|rt,G<<16|Q,this.unsigned)},_.mul=_.multiply,_.divide=function(D){if(e(D)||(D=c(D)),D.isZero())throw Error("division by zero");if(n){if(!this.unsigned&&this.high===-2147483648&&D.low===-1&&D.high===-1)return this;var O=(this.unsigned?n.div_u:n.div_s)(this.low,this.high,D.low,D.high);return s(O,n.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?C:b;var P,z,W;if(this.unsigned){if(D.unsigned||(D=D.toUnsigned()),D.gt(this))return C;if(D.gt(this.shru(1)))return S;W=C}else{if(this.eq(N)){if(D.eq(E)||D.eq(k))return N;if(D.eq(N))return E;var F=this.shr(1);return P=F.div(D).shl(1),P.eq(b)?D.isNegative()?E:k:(z=this.sub(D.mul(P)),W=P.add(z.div(D)),W)}else if(D.eq(N))return this.unsigned?C:b;if(this.isNegative())return D.isNegative()?this.neg().div(D.neg()):this.neg().div(D).neg();if(D.isNegative())return this.div(D.neg()).neg();W=b}for(z=this;z.gte(D);){P=Math.max(1,Math.floor(z.toNumber()/D.toNumber()));for(var B=Math.ceil(Math.log(P)/Math.LN2),U=B<=48?1:u(2,B-48),q=i(P),M=q.mul(D);M.isNegative()||M.gt(z);)P-=U,q=i(P,this.unsigned),M=q.mul(D);q.isZero()&&(q=E),W=W.add(q),z=z.sub(M)}return W},_.div=_.divide,_.modulo=function(D){if(e(D)||(D=c(D)),n){var O=(this.unsigned?n.rem_u:n.rem_s)(this.low,this.high,D.low,D.high);return s(O,n.get_high(),this.unsigned)}return this.sub(this.div(D).mul(D))},_.mod=_.modulo,_.rem=_.modulo,_.not=function(){return s(~this.low,~this.high,this.unsigned)},_.and=function(D){return e(D)||(D=c(D)),s(this.low&D.low,this.high&D.high,this.unsigned)},_.or=function(D){return e(D)||(D=c(D)),s(this.low|D.low,this.high|D.high,this.unsigned)},_.xor=function(D){return e(D)||(D=c(D)),s(this.low^D.low,this.high^D.high,this.unsigned)},_.shiftLeft=function(D){return e(D)&&(D=D.toInt()),(D&=63)===0?this:D<32?s(this.low<<D,this.high<<D|this.low>>>32-D,this.unsigned):s(0,this.low<<D-32,this.unsigned)},_.shl=_.shiftLeft,_.shiftRight=function(D){return e(D)&&(D=D.toInt()),(D&=63)===0?this:D<32?s(this.low>>>D|this.high<<32-D,this.high>>D,this.unsigned):s(this.high>>D-32,this.high>=0?0:-1,this.unsigned)},_.shr=_.shiftRight,_.shiftRightUnsigned=function(D){if(e(D)&&(D=D.toInt()),D&=63,D===0)return this;var O=this.high;if(D<32){var P=this.low;return s(P>>>D|O<<32-D,O>>>D,this.unsigned)}else return D===32?s(O,0,this.unsigned):s(O>>>D-32,0,this.unsigned)},_.shru=_.shiftRightUnsigned,_.shr_u=_.shiftRightUnsigned,_.toSigned=function(){return this.unsigned?s(this.low,this.high,!1):this},_.toUnsigned=function(){return this.unsigned?this:s(this.low,this.high,!0)},_.toBytes=function(D){return D?this.toBytesLE():this.toBytesBE()},_.toBytesLE=function(){var D=this.high,O=this.low;return[O&255,O>>>8&255,O>>>16&255,O>>>24,D&255,D>>>8&255,D>>>16&255,D>>>24]},_.toBytesBE=function(){var D=this.high,O=this.low;return[D>>>24,D>>>16&255,D>>>8&255,D&255,O>>>24,O>>>16&255,O>>>8&255,O&255]},t.fromBytes=function(D,O,P){return P?t.fromBytesLE(D,O):t.fromBytesBE(D,O)},t.fromBytesLE=function(D,O){return new t(D[0]|D[1]<<8|D[2]<<16|D[3]<<24,D[4]|D[5]<<8|D[6]<<16|D[7]<<24,O)},t.fromBytesBE=function(D,O){return new t(D[4]<<24|D[5]<<16|D[6]<<8|D[7],D[0]<<24|D[1]<<16|D[2]<<8|D[3],O)},aS}var Bz=tpt();const zz=Aj(Bz),ept=Nj({__proto__:null,default:zz},[Bz]);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oc=zz||ept;function gb(n){return oc.fromString(n,!0,16)}const Uz=gb("c3a5c85c97cb3127"),ec=gb("b492b66fbe98f273"),po=gb("9ae16a3b2f90404f");function kE(n){return n.xor(n.shru(47))}function Wz(n,t,e){const r=n.slice(t,t+e);return oc.fromBytes(Array.from(r),!0,!0)}function En(n,t){return Wz(n,t,8)}function p3(n,t){return Wz(n,t,4)}function kr(n,t){return t===0?n:n.shru(t).or(n.shl(64-t))}function Zu(n,t,e=gb("9ddfea08eb382d69")){let r=n.xor(t).mul(e);r=r.xor(r.shru(47));let o=t.xor(r).mul(e);return o=o.xor(o.shru(47)),o=o.mul(e),o}function npt(n,t,e,r,o,a){o=o.add(n),a=kr(a.add(o).add(r),21);const i=o;return o=o.add(t),o=o.add(e),a=a.add(kr(o,44)),[o.add(r),a.add(i)]}function qx(n,t,e,r){return npt(En(n,t),En(n,t+8),En(n,t+16),En(n,t+24),e,r)}function rpt(n,t=n.length){if(t>=8){const e=po.add(t*2),r=En(n,0).add(po),o=En(n,t-8),a=kr(o,37).mul(e).add(r),i=kr(r,25).add(o).mul(e);return Zu(a,i,e)}if(t>=4){const e=po.add(t*2),r=p3(n,0);return Zu(r.shl(3).add(t),p3(n,t-4),e)}if(t>0){const e=n[0],r=n[t>>1],o=n[t-1],a=e+(r<<8),i=t+(o<<2);return kE(po.mul(a).xor(Uz.mul(i))).mul(po)}return po}function opt(n,t=n.length){const e=po.add(t*2),r=En(n,0).mul(ec),o=En(n,8),a=En(n,t-8).mul(e),i=En(n,t-16).mul(po);return Zu(kr(r.add(o),43).add(kr(a,30)).add(i),r.add(kr(o.add(po),18)).add(a),e)}function apt(n,t=n.length){const e=po.add(t*2),r=En(n,0).mul(po),o=En(n,8),a=En(n,t-8).mul(e),i=En(n,t-16).mul(po),s=kr(r.add(o),43).add(kr(a,30)).add(i),u=Zu(s,r.add(kr(o.add(po),18)).add(a),e),l=En(n,16).mul(e),c=En(n,24),h=s.add(En(n,t-32)).mul(e),d=u.add(En(n,t-24)).mul(e);return Zu(kr(l.add(c),43).add(kr(h,30)).add(d),l.add(kr(c.add(r),18)).add(h),e)}function ipt(n,t=n.length){const e=oc.fromNumber(81,!0);if(t<=32)return t<=16?rpt(n,t):opt(n,t);if(t<=64)return apt(n,t);let r=e,o=e.mul(ec).add(113),a=kE(o.mul(po).add(113)).mul(po),i=[oc.UZERO,oc.UZERO],s=[oc.UZERO,oc.UZERO];r=r.mul(po).add(En(n,0));let u=0;const l=(t-1>>6)*64,c=l+(t-1&63)-63;do r=kr(r.add(o).add(i[0]).add(En(n,u+8)),37).mul(ec),o=kr(o.add(i[1]).add(En(n,u+48)),42).mul(ec),r=r.xor(s[1]),o=o.add(i[0]).add(En(n,u+40)),a=kr(a.add(s[0]),33).mul(ec),i=qx(n,u,i[1].mul(ec),r.add(s[0])),s=qx(n,u+32,a.add(s[1]),o.add(En(n,u+16))),[a,r]=[r,a],u+=64;while(u!==l);const h=ec.add(a.and(255).shl(1));return u=c,s[0]=s[0].add(t-1&63),i[0]=i[0].add(s[0]),s[0]=s[0].add(i[0]),r=kr(r.add(o).add(i[0]).add(En(n,u+8)),37).mul(h),o=kr(o.add(i[1]).add(En(n,u+48)),42).mul(h),r=r.xor(s[1].mul(9)),o=o.add(i[0].mul(9).add(En(n,u+40))),a=kr(a.add(s[0]),33).mul(h),i=qx(n,u,i[1].mul(h),r.add(s[0])),s=qx(n,u+32,a.add(s[1]),o.add(En(n,u+16))),[a,r]=[r,a],Zu(Zu(i[0],s[0],h).add(kE(o).mul(Uz)).add(a),Zu(i[1],s[1],h).add(r),h)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wl(n,t){return t==="string"?Ju(n):th([n],t)}function spt(n,t){return n instanceof Float32Array&&t==="float32"||n instanceof Int32Array&&t==="int32"||n instanceof Uint8Array&&t==="bool"}function th(n,t){if(t==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=Rc(n)),yt().getBool("DEBUG")&&Ldt(n,t),spt(n,t))return n;if(t==null||t==="float32"||t==="complex64")return new Float32Array(n);if(t==="int32")return new Int32Array(n);if(t==="bool"){const e=new Uint8Array(n.length);for(let r=0;r<e.length;++r)Math.round(n[r])!==0&&(e[r]=1);return e}else throw new Error(`Unknown data type ${t}`)}function Io(){return yt().platform.now()}function Ju(n,t="utf-8"){return t=t||"utf-8",yt().platform.encode(n,t)}function sl(n,t="utf-8"){return t=t||"utf-8",yt().platform.decode(n,t)}function Xa(n){return yt().platform.isTypedArray!=null?yt().platform.isTypedArray(n):Pz(n)}function Rc(n,t=[],e=!1){if(t==null&&(t=[]),typeof n=="boolean"||typeof n=="number"||typeof n=="string"||BI(n)||n==null||Xa(n)&&e)t.push(n);else if(Array.isArray(n)||Xa(n))for(let r=0;r<n.length;++r)Rc(n[r],t,e);else{let r=-1;for(const o of Object.keys(n))/^([1-9]+[0-9]*|0)$/.test(o)&&(r=Math.max(r,Number(o)));for(let o=0;o<=r;o++)Rc(n[o],t,e)}return t}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class upt{constructor(t,e){this.backendTimer=t,this.logger=e,e==null&&(this.logger=new cpt)}profileKernel(t,e,r){let o;const a=()=>{o=r()};let i;const s=Io();if(this.backendTimer.timerAvailable())i=this.backendTimer.time(a);else{a();for(const l of o)l.dataSync();i=Promise.resolve({kernelMs:Io()-s})}if(yt().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let l=0;l<o.length;l++){const c=o[l];c.data().then(h=>{lpt(h,c.dtype,t)})}return{kernelName:t,outputs:o,inputs:e,timeMs:i.then(l=>l.kernelMs),extraInfo:i.then(l=>l.getExtraProfileInfo!=null?l.getExtraProfileInfo():"")}}logKernelProfile(t){const{kernelName:e,outputs:r,timeMs:o,inputs:a,extraInfo:i}=t;r.forEach(s=>{Promise.all([s.data(),o,i]).then(u=>{this.logger.logKernelProfile(e,s,u[0],u[1],a,u[2])})})}}function lpt(n,t,e){if(t!=="float32")return!1;for(let r=0;r<n.length;r++){const o=n[r];if(isNaN(o)||!isFinite(o))return console.warn(`Found ${o} in the result of '${e}'`),!0}return!1}class cpt{logKernelProfile(t,e,r,o,a,i){const s=typeof o=="number"?kf(`${o}ms`,9):o.error,u=kf(t,25),l=e.rank,c=e.size,h=kf(e.shape.toString(),14);let d="";for(const p in a){const g=a[p];if(g!=null){const x=g.shape||e.shape,y=x.length;d+=`${p}: ${y}D ${y>0?x:""} `}}console.log(`%c${u}	%c${s}	%c${l}D ${h}	%c${c}	%c${d}	%c${i}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hpt(n,t,e){const r={},o={};for(let u=0;u<t.length;u++)r[t[u].id]=!0;for(let u=0;u<n.length;u++){const l=n[u],c=l.inputs;for(const h in c){const d=c[h];let p=!1;for(let g=0;g<t.length;g++)if(r[d.id]){l.outputs.forEach(x=>r[x.id]=!0),p=!0,o[l.id]=!0;break}if(p)break}}const a={};a[e.id]=!0;const i={};for(let u=n.length-1;u>=0;u--){const l=n[u],c=l.inputs;for(let h=0;h<l.outputs.length;h++)if(a[l.outputs[h].id]){for(const d in c)a[c[d].id]=!0,i[l.id]=!0;break}}const s=[];for(let u=0;u<n.length;u++){const l=n[u];if(o[l.id]&&i[l.id]){const c={};for(const d in l.inputs){const p=l.inputs[d];r[p.id]&&(c[d]=p)}const h=Object.assign({},l);h.inputs=c,h.outputs=l.outputs,s.push(h)}}return s}function fpt(n,t,e,r){for(let o=t.length-1;o>=0;o--){const a=t[o],i=[];if(a.outputs.forEach(u=>{const l=n[u.id];l!=null?i.push(l):i.push(null)}),a.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${a.kernelName}.`);const s=a.gradient(i);for(const u in a.inputs){if(!(u in s))throw new Error(`Cannot backprop through input ${u}. Available gradients found: ${Object.keys(s)}.`);const l=e(()=>s[u]());if(l.dtype!=="float32")throw new Error(`Error in gradient for op ${a.kernelName}. The gradient of input ${u} must have 'float32' dtype, but has '${l.dtype}'`);const c=a.inputs[u];if(!tn(l.shape,c.shape))throw new Error(`Error in gradient for op ${a.kernelName}. The gradient of input '${u}' has shape '${l.shape}', which does not match the shape of the input '${c.shape}'`);if(n[c.id]==null)n[c.id]=l;else{const h=n[c.id];n[c.id]=r(h,l),h.dispose()}}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m3=20,$p=3,iS=7;function dpt(n,t,e,r){const o=ue(t),a=ppt(n,t,e,o),i=t.length,s=c0(n,t,e,o,a),u=["Tensor"];return r&&(u.push(`  dtype: ${e}`),u.push(`  rank: ${i}`),u.push(`  shape: [${t}]`),u.push("  values:")),u.push(s.map(l=>"    "+l).join(`
`)),u.join(`
`)}function ppt(n,t,e,r){const o=It(t),a=r[r.length-1],i=new Array(a).fill(0),s=t.length,u=e==="complex64"?Wp(n):n;if(s>1)for(let l=0;l<o/a;l++){const c=l*a;for(let h=0;h<a;h++)i[h]=Math.max(i[h],Up(u[c+h],0,e).length)}return i}function Up(n,t,e){let r;return Array.isArray(n)?r=`${parseFloat(n[0].toFixed(iS))} + ${parseFloat(n[1].toFixed(iS))}j`:qm(n)?r=`'${n}'`:e==="bool"?r=Vz(n):r=parseFloat(n.toFixed(iS)).toString(),kf(r,t)}function Vz(n){return n===0?"false":"true"}function c0(n,t,e,r,o,a=!0){const i=e==="complex64"?2:1,s=t[0],u=t.length;if(u===0){if(e==="complex64"){const x=Wp(n);return[Up(x[0],0,e)]}return e==="bool"?[Vz(n[0])]:[n[0].toString()]}if(u===1){if(s>m3){const y=$p*i;let b=Array.from(n.slice(0,y)),C=Array.from(n.slice((s-$p)*i,s*i));return e==="complex64"&&(b=Wp(b),C=Wp(C)),["["+b.map((E,S)=>Up(E,o[S],e)).join(", ")+", ..., "+C.map((E,S)=>Up(E,o[s-$p+S],e)).join(", ")+"]"]}return["["+(e==="complex64"?Wp(n):Array.from(n)).map((y,b)=>Up(y,o[b],e)).join(", ")+"]"]}const l=t.slice(1),c=r.slice(1),h=r[0]*i,d=[];if(s>m3){for(let x=0;x<$p;x++){const y=x*h,b=y+h;d.push(...c0(n.slice(y,b),l,e,c,o,!1))}d.push("...");for(let x=s-$p;x<s;x++){const y=x*h,b=y+h;d.push(...c0(n.slice(y,b),l,e,c,o,x===s-1))}}else for(let x=0;x<s;x++){const y=x*h,b=y+h;d.push(...c0(n.slice(y,b),l,e,c,o,x===s-1))}const p=u===2?",":"";d[0]="["+(s>0?d[0]+p:"");for(let x=1;x<d.length-1;x++)d[x]=" "+d[x]+p;let g=`,
`;for(let x=2;x<u;x++)g+=`
`;return d[d.length-1]=" "+d[d.length-1]+"]"+(a?"":g),d}function Wp(n){const t=[];for(let e=0;e<n.length;e+=2)t.push([n[e],n[e+1]]);return t}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ur{constructor(t,e,r){if(this.dtype=e,this.shape=t.slice(),this.size=It(t),r!=null){const o=r.length;H(o===this.size,()=>`Length of values '${o}' does not match the size inferred by the shape '${this.size}'.`)}if(e==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||Qn(e,this.size),this.strides=ue(t)}set(t,...e){e.length===0&&(e=[0]),H(e.length===this.rank,()=>`The number of provided coordinates (${e.length}) must match the rank (${this.rank})`);const r=this.locToIndex(e);this.values[r]=t}get(...t){t.length===0&&(t=[0]);let e=0;for(const o of t){if(o<0||o>=this.shape[e]){const a=`Requested out of range element at ${t}.   Buffer shape=${this.shape}`;throw new Error(a)}e++}let r=t[t.length-1];for(let o=0;o<t.length-1;++o)r+=this.strides[o]*t[o];return this.values[r]}locToIndex(t){if(this.rank===0)return 0;if(this.rank===1)return t[0];let e=t[t.length-1];for(let r=0;r<t.length-1;++r)e+=this.strides[r]*t[r];return e}indexToLoc(t){if(this.rank===0)return[];if(this.rank===1)return[t];const e=new Array(this.shape.length);for(let r=0;r<e.length-1;++r)e[r]=Math.floor(t/this.strides[r]),t-=e[r]*this.strides[r];return e[e.length-1]=t,e}get rank(){return this.shape.length}toTensor(){return ii().makeTensor(this.values,this.shape,this.dtype)}}let ii=null,hf=null;function mpt(n){ii=n}function gpt(n){hf=n}class pr{constructor(t,e,r,o){this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=e||"float32",this.size=It(t),this.strides=ue(t),this.dataId=r,this.id=o,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const t=await this.data();return hf.buffer(this.shape,this.dtype,t)}bufferSync(){return hf.buffer(this.shape,this.dtype,this.dataSync())}async array(){const t=await this.data();return pi(this.shape,t,this.dtype==="complex64")}arraySync(){return pi(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();const t=ii().read(this.dataId);if(this.dtype==="string"){const e=await t;try{return e.map(r=>sl(r))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return t}dataToGPU(t){return this.throwIfDisposed(),ii().readToGPU(this.dataId,t)}dataSync(){this.throwIfDisposed();const t=ii().readSync(this.dataId);if(this.dtype==="string")try{return t.map(e=>sl(e))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return t}async bytes(){this.throwIfDisposed();const t=await ii().read(this.dataId);return this.dtype==="string"?t:new Uint8Array(t.buffer)}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),ii().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(t=!1){return hf.print(this,t)}clone(){return this.throwIfDisposed(),hf.clone(this)}toString(t=!1){const e=this.dataSync();return dpt(e,this.shape,this.dtype,t)}cast(t){return this.throwIfDisposed(),hf.cast(this,t)}variable(t=!0,e,r){return this.throwIfDisposed(),ii().makeVariable(this,t,e,r)}}Object.defineProperty(pr,Symbol.hasInstance,{value:n=>!!n&&n.data!=null&&n.dataSync!=null&&n.throwIfDisposed!=null});function Et(){return zI("Tensor",()=>pr)}Et();class wy extends pr{constructor(t,e,r,o){super(t.shape,t.dtype,t.dataId,o),this.trainable=e,this.name=r}assign(t){if(t.dtype!==this.dtype)throw new Error(`dtype of the new value (${t.dtype}) and previous value (${this.dtype}) must match`);if(!tn(t.shape,this.shape))throw new Error(`shape of the new value (${t.shape}) and previous value (${this.shape}) must match`);ii().disposeTensor(this),this.dataId=t.dataId,ii().incRef(this,null)}dispose(){ii().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty(wy,Symbol.hasInstance,{value:n=>n instanceof pr&&n.assign!=null&&n.assign instanceof Function});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var g3;(function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"})(g3||(g3={}));var IE;(function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"})(IE||(IE={}));var RE;(function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"})(RE||(RE={}));var TE;(function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"})(TE||(TE={}));var NE;(function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"})(NE||(NE={}));const vpt={float32:TE,int32:IE,bool:RE,complex64:NE};function Yo(n,t){if(n==="string"||t==="string"){if(n==="string"&&t==="string")return"string";throw new Error(`Can not upcast ${n} with ${t}`)}return vpt[n][t]}function TR(n){return Yo(n,"int32")}function Gz(n){return n!=null&&typeof n=="object"&&"texture"in n&&n.texture instanceof WebGLTexture}function Hz(n){return typeof GPUBuffer<"u"&&n!=null&&typeof n=="object"&&"buffer"in n&&n.buffer instanceof GPUBuffer}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jn(n,t){if(n.dtype===t.dtype)return[n,t];const e=Yo(n.dtype,t.dtype);return[n.cast(e),t.cast(e)]}function qz(n){const t=[];return jz(n,t,new Set),t}function jz(n,t,e){if(n==null)return;if(n instanceof pr){t.push(n);return}if(!xpt(n))return;const r=n;for(const o in r){const a=r[o];e.has(a)||(e.add(a),jz(a,t,e))}}function xpt(n){return Array.isArray(n)||typeof n=="object"}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sS(n){return n.kernelName!=null}class v3{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(t=>t.name)))}}}dispose(){for(const t in this.registeredVariables)this.registeredVariables[t].dispose()}}class Wf{constructor(t){this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new v3}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;const t=this.getSortedBackends();for(let e=0;e<t.length;e++){const r=t[e];if(await this.initializeBackend(r).success){await this.setBackend(r);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){const{name:t,asyncInit:e}=this.initializeBackendsAndReturnBest();if(e)throw new Error(`The highest priority backend '${t}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(t)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(t){if(!(t in this.registry))if(t in this.registryFactory){const{asyncInit:e}=this.initializeBackend(t);if(e)return null}else return null;return this.registry[t]}findBackendFactory(t){return t in this.registryFactory?this.registryFactory[t].factory:null}registerBackend(t,e,r=1){return t in this.registryFactory?(pa(`${t} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[t]={factory:e,priority:r},!0)}async setBackend(t){if(this.registryFactory[t]==null)throw new Error(`Backend name '${t}' not found in registry`);if(this.backendName=t,this.registry[t]==null){this.backendInstance=null;const{success:e,asyncInit:r}=this.initializeBackend(t);if(!(r?await e:e))return!1}return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new upt(this.backendInstance),!0}setupRegisteredKernels(){f3(this.backendName).forEach(e=>{e.setupFunc!=null&&e.setupFunc(this.backendInstance)})}disposeRegisteredKernels(t){f3(t).forEach(r=>{r.disposeFunc!=null&&r.disposeFunc(this.registry[t])})}initializeBackend(t){const e=this.registryFactory[t];if(e==null)throw new Error(`Cannot initialize backend ${t}, no registration found.`);try{const r=e.factory();if(r&&!(r instanceof FI)&&typeof r.then=="function"){const o=++this.pendingBackendInitId,a=r.then(i=>o<this.pendingBackendInitId?!1:(this.registry[t]=i,this.pendingBackendInit=null,!0)).catch(i=>(o<this.pendingBackendInitId||(this.pendingBackendInit=null,pa(`Initialization of backend ${t} failed`),pa(i.stack||i.message)),!1));return this.pendingBackendInit=a,{success:a,asyncInit:!0}}else return this.registry[t]=r,{success:!0,asyncInit:!1}}catch(r){return pa(`Initialization of backend ${t} failed`),pa(r.stack||r.message),{success:!1,asyncInit:!1}}}removeBackend(t){if(!(t in this.registryFactory))throw new Error(`${t} backend not found in registry`);this.backendName===t&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,t in this.registry&&(this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t]),delete this.registryFactory[t],this.backendName===t&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((t,e)=>this.registryFactory[e].priority-this.registryFactory[t].priority)}initializeBackendsAndReturnBest(){const t=this.getSortedBackends();for(let e=0;e<t.length;e++){const r=t[e],{success:o,asyncInit:a}=this.initializeBackend(r);if(a||o)return{name:r,asyncInit:a}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(t,e){const r=this.state.tensorInfo.get(e),o=r.backend,a=this.readSync(e),i=o.refCount(e);o.disposeData(e,!0),r.backend=t,t.move(e,a,r.shape,r.dtype,i),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(t,e){let r=null;if(e==null){if(typeof t!="function")throw new Error("Please provide a function to tidy()");e=t}else{if(typeof t!="string"&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof e!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");r=t}let o;return this.scopedRun(()=>this.startScope(r),()=>this.endScope(o),()=>(o=e(),o instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),o))}scopedRun(t,e,r){t();try{const o=r();return e(),o}catch(o){throw e(),o}}nextTensorId(){return Wf.nextTensorId++}nextVariableId(){return Wf.nextVariableId++}clone(t){const e=ut.runKernel(dg,{x:t}),r={x:t},o=i=>({x:()=>{const s="float32",u={x:i},l={dtype:s};return ut.runKernel(tg,u,l)}}),a=[];return this.addTapeNode(this.state.activeScope.name,r,[e],o,a,{}),e}runKernel(t,e,r){if(this.backendName==null&&this.backend,!(c3(t,this.backendName)!=null))throw new Error(`Kernel '${t}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:t,inputs:e,attrs:r})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(t,e,r){const o=this.backend.numDataIds();let a=0;r.forEach(u=>{a+=u.dtype==="complex64"?3:1});const i=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=o-e-a-i;if(s>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${s} data ids) after running '${t}'`)}runKernelFunc(t){let e,r=[];const o=this.isTapeOn(),a=this.state.numBytes,i=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let s;this.backendName==null&&this.backend;let u;const l=sS(t)?t.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(sS(t)){const{kernelName:g,inputs:x,attrs:y}=t;this.backendName==null&&this.backend;const b=c3(g,this.backendName);H(b!=null,()=>`Cannot find registered kernel '${g}' for backend '${this.backendName}'`),s=()=>{const C=this.backend.numDataIds();u=b.kernelFunc({inputs:x,attrs:y,backend:this.backend});const E=Array.isArray(u)?u:[u];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(g,C,E);const S=E.map(k=>k.rank!=null?k:this.makeTensorFromTensorInfo(k));if(o){const k=this.getTensorsForGradient(g,x,S);r=this.saveTensorsForBackwardMode(k)}return S}}else{const{forwardFunc:g}=t,x=y=>{o&&(r=y.map(b=>this.keep(this.clone(b))))};s=()=>{const y=this.backend.numDataIds();u=this.tidy(()=>g(this.backend,x));const b=Array.isArray(u)?u:[u];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(l,y,b),b}}const{inputs:c,attrs:h}=t,d=sS(t)?null:t.backwardsFunc;let p;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?e=s():(p=this.profiler.profileKernel(l,c,()=>s()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(p),e=p.outputs)}),o&&this.addTapeNode(l,c,e,d,r,h),this.state.profiling&&this.state.activeProfile.kernels.push({name:l,bytesAdded:this.state.numBytes-a,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-i,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(c).map(g=>c[g]!=null?c[g].shape:null),outputShapes:e.map(g=>g.shape),kernelTimeMs:p.timeMs,extraInfo:p.extraInfo}),Array.isArray(u)?e:e[0]}saveTensorsForBackwardMode(t){return t.map(r=>this.keep(this.clone(r)))}getTensorsForGradient(t,e,r){const o=h3(t);if(o!=null){const a=o.inputsToSave||[],i=o.outputsToSave||[];let s;o.saveAllInputs?(H(Array.isArray(e),()=>"saveAllInputs is true, expected inputs to be an array."),s=Object.keys(e).map(l=>e[l])):s=a.map(l=>e[l]);const u=r.filter((l,c)=>i[c]);return s.concat(u)}return[]}makeTensor(t,e,r,o){if(t==null)throw new Error("Values passed to engine.makeTensor() are null");r=r||"float32",o=o||this.backend;let a=t;r==="string"&&qm(t[0])&&(a=t.map(u=>Ju(u)));const i=o.write(a,e,r),s=new pr(e,r,i,this.nextTensorId());if(this.trackTensor(s,o),r==="string"){const u=this.state.tensorInfo.get(i),l=Bdt(a);this.state.numBytes+=l-u.bytes,u.bytes=l}return s}makeTensorFromDataId(t,e,r,o){r=r||"float32";const a={dataId:t,shape:e,dtype:r};return this.makeTensorFromTensorInfo(a,o)}makeTensorFromTensorInfo(t,e){const{dataId:r,shape:o,dtype:a}=t,i=new pr(o,a,r,this.nextTensorId());return this.trackTensor(i,e),i}makeVariable(t,e=!0,r,o){r=r||this.nextVariableId().toString(),o!=null&&o!==t.dtype&&(t=t.cast(o));const a=new wy(t,e,r,this.nextTensorId());if(this.state.registeredVariables[a.name]!=null)throw new Error(`Variable with name ${a.name} was already registered`);return this.state.registeredVariables[a.name]=a,this.incRef(a,this.backend),a}trackTensor(t,e){this.state.numTensors++,t.dtype==="string"&&this.state.numStringTensors++;let r=0;t.dtype!=="complex64"&&t.dtype!=="string"&&(r=t.size*vy(t.dtype)),this.state.numBytes+=r,this.state.tensorInfo.has(t.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(t.dataId,{backend:e||this.backend,dtype:t.dtype,shape:t.shape,bytes:r})),t instanceof wy||this.track(t)}incRef(t,e){this.trackTensor(t,e),this.backend.incRef(t.dataId)}removeDataId(t,e){this.state.tensorInfo.has(t)&&this.state.tensorInfo.get(t).backend===e&&(this.state.tensorInfo.delete(t),this.state.numDataBuffers--)}disposeTensor(t){if(!this.state.tensorInfo.has(t.dataId))return;const e=this.state.tensorInfo.get(t.dataId);if(this.state.numTensors--,t.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=e.bytes),t.dtype!=="complex64"&&t.dtype!=="string"){const r=t.size*vy(t.dtype);this.state.numBytes-=r}e.backend.disposeData(t.dataId)&&this.removeDataId(t.dataId,e.backend)}disposeVariables(){for(const t in this.state.registeredVariables){const e=this.state.registeredVariables[t];this.disposeVariable(e)}}disposeVariable(t){this.disposeTensor(t),this.state.registeredVariables[t.name]!=null&&delete this.state.registeredVariables[t.name]}memory(){const t=this.backend.memory();return t.numTensors=this.state.numTensors,t.numDataBuffers=this.state.numDataBuffers,t.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(t.unreliable=!0,t.reasons==null&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t}async profile(t){this.state.profiling=!0;const e=this.state.numBytes,r=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await t(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(o=>o.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-e,this.state.activeProfile.newTensors=this.state.numTensors-r;for(const o of this.state.activeProfile.kernels)o.kernelTimeMs=await o.kernelTimeMs,o.extraInfo=await o.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(t,e,r,o,a,i){const s={id:this.state.nextTapeNodeId++,kernelName:t,inputs:e,outputs:r,saved:a},u=h3(t);u!=null&&(o=u.gradFunc),o!=null&&(s.gradient=l=>(l=l.map((c,h)=>{if(c==null){const d=r[h],p=to(d.size,d.dtype);return this.makeTensor(p,d.shape,d.dtype)}return c}),o(l.length>1?l:l[0],a,i))),this.state.activeTape.push(s)}keep(t){return t.kept=!0,t}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(t){const e={track:[],name:"unnamed scope",id:this.state.nextScopeId++};t&&(e.name=t),this.state.scopeStack.push(e),this.state.activeScope=e}endScope(t){const e=qz(t),r=new Set(e.map(a=>a.id));for(let a=0;a<this.state.activeScope.track.length;a++){const i=this.state.activeScope.track[a];!i.kept&&!r.has(i.id)&&i.dispose()}const o=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],e.forEach(a=>{!a.kept&&a.scopeId===o.id&&this.track(a)})}gradients(t,e,r,o=!1){if(H(e.length>0,()=>"gradients() received an empty list of xs."),r!=null&&r.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${r.dtype}'`);const a=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",t));H(a instanceof pr,()=>"The result y returned by f() must be a tensor.");const i=hpt(this.state.activeTape,e,a);if(!o&&i.length===0&&e.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const s={};s[a.id]=r??ypt(a.shape),fpt(s,i,l=>this.tidy(l),bpt);const u=e.map(l=>s[l.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(l=>{for(const c of l.saved)c.dispose()}),this.state.activeTape=null),{value:a,grads:u}})}customGrad(t){return H(bE(t),()=>"The f passed in customGrad(f) must be a function."),(...e)=>{H(e.every(s=>s instanceof pr),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let r;const o={};e.forEach((s,u)=>{o[u]=s});const a=(s,u)=>(r=t(...e,u),H(r.value instanceof pr,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),H(bE(r.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),r.value),i=(s,u)=>{const l=r.gradFunc(s,u),c=Array.isArray(l)?l:[l];H(c.length===e.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),H(c.every(d=>d instanceof pr),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const h={};return c.forEach((d,p)=>{h[p]=()=>d}),h};return this.runKernelFunc({forwardFunc:a,backwardsFunc:i,inputs:o})}}readSync(t){return this.state.tensorInfo.get(t).backend.readSync(t)}read(t){return this.state.tensorInfo.get(t).backend.read(t)}readToGPU(t,e){return this.state.tensorInfo.get(t).backend.readToGPU(t,e)}async time(t){const e=Io(),r=await this.backend.time(t);return r.wallMs=Io()-e,r}track(t){return this.state.activeScope!=null&&(t.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(t)),t}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new v3;for(const t in this.registry)this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}Wf.nextTensorId=0;Wf.nextVariableId=0;function ypt(n){const t=PI(It(n),"float32");return ut.makeTensor(t,n,"float32")}function Xz(){const n=pz();if(n._tfengine==null){const t=new Wdt(n);n._tfengine=new Wf(t)}return qdt(n._tfengine.ENV),mpt(()=>n._tfengine),n._tfengine}const ut=Xz();function bpt(n,t){const e={a:n,b:t};return ut.runKernel(hd,e)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wpt(){return typeof navigator<"u"&&navigator!=null}function Kz(n){if(n||wpt()){if(n||(n=navigator),n.product==="ReactNative")return!0;const t=n.userAgent||n.vendor||(typeof window<"u"?window.opera:"");if(!t){const e=n;return e.userAgentData&&e.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))}return!1}function Yz(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Do=yt();Do.registerFlag("DEBUG",()=>!1,n=>{n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});Do.registerFlag("IS_BROWSER",()=>Yz());Do.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");Do.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));Do.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor));Do.registerFlag("PROD",()=>!1);Do.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>Do.getBool("DEBUG"));Do.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);Do.registerFlag("IS_TEST",()=>!1);Do.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>Do.getBool("DEBUG"));Do.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);Do.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);Do.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vb(n,t){let e=n;if(Xa(n))return t==="string"?[]:[n.length];if(Gz(n)){const o=n.channels||"RGBA";return[n.height,n.width*o.length]}else if(Hz(n))return[n.buffer.size/(t==null?4:vy(t))];if(!Array.isArray(n))return[];const r=[];for(;Array.isArray(e)||Xa(e)&&t!=="string";)r.push(e.length),e=e[0];return Array.isArray(n)&&yt().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&Qz(n,r,[]),r}function Qz(n,t,e){if(e=e||[],!Array.isArray(n)&&!Xa(n)){H(t.length===0,()=>`Element arr[${e.join("][")}] is a primitive, but should be an array/TypedArray of ${t[0]} elements`);return}H(t.length>0,()=>`Element arr[${e.join("][")}] should be a primitive, but is an array of ${n.length} elements`),H(n.length===t[0],()=>`Element arr[${e.join("][")}] should have ${t[0]} elements, but has ${n.length} elements`);const r=t.slice(1);for(let o=0;o<n.length;++o)Qz(n[o],r,e.concat(o))}function x3(n,t,e,r){if(n!=="string_or_numeric"){if(n==null)throw new Error("Expected dtype cannot be null.");if(n!=="numeric"&&n!==t||n==="numeric"&&t==="string")throw new Error(`Argument '${e}' passed to '${r}' must be ${n} tensor, but got ${t} tensor`)}}function J(n,t,e,r="numeric"){if(n instanceof Et())return x3(r,n.dtype,t,e),n;let o=ld(n);if(o!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(o=r),x3(r,o,t,e),n==null||!Xa(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){const u=n==null?"null":n.constructor.name;throw new Error(`Argument '${t}' passed to '${e}' must be a Tensor or TensorLike, but got '${u}'`)}const a=vb(n,o);!Xa(n)&&!Array.isArray(n)&&(n=[n]);const s=o!=="string"?th(n,o):Rc(n,[],!0);return ut.makeTensor(s,a,o)}function Zz(n,t,e,r="numeric"){if(!Array.isArray(n))throw new Error(`Argument ${t} passed to ${e} must be a \`Tensor[]\` or \`TensorLike[]\``);return n.map((a,i)=>J(a,`${t}[${i}]`,e,r))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cpt="__op";function ft(n){const t=Object.keys(n);if(t.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${t.length} keys.`);let e=t[0];const r=n[e];e.endsWith("_")&&(e=e.substring(0,e.length-1)),e=e+Cpt;const o=(...a)=>{ut.startScope(e);try{const i=r(...a);return BI(i)&&console.error("Cannot return a Promise inside of tidy."),ut.endScope(i),i}catch(i){throw ut.endScope(null),i}};return Object.defineProperty(o,"name",{value:e,configurable:!0}),o}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Spt(n,t){const e=J(n,"real","complex"),r=J(t,"imag","complex");LI(e.shape,r.shape,`real and imag shapes, ${e.shape} and ${r.shape}, must match in call to tf.complex().`);const o={real:e,imag:r};return ut.runKernel(XI,o)}const Vf=ft({complex_:Spt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xb(n,t,e,r){if(r==null)r=ld(n);else if(r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(Hz(n)||Gz(n)){if(r!=="float32"&&r!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${r}.`);return ut.backend.createTensorFromGPUData(n,t||e,r)}if(!Xa(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(t!=null){cu(t);const o=It(t),a=It(e);H(o===a,()=>`Based on the provided shape, [${t}], the tensor should have ${o} values but has ${a}`);for(let i=0;i<e.length;++i){const s=e[i],u=i===e.length-1?s!==It(t.slice(i)):!0;H(e[i]===t[i]||!u,()=>`Error creating a new Tensor. Inferred shape (${e}) does not match the provided shape (${t}). `)}}return!Xa(n)&&!Array.isArray(n)&&(n=[n]),t=t||e,n=r!=="string"?th(n,r):Rc(n,[],!0),ut.makeTensor(n,t,r)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jz(n,t,e){const r=vb(n,e);return xb(n,t,r,e)}class fd{static join(t){return new fd(t).slice()}constructor(t){if(this.shards=[],this.previousShardIndex=0,t==null||(t instanceof Array||(t=[t]),t=t.map(r=>Xa(r)?r.buffer:r),t.length===0))return;this.bufferUniformSize=t[0].byteLength;let e=0;for(let r=0;r<t.length;r++){const o=t[r];r!==t.length-1&&o.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);const a=e+o.byteLength;this.shards.push({buffer:o,start:e,end:a}),e=a}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(t=0,e=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(t=isNaN(Number(t))?0:t,e=isNaN(Number(e))?0:e,t=Math.max(0,t),e=Math.min(this.byteLength,e),e<=t)return new ArrayBuffer(0);const r=this.findShardForByte(t);if(r===-1)throw new Error(`Could not find start shard for byte ${t}`);const o=e-t,a=new ArrayBuffer(o),i=new Uint8Array(a);let s=0;for(let u=r;u<this.shards.length;u++){const l=this.shards[u],h=t+s-l.start,d=s,g=Math.min(e,l.end)-l.start,x=new Uint8Array(l.buffer,h,g-h);if(i.set(x,d),s+=x.length,e<l.end)break}return a}findShardForByte(t){if(this.shards.length===0||t<0||t>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(t/this.bufferUniformSize),this.previousShardIndex;function e(o){return t<o.start?-1:t>=o.end?1:0}if(e(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;const r=Ept(this.shards,e);return r===-1?-1:(this.previousShardIndex=r,this.previousShardIndex)}}function Ept(n,t){let e=0,r=n.length;for(;e<=r;){const o=Math.floor((r-e)/2)+e,a=t(n[o]);if(a===0)return o;a<0?r=o:e=o+1}return-1}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fi(){return ut}function y3(){return ut.memory()}function gt(n,t){return ut.tidy(n,t)}function Oe(n){qz(n).forEach(e=>e.dispose())}function Yi(n){return ut.keep(n)}function kpt(n){return ut.setBackend(n)}function tU(n,t,e=1){return ut.registerBackend(n,t,e)}function Ipt(){return ut.backend}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const b3=4;async function w3(n,t){const e=[],r=[],o=Array.isArray(n)?n.map(i=>i.name):Object.keys(n);for(let i=0;i<o.length;++i){const s=o[i],u=Array.isArray(n)?n[i].tensor:n[s];if(u.dtype!=="float32"&&u.dtype!=="int32"&&u.dtype!=="bool"&&u.dtype!=="string"&&u.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${s}': ${u.dtype}`);const l={name:s,shape:u.shape,dtype:u.dtype};if(u.dtype==="string"){const c=new Promise(async h=>{const d=await u.bytes(),p=d.reduce((y,b)=>y+b.length,0)+b3*d.length,g=new Uint8Array(p);let x=0;for(let y=0;y<d.length;y++){const b=d[y],C=new Uint8Array(new Uint32Array([b.length]).buffer);g.set(C,x),x+=b3,g.set(b,x),x+=b.length}h(g)});r.push(c)}else r.push(u.data());t!=null&&(l.group=t),e.push(l)}const a=await Promise.all(r);return{data:Rpt(a),specs:e}}function Rpt(n){if(n===null)throw new Error(`Invalid input value: ${JSON.stringify(n)}`);let t=0;const e=[];n.forEach(a=>{if(t+=a.byteLength,e.push(a.byteLength===a.buffer.byteLength?a:new a.constructor(a)),!(a instanceof Float32Array||a instanceof Int32Array||a instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${a.constructor.name}`)});const r=new Uint8Array(t);let o=0;return e.forEach(a=>{r.set(new Uint8Array(a.buffer),o),o+=a.byteLength}),r.buffer}const NR=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function C3(n){return NR?Buffer.byteLength(n,"utf8"):new Blob([n]).size}function Tpt(n){if(NR)return Buffer.from(n).toString("base64");const t=new Uint8Array(n);let e="";for(let r=0,o=t.length;r<o;r++)e+=String.fromCharCode(t[r]);return btoa(e)}function Npt(n){if(NR){const r=Buffer.from(n,"base64");return r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength)}const t=atob(n),e=new Uint8Array(t.length);for(let r=0;r<t.length;++r)e.set([t.charCodeAt(r)],r);return e.buffer}function Apt(n){return fd.join(n)}function eU(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:n.modelTopology==null?0:C3(JSON.stringify(n.modelTopology)),weightSpecsBytes:n.weightSpecs==null?0:C3(JSON.stringify(n.weightSpecs)),weightDataBytes:n.weightData==null?0:new fd(n.weightData).byteLength}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lo{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return lo.instance==null&&(lo.instance=new lo),lo.instance}static registerSaveRouter(t){lo.getInstance().saveRouters.push(t)}static registerLoadRouter(t){lo.getInstance().loadRouters.push(t)}static getSaveHandlers(t){return lo.getHandlers(t,"save")}static getLoadHandlers(t,e){return lo.getHandlers(t,"load",e)}static getHandlers(t,e,r){const o=[];return(e==="load"?lo.getInstance().loadRouters:lo.getInstance().saveRouters).forEach(i=>{const s=i(t,r);s!==null&&o.push(s)}),o}}const _pt=n=>lo.getSaveHandlers(n);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AE="tensorflowjs",_E=1,hc="models_store",ju="model_info_store";function nU(){if(!yt().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const n=typeof window>"u"?self:window,t=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(t==null)throw new Error("The current browser does not appear to support IndexedDB.");return t}function DE(n){const t=n.result;t.createObjectStore(hc,{keyPath:"modelPath"}),t.createObjectStore(ju,{keyPath:"modelPath"})}class Tc{constructor(t){if(this.indexedDB=nU(),t==null||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,t)}async load(){return this.databaseAction(this.modelPath)}databaseAction(t,e){return new Promise((r,o)=>{const a=this.indexedDB.open(AE,_E);a.onupgradeneeded=()=>DE(a),a.onsuccess=()=>{const i=a.result;if(e==null){const s=i.transaction(hc,"readonly"),l=s.objectStore(hc).get(this.modelPath);l.onsuccess=()=>{if(l.result==null)return i.close(),o(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));r(l.result.modelArtifacts)},l.onerror=c=>(i.close(),o(l.error)),s.oncomplete=()=>i.close()}else{e.weightData=fd.join(e.weightData);const s=eU(e),u=i.transaction(ju,"readwrite");let l=u.objectStore(ju),c;try{c=l.put({modelPath:this.modelPath,modelArtifactsInfo:s})}catch(d){return o(d)}let h;c.onsuccess=()=>{h=i.transaction(hc,"readwrite");const d=h.objectStore(hc);let p;try{p=d.put({modelPath:this.modelPath,modelArtifacts:e,modelArtifactsInfo:s})}catch(g){return o(g)}p.onsuccess=()=>r({modelArtifactsInfo:s}),p.onerror=g=>{l=u.objectStore(ju);const x=l.delete(this.modelPath);x.onsuccess=()=>(i.close(),o(p.error)),x.onerror=y=>(i.close(),o(p.error))}},c.onerror=d=>(i.close(),o(c.error)),u.oncomplete=()=>{h==null?i.close():h.oncomplete=()=>i.close()}}},a.onerror=i=>o(a.error)})}}Tc.URL_SCHEME="indexeddb://";const rU=n=>yt().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Tc.URL_SCHEME)?Dpt(n.slice(Tc.URL_SCHEME.length)):null;lo.registerSaveRouter(rU);lo.registerLoadRouter(rU);function Dpt(n){return new Tc(n)}function $pt(n){return n.startsWith(Tc.URL_SCHEME)?n.slice(Tc.URL_SCHEME.length):n}class Opt{constructor(){this.indexedDB=nU()}async listModels(){return new Promise((t,e)=>{const r=this.indexedDB.open(AE,_E);r.onupgradeneeded=()=>DE(r),r.onsuccess=()=>{const o=r.result,a=o.transaction(ju,"readonly"),s=a.objectStore(ju).getAll();s.onsuccess=()=>{const u={};for(const l of s.result)u[l.modelPath]=l.modelArtifactsInfo;t(u)},s.onerror=u=>(o.close(),e(s.error)),a.oncomplete=()=>o.close()},r.onerror=o=>e(r.error)})}async removeModel(t){return t=$pt(t),new Promise((e,r)=>{const o=this.indexedDB.open(AE,_E);o.onupgradeneeded=()=>DE(o),o.onsuccess=()=>{const a=o.result,i=a.transaction(ju,"readwrite"),s=i.objectStore(ju),u=s.get(t);let l;u.onsuccess=()=>{if(u.result==null)return a.close(),r(new Error(`Cannot find model with path '${t}' in IndexedDB.`));{const c=s.delete(t),h=()=>{l=a.transaction(hc,"readwrite");const p=l.objectStore(hc).delete(t);p.onsuccess=()=>e(u.result.modelArtifactsInfo),p.onerror=g=>r(u.error)};c.onsuccess=h,c.onerror=d=>(h(),a.close(),r(u.error))}},u.onerror=c=>(a.close(),r(u.error)),i.oncomplete=()=>{l==null?a.close():l.oncomplete=()=>a.close()}},o.onerror=a=>r(o.error)})}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Us="/",ff="tensorflowjs_models",oU="info",Fpt="model_topology",Mpt="weight_specs",Lpt="weight_data",Ppt="model_metadata";function aU(n){return{info:[ff,n,oU].join(Us),topology:[ff,n,Fpt].join(Us),weightSpecs:[ff,n,Mpt].join(Us),weightData:[ff,n,Lpt].join(Us),modelMetadata:[ff,n,Ppt].join(Us)}}function iU(n){for(const t of Object.values(n))window.localStorage.removeItem(t)}function Bpt(n){const t=n.split(Us);if(t.length<3)throw new Error(`Invalid key format: ${n}`);return t.slice(1,t.length-1).join(Us)}function zpt(n){return n.startsWith(Nc.URL_SCHEME)?n.slice(Nc.URL_SCHEME.length):n}class Nc{constructor(t){if(!yt().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,t==null||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=aU(this.modelPath)}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const e=JSON.stringify(t.modelTopology),r=JSON.stringify(t.weightSpecs),o=eU(t),a=fd.join(t.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(o)),this.LS.setItem(this.keys.topology,e),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,Tpt(a));const i={format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,signature:t.signature!=null?t.signature:void 0,userDefinedMetadata:t.userDefinedMetadata!=null?t.userDefinedMetadata:void 0,modelInitializer:t.modelInitializer!=null?t.modelInitializer:void 0,initializerSignature:t.initializerSignature!=null?t.initializerSignature:void 0,trainingConfig:t.trainingConfig!=null?t.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(i)),{modelArtifactsInfo:o}}catch{throw iU(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${o.modelTopologyBytes}, weightSpecsBytes=${o.weightSpecsBytes}, weightDataBytes=${o.weightDataBytes}.`)}}}async load(){const t=JSON.parse(this.LS.getItem(this.keys.info));if(t==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(t.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const e={},r=JSON.parse(this.LS.getItem(this.keys.topology));if(r==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);e.modelTopology=r;const o=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(o==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);e.weightSpecs=o;const a=this.LS.getItem(this.keys.modelMetadata);if(a!=null){const s=JSON.parse(a);e.format=s.format,e.generatedBy=s.generatedBy,e.convertedBy=s.convertedBy,s.signature!=null&&(e.signature=s.signature),s.userDefinedMetadata!=null&&(e.userDefinedMetadata=s.userDefinedMetadata),s.modelInitializer!=null&&(e.modelInitializer=s.modelInitializer),s.initializerSignature!=null&&(e.initializerSignature=s.initializerSignature),s.trainingConfig!=null&&(e.trainingConfig=s.trainingConfig)}const i=this.LS.getItem(this.keys.weightData);if(i==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return e.weightData=Npt(i),e}}Nc.URL_SCHEME="localstorage://";const sU=n=>yt().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Nc.URL_SCHEME)?Upt(n.slice(Nc.URL_SCHEME.length)):null;lo.registerSaveRouter(sU);lo.registerLoadRouter(sU);function Upt(n){return new Nc(n)}class Wpt{constructor(){H(yt().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),H(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const t={},e=ff+Us,r=Us+oU;for(let o=0;o<this.LS.length;++o){const a=this.LS.key(o);if(a.startsWith(e)&&a.endsWith(r)){const i=Bpt(a);t[i]=JSON.parse(this.LS.getItem(a))}}return t}async removeModel(t){t=zpt(t);const e=aU(t);if(this.LS.getItem(e.info)==null)throw new Error(`Cannot find model at path '${t}'`);const r=JSON.parse(this.LS.getItem(e.info));return iU(e),r}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const S3="://";class Mi{constructor(){this.managers={}}static getInstance(){return Mi.instance==null&&(Mi.instance=new Mi),Mi.instance}static registerManager(t,e){H(t!=null,()=>"scheme must not be undefined or null."),t.endsWith(S3)&&(t=t.slice(0,t.indexOf(S3))),H(t.length>0,()=>"scheme must not be an empty string.");const r=Mi.getInstance();H(r.managers[t]==null,()=>`A model store manager is already registered for scheme '${t}'.`),r.managers[t]=e}static getManager(t){const e=Mi.getInstance().managers[t];if(e==null)throw new Error(`Cannot find model manager for scheme '${t}'`);return e}static getSchemes(){return Object.keys(Mi.getInstance().managers)}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Vpt{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(t,e){return fetch(t,e)}now(){return performance.now()}encode(t,e){if(e!=="utf-8"&&e!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${e}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(t)}decode(t,e){return new TextDecoder(e).decode(t)}setTimeoutCustom(t,e){if(typeof window>"u"||!yt().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(t,e);return}this.functionRefs.push(t),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},e),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",r=>{if(r.source===window&&r.data.name===this.messageName){r.stopPropagation();const o=this.functionRefs[r.data.index];o(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}isTypedArray(t){return Pz(t)}}if(yt().get("IS_BROWSER")){yt().setPlatform("browser",new Vpt);try{Mi.registerManager(Nc.URL_SCHEME,new Wpt)}catch{}try{Mi.registerManager(Tc.URL_SCHEME,new Opt)}catch{}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gpt={importFetch:()=>require("node-fetch")};let uS;class Hpt{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(t,e){return yt().global.fetch!=null?yt().global.fetch(t,e):(uS==null&&(uS=Gpt.importFetch()),uS(t,e))}now(){const t=process.hrtime();return t[0]*1e3+t[1]/1e6}encode(t,e){if(e!=="utf-8"&&e!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${e}`);return this.textEncoder.encode(t)}decode(t,e){return t.length===0?"":new this.util.TextDecoder(e).decode(t)}isTypedArray(t){return this.util.types.isFloat32Array(t)||this.util.types.isInt32Array(t)||this.util.types.isUint8Array(t)||this.util.types.isUint8ClampedArray(t)}}yt().get("IS_NODE")&&!yt().get("IS_BROWSER")&&yt().setPlatform("node",new Hpt);/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ae(n,t="float32",e){return t=t||"float32",cu(n),new Ur(n,t,e)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qpt(n,t){const e=J(n,"x","cast");if(!Pdt(t))throw new Error(`Failed to cast to unknown dtype ${t}`);if(t==="string"&&e.dtype!=="string"||t!=="string"&&e.dtype==="string")throw new Error("Only strings can be casted to strings");const r={x:e},o={dtype:t};return ut.runKernel(tg,r,o)}const jt=ft({cast_:qpt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jpt(n){const e={x:J(n,"x","clone","string_or_numeric")};return ut.runKernel(dg,e)}const xc=ft({clone_:jpt});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xpt(n,t=!1){console.log(n.toString(t))}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Xz();const Kpt={buffer:Ae,cast:jt,clone:xc,print:Xpt};gpt(Kpt);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ypt(n,t){let e=J(n,"a","add"),r=J(t,"b","add");[e,r]=Jn(e,r);const o={a:e,b:r};return ut.runKernel(hd,o)}const Bt=ft({add_:Ypt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qpt(n,t){let e=J(n,"a","floorDiv"),r=J(t,"b","floorDiv");[e,r]=Jn(e,r);const o={a:e,b:r};return ut.runKernel(hg,o)}const uU=ft({floorDiv_:Qpt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zpt(n,t){let e=J(n,"a","div"),r=J(t,"b","div");if([e,r]=Jn(e,r),e.dtype==="int32"&&r.dtype==="int32")return uU(e,r);const o={a:e,b:r},a={};return ut.runKernel(ag,o,a)}const fe=ft({div_:Zpt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jpt(n,t){let e=J(n,"a","mul"),r=J(t,"b","mul");[e,r]=Jn(e,r);const o={a:e,b:r};return ut.runKernel(Cg,o)}const it=ft({mul_:Jpt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tmt(n){const t=J(n,"x","abs");if(t.dtype==="complex64"){const e={x:t};return ut.runKernel(S1,e)}else{const e={x:t};return ut.runKernel(g1,e)}}const fo=ft({abs_:tmt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function emt(n){const e={x:J(n,"x","acos")};return ut.runKernel(jm,e)}const nmt=ft({acos_:emt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rmt(n){const e={x:J(n,"x","acosh")};return ut.runKernel(Xm,e)}const omt=ft({acosh_:rmt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function amt(n,t=null,e=!1){const o={x:J(n,"x","all","bool")},a={axis:t,keepDims:e};return ut.runKernel(WI,o,a)}const lU=ft({all_:amt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function imt(n,t=null,e=!1){const o={x:J(n,"x","any","bool")},a={axis:t,keepDims:e};return ut.runKernel(VI,o,a)}const $E=ft({any_:imt});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function smt(n,t=0){const r={x:J(n,"x","argMax")},o={axis:t};return ut.runKernel(v1,r,o)}const sm=ft({argMax_:smt});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function umt(n,t=0){const r={x:J(n,"x","argMin")},o={axis:t};return ut.runKernel(x1,r,o)}const lmt=ft({argMin_:umt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cmt(n){const e={x:J(n,"x","asin")};return ut.runKernel(Km,e)}const hmt=ft({asin_:cmt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fmt(n){const e={x:J(n,"x","asinh")};return ut.runKernel(Ym,e)}const dmt=ft({asinh_:fmt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pmt(n){const e={x:J(n,"x","atan")};return ut.runKernel(Qm,e)}const mmt=ft({atan_:pmt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gmt(n,t){let e=J(n,"a","atan2"),r=J(t,"b","atan2");[e,r]=Jn(e,r);const o={a:e,b:r};return ut.runKernel(Jm,o)}const vmt=ft({atan2_:gmt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xmt(n){const e={x:J(n,"x","atanh")};return ut.runKernel(Zm,e)}const ymt=ft({atanh_:xmt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wg(n,t,e,r,o="NHWC",a){const i=n[3],s=[...t,i],u=fu(o);return Vr(n,s,e,a,r,null,null,u)}function Ya(n,t,e,r,o,a,i="channelsLast"){const[s,u]=um(t);let l;if(i==="channelsLast")l=[s,u,n[3],n[3]];else if(i==="channelsFirst")l=[s,u,n[1],n[1]];else throw new Error(`Unknown dataFormat ${i}`);return Vr(n,l,e,r,o,a,!1,i)}function hu(n,t,e,r,o,a,i="NDHWC"){const[s,u,l]=OE(t);let c,h;if(i==="NDHWC")h="channelsLast",c=[s,u,l,n[4],n[4]];else if(i==="NCDHW")h="channelsFirst",c=[s,u,l,n[1],n[1]];else throw new Error(`Unknown dataFormat ${i}`);return Cl(n,c,e,r,o,!1,h,a)}function Vr(n,t,e,r,o,a,i=!1,s="channelsLast"){let[u,l,c,h]=[-1,-1,-1,-1];if(s==="channelsLast")[u,l,c,h]=n;else if(s==="channelsFirst")[u,h,l,c]=n;else throw new Error(`Unknown dataFormat ${s}`);const[d,p,,g]=t,[x,y]=um(e),[b,C]=um(r),E=Rf(d,b),S=Rf(p,C),{padInfo:k,outHeight:R,outWidth:A}=Cmt(o,l,c,x,y,E,S,a,s),N=i?g*h:g;let _;return s==="channelsFirst"?_=[u,N,R,A]:s==="channelsLast"&&(_=[u,R,A,N]),{batchSize:u,dataFormat:s,inHeight:l,inWidth:c,inChannels:h,outHeight:R,outWidth:A,outChannels:N,padInfo:k,strideHeight:x,strideWidth:y,filterHeight:d,filterWidth:p,effectiveFilterHeight:E,effectiveFilterWidth:S,dilationHeight:b,dilationWidth:C,inShape:n,outShape:_,filterShape:t}}function Cl(n,t,e,r,o,a=!1,i="channelsLast",s){let[u,l,c,h,d]=[-1,-1,-1,-1,-1];if(i==="channelsLast")[u,l,c,h,d]=n;else if(i==="channelsFirst")[u,d,l,c,h]=n;else throw new Error(`Unknown dataFormat ${i}`);const[p,g,x,,y]=t,[b,C,E]=OE(e),[S,k,R]=OE(r),A=Rf(p,S),N=Rf(g,k),_=Rf(x,R),{padInfo:$,outDepth:D,outHeight:O,outWidth:P}=Smt(o,l,c,h,b,C,E,A,N,_,s),z=a?y*d:y;let W;return i==="channelsFirst"?W=[u,z,D,O,P]:i==="channelsLast"&&(W=[u,D,O,P,z]),{batchSize:u,dataFormat:i,inDepth:l,inHeight:c,inWidth:h,inChannels:d,outDepth:D,outHeight:O,outWidth:P,outChannels:z,padInfo:$,strideDepth:b,strideHeight:C,strideWidth:E,filterDepth:p,filterHeight:g,filterWidth:x,effectiveFilterDepth:A,effectiveFilterHeight:N,effectiveFilterWidth:_,dilationDepth:S,dilationHeight:k,dilationWidth:R,inShape:n,outShape:W,filterShape:t}}function bmt(n,t,e,r,o){r==null&&(r=AR(n,t,e));const a=n[0],i=n[1],s=lm((a-t+2*r)/e+1,o),u=lm((i-t+2*r)/e+1,o);return[s,u]}function wmt(n,t,e,r,o,a){o==null&&(o=AR(n,t[0],r[0]));const i=[0,0,0,e];for(let s=0;s<3;s++)n[s]+2*o>=t[s]&&(i[s]=lm((n[s]-t[s]+2*o)/r[s]+1,a));return i}function AR(n,t,e,r=1){const o=Rf(t,r);return Math.floor((n[0]*(e-1)-e+o)/2)}function um(n){return typeof n=="number"?[n,n,n]:n.length===2?[n[0],n[1],1]:n}function OE(n){return typeof n=="number"?[n,n,n]:n}function Rf(n,t){return t<=1?n:n+(n-1)*(t-1)}function Cmt(n,t,e,r,o,a,i,s,u){let l,c,h;if(typeof n=="number"){l={top:n,bottom:n,left:n,right:n,type:n===0?"VALID":"NUMBER"};const p=bmt([t,e],a,r,n,s);c=p[0],h=p[1]}else if(n==="same"){c=Math.ceil(t/r),h=Math.ceil(e/o);const d=Math.max(0,(c-1)*r+a-t),p=Math.max(0,(h-1)*o+i-e),g=Math.floor(d/2),x=d-g,y=Math.floor(p/2),b=p-y;l={top:g,bottom:x,left:y,right:b,type:"SAME"}}else if(n==="valid")l={top:0,bottom:0,left:0,right:0,type:"VALID"},c=Math.ceil((t-a+1)/r),h=Math.ceil((e-i+1)/o);else if(typeof n=="object"){const d=u==="channelsLast"?n[1][0]:n[2][0],p=u==="channelsLast"?n[1][1]:n[2][1],g=u==="channelsLast"?n[2][0]:n[3][0],x=u==="channelsLast"?n[2][1]:n[3][1];l={top:d,bottom:p,left:g,right:x,type:d===0&&p===0&&g===0&&x===0?"VALID":"EXPLICIT"},c=lm((t-a+d+p)/r+1,s),h=lm((e-i+g+x)/o+1,s)}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:l,outHeight:c,outWidth:h}}function Smt(n,t,e,r,o,a,i,s,u,l,c){let h,d,p,g;if(n==="valid"&&(n=0),typeof n=="number"){h={top:n,bottom:n,left:n,right:n,front:n,back:n,type:n===0?"VALID":"NUMBER"};const y=wmt([t,e,r,1],[s,u,l],1,[o,a,i],n,c);d=y[0],p=y[1],g=y[2]}else if(n==="same"){d=Math.ceil(t/o),p=Math.ceil(e/a),g=Math.ceil(r/i);const x=(d-1)*o+s-t,y=(p-1)*a+u-e,b=(g-1)*i+l-r,C=Math.floor(x/2),E=x-C,S=Math.floor(y/2),k=y-S,R=Math.floor(b/2),A=b-R;h={top:S,bottom:k,left:R,right:A,front:C,back:E,type:"SAME"}}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:h,outDepth:d,outHeight:p,outWidth:g}}function lm(n,t){if(!t)return Math.trunc(n);switch(t){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error(`Unknown roundingMode ${t}`)}}function Ac(n){const[t,e,r]=um(n);return t===1&&e===1&&r===1}function ro(n,t){return Ac(n)||Ac(t)}function _c(n){return um(n).every(t=>t>0)}function fu(n){if(n==="NHWC")return"channelsLast";if(n==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${n}`)}function Oo(n,t,e){if(e!=null){if(typeof t=="string")throw Error(`Error in ${n}: pad must be an integer when using dimRoundingMode ${e} but got pad ${t}.`);if(typeof t=="number")H(Uf(t),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${e} but got pad ${t}.`);else if(typeof t=="object")t.forEach(r=>{r.forEach(o=>{H(Uf(o),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${e} but got pad ${o}.`)})});else throw Error(`Error in ${n}: Unknown padding parameter: ${t}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Emt(n,t){const r={x:J(n,"x","reshape","string_or_numeric")},o={shape:t};return ut.runKernel(rb,r,o)}const ht=ft({reshape_:Emt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kmt(n,t,e,r,o){const a=J(n,"x","avgPool","float32"),i=1;H(ro(e,i),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${e} and dilations '${i}'`);let s=a,u=!1;a.rank===3&&(u=!0,s=ht(a,[1,a.shape[0],a.shape[1],a.shape[2]])),H(s.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${s.rank}.`),Oo("avgPool",r,o);const l={x:s},c={filterSize:t,strides:e,pad:r,dimRoundingMode:o};let h=ut.runKernel(y1,l,c);return h=jt(h,a.dtype),u?ht(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const _R=ft({avgPool_:kmt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Imt(n,t,e,r,o,a="NDHWC"){const i=J(n,"x","avgPool3d","float32");let s=i,u=!1;i.rank===4&&(u=!0,s=ht(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),H(s.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${s.rank}.`),H(a==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${a}`),H(typeof e=="number"&&e>0||Array.isArray(e)&&e[0]>0&&e[1]>0&&e[2]>0,()=>`Error in avgPool3d: Stride must be > 0, but got '${e}'`),Oo("avgPool3d",r,o);const l={x:s},c={filterSize:t,strides:e,pad:r,dimRoundingMode:o,dataFormat:a};let h=ut.runKernel(b1,l,c);return h=jt(h,s.dtype),u?ht(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}const Rmt=ft({avgPool3d_:Imt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tmt(n,t=0){H(n.length>=1,()=>"Pass at least one tensor to concat");const e=Zz(n,"tensors","concat","string_or_numeric");if(e[0].dtype==="complex64"&&e.forEach(a=>{if(a.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${a.dtype}. `)}),e.length===1)return xc(e[0]);const r=e,o={axis:t};return ut.runKernel(E1,r,o)}const No=ft({concat_:Tmt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nmt(n,t,e=!1,r=!1){let o=J(n,"a","matMul"),a=J(t,"b","matMul");[o,a]=Jn(o,a);const i={a:o,b:a},s={transposeA:e,transposeB:r};return ut.runKernel(w1,i,s)}const Qe=ft({matMul_:Nmt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Amt(n){const e={x:J(n,"x","sigmoid","float32")};return ut.runKernel($g,e)}const dd=ft({sigmoid_:Amt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _mt(n,t,e){const r=J(n,"x","slice","string_or_numeric");if(r.rank===0)throw new Error("Slicing scalar is not possible");const o={x:r},a={begin:t,size:e};return ut.runKernel(ub,o,a)}const kn=ft({slice_:_mt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dmt(n){const e={x:J(n,"x","tanh","float32")};return ut.runKernel(Bg,e)}const yb=ft({tanh_:Dmt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $mt(n,t,e){const r=J(n,"x","batchToSpaceND"),o=t.reduce((s,u)=>s*u);H(r.rank>=1+t.length,()=>`input rank is ${r.rank} but should be > than blockShape.length ${t.length}`),H(e.length===t.length,()=>`crops.length is ${e.length} but should be equal to blockShape.length  ${t.length}`),H(r.shape[0]%o===0,()=>`input tensor batch is ${r.shape[0]} but is not divisible by the product of the elements of blockShape ${t.join(" * ")} === ${o}`);const a={x:r},i={blockShape:t,crops:e};return ut.runKernel(C1,a,i)}const DR=ft({batchToSpaceND_:$mt});function Omt(n){let t;return n.rank===0||n.rank===1?t=ht(n,[1,1,1,n.size]):n.rank===2?t=ht(n,[1,1,n.shape[0],n.shape[1]]):n.rank===3?t=ht(n,[1,n.shape[0],n.shape[1],n.shape[2]]):t=n,t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fmt(n,t,e,r,o,a){a==null&&(a=.001);const i=J(n,"x","batchNorm"),s=J(t,"mean","batchNorm"),u=J(e,"variance","batchNorm");let l;o!=null&&(l=J(o,"scale","batchNorm"));let c;r!=null&&(c=J(r,"offset","batchNorm")),H(s.rank===u.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),H(c==null||s.rank===c.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),H(l==null||s.rank===l.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const d={x:Omt(i),scale:l,offset:c,mean:s,variance:u},p={varianceEpsilon:a},g=ut.runKernel($1,d,p);return ht(g,i.shape)}const bb=ft({batchNorm_:Fmt});function Mmt(n,t,e,r,o,a){const i=J(n,"x","batchNorm"),s=J(t,"mean","batchNorm"),u=J(e,"variance","batchNorm");let l;o!=null&&(l=J(o,"scale","batchNorm"));let c;return r!=null&&(c=J(r,"offset","batchNorm")),H(i.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${i.rank}.`),H(s.rank===2||s.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${s.rank}.`),H(u.rank===2||u.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${u.rank}.`),l!=null&&H(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${l.rank}.`),c!=null&&H(c.rank===2||c.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${c.rank}.`),bb(i,s,u,c,l,a)}const Lmt=ft({batchNorm2d_:Mmt});function Pmt(n,t,e,r,o,a){const i=J(n,"x","batchNorm"),s=J(t,"mean","batchNorm"),u=J(e,"variance","batchNorm");let l;o!=null&&(l=J(o,"scale","batchNorm"));let c;return r!=null&&(c=J(r,"offset","batchNorm")),H(i.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${i.rank}.`),H(s.rank===3||s.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${s.rank}.`),H(u.rank===3||u.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${u.rank}.`),l!=null&&H(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${l.rank}.`),c!=null&&H(c.rank===3||c.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${c.rank}.`),bb(i,s,u,c,l,a)}const Bmt=ft({batchNorm3d_:Pmt});function zmt(n,t,e,r,o,a){const i=J(n,"x","batchNorm"),s=J(t,"mean","batchNorm"),u=J(e,"variance","batchNorm");let l;o!=null&&(l=J(o,"scale","batchNorm"));let c;return r!=null&&(c=J(r,"offset","batchNorm")),H(i.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${i.rank}.`),H(s.rank===4||s.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${s.rank}.`),H(u.rank===4||u.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${u.rank}.`),l!=null&&H(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${l.rank}.`),c!=null&&H(c.rank===4||c.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${c.rank}.`),bb(i,s,u,c,l,a)}const Umt=ft({batchNorm4d_:zmt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wmt(n,t,e){const r=J(n,"x","bincount"),o=J(t,"weights","bincount");H(r.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${r.dtype}`),H(e>=0,()=>`size must be non-negative, but got ${e}.`),H(o.size===r.size||o.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${r.shape}, weights shape: ${o.shape}.`);const a={x:r,weights:o},i={size:e};return ut.runKernel(qI,a,i)}const Vmt=ft({bincount_:Wmt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gmt(n,t){let e=J(n,"broadcastTo","x");const r=e.shape;if(cu(t),t.length<e.rank)throw new Error(`broadcastTo(): shape.length=${t.length} < input.rank=${e.rank}.`);if(t.length>e.rank){const l=e.shape.slice();for(;l.length<t.length;)l.unshift(1);e=ht(e,l)}const o=e.shape,a=Array.from(t);for(let l=t.length-1;l>=0;l--)if(o[l]===t[l])a[l]=1;else if(e.shape[l]!==1)throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${t}].`);if(a.map((l,c)=>l>1?c:-1).filter(l=>l>=0).length===0)return xc(e);const s={x:e},u={reps:a};return ut.runKernel(zg,s,u)}const Qp=ft({broadcastTo_:Gmt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hmt(n){const e={x:J(n,"x","ceil","float32")};return ut.runKernel(eg,e)}const qmt=ft({ceil_:Hmt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wb(n,t,e){cu(n),e=e||ld(t);const r={shape:n,value:t,dtype:e};return ut.runKernel(sR,{},r)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jmt(n,t,e){const r=J(n,"x","clipByValue");if(H(t<=e,()=>`Error in clip: min (${t}) must be less than or equal to max (${e}).`),t===e)return wb(r.shape,t,r.dtype);const o={x:r},a={clipValueMin:t,clipValueMax:e};return ut.runKernel(ng,o,a)}const wa=ft({clipByValue_:jmt});function Xmt(n){return No(n,0)}const Kmt=ft({concat1d_:Xmt});function Ymt(n,t){return No(n,t)}const Qmt=ft({concat2d_:Ymt});function Zmt(n,t){return No(n,t)}const Jmt=ft({concat3d_:Zmt});function tgt(n,t){return No(n,t)}const egt=ft({concat4d_:tgt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ngt(n,t,e,r,o="NHWC",a=[1,1],i){const s=J(n,"x","conv2d","float32"),u=J(t,"filter","conv2d","float32");let l=s,c=!1;s.rank===3&&(c=!0,l=ht(s,[1,s.shape[0],s.shape[1],s.shape[2]])),H(l.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${l.rank}.`),H(u.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${u.rank}.`),Oo("conv2d",r,i);const h=o==="NHWC"?l.shape[3]:l.shape[1];H(h===u.shape[2],()=>`Error in conv2d: depth of input (${h}) must match input depth for filter ${u.shape[2]}.`),H(ro(e,a),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${e} and dilations '${a}'`),H(_c(a),()=>"Error in conv2D: Dilated rates should be larger than 0."),H(_c(e),()=>"Error in conv2D: Strides should be larger than 0.");const d={x:l,filter:u},p={strides:e,pad:r,dataFormat:o,dilations:a,dimRoundingMode:i},g=ut.runKernel(k1,d,p);return c?ht(g,[g.shape[1],g.shape[2],g.shape[3]]):g}const Dc=ft({conv2d_:ngt});function rgt(n,t,e,r,o="NWC",a=1,i){const s=J(n,"x","conv1d"),u=J(t,"filter","conv1d");let l=s,c=!1;s.rank===2&&(c=!0,l=ht(s,[1,s.shape[0],s.shape[1]])),H(l.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${l.rank}.`),H(u.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${u.rank}.`),Oo("conv1d",r,i),H(l.shape[2]===u.shape[1],()=>`Error in conv1d: depth of input (${l.shape[2]}) must match input depth for filter ${u.shape[1]}.`),H(ro(e,a),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${e} and dilation '${a}'`),H(_c(a),()=>"Error in conv1D: Dilated rates should be larger than 0."),H(_c(e),()=>"Error in conv1D: Stride should be larger than 0."),H(o==="NWC",()=>`Error in conv1d: got dataFormat of ${o} but only NWC is currently supported.`);const h=ht(u,[1,u.shape[0],u.shape[1],u.shape[2]]),d=ht(l,[l.shape[0],1,l.shape[1],l.shape[2]]),y=Dc(d,h,[1,e],r,"NHWC",[1,a],i);return c?ht(y,[y.shape[2],y.shape[3]]):ht(y,[y.shape[0],y.shape[2],y.shape[3]])}const cU=ft({conv1d_:rgt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ogt(n,t,e,r,o,a="NHWC",i){H(n.length===t.rank,()=>`Length of inShape (${n.length}) and rank of dy (${t.rank}) must match`);let s=n,u=t,l=!1;t.rank===3&&(l=!0,u=ht(t,[1,t.shape[0],t.shape[1],t.shape[2]]),s=[1,n[0],n[1],n[2]]),H(s.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${s.length}.`),H(u.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${u.rank}`),H(e.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${e.rank}`);const c=a==="NHWC"?s[3]:s[1],h=a==="NHWC"?u.shape[3]:u.shape[1];H(c===e.shape[2],()=>`Error in conv2dDerInput: depth of input (${c}) must match input depth for filter ${e.shape[2]}.`),H(h===e.shape[3],()=>`Error in conv2dDerInput: depth of output (${h}) must match output depth for filter ${e.shape[3]}.`),Oo("conv2dDerInput",o,i);const d={dy:u,filter:e},p={strides:r,pad:o,dataFormat:a,dimRoundingMode:i,inputShape:s},g=ut.runKernel(I1,d,p);return l?ht(g,[g.shape[1],g.shape[2],g.shape[3]]):g}const $R=ft({conv2DBackpropInput_:ogt});function agt(n,t,e,r,o,a){const i=J(n,"x","conv2dTranspose"),s=J(t,"filter","conv2dTranspose");return $R(e,i,s,r,o,"NHWC",a)}const hU=ft({conv2dTranspose_:agt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function igt(n,t,e,r,o="NDHWC",a=[1,1,1]){const i=J(n,"x","conv3d"),s=J(t,"filter","conv3d");let u=i,l=!1;i.rank===4&&(l=!0,u=ht(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),H(u.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${u.rank}.`),H(s.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${s.rank}.`),H(u.shape[4]===s.shape[3],()=>`Error in conv3d: depth of input (${u.shape[4]}) must match input depth for filter ${s.shape[3]}.`),H(ro(e,a),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${e} and dilations '${a}'`),H(o==="NDHWC",()=>`Error in conv3d: got dataFormat of ${o} but only NDHWC is currently supported.`),H(_c(a),()=>"Error in conv3D: Dilated rates should be larger than 0."),H(_c(e),()=>"Error in conv3D: Strides should be larger than 0.");const c={x:u,filter:s},h={strides:e,pad:r,dataFormat:o,dilations:a},d=ut.runKernel(R1,c,h);return l?ht(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}const sgt=ft({conv3d_:igt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ugt(n,t,e,r,o){H(n.length===t.rank,()=>`Length of inShape (${n.length}) and rank of dy (${t.rank}) must match`);let a=n,i=t,s=!1;t.rank===4&&(s=!0,i=ht(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]),a=[1,n[0],n[1],n[2],n[3]]);const u=a[4],l=i.shape[4];H(a.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${a.length}.`),H(i.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${i.rank}`),H(e.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${e.rank}`),H(u===e.shape[3],()=>`Error in conv3dDerInput: depth of input (${u}) must match input depth for filter ${e.shape[3]}.`),H(l===e.shape[4],()=>`Error in conv3dDerInput: depth of output (${l}) must match output depth for filter ${e.shape[4]}.`);const c={dy:i,filter:e},h={pad:o,strides:r,inputShape:a},d=ut.runKernel(QI,c,h);return s?ht(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}const fU=ft({conv3DBackpropInput_:ugt});function lgt(n,t,e,r,o){const a=J(n,"x","conv3dTranspose"),i=J(t,"filter","conv3dTranspose");return fU(e,a,i,r,o)}const cgt=ft({conv3dTranspose_:lgt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hgt(n){const e={x:J(n,"x","cos","float32")};return ut.runKernel(rg,e)}const OR=ft({cos_:hgt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fgt(n){const e={x:J(n,"x","cosh","float32")};return ut.runKernel(og,e)}const dU=ft({cosh_:fgt});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dgt(n,t=0,e=!1,r=!1){const a={x:J(n,"x","cumprod")},i={axis:t,exclusive:e,reverse:r};return ut.runKernel(ZI,a,i)}const FE=ft({cumprod_:dgt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pgt(n,t=0,e=!1,r=!1){const a={x:J(n,"x","cumsum")},i={axis:t,exclusive:e,reverse:r};return ut.runKernel(T1,a,i)}const pU=ft({cumsum_:pgt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mgt(n,t,e,r=!1){const o=J(n,"x","denseBincount"),a=J(t,"weights","denseBincount");H(o.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${o.dtype}`),H(o.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${o.rank}.`),H(e>=0,()=>`size must be non-negative, but got ${e}.`),H(a.size===o.size||a.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${o.shape}, weights shape: ${a.shape}.`);const i={x:o,weights:a},s={size:e,binaryOutput:r};return ut.runKernel(tR,i,s)}const E3=ft({denseBincount_:mgt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ggt(n,t,e="NHWC"){const r=J(n,"x","depthToSpace","float32"),o=e==="NHWC"?r.shape[1]:r.shape[2],a=e==="NHWC"?r.shape[2]:r.shape[3],i=e==="NHWC"?r.shape[3]:r.shape[1];H(t>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${t}`),H(o*t>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${o} and ${t}  for depthToSpace with input shape
    ${r.shape}`),H(a*t>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${a} and ${t} for depthToSpace with input shape
        ${r.shape}`),H(i%(t*t)===0,()=>`Dimension size must be evenly divisible by ${t*t} but is ${i} for depthToSpace with input shape ${r.shape}`);const s={x:r},u={blockSize:t,dataFormat:e};return ut.runKernel(eR,s,u)}const vgt=ft({depthToSpace_:ggt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xgt(n,t,e,r,o="NHWC",a=[1,1],i){const s=J(n,"x","depthwiseConv2d","float32"),u=J(t,"filter","depthwiseConv2d","float32");let l=s,c=!1;s.rank===3&&(c=!0,l=ht(s,[1,s.shape[0],s.shape[1],s.shape[2]])),H(l.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${l.rank}.`),H(u.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${u.rank}.`);const h=o==="NHWC"?l.shape[3]:l.shape[1];H(h===u.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${h}) must match the inChannels dimension in filter ${u.shape[2]}.`),Oo("depthwiseConv2d",r,i);const d={x:l,filter:u},p={strides:e,pad:r,dataFormat:o,dilations:a,dimRoundingMode:i},g=ut.runKernel(N1,d,p);return c?ht(g,[g.shape[1],g.shape[2],g.shape[3]]):g}const FR=ft({depthwiseConv2d_:xgt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ygt(n,t,e,r,o=[1,1],a="NHWC"){const i=J(n,"x","dilation2d"),s=J(t,"filter","dilation2d");H(i.rank===3||i.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${i.rank}.`),H(s.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${s.rank}.`),H(a==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${a}`);let u=i,l=!1;i.rank===3&&(u=ht(i,[1,i.shape[0],i.shape[1],i.shape[2]]),l=!0),H(u.shape[3]===s.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${u.shape[3]} vs ${s.shape[2]}`);const c={x:u,filter:s},h={strides:e,pad:r,dilations:o},d=ut.runKernel(A1,c,h);return l?ht(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const bgt=ft({dilation2d_:ygt});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gf(n,t){const e=n.length,r=[];for(let o=0;o<e;o++){const a=e-1-o,i=n[a]||1;(t[t.length-1-o]||1)>1&&i===1&&r.unshift(a)}return r}function br(n,t){const e=[];for(let r=0;r<t.length;r++){const o=n[n.length-r-1],a=t.length-r-1,i=t[a];(o==null||o===1&&i>1)&&e.unshift(a)}return e}function Ee(n,t){const e=Math.max(n.length,t.length),r=new Array(e);for(let o=0;o<e;o++){let a=n[n.length-o-1];a==null&&(a=1);let i=t[t.length-o-1];if(i==null&&(i=1),a===1)r[e-o-1]=i;else if(i===1)r[e-o-1]=a;else if(a!==i){const s=`Operands could not be broadcast together with shapes ${n} and ${t}.`;throw Error(s)}else r[e-o-1]=a}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wgt(n,t){let e=J(n,"a","equal","string_or_numeric"),r=J(t,"b","equal","string_or_numeric");[e,r]=Jn(e,r),Ee(e.shape,r.shape);const o={a:e,b:r};return ut.runKernel(_1,o)}const os=ft({equal_:wgt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cgt(n,t,e){const r=J(t,"a","where"),o=J(e,"b","where"),a=J(n,"condition","where","bool"),i=Ee(Ee(a.shape,r.shape),o.shape),s=Qp(a,i),u=Qp(r,i),l=Qp(o,i),c={condition:s,t:u,e:l};return ut.runKernel(sb,c)}const bo=ft({where_:Cgt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sgt(n){const e={x:J(n,"x","zerosLike")};return ut.runKernel(mb,e)}const We=ft({zerosLike_:Sgt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Egt(n,t){let e=J(n,"a","div"),r=J(t,"b","div");[e,r]=Jn(e,r);const o=fe(e,r),a=We(o),i=os(r,a);return bo(i,a,o)}const kgt=ft({divNoNan_:Egt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Igt(n,t){const e=J(n,"t1","dot"),r=J(t,"t2","dot");H((e.rank===1||e.rank===2)&&(r.rank===1||r.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${e.rank} and ${r.rank}.`);const o=e.rank===1?e.size:e.shape[1],a=r.rank===1?r.size:r.shape[0];if(H(o===a,()=>`Error in dot: inner dimensions of inputs must match, but got ${o} and ${a}.`),e.rank===1&&r.rank===1){const i=ht(e,[1,-1]),s=ht(r,[-1,1]),u=Qe(i,s);return ht(u,[])}else if(e.rank===1&&r.rank===2){const i=ht(e,[1,-1]),s=ht(r,[r.shape[0],r.shape[1]]),u=Qe(i,s);return ht(u,[u.size])}else if(e.rank===2&&r.rank===1){const i=ht(r,[-1,1]),s=Qe(e,i);return ht(s,[s.size])}else{const i=ht(r,[r.shape[0],r.shape[1]]);return Qe(e,i)}}const Rgt=ft({dot_:Igt});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tgt(n,...t){const e=t.map((o,a)=>J(o,`tensors${a}`,"einsum")),r={equation:n};return ut.runKernel(oR,e,r)}const Op=ft({einsum_:Tgt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ngt(n){const e={x:J(n,"x","elu","float32")};return ut.runKernel(ig,e)}const Cb=ft({elu_:Ngt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Agt(n){let t=J(n,"x","erf");H(t.dtype==="int32"||t.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),t.dtype==="int32"&&(t=jt(t,"float32"));const e={x:t};return ut.runKernel(sg,e)}const mU=ft({erf_:Agt});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MR(n,t){for(let e=0;e<n.length;++e)if(n[n.length-e-1]!==t-1-e)return!1;return!0}function gU(n,t,e){const r=n.length+t.length,o=[];let a=0,i=0;for(let s=0;s<r;s++)e.indexOf(s)===-1?o.push(n[a++]):o.push(t[i++]);return o}function Dr(n,t){const e=[],r=n.length;for(let a=0;a<r;a++)t.indexOf(a)===-1&&e.push(n[a]);const o=t.map(a=>n[a]);return[e,o]}function lr(n,t){const e=t.map(r=>1);return gU(n,e,t)}function Gr(n,t,e){H(MR(t,e),()=>`${n} supports only inner-most axes for now. Got axes ${t} and rank-${e} input.`)}function Pn(n,t){if(MR(n,t))return null;const e=[];for(let r=0;r<t;++r)n.indexOf(r)===-1&&e.push(r);return n.forEach(r=>e.push(r)),e}function Sl(n){return n.map((t,e)=>[e,t]).sort((t,e)=>t[1]-e[1]).map(t=>t[0])}function er(n,t){const e=[];for(let r=t-n;r<t;++r)e.push(r);return e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _gt(n,t=null,e=!1){const o={x:J(n,"x","max")},a={reductionIndices:t,keepDims:e};return ut.runKernel(V1,o,a)}const mi=ft({max_:_gt});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dgt(n,t=null,e=!1){const o={x:J(n,"x","min")},a={axis:t,keepDims:e};return ut.runKernel(j1,o,a)}const Cy=ft({min_:Dgt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $gt(n,t){let e=J(n,"base","pow"),r=J(t,"exp","pow");[e,r]=Jn(e,r);const o={a:e,b:r};return ut.runKernel(Sg,o)}const $c=ft({pow_:$gt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Je(n,t){if((Xa(n)&&t!=="string"||Array.isArray(n))&&t!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(t==="string"&&Xa(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return xb(n,[],[],t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ogt(n){const e={x:J(n,"x","sqrt","float32")};return ut.runKernel(Fg,e)}const eo=ft({sqrt_:Ogt});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fgt(n){const t=J(n,"x","square"),e={};return ut.runKernel("Square",{x:t},e)}const An=ft({square_:Fgt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mgt(n,t=null,e=!1){let r=J(n,"x","sum");r.dtype==="bool"&&(r=jt(r,"int32"));const o={x:r},a={axis:t,keepDims:e};return ut.runKernel(lb,o,a)}const ce=ft({sum_:Mgt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lgt(n,t="euclidean",e=null,r=!1){n=J(n,"x","norm");const o=vU(n,t,e);let a=o.shape;if(r){const i=_e(e,n.shape);a=lr(o.shape,i)}return ht(o,a)}function vU(n,t,e=null){if(n.rank===0)return fo(n);if(n.rank!==1&&e===null)return vU(ht(n,[-1]),t,e);if(n.rank===1||typeof e=="number"||Array.isArray(e)&&e.length===1){if(t===1)return ce(fo(n),e);if(t===1/0)return mi(fo(n),e);if(t===-1/0)return Cy(fo(n),e);if(t==="euclidean"||t===2)return eo(ce($c(fo(n),Je(2,"int32")),e));throw new Error(`Error in norm: invalid ord value: ${t}`)}if(Array.isArray(e)&&e.length===2){if(t===1)return mi(ce(fo(n),e[0]),e[1]-1);if(t===1/0)return mi(ce(fo(n),e[1]),e[0]);if(t===-1/0)return Cy(ce(fo(n),e[1]),e[0]);if(t==="fro"||t==="euclidean")return eo(ce(An(n),e));throw new Error(`Error in norm: invalid ord value: ${t}`)}throw new Error(`Error in norm: invalid axis: ${e}`)}const Sb=ft({norm_:Lgt});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pgt(n,t=null,e=!1){return Sb(n,"euclidean",t,e)}const Bgt=ft({euclideanNorm_:Pgt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zgt(n){const e={x:J(n,"x","exp")};return ut.runKernel(ug,e)}const as=ft({exp_:zgt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ugt(n,t=0){const e=J(n,"x","expandDims","string_or_numeric");H(t<=e.rank,()=>"Axis must be <= rank of the tensor");const r={input:e},o={dim:t};return ut.runKernel(D1,r,o)}const Ro=ft({expandDims_:Ugt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wgt(n){const e={x:J(n,"x","expm1")};return ut.runKernel(lg,e)}const Vgt=ft({expm1_:Wgt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ggt(n,t){const e=J(n,"x","tile","string_or_numeric");H(e.rank===t.length,()=>`Error in transpose: rank of input ${e.rank} must match length of reps ${t}.`);const r={x:e},o={reps:t};return ut.runKernel(zg,r,o)}const li=ft({tile_:Ggt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hgt(n,t,e,r="float32"){t==null&&(t=n);const o=Ae([n,t],r),a=n<=t?n:t;for(let s=0;s<a;++s)o.set(1,s,s);const i=ht(o.toTensor(),[n,t]);if(e==null)return i;if(e.length===1)return li(Ro(i,0),[e[0],1,1]);if(e.length===2)return li(Ro(Ro(i,0),0),[e[0],e[1],1,1]);if(e.length===3)return li(Ro(Ro(Ro(i,0),0),0),[e[0],e[1],e[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${e.length}D.`)}const xU=ft({eye_:Hgt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qgt(n){const e={x:J(n,"x","floor","float32")};return ut.runKernel(cg,e)}const Eb=ft({floor_:qgt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jgt(n,t,e=0,r=0){const o=J(n,"x","gather"),a=J(t,"indices","gather","int32"),i={x:o,indices:a},s={axis:e,batchDims:r};return ut.runKernel(O1,i,s)}const LR=ft({gather_:jgt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xgt(n,t){let e=J(n,"a","greater","string_or_numeric"),r=J(t,"b","greater","string_or_numeric");[e,r]=Jn(e,r),Ee(e.shape,r.shape);const o={a:e,b:r};return ut.runKernel(F1,o)}const Ca=ft({greater_:Xgt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kgt(n,t){let e=J(n,"a","greaterEqual","string_or_numeric"),r=J(t,"b","greaterEqual","string_or_numeric");[e,r]=Jn(e,r),Ee(e.shape,r.shape);const o={a:e,b:r};return ut.runKernel(fg,o)}const eh=ft({greaterEqual_:Kgt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ygt(n){const e={input:J(n,"input","imag")};return ut.runKernel(cR,e)}const PR=ft({imag_:Ygt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qgt(n){const e={x:J(n,"x","isFinite")};return ut.runKernel(pg,e)}const Zgt=ft({isFinite_:Qgt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jgt(n){const e={x:J(n,"x","isInf")};return ut.runKernel(mg,e)}const tvt=ft({isInf_:Jgt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function evt(n){const e={x:J(n,"x","isNaN")};return ut.runKernel(gg,e)}const nvt=ft({isNaN_:evt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rvt(n,t=.2){const r={x:J(n,"x","leakyRelu")},o={alpha:t};return ut.runKernel(M1,r,o)}const BR=ft({leakyRelu_:rvt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ovt(n,t){let e=J(n,"a","less","string_or_numeric"),r=J(t,"b","less","string_or_numeric");[e,r]=Jn(e,r),Ee(e.shape,r.shape);const o={a:e,b:r};return ut.runKernel(L1,o)}const Sy=ft({less_:ovt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function avt(n,t){let e=J(n,"a","lessEqual","string_or_numeric"),r=J(t,"b","lessEqual","string_or_numeric");[e,r]=Jn(e,r),Ee(e.shape,r.shape);const o={a:e,b:r};return ut.runKernel(P1,o)}const pd=ft({lessEqual_:avt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ivt(n,t=5,e=1,r=1,o=.5){const a=J(n,"x","localResponseNormalization");H(a.rank===4||a.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${a.rank}.`),H(Uf(t),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${t}.`);let i=a,s=!1;a.rank===3&&(s=!0,i=ht(a,[1,a.shape[0],a.shape[1],a.shape[2]]));const u={x:i},l={depthRadius:t,bias:e,alpha:r,beta:o},c=ut.runKernel(W1,u,l);return s?ht(c,[c.shape[1],c.shape[2],c.shape[3]]):c}const svt=ft({localResponseNormalization_:ivt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uvt(n){const e={x:J(n,"x","log","float32")};return ut.runKernel(vg,e)}const is=ft({log_:uvt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lvt(n){const e={x:J(n,"x","log1p")};return ut.runKernel(xg,e)}const yU=ft({log1p_:lvt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cvt(n,t){H(bE(n),()=>"The f passed in variableGrads(f) must be a function"),H(t==null||Array.isArray(t)&&t.every(l=>l instanceof wy),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const e=t!=null;if(!e){t=[];for(const l in ut.registeredVariables)t.push(ut.registeredVariables[l])}const r=e?t.filter(l=>!l.trainable):null,o=t.length;t=t.filter(l=>l.trainable),H(t.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${o} variables is trainable.`);const a=!0,{value:i,grads:s}=ut.gradients(n,t,null,a);H(s.some(l=>l!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),H(i.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${i.rank} tensor`);const u={};return t.forEach((l,c)=>{s[c]!=null&&(u[l.name]=s[c])}),r?.forEach(l=>u[l.name]=null),{value:i,grads:u}}function Hf(n){return ut.customGrad(n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hvt(n){const e={x:J(n,"x","neg")};return ut.runKernel(K1,e)}const Zn=ft({neg_:hvt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fvt(n){const e={x:J(n,"x","softplus")};return ut.runKernel(Og,e)}const Vg=ft({softplus_:fvt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dvt(n){const t=J(n,"x","logSigmoid");return Hf(r=>({value:Zn(Vg(Zn(r))),gradFunc:i=>it(i,dd(Zn(r)))}))(t)}const pvt=ft({logSigmoid_:dvt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mvt(n,t){let e=J(n,"a","sub"),r=J(t,"b","sub");[e,r]=Jn(e,r);const o={a:e,b:r};return ut.runKernel(Lg,o)}const me=ft({sub_:mvt});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gvt(n,t=-1){const e=J(n,"logits","logSoftmax");if(t===-1&&(t=e.rank-1),t!==e.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${e.rank} and axis was ${t}`);return Hf((o,a)=>{const s=mi(o,t,!0),u=me(o,s),l=me(jt(u,"float32"),is(ce(as(u),t,!0)));return a([l]),{value:l,gradFunc:(h,d)=>{const[p]=d,g=!0,x=as(p);return me(h,it(ce(h,t,g),x))}}})(e)}const bU=ft({logSoftmax_:gvt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vvt(n,t=null,e=!1){const r=J(n,"x","logSumExp"),o=_e(t,r.shape),a=mi(r,o,!0),i=me(r,a),s=as(i),u=ce(s,o),l=is(u),c=Bt(ht(a,l.shape),l);if(e){const h=lr(c.shape,o);return ht(c,h)}return c}const wU=ft({logSumExp_:vvt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xvt(n,t){const e=J(n,"a","logicalAnd","bool"),r=J(t,"b","logicalAnd","bool");Ee(e.shape,r.shape);const o={a:e,b:r};return ut.runKernel(B1,o)}const Ks=ft({logicalAnd_:xvt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yvt(n){const e={x:J(n,"x","logicalNot","bool")};return ut.runKernel(z1,e)}const zR=ft({logicalNot_:yvt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bvt(n,t){const e=J(n,"a","logicalOr","bool"),r=J(t,"b","logicalOr","bool");Ee(e.shape,r.shape);const o={a:e,b:r};return ut.runKernel(U1,o)}const CU=ft({logicalOr_:bvt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wvt(n,t){const e=J(n,"a","logicalXor","bool"),r=J(t,"b","logicalXor","bool");return Ee(e.shape,r.shape),Ks(CU(n,t),zR(Ks(n,t)))}const Cvt=ft({logicalXor_:wvt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Svt(n,t,e,r,o){const a=J(n,"x","maxPool"),i=1;let s=a,u=!1;a.rank===3&&(u=!0,s=ht(a,[1,a.shape[0],a.shape[1],a.shape[2]])),H(s.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${s.rank}.`),H(ro(e,i),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${e} and dilations '${i}'`),Oo("maxPool",r,o);const l={x:s},c={filterSize:t,strides:e,pad:r,dimRoundingMode:o},h=ut.runKernel(G1,l,c);return u?ht(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const UR=ft({maxPool_:Svt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Evt(n,t=[1,1,1],e,r,o,a="NDHWC"){const i=J(n,"x","maxPool3d");let s=i,u=!1;i.rank===4&&(u=!0,s=ht(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),H(s.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${s.rank}.`),H(a==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${a}`),Oo("maxPool3d",r,o);const l={x:s},c={filterSize:t,strides:e,pad:r,dimRoundingMode:o,dataFormat:a},h=ut.runKernel(H1,l,c);return u?ht(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}const kvt=ft({maxPool3d_:Evt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ivt(n,t){let e=J(n,"a","maximum"),r=J(t,"b","maximum");[e,r]=Jn(e,r),e.dtype==="bool"&&(e=jt(e,"int32"),r=jt(r,"int32")),Ee(e.shape,r.shape);const o={a:e,b:r};return ut.runKernel(yg,o)}const El=ft({maximum_:Ivt});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rvt(n,t=null,e=!1){const o={x:J(n,"x","mean")},a={axis:t,keepDims:e};return ut.runKernel(q1,o,a)}const sr=ft({mean_:Rvt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rr(n,t="float32"){if(cu(n),t==="complex64"){const r=Rr(n,"float32"),o=Rr(n,"float32");return Vf(r,o)}const e=to(It(n),t);return ut.makeTensor(e,n,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kl(n,t="float32"){if(cu(n),t==="complex64"){const r=kl(n,"float32"),o=Rr(n,"float32");return Vf(r,o)}const e=PI(It(n),t);return ut.makeTensor(e,n,t)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tvt(n,t){let e=J(n,"a","minimum"),r=J(t,"b","minimum");[e,r]=Jn(e,r),e.dtype==="bool"&&(e=jt(e,"int32"),r=jt(r,"int32")),Ee(e.shape,r.shape);const o={a:e,b:r};return ut.runKernel(bg,o)}const cm=ft({minimum_:Tvt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nvt(n,t,e){H(e==="reflect"||e==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${e}.`);const r=J(n,"x","mirrorPad");if(r.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");H(t.length===r.rank,()=>`Padding doesn't match input. Must be ${r.rank}. Got ${t.length}.`);const o=e==="reflect"?1:0;for(let s=0;s<r.rank;s++)H(t[s].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),H(t[s][0]>=0&&t[s][0]<=r.shape[s]-o&&t[s][1]>=0&&t[s][1]<=r.shape[s]-o,()=>`Padding in dimension ${s} cannot be greater than or equal to ${r.shape[s]-o} or less than 0 for input of shape ${r.shape}`);const a={paddings:t,mode:e},i={x:r};return ut.runKernel(X1,i,a)}const Avt=ft({mirrorPad_:Nvt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _vt(n,t){let e=J(n,"a","mod"),r=J(t,"b","mod");[e,r]=Jn(e,r);const o={a:e,b:r};return ut.runKernel(wg,o)}const Dvt=ft({mod_:_vt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $vt(n,t=null,e=!1){n=J(n,"x","moments");const r=_e(t,n.shape),o=sr(n,r,e);let a=o.shape;e||(a=lr(o.shape,r));const i=An(me(jt(n,"float32"),ht(o,a))),s=sr(i,r,e);return{mean:o,variance:s}}const WR=ft({moments_:$vt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ovt(n,t){let e=J(n,"a","notEqual","string_or_numeric"),r=J(t,"b","notEqual","string_or_numeric");[e,r]=Jn(e,r),Ee(e.shape,r.shape);const o={a:e,b:r};return ut.runKernel(Y1,o)}const Ey=ft({notEqual_:Ovt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fvt(n,t,e=1,r=0,o="int32"){if(t<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${t}`);const i={indices:J(n,"indices","oneHot","int32")},s={dtype:o,depth:t,onValue:e,offValue:r};return ut.runKernel(Z1,i,s)}const SU=ft({oneHot_:Fvt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mvt(n){const e={x:J(n,"x","onesLike")};return ut.runKernel(Q1,e)}const Ka=ft({onesLike_:Mvt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lvt(n,t,e=0){const r=J(n,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const o={paddings:t,constantValue:e},a={x:r};return ut.runKernel(tb,a,o)}const VR=ft({pad_:Lvt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pvt(n,t,e){const r=J(n,"x","spaceToBatchND");H(r.rank>=1+t.length,()=>`input rank ${r.rank} should be > than [blockShape] ${t.length}`),H(e.length===t.length,()=>`paddings.shape[0] ${e.length} must be equal to [blockShape] ${t.length}`),H(r.shape.reduce((i,s,u)=>u>0&&u<=t.length?i&&(s+e[u-1][0]+e[u-1][1])%t[u-1]===0:i,!0),()=>`input spatial dimensions ${r.shape.slice(1)} with paddings ${e.toString()} must be divisible by blockShapes ${t.toString()}`);const o={x:r},a={blockShape:t,paddings:e};return ut.runKernel(cb,o,a)}const GR=ft({spaceToBatchND_:Pvt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bvt(n,t,e,r,o,a,i){o==null&&(o=[1,1]),a==null&&(a=1),r===0&&(r="valid");const s=J(n,"x","maxPool");let u=s,l=!1;s.rank===3&&(l=!0,u=ht(s,[1,s.shape[0],s.shape[1],s.shape[2]])),H(ro(a,o),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${a} and dilations '${o}'`);const c=Ya(u.shape,t,a,o,r),h=[c.dilationHeight,c.dilationWidth];let d;r==="same"?d=Uvt([c.filterHeight,c.filterWidth],h):d=[[0,0],[0,0]];const p=h[0]===1&&h[1]===1,[g,x]=zvt([c.inHeight,c.inWidth],h,d),y=p?r:"valid",b=p?u:GR(u,h,g),E=(e==="avg"?()=>_R(b,t,a,y,i):()=>UR(b,t,a,y,i))(),S=p?E:DR(E,h,x);return l?ht(S,[S.shape[1],S.shape[2],S.shape[3]]):S}function zvt(n,t,e){const r=e.map(c=>c[0]),o=e.map(c=>c[1]),a=n.concat(r,o),i=t.map((c,h)=>(c-a[h]%c)%c),s=o.map((c,h)=>c+i[h]),u=t.map((c,h)=>[r[h],s[h]]),l=t.map((c,h)=>[0,i[h]]);return[u,l]}function Uvt(n,t){const r=n.map((i,s)=>i+(i-1)*(t[s]-1)).map(i=>i-1),o=r.map(i=>Math.floor(i/2)),a=r.map((i,s)=>i-o[s]);return r.map((i,s)=>[o[s],a[s]])}const Wvt=ft({pool_:Bvt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vvt(n,t){const e=J(n,"x","prelu"),r=J(t,"alpha","prelu"),o={x:e,alpha:r};return ut.runKernel(eb,o)}const HR=ft({prelu_:Vvt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gvt(n,t=null,e=!1){let r=J(n,"x","prod");r.dtype==="bool"&&(r=jt(r,"int32"));const o={x:r},a={axis:t,keepDims:e};return ut.runKernel(nb,o,a)}const Hvt=ft({prod_:Gvt});var h0={exports:{}},qvt=h0.exports,k3;function jvt(){return k3||(k3=1,function(n){(function(t,e,r){function o(u){var l=this,c=s();l.next=function(){var h=2091639*l.s0+l.c*23283064365386963e-26;return l.s0=l.s1,l.s1=l.s2,l.s2=h-(l.c=h|0)},l.c=1,l.s0=c(" "),l.s1=c(" "),l.s2=c(" "),l.s0-=c(u),l.s0<0&&(l.s0+=1),l.s1-=c(u),l.s1<0&&(l.s1+=1),l.s2-=c(u),l.s2<0&&(l.s2+=1),c=null}function a(u,l){return l.c=u.c,l.s0=u.s0,l.s1=u.s1,l.s2=u.s2,l}function i(u,l){var c=new o(u),h=l&&l.state,d=c.next;return d.int32=function(){return c.next()*4294967296|0},d.double=function(){return d()+(d()*2097152|0)*11102230246251565e-32},d.quick=d,h&&(typeof h=="object"&&a(h,c),d.state=function(){return a(c,{})}),d}function s(){var u=4022871197,l=function(c){c=String(c);for(var h=0;h<c.length;h++){u+=c.charCodeAt(h);var d=.02519603282416938*u;u=d>>>0,d-=u,d*=u,u=d>>>0,d-=u,u+=d*4294967296}return(u>>>0)*23283064365386963e-26};return l}e&&e.exports?e.exports=i:this.alea=i})(qvt,n)}(h0)),h0.exports}var f0={exports:{}},Xvt=f0.exports,I3;function Kvt(){return I3||(I3=1,function(n){(function(t,e,r){function o(s){var u=this,l="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var h=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^h^h>>>8},s===(s|0)?u.x=s:l+=s;for(var c=0;c<l.length+64;c++)u.x^=l.charCodeAt(c)|0,u.next()}function a(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function i(s,u){var l=new o(s),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,g=(d+p)/(1<<21);while(g===0);return g},h.int32=l.next,h.quick=h,c&&(typeof c=="object"&&a(c,l),h.state=function(){return a(l,{})}),h}e&&e.exports?e.exports=i:this.xor128=i})(Xvt,n)}(f0)),f0.exports}var d0={exports:{}},Yvt=d0.exports,R3;function Qvt(){return R3||(R3=1,function(n){(function(t,e,r){function o(s){var u=this,l="";u.next=function(){var h=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^(h^h<<1))|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(s|0)?u.x=s:l+=s;for(var c=0;c<l.length+64;c++)u.x^=l.charCodeAt(c)|0,c==l.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function a(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function i(s,u){var l=new o(s),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,g=(d+p)/(1<<21);while(g===0);return g},h.int32=l.next,h.quick=h,c&&(typeof c=="object"&&a(c,l),h.state=function(){return a(l,{})}),h}e&&e.exports?e.exports=i:this.xorwow=i})(Yvt,n)}(d0)),d0.exports}var p0={exports:{}},Zvt=p0.exports,T3;function Jvt(){return T3||(T3=1,function(n){(function(t,e,r){function o(s){var u=this;u.next=function(){var c=u.x,h=u.i,d,p;return d=c[h],d^=d>>>7,p=d^d<<24,d=c[h+1&7],p^=d^d>>>10,d=c[h+3&7],p^=d^d>>>3,d=c[h+4&7],p^=d^d<<7,d=c[h+7&7],d=d^d<<13,p^=d^d<<9,c[h]=p,u.i=h+1&7,p};function l(c,h){var d,p=[];if(h===(h|0))p[0]=h;else for(h=""+h,d=0;d<h.length;++d)p[d&7]=p[d&7]<<15^h.charCodeAt(d)+p[d+1&7]<<13;for(;p.length<8;)p.push(0);for(d=0;d<8&&p[d]===0;++d);for(d==8?p[7]=-1:p[d],c.x=p,c.i=0,d=256;d>0;--d)c.next()}l(u,s)}function a(s,u){return u.x=s.x.slice(),u.i=s.i,u}function i(s,u){s==null&&(s=+new Date);var l=new o(s),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,g=(d+p)/(1<<21);while(g===0);return g},h.int32=l.next,h.quick=h,c&&(c.x&&a(c,l),h.state=function(){return a(l,{})}),h}e&&e.exports?e.exports=i:this.xorshift7=i})(Zvt,n)}(p0)),p0.exports}var m0={exports:{}},txt=m0.exports,N3;function ext(){return N3||(N3=1,function(n){(function(t,e,r){function o(s){var u=this;u.next=function(){var c=u.w,h=u.X,d=u.i,p,g;return u.w=c=c+1640531527|0,g=h[d+34&127],p=h[d=d+1&127],g^=g<<13,p^=p<<17,g^=g>>>15,p^=p>>>12,g=h[d]=g^p,u.i=d,g+(c^c>>>16)|0};function l(c,h){var d,p,g,x,y,b=[],C=128;for(h===(h|0)?(p=h,h=null):(h=h+"\0",p=0,C=Math.max(C,h.length)),g=0,x=-32;x<C;++x)h&&(p^=h.charCodeAt((x+32)%h.length)),x===0&&(y=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,x>=0&&(y=y+1640531527|0,d=b[x&127]^=p+y,g=d==0?g+1:0);for(g>=128&&(b[(h&&h.length||0)&127]=-1),g=127,x=4*128;x>0;--x)p=b[g+34&127],d=b[g=g+1&127],p^=p<<13,d^=d<<17,p^=p>>>15,d^=d>>>12,b[g]=p^d;c.w=y,c.X=b,c.i=g}l(u,s)}function a(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function i(s,u){s==null&&(s=+new Date);var l=new o(s),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,g=(d+p)/(1<<21);while(g===0);return g},h.int32=l.next,h.quick=h,c&&(c.X&&a(c,l),h.state=function(){return a(l,{})}),h}e&&e.exports?e.exports=i:this.xor4096=i})(txt,n)}(m0)),m0.exports}var g0={exports:{}},nxt=g0.exports,A3;function rxt(){return A3||(A3=1,function(n){(function(t,e,r){function o(s){var u=this,l="";u.next=function(){var h=u.b,d=u.c,p=u.d,g=u.a;return h=h<<25^h>>>7^d,d=d-p|0,p=p<<24^p>>>8^g,g=g-h|0,u.b=h=h<<20^h>>>12^d,u.c=d=d-p|0,u.d=p<<16^d>>>16^g,u.a=g-h|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=s|0):l+=s;for(var c=0;c<l.length+20;c++)u.b^=l.charCodeAt(c)|0,u.next()}function a(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function i(s,u){var l=new o(s),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,g=(d+p)/(1<<21);while(g===0);return g},h.int32=l.next,h.quick=h,c&&(typeof c=="object"&&a(c,l),h.state=function(){return a(l,{})}),h}e&&e.exports?e.exports=i:this.tychei=i})(nxt,n)}(g0)),g0.exports}var v0={exports:{}};const oxt={},axt=Object.freeze(Object.defineProperty({__proto__:null,default:oxt},Symbol.toStringTag,{value:"Module"})),qR=_j(axt);var ixt=v0.exports,_3;function sxt(){return _3||(_3=1,function(n){(function(t,e,r){var o=256,a=6,i=52,s="random",u=r.pow(o,a),l=r.pow(2,i),c=l*2,h=o-1,d;function p(S,k,R){var A=[];k=k==!0?{entropy:!0}:k||{};var N=b(y(k.entropy?[S,E(e)]:S??C(),3),A),_=new g(A),$=function(){for(var D=_.g(a),O=u,P=0;D<l;)D=(D+P)*o,O*=o,P=_.g(1);for(;D>=c;)D/=2,O/=2,P>>>=1;return(D+P)/O};return $.int32=function(){return _.g(4)|0},$.quick=function(){return _.g(4)/4294967296},$.double=$,b(E(_.S),e),(k.pass||R||function(D,O,P,z){return z&&(z.S&&x(z,_),D.state=function(){return x(_,{})}),P?(r[s]=D,O):D})($,N,"global"in k?k.global:this==r,k.state)}function g(S){var k,R=S.length,A=this,N=0,_=A.i=A.j=0,$=A.S=[];for(R||(S=[R++]);N<o;)$[N]=N++;for(N=0;N<o;N++)$[N]=$[_=h&_+S[N%R]+(k=$[N])],$[_]=k;(A.g=function(D){for(var O,P=0,z=A.i,W=A.j,F=A.S;D--;)O=F[z=h&z+1],P=P*o+F[h&(F[z]=F[W=h&W+O])+(F[W]=O)];return A.i=z,A.j=W,P})(o)}function x(S,k){return k.i=S.i,k.j=S.j,k.S=S.S.slice(),k}function y(S,k){var R=[],A=typeof S,N;if(k&&A=="object")for(N in S)try{R.push(y(S[N],k-1))}catch{}return R.length?R:A=="string"?S:S+"\0"}function b(S,k){for(var R=S+"",A,N=0;N<R.length;)k[h&N]=h&(A^=k[h&N]*19)+R.charCodeAt(N++);return E(k)}function C(){try{var S;return d&&(S=d.randomBytes)?S=S(o):(S=new Uint8Array(o),(t.crypto||t.msCrypto).getRandomValues(S)),E(S)}catch{var k=t.navigator,R=k&&k.plugins;return[+new Date,t,R,t.screen,E(e)]}}function E(S){return String.fromCharCode.apply(0,S)}if(b(r.random(),e),n.exports){n.exports=p;try{d=qR}catch{}}else r["seed"+s]=p})(typeof self<"u"?self:ixt,[],Math)}(v0)),v0.exports}var lS,D3;function uxt(){if(D3)return lS;D3=1;var n=jvt(),t=Kvt(),e=Qvt(),r=Jvt(),o=ext(),a=rxt(),i=sxt();return i.alea=n,i.xor128=t,i.xorwow=e,i.xorshift7=r,i.xor4096=o,i.tychei=a,lS=i,lS}var EU=uxt();/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kU{constructor(t,e,r,o,a){this.mean=t,this.stdDev=e,this.dtype=r,this.nextVal=NaN,this.truncated=o,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);const i=a||Math.random();this.random=EU.alea(i.toString())}nextValue(){if(!isNaN(this.nextVal)){const o=this.nextVal;return this.nextVal=NaN,o}let t,e,r=!1;for(;!r;){let o,a,i;do o=2*this.random()-1,a=2*this.random()-1,i=o*o+a*a;while(i>=1||i===0);const s=Math.sqrt(-2*Math.log(i)/i);t=this.mean+this.stdDev*o*s,e=this.mean+this.stdDev*a*s,(!this.truncated||this.isValidTruncated(t))&&(r=!0)}return(!this.truncated||this.isValidTruncated(e))&&(this.nextVal=this.convertValue(e)),this.convertValue(t)}convertValue(t){return this.dtype==null||this.dtype==="float32"?t:Math.round(t)}isValidTruncated(t){return t<=this.upper&&t>=this.lower}}class lxt{constructor(t=0,e=1,r,o){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=t,this.range=e-t,this.dtype=r,o==null&&(o=Math.random()),typeof o=="number"&&(o=o.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${t} - ${e} <= 1 and dtype is not float`);this.random=EU.alea(o)}convertValue(t){return this.canReturnFloat()?t:Math.round(t)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cxt(n,t=0,e=1,r,o){if(cu(n),r!=null&&r==="bool")throw new Error(`Unsupported data type ${r}`);const a=new kU(t,e,r,!1,o),i=Ae(n,r);for(let s=0;s<i.values.length;s++)i.values[s]=a.nextValue();return i.toTensor()}const hxt=ft({randomNormal_:cxt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fxt(n,t=0,e=1,r="float32",o){cu(n);const a=Ae(n,r),i=new lxt(t,e,null,o);for(let s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}const Gg=ft({randomUniform_:fxt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hm(n,t,e=1,r="float32"){if(e===0)throw new Error("Cannot have a step of zero");const o={start:n,stop:t,step:e,dtype:r};return ut.runKernel(vR,{},o)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dxt(n){const e={input:J(n,"input","real")};return ut.runKernel(xR,e)}const ky=ft({real_:dxt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pxt(n){const e={x:J(n,"x","reciprocal")};return ut.runKernel(Eg,e)}const mxt=ft({reciprocal_:pxt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gxt(n){const e={x:J(n,"x","relu")};return ut.runKernel(kg,e)}const nh=ft({relu_:gxt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vxt(n){const e={x:J(n,"x","relu6")};return ut.runKernel(Ig,e)}const IU=ft({relu6_:vxt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xxt(n,t){const r={x:J(n,"x","reverse")},o={dims:t};return ut.runKernel(ib,r,o)}const Oc=ft({reverse_:xxt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yxt(n){const e={x:J(n,"x","round")};return ut.runKernel(Rg,e)}const RU=ft({round_:yxt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bxt(n){const e={x:J(n,"x","rsqrt","float32")};return ut.runKernel(Tg,e)}const TU=ft({rsqrt_:bxt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wxt(n){const e={x:J(n,"x","selu")};return ut.runKernel(Ng,e)}const NU=ft({selu_:wxt});function Cxt(n,t,e,r,o,a=[1,1],i="NHWC"){const s=J(n,"x","separableConv2d"),u=J(t,"depthwiseFilter","separableConv2d"),l=J(e,"pointwiseFilter","separableConv2d");let c=s,h=!1;if(s.rank===3&&(h=!0,c=ht(s,[1,s.shape[0],s.shape[1],s.shape[2]])),i==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");H(c.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${c.rank}.`),H(u.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${u.rank}.`),H(l.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${u.rank}.`),H(l.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${l.shape[0]}.`),H(l.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${l.shape[1]}.`);const d=u.shape[2],p=u.shape[3];H(l.shape[2]===d*p,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${d*p}, but got ${l.shape[2]}.`);const g=FR(c,u,r,o,i,a),y=Dc(g,l,1,"valid",i);return h?ht(y,[y.shape[1],y.shape[2],y.shape[3]]):y}const AU=ft({separableConv2d_:Cxt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sxt(n){const e={x:J(n,"x","sign")};return ut.runKernel(Dg,e)}const Ext=ft({sign_:Sxt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kxt(n){const e={x:J(n,"x","sin","float32")};return ut.runKernel(Ag,e)}const _U=ft({sin_:kxt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ixt(n){const e={x:J(n,"x","sinh")};return ut.runKernel(_g,e)}const DU=ft({sinh_:Ixt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rxt(n,t,e){const r=J(n,"x","slice1d");return H(r.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${r.rank} tensor`),kn(r,[t],[e])}const jR=ft({slice1d_:Rxt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Txt(n,t,e){const r=J(n,"x","slice2d");return H(r.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${r.rank} tensor`),kn(r,t,e)}const $U=ft({slice2d_:Txt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nxt(n,t,e){const r=J(n,"x","slice3d");return H(r.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${r.rank} tensor`),kn(r,t,e)}const XR=ft({slice3d_:Nxt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Axt(n,t,e){const r=J(n,"x","slice4d");return H(r.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${r.rank} tensor`),kn(r,t,e)}const Iy=ft({slice4d_:Axt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _xt(n,t=-1){const e=J(n,"logits","softmax","float32");if(t===-1&&(t=e.rank-1),t!==e.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${e.rank} and dim was ${t}`);const r={logits:e},o={dim:t};return ut.runKernel(fb,r,o)}const KR=ft({softmax_:_xt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dxt(n){H(n.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${n.dtype}.`);const t={input:n};return ut.runKernel(iR,t)}const OU=ft({fft_:Dxt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $xt(n){H(n.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${n.dtype}.`);const t={input:n};return ut.runKernel(lR,t)}const ME=ft({ifft_:$xt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oxt(n){const t=n.shape[n.shape.length-1],e=n.size/t;let r;if(t<=2){const o=ht(n,[e,t]);r=ME(o)}else{const o=[e,2*(t-1)],a=ht(ky(n),[e,t]),i=ht(PR(n),[e,t]),s=Oc(kn(a,[0,1],[e,t-2]),1),u=it(Oc(kn(i,[0,1],[e,t-2]),1),Je(-1)),l=No([a,s],1),c=No([i,u],1),h=ht(Vf(l,c),[o[0],o[1]]);r=ME(h)}if(r=ky(r),n.rank===3&&n.shape[0]!==0){const o=r,a=n.shape[0];r=ht(r,[a,r.shape[0]/a,r.shape[1]]),o.dispose()}return r}const Fxt=ft({irfft_:Oxt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mxt(n,t,e=0){const o={x:J(n,"x","split")},a={numOrSizeSplits:t,axis:e};return ut.runKernel(hb,o,a)}const ba=ft({split_:Mxt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lxt(n,t){H(n.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${n.dtype}`);let e=n.shape[n.shape.length-1];const r=n.size/e;let o;if(t!=null&&t<e){const g=n.shape.map(y=>0),x=n.shape.map(y=>y);x[n.shape.length-1]=t,o=kn(n,g,x),e=t}else if(t!=null&&t>e){const g=n.shape.map(x=>x);g[n.shape.length-1]=t-e,o=No([n,Rr(g)],n.shape.length-1),e=t}else o=n;const a=We(o),i=ht(Vf(o,a),[r,e]),s=OU(i),u=Math.floor(e/2)+1,l=ky(s),c=PR(s),h=ba(l,[u,e-u],l.shape.length-1),d=ba(c,[u,e-u],c.shape.length-1),p=o.shape.slice();return p[o.shape.length-1]=u,ht(Vf(h[0],d[0]),p)}const Pxt=ft({rfft_:Lxt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bxt(n,t){let e=J(n,"a","squaredDifference"),r=J(t,"b","squaredDifference");[e,r]=Jn(e,r),Ee(e.shape,r.shape);const o={a:e,b:r},a={};return ut.runKernel(Mg,o,a)}const zxt=ft({squaredDifference_:Bxt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uxt(n,t){const e=J(n,"x","squeeze","string_or_numeric");return ht(e,bl(e.shape,t).newShape)}const Hg=ft({squeeze_:Uxt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wxt(n,t=0){const e=Zz(n,"tensors","stack","string_or_numeric");H(e.length>=1,()=>"Pass at least one tensor to tf.stack"),e.length>0&&H(t<=e[0].rank,()=>"Axis must be <= rank of the tensor");const r=e,o={axis:t};return ut.runKernel(J1,r,o)}const Ys=ft({stack_:Wxt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vxt(n,t=0){const r={x:J(n,"x","step")},o={alpha:t};return ut.runKernel(Ug,r,o)}const qg=ft({step_:Vxt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gxt(n,t,e,r,o=0,a=0,i=0,s=0,u=0){const c={x:J(n,"x","stridedSlice","string_or_numeric")},h={begin:t,end:e,strides:r,beginMask:o,endMask:a,ellipsisMask:i,newAxisMask:s,shrinkAxisMask:u};return ut.runKernel(SR,c,h)}const Hxt=ft({stridedSlice_:Gxt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qxt(n){const e={x:J(n,"x","tan","float32")};return ut.runKernel(Pg,e)}const jxt=ft({tan_:qxt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Go(n,t){uz(n);const e=vb(n,t);if(e.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return xb(n,null,e,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cS(n,t,e){if(uz(n),t!=null&&t.length!==2)throw new Error("tensor2d() requires shape to have two numbers");const r=vb(n,e);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return xb(n,t,r,e)}function FU(n,t,e){const r=t.rank>1?t.shape[t.rank-1]:1,o=t.rank>1?t.rank-1:1,a=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${e.shape}, indices.shape: ${t.shape}, shape: ${n}, sliceDim: ${r}, and batchDim: ${o}.`;if(e.rank<o)throw new Error(a+` update.rank < ${o}. `);if(n.length<r+(e.rank-o))throw new Error(a+` Output shape length < ${r+(e.rank-o)}`);if(e.rank!==o+n.length-r)throw new Error(a+` update.rank != ${o+n.length-r}`);for(let i=0;i<o;++i)if(e.shape[i]!==t.shape[i])throw new Error(a+` updates.shape[${i}] (${e.shape[i]}) != indices.shape[${i}] (${t.shape[i]}).`);for(let i=0;i<e.rank-o;++i)if(e.shape[i+o]!==n[i+r])throw new Error(a+` updates.shape[${i+o}] (${e.shape[i+o]}) != shape[${i+o}] (${n[i+o]})`)}function Xxt(n,t,e){if(t.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${t.rank}.`);if(n.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${n.rank}.`);if(t.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${t.dtype}`);if(e.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${e}`);if(e.length===0){if(t.size===0)throw new Error(`Indices specified for empty output. indices shape: ${t.shape}`);if(n.size===0)throw new Error(`Updates specified for empty output. updates shape: ${n.shape}`)}FU(e,t,n)}function rh(n,t,e){const r=t.shape.length,o=r>1?t.shape[r-1]:1,a=e.length;let i=1;for(let h=o;h<a;++h)i*=e[h];const s=o<1?1:o,u=It(t.shape)/s,l=[...ue(e.slice(0,o)),1],c=It(e);return{sliceRank:o,numUpdates:u,sliceSize:i,strides:l,outputSize:c}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kxt(n,t=1,e=!0){const r=J(n,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");const o=r.shape[r.shape.length-1];if(t<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${t}`);if(t>o)throw new Error(`'k' passed to topk() must be <= the last dimension (${o}) but got ${t}`);const a={x:r},i={k:t,sorted:e},[s,u]=ut.runKernel(ER,a,i);return{values:s,indices:u}}const Yxt=ft({topk_:Kxt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qxt(n,t=0,e=1,r,o){if(cu(n),r!=null&&r==="bool")throw new Error("Unsupported data type $ { dtype }");const a=new kU(t,e,r,!0,o),i=Ae(n,r);for(let s=0;s<i.values.length;s++)i.values[s]=a.nextValue();return i.toTensor()}const MU=ft({truncatedNormal_:Qxt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zxt(n,t=0){const e=J(n,"x","unique","string_or_numeric");H(e.rank>0,()=>"The input tensor must be at least 1D");const r={x:e},o={axis:t},[a,i]=ut.runKernel(IR,r,o);return{values:a,indices:i}}const Jxt=ft({unique_:Zxt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t0t(n,t,e){const r=J(n,"x","unsortedSegmentSum"),o=J(t,"segmentIds","unsortedSegmentSum","int32");H(Uf(e),()=>"numSegments must be of dtype int");const a={x:r,segmentIds:o},i={numSegments:e};return ut.runKernel(pb,a,i)}const LU=ft({unsortedSegmentSum_:t0t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e0t(n,t=0){const e=J(n,"x","unstack","string_or_numeric");H(t>=-e.shape.length&&t<e.shape.length,()=>`Axis = ${t} is not in [-${e.shape.length}, ${e.shape.length})`);const r={value:e},o={axis:t};return ut.runKernel(db,r,o)}const Fc=ft({unstack_:e0t});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n0t(n,t=!0,e,r){return ut.makeVariable(n,t,e,r)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PU(n,t){const e=[];for(let a=0;a<t.length;a++)t[a]&&e.push(a);const r=Ae(n,"int32"),o=Ae([e.length,n.length],"int32");for(let a=0;a<e.length;a++){const i=r.indexToLoc(e[a]),s=a*n.length;o.values.set(i,s)}return o.toTensor()}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r0t(n,t,e){const r=J(n,"x","transpose");if(t==null&&(t=r.shape.map((i,s)=>s).reverse()),H(r.rank===t.length,()=>`Error in transpose: rank of input ${r.rank} must match length of perm ${t}.`),t.forEach(i=>{H(i>=0&&i<r.rank,()=>`All entries in 'perm' must be between 0 and ${r.rank-1} but got ${t}`)}),r.rank<=1)return r.clone();const o={x:r},a={perm:t};return r.dtype==="complex64"?gt(()=>{let i=ky(r),s=PR(r);return i=ut.runKernel(If,{x:i},a),s=ut.runKernel(If,{x:s},a),e&&(s=Zn(s)),Vf(i,s)}):ut.runKernel(If,o,a)}const Ue=ft({transpose_:r0t});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o0t(n,t){if(t==null)return n.shape.slice();if(tn(n.shape,t))return t;if(n.shape.length===t.length){const e=[];for(let r=0;r<n.shape.length;r++)t[r]==null&&n.shape[r]!=null?e.push(n.shape[r]):e.push(t[r]);return e}return t}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a0t(n,t,e,r){const o=J(n,"x","dropout");if(H(o.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${o.dtype} tensor instead.`),H(t>=0&&t<1,()=>`rate must be a float in the range [0, 1), but got ${t}.`),t===0)return n instanceof pr?o.clone():o;const a=o0t(o,e),i=1-t,s=fe(Eb(Bt(Gg(a,0,1,"float32",r),i)),i);return it(o,s)}const i0t=ft({dropout_:a0t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s0t(n,t,e,r,o,a="NHWC",i){let s=n;n.rank===3&&(s=ht(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let u=t;u.rank===3&&(u=ht(t,[1,t.shape[0],t.shape[1],t.shape[2]])),H(s.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${s.shape}.`),H(u.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${u.shape}.`),H(e.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${e}.`);const l=a==="NHWC"?s.shape[3]:s.shape[1],c=a==="NHWC"?u.shape[3]:u.shape[1];H(l===e[2],()=>`Error in conv2dDerFilter: depth of input ${l}) must match input depth in filter (${e[2]}.`),H(c===e[3],()=>`Error in conv2dDerFilter: depth of dy (${c}) must match output depth for filter (${e[3]}).`),Oo("conv2dDerFilter",o,i);const h={x:s,dy:u},d={strides:r,pad:o,dataFormat:a,dimRoundingMode:i,filterShape:e};return ut.runKernel(KI,h,d)}const YR=ft({conv2DBackpropFilter_:s0t});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QR(n,t,e){if(e==null||e==="linear")return n;if(e==="relu")return it(n,qg(t));throw new Error(`Cannot compute gradient for fused activation ${e}.`)}function ZR(n,t){let e=t;const r=br(n.shape,t.shape);return r.length>0&&(e=ce(e,r)),ht(e,n.shape)}function JR(n,t,e,r){if(t==="linear")return n;if(t==="relu")return nh(n);if(t==="elu")return Cb(n);if(t==="relu6")return IU(n);if(t==="prelu")return HR(n,e);if(t==="leakyrelu")return BR(n,r);if(t==="sigmoid")return dd(n);throw new Error(`Unknown fused activation ${t}.`)}const tT=(n,t)=>!(n>0)||t==="linear";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u0t({x:n,filter:t,strides:e,pad:r,dataFormat:o="NHWC",dilations:a=[1,1],dimRoundingMode:i,bias:s,activation:u="linear",preluActivationWeights:l,leakyreluAlpha:c}){if(u=u||"linear",tT(ut.state.gradientDepth,u)===!1){H(o==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${o} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let R=Dc(n,t,e,r,o,a,i);return s!=null&&(R=Bt(R,s)),JR(R,u,l,c)}const h=J(n,"x","conv2d","float32"),d=J(t,"filter","conv2d","float32");let p=h,g=!1;h.rank===3&&(g=!0,p=ht(h,[1,h.shape[0],h.shape[1],h.shape[2]])),H(p.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${p.rank}.`),H(d.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${d.rank}.`),Oo("fused conv2d",r,i);const x=o==="NHWC"?p.shape[3]:p.shape[1];H(d.shape[2]===x,()=>`Error in conv2d: depth of input (${x}) must match input depth for filter ${d.shape[2]}.`),H(ro(e,a),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${e} and dilations '${a}'`);const y=Vr(p.shape,d.shape,e,a,r,i);let b;s!=null&&(b=J(s,"bias","fused conv2d"),[b]=Jn(b,h),o==="NHWC"?Ee(y.outShape,b.shape):(H(b.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${b.shape.length}.`),H(b.shape.length===0||b.shape[0]===y.outChannels||b.shape[0]===1,()=>`Error in fused conv2d: bias shape (${b.shape}) is not compatible with the number of output channels (${y.outChannels})`)));let C;if(l!=null){const R=l.shape;if(H(R.length<=1||R.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${R.length}.`),R.length===1)H(R[0]===1||R[0]===y.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${R}) is not compatible with the number of output channels (${y.outChannels}).`);else if(R.length===3)try{Ee(R,y.outShape)}catch{const N=`Error in fused conv2d: PReLU activation weights (${R}) is not compatible with the output shape of the conv2d (${y.outShape}).`;throw Error(N)}C=J(l,"prelu weights","fused conv2d")}const E=(R,A)=>{H(o==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${o} but only NHWC is currently supported.`);const[N,_,$,D]=A,O=QR(R,$,u);H(Ac(a),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${a}'`);const P=$R(_.shape,O,N,e,r),z=YR(_,O,N.shape,e,r),W=[P,z];if(D!=null){const F=ZR(D,O);W.push(F)}return W},S={x:p,filter:d,bias:b,preluActivationWeights:C},k={strides:e,pad:r,dataFormat:o,dilations:a,dimRoundingMode:i,activation:u,leakyreluAlpha:c};return s==null?Hf((A,N,_)=>{let $=ut.runKernel(yy,S,k);return _([N,A,$]),g&&($=ht($,[$.shape[1],$.shape[2],$.shape[3]])),{value:$,gradFunc:E}})(p,d):Hf((A,N,_,$)=>{let D=ut.runKernel(yy,S,k);return $([N,A,D,_]),g&&(D=ht(D,[D.shape[1],D.shape[2],D.shape[3]])),{value:D,gradFunc:E}})(p,d,b)}const l0t=ft({fusedConv2d_:u0t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c0t(n,t,e,r,o,a=[1,1],i){let s=n;n.rank===3&&(s=ht(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let u=t;u.rank===3&&(u=ht(t,[1,t.shape[0],t.shape[1],t.shape[2]]));const l={x:s,dy:u},c={strides:r,pad:o,dimRoundingMode:i,dilations:a,filterShape:e};return ut.runKernel(nR,l,c)}const h0t=ft({depthwiseConv2dNativeBackpropFilter_:c0t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f0t(n,t,e,r,o,a=[1,1],i){let s=t,u=!1;t.rank===3&&(u=!0,s=ht(t,[1,t.shape[0],t.shape[1],t.shape[2]]));const l={dy:s,filter:e},c={strides:r,pad:o,dimRoundingMode:i,dilations:a,inputShape:n},h=ut.runKernel(rR,l,c);return u?ht(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const d0t=ft({depthwiseConv2dNativeBackpropInput_:f0t});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p0t({a:n,b:t,transposeA:e=!1,transposeB:r=!1,bias:o,activation:a="linear",preluActivationWeights:i,leakyreluAlpha:s=.2}){if(tT(ut.state.gradientDepth,a)===!1){let D=Qe(n,t,e,r);return o!=null&&(D=Bt(D,o)),JR(D,a,i,s)}let u=J(n,"a","fused matMul"),l=J(t,"b","fused matMul");[u,l]=Jn(u,l);const c=e?u.shape[u.rank-2]:u.shape[u.rank-1],h=r?l.shape[l.rank-1]:l.shape[l.rank-2],d=e?u.shape[u.rank-1]:u.shape[u.rank-2],p=r?l.shape[l.rank-2]:l.shape[l.rank-1],g=u.shape.slice(0,-2),x=l.shape.slice(0,-2),y=It(g),b=It(x);H(c===h,()=>`Error in fused matMul: inner shapes (${c}) and (${h}) of Tensors with shapes ${u.shape} and ${l.shape} and transposeA=${e} and transposeB=${r} must match.`);const E=Ee(u.shape.slice(0,-2),l.shape.slice(0,-2)).concat([d,p]),S=e?ht(u,[y,c,d]):ht(u,[y,d,c]),k=r?ht(l,[b,p,h]):ht(l,[b,h,p]);let R;o!=null&&(R=J(o,"bias","fused matMul"),[R]=Jn(R,u),Ee(E,R.shape));let A;i!=null&&(A=J(i,"prelu weights","fused matMul"));const N=(D,O)=>{const[P,z,W,F]=O,B=QR(ht(D,W.shape),W,a);let U,q;if(!e&&!r?(U=Qe(B,z,!1,!0),q=Qe(P,B,!0,!1)):!e&&r?(U=Qe(B,z,!1,!1),q=Qe(B,P,!0,!1)):e&&!r?(U=Qe(z,B,!1,!0),q=Qe(P,B,!1,!1)):(U=Qe(z,B,!0,!0),q=Qe(B,P,!0,!0)),o!=null){const M=ZR(F,B);return[U,q,M]}else return[U,q]},_={a:S,b:k,bias:R,preluActivationWeights:A},$={transposeA:e,transposeB:r,activation:a,leakyreluAlpha:s};return o==null?Hf((O,P,z)=>{const W=ut.runKernel(xy,_,$);return z([O,P,W]),{value:ht(W,E),gradFunc:N}})(S,k):Hf((O,P,z,W)=>{const F=ut.runKernel(xy,_,$);return W([O,P,F,z]),{value:ht(F,E),gradFunc:N}})(S,k,R)}const $3=ft({fusedMatMul_:p0t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m0t(n,t,e,r,o="bilinear",a=0){const i=J(n,"image","cropAndResize"),s=J(t,"boxes","cropAndResize","float32"),u=J(e,"boxInd","cropAndResize","int32"),l=s.shape[0];H(i.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${i.rank}.`),H(s.rank===2&&s.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${l},4] but had shape ${s.shape}.`),H(u.rank===1&&u.shape[0]===l,()=>`Error in cropAndResize: boxInd must be have size [${l}] but had shape ${s.shape}.`),H(r.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${r.length}.`),H(r[0]>=1&&r[1]>=1,()=>`cropSize must be atleast [1,1], but was ${r}`),H(o==="bilinear"||o==="nearest",()=>`method must be bilinear or nearest, but was ${o}`);const c={image:i,boxes:s,boxInd:u},h={method:o,extrapolationValue:a,cropSize:r};return ut.runKernel(JI,c,h)}const g0t=ft({cropAndResize_:m0t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v0t(n){const t=J(n,"image","flipLeftRight","float32");H(t.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${t.rank}.`);const e={image:t};return ut.runKernel(uR,e,{})}const x0t=ft({flipLeftRight_:v0t});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y0t(n){const t=J(n,"image","grayscaleToRGB"),e=t.rank-1,r=t.shape[e];H(t.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${t.rank}.`),H(r===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${r}.`);const o=new Array(t.rank);return o.fill(1,0,e),o[e]=3,li(t,o)}const b0t=ft({grayscaleToRGB_:y0t});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w0t(n){const t=J(n,"image","RGBToGrayscale"),e=t.rank-1,r=t.shape[e];H(t.rank>=2,()=>`Error in RGBToGrayscale: images must be at least rank 2, but got rank ${t.rank}.`),H(r===3,()=>`Error in RGBToGrayscale: last dimension of an RGB image should be size 3, but got size ${r}.`);const o=t.dtype,a=jt(t,"float32"),i=Go([.2989,.587,.114]);let s;switch(t.rank){case 2:s=Op("ij,j->i",a,i);break;case 3:s=Op("ijk,k->ij",a,i);break;case 4:s=Op("ijkl,l->ijk",a,i);break;case 5:s=Op("ijklm,m->ijkl",a,i);break;case 6:s=Op("ijklmn,n->ijklm",a,i);break;default:throw new Error("Not a valid tensor rank.")}return s=Ro(s,-1),jt(s,o)}const C0t=ft({rgbToGrayscale_:w0t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S0t(n,t,e=0,r=.5){const o=J(n,"image","rotateWithOffset","float32");H(o.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${o.rank}.`);const a={image:o},i={radians:t,fillValue:e,center:r};return ut.runKernel(RR,a,i)}const E0t=ft({rotateWithOffset_:S0t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function md(n,t,e,r,o,a){r==null&&(r=.5),o==null&&(o=Number.NEGATIVE_INFINITY),a==null&&(a=0);const i=n.shape[0];return e=Math.min(e,i),H(0<=r&&r<=1,()=>`iouThreshold must be in [0, 1], but was '${r}'`),H(n.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${n.rank}'`),H(n.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${n.shape[1]}`),H(t.rank===1,()=>"scores must be a 1D tensor"),H(t.shape[0]===i,()=>`scores has incompatible shape with boxes. Expected ${i}, but was ${t.shape[0]}`),H(0<=a&&a<=1,()=>`softNmsSigma must be in [0, 1], but was '${a}'`),{maxOutputSize:e,iouThreshold:r,scoreThreshold:o,softNmsSigma:a}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k0t(n,t,e,r=.5,o=Number.NEGATIVE_INFINITY){const a=J(n,"boxes","nonMaxSuppression","float32"),i=J(t,"scores","nonMaxSuppression","float32"),s=md(a,i,e,r,o);e=s.maxOutputSize,r=s.iouThreshold,o=s.scoreThreshold;const u={maxOutputSize:e,iouThreshold:r,scoreThreshold:o};return ut.runKernel(pR,{boxes:a,scores:i},u)}const I0t=ft({nonMaxSuppression_:k0t});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R0t(n,t,e){const r=T0t(n,t,e),o=r<0?-(r+1):r;n.splice(o,0,t)}function T0t(n,t,e){return A0t(n,t,e||N0t)}function N0t(n,t){return n>t?1:n<t?-1:0}function A0t(n,t,e){let r=0,o=n.length,a=0,i=!1;for(;r<o;){a=r+(o-r>>>1);const s=e(t,n[a]);s>0?r=a+1:(o=a,i=!s)}return i?r:-r-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eT(n,t,e,r,o){return oT(n,t,e,r,o,0)}function nT(n,t,e,r,o,a){return oT(n,t,e,r,o,0,!1,a,!0)}function rT(n,t,e,r,o,a){return oT(n,t,e,r,o,a,!0)}function oT(n,t,e,r,o,a,i=!1,s=!1,u=!1){const l=[];for(let y=0;y<t.length;y++)t[y]>o&&l.push({score:t[y],boxIndex:y,suppressBeginIndex:0});l.sort(O3);const c=a>0?-.5/a:0,h=[],d=[];for(;h.length<e&&l.length>0;){const y=l.pop(),{score:b,boxIndex:C,suppressBeginIndex:E}=y;if(b<o)break;let S=!1;for(let k=h.length-1;k>=E;--k){const R=_0t(n,C,h[k]);if(R>=r){S=!0;break}if(y.score=y.score*D0t(r,c,R),y.score<=o)break}y.suppressBeginIndex=h.length,S||(y.score===b?(h.push(C),d.push(y.score)):y.score>o&&R0t(l,y,O3))}const p=h.length,g=e-p;s&&g>0&&(h.push(...new Array(g).fill(0)),d.push(...new Array(g).fill(0)));const x={selectedIndices:h};return i&&(x.selectedScores=d),u&&(x.validOutputs=p),x}function _0t(n,t,e){const r=n.subarray(t*4,t*4+4),o=n.subarray(e*4,e*4+4),a=Math.min(r[0],r[2]),i=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),l=Math.min(o[0],o[2]),c=Math.min(o[1],o[3]),h=Math.max(o[0],o[2]),d=Math.max(o[1],o[3]),p=(s-a)*(u-i),g=(h-l)*(d-c);if(p<=0||g<=0)return 0;const x=Math.max(a,l),y=Math.max(i,c),b=Math.min(s,h),C=Math.min(u,d),E=Math.max(b-x,0)*Math.max(C-y,0);return E/(p+g-E)}function D0t(n,t,e){const r=Math.exp(t*e*e);return e<=n?r:0}function O3(n,t){return n.score-t.score||n.score===t.score&&t.boxIndex-n.boxIndex}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function $0t(n,t,e,r=.5,o=Number.NEGATIVE_INFINITY){const a=J(n,"boxes","nonMaxSuppressionAsync"),i=J(t,"scores","nonMaxSuppressionAsync"),s=md(a,i,e,r,o);e=s.maxOutputSize,r=s.iouThreshold,o=s.scoreThreshold;const u=await Promise.all([a.data(),i.data()]),l=u[0],c=u[1],{selectedIndices:h}=eT(l,c,e,r,o);return a!==n&&a.dispose(),i!==t&&i.dispose(),Go(h,"int32")}const O0t=$0t;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F0t(n,t,e,r=.5,o=Number.NEGATIVE_INFINITY,a=0){const i=J(n,"boxes","nonMaxSuppression"),s=J(t,"scores","nonMaxSuppression"),u=md(i,s,e,r,o,a);e=u.maxOutputSize,r=u.iouThreshold,o=u.scoreThreshold,a=u.softNmsSigma;const l={boxes:i,scores:s},c={maxOutputSize:e,iouThreshold:r,scoreThreshold:o,softNmsSigma:a},h=ut.runKernel(gR,l,c);return{selectedIndices:h[0],selectedScores:h[1]}}const M0t=ft({nonMaxSuppressionWithScore_:F0t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function L0t(n,t,e,r=.5,o=Number.NEGATIVE_INFINITY,a=0){const i=J(n,"boxes","nonMaxSuppressionAsync"),s=J(t,"scores","nonMaxSuppressionAsync"),u=md(i,s,e,r,o,a);e=u.maxOutputSize,r=u.iouThreshold,o=u.scoreThreshold,a=u.softNmsSigma;const l=await Promise.all([i.data(),s.data()]),c=l[0],h=l[1],{selectedIndices:d,selectedScores:p}=rT(c,h,e,r,o,a);return i!==n&&i.dispose(),s!==t&&s.dispose(),{selectedIndices:Go(d,"int32"),selectedScores:Go(p)}}const P0t=L0t;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B0t(n,t,e,r=.5,o=Number.NEGATIVE_INFINITY,a=!1){const i=J(n,"boxes","nonMaxSuppression"),s=J(t,"scores","nonMaxSuppression"),u=md(i,s,e,r,o,null),l=u.maxOutputSize,c=u.iouThreshold,h=u.scoreThreshold,d={boxes:i,scores:s},p={maxOutputSize:l,iouThreshold:c,scoreThreshold:h,padToMaxOutputSize:a},g=ut.runKernel(mR,d,p);return{selectedIndices:g[0],validOutputs:g[1]}}const z0t=ft({nonMaxSuppressionPadded_:B0t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function U0t(n,t,e,r=.5,o=Number.NEGATIVE_INFINITY,a=!1){const i=J(n,"boxes","nonMaxSuppressionAsync"),s=J(t,"scores","nonMaxSuppressionAsync"),u=md(i,s,e,r,o,null),l=u.maxOutputSize,c=u.iouThreshold,h=u.scoreThreshold,[d,p]=await Promise.all([i.data(),s.data()]),{selectedIndices:g,validOutputs:x}=nT(d,p,l,c,h,a);return i!==n&&i.dispose(),s!==t&&s.dispose(),{selectedIndices:Go(g,"int32"),validOutputs:Je(x,"int32")}}const W0t=U0t;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V0t(n,t,e=!1,r=!1){const o=J(n,"images","resizeBilinear");H(o.rank===3||o.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${o.rank}.`),H(t.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${t}.`),H(r===!1||e===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let a=o,i=!1;o.rank===3&&(i=!0,a=ht(o,[1,o.shape[0],o.shape[1],o.shape[2]]));const s={images:a},u={alignCorners:e,halfPixelCenters:r,size:t},l=ut.runKernel(ab,s,u);return i?ht(l,[l.shape[1],l.shape[2],l.shape[3]]):l}const BU=ft({resizeBilinear_:V0t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G0t(n,t,e=!1,r=!1){const o=J(n,"images","resizeNearestNeighbor");H(o.rank===3||o.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${o.rank}.`),H(t.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${t}.`),H(o.dtype==="float32"||o.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),H(r===!1||e===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let a=o,i=!1;o.rank===3&&(i=!0,a=ht(o,[1,o.shape[0],o.shape[1],o.shape[2]]));const s={images:a},u={alignCorners:e,halfPixelCenters:r,size:t},l=ut.runKernel(ob,s,u);return i?ht(l,[l.shape[1],l.shape[2],l.shape[3]]):l}const zU=ft({resizeNearestNeighbor_:G0t});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H0t(n,t="binary",e=!1,r=.5){const o=J(n,"image","threshold"),a=.2989,i=.587,s=.114,u=o.shape[0]*o.shape[1];let l=it(Go([r]),255),c,h,d,p;if(H(o.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${o.rank}.`),H(o.shape[2]===3||o.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${o.shape[2]}.`),H(o.dtype==="int32"||o.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${o.dtype}.`),H(t==="otsu"||t==="binary",()=>`Method must be binary or otsu, but was ${t}`),o.shape[2]===3){[c,h,d]=ba(o,[1,1,1],-1);const y=it(c,a),b=it(h,i),C=it(d,s);p=Bt(Bt(y,b),C)}else p=n;if(t==="otsu"){const y=Vmt(jt(RU(p),"int32"),Jz([]),256);l=q0t(y,u)}const g=e?pd(p,l):Ca(p,l);return jt(it(g,255),"int32")}function q0t(n,t){let e=Go([-1]),r=Go([0]),o=Go([0]),a,i,s,u,l,c;for(let h=0;h<n.size-1;h++){a=kn(n,0,h+1),i=kn(n,h+1),l=fe(ce(a),t),c=fe(ce(i),t);const d=ce(it(a,hm(0,a.size)));s=fe(d,ce(a));const p=wb(i.shape,a.size),g=Bt(hm(0,i.size),p),x=it(i,g);u=fe(ce(x),ce(i));const y=me(s,u),b=me(s,u),C=it(l,c);o=it(it(C,y),b);const E=Ca(o,r);r=bo(E,o,r),e=bo(E,Go([h]),e)}return e}const j0t=ft({threshold_:H0t});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X0t(n,t,e="nearest",r="constant",o=0,a){const i=J(n,"image","transform","float32"),s=J(t,"transforms","transform","float32");H(i.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${i.rank}.`),H(s.rank===2&&(s.shape[0]===i.shape[0]||s.shape[0]===1)&&s.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),H(a==null||a.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${a}.`);const u={image:i,transforms:s},l={interpolation:e,fillMode:r,fillValue:o,outputShape:a};return ut.runKernel(kR,u,l)}const K0t=ft({transform_:X0t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y0t(n,t,e){const r=J(n,"a","bandPart");H(r.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${r.rank}.`);const o=r.shape,[a,i]=r.shape.slice(-2);let s,u;typeof t=="number"?(H(t%1===0,()=>`bandPart(): numLower must be an integer, got ${t}.`),H(t<=a,()=>`bandPart(): numLower (${t}) must not be greater than the number of rows (${a}).`),s=J(t<0?a:t,"numLower","bandPart")):(H(t.dtype==="int32",()=>"bandPart(): numLower's dtype must be an int32."),s=bo(Sy(t,0),a,cm(t,a))),typeof e=="number"?(H(e%1===0,()=>`bandPart(): numUpper must be an integer, got ${e}.`),H(e<=i,()=>`bandPart(): numUpper (${e}) must not be greater than the number of columns (${i}).`),u=J(e<0?i:e,"numUpper","bandPart")):(H(e.dtype==="int32",()=>"bandPart(): numUpper's dtype must be an int32."),u=bo(Sy(e,0),i,cm(e,i)));const l=ht(hm(0,a,1,"int32"),[-1,1]),c=hm(0,i,1,"int32"),h=me(l,c),d=Ks(pd(h,s),eh(h,Zn(u))),p=Rr([a,i],r.dtype);return ht(Ys(Fc(ht(r,[-1,a,i])).map(g=>bo(d,g,p))),o)}const Q0t=ft({bandPart_:Y0t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z0t(n){let t;if(Array.isArray(n)){t=!1,H(n!=null&&n.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const o=n[0].shape[0];for(let a=1;a<n.length;++a)H(n[a].shape[0]===o,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${n[a].shape[0]} vs. ${o})`)}else t=!0,n=ba(n,n.shape[0],0).map(o=>Hg(o,[0]));H(n.length<=n[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${n.length}) exceeds number of dimensions (${n[0].shape[0]}).`);const e=[],r=n;for(let o=0;o<n.length;++o)e.push(ut.tidy(()=>{let a=r[o];if(o>0)for(let i=0;i<o;++i){const s=it(ce(it(e[i],a)),e[i]);a=me(a,s)}return fe(a,Sb(a,"euclidean"))}));return t?Ys(e,0):e}const J0t=ft({gramSchmidt_:Z0t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tyt(n,t=!1){if(H(n.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${n.rank}`),n.rank===2)return F3(n,t);{const e=n.shape.slice(0,n.shape.length-2).reduce((u,l)=>u*l),r=Fc(ht(n,[e,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0),o=[],a=[];r.forEach(u=>{const[l,c]=F3(u,t);o.push(l),a.push(c)});const i=ht(Ys(o,0),n.shape),s=ht(Ys(a,0),n.shape);return[i,s]}}function F3(n,t=!1){return ut.tidy(()=>{H(n.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${n.shape.length}D Tensor.`);const e=n.shape[0],r=n.shape[1];let o=xU(e),a=xc(n);const i=cS([[1]],[1,1]);let s=xc(i);const u=e>=r?r:e;for(let l=0;l<u;++l){const c=a,h=s,d=o;[s,a,o]=ut.tidy(()=>{const p=kn(a,[l,l],[e-l,1]),g=Sb(p),x=kn(a,[l,l],[1,1]),y=bo(Ca(x,0),cS([[-1]]),cS([[1]])),b=me(x,it(y,g)),C=fe(p,b);C.shape[0]===1?s=xc(i):s=No([i,kn(C,[1,0],[C.shape[0]-1,C.shape[1]])],0);const E=Zn(fe(Qe(y,b),g)),S=kn(a,[l,0],[e-l,r]),k=it(E,s),R=Ue(s);if(l===0)a=me(S,Qe(k,Qe(R,S)));else{const _=me(S,Qe(k,Qe(R,S)));a=No([kn(a,[0,0],[l,r]),_],0)}const A=Ue(k),N=kn(o,[0,l],[e,o.shape[1]-l]);if(l===0)o=me(N,Qe(Qe(N,s),A));else{const _=me(N,Qe(Qe(N,s),A));o=No([kn(o,[0,0],[e,l]),_],1)}return[s,a,o]}),Oe([c,h,d])}return!t&&e>r&&(o=kn(o,[0,0],[e,r]),a=kn(a,[0,0],[r,r])),[o,a]})}const eyt=ft({qr_:tyt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gs={flipLeftRight:x0t,grayscaleToRGB:b0t,resizeNearestNeighbor:zU,resizeBilinear:BU,rgbToGrayscale:C0t,rotateWithOffset:E0t,cropAndResize:g0t,nonMaxSuppression:I0t,nonMaxSuppressionAsync:O0t,nonMaxSuppressionWithScore:M0t,nonMaxSuppressionWithScoreAsync:P0t,nonMaxSuppressionPadded:z0t,nonMaxSuppressionPaddedAsync:W0t,threshold:j0t,transform:K0t},nyt={bandPart:Q0t,gramSchmidt:J0t,qr:eyt};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ryt=new Map,oyt=new Map;class gd{getClassName(){return this.constructor.className}static fromConfig(t,e){return new t(e)}}class Ba{constructor(){this.classNameMap={}}static getMap(){return Ba.instance==null&&(Ba.instance=new Ba),Ba.instance}static register(t){Ba.getMap().classNameMap[t.className]=[t,t.fromConfig]}}function Lt(n,t,e){H(n.className!=null,()=>"Class being registered does not have the static className property defined."),H(typeof n.className=="string",()=>"className is required to be a string, but got type "+typeof n.className),H(n.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),typeof t>"u"&&(t="Custom"),typeof e>"u"&&(e=n.className);const r=e,o=t+">"+r;return Ba.register(n),ryt.set(o,n),oyt.set(n,o),n}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Il extends gd{minimize(t,e=!1,r){const{value:o,grads:a}=this.computeGradients(t,r);if(r!=null){const i=r.map(s=>({name:s.name,tensor:a[s.name]}));this.applyGradients(i)}else this.applyGradients(a);return Oe(a),e?o:(o.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(t,e){return cvt(t,e)}dispose(){this.iterations_!=null&&Oe(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:Je(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(t){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(t){return this.iterations_=(await t[0].tensor.data())[0],t.slice(1)}}Object.defineProperty(Il,Symbol.hasInstance,{value:n=>n.minimize!=null&&n.computeGradients!=null&&n.applyGradients!=null});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class UU extends Il{static get className(){return"Adadelta"}constructor(t,e,r=null){super(),this.learningRate=t,this.rho=e,this.epsilon=r,this.accumulatedGrads=[],this.accumulatedUpdates=[],r==null&&(this.epsilon=ut.backend.epsilon())}applyGradients(t){(Array.isArray(t)?t.map(r=>r.name):Object.keys(t)).forEach((r,o)=>{const a=ut.registeredVariables[r],i=!1;this.accumulatedGrads[o]==null&&(this.accumulatedGrads[o]={originalName:`${r}/accum_grad`,variable:gt(()=>We(a).variable(i))}),this.accumulatedUpdates[o]==null&&(this.accumulatedUpdates[o]={originalName:`${r}/accum_var`,variable:gt(()=>We(a).variable(i))});const s=Array.isArray(t)?t[o].tensor:t[r];if(s==null)return;const u=this.accumulatedGrads[o].variable,l=this.accumulatedUpdates[o].variable;gt(()=>{const c=Bt(it(u,this.rho),it(An(s),1-this.rho)),h=it(fe(eo(Bt(l,this.epsilon)),eo(Bt(u,this.epsilon))),s),d=Bt(it(l,this.rho),it(An(h),1-this.rho));u.assign(c),l.assign(d);const p=Bt(it(h,-this.learningRate),a);a.assign(p)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(Oe(this.accumulatedGrads.map(t=>t.variable)),Oe(this.accumulatedUpdates.map(t=>t.variable)))}async getWeights(){const t=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(t.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(t){t=await this.extractIterations(t);const e=t.length/2,r=!1;this.accumulatedGrads=t.slice(0,e).map(o=>({originalName:o.name,variable:o.tensor.variable(r)})),this.accumulatedUpdates=t.slice(e,e*2).map(o=>({originalName:o.name,variable:o.tensor.variable(r)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(t,e){return new t(e.learningRate,e.rho,e.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class WU extends Il{static get className(){return"Adagrad"}constructor(t,e=.1){super(),this.learningRate=t,this.initialAccumulatorValue=e,this.accumulatedGrads=[]}applyGradients(t){(Array.isArray(t)?t.map(r=>r.name):Object.keys(t)).forEach((r,o)=>{const a=ut.registeredVariables[r];this.accumulatedGrads[o]==null&&(this.accumulatedGrads[o]={originalName:`${r}/accumulator`,variable:gt(()=>wb(a.shape,this.initialAccumulatorValue).variable(!1))});const i=Array.isArray(t)?t[o].tensor:t[r];if(i==null)return;const s=this.accumulatedGrads[o].variable;gt(()=>{const u=Bt(s,An(i));s.assign(u);const l=Bt(it(fe(i,eo(Bt(u,ut.backend.epsilon()))),-this.learningRate),a);a.assign(l)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&Oe(this.accumulatedGrads.map(t=>t.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(t){t=await this.extractIterations(t);const e=!1;this.accumulatedGrads=t.map(r=>({originalName:r.name,variable:r.tensor.variable(e)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(t,e){return new t(e.learningRate,e.initialAccumulatorValue)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class VU extends Il{static get className(){return"Adam"}constructor(t,e,r,o=null){super(),this.learningRate=t,this.beta1=e,this.beta2=r,this.epsilon=o,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],gt(()=>{this.accBeta1=Je(e).variable(),this.accBeta2=Je(r).variable()}),o==null&&(this.epsilon=ut.backend.epsilon())}applyGradients(t){const e=Array.isArray(t)?t.map(r=>r.name):Object.keys(t);gt(()=>{const r=me(1,this.accBeta1),o=me(1,this.accBeta2);e.forEach((a,i)=>{const s=ut.registeredVariables[a],u=!1;this.accumulatedFirstMoment[i]==null&&(this.accumulatedFirstMoment[i]={originalName:`${a}/m`,variable:gt(()=>We(s).variable(u))}),this.accumulatedSecondMoment[i]==null&&(this.accumulatedSecondMoment[i]={originalName:`${a}/v`,variable:gt(()=>We(s).variable(u))});const l=Array.isArray(t)?t[i].tensor:t[a];if(l==null)return;const c=this.accumulatedFirstMoment[i].variable,h=this.accumulatedSecondMoment[i].variable,d=Bt(it(c,this.beta1),it(l,1-this.beta1)),p=Bt(it(h,this.beta2),it(An(l),1-this.beta2)),g=fe(d,r),x=fe(p,o);c.assign(d),h.assign(p);const y=Bt(it(fe(g,Bt(eo(x),this.epsilon)),-this.learningRate),s);s.assign(y)}),this.accBeta1.assign(it(this.accBeta1,this.beta1)),this.accBeta2.assign(it(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&Oe(this.accumulatedFirstMoment.map(t=>t.variable)),this.accumulatedSecondMoment!=null&&Oe(this.accumulatedSecondMoment.map(t=>t.variable))}async getWeights(){const t=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(t.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(t){t=await this.extractIterations(t),gt(()=>{this.accBeta1.assign($c(this.beta1,this.iterations_+1)),this.accBeta2.assign($c(this.beta2,this.iterations_+1))});const e=t.length/2,r=!1;this.accumulatedFirstMoment=t.slice(0,e).map(o=>({originalName:o.name,variable:o.tensor.variable(r)})),this.accumulatedSecondMoment=t.slice(e,e*2).map(o=>({originalName:o.name,variable:o.tensor.variable(r)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class GU extends Il{static get className(){return"Adamax"}constructor(t,e,r,o=null,a=0){super(),this.learningRate=t,this.beta1=e,this.beta2=r,this.epsilon=o,this.decay=a,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],gt(()=>{this.iteration=Je(0).variable(),this.accBeta1=Je(e).variable()}),o==null&&(this.epsilon=ut.backend.epsilon())}applyGradients(t){const e=Array.isArray(t)?t.map(r=>r.name):Object.keys(t);gt(()=>{const r=me(1,this.accBeta1),o=fe(-this.learningRate,Bt(it(this.iteration,this.decay),1));e.forEach((a,i)=>{const s=ut.registeredVariables[a],u=!1;this.accumulatedFirstMoment[i]==null&&(this.accumulatedFirstMoment[i]={originalName:`${a}/m`,variable:We(s).variable(u)}),this.accumulatedWeightedInfNorm[i]==null&&(this.accumulatedWeightedInfNorm[i]={originalName:`${a}/v`,variable:We(s).variable(u)});const l=Array.isArray(t)?t[i].tensor:t[a];if(l==null)return;const c=this.accumulatedFirstMoment[i].variable,h=this.accumulatedWeightedInfNorm[i].variable,d=Bt(it(c,this.beta1),it(l,1-this.beta1)),p=it(h,this.beta2),g=fo(l),x=El(p,g);c.assign(d),h.assign(x);const y=Bt(it(fe(o,r),fe(d,Bt(x,this.epsilon))),s);s.assign(y)}),this.iteration.assign(Bt(this.iteration,1)),this.accBeta1.assign(it(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&Oe(this.accumulatedFirstMoment.map(t=>t.variable)),this.accumulatedWeightedInfNorm!=null&&Oe(this.accumulatedWeightedInfNorm.map(t=>t.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(t){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon,e.decay)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aT extends Il{static get className(){return"SGD"}constructor(t){super(),this.learningRate=t,this.setLearningRate(t)}applyGradients(t){(Array.isArray(t)?t.map(r=>r.name):Object.keys(t)).forEach((r,o)=>{const a=Array.isArray(t)?t[o].tensor:t[r];if(a==null)return;const i=ut.registeredVariables[r];gt(()=>{const s=Bt(it(this.c,a),i);i.assign(s)})}),this.incrementIterations()}setLearningRate(t){this.learningRate=t,this.c!=null&&this.c.dispose(),this.c=Yi(Je(-t))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(t){if(t=await this.extractIterations(t),t.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(t,e){return new t(e.learningRate)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class HU extends aT{static get className(){return"Momentum"}constructor(t,e,r=!1){super(t),this.learningRate=t,this.momentum=e,this.useNesterov=r,this.accumulations=[],this.m=Je(this.momentum)}applyGradients(t){(Array.isArray(t)?t.map(r=>r.name):Object.keys(t)).forEach((r,o)=>{const a=ut.registeredVariables[r];this.accumulations[o]==null&&(this.accumulations[o]={originalName:`${r}/momentum`,variable:gt(()=>We(a).variable(!1))});const i=this.accumulations[o].variable,s=Array.isArray(t)?t[o].tensor:t[r];s!=null&&gt(()=>{let u;const l=Bt(it(this.m,i),s);this.useNesterov?u=Bt(it(this.c,Bt(s,it(l,this.m))),a):u=Bt(it(this.c,l),a),i.assign(l),a.assign(u)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&Oe(this.accumulations.map(t=>t.variable))}setMomentum(t){this.momentum=t}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(t){t=await this.extractIterations(t);const e=!1;this.accumulations=t.map(r=>({originalName:r.name,variable:r.tensor.variable(e)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(t,e){return new t(e.learningRate,e.momentum,e.useNesterov)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qU extends Il{static get className(){return"RMSProp"}constructor(t,e=.9,r=0,o=null,a=!1){if(super(),this.learningRate=t,this.decay=e,this.momentum=r,this.epsilon=o,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=a,o==null&&(this.epsilon=ut.backend.epsilon()),t==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(t){(Array.isArray(t)?t.map(r=>r.name):Object.keys(t)).forEach((r,o)=>{const a=ut.registeredVariables[r],i=!1;this.accumulatedMeanSquares[o]==null&&(this.accumulatedMeanSquares[o]={originalName:`${r}/rms`,variable:gt(()=>We(a).variable(i))}),this.accumulatedMoments[o]==null&&(this.accumulatedMoments[o]={originalName:`${r}/momentum`,variable:gt(()=>We(a).variable(i))}),this.accumulatedMeanGrads[o]==null&&this.centered&&(this.accumulatedMeanGrads[o]={originalName:`${r}/mg`,variable:gt(()=>We(a).variable(i))});const s=Array.isArray(t)?t[o].tensor:t[r];if(s==null)return;const u=this.accumulatedMeanSquares[o].variable,l=this.accumulatedMoments[o].variable;gt(()=>{const c=Bt(it(u,this.decay),it(An(s),1-this.decay));if(this.centered){const h=this.accumulatedMeanGrads[o].variable,d=Bt(it(h,this.decay),it(s,1-this.decay)),p=fe(it(s,this.learningRate),eo(me(c,Bt(An(d),this.epsilon)))),g=Bt(it(l,this.momentum),p);u.assign(c),h.assign(d),l.assign(g);const x=me(a,g);a.assign(x)}else{const h=Bt(it(u,this.decay),it(An(s),1-this.decay)),d=Bt(it(l,this.momentum),fe(it(s,this.learningRate),eo(Bt(h,this.epsilon))));u.assign(h),l.assign(d);const p=me(a,d);a.assign(p)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&Oe(this.accumulatedMeanSquares.map(t=>t.variable)),this.accumulatedMeanGrads!=null&&this.centered&&Oe(this.accumulatedMeanGrads.map(t=>t.variable)),this.accumulatedMoments!=null&&Oe(this.accumulatedMoments.map(t=>t.variable))}async getWeights(){const t=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&t.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(t.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(t){t=await this.extractIterations(t);const e=this.centered?t.length/3:t.length/2,r=!1;this.accumulatedMeanSquares=t.slice(0,e).map(o=>({originalName:o.name,variable:o.tensor.variable(r)})),this.accumulatedMoments=t.slice(e,e*2).map(o=>({originalName:o.name,variable:o.tensor.variable(r)})),this.centered&&(this.accumulatedMeanGrads=t.slice(e*2,e*3).map(o=>({originalName:o.name,variable:o.tensor.variable(r)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(t,e){return new t(e.learningRate,e.decay,e.momentum,e.epsilon,e.centered)}}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ayt=[UU,WU,VU,GU,HU,qU,aT];function iyt(){for(const n of ayt)Lt(n)}function iT(n,t){const e=n.shape.length,r=t.shape.length;if(e<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${e}.`);if(r<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${r}.`);if(t.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${t.dtype}.`);if(t.shape[r-1]>e)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${t.shape[r-1]} vs. ${e}`);if(It(n.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${n.shape}.`);const o=t.shape,a=o[o.length-1];let i=1;for(let h=0;h<o.length-1;++h)i*=o[h];const s=n.shape,u=o.slice();u.pop();let l=1;for(let h=a;h<e;++h)l*=s[h],u.push(s[h]);const c=[...ue(n.shape).map(h=>h/l),1].slice(0,a);return[u,i,l,c]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LE=-2,syt=-1;function sT(n,t,e){const r=n.shape.length;H(r===t.length,()=>`Error in slice${r}D: Length of begin ${t} must match the rank of the array (${r}).`),H(r===e.length,()=>`Error in slice${r}D: Length of size ${e} must match the rank of the array (${r}).`);for(let o=0;o<r;++o)H(t[o]+e[o]<=n.shape[o],()=>`Error in slice${r}D: begin[${o}] + size[${o}] (${t[o]+e[o]}) would overflow input.shape[${o}] (${n.shape[o]})`)}function uyt(n){const t=[];let e=0;for(;n>0;)n&1&&t.push(e),n/=2,e++;return t}function uT(n,t,e){const r=[];for(let o=0;o<n.length;o++)r[o]=Math.ceil((t[o]-n[o])/e[o]);return r}function jU(n,t,e,r){const o=[...n];for(let a=o.length;a<r.length;a++)o.push(1);for(let a=0;a<e;a++)a===0?o[t]=1:(o.splice(t,0,1),o.pop());return o}function XU(n,t,e){return e<=n?e:e-(t-1)}function KU(n,t){const e=[];for(let r=0;r<n;r++)e.push(t+r);return e}function lyt(n,t,e,r,o,a,i,s,u){const l=n.length;let c=new Array(l),h=new Array(l),d=new Array(l);if(t.length&&e>0){const p=t[0],g=e+1;c=YU(i,p,g,r,n),h=QU(s,p,g,o,n),d=jU(a,p,g,n)}else for(let p=0;p<l;p++)c[p]=JU(i,r,a,n,p,u),h[p]=tW(s,o,a,n,p,u),d[p]=ZU(a,p,u);return{begin:c,end:h,strides:d}}function YU(n,t,e,r,o){const a=[...o],i=KU(e,t);for(let s=0;s<a.length;s++)if(i.indexOf(s)>-1)a[s]=0;else{const u=XU(t,e,s);let l=r[u];n&1<<u&&(l=0),a[s]=l}return a}function QU(n,t,e,r,o){const a=[...o],i=KU(e,t);for(let s=0;s<a.length;s++)if(i.indexOf(s)>-1)a[s]=Number.MAX_SAFE_INTEGER;else{const u=XU(t,e,s);let l=r[u];n&1<<u&&(l=Number.MAX_SAFE_INTEGER),a[s]=l}for(let s=0;s<a.length;s++){const u=o[s];a[s]<0&&(a[s]+=u),a[s]=Ic(0,a[s],o[s])}return a}function ZU(n,t,e){let r=n[t];return(e&1<<t||r==null)&&(r=1),r}function JU(n,t,e,r,o,a){let i=t[o];const s=e[o]||1;(n&1<<o||a&1<<o||i==null)&&(s>0?i=Number.MIN_SAFE_INTEGER:i=Number.MAX_SAFE_INTEGER);const u=r[o];return i<0&&(i+=u),i=Ic(0,i,u-1),i}function tW(n,t,e,r,o,a){let i=t[o];const s=e[o]||1;(n&1<<o||a&1<<o||i==null)&&(s>0?i=Number.MAX_SAFE_INTEGER:i=Number.MIN_SAFE_INTEGER);const u=r[o];return i<0&&(i+=u),s>0?i=Ic(0,i,u):i=Ic(-1,i,u-1),i}function lT(n,t,e){let r=e.length;for(let o=0;o<e.length;o++)if(e[o]>1){r=o;break}for(let o=r+1;o<e.length;o++)if(t[o]>0||e[o]!==n[o])return!1;return!0}function cT(n,t){let e=n.length>0?n[n.length-1]:1;for(let r=0;r<n.length-1;r++)e+=n[r]*t[r];return e}function kb(n,t,e){let r;const o=n.shape.length;typeof t=="number"?r=[t,...new Array(o-1).fill(0)]:t.length<o?r=t.concat(new Array(o-t.length).fill(0)):r=t.slice(),r.forEach(i=>{H(i!==-1,()=>"slice() does not support negative begin indexing.")});let a;return e==null?a=new Array(o).fill(-1):typeof e=="number"?a=[e,...new Array(o-1).fill(-1)]:e.length<o?a=e.concat(new Array(o-e.length).fill(-1)):a=e,a=a.map((i,s)=>i>=0?i:(H(i===-1,()=>`Negative size values should be exactly -1 but got ${i} for the slice() size at index ${s}.`),n.shape[s]-r[s])),[r,a]}function hT(n,t,e,r,o,a,i,s,u){let l;if(r==null?(l=new Array(t.length),l.fill(1)):l=r,i!=null&&(i&i-1)!==0)throw new Error("Multiple ellipses in slice is not allowed.");let c=!1;const h={dims:l.length,numAddAxisAfterEllipsis:0,begin:t.slice(),end:e.slice(),strides:l.slice(),beginMask:o,endMask:a,ellipsisMask:i,newAxisMask:s,shrinkAxisMask:u};for(let E=0;E<h.dims;E++)c&&(1<<E&s)!==0&&h.numAddAxisAfterEllipsis++,1<<E&i&&(c=!0);c||(h.ellipsisMask|=1<<h.dims,h.dims++);const d={dims:n.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};cyt(h,d);let p=!0,g=!0,x=!0;const y=[],b=[];for(let E=0;E<n.length;++E){if(d.strides[E]===0)throw Error(`strides[${E}] must be non-zero`);const S=!!(d.shrinkAxisMask&1<<E),k=n[E];if(k===-1){y.push(S?1:-1);continue}const R=[d.beginMask&1<<E,d.endMask&1<<E],A=[d.strides[E]>0?0:-1,d.strides[E]>0?k:k-1];if(S&&d.strides[E]<=0)throw Error("only stride 1 allowed on non-range indexing.");x=x&&d.strides[E]===1;const N=!!(d.beginMask&1<<E&&d.endMask&1<<E);if(d.beginValid&&d.endValid){if(S){const O=d.begin[E]<0?k+d.begin[E]:d.begin[E];if(d.begin[E]=O,d.end[E]=d.begin[E]+1,O<0||O>=k)throw Error(`slice index ${d.begin[E]} of dimension ${E} out of bounds.`)}else d.begin[E]=M3(d.begin[E],0,d.strides[E],k,R,A),d.end[E]=M3(d.end[E],1,d.strides[E],k,R,A);const D=d.strides[E]===1&&d.begin[E]===0&&d.end[E]===k;p=p&&D,g=g&&(E===0&&d.strides[E]===1||D)}else p=p&&d.strides[E]===1&&N,g=g&&(E===0&&d.strides[E]===1||N);let _,$=!1;if(d.beginValid&&d.endValid?(_=d.end[E]-d.begin[E],$=!0):S?(_=1,$=!0):N&&k>=0&&(d.strides[E]<0?_=-k:_=k,$=!0),$){let D;_===0||_<0!=d.strides[E]<0?D=0:D=Math.trunc(_/d.strides[E])+(_%d.strides[E]!==0?1:0),y.push(D)}else y.push(-1)}for(let E=0;E<d.finalShapeGatherIndices.length;++E){const S=d.finalShapeGatherIndices[E];S>=0?b.push(y[S]):S===LE&&b.push(1)}return{finalShapeSparse:b.filter((E,S)=>d.finalShapeGatherIndices[S]!==LE),finalShape:b,isIdentity:p,sliceDim0:g,isSimpleSlice:x,begin:d.begin,end:d.end,strides:d.strides}}function cyt(n,t){t.beginMask=0,t.endMask=0,t.shrinkAxisMask=0;let e=0;t.beginValid=n.begin!=null,t.endValid=n.end!=null,t.begin=new Array(t.dims),t.end=new Array(t.dims),t.strides=new Array(t.dims),t.finalShapeGatherIndices=[],t.finalShapeGatherIndicesSparse=[],t.inputShapeGatherIndicesSparse=new Array(t.dims);for(let r=0;r<n.dims;r++)if(1<<r&n.ellipsisMask){const o=Math.min(t.dims-(n.dims-r)+1+n.numAddAxisAfterEllipsis,t.dims);for(;e<o;e++)t.begin[e]=0,t.end[e]=0,t.strides[e]=1,t.beginMask|=1<<e,t.endMask|=1<<e,t.finalShapeGatherIndices.push(e),t.finalShapeGatherIndicesSparse.push(-1),t.inputShapeGatherIndicesSparse[e]=r}else if(1<<r&n.newAxisMask)t.finalShapeGatherIndices.push(LE),t.finalShapeGatherIndicesSparse.push(-1);else{if(e===t.begin.length)throw Error(`Index out of range using input dim ${e}; input has only ${t.dims} dims, ${t.begin.length}.`);n.begin!=null&&(t.begin[e]=n.begin[r]),n.end!=null&&(t.end[e]=n.end[r]),t.strides[e]=n.strides[r],n.beginMask&1<<r&&(t.beginMask|=1<<e),n.endMask&1<<r&&(t.endMask|=1<<e),n.shrinkAxisMask&1<<r?(t.finalShapeGatherIndices.push(syt),t.finalShapeGatherIndicesSparse.push(-1),t.shrinkAxisMask|=1<<e):(t.finalShapeGatherIndices.push(e),t.finalShapeGatherIndicesSparse.push(r)),t.inputShapeGatherIndicesSparse[e]=r,e++}}function M3(n,t,e,r,o,a){if(o[t])return e>0?a[t]:a[t+1&1];{const i=n<0?r+n:n;return i<a[0]?a[0]:i>a[1]?a[1]:i}}const hyt=Object.freeze(Object.defineProperty({__proto__:null,assertParamsValid:sT,computeFlatOffset:cT,computeOutShape:uT,getNormalizedAxes:lyt,isSliceContinous:lT,maskToAxes:uyt,parseSliceParams:kb,sliceInfo:hT,startForAxis:JU,startIndicesWithElidedDims:YU,stopForAxis:tW,stopIndicesWithElidedDims:QU,stridesForAxis:ZU,stridesWithElidedDims:jU},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fyt{static sgd(t){return new aT(t)}static momentum(t,e,r=!1){return new HU(t,e,r)}static rmsprop(t,e=.9,r=0,o=null,a=!1){return new qU(t,e,r,o,a)}static adam(t=.001,e=.9,r=.999,o=null){return new VU(t,e,r,o)}static adadelta(t=.001,e=.95,r=null){return new UU(t,e,r)}static adamax(t=.002,e=.9,r=.999,o=null,a=0){return new GU(t,e,r,o,a)}static adagrad(t,e=.1){return new WU(t,e)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jh=fyt;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dyt=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:n=>n();function eW(){return new Promise(n=>dyt(()=>n()))}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fT(n,t){const e=n[0].length;n.forEach((o,a)=>{H(o.length===e,()=>`Error in concat${e}D: rank of tensors[${a}] must be the same as the rank of the rest (${e})`)}),H(t>=0&&t<e,()=>`Error in concat${e}D: axis must be between 0 and ${e-1}.`);const r=n[0];n.forEach((o,a)=>{for(let i=0;i<e;i++)H(i===t||o[i]===r[i],()=>`Error in concat${e}D: Shape of tensors[${a}] (${o}) does not match the shape of the rest (${r}) along the non-concatenated axis ${a}.`)})}function Qi(n,t){const e=n[0].slice();for(let r=1;r<n.length;r++)e[t]+=n[r][t];return e}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var si;(function(n){n[n.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",n[n.VALUE_ROWIDS=1]="VALUE_ROWIDS",n[n.ROW_LENGTHS=2]="ROW_LENGTHS",n[n.ROW_SPLITS=3]="ROW_SPLITS",n[n.ROW_LIMITS=4]="ROW_LIMITS",n[n.ROW_STARTS=5]="ROW_STARTS"})(si||(si={}));function nW(n,t,e){let r=new Array;if(e==null&&t==null)return r;if(t==null)for(;r.length<n+e.length;)r.push(-1);else r=t.slice();if(e==null)return r;if(n+e.length!==r.length)throw new Error(`rt input.shape and shape=${t} are incompatible: rt input.rank = ${n+e.length}, but shape.rank = ${r.length}`);for(let o=1;o<e.length;++o){const a=e[o],i=r[r.length-e.length+o],s=r[i];if(a>=0)if(s>=0){if(s!==a)throw new Error(`rt input.shape and shape=${t} are incompatible: rt input.shape[${o+n}] = ${a} but shape[${o+n}] = ${s}`)}else r[i]=a}return r}function rW(n){const t={FIRST_DIM_SIZE:si.FIRST_DIM_SIZE,VALUE_ROWIDS:si.VALUE_ROWIDS,ROW_LENGTHS:si.ROW_LENGTHS,ROW_SPLITS:si.ROW_SPLITS,ROW_LIMITS:si.ROW_LIMITS,ROW_STARTS:si.ROW_STARTS},e=[];for(const r of n)if(r in t)e.push(t[r]);else break;return e}function oW(n){return n.length===0?0:n[0]===si.FIRST_DIM_SIZE?n.length-1:n.length}function aW(n,t){if(n==null||t==null)return;const e=n.length,r=t.length;if(e>=r)throw new Error(`defaultValue.shape=${n} and ragged tensor flatValues.shape=${t}, are incompatible: defaultValue.rank = ${e} must be less than ragged tensor input flatValues.rank = ${r})`);for(let o=0;o<Math.min(e,r-1);++o){const a=n[o],i=t[o+1];if(a>=0&&i>=0&&a!==1&&a!==i)throw new Error(`defaultValue.shape=${n}, and ragged tensor input flatValues.shape=${t} are incompatible: defaultValue.shape[${o-n.length}] = ${a} but ragged tensor input.flatValues.shape[${o-n.length}] = ${i}`)}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dT=30;function Ib(n){return n<=dT?n:wE(n,Math.floor(Math.sqrt(n)))}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pT(n,t,e){const r=e*(typeof n=="number"?n:n[0]),o=t*(typeof n=="number"?n:n[1]);return[r,o]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jg(n,t,e,r=!0){let o=[];if(r)o=o.concat(t.slice(0)),o.push(n[0]/e),o=o.concat(n.slice(1));else{o=o.concat(n[0]);const a=t.length;for(let i=0;i<a;++i)o=o.concat([n[i+1]/t[i],t[i]]);o=o.concat(n.slice(a+1))}return o}function Xg(n,t,e=!0){const r=[];if(e){r.push(t);for(let o=t+1;o<n;++o)o<=2*t?(r.push(o),r.push(o-(t+1))):r.push(o)}else{const o=[],a=[];for(let i=1;i<n;++i)i>=t*2+1||i%2===1?a.push(i):o.push(i);r.push(...o),r.push(0),r.push(...a)}return r}function Kg(n,t,e,r=!0){const o=[];r?o.push(n[0]/e):o.push(n[0]*e);for(let a=1;a<n.length;++a)a<=t.length?r?o.push(t[a-1]*n[a]):o.push(n[a]/t[a-1]):o.push(n[a]);return o}function mT(n,t){const e=[0];for(let r=0;r<t;++r)e.push(n[r][0]);return e}function gT(n,t,e){const r=n.slice(0,1);for(let o=0;o<e;++o)r.push(n[o+1]-t[o][0]-t[o][1]);return r}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rb=1.7580993408473768,Tb=1.0507009873554805;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vT=.3275911,xT=.254829592,yT=-.284496736,bT=1.421413741,wT=-1.453152027,CT=1.061405429;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qs(n,t){if(n.length!==t.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${n.length}, imag: ${t.length}.`);const e=new Float32Array(n.length*2);for(let r=0;r<e.length;r+=2)e[r]=n[r/2],e[r+1]=t[r/2];return e}function iW(n){const t=new Float32Array(n.length/2),e=new Float32Array(n.length/2);for(let r=0;r<n.length;r+=2)t[r/2]=n[r],e[r/2]=n[r+1];return{real:t,imag:e}}function sW(n){const t=Math.ceil(n.length/4),e=new Float32Array(t),r=new Float32Array(t);for(let o=0;o<n.length;o+=4)e[Math.floor(o/4)]=n[o],r[Math.floor(o/4)]=n[o+1];return{real:e,imag:r}}function uW(n){const t=Math.floor(n.length/4),e=new Float32Array(t),r=new Float32Array(t);for(let o=2;o<n.length;o+=4)e[Math.floor(o/4)]=n[o],r[Math.floor(o/4)]=n[o+1];return{real:e,imag:r}}function ST(n,t){const e=n[t*2],r=n[t*2+1];return{real:e,imag:r}}function lW(n,t,e,r){n[r*2]=t,n[r*2+1]=e}function cW(n,t){const e=new Float32Array(n/2),r=new Float32Array(n/2);for(let o=0;o<Math.ceil(n/2);o++){const a=(t?2:-2)*Math.PI*(o/n);e[o]=Math.cos(a),r[o]=Math.sin(a)}return{real:e,imag:r}}function hW(n,t,e){const r=(e?2:-2)*Math.PI*(n/t),o=Math.cos(r),a=Math.sin(r);return{real:o,imag:a}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hS="->",pyt=/->/g,L3=",",P3="...";function ET(n,t){n=n.replace(/\s/g,"");const e=(n.length-n.replace(pyt,"").length)/hS.length;if(e<1)throw new Error("Equations without an arrow are not supported.");if(e>1)throw new Error(`Equation must contain exactly one arrow ("${hS}").`);const[r,o]=n.split(hS);H(r.indexOf(P3)===-1,()=>`The ellipsis notation ("${P3}") is not supported yet.`);const a=r.split(L3),i=a.length;if(t!==i)throw new Error(`Expected ${i} input tensors, received ${t}`);if(i>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const s=[];for(let d=0;d<o.length;++d){const p=o[d];if(!a.some(g=>g.indexOf(p)!==-1))throw new Error(`Output subscripts contain the label ${p} not present in the input subscripts.`);s.indexOf(p)===-1&&s.push(p)}for(let d=0;d<r.length;++d){const p=r[d];s.indexOf(p)===-1&&p!==L3&&s.push(p)}const u=new Array(a.length);for(let d=0;d<i;++d){if(new Set(a[d].split("")).size!==a[d].length)throw new Error(`Found duplicate axes in input component ${a[d]}. Support for duplicate axes in input is not implemented yet.`);u[d]=[];for(let p=0;p<a[d].length;++p)u[d].push(s.indexOf(a[d][p]))}const l=s.length,c=o.length,h=[];for(let d=c;d<l;++d)h.push(d);return{allDims:s,summedDims:h,idDims:u}}function kT(n,t){let e=new Array(n);e.fill(-1);for(let o=0;o<t.length;++o)e[t[o]]=o;const r=[];for(let o=0;o<n;++o)e[o]===-1&&r.push(o);return e=e.filter(o=>o!==-1),{permutationIndices:e,expandDims:r}}function IT(n,t,e){const r=new Array(n);for(let o=0;o<e.length;++o){const a=e[o].shape;for(let i=0;i<t[o].length;++i)r[t[o][i]]===void 0?r[t[o][i]]=a[i]:H(r[t[o][i]]===a[i],()=>`Expected dimension ${r[t[o][i]]} at axis ${i} of input shaped ${JSON.stringify(a)}, but got dimension ${a[i]}`)}}function RT(n,t){const e=n,r=[];let o=0;n.length===0&&e.push(-1),o=n.length+1;for(let i=0;i<o;++i)r.push([]);const a=[];for(let i=0;i<e.length;++i){const s=e[i],u=myt(t,s);for(const l of u)a.indexOf(l)===-1&&(r[i].push(l),a.push(l))}return{path:e,steps:r}}function TT(n){return n.every((t,e)=>t===e)}function myt(n,t){const e=[];for(let r=0;r<n.length;++r)(n[r].length===0||n[r].indexOf(t)!==-1||t===-1)&&e.push(r);return e}function NT(n,t,e=0){let r=[];if(typeof t=="number")H(n.shape[e]%t===0,()=>"Number of splits must evenly divide the axis."),r=new Array(t).fill(n.shape[e]/t);else{const o=t.reduce((i,s)=>(s===-1&&(i+=1),i),0);H(o<=1,()=>"There should be only one negative value in split array.");const a=t.indexOf(-1);if(a!==-1){const i=t.reduce((s,u)=>u>0?s+u:s);t[a]=n.shape[e]-i}H(n.shape[e]===t.reduce((i,s)=>i+s),()=>"The sum of sizes must match the size of the axis dimension."),r=t}return r}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fW(n){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${n}`}function dW(n,t){return`indices(${n}, 0) is invalid: ${t} < 0`}function pW(n,t,e){return`indices(${n}, 0) is invalid: ${t} >= ${e}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mW(n,t){return`only one output dimension may be -1, not both ${n} and ${t}`}function gW(n,t){return`size ${n} must be non-negative, not ${t}`}function vW(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function xW(n,t){const e=It(n),r=It(t);return`Input to reshape is a SparseTensor with ${e}
  dense values, but the requested shape requires a multiple of ${r}. inputShape=${n} outputShape= ${t}`}function yW(n,t){const e=It(n),r=It(t);return`Input to reshape is a tensor with ${e} dense values, but the requested shape has ${r}. inputShape=${n} outputShape=${t}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PE(){return"segment ids must be >= 0"}function bW(){return"segment ids are not increasing"}function wW(n,t){return`Segment id ${n} out of range [0, ${t}), possibly because segmentIds input is not sorted.`}function CW(n,t,e){return`Bad: indices[${n}] == ${t} out of range [0, ${e})`}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SW(n,t){let e=!1,r;for(n<=dT?(r=n,e=!0):r=wE(n,Math.floor(Math.sqrt(n)));!e;)r>t||r===n?e=!0:r=wE(n,r+1);return r}function EW(n,t,e){const r=[],o=n.length;for(let a=0;a<o;a++)a!==t?r.push(n[a]):r.push(e);return r}function AT(n,t,e,r){const o=t.shape.length,a=n.shape.length;if(r!==0&&(r<-o||r>o))throw new Error(`Expect batchDims in the range of [-${o}, ${o}], but got ${r}`);if(r<0&&(r+=o),r>a)throw new Error(`batchDims (${r}) must be less than rank(x) (
    ${a}).`);if(e<r)throw new Error(`batchDims (${r}) must be less than or equal to axis (${e}).`);for(let h=0;h<r;++h)if(n.shape[h]!==t.shape[h])throw new Error(`x.shape[${h}]: ${n.shape[h]} should be equal to indices.shape[${h}]: ${t.shape[h]}.`);const i=n.shape[e],s=[];let u=1,l=1,c=1;for(let h=0;h<r;++h)s.push(n.shape[h]),u*=n.shape[h];for(let h=r;h<e;h++)s.push(n.shape[h]),l*=n.shape[h];for(let h=r;h<o;h++)s.push(t.shape[h]);for(let h=e+1;h<a;h++)s.push(n.shape[h]),c*=n.shape[h];return{batchSize:u,sliceSize:c,outerSize:l,dimSize:i,outputShape:s}}const gyt=Object.freeze(Object.defineProperty({__proto__:null,collectGatherOpShapeInfo:AT,computeOutShape:EW,segOpComputeOptimalWindowSize:SW},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zs(n){try{return n.map(t=>sl(t))}catch(t){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${t}`)}}function kW(n){return n.map(t=>Ju(t))}const vyt=Object.freeze(Object.defineProperty({__proto__:null,ERF_A1:xT,ERF_A2:yT,ERF_A3:bT,ERF_A4:wT,ERF_A5:CT,ERF_P:vT,PARALLELIZE_THRESHOLD:dT,get RowPartitionType(){return si},SELU_SCALE:Tb,SELU_SCALEALPHA:Rb,applyActivation:JR,assertAndGetBroadcastShape:Ee,assertAxesAreInnerMostDims:Gr,assertParamsConsistent:fT,assignToTypedArray:lW,axesAreInnerMostDims:MR,calculateShapes:rh,checkEinsumDimSizes:IT,checkPadOnDimRoundingMode:Oo,combineLocations:gU,combineRaggedTensorToTensorShapes:nW,complexWithEvenIndex:sW,complexWithOddIndex:uW,computeConv2DInfo:Vr,computeConv3DInfo:Cl,computeDefaultPad:AR,computeDilation2DInfo:Wg,computeOptimalWindowSize:Ib,computeOutAndReduceShapes:Dr,computeOutShape:Qi,computePool2DInfo:Ya,computePool3DInfo:hu,convertConv2DDataFormat:fu,decodeEinsumEquation:ET,eitherStridesOrDilationsAreOne:ro,expandShapeToKeepDim:lr,exponent:hW,exponents:cW,fromStringArrayToUint8:kW,fromUint8ToStringArray:Zs,getAxesPermutation:Pn,getBroadcastDims:Gf,getComplexWithIndex:ST,getEinsumComputePath:RT,getEinsumPermutation:kT,getFusedBiasGradient:ZR,getFusedDyActivation:QR,getImageCenter:pT,getInnerMostAxes:er,getPermuted:Xg,getRaggedRank:oW,getReductionAxes:br,getReshaped:jg,getReshapedPermuted:Kg,getRowPartitionTypesHelper:rW,getSliceBeginCoords:mT,getSliceSize:gT,getSparseFillEmptyRowsIndicesDenseShapeMismatch:fW,getSparseFillEmptyRowsNegativeIndexErrorMessage:dW,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:pW,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:vW,getSparseReshapeInputOutputMismatchErrorMessage:yW,getSparseReshapeInputOutputMultipleErrorMessage:xW,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:mW,getSparseReshapeNegativeOutputDimErrorMessage:gW,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:CW,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:PE,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:bW,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:wW,getUndoAxesPermutation:Sl,isIdentityPermutation:TT,log:Zdt,mergeRealAndImagArrays:Qs,prepareAndValidate:iT,prepareSplitSize:NT,segment_util:gyt,shouldFuse:tT,slice_util:hyt,splitRealAndImagArrays:iW,stridesOrDilationsArePositive:_c,tupleValuesAreOne:Ac,upcastType:Yo,validateDefaultValueShape:aW,validateInput:Xxt,validateUpdateShape:FU,warn:pa},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */iyt();/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IW={kernelName:g1,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>it(n,qg(jt(e,"float32"),-1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xyt={kernelName:jm,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>{const r=An(jt(e,"float32")),o=eo(me(Je(1),r));return Zn(fe(n,o))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yyt={kernelName:Xm,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>{const r=eo(me(An(jt(e,"float32")),1));return fe(n,r)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const byt={kernelName:hd,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,r]=t,o=Ee(e.shape,r.shape);return{a:()=>{let s=n;const u=br(e.shape,o);return u.length>0&&(s=ce(s,u)),ht(s,e.shape)},b:()=>{let s=n;const u=br(r.shape,o);return u.length>0&&(s=ce(s,u)),ht(s,r.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wyt={kernelName:UI,saveAllInputs:!0,gradFunc:(n,t)=>{const e={};return t.forEach((r,o)=>{e[o]=()=>n.clone()}),e}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cyt={kernelName:v1,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>We(e)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Syt={kernelName:x1,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>We(e)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Eyt={kernelName:Km,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>fe(n,eo(me(Je(1),An(jt(e,"float32")))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kyt={kernelName:Ym,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>{const r=eo(Bt(Je(1),An(jt(e,"float32"))));return fe(n,r)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Iyt={kernelName:Jm,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,r]=t,o=Ee(e.shape,r.shape);return{a:()=>{const s=Bt(An(e),An(r));let u=it(n,fe(r,s));const l=br(e.shape,o);return l.length>0&&(u=ce(u,l)),ht(u,e.shape)},b:()=>{const s=Bt(An(e),An(r));let u=Zn(it(n,fe(e,s)));const l=br(r.shape,o);return l.length>0&&(u=ce(u,l)),ht(u,r.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ryt={kernelName:Qm,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>fe(n,Bt(An(jt(e,"float32")),1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tyt={kernelName:Zm,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>fe(n,me(Je(1),An(jt(e,"float32"))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nyt(n,t,e,r,o,a){const i=J(n,"dy","avgPool3dGrad"),s=J(t,"input","avgPool3dGrad");let u=i,l=s,c=!1;s.rank===4&&(c=!0,u=ht(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]]),l=ht(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),H(u.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${u.rank}.`),H(l.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${l.rank}.`),Oo("avgPool3dGrad",o,a);const h={dy:u,input:l},d={filterSize:e,strides:r,pad:o,dimRoundingMode:a},p=ut.runKernel(HI,h,d);return c?ht(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}const Ayt=ft({avgPool3dGrad_:Nyt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _yt={kernelName:b1,inputsToSave:["x"],gradFunc:(n,t,e)=>{const[r]=t,{filterSize:o,strides:a,pad:i,dimRoundingMode:s}=e;return{x:()=>Ayt(n,r,o,a,i,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dyt(n,t,e,r,o){const a=J(n,"dy","avgPoolGrad"),i=J(t,"input","avgPoolGrad");H(i.rank===a.rank,()=>`Rank of input (${i.rank}) does not match rank of dy (${a.rank})`);let s=i,u=a,l=!1;i.rank===3&&(l=!0,s=ht(i,[1,i.shape[0],i.shape[1],i.shape[2]]),u=ht(a,[1,a.shape[0],a.shape[1],a.shape[2]])),H(u.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${u.rank}.`),H(s.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${s.rank}.`);const c={dy:u,input:s},h={filterSize:e,strides:r,pad:o},d=ut.runKernel(GI,c,h);return l?ht(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const $yt=ft({avgPoolGrad_:Dyt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Oyt={kernelName:y1,inputsToSave:["x"],gradFunc:(n,t,e)=>{const[r]=t,{filterSize:o,strides:a,pad:i}=e;return{x:()=>$yt(n,r,o,a,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fyt={kernelName:w1,inputsToSave:["a","b"],gradFunc:(n,t,e)=>{const[r,o]=t,{transposeA:a,transposeB:i}=e;return!a&&!i?{a:()=>Qe(n,o,!1,!0),b:()=>Qe(r,n,!0,!1)}:!a&&i?{a:()=>Qe(n,o,!1,!1),b:()=>Qe(n,r,!0,!1)}:a&&!i?{a:()=>Qe(o,n,!1,!0),b:()=>Qe(r,n,!1,!1)}:{a:()=>Qe(o,n,!0,!0),b:()=>Qe(n,r,!0,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Myt={kernelName:C1,gradFunc:(n,t,e)=>{const{blockShape:r,crops:o}=e;return{x:()=>GR(n,r,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lyt={kernelName:Xdt,gradFunc:(n,t,e)=>{const r=e,o=r.inputShape,a=r.shape,i=Array.from(a);for(let u=o.length-1;u>=0;u--)if(o[u]===a[u])i[u]=1;else if(o[u]!==1)throw new Error(`broadcastTo(): [${o}] cannot be broadcast to [${a}].`);const s=[];for(let u=0;u<i.length;u++)i[u]>1&&s.push(u);return{x:()=>ce(n,s,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pyt={kernelName:tg,gradFunc:n=>({x:()=>n.clone()})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Byt={kernelName:eg,gradFunc:n=>({x:()=>We(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zyt={kernelName:ng,inputsToSave:["x"],gradFunc:(n,t,e)=>{const[r]=t,{clipValueMin:o,clipValueMax:a}=e;return{x:()=>bo(Ks(eh(r,o),pd(r,a)),n,We(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uyt={kernelName:S1,inputsToSave:["x"],gradFunc:IW.gradFunc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wyt={kernelName:E1,saveAllInputs:!0,gradFunc:(n,t,e)=>{const r=t.map(u=>u.shape),{axis:o}=e,a=_e(o,t[0].shape)[0],i=r.map(u=>u[a]);return ba(n,i,a).map(u=>()=>u)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vyt={kernelName:k1,inputsToSave:["x","filter"],gradFunc:(n,t,e)=>{const[r,o]=t,{dilations:a,strides:i,pad:s,dataFormat:u}=e;return H(Ac(a),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${a}'`),{x:()=>$R(r.shape,n,o,i,s,u),filter:()=>YR(r,n,o.shape,i,s,u)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gyt={kernelName:I1,inputsToSave:["dy","filter"],gradFunc:(n,t,e)=>{const[r,o]=t,{strides:a,pad:i,dataFormat:s,dimRoundingMode:u}=e;return{dy:()=>Dc(n,o,a,i,s,1,u),filter:()=>YR(n,r,o.shape,a,i,s,u)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hyt(n,t,e,r,o){let a=n;n.rank===4&&(a=ht(n,[1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]]));let i=t;i.rank===4&&(i=ht(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]])),H(a.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${a.shape}.`),H(i.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${i.shape}.`),H(e.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${e}.`),H(a.shape[4]===e[3],()=>`Error in conv3dDerFilter: depth of input ${a.shape[4]}) must match input depth in filter (${e[3]}.`),H(i.shape[4]===e[4],()=>`Error in conv3dDerFilter: depth of dy (${i.shape[4]}) must match output depth for filter (${e[4]}).`);const s={x:a,dy:i},u={strides:r,pad:o,filterShape:e};return ut.runKernel(YI,s,u)}const qyt=ft({conv3DBackpropFilter_:Hyt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jyt={kernelName:R1,inputsToSave:["x","filter"],gradFunc:(n,t,e)=>{const{dilations:r,strides:o,pad:a}=e;H(Ac(r),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${r}'`);const[i,s]=t;return{x:()=>fU(i.shape,n,s,o,a),filter:()=>qyt(i,n,s.shape,o,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xyt={kernelName:rg,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>it(Zn(_U(jt(e,"float32"))),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kyt={kernelName:og,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>it(DU(jt(e,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yyt={kernelName:T1,inputsToSave:["x"],gradFunc:(n,t,e)=>{const[r]=t,{axis:o,exclusive:a,reverse:i}=e;return{x:()=>{const s=Pn([o],r.rank);let u=pU(n,o,a,!i);return s!=null&&(u=Ue(u,s)),u}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qyt={kernelName:N1,inputsToSave:["x","filter"],gradFunc:(n,t,e)=>{const{dilations:r,strides:o,pad:a,dimRoundingMode:i}=e,s=r??[1,1];H(Ac(s),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${s}'`);const[u,l]=t;return H(u.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${u.rank}.`),H(l.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${l.rank}.`),H(u.shape[3]===l.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${u.shape[3]}) must match the inChannels dimension in filter ${l.shape[2]}.`),H(ro(o,s),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${o} and dilations '${s}'.`),Oo("depthwiseConv2d",a,i),{x:()=>d0t(u.shape,n,l,o,a,s,i),filter:()=>h0t(u,n,l.shape,o,a,s,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zyt={kernelName:A1,inputsToSave:["x","filter"],gradFunc:(n,t,e)=>{const[r,o]=t,a={x:r,filter:o,dy:n},i={x:r,filter:o,dy:n};return{x:()=>ut.runKernel(CE,a,e),filter:()=>ut.runKernel(SE,i,e)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jyt={kernelName:ig,outputsToSave:[!0],gradFunc:(n,t)=>{const[e]=t,r={dy:n,y:e};return{x:()=>ut.runKernel(aR,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const t1t={kernelName:sg,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t,r=it(as(Zn(An(e))),2/Math.sqrt(Math.PI));return{x:()=>it(n,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const e1t={kernelName:ug,outputsToSave:[!0],gradFunc:(n,t)=>{const[e]=t;return{x:()=>it(n,e)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const n1t={kernelName:D1,inputsToSave:["input"],gradFunc:(n,t)=>{const[e]=t;return{input:()=>ht(n,e.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const r1t={kernelName:lg,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>it(n,as(e))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const o1t={kernelName:cg,gradFunc:n=>({x:()=>We(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const a1t={kernelName:hg,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,r]=t,o=Ee(e.shape,r.shape);return{a:()=>{const s=fe(n,jt(r,"float32")),u=br(e.shape,o);return u.length>0?ht(ce(s,u),e.shape):s},b:()=>{let s=it(n,jt(e,"float32"));const u=br(r.shape,o);u.length>0&&(s=ht(ce(s,u),r.shape));const l=An(r);return Zn(fe(s,jt(l,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const i1t={kernelName:$1,inputsToSave:["x","mean","variance","scale"],gradFunc:(n,t,e)=>{const{varianceEpsilon:r}=e,[o,a,i,s]=t,u=s??Je(1),l=br(a.shape,o.shape),c=[];if(a.rank===1){for(let S=0;S<o.shape.length-1;++S)c.push(o.shape[S]);c.push(1)}const h=me(o,a),d=it(n,u),p=TU(Bt(i,Je(r))),g=it(it(it(p,p),p),Je(-.5));return{x:()=>a.rank===1?ht(it(it(n,li(ht(p,[1,1,1,a.shape[0]]),c)),u),o.shape):ht(it(it(n,p),u),o.shape),mean:()=>{let S=it(it(p,Je(-1)),d);return a.rank===1&&(S=ce(S,l)),ht(S,a.shape)},variance:()=>{let S=it(it(g,h),d);return a.rank===1&&(S=ce(S,l)),ht(S,a.shape)},scale:()=>{const S=it(h,p);let k=it(n,S);return a.rank===1&&(k=ce(k,l)),ht(k,a.shape)},offset:()=>{let S=n;return a.rank===1&&(S=ce(S,l)),ht(S,a.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const s1t={kernelName:O1,inputsToSave:["x","indices"],gradFunc:(n,t,e)=>{const[r,o]=t,{axis:a,batchDims:i}=e,s=_e(a,r.shape)[0],u=(l,c,h)=>()=>{const d=l.shape,p=c.size,g=d.slice(0,s),x=g.length,y=d.slice(a,d.length).slice(1),b=y.length,C=B3(0,x),E=B3(x+1,x+1+b),S=z3([g,[p],y]),k=ht(h,S),R=ht(c,[p]),A=z3([[x],C,E]),N=Ue(k,A);let _=LU(N,R,l.shape[s]);const $=Sl(A);return _=Ue(_,$),_};if(i===1){const l=r.shape[0],c=r.split(l,0);return{x:()=>Ys(c.map((p,g)=>u(p,o.slice(g,1),n.slice(g,1))())).reshape(r.shape),indices:()=>o}}else return{x:u(r,o,n),indices:()=>o}}};function B3(n,t){const e=[];for(let r=n;r<t;++r)e.push(r);return e}function z3(n){const t=[];for(let e=0;e<n.length;++e)for(let r=0;r<n[e].length;++r)t.push(n[e][r]);return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u1t={kernelName:fg,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,r]=t;return{a:()=>We(e),b:()=>We(r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const l1t={kernelName:dg,gradFunc:n=>({x:()=>jt(n,"float32")})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const c1t={kernelName:pg,gradFunc:n=>({x:()=>We(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h1t={kernelName:mg,gradFunc:n=>({x:()=>We(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const f1t={kernelName:gg,gradFunc:n=>({x:()=>We(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const d1t={kernelName:M1,inputsToSave:["x"],gradFunc:(n,t,e)=>{const[r]=t,{alpha:o}=e,a=Ca(r,0);return{x:()=>bo(a,n,it(n,o))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const p1t={kernelName:xg,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>fe(n,Bt(e,1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m1t={kernelName:vg,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>fe(n,jt(e,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const g1t={kernelName:Ydt,inputsToSave:[],outputsToSave:[!0],gradFunc:(n,t,e)=>{const[r]=t,{axis:o}=e;return{logits:()=>{const i=as(r);return me(n,it(ce(n,o,!0),i))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v1t(n,t,e,r=5,o=1,a=1,i=.5){const s={x:n,y:t,dy:e},u={depthRadius:r,bias:o,alpha:a,beta:i};return ut.runKernel(hR,s,u)}const x1t=ft({localResponseNormalizationBackprop_:v1t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const y1t={kernelName:W1,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,t,e)=>{const[r,o]=t,{depthRadius:a,bias:i,alpha:s,beta:u}=e;return{x:()=>x1t(r,o,n,a,i,s,u)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RW(n,t,e,r){return t.rank<e.rank&&(t=ht(t,lr(t.shape,r))),n.rank<e.rank&&(n=ht(n,lr(n.shape,r))),{x:()=>it(n,jt(os(e,t),n.dtype))}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U3={kernelName:V1,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,t,e)=>{const r=e,{reductionIndices:o}=r,a=t[0],i=t[1],s=_e(o,a.shape),u=RW(n,i,a,s);return{x:()=>u.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const b1t={kernelName:yg,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,r]=t;return{a:()=>it(n,jt(eh(e,r),"float32")),b:()=>it(n,jt(Sy(e,r),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w1t(n,t,e,r,o,a,i){const s=J(n,"dy","maxPool3dGrad"),u=J(t,"input","maxPool3dGrad"),l=J(e,"output","maxPool3dGrad");let c=s,h=u,d=l,p=!1;u.rank===4&&(p=!0,c=ht(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]]),h=ht(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]]),d=ht(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]])),H(c.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${c.rank}.`),H(h.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${h.rank}.`),H(d.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${d.rank}.`),Oo("maxPool3dGrad",a,i);const g={dy:c,input:h,output:d},x={filterSize:r,strides:o,pad:a,dimRoundingMode:i},y=ut.runKernel(dR,g,x);return p?ht(y,[y.shape[1],y.shape[2],y.shape[3],y.shape[4]]):y}const C1t=ft({maxPool3dGrad_:w1t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const S1t={kernelName:H1,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,t,e)=>{const[r,o]=t,{filterSize:a,strides:i,pad:s,dimRoundingMode:u}=e;return{x:()=>C1t(n,r,o,a,i,s,u)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E1t(n,t,e,r,o,a,i){const s=J(n,"dy","maxPoolGrad"),u=J(t,"input","maxPoolGrad"),l=J(e,"output","maxPoolGrad");H(u.rank===s.rank,()=>`Rank of input (${u.rank}) does not match rank of dy (${s.rank})`),H(s.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${s.rank}.`),H(u.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${u.rank}.`),Oo("maxPoolGrad",a,i);const c={dy:s,input:u,output:l},h={filterSize:r,strides:o,pad:a,dimRoundingMode:i};return ut.runKernel(fR,c,h)}const k1t=ft({maxPoolGrad_:E1t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const I1t={kernelName:G1,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,t,e)=>{const[r,o]=t,{filterSize:a,strides:i,pad:s}=e;return{x:()=>k1t(n,r,o,a,i,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const R1t={kernelName:q1,inputsToSave:["x"],gradFunc:(n,t,e)=>{const[r]=t,{axis:o}=e,a=_e(o,r.shape),s=Dr(r.shape,a)[1],u=It(s);return{x:()=>{const c=r.shape.slice();a.forEach(p=>{c[p]=1});const h=ht(n,c);return fe(it(h,kl(r.shape,"float32")),u)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T1t={kernelName:j1,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,t,e)=>{const r=e,{axis:o}=r,[a,i]=t,s=_e(o,a.shape),u=RW(n,i,a,s);return{x:()=>u.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const N1t={kernelName:bg,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,r]=t;return{a:()=>it(n,jt(pd(e,r),"float32")),b:()=>it(n,jt(Ca(e,r),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A1t={kernelName:X1,inputsToSave:["x"],gradFunc:(n,t,e)=>{const r=t[0],{paddings:o}=e,a=o.map(i=>i[0]);return{x:()=>kn(n,a,r.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _1t={kernelName:wg,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,r]=t,o=Ee(e.shape,r.shape);return{a:()=>{const s=br(e.shape,o);return s.length>0?ht(ce(n,s),e.shape):n},b:()=>{const s=it(n,Zn(Eb(fe(e,r)))),u=br(r.shape,o);return u.length>0?ht(ce(s,u),r.shape):s}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const D1t={kernelName:Cg,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,r]=t,o=Ee(e.shape,r.shape);return{a:()=>{const s=it(n,jt(r,"float32")),u=br(e.shape,o);return u.length>0?ht(ce(s,u),e.shape):s},b:()=>{const s=it(n,jt(e,"float32")),u=br(r.shape,o);return u.length>0?ht(ce(s,u),r.shape):s}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $1t={kernelName:K1,gradFunc:n=>({x:()=>Zn(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const O1t={kernelName:Z1,inputsToSave:["indices"],gradFunc:(n,t)=>{const e=t[0];return{indices:()=>Rr(e.shape,"float32")}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F1t={kernelName:Q1,gradFunc:n=>({x:()=>We(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const M1t={kernelName:J1,saveAllInputs:!0,gradFunc:(n,t,e)=>{const{axis:r}=e;return Fc(n,r).map(a=>()=>a)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const W3={kernelName:tb,inputsToSave:["x"],gradFunc:(n,t,e)=>{const r=t[0],{paddings:o}=e,a=o.map(i=>i[0]);return{x:()=>kn(n,a,r.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const L1t={kernelName:Sg,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(n,t)=>{const[e,r,o]=t,a=e,i=r,s=Ee(a.shape,i.shape);return{a:()=>{const c=jt(i,"float32");let h=it(n,it(c,$c(a,me(c,Je(1)))));const d=br(a.shape,s);return d.length>0&&(h=ce(h,d)),ht(h,a.shape)},b:()=>{const c=Ca(a,0),h=bo(c,is(a),We(a));let d=it(n,it(o,h));const p=br(i.shape,s);return p.length>0&&(d=ce(d,p)),ht(d,i.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const P1t={kernelName:eb,inputsToSave:["x","alpha"],gradFunc:(n,t)=>{const[e,r]=t,o=Ca(e,0);return{x:()=>bo(o,n,it(n,r)),alpha:()=>{let a=bo(o,We(n),it(n,e));const i=br(r.shape,n.shape);return i.length>0&&(a=ce(a,i)),ht(a,r.shape)}}}};/**
 * @license
 * Copyright 2022 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B1t(n,t,e){const r=n.shape.slice();r[e]=1;const o=ht(t,r),a=FE(n,e,!0,!1),i=FE(n,e,!0,!0),s=it(a,i);return it(o,s)}function z1t(n,t,e){const r=n.shape.length,o=r-e.length,a=Pn(e,r);let i=n;a!=null&&(i=Ue(n,a));const s=i.shape.slice(),l=s.splice(r-e.length,e.length).reduce((d,p)=>d*p,1);s.push(l);const c=i.reshape(s);let h=B1t(c,t,o);if(h=h.reshape(i.shape),a!=null){const d=Sl(a);h=Ue(h,d)}return h}const U1t={kernelName:nb,inputsToSave:["x"],gradFunc:(n,t,e)=>{const[r]=t,{axis:o}=e;let a=[];return o==null?a=r.shape.map((i,s)=>s):typeof o=="number"?a=[o]:a=o,{x:()=>z1t(r,n,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const W1t={kernelName:ag,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,r]=t,o=Ee(e.shape,r.shape);return{a:()=>{const s=fe(n,jt(r,"float32")),u=br(e.shape,o);return u.length>0?ht(ce(s,u),e.shape):s},b:()=>{let s=it(n,jt(e,"float32"));const u=br(r.shape,o);u.length>0&&(s=ht(ce(s,u),r.shape));const l=An(r);return Zn(fe(s,jt(l,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const V1t={kernelName:Eg,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>fe(n,Zn(An(e)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G1t={kernelName:Ig,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t,r=it(pd(e,6),qg(e));return{x:()=>it(n,jt(r,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H1t={kernelName:kg,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>it(n,jt(qg(e),"float32"))}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const q1t={kernelName:rb,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>ht(n,e.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const j1t={kernelName:ab,inputsToSave:["images"],gradFunc:(n,t,e)=>{const[r]=t,o={dy:n,images:r};return{images:()=>ut.runKernel(bR,o,e)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const X1t={kernelName:ob,inputsToSave:["images"],gradFunc:(n,t,e)=>{const[r]=t,o={dy:n,images:r};return{images:()=>ut.runKernel(yR,o,e)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K1t={kernelName:ib,gradFunc:(n,t,e)=>{const{dims:r}=e,o=_e(r,n.shape);return{x:()=>Oc(n,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y1t={kernelName:Rg,gradFunc:n=>({x:()=>We(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q1t={kernelName:Tg,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>Zn(fe(n,it($c(e,1.5),2)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z1t={kernelName:sb,inputsToSave:["condition"],gradFunc:(n,t)=>{const[e]=t;return{condition:()=>jt(We(e),"float32"),t:()=>it(n,jt(e,n.dtype)),e:()=>it(n,jt(zR(e),n.dtype))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J1t={kernelName:Ng,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>{const r=Ca(e,Je(0)),o=Je(Rb),a=Je(Tb),i=it(n,a),s=it(it(n,o),as(jt(e,"float32")));return bo(r,i,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tbt={kernelName:$g,outputsToSave:[!0],gradFunc:(n,t)=>{const[e]=t;return{x:()=>it(n,it(e,me(Je(1),e)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ebt={kernelName:Dg,gradFunc:n=>({x:()=>We(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nbt={kernelName:Ag,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>it(OR(jt(e,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rbt={kernelName:_g,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>it(dU(jt(e,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const obt={kernelName:ub,inputsToSave:["x"],gradFunc:(n,t,e)=>{const[r]=t,{begin:o,size:a}=e,i=r.shape,[s,u]=kb(r,o,a),l=[];for(let c=0;c<n.rank;c++)l.push([s[c],i[c]-s[c]-u[c]]);return{x:()=>VR(n,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const abt={kernelName:fb,outputsToSave:[!0],gradFunc:(n,t,e)=>{const[r]=t,{dim:o}=e,a=!0,i=it(n,r);return{logits:()=>me(i,it(ce(i,[o],a),r))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ibt={kernelName:Og,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>it(n,dd(e))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const V3={kernelName:cb,gradFunc:(n,t,e)=>{const{blockShape:r,paddings:o}=e;return{x:()=>DR(n,r,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G3={kernelName:hb,gradFunc:(n,t,e)=>{const{axis:r}=e;return{x:()=>No(n,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sbt={kernelName:Fg,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>fe(n,it(eo(jt(e,"float32")),2))}}};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ubt={kernelName:wR,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>it(n,it(jt(e,"float32"),2))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lbt={kernelName:Mg,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,r]=t,o=Je(2);return{a:()=>it(n,it(o,me(e,r))),b:()=>it(n,it(o,me(r,e)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cbt={kernelName:Ug,gradFunc:n=>({x:()=>We(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hbt={kernelName:Lg,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,r]=t,o=Ee(e.shape,r.shape);return{a:()=>{let s=n;const u=br(e.shape,o);return u.length>0&&(s=ce(s,u)),ht(s,e.shape)},b:()=>{let s=n;const u=br(r.shape,o);return u.length>0&&(s=ce(s,u)),ht(Zn(s),r.shape)}}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fbt={kernelName:lb,inputsToSave:["x"],gradFunc:(n,t,e)=>{const[r]=t,o=r.shape.slice(),{axis:a}=e;_e(a,r.shape).forEach(l=>{o[l]=1});const s=ht(n,o),u=it(s,kl(r.shape,"float32"));return{x:()=>u}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dbt={kernelName:Pg,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>fe(n,An(OR(e)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pbt={kernelName:Bg,outputsToSave:[!0],gradFunc:(n,t)=>{const[e]=t;return{x:()=>it(me(Je(1),An(e)),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mbt={kernelName:zg,inputsToSave:["x"],gradFunc:(n,t,e)=>{const[r]=t,{reps:o}=e;return{x:()=>{let i=We(r);if(r.rank===1)for(let s=0;s<o[0];++s)i=Bt(i,kn(n,[s*r.shape[0]],[r.shape[0]]));else if(r.rank===2)for(let s=0;s<o[0];++s)for(let u=0;u<o[1];++u)i=Bt(i,kn(n,[s*r.shape[0],u*r.shape[1]],[r.shape[0],r.shape[1]]));else if(r.rank===3)for(let s=0;s<o[0];++s)for(let u=0;u<o[1];++u)for(let l=0;l<o[2];++l)i=Bt(i,kn(n,[s*r.shape[0],u*r.shape[1],l*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else if(r.rank===4)for(let s=0;s<o[0];++s)for(let u=0;u<o[1];++u)for(let l=0;l<o[2];++l)for(let c=0;c<o[3];++c)i=Bt(i,kn(n,[s*r.shape[0],u*r.shape[1],l*r.shape[2],c*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${r.rank} tensors yet.`);return i}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gbt={kernelName:If,gradFunc:(n,t,e)=>{const r=e,{perm:o}=r,a=Sl(o);return{x:()=>Ue(n,a)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vbt={kernelName:db,gradFunc:(n,t,e)=>{const r=e,{axis:o}=r;return{value:()=>Ys(n,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xbt={kernelName:pb,inputsToSave:["segmentIds"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>ybt(n,e)}}};function ybt(n,t){const e=El(t,We(t)),r=LR(n,e);let o=eh(t,Je(0,"int32"));const a=r.rank-o.rank;for(let s=0;s<a;++s)o=Ro(o,s+1);o=Ks(o,kl(r.shape,"bool"));const i=We(r);return bo(o,r,i)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bbt={kernelName:mb,gradFunc:n=>({x:()=>We(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wbt=[IW,xyt,yyt,byt,wyt,Cyt,Syt,Eyt,kyt,Iyt,Ryt,Tyt,_yt,Oyt,Fyt,Myt,Lyt,Pyt,Byt,zyt,Uyt,Wyt,Gyt,Vyt,jyt,Xyt,Kyt,Yyt,Qyt,Zyt,W1t,Jyt,t1t,e1t,n1t,r1t,a1t,o1t,i1t,s1t,u1t,l1t,c1t,h1t,f1t,d1t,p1t,m1t,g1t,y1t,U3,U3,b1t,S1t,I1t,R1t,T1t,N1t,A1t,_1t,D1t,$1t,O1t,F1t,M1t,W3,W3,L1t,P1t,U1t,V1t,G1t,H1t,q1t,j1t,X1t,K1t,Y1t,Q1t,Z1t,J1t,tbt,ebt,nbt,rbt,obt,abt,ibt,V3,V3,G3,G3,sbt,lbt,ubt,cbt,hbt,fbt,dbt,pbt,mbt,gbt,vbt,xbt,bbt];for(const n of wbt)Jdt(n);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.abs=function(){return this.throwIfDisposed(),fo(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.acos=function(){return this.throwIfDisposed(),nmt(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.acosh=function(){return this.throwIfDisposed(),omt(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.add=function(n){return this.throwIfDisposed(),Bt(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.all=function(n,t){return this.throwIfDisposed(),lU(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.any=function(n,t){return this.throwIfDisposed(),$E(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.argMax=function(n){return this.throwIfDisposed(),sm(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.argMin=function(n){return this.throwIfDisposed(),lmt(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.asScalar=function(){return this.throwIfDisposed(),H(this.size===1,()=>"The array must have only 1 element."),ht(this,[])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.asType=function(n){return this.throwIfDisposed(),jt(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.as1D=function(){return this.throwIfDisposed(),ht(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.as2D=function(n,t){return this.throwIfDisposed(),ht(this,[n,t])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.as3D=function(n,t,e){return this.throwIfDisposed(),ht(this,[n,t,e])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.as4D=function(n,t,e,r){return this.throwIfDisposed(),ht(this,[n,t,e,r])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.as5D=function(n,t,e,r,o){return this.throwIfDisposed(),ht(this,[n,t,e,r,o])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.asin=function(){return this.throwIfDisposed(),hmt(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.asinh=function(){return this.throwIfDisposed(),dmt(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.atan=function(){return this.throwIfDisposed(),mmt(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.atan2=function(n){return this.throwIfDisposed(),vmt(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.atanh=function(){return this.throwIfDisposed(),ymt(this)};Et().prototype.avgPool=function(n,t,e,r){return this.throwIfDisposed(),_R(this,n,t,e,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.batchToSpaceND=function(n,t){return this.throwIfDisposed(),DR(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.batchNorm=function(n,t,e,r,o){return this.throwIfDisposed(),bb(this,n,t,e,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.broadcastTo=function(n){return this.throwIfDisposed(),Qp(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.cast=function(n){return this.throwIfDisposed(),jt(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.ceil=function(){return this.throwIfDisposed(),qmt(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.clipByValue=function(n,t){return this.throwIfDisposed(),wa(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.concat=function(n,t){return this.throwIfDisposed(),n instanceof pr&&(n=[n]),No([this,...n],t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.conv1d=function(n,t,e,r,o,a){return this.throwIfDisposed(),cU(this,n,t,e,r,o,a)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.conv2dTranspose=function(n,t,e,r,o){return this.throwIfDisposed(),hU(this,n,t,e,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.conv2d=function(n,t,e,r,o,a){return this.throwIfDisposed(),Dc(this,n,t,e,r,o,a)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.cos=function(){return this.throwIfDisposed(),OR(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.cosh=function(){return this.throwIfDisposed(),dU(this)};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.cumprod=function(n,t,e){return this.throwIfDisposed(),FE(this,n,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.cumsum=function(n,t,e){return this.throwIfDisposed(),pU(this,n,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.depthToSpace=function(n,t){return this.throwIfDisposed(),vgt(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.depthwiseConv2d=function(n,t,e,r,o,a){return this.throwIfDisposed(),FR(this,n,t,e,r,o,a)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.dilation2d=function(n,t,e,r,o){return this.throwIfDisposed(),bgt(this,n,t,e,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.divNoNan=function(n){return this.throwIfDisposed(),kgt(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.div=function(n){return this.throwIfDisposed(),fe(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.dot=function(n){return this.throwIfDisposed(),Rgt(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.elu=function(){return this.throwIfDisposed(),Cb(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.equal=function(n){return this.throwIfDisposed(),os(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.erf=function(){return this.throwIfDisposed(),mU(this)};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.euclideanNorm=function(n,t){return this.throwIfDisposed(),Bgt(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.exp=function(){return this.throwIfDisposed(),as(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.expandDims=function(n){return this.throwIfDisposed(),Ro(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.expm1=function(){return this.throwIfDisposed(),Vgt(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.fft=function(){return this.throwIfDisposed(),OU(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.flatten=function(){return this.throwIfDisposed(),ht(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.floor=function(){return this.throwIfDisposed(),Eb(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.floorDiv=function(n){return this.throwIfDisposed(),uU(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.gather=function(n,t,e){return this.throwIfDisposed(),LR(this,n,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.greaterEqual=function(n){return this.throwIfDisposed(),eh(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.greater=function(n){return this.throwIfDisposed(),Ca(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.ifft=function(){return this.throwIfDisposed(),ME(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.irfft=function(){return this.throwIfDisposed(),Fxt(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.isFinite=function(){return this.throwIfDisposed(),Zgt(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.isInf=function(){return this.throwIfDisposed(),tvt(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.isNaN=function(){return this.throwIfDisposed(),nvt(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.leakyRelu=function(n){return this.throwIfDisposed(),BR(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.lessEqual=function(n){return this.throwIfDisposed(),pd(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.less=function(n){return this.throwIfDisposed(),Sy(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.localResponseNormalization=function(n,t,e,r){return this.throwIfDisposed(),svt(this,n,t,e,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.logSigmoid=function(){return this.throwIfDisposed(),pvt(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.logSoftmax=function(n){return this.throwIfDisposed(),bU(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.logSumExp=function(n,t){return this.throwIfDisposed(),wU(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.log=function(){return this.throwIfDisposed(),is(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.log1p=function(){return this.throwIfDisposed(),yU(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.logicalAnd=function(n){return this.throwIfDisposed(),Ks(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.logicalNot=function(){return this.throwIfDisposed(),zR(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.logicalOr=function(n){return this.throwIfDisposed(),CU(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.logicalXor=function(n){return this.throwIfDisposed(),Cvt(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.matMul=function(n,t,e){return this.throwIfDisposed(),Qe(this,n,t,e)};Et().prototype.maxPool=function(n,t,e,r){return this.throwIfDisposed(),UR(this,n,t,e,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.max=function(n,t){return this.throwIfDisposed(),mi(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.maximum=function(n){return this.throwIfDisposed(),El(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.mean=function(n,t){return this.throwIfDisposed(),sr(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.min=function(n,t){return this.throwIfDisposed(),Cy(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.minimum=function(n){return this.throwIfDisposed(),cm(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.mirrorPad=function(n,t){return this.throwIfDisposed(),Avt(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.mod=function(n){return this.throwIfDisposed(),Dvt(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.mul=function(n){return this.throwIfDisposed(),it(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.neg=function(){return this.throwIfDisposed(),Zn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.norm=function(n,t,e){return this.throwIfDisposed(),Sb(this,n,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.notEqual=function(n){return this.throwIfDisposed(),Ey(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.oneHot=function(n,t=1,e=0){return this.throwIfDisposed(),SU(this,n,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.onesLike=function(){return this.throwIfDisposed(),Ka(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.pad=function(n,t){return this.throwIfDisposed(),VR(this,n,t)};Et().prototype.pool=function(n,t,e,r,o,a){return this.throwIfDisposed(),Wvt(this,n,t,e,r,o,a)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.pow=function(n){return this.throwIfDisposed(),$c(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.prelu=function(n){return this.throwIfDisposed(),HR(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.prod=function(n,t){return this.throwIfDisposed(),Hvt(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.reciprocal=function(){return this.throwIfDisposed(),mxt(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.relu=function(){return this.throwIfDisposed(),nh(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.relu6=function(){return this.throwIfDisposed(),IU(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.reshapeAs=function(n){return this.throwIfDisposed(),ht(this,n.shape)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.reshape=function(n){return this.throwIfDisposed(),ht(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.resizeBilinear=function(n,t,e){return this.throwIfDisposed(),BU(this,n,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.resizeNearestNeighbor=function(n,t,e){return this.throwIfDisposed(),zU(this,n,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.reverse=function(n){return this.throwIfDisposed(),Oc(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.rfft=function(){return this.throwIfDisposed(),Pxt(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.round=function(){return this.throwIfDisposed(),RU(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.rsqrt=function(){return this.throwIfDisposed(),TU(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.selu=function(){return this.throwIfDisposed(),NU(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.separableConv2d=function(n,t,e,r,o,a){return this.throwIfDisposed(),AU(this,n,t,e,r,o,a)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.sigmoid=function(){return this.throwIfDisposed(),dd(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.sign=function(){return this.throwIfDisposed(),Ext(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.sin=function(){return this.throwIfDisposed(),_U(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.sinh=function(){return this.throwIfDisposed(),DU(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.slice=function(n,t){return this.throwIfDisposed(),kn(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.softmax=function(n){return this.throwIfDisposed(),KR(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.softplus=function(){return this.throwIfDisposed(),Vg(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.spaceToBatchND=function(n,t){return this.throwIfDisposed(),GR(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.split=function(n,t){return this.throwIfDisposed(),ba(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.sqrt=function(){return this.throwIfDisposed(),eo(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.square=function(){return this.throwIfDisposed(),An(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.squaredDifference=function(n){return this.throwIfDisposed(),zxt(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.squeeze=function(n){return this.throwIfDisposed(),Hg(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.stack=function(n,t){this.throwIfDisposed();const e=n instanceof pr?[this,n]:[this,...n];return Ys(e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.step=function(n){return this.throwIfDisposed(),qg(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.stridedSlice=function(n,t,e,r,o,a,i,s){return this.throwIfDisposed(),Hxt(this,n,t,e,r,o,a,i,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.sub=function(n){return this.throwIfDisposed(),me(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.sum=function(n,t){return this.throwIfDisposed(),ce(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.tan=function(){return this.throwIfDisposed(),jxt(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.tanh=function(){return this.throwIfDisposed(),yb(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.tile=function(n){return this.throwIfDisposed(),li(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.toBool=function(){return this.throwIfDisposed(),jt(this,"bool")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.toFloat=function(){return this.throwIfDisposed(),jt(this,"float32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.toInt=function(){return this.throwIfDisposed(),jt(this,"int32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.topk=function(n,t){return this.throwIfDisposed(),Yxt(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.transpose=function(n){return this.throwIfDisposed(),Ue(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.unique=function(n){return this.throwIfDisposed(),Jxt(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.unsortedSegmentSum=function(n,t){return this.throwIfDisposed(),LU(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.unstack=function(n){return this.throwIfDisposed(),Fc(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.where=function(n,t){return this.throwIfDisposed(),bo(n,this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Et().prototype.zerosLike=function(){return this.throwIfDisposed(),We(this)};/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Bi extends Error{constructor(t){super(t),Object.setPrototypeOf(this,Bi.prototype)}}class Ua extends Error{constructor(t){super(t),Object.setPrototypeOf(this,Ua.prototype)}}class ot extends Error{constructor(t){super(t),Object.setPrototypeOf(this,ot.prototype)}}class Ie extends Error{constructor(t){super(t),Object.setPrototypeOf(this,Ie.prototype)}}class _T extends Error{constructor(t){super(t),Object.setPrototypeOf(this,_T.prototype)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class TW{constructor(t){this.maxEntries=t||100,this.cache=new Map}get(t){let e;return this.cache.has(t)&&(e=this.cache.get(t),this.cache.delete(t),this.cache.set(t,e)),e}put(t,e){if(this.cache.has(t))this.cache.delete(t);else if(this.cache.size>=this.maxEntries){const r=this.cache.keys().next().value;this.cache.delete(r)}this.cache.set(t,e)}getMaxEntries(){return this.maxEntries}setMaxEntries(t){if(t<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${t}.`);if(this.maxEntries>t)for(let e=0;e<this.maxEntries-t;e++){const r=this.cache.keys().next().value;this.cache.delete(r)}this.maxEntries=t}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Mc(n,t){if(Array.isArray(n)){let e=[];for(let r=0;r<t;r++)e=e.concat(n);return e}else{const e=new Array(t);return e.fill(n),e}}function zi(n,t){if(!n)throw new _T(t)}function H3(n,t){let e=0;for(const r of n)r===t&&e++;return e}function To(n){return n.length===1?n[0]:n}function ln(n){return Array.isArray(n)?n:[n]}function Ps(n){const e=n.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return e[0]!=="_"?e:"private"+e}function ac(n){return n.length<=1||n.indexOf("_")===-1?n:n.replace(/[_]+(\w|$)/g,(t,e)=>e.toUpperCase())}let $a={};function DT(n){if(n==null)return null;const t={};return t.className=n.getClassName(),t.config=n.getConfig(),t}function BE(n){if(!(n==null||typeof n!="object"))if(Array.isArray(n))n.forEach(t=>BE(t));else{const t=Object.keys(n);for(const e of t){const r=n[e];r!=null&&typeof r=="object"&&(!Array.isArray(r)&&r.type==="ndarray"&&typeof r.value=="number"?n[e]=r.value:BE(r))}}}function Yg(n,t={},e={},r="object",o=!1){if(typeof n=="string"){const a=n;let i;if(a in e)i=e[a];else if(a in $a)i=$a[a];else if(i=t[a],i==null)throw new ot(`Unknown ${r}: ${n}. This may be due to one of the following reasons:
1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return i}else{const a=n;if(a.className==null||a.config==null)throw new ot(`${r}: Improper config format: ${JSON.stringify(a)}.
'className' and 'config' must set.`);const i=a.className;let s,u;if(i in e?[s,u]=e[i]:i in $a?[s,u]=$a.className:i in t&&([s,u]=t[i]),s==null)throw new ot(`Unknown ${r}: ${i}. This may be due to one of the following reasons:
1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(u!=null){const l={};for(const p of Object.keys($a))l[p]=$a[p];for(const p of Object.keys(e))l[p]=e[p];const c=a.config;c.customObjects=l;const h=Object.assign({},$a);for(const p of Object.keys(e))$a[p]=e[p];BE(a.config);const d=u(s,a.config,e,o);return $a=Object.assign({},h),d}else{const l=Object.assign({},$a);for(const h of Object.keys(e))$a[h]=e[h];const c=new s(a.config);return $a=Object.assign({},l),c}}}function Cbt(n,t){return n<t?-1:n>t?1:0}function jx(n,t){return-1*Cbt(n,t)}function tl(n){if(n==null)return n;const t=[];for(const e of n)t.indexOf(e)===-1&&t.push(e);return t}function Sbt(n){if(n==null)throw new ot(`Invalid value in obj: ${JSON.stringify(n)}`);for(const t in n)if(n.hasOwnProperty(t))return!1;return!0}function oh(n,t,e){if(e!=null&&n.indexOf(e)<0)throw new ot(`${e} is not a valid ${t}.  Valid values are ${n} or null/undefined.`)}function $T(n,t,e=0,r=1/0){return zi(e>=0),zi(r>=e),Array.isArray(n)&&n.length>=e&&n.length<=r&&n.every(o=>typeof o===t)}function Tr(n,t){Array.isArray(n)?(H(n.length>0,()=>`${t} is unexpectedly an empty array.`),n.forEach((e,r)=>Tr(e,`element ${r+1} of ${t}`))):H(Number.isInteger(n)&&n>0,()=>`Expected ${t} to be a positive integer, but got ${NW(n)}.`)}function NW(n){return n===null?"null":Array.isArray(n)?"["+n.map(t=>NW(t)).join(",")+"]":typeof n=="string"?`"${n}"`:`${n}`}function Ebt(n,t,e){let r=e!=null?e():Io(),o;return(...i)=>{const s=e!=null?e():Io();return s-r<t||(r=s,o=n(...i)),o}}function AW(n){return n==="relu"?"relu":n==="linear"?"linear":n==="elu"?"elu":null}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let kbt=0;function _W(){return kbt++}const Xx={};function Nb(n=""){return n in Xx||(Xx[n]=0),Xx[n]+=1,n+Xx[n].toString()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Ibt=["channelsFirst","channelsLast"],Rbt=["nearest","bilinear"],Tbt=["valid","same","causal"],Nbt=["max","avg"],Abt=["sum","mul","concat","ave"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const tf=new Map;function nr(n){oh(Ibt,"DataFormat",n)}function _bt(n){oh(Rbt,"InterpolationFormat",n)}function Sa(n){oh(Tbt,"PaddingMode",n)}function DW(n){oh(Nbt,"PoolMode",n)}const Zp=[],q3="/";function yc(n,t){Zp.push(n);try{const e=t();return Zp.pop(),e}catch(e){throw Zp.pop(),e}}function Dbt(){return Zp.length===0?"":Zp.join(q3)+q3}function $W(n){if(!FW(n))throw new Error("Not a valid tensor name: '"+n+"'");return Dbt()+n}function OW(n){if(!FW(n))throw new Error("Not a valid tensor name: '"+n+"'");tf.has(n)||tf.set(n,0);const t=tf.get(n);if(tf.set(n,tf.get(n)+1),t>0){const e=`${n}_${t}`;return tf.set(e,1),e}else return n}const $bt=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function FW(n){return!!n.match($bt)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Obt(n){return n===parseInt(n.toString(),10)}function el(n,t,e){t==null&&(t=0),e==null&&(e=n.length);let r=1;for(let o=t;o<e;++o)r*=n[o];return r}function qf(n){if(n.length===0)return Number.NaN;let t=Number.POSITIVE_INFINITY;for(let e=0;e<n.length;e++){const r=n[e];r<t&&(t=r)}return t}function ul(n){if(n.length===0)return Number.NaN;let t=Number.NEGATIVE_INFINITY;for(let e=0;e<n.length;e++){const r=n[e];r>t&&(t=r)}return t}function xi(n,t){if(t<n)throw new ot(`end (${t}) < begin (${n}) is forbidden.`);const e=[];for(let r=n;r<t;++r)e.push(r);return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let fS;function gr(){return fS==null&&(fS=Ipt().epsilon()),fS}function yi(){return"channelsLast"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Zi(n,t){return jt(n,t)}function Qg(n,t=-1){const e=n.shape.slice();return t<0&&(t=e.length+t+1),e.splice(t,0,1),ht(n,e)}function Fbt(n,t){return gt(()=>{if(n.shape.length!==2)throw new ot(`repeat() expects a rank-2 tensor, but received a rank-${n.shape.length} tensor.`);const e=Qg(n,1);return zE(e,[1,t,1])})}function Mbt(n){const t=[el(n.shape)];return ht(n,t)}function Lbt(n){if(n.rank<=1)throw new ot(`batchFlatten requires a minimum rank of 2. Got rank: ${n.rank}.`);const t=[n.shape[0],el(n.shape,1)];return ht(n,t)}function bc(n,t,e){return gt(()=>{switch(n.rank){case 1:return jR(n,t,e);case 2:return $U(n,[t,0],[e,n.shape[1]]);case 3:return XR(n,[t,0,0],[e,n.shape[1],n.shape[2]]);case 4:return Iy(n,[t,0,0,0],[e,n.shape[1],n.shape[2],n.shape[3]]);case 5:return kn(n,[t,0,0,0,0],[e,n.shape[1],n.shape[2],n.shape[3],n.shape[4]]);case 6:return kn(n,[t,0,0,0,0,0],[e,n.shape[1],n.shape[2],n.shape[3],n.shape[4],n.shape[5]]);default:throw new ot(`sliceAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}})}function dS(n,t,e){return gt(()=>{switch(n.rank){case 1:return jR(n,t,e);case 2:return $U(n,[0,t],[n.shape[0],e]);case 3:return XR(n,[0,0,t],[n.shape[0],n.shape[1],e]);case 4:return Iy(n,[0,0,0,t],[n.shape[0],n.shape[1],n.shape[2],e]);default:throw new ot(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function Kx(n,t,e,r){return gt(()=>{switch(n.rank){case 1:return jR(n,t,e);case 2:switch(r){case 1:return bc(n,t,e);case 2:return dS(n,t,e);default:throw new ot(`The axis is not within the rank of the tensor ${r}`)}case 3:switch(r){case 1:return bc(n,t,e);case 2:return XR(n,[0,t,0],[n.shape[0],e,n.shape[2]]);case 3:return dS(n,t,e);default:throw new ot(`The axis is not within the rank of the tensor ${r}`)}case 4:switch(r){case 1:return bc(n,t,e);case 2:return Iy(n,[0,t,0,0],[n.shape[0],e,n.shape[2],n.shape[3]]);case 3:return Iy(n,[0,0,t,0],[n.shape[0],n.shape[1],e,n.shape[3]]);case 4:return dS(n,t,e);default:throw new ot(`The axis is not within the rank of the tensor ${r}`)}default:throw new ot(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function OT(n,t=-1){let e;return t<0&&(e=n[0].rank,e!==0?t=e:t=0),t===n[0].rank&&(t=-1),No(n,t)}function j3(n,t){switch(n.rank){case 1:return Kmt([n,t]);case 2:return Qmt([n,t],0);case 3:return Jmt([n,t],0);case 4:return egt([n,t],0);default:throw new ot(`concatAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}}function zE(n,t){if(Array.isArray(t)||(t=[t]),n.rank!==t.length)throw new ot(`The length of input n (${t.length}) does not match the number of dimensions in input x (${n.rank})`);return li(n,t)}function Ab(n,t=0,e=1,r,o){return hxt(n,t,e,r,o)}function Ji(n,t,e,r){if(n.rank<2||t.rank<2)throw new Ie(`dot requires both inputs to be rank >= 2 but got x shape = ${n.shape} and y shape = ${t.shape}`);if(t.rank>=3){const o=n.shape.slice(-1)[0],a=t.shape.slice(-2)[0];if(o!==a)throw new Ie(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${n.shape} and  y shape = ${t.shape}`)}if(n.rank===2&&t.rank===2)return $3({a:n,b:t,transposeA:!1,transposeB:!1,bias:r?UE(n.rank,r,yi()):null,activation:e});{const o=n.shape.slice(),a=o.pop();n=ht(n,[-1,a]);const i=t.shape.slice(),s=i.pop(),u=i.pop(),l=[...i,s],c=Array.from({length:t.rank},(g,x)=>x===0?t.rank-2:x<=t.rank-2?x-1:x);t=ht(Ue(t,c),[u,-1]);const h=[...o,...l];return ht($3({a:n,b:t,transposeA:!1,transposeB:!1,bias:r?UE(n.rank,r,yi()):null,activation:e}),h)}}function MW(n,t,e){return gt(()=>(Array.isArray(t)?t=Go(t,"int32"):t=jt(t,"int32"),LR(n,t,e)))}function Zg(n){return it(n,n)}function UE(n,t,e){const r=t.shape;if(t.rank!==1&&t.rank!==n)throw new ot(`Unexpected bias dimensions: ${t.rank}; expected it to be 1 or ${n}`);if(n===5){if(e==="channelsFirst")return r.length===1?ht(t,[1,r[0],1,1,1]):ht(t,[1,r[3],r[0],r[1],r[2]]);if(e==="channelsLast")return r.length===1?ht(t,[1,1,1,1,r[0]]):ht(t,[1].concat(r))}else if(n===4){if(e==="channelsFirst")return r.length===1?ht(t,[1,r[0],1,1]):ht(t,[1,r[2],r[0],r[1]]);if(e==="channelsLast")return r.length===1?ht(t,[1,1,1,r[0]]):ht(t,[1].concat(r))}else if(n===3){if(e==="channelsFirst")return r.length===1?ht(t,[1,r[0],1]):ht(t,[1,r[1],r[0]]);if(e==="channelsLast")return r.length===1?ht(t,[1,1,r[0]]):ht(t,[1].concat(r))}else if(n<3)return t;throw new ot(`Unsupported input rank by biasAdd: ${t.rank}`)}function Si(n,t,e){return gt(()=>(e==null&&(e=yi()),nr(e),Bt(n,UE(n.rank,t,e))))}function Pbt(n,t=1){if(t!==1)throw new Ie(`Support for alpha values other than 1 (${t}) is not implemented yet.`);return Cb(n)}function Bbt(n){return gt(()=>fe(n,Bt(fo(n),1)))}function LW(n,t,e,r){return gt(()=>i0t(n,t,e,r))}function zbt(n){return gt(()=>{const t=Bt(.5,it(.2,n));return wa(t,0,1)})}function Jg(n,t,e=!1){return e?n():t()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Ubt=["fanIn","fanOut","fanAvg"],Wbt=["normal","uniform","truncatedNormal"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Vbt(n){oh(Ubt,"FanMode",n)}function Gbt(n){oh(Wbt,"Distribution",n)}class Qa extends gd{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class PW extends Qa{apply(t,e){return Rr(t,e)}}PW.className="Zeros";Lt(PW);class FT extends Qa{apply(t,e){return kl(t,e)}}FT.className="Ones";Lt(FT);class BW extends Qa{constructor(t){if(super(),typeof t!="object")throw new ot(`Expected argument of type ConstantConfig but got ${t}`);if(t.value===void 0)throw new ot(`config must have value set but got ${t}`);this.value=t.value}apply(t,e){return gt(()=>it(Je(this.value),kl(t,e)))}getConfig(){return{value:this.value}}}BW.className="Constant";Lt(BW);class zW extends Qa{constructor(t){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=t.minval||this.DEFAULT_MINVAL,this.maxval=t.maxval||this.DEFAULT_MAXVAL,this.seed=t.seed}apply(t,e){return Gg(t,this.minval,this.maxval,e,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}zW.className="RandomUniform";Lt(zW);class UW extends Qa{constructor(t){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=t.mean||this.DEFAULT_MEAN,this.stddev=t.stddev||this.DEFAULT_STDDEV,this.seed=t.seed}apply(t,e){if(e=e||"float32",e!=="float32"&&e!=="int32")throw new Ie(`randomNormal does not support dType ${e}.`);return Ab(t,this.mean,this.stddev,e,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}UW.className="RandomNormal";Lt(UW);class WW extends Qa{constructor(t){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=t.mean||this.DEFAULT_MEAN,this.stddev=t.stddev||this.DEFAULT_STDDEV,this.seed=t.seed}apply(t,e){if(e=e||"float32",e!=="float32"&&e!=="int32")throw new Ie(`truncatedNormal does not support dType ${e}.`);return MU(t,this.mean,this.stddev,e,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}WW.className="TruncatedNormal";Lt(WW);class VW extends Qa{constructor(t){super(),this.gain=t.gain!=null?t.gain:1}apply(t,e){return gt(()=>{if(t.length!==2||t[0]!==t[1])throw new ot("Identity matrix initializer can only be used for 2D square matrices.");return it(this.gain,xU(t[0]))})}getConfig(){return{gain:this.gain}}}VW.className="Identity";Lt(VW);function Hbt(n,t="channelsLast"){let e,r;if(nr(t),n.length===2)e=n[0],r=n[1];else if([3,4,5].indexOf(n.length)!==-1){if(t==="channelsFirst"){const o=el(n,2);e=n[1]*o,r=n[0]*o}else if(t==="channelsLast"){const o=el(n,0,n.length-2);e=n[n.length-2]*o,r=n[n.length-1]*o}}else{const o=el(n);e=Math.sqrt(o),r=Math.sqrt(o)}return[e,r]}class Qo extends Qa{constructor(t){if(super(),t.scale<0)throw new ot(`scale must be a positive float. Got: ${t.scale}`);this.scale=t.scale==null?1:t.scale,this.mode=t.mode==null?"fanIn":t.mode,Vbt(this.mode),this.distribution=t.distribution==null?"normal":t.distribution,Gbt(this.distribution),this.seed=t.seed}apply(t,e){const r=Hbt(t),o=r[0],a=r[1];let i=this.scale;if(this.mode==="fanIn"?i/=Math.max(1,o):this.mode==="fanOut"?i/=Math.max(1,a):i/=Math.max(1,(o+a)/2),this.distribution==="normal"){const s=Math.sqrt(i);if(e=e||"float32",e!=="float32"&&e!=="int32")throw new Ie(`${this.getClassName()} does not support dType ${e}.`);return MU(t,0,s,e,this.seed)}else{const s=Math.sqrt(3*i);return Gg(t,-s,s,e,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}Qo.className="VarianceScaling";Lt(Qo);class MT extends Qo{constructor(t){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:t==null?null:t.seed})}getClassName(){return Qo.className}}MT.className="GlorotUniform";Lt(MT);class LT extends Qo{constructor(t){super({scale:1,mode:"fanAvg",distribution:"normal",seed:t==null?null:t.seed})}getClassName(){return Qo.className}}LT.className="GlorotNormal";Lt(LT);class PT extends Qo{constructor(t){super({scale:2,mode:"fanIn",distribution:"normal",seed:t==null?null:t.seed})}getClassName(){return Qo.className}}PT.className="HeNormal";Lt(PT);class BT extends Qo{constructor(t){super({scale:2,mode:"fanIn",distribution:"uniform",seed:t==null?null:t.seed})}getClassName(){return Qo.className}}BT.className="HeUniform";Lt(BT);class zT extends Qo{constructor(t){super({scale:1,mode:"fanIn",distribution:"normal",seed:t==null?null:t.seed})}getClassName(){return Qo.className}}zT.className="LeCunNormal";Lt(zT);class UT extends Qo{constructor(t){super({scale:1,mode:"fanIn",distribution:"uniform",seed:t==null?null:t.seed})}getClassName(){return Qo.className}}UT.className="LeCunUniform";Lt(UT);class GW extends Qa{constructor(t){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=t.gain==null?this.DEFAULT_GAIN:t.gain,this.seed=t.seed}apply(t,e){return gt(()=>{if(t.length<2)throw new Ie("Shape must be at least 2D.");if(e!=="int32"&&e!=="float32"&&e!==void 0)throw new TypeError(`Unsupported data type ${e}.`);e=e;const r=It(t.slice(0,-1)),o=t[t.length-1],a=r*o;a>this.ELEMENTS_WARN_SLOW&&console.warn(`Orthogonal initializer is being called on a matrix with more than ${this.ELEMENTS_WARN_SLOW} (${a}) elements: Slowness may result.`);const i=[Math.max(o,r),Math.min(o,r)],s=Ab(i,0,1,e,this.seed),u=nyt.qr(s,!1);let l=u[0];const h=u[1].flatten().stridedSlice([0],[Math.min(o,r)*Math.min(o,r)],[Math.min(o,r)+1]);return l=it(l,h.sign()),r<o&&(l=l.transpose()),it(Je(this.gain),l.reshape(t))})}getConfig(){return{gain:this.gain,seed:this.seed}}}GW.className="Orthogonal";Lt(GW);const X3={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function K3(n,t={}){return Yg(n,Ba.getMap().classNameMap,t,"initializer")}function Ln(n){return DT(n)}function $n(n){if(typeof n=="string"){const t=n in X3?X3[n]:n;if(t==="GlorotNormal")return new LT;if(t==="GlorotUniform")return new MT;if(t==="HeNormal")return new PT;if(t==="HeUniform")return new BT;if(t==="LeCunNormal")return new zT;if(t==="LeCunUniform")return new UT;{const e={};return e.className=t,e.config={},K3(e)}}else return n instanceof Qa?n:K3(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function WE(n){return Array.isArray(n)&&Array.isArray(n[0])}function Ry(n){return n.length===0?[]:Array.isArray(n[0])?n:[n]}function xe(n){let t;if(Array.isArray(n)){if(n.length!==1)throw new ot(`Expected Tensor length to be 1; got ${n.length}`);t=n[0]}else t=n;return t}function Xe(n){if(Array.isArray(n)&&Array.isArray(n[0])){if(n.length===1)return n=n,n[0];throw new ot(`Expected exactly 1 Shape; got ${n.length}`)}else return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Ty(n){let t=0;for(const e of n)e.shape.length===0?t+=1:t+=e.shape.reduce((r,o)=>r*o);return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Y3="Variable";class qbt{constructor(t,e="float32",r=Y3,o=!0,a=null){this.dtype=e??"float32",this.shape=t.shape,this.id=_W(),r=r??Y3,this.originalName=$W(r),this.name=OW(this.originalName),this.trainable_=o,this.constraint=a,this.val=n0t(t,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(t){return this.assertNotDisposed(),jbt(this.val,t),this.val.id!==t.id&&(this.val.assign(t),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(t){this.trainable_=t,this.val.trainable=t}}function jbt(n,t){if(n.shape.toString()!==t.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(n.shape)+" vs. "+JSON.stringify(t.shape))}function VE(n){return n.map(t=>t.read())}function WT(n){n.forEach(t=>{t[0].write(t[1])})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class vr{constructor(t){this.dtype=t.dtype,this.shape=t.shape,t.shape!=null?this.ndim=t.shape.length:this.ndim=t.ndim,this.maxNDim=t.maxNDim,this.minNDim=t.minNDim,this.axes=t.axes||{}}}class ss{constructor(t,e,r,o,a,i,s){this.dtype=t,this.shape=e,this.sourceLayer=r,this.inputs=o,this.callArgs=a,this.outputTensorIndex=s,this.id=_W(),i!=null&&(this.originalName=$W(i),this.name=OW(this.originalName)),this.rank=e.length}}let Xbt=0;class _b{constructor(t,e){this.callArgs=e,this.id=Xbt++,this.outboundLayer=t.outboundLayer,this.inboundLayers=t.inboundLayers,this.nodeIndices=t.nodeIndices,this.tensorIndices=t.tensorIndices,this.inputTensors=t.inputTensors,this.outputTensors=t.outputTensors,this.inputMasks=t.inputMasks,this.outputMasks=t.outputMasks,this.inputShapes=t.inputShapes,this.outputShapes=t.outputShapes;for(const r of t.inboundLayers)r?.outboundNodes.push(this);t.outboundLayer.inboundNodes.push(this)}getConfig(){const t=[];for(const e of this.inboundLayers)e!=null?t.push(e.name):t.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:t,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let Kbt=0;class De extends gd{constructor(t={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=Kbt++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let e=t.name;if(!e){const r=this.getClassName();e=Ps(r)+"_"+Nb(r)}if(this.name=e,this.trainable_=t.trainable==null?!0:t.trainable,t.inputShape!=null||t.batchInputShape!=null){let r;if(t.batchInputShape!=null)r=t.batchInputShape;else if(t.inputShape!=null){let a=null;t.batchSize!=null&&(a=t.batchSize),r=[a].concat(t.inputShape)}this.batchInputShape=r;let o=t.dtype;o==null&&(o=t.inputDType),o==null&&(o="float32"),this.dtype=o}t.weights!=null?this.initialWeights=t.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(t,e){return t.name+"_ib-"+e.toString()}getNodeAtIndex(t,e){if(this.inboundNodes.length===0)throw new Ua(`The layer has never been called and thus has no defined ${e}.`);if(this.inboundNodes.length<=t)throw new ot(`Asked to get ${e} at node ${t}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[t]}getInputAt(t){return To(this.getNodeAtIndex(t,"input").inputTensors)}getOutputAt(t){return To(this.getNodeAtIndex(t,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new Bi(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new Bi(`Layer ${this.name} is not connected, no input to return.`);return To(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new Bi(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new Bi(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return To(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(t=>t())}get updates(){return this._updates}get built(){return this._built}set built(t){this._built=t}get trainable(){return this.trainable_}set trainable(t){this._trainableWeights.forEach(e=>e.trainable=t),this.trainable_=t}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(t=>t.trainable):[]}set trainableWeights(t){this._trainableWeights=t}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(t=>!t.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(t){this._nonTrainableWeights=t}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(t){const e=ln(t);if(this.inputSpec==null||this.inputSpec.length===0)return;const r=ln(this.inputSpec);if(e.length!==r.length)throw new ot(`Layer ${this.name} expects ${r.length} inputs, but it received ${e.length} input tensors. Input received: ${t}`);for(let o=0;o<e.length;o++){const a=e[o],i=r[o];if(i==null)continue;const s=a.rank;if(i.ndim!=null&&s!==i.ndim)throw new ot(`Input ${o} is incompatible with layer ${this.name}: expected ndim=${i.ndim}, found ndim=${s}`);if(i.maxNDim!=null&&s>i.maxNDim)throw new ot(`Input ${o} is incompatible with layer ${this.name}: expected max_ndim=${i.maxNDim}, found ndim=${s}`);if(i.minNDim!=null&&s<i.minNDim)throw new ot(`Input ${o} is incompatible with layer ${this.name}: expected min_ndim=${i.minNDim}, found ndim=${s}.`);if(i.dtype!=null&&a.dtype!==i.dtype)throw new ot(`Input ${o} is incompatible with layer ${this.name} : expected dtype=${i.dtype}, found dtype=${a.dtype}.`);if(i.axes){const u=a.shape;for(const l in i.axes){const c=Number(l),h=i.axes[l],d=c>=0?u[c]:u[u.length+c];if(h!=null&&[h,null].indexOf(d)===-1)throw new ot(`Input ${o} is incompatible with layer ${this.name}: expected axis ${c} of input shape to have value ${h} but got shape ${u}.`)}}if(i.shape!=null)for(let u=0;u<i.shape.length;++u){const l=i.shape[u],c=a.shape[u];if(l!=null&&c!=null&&l!==c)throw new ot(`Input ${o} is incompatible with layer ${this.name}: expected shape=${i.shape}, found shape=${a.shape}.`)}}}call(t,e){return t}invokeCallHook(t,e){this._callHook!=null&&this._callHook(t,e)}setCallHook(t){this._callHook=t}clearCallHook(){this._callHook=null}apply(t,e){e=e||{},this.assertNotDisposed();const r=ln(t),o=Zbt(t),a=Jbt(t);if(o===a)throw new ot("Arguments to apply() must be all SymbolicTensors or all Tensors");return yc(this.name,()=>{if(!this.built){this.assertInputCompatibility(t);const i=[];for(const s of ln(t))i.push(s.shape);this.build(To(i)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&a&&(this._refCount=1)}if(this.assertInputCompatibility(t),a){let i=this.call(t,e);this.supportsMasking&&this.setMaskMetadata(t,i);const s=ln(i),u=[];for(let l of s)r.indexOf(l)!==-1&&(l=l.clone()),u.push(l);if(i=To(u),this.activityRegularizer!=null)throw new Ie("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return i}else{const i=Ybt(t),s=this.computeOutputShape(i);let u;const l=Qbt(t);if(this.warnOnIncompatibleInputShape(Array.isArray(t)?i[0]:i),s!=null&&s.length>0&&Array.isArray(s[0])?u=s.map((c,h)=>new ss(l,c,this,ln(t),e,this.name,h)):u=new ss(l,s,this,ln(t),e,this.name),this.addInboundNode(t,u,null,null,i,s,e),this._refCount++,this.activityRegularizer!=null)throw new Ie("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return u}})}warnOnIncompatibleInputShape(t){if(this.batchInputShape!=null)if(t.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(t)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let e=!1;this.batchInputShape.forEach((r,o)=>{r!=null&&t[o]!=null&&t[o]!==r&&(e=!0)}),e&&console.warn(`The shape of the input tensor (${JSON.stringify(t)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new Bi(`The layer ${this.name} has never been called and thus has no defined output shape.`);const t=[];for(const e of this.inboundNodes){const r=JSON.stringify(e.outputShapes);t.indexOf(r)===-1&&t.push(r)}if(t.length===1){const e=this.inboundNodes[0].outputShapes;return Array.isArray(e)&&Array.isArray(e[0])&&e.length===1?e[0]:e}else throw new Bi(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new Ua(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return Ty(this.weights)}build(t){this.built=!0}getWeights(t=!1){return VE(t?this.trainableWeights:this.weights)}setWeights(t){gt(()=>{const e=this.weights;if(e.length!==t.length)throw new ot(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${t.length}, but the layer was expecting ${e.length} weights. Provided weights: ${t}...`);if(e.length===0)return;const r=[],o=VE(e);for(let a=0;a<o.length;++a){const i=o[a],s=e[a],u=t[a];if(!tn(i.shape,u.shape))throw new ot(`Layer weight shape ${i.shape} not compatible with provided weight shape ${u.shape}`);r.push([s,u])}WT(r)})}addWeight(t,e,r,o,a,i,s,u){if(this._addedWeightNames.indexOf(t)!==-1)throw new ot(`Duplicate weight name ${t} for layer ${this.name}`);this._addedWeightNames.push(t),r==null&&(r="float32"),this.fastWeightInitDuringBuild&&(o=u!=null?u():$n("zeros"));const l=o.apply(e,r),c=new qbt(l,r,t,i,s);return l.dispose(),a!=null&&this.addLoss(()=>a.apply(c.read())),i==null&&(i=!0),i?this._trainableWeights.push(c):this._nonTrainableWeights.push(c),c}setFastWeightInitDuringBuild(t){this.fastWeightInitDuringBuild=t}addLoss(t){t==null||Array.isArray(t)&&t.length===0||(t=ln(t),this._losses!==void 0&&this._losses!==null&&this.losses.push(...t))}computeOutputShape(t){return t}computeMask(t,e){if(!this.supportsMasking){if(e!=null)if(Array.isArray(e))e.forEach(r=>{if(r!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return e}setMaskMetadata(t,e,r){if(!this.supportsMasking)return;const o=this.computeMask(t,r),a=ln(e),i=ln(o);if(a.length!==i.length)throw new Error(`${this.name} outputs ${a.length} tensors but ${a.length} masks for those tensors`);for(let s=0;s<a.length;s++)a[s].kerasMask=i[s]}addInboundNode(t,e,r,o,a,i,s=null){const u=ln(t);e=ln(e),r=ln(r),o=ln(o),a=Ry(a),i=Ry(i);const l=[],c=[],h=[];for(const d of u)l.push(d.sourceLayer),c.push(d.nodeIndex),h.push(d.tensorIndex);new _b({outboundLayer:this,inboundLayers:l,nodeIndices:c,tensorIndices:h,inputTensors:u,outputTensors:e,inputMasks:r,outputMasks:o,inputShapes:a,outputShapes:i},s);for(let d=0;d<e.length;d++)e[d].sourceLayer=this,e[d].nodeIndex=this.inboundNodes.length-1,e[d].tensorIndex=d}getConfig(){const t={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(t.batchInputShape=this.batchInputShape),this.dtype!=null&&(t.dtype=this.dtype),t}disposeWeights(){return this.weights.forEach(t=>t.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let t=0;return--this._refCount===0&&(t=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:t}}}function Ybt(n){n=ln(n);const t=[];for(const e of n)t.push(e.shape);return To(t)}function Qbt(n){return"float32"}function HW(n,t,e){if((t==null||e!=null&&e>0)&&(t=n.sourceLayer,e=n.nodeIndex),t.inboundNodes.length===0)return[n];{const r=t.inboundNodes[e];if(r.inboundLayers.length===0)return r.inputTensors;{const o=[];for(let a=0;a<r.inboundLayers.length;a++){const i=r.inputTensors[a],s=r.inboundLayers[a],u=r.nodeIndices[a],l=HW(i,s,u);for(const c of l)o.indexOf(c)===-1&&o.push(c)}return o}}}function Zbt(n){let t=!0;for(const e of ln(n))if(!(e instanceof ss)){t=!1;break}return t}function Jbt(n){let t=!0;for(const e of ln(n))if(e instanceof ss){t=!1;break}return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class tv extends De{constructor(t){if(super({dtype:t.dtype,name:t.name!=null?t.name:Nb("input").toString()}),t.batchSize==null&&(t.batchSize=null),t.sparse==null&&(t.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=t.sparse,t.inputShape!=null&&t.batchInputShape!=null)throw new ot("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let e=t.batchInputShape;if(e==null){if(t.inputShape==null)throw new ot("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");e=[t.batchSize].concat(t.inputShape)}else if(t.batchSize!=null)throw new ot("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const r=t.dtype||"float32";this.batchInputShape=e,this.dtype=r,this.inputSpec=[{shape:e}];const o=new ss(this.dtype,this.batchInputShape,this,[],{},this.name);o.nodeIndex=0,o.tensorIndex=0,new _b({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[o],outputTensors:[o],inputMasks:[null],outputMasks:[null],inputShapes:[e],outputShapes:[e]})}apply(t,e){throw new ot(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}tv.className="InputLayer";Lt(tv);function twt(n){if(n.batchShape==null&&n.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(n.batchShape!=null&&n.shape!=null)throw new ot("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let t=n.batchShape;n.shape!=null&&t==null&&(t=[null].concat(n.shape));let e=n.dtype;return e==null&&(e="float32"),new tv({batchInputShape:t,name:n.name,dtype:e,sparse:n.sparse}).inboundNodes[0].outputTensors[0]}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function ewt(n,t){if(n.dtype==null||n.dtype===t.dtype)return t;try{return jt(t,n.dtype)}catch{throw new ot(`The dtype of the feed (${t.dtype}) can not be cast to the dtype of the key '${n.name}' (${n.dtype}).`)}}class Xu{constructor(t){if(this.id2Value={},this.id2Mask={},this.name2Id={},t instanceof Xu)for(const e in t.id2Value)this.id2Value[e]=t.id2Value[e],e in t.id2Mask&&(this.id2Mask[e]=t.id2Mask[e]);else{if(t==null)return;for(const e of t)this.add(e.key,e.value)}}add(t,e,r){if(this.id2Value[t.id]==null)this.id2Value[t.id]=ewt(t,e),this.name2Id[t.name]=t.id,r!=null&&(this.id2Mask[t.id]=r);else throw new ot(`Duplicate key: name=${t.name}, id=${t.id}`);return this}addFeed(t){this.add(t.key,t.value)}hasKey(t){return this.id2Value[t.id]!=null}names(){return Object.keys(this.name2Id)}getValue(t){if(t instanceof ss){if(this.id2Value[t.id]==null)throw new ot(`Nonexistent key: ${t.name}`);return this.id2Value[t.id]}else{const e=this.name2Id[t];if(e==null)throw new ot(`Feed dict has no SymbolicTensor name: ${t}`);return this.id2Value[e]}}getMask(t){if(t instanceof ss){if(this.id2Value[t.id]==null)throw new ot(`Nonexistent key: ${t.name}`);return this.id2Mask[t.id]}else{const e=this.name2Id[t];if(e==null)throw new ot(`Feed dict has no SymbolicTensor name: ${t}`);return this.id2Mask[e]}}disposeMasks(){this.id2Mask!=null&&Oe(this.id2Mask)}}const Ny=new TW,Ay=new TW;function nwt(n){Ny?.setMaxEntries(n),Ay?.setMaxEntries(n)}function Vp(n,t,e,r){const o=e==null?!1:e.training,a=Array.isArray(n),i=a?n:[n],s=i.map(g=>g.name),u=[],l=t.names();for(const g of s)l.indexOf(g)!==-1?u.push(t.getValue(g)):u.push(null);const c=s.join(",")+"|"+t.names().sort().join(",");let h=Ny.get(c),d;if(h==null){const g=rwt(i,t);h=g.sorted,d=g.recipientCounts,Ny.put(c,h),Ay.put(c,d)}d={},o||Object.assign(d,Ay.get(c));const p=new Xu(t);for(let g=0;g<h.length;++g){const x=h[g],y=x.sourceLayer;if(y instanceof tv)continue;const b=[],C=[],E=[];let S=!1;for(const _ of x.inputs){const $=p.getValue(_),D=p.getMask(_);b.push($),C.push(D),D!=null&&(S=!0),o||(d[_.name]--,d[_.name]===0&&!t.hasKey(_)&&s.indexOf(_.name)===-1&&!$.isDisposed&&_.sourceLayer.stateful!==!0&&E.push($))}S&&(e=e||{},e.mask=C[0]);const k=ln(y.apply(b,e));let R=null;y.supportsMasking&&(R=y.computeMask(b,C));const A=awt(x),N=Array.isArray(A)?A:[A];for(let _=0;_<N.length;++_){p.hasKey(N[_])||p.add(N[_],k[_],Array.isArray(R)?R[0]:R);const $=s.indexOf(N[_].name);$!==-1&&(u[$]=k[_])}o||Oe(E)}return p.disposeMasks(),a?u:u[0]}function rwt(n,t){H(n!=null&&n.length>0,()=>"Expected at least one fetch, got none");let e=[],r={};if(n.length===1){const o=Q3(n[0],t);e=o.sorted,r=o.recipientMap}else{const o=new Set;for(const a of n){const{sorted:i,recipientMap:s}=Q3(a,t);for(const u of i)o.has(u.name)||(e.push(u),o.add(u.name));for(const u in s)r[u]==null&&(r[u]=new Set),s[u].forEach(l=>r[u].add(l))}}return{sorted:e,recipientCounts:owt(r)}}function owt(n){const t={};for(const e in n)t[e]=n[e].size;return t}function Q3(n,t){const e=new Set,r=[],o={};for(const s of t.names())e.add(s);const a=[],i=[];for(a.push(n);a.length>0;){const s=a[a.length-1];if(e.has(s.name)){a.pop();continue}const u=i[i.length-1]===a.length-1;if(s.inputs.length===0||u)a.pop(),r.push(s),e.add(s.name),u&&i.pop();else{i.push(a.length-1);for(const l of s.inputs)o[l.name]==null&&(o[l.name]=new Set),o[l.name].add(s.name),!e.has(l.name)&&a.push(l)}}return{sorted:r,recipientMap:o}}function awt(n){let t;if(n.sourceLayer.inboundNodes.length===1)t=n.sourceLayer.output;else{let e=null;for(let r=0;r<n.sourceLayer.inboundNodes.length;++r)for(const o of n.sourceLayer.inboundNodes[r].outputTensors)if(o.id===n.id){e=r;break}t=n.sourceLayer.getOutputAt(e)}return t}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iwt=yt();iwt.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,nwt);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function VT(n,t){return gt(()=>eo(ce(it(n,n),t,!0)))}class ev extends gd{getConfig(){return{}}}class qW extends ev{constructor(t){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=t.maxValue!=null?t.maxValue:this.defaultMaxValue,this.axis=t.axis!=null?t.axis:this.defaultAxis}apply(t){return gt(()=>{const e=VT(t,this.axis),r=wa(e,0,this.maxValue);return it(t,fe(r,Bt(gr(),e)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}qW.className="MaxNorm";Lt(qW);class jW extends ev{constructor(t){super(),this.defaultAxis=0,this.axis=t.axis!=null?t.axis:this.defaultAxis}apply(t){return gt(()=>fe(t,Bt(gr(),VT(t,this.axis))))}getConfig(){return{axis:this.axis}}}jW.className="UnitNorm";Lt(jW);class XW extends ev{apply(t){return nh(t)}}XW.className="NonNeg";Lt(XW);class KW extends ev{constructor(t){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=t.minValue!=null?t.minValue:this.defaultMinValue,this.maxValue=t.maxValue!=null?t.maxValue:this.defaultMaxValue,this.rate=t.rate!=null?t.rate:this.defaultRate,this.axis=t.axis!=null?t.axis:this.defaultAxis}apply(t){return gt(()=>{const e=VT(t,this.axis),r=Bt(it(this.rate,wa(e,this.minValue,this.maxValue)),it(1-this.rate,e));return it(t,fe(r,Bt(gr(),e)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}KW.className="MinMaxNorm";Lt(KW);const Z3={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function xr(n){return DT(n)}function J3(n,t={}){return Yg(n,Ba.getMap().classNameMap,t,"constraint")}function yr(n){if(n==null)return null;if(typeof n=="string"){const e={className:n in Z3?Z3[n]:n,config:{}};return J3(e)}else return n instanceof ev?n:J3(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function Yl(n){if(n==null)return;const t=[],e=[],r=[];for(const o in n){const a=n[o];if(typeof a!="number"){const i=a;t.push(i.data()),e.push(o),r.push(i)}}if(t.length>0){const o=await Promise.all(t);for(let a=0;a<o.length;++a)n[e[a]]=o[a][0];Oe(r)}}function YW(n){if(n!=null)for(const t in n){const e=n[t];typeof e!="number"&&e.dispose()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var tF;(function(n){n[n.SILENT=0]="SILENT",n[n.VERBOSE=1]="VERBOSE"})(tF||(tF={}));const swt=125;class fm{constructor(){this.validationData=null}setParams(t){this.params=t}async onEpochBegin(t,e){}async onEpochEnd(t,e){}async onBatchBegin(t,e){}async onBatchEnd(t,e){}async onTrainBegin(t){}async onTrainEnd(t){}setModel(t){}}class uwt{constructor(t,e=10){t==null&&(t=[]),this.callbacks=t,this.queueLength=e}append(t){this.callbacks.push(t)}setParams(t){for(const e of this.callbacks)e.setParams(t)}setModel(t){for(const e of this.callbacks)e.setModel(t)}async onEpochBegin(t,e){e==null&&(e={});for(const r of this.callbacks)await r.onEpochBegin(t,e)}async onEpochEnd(t,e){e==null&&(e={});for(const r of this.callbacks)await r.onEpochEnd(t,e)}async onBatchBegin(t,e){e==null&&(e={});for(const r of this.callbacks)await r.onBatchBegin(t,e)}async onBatchEnd(t,e){e==null&&(e={});for(const r of this.callbacks)await r.onBatchEnd(t,e)}async onTrainBegin(t){t==null&&(t={});for(const e of this.callbacks)await e.onTrainBegin(t)}async onTrainEnd(t){t==null&&(t={});for(const e of this.callbacks)await e.onTrainEnd(t)}}class lwt extends fm{constructor(){super()}async onEpochBegin(t){this.seen=0,this.totals={}}async onBatchEnd(t,e){e==null&&(e={});const r=e.size==null?0:e.size;this.seen+=r;for(const o in e){const a=e[o];if(typeof a=="number")this.totals.hasOwnProperty(o)||(this.totals[o]=0),this.totals[o]=this.totals[o]+a*r;else{let i;o in this.totals?i=this.totals[o]:this.totals[o]=0;const s=gt(()=>Bt(this.totals[o],it(a,r)));this.totals[o]=s,i?.dispose()}}}async onEpochEnd(t,e){if(e!=null)for(const r of this.params.metrics)this.totals[r]!=null&&(typeof this.totals[r]=="number"?e[r]=this.totals[r]/this.seen:gt(()=>{const o=it(fe(1,this.seen),this.totals[r]);e[r]=o,this.totals[r].dispose(),Yi(e[r])}))}}class cwt extends fm{async onTrainBegin(t){this.epoch=[],this.history={}}async onEpochEnd(t,e){e==null&&(e={}),this.epoch.push(t);for(const r in e)this.history[r]==null&&(this.history[r]=[]),this.history[r].push(e[r])}async syncData(){const t=[],e=[],r=[];for(const a in this.history){const i=this.history[a];for(let s=0;s<i.length;++s)if(typeof i[s]!="number"){const u=i[s];t.push(u.data()),e.push(a),r.push(s)}}const o=await Promise.all(t);for(let a=0;a<o.length;++a)this.history[e[a]][r[a]].dispose(),this.history[e[a]][r[a]]=o[a][0]}}class hwt extends fm{constructor(t,e){if(super(),this.currentEpoch=0,this.nowFunc=t.nowFunc,this.nextFrameFunc=t.nextFrameFunc||eW,this.yieldEvery=e||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=swt),this.yieldEvery==="never"&&t.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");yE(this.yieldEvery)&&(this.maybeWait=Ebt(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=t.onTrainBegin,this.trainEnd=t.onTrainEnd,this.epochBegin=t.onEpochBegin,this.epochEnd=t.onEpochEnd,this.batchBegin=t.onBatchBegin,this.batchEnd=t.onBatchEnd,this.yield=t.onYield}async maybeWait(t,e,r){const o=[];this.yield!=null&&(await Yl(r),o.push(this.yield(t,e,r))),o.push(this.nextFrameFunc()),await Promise.all(o)}async onEpochBegin(t,e){this.currentEpoch=t,this.epochBegin!=null&&(await Yl(e),await this.epochBegin(t,e))}async onEpochEnd(t,e){const r=[];this.epochEnd!=null&&(await Yl(e),r.push(this.epochEnd(t,e))),this.yieldEvery==="epoch"&&r.push(this.nextFrameFunc()),await Promise.all(r)}async onBatchBegin(t,e){this.batchBegin!=null&&(await Yl(e),await this.batchBegin(t,e))}async onBatchEnd(t,e){const r=[];this.batchEnd!=null&&(await Yl(e),r.push(this.batchEnd(t,e))),this.yieldEvery==="batch"?r.push(this.nextFrameFunc()):yE(this.yieldEvery)&&r.push(this.maybeWait(this.currentEpoch,t,e)),await Promise.all(r)}async onTrainBegin(t){this.trainBegin!=null&&(await Yl(t),await this.trainBegin(t))}async onTrainEnd(t){this.trainEnd!=null&&(await Yl(t),await this.trainEnd(t))}}function QW(n,t){return n==null&&(n={}),n instanceof fm?[n]:Array.isArray(n)&&n[0]instanceof fm?n:ln(n).map(r=>new hwt(r,t))}class Fa{constructor(){}static registerCallbackConstructor(t,e){H(t>=0&&Number.isInteger(t),()=>`Verbosity level is expected to be an integer >= 0, but got ${t}`),Fa.checkForDuplicate(e),Fa.constructors[t]==null&&(Fa.constructors[t]=[]),Fa.constructors[t].push(e)}static checkForDuplicate(t){for(const e in Fa.constructors)Fa.constructors[+e].forEach(o=>{if(o===t)throw new ot("Duplicate callback constructor.")})}static clear(){Fa.constructors={}}static createCallbacks(t){const e=[];for(const r in Fa.constructors){const o=+r;t>=o&&e.push(...Fa.constructors[o])}return e.map(r=>new r)}}Fa.constructors={};function ZW(n,t,e,r,o,a,i,s,u){const l=new cwt,c=[new lwt,...Fa.createCallbacks(t)];n!=null&&c.push(...n),c.push(l);const h=new uwt(c);return h.setParams({epochs:e,initialEpoch:r,samples:o,steps:a,batchSize:i,verbose:t,doValidation:s,metrics:u}),{callbackList:h,history:l}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function qs(n,t={},e=!1){return Yg(n,Ba.getMap().classNameMap,t,"layer",e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function _y(n,t){return gt(()=>{n.dtype!=="float32"&&(n=jt(n,"float32"));const e=ce(Zg(n),t,!0),r=wb(e.shape,gr()),o=eo(El(e,r));return fe(n,o)})}function Db(n,t){return gt(()=>sr(Zg(me(t,n)),-1))}function GT(n,t){return gt(()=>sr(fo(me(t,n)),-1))}function HT(n,t){return gt(()=>{const e=me(n,t),r=wa(fo(n),gr(),Number.MAX_VALUE),o=fo(fe(e,r));return it(100,sr(o,-1))})}function fwt(n,t){return gt(()=>{const e=wa(t,gr(),Number.MAX_VALUE),r=is(Bt(1,e)),o=wa(n,gr(),Number.MAX_VALUE),a=is(Bt(1,o));return sr(Zg(me(r,a)),-1)})}function dwt(n,t){return gt(()=>{const e=El(0,me(1,it(n,t)));return sr(Zg(e),-1)})}function pwt(n,t){return gt(()=>{const e=El(0,me(1,it(n,t)));return sr(e,-1)})}function mwt(n,t){return gt(()=>{const e=ce(it(n,t),-1),r=mi(it(me(1,n),t),-1);return El(0,Bt(1,me(r,e)))})}function gwt(n,t){return gt(()=>{const e=Math.log(2),r=me(t,n),o=me(Bt(r,Vg(it(-2,r))),e);return sr(o,-1)})}function dm(n,t,e=!1){return gt(()=>{if(e)t=KR(t);else{const r=ce(t,t.shape.length-1,!0);t=fe(t,r)}return t=wa(t,gr(),1-gr()),Zn(ce(it(jt(n,"float32"),is(t)),t.shape.length-1))})}function Dy(n,t,e=!1){return gt(()=>{const r=jt(Eb(Mbt(n)),"int32");t=wa(t,gr(),1-gr());const o=t.shape,a=ht(SU(r,o[o.length-1]),o);return dm(a,t,e)})}function vwt(n,t){if(!tn(n.shape,t.shape))throw new ot(`logits and labels must have the same shape, but got shapes ${JSON.stringify(n.shape)} and ${JSON.stringify(t.shape)}`);return gt(()=>{const e=nh(t),r=Zn(fo(t));return Bt(me(e,it(t,n)),yU(as(r)))})}function $b(n,t){return gt(()=>{let e;return e=wa(t,gr(),1-gr()),e=is(fe(e,me(1,e))),sr(vwt(n,e),-1)})}function xwt(n,t){return gt(()=>{const e=wa(n,gr(),1),r=wa(t,gr(),1);return ce(it(n,is(fe(e,r))),-1)})}function ywt(n,t){return gt(()=>{const e=is(Bt(gr(),t));return sr(me(t,it(n,e)),-1)})}function JW(n,t){return gt(()=>{const e=_y(n,-1),r=_y(t,-1),o=it(e,r);return Zn(ce(o,-1))})}const $y={meanSquaredError:Db,meanAbsoluteError:GT,meanAbsolutePercentageError:HT,meanSquaredLogarithmicError:fwt,squaredHinge:dwt,hinge:pwt,categoricalHinge:mwt,logcosh:gwt,categoricalCrossentropy:dm,sparseCategoricalCrossentropy:Dy,binaryCrossentropy:$b,kullbackLeiblerDivergence:xwt,poisson:ywt,cosineProximity:JW};function pS(n){if(typeof n=="string"){if(n in $y)return $y[n];let t=`Unknown loss ${n}`;throw n.toLowerCase().includes("softmaxcrossentropy")&&(t=`Unknown loss ${n}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new ot(t)}else return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function tV(n,t){return gt(()=>{const e=it(.5,Ka(t)),r=Zi(Ca(t,e),n.dtype);return sr(os(n,r),-1)})}function eV(n,t){return gt(()=>Zi(os(sm(n,-1),sm(t,-1)),"float32"))}function bwt(n,t){return gt(()=>jt(ce(Ks(os(n,1),os(t,1))),"float32"))}function wwt(n,t){return gt(()=>jt(ce(Ks(os(n,0),os(t,1))),"float32"))}function Cwt(n,t){return gt(()=>{const e=bwt(n,t),r=wwt(n,t),o=Bt(e,r);return jt(bo(Ca(o,0),fe(e,o),0),"float32")})}function Swt(n,t){return $b(n,t)}function Ewt(n,t){return n.rank===t.rank&&(n=Hg(n,[n.rank-1])),t=sm(t,-1),t.dtype!==n.dtype&&(t=jt(t,n.dtype)),jt(os(n,t),"float32")}const kwt=Db,Iwt=Db,Rwt=GT,Twt=GT,Nwt=HT,Awt=HT,nV=dm,_wt=JW,rV=Dy,Oy={binaryAccuracy:tV,categoricalAccuracy:eV,precision:Cwt,categoricalCrossentropy:nV,sparseCategoricalCrossentropy:rV,mse:kwt,MSE:Iwt,mae:Rwt,MAE:Twt,mape:Nwt,MAPE:Awt,cosine:_wt};function Dwt(n){if(typeof n=="string"&&n in Oy)return Oy[n];if(typeof n!="string"&&n!=null)return n;throw new ot(`Unknown metric ${n}`)}function Yx(n){if(zi(n!==null,`Unknown LossOrMetricFn ${n}`),typeof n=="string")return n;{let t;for(const e of Object.keys($y))if($y[e]===n){t=e;break}if(t!==void 0)return t;for(const e of Object.keys(Oy))if(Oy[e]===n){t=e;break}return t!==void 0?t:n.name}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function $wt(n){const t={Adagrad:()=>Jh.adagrad(.01),Adadelta:()=>Jh.adadelta(1,.95,gr()),Adam:()=>Jh.adam(.001,.9,.999,gr()),Adamax:()=>Jh.adamax(.002,.9,.999,gr(),0),RMSProp:()=>Jh.rmsprop(.001,.9,0,gr()),SGD:()=>Jh.sgd(.01)};if(t.adagrad=t.Adagrad,t.adadelta=t.Adadelta,t.adam=t.Adam,t.adamax=t.Adamax,t.rmsprop=t.RMSProp,t.sgd=t.SGD,n in t)return t[n]();throw new ot(`Unknown Optimizer ${n}`)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const eF=1*1024*1024;function nF(n,t,e=!1){if(n==null||typeof n!="object"||Object.getPrototypeOf(n)!==Object.prototype||!GE(n))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(e){const r=JSON.stringify(n);r.length>eF&&console.warn(`User-defined metadata of model "${t}" is too large in size (length=${r.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ${eF}.`)}}function GE(n){if(n===null)return!0;if(typeof n=="object")if(Object.getPrototypeOf(n)===Object.prototype){const t=Object.keys(n);for(const e of t)if(typeof e!="string"||!GE(n[e]))return!1;return!0}else if(Array.isArray(n)){for(const t of n)if(!GE(t))return!1;return!0}else return!1;else{const t=typeof n;return t==="string"||t==="number"||t==="boolean"}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Owt(n,t,e,r=console.log){const o=Mwt(n),a=["Layer (type)","Input Shape","Output shape","Param #"];o?(t=t||90,e=e||[.32,.61,.89,1]):(t=t||115,e=e||[.24,.48,.7,.8,1]),e[e.length-1]<=1&&(e=e.map(c=>Math.floor(t*c)));let i;if(!o){a.push("Receives inputs"),i=[];for(const c in n.nodesByDepth)i.push(...n.nodesByDepth[c])}r("_".repeat(t)),Fy(a,e,r),r("=".repeat(t));const s=n.layers;for(let c=0;c<s.length;++c)o?Lwt(s[c],e,r):Pwt(s[c],e,i,r),r((c===s.length-1?"=":"_").repeat(t));n.checkTrainableWeightsConsistency();const u=Fwt(n),l=Ty(n.nonTrainableWeights);r(`Total params: ${u+l}`),r(`Trainable params: ${u}`),r(`Non-trainable params: ${l}`),r("_".repeat(t))}function Fwt(n){let t;return n.collectedTrainableWeights!=null?t=Ty(n.collectedTrainableWeights):t=Ty(n.trainableWeights),t}function Mwt(n){let t=!0;const e=[],r=[];for(const o in n.nodesByDepth)e.push(n.nodesByDepth[o]);for(const o of e){if(o.length>1||o.length===1&&o[0].inboundLayers.length>1){t=!1;break}r.push(...o)}if(t)for(const o of n.layers){let a=!1;for(const i of o.inboundNodes)if(r.indexOf(i)!==-1)if(a){t=!1;break}else a=!0;if(!t)break}return t}function Fy(n,t,e=console.log){let r="";for(let o=0;o<n.length;++o)o>0&&(r=r.slice(0,r.length-1)+" "),r+=n[o],r=r.slice(0,t[o]),r+=" ".repeat(t[o]-r.length);e(r)}function Lwt(n,t,e){let r,o;try{o=n.inboundNodes.map(u=>JSON.stringify(u.inputShapes)).join(",")}catch{o="multiple"}try{r=JSON.stringify(n.outputShape)}catch{r="multiple"}const a=n.name,i=n.getClassName(),s=[`${a} (${i})`,o,r,n.countParams().toString()];Fy(s,t,e)}function Pwt(n,t,e,r){let o,a;try{a=n.inboundNodes.map(h=>JSON.stringify(h.inputShapes)).join(",")}catch{a="multiple"}try{o=JSON.stringify(n.outputShape)}catch{o="multiple"}const i=[];for(const h of n.inboundNodes)if(!(e!=null&&e.length>0&&e.indexOf(h)===-1))for(let d=0;d<h.inboundLayers.length;++d){const p=h.inboundLayers[d].name,g=h.nodeIndices[d],x=h.tensorIndices[d];i.push(`${p}[${g}][${x}]`)}const s=n.name,u=n.getClassName(),l=i.length===0?"":i[0],c=[`${s} (${u})`,a,o,n.countParams().toString(),l];Fy(c,t,r);for(let h=1;h<i.length;++h)Fy(["","","","",i[h]],t,r)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function oV(n,t,e){return(n==="inboundNodes"||n==="outputLayers"||n==="inputLayers")&&t===0&&typeof e=="string"}function HE(n,t){if(n===null)return null;if(typeof n=="string")return ac(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const e=[],r=n.length;for(let o=0;o<r;++o){const a=n[o];oV(t,o,a)?e.push(a):e.push(HE(a,t))}return e}else{const e={};for(const r of Object.keys(n)){const o=n[r];if(r==="name"&&typeof o=="string")e[r]=o;else{const a=ac(r);e[a]=HE(o,a)}}return e}}function qE(n,t){if(n==null)return null;if(typeof n=="string")return Ps(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const e=[],r=n.length;for(let o=0;o<r;++o){const a=n[o];oV(t,o,a)?e.push(a):e.push(qE(a,t))}return e}else{const e={};for(const r of Object.keys(n)){const o=n[r],a=Ps(r);(r==="name"||r==="className")&&typeof o=="string"?e[a]=o:e[a]=qE(o,r)}return e}}/** @license See the LICENSE file. */const aV="4.22.0";/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Bwt=n=>{const t=Object.keys(n);if(t.length===0)return!1;const e=t[0].split("/");return!isNaN(parseInt(e[e.length-1],10))};class ri extends De{constructor(t){if(super({}),this.containerNodes=new Set,this.name=t.name,this.name==null){const C=this.getClassName().toLowerCase();this.name=Nb(C)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(t.inputs)?this.inputs=t.inputs.slice():this.inputs=[t.inputs],Array.isArray(t.outputs)?this.outputs=t.outputs.slice():this.outputs=[t.outputs],tl(this.inputs).length!==this.inputs.length)throw new ot(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(C=>C.name)}`);tl(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(C=>C.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const C of this.outputs){const E=C.sourceLayer,S=C.nodeIndex,k=C.tensorIndex;this.outputLayers.push(E),this.outputLayersNodeIndices.push(S),this.outputLayersTensorIndices.push(k)}for(const C of this.inputs){const E=C.sourceLayer,S=C.nodeIndex,k=C.tensorIndex;zi(S===0,"input layer has >1 nodes"),zi(k===0,"input layer has >1 tensors"),this.inputLayers.push(E),this.inputLayersNodeIndices.push(S),this.inputLayersTensorIndices.push(k)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let C=0;C<this.inputLayers.length;C++){const E=this.inputLayers[C];if(!(E instanceof tv))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${t.inputs}. Input ${C} (0-based) originates from layer type ${E.getClassName()}.`);this.inputNames.push(E.name),this.feedInputShapes.push(E.batchInputShape),this.feedInputNames.push(E.name)}for(const C of this.outputLayers)this.outputNames.push(C.name);this.internalInputShapes=this.inputs.map(C=>C.shape),this.internalOutputShapes=this.outputs.map(C=>C.shape);const e={},r={},o={},a={},i={},s=[],u=(C,E,S,k,R,A)=>{(k==null||R==null||A==null)&&(k=C.sourceLayer,R=C.nodeIndex,A=C.tensorIndex);const N=k.inboundNodes[R];if(S.indexOf(N)!==-1)throw new Ua(`The tensor ${C.name} at layer "${k.name}" is part of a cycle.`);if(E.indexOf(N)!==-1)return;this.containerNodes.add(ri.nodeKey(k,R)),k.id in i||(i[k.id]=Object.keys(i).length),S.indexOf(N)===-1&&S.push(N);const _=N.inboundLayers.length;for(let $=0;$<_;$++){const D=N.inputTensors[$],O=N.inboundLayers[$],P=N.nodeIndices[$],z=N.tensorIndices[$];u(D,E,S,O,P,z)}for(E.push(N);S.indexOf(N)>=0;)S.splice(S.indexOf(N),1);s.push(N)},l=[],c=[];for(const C of this.outputs)u(C,l,c);const h=s.slice().reverse();for(const C of h){r[C.id]=C,C.id in e||(e[C.id]=0);let E=e[C.id];const S=o[C.outboundLayer.id]==null?0:o[C.outboundLayer.id];E=Math.max(E,S),o[C.outboundLayer.id]=E,a[C.outboundLayer.id]=C.outboundLayer,e[C.id]=E;for(let k=0;k<C.inboundLayers.length;k++){const R=C.inboundLayers[k],A=C.nodeIndices[k],N=R.inboundNodes[A],_=e[N.id]==null?0:e[N.id];e[N.id]=Math.max(E+1,_),r[N.id]=N}}const d={};for(const C in e){const E=e[C];E in d||(d[E]=[]),d[E].push(r[C])}const p={};for(const C in o){const E=o[C];E in p||(p[E]=[]),p[E].push(a[C])}let g=Object.keys(p).map(C=>parseInt(C,10)).sort(jx);this.layers=[];for(const C of g){const E=p[C];E.sort((S,k)=>{const R=i[S.id],A=i[k.id];return R<A?-1:R>A?1:0});for(const S of E)S instanceof ri&&this.internalContainerRefs.push(S),this.layers.push(S)}this.layersByDepth=p,g=Object.keys(d).map(C=>parseInt(C,10)).sort(jx);const x=this.inputs.slice(),y=[];for(const C of g)for(const E of d[C]){const S=E.outboundLayer;if(S!=null){for(const k of E.inputTensors)if(x.indexOf(k)===-1)throw new Ua(`Graph disconnected: cannot obtain value for tensor ${k} at layer "${S.name}". The following previous layers were accessed without issue: ${y}`);for(const k of E.outputTensors)x.push(k);y.push(S.name)}}this.nodesByDepth=d;const b=this.layers.map(C=>C.name);for(const C of b){const E=b.filter(S=>S===C).length;if(E!==1)throw new Ua(`The name "${C}" is used ${E} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(b))}this.outboundNodes=[],this.inboundNodes=[],new _b({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(C=>null),outputMasks:this.outputs.map(C=>null),inputShapes:this.inputs.map(C=>C.shape),outputShapes:this.outputs.map(C=>C.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const t={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(const e of this.layers)t.numDisposedVariables+=e.dispose().numDisposedVariables;for(const e of this.internalContainerRefs)t.numDisposedVariables+=e.dispose().numDisposedVariables}return t.refCountAfterDispose=this._refCount,t}get trainable(){return this.trainable_}set trainable(t){this.layers.forEach(e=>{e._trainableWeights.forEach(r=>r.trainable=t)}),this.trainable_=t}get trainableWeights(){if(this._trainableWeights.length>0)throw new ot("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let t=[];for(const e of this.layers)t=t.concat(e.trainableWeights);return t}get nonTrainableWeights(){const t=[];for(const e of this.layers)t.push(...e.nonTrainableWeights);if(!this.trainable){const e=[];for(const r of this.layers)e.push(...r.trainableWeights);return e.concat(t)}return t}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(t,e=!0){const r={};let o=0;const a=Bwt(t);a&&this.parseWeights(t);for(const s of this.layers)for(const[u,l]of s.weights.entries()){const c=a?`${l.name.split("/").slice(0,-1).join("/")+"/"}${u}`:l.originalName;if(r[c]!=null)throw new ot(`Duplicate weight name: ${c}`);r[c]=l,o++}const i=[];for(const s in t){let u=s;if(r[s]==null){const l=s.split("/");u=l.slice(0,-2).concat([l[l.length-1]]).join("/")}if(r[u]!=null)i.push([r[u],t[s]]);else if(e)throw new ot(`Provided weight data has no target variable: ${s}`);delete r[u]}if(e){const s=[];for(const u in r)s.push(u);if(s.length>0)throw new ot(`${s.length} of ${o} weights are not set: ${s}`)}WT(i)}parseWeights(t){for(const e in Object.keys(t)){const r=e.split("/"),o=["vars","layer_checkpoint_dependencies"],a=r.map(i=>i.startsWith("_")?i.slice(1):i).filter(i=>!o.includes(i)).join("/");a!==e&&(t[a]=t[e],delete t[e])}}updatedConfig(){const t=this.getConfig(),e={};return e.className=this.getClassName(),e.config=t,e.kerasVersion=`tfjs-layers ${aV}`,e.backend="TensorFlow.js",e}toJSON(t,e=!0){const r=qE(this.updatedConfig());return e?JSON.stringify(r):r}call(t,e){return gt(()=>{t=ln(t);const r=new Xu;for(let o=0;o<this.inputs.length;++o)r.add(this.inputs[o],t[o]);return Vp(this.outputs,r,e)})}computeMask(t,e){return gt(()=>{t=ln(t);let r;return e==null?r=Mc(null,t.length):r=ln(e),this.runInternalGraph(t,r)[1]})}computeOutputShape(t){const e=Ry(t);if(e.length!==this.inputLayers.length)throw new ot(`Invalid inputShape argument ${t}: model has ${this.inputLayers.length} tensor inputs.`);const r={};for(let s=0;s<e.length;s++){const u=this.inputLayers[s],l=e[s],c=u.name+"_0_0";r[c]=l}const o=Object.keys(this.nodesByDepth).map(s=>parseInt(s,10)).sort(jx);if(o.length>1)for(const s of o){const u=this.nodesByDepth[s];for(const l of u){const c=l.outboundLayer;if(this.inputLayers.map(x=>x.id).indexOf(c.id)!==-1)continue;const h=[];for(let x=0;x<l.inboundLayers.length;x++){const y=l.inboundLayers[x],b=l.nodeIndices[x],C=l.tensorIndices[x],E=`${y.name}_${b}_${C}`,S=r[E];h.push(S)}const d=c.computeOutputShape(To(h)),p=Ry(d),g=c.inboundNodes.indexOf(l);for(let x=0;x<p.length;x++){const y=`${c.name}_${g}_${x}`;r[y]=p[x]}}}const a=[],i=[];for(let s=0;s<this.outputLayers.length;s++){const u=this.outputLayers[s],l=this.outputLayersNodeIndices[s],c=this.outputLayersTensorIndices[s],h=`${u.name}_${l}_${c}`;i.push(h)}for(let s=0;s<i.length;s++){const u=i[s];zi(u in r),a.push(r[u])}return To(a)}runInternalGraph(t,e){e==null&&(e=Mc(null,t.length));const r={};for(let u=0;u<this.inputs.length;++u){const l=this.inputs[u],c=t[u],h=e[u];r[l.id]=[c,h]}const o=Object.keys(this.nodesByDepth).map(u=>parseInt(u,10)).sort(jx);for(const u of o){const l=this.nodesByDepth[u];for(const c of l){const h=c.outboundLayer,d=c.inputTensors,p=c.outputTensors,g=new Array;for(const x of d)x.id in r&&g.push(r[x.id]);if(g.length===d.length){let x={},y,b,C,E;if(c.callArgs!=null&&(x=c.callArgs),g.length===1){const[S,k]=g[0];x.mask==null&&(x.mask=k),C=ln(h.call(S,x)),E=ln(h.computeMask(S,k)),y=[S],b=[k]}else y=g.map(S=>S[0]),b=g.map(S=>S[1]),x.mask==null&&(x.mask=b),C=ln(h.call(y,x)),E=ln(h.computeMask(y,b));if(h.activityRegularizer)throw new Ie("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let S=0;S<p.length;++S){const k=p[S],R=C[S],A=E[S];r[k.id]=[R,A]}}}}const a=[],i=[],s=[];for(const u of this.outputs){zi(u.id in r,`Could not compute output ${u.name} : ${u.id}`);const[l,c]=r[u.id];s.push(l.shape),a.push(l),i.push(c)}return[a,i,s]}buildNodeConversionMap(t){const e={};let r;for(const o of this.layers){r=o instanceof ri?1:0;for(let a=0;a<o.inboundNodes.length;a++){const i=ri.nodeKey(o,a);this.containerNodes.has(i)&&(e[i]=r,r+=1)}}return e}getLayer(t,e){if(e!=null)return this.findLayer(e);if(t==null)throw new ot("Provide either a layer name or layer index");if(typeof t=="number")return this.findLayer(t);for(const r of this.layers)if(r.name===t)return r;throw new ot(`No such layer: ${t}`)}findLayer(t){if(this.layers.length<=t)throw new ot(`Was asked to retrieve layer at index ${t}, but model only has ${this.layers.length} layer(s).`);return this.layers[t]}calculateLosses(){return gt(()=>{const t=[];for(const e of this.layers)for(let r=0;r<e.inboundNodes.length;++r){const o=ri.nodeKey(e,r);this.containerNodes.has(o)&&t.push(...e.calculateLosses())}return t})}getConfig(){const t={name:this.name},e=this.buildNodeConversionMap(this.layers),r=[];for(const i of this.layers){const s=i.getClassName(),u=i.getConfig(),l=[];for(let h=0;h<i.inboundNodes.length;h++){const d=i.inboundNodes[h],p=ri.nodeKey(i,h);let g={};if(this.containerNodes.has(p)){if(d.callArgs)try{JSON.stringify(d.callArgs),g=d.callArgs}catch{console.warn(`Layer ${i.name} was passed non-serializable keyword arguments: ${d.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),g={}}if(d.inboundLayers.length>0){const x=[];for(let y=0;y<d.inboundLayers.length;y++){const b=d.inboundLayers[y],C=d.nodeIndices[y],E=d.tensorIndices[y],S=ri.nodeKey(b,C);let k=e[S];k==null&&(k=0),x.push([b.name,k,E,g])}l.push(x)}}}const c={};c.name=i.name,c.className=s,c.config=u,c.inboundNodes=l,r.push(c)}t.layers=r;const o=[];for(let i=0;i<this.inputLayers.length;i++){const s=this.inputLayers[i],u=this.inputLayersNodeIndices[i],l=ri.nodeKey(s,u);if(!this.containerNodes.has(l))continue;let c=e[l];c==null&&(c=0);const h=this.inputLayersTensorIndices[i];o.push([s.name,c,h])}t.inputLayers=o;const a=[];for(let i=0;i<this.outputLayers.length;i++){const s=this.outputLayers[i],u=this.outputLayersNodeIndices[i],l=ri.nodeKey(s,u);if(!this.containerNodes.has(l))continue;let c=e[l];c==null&&(c=0);const h=this.outputLayersTensorIndices[i];a.push([s.name,c,h])}return t.outputLayers=a,t}static fromConfig(t,e,r={},o=!1){const a={},i={};function s(y,b){y.name in i?i[y.name].push(b):i[y.name]=[b]}function u(y,b){const C=[];let E;for(const S of b){const k=S[0],R=S[1],A=S[2];if(E=S[3]==null?{}:S[3],!(k in a)){s(y,b);return}const N=a[k];if(N.inboundNodes.length<=R){s(y,b);return}const _=N.inboundNodes[R];C.push(_.outputTensors[A])}C.length>0&&y.apply(To(C),E)}function l(y){const b=y.name,C=qs(y,e.customObjects!=null?e.customObjects:{});C.setFastWeightInitDuringBuild(o),a[b]=C,y.inboundNodes.forEach(S=>{if(!(S instanceof Array))throw new ot(`Corrupted configuration, expected array for nodeData: ${S}`);s(C,S)})}const c=e.name,h=e.layers;for(const y of h)l(y);for(;!Sbt(i);)for(const y of h){const b=a[y.name];if(b.name in i){const C=i[b.name];delete i[b.name];for(const E of C)u(b,E)}}const d=[],p=[],g=e.inputLayers;for(const y of g){const b=y[0],C=y[1],E=y[2];zi(b in a);const k=a[b].inboundNodes[C].outputTensors;d.push(k[E])}const x=e.outputLayers;for(const y of x){const b=y[0],C=y[1],E=y[2];zi(b in a);const k=a[b].inboundNodes[C].outputTensors;p.push(k[E])}return new t({inputs:d,outputs:p,name:c})}get stateful(){if(this._stateful)throw new ot("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const t of this.layers)if(t.stateful)return!0;return!1}resetStates(){gt(()=>{this.layers.forEach(t=>{t.stateful&&t.resetStates()})})}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function zwt(n,t,e){const r=t.length;if(n==null||Array.isArray(n)&&n.length===0)return t.map(o=>null);if(r===1)return Array.isArray(n)&&n.length===1?n:typeof n=="object"&&t[0]in n?[n[t[0]]]:[n];if(Array.isArray(n)){if(n.length!==r)throw new Error(`Provided ${e} is an array of ${n.length} element(s), but the model has ${r} outputs. Make sure a set of weights is provided for each model output.`);return n}else if(typeof n=="object"&&Object.keys(n).length>0&&typeof n[Object.keys(n)[0]]=="object"){const o=[];return t.forEach(a=>{a in n?o.push(n[a]):o.push(null)}),o}else throw new Error(`The model has multiple (${r}) outputs, so ${e} must be either an array with ${r} elements or an object with ${t} keys. Provided ${e} not understood: ${JSON.stringify(n)}`)}function iV(n,t){return zwt(n,t,"classWeight")}async function sV(n,t,e,r){if(e!=null){const o=gt(()=>{if(n.shape.length===1)return xc(n);if(n.shape.length===2){if(n.shape[1]>1)return sm(n,1);if(n.shape[1]===1)return ht(n,[n.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${n.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${n.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),a=Array.from(await o.data());Oe(o);const i=[];return a.forEach(s=>{if(e[s]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${s} exists in the data but not in classWeight`);i.push(e[s])}),Go(i,"float32")}else return null}function Uwt(n,t){return it(n,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Wwt=32;function uV(n,t){let e,r;const o=t;e=o.xs,r=o.ys,H(e!=null&&r!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${t}`);const a=rF("input",n.inputNames,e),i=rF("output",n.outputNames,r),s=a[0].shape[0];H(a.length===n.inputs.length,()=>`LayersModel has ${n.inputs.length} inputs, but the dataset provides ${a.length} inputs.  (Expected input keys: ${JSON.stringify(n.inputNames)})`),H(i.length===n.outputs.length,()=>`LayersModel has ${n.outputs.length} outputs, but the dataset provides ${i.length} outputs.  (Expected output keys: ${JSON.stringify(n.outputNames)})`);for(let u=0;u<a.length;u++)H(a[u].shape[0]===s,()=>`Batch size mismatch: input ${n.inputNames[u]} has ${a[u].shape[0]}; expected  ${s} based on input ${n.inputNames[0]}.`);for(let u=0;u<i.length;u++)H(i[u].shape[0]===s,()=>`Batch size mismatch: output ${n.outputNames[u]} has ${i[u].shape[0]}; expected  ${s} based on input ${n.inputNames[0]}.`);return{xs:a,ys:i}}function rF(n,t,e){if(e instanceof pr)return[e];if(Array.isArray(e))return H(e.length===t.length,()=>`Received an array of ${e.length} Tensors, but expected ${t.length} to match the ${n} keys ${t}.`),e;{const r=[];for(const o of t){if(e[o]==null)throw new ot(`The feature data generated by the dataset lacks the required ${n} key '${o}'.`);r.push(e[o])}return r}}function Vwt(n){if(n.length===3)throw new Ie("Validation with sample weights is not implemented yet.");return{xs:n[0],ys:n[1]}}async function Gwt(n,t,e){const r=e.batchesPerEpoch!=null;if(H(n.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),H(e!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),H(e.epochs!=null&&e.epochs>0&&Number.isInteger(e.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${e.epochs}`),H(!r||e.batchesPerEpoch>0&&Number.isInteger(e.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${e.batchesPerEpoch}`),H(e.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),n.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");n.isTraining=!0;try{const o=e.validationData!=null;let a,i;if(o)if(oF(e.validationData))H(e.validationBatches==null||e.validationBatches>0&&Number.isInteger(e.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${e.validationBatches}`);else{const y=Vwt(e.validationData);a=y.xs,i=y.ys}const s=n.makeTrainFunction(),u=n.getDedupedMetricsNames();let l;o?l=u.slice().concat(u.map(y=>"val_"+y)):l=u.slice();const c=QW(e.callbacks,e.yieldEvery),h=e.verbose==null?1:e.verbose,{callbackList:d,history:p}=ZW(c,h,e.epochs,null,null,Hwt(t,e),null,o,l);d.setModel(n),n.history=p,await d.onTrainBegin(),n.stopTraining_=!1;let g=e.initialEpoch==null?0:e.initialEpoch,x=await t.iterator();for(;g<e.epochs;){const y={};await d.onEpochBegin(g);let b=0,C=0;for(r||(x=await t.iterator());!r||b<e.batchesPerEpoch;){const E=await x.next();if(r&&E.done){console.warn(`You provided \`batchesPerEpoch\` as ${e.batchesPerEpoch}, but your dataset iterator ran out of data after ${b} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${e.batchesPerEpoch*e.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(E.value!=null){const{xs:S,ys:k}=uV(n,E.value),R={};R.batch=C,R.size=S[0].shape[0],await d.onBatchBegin(C,R);const A=[];if(e.classWeight!=null){const $=iV(e.classWeight,n.outputNames);for(let D=0;D<$.length;++D)A.push(await sV(k[D],null,$[D]))}const N=S.concat(k).concat(A),_=s(N);Oe(N);for(let $=0;$<u.length;++$){const D=u[$],O=_[$];R[D]=O,Yi(O)}await d.onBatchEnd(C,R),YW(R),C++,b++}if(r?b>=e.batchesPerEpoch:E.done){if(o){let S;oF(e.validationData)?S=ln(await n.evaluateDataset(e.validationData,{batches:e.validationBatches})):S=ln(n.evaluate(a,i,{batchSize:e.validationBatchSize==null?Wwt:e.validationBatchSize,verbose:0}));for(let k=0;k<n.metricsNames.length;++k)y[`val_${n.metricsNames[k]}`]=S[k]}break}if(n.stopTraining_)break}if(await d.onEpochEnd(g,y),g++,n.stopTraining_)break}return await d.onTrainEnd(),await n.history.syncData(),n.history}finally{n.isTraining=!1}}function Hwt(n,t){let e=null;return t.batchesPerEpoch!=null?e=t.batchesPerEpoch:Number.isFinite(n.size)&&(e=n.size),e}function oF(n){return typeof n.iterator=="function"}function qwt(n){return typeof n.next=="function"}async function jwt(n,t,e){e=e||{};const r=e.batches!=null,o=n.testFunction;let a=[];if(e.verbose>0)throw new Ie("Verbose mode is not implemented yet.");H(!r||e.batches>0&&Number.isInteger(e.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(e.batches)}`);const i=qwt(t)?t:await t.iterator();let s=0,u=0;for(;!r||u<e.batches;){const l=await i.next();if(a=gt(()=>{if(l.value){const{xs:c,ys:h}=uV(n,l.value),d=c.concat(h),p=gt(()=>o(d));if(Oe(d),u===0)for(let x=0;x<p.length;++x)a.push(Je(0));const g=d[0].shape[0];for(let x=0;x<p.length;++x){const y=p[x],b=a[x];a[x]=gt(()=>Bt(a[x],it(g,y))),u>0&&Oe(b)}Oe(p),s+=g,++u}return a}),l.done){r&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${e.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let l=0;l<a.length;++l){const c=a[l];a[l]=fe(a[l],s),Oe(c)}return To(a)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function mS(n){H(n>0&&Number.isInteger(n),()=>`batchSize is required to be a positive integer, but got ${n}`)}function Fp(n,t,e){return n==null?[null]:Array.isArray(n)?n.map(r=>bc(r,t,e-t)):bc(n,t,e-t)}function jE(n,t){return gt(()=>n==null?null:Array.isArray(n)?n.map(e=>jE(e,t)):MW(n,t.dtype==="int32"?t:jt(t,"int32")))}function gS(n,t){const e=[];let r=0,o=null;for(;r<n;)o=r+t,o>=n&&(o=n),e.push([r,o]),r=o;return e}function lV(n){const t=[];n instanceof pr&&(n=[n]);for(let e=0;e<n.length;++e){const r=n[e];if(r.rank===1)t.push(Qg(r,1));else{if(r.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");t.push(r)}}return t}function ni(n,t){if(n==null)return;const e=[];if(t instanceof pr)e.push(t.id);else if(Array.isArray(t))t.forEach(o=>e.push(o.id));else if(t!=null)for(const o in t){const a=t[o];e.push(a.id)}const r=[];if(n instanceof pr)e.indexOf(n.id)===-1&&r.push(n);else if(Array.isArray(n))n.forEach(o=>{e.indexOf(o.id)===-1&&r.push(o)});else if(n!=null)for(const o in n){const a=n[o];e.indexOf(a.id)===-1&&r.push(a)}r.forEach(o=>{o.isDisposed||o.dispose()})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Xwt(n){return n instanceof pr}function XE(n){return Array.isArray(n)}function aF(n){return!Xwt(n)&&!XE(n)}function iF(n,t,e,r=!0,o=""){if(t==null||t.length===0){if(n!=null){let i=!1;if(XE(n)&&n.length>0)i=!0;else if(aF(n)){for(const s in n)if(n.hasOwnProperty(s)){i=!0;break}}else i=!0;if(i)throw new ot(`Error when checking model ${o} expected no data, but got ${n}`)}return[]}if(n==null)return t.map(i=>null);let a;if(aF(n)){n=n,a=[];for(const i of t){if(n[i]==null)throw new ot(`No data provided for "${i}". Need data for each key in: ${t}`);a.push(n[i])}}else if(XE(n)){if(n=n,n.length!==t.length)throw new ot(`Error when checking model ${o}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${t.length} Tensor(s), but instead got the following list of Tensor(s): ${n}`);a=n}else{if(n=n,t.length>1)throw new ot(`The model ${o} expects ${t.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${n.shape}`);a=[n]}if(a=lV(a),e!=null)for(let i=0;i<t.length;++i){if(e[i]==null)continue;const s=a[i];if(s.shape.length!==e[i].length)throw new ot(`Error when checking ${o}: expected ${t[i]} to have ${e[i].length} dimension(s). but got array with shape ${s.shape}`);for(let u=0;u<e[i].length;++u){if(u===0&&!r)continue;const l=s.shape[u],c=e[i][u];if(c!=null&&c>=0&&l!==c)throw new ot(`${o} expected a batch of elements where each example has shape [${e[i].slice(1,e[i].length)}] (i.e.,tensor shape [*,${e[i].slice(1,e[i].length)}]) but the ${o} received an input with ${s.shape[0]} examples, each with shape [${s.shape.slice(1,s.shape.length)}] (tensor shape [${s.shape}])`)}}return a}function Kwt(n,t,e){const r=tl(n.map(a=>a.shape[0]));r.sort();const o=tl(t.map(a=>a.shape[0]));if(o.sort(),r.length>1)throw new ot(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(n.map(a=>a.shape))}`);if(o.length>1)throw new ot(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(t.map(a=>a.shape))}`);if(r.length>0&&o.length>0&&!tn(r,o))throw new ot(`Input Tensors should have the same number of samples as target Tensors. Found ${r[0]} input sample(s) and ${o[0]} target sample(s).`)}function Ywt(n,t,e){const r=[Db,$b,dm];for(let o=0;o<n.length;++o){const a=n[o],i=t[o],s=e[o];if(i!=null){if(i===dm&&a.shape[a.shape.length-1]===1)throw new ot(`You are passing a target array of shape ${a.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(r.indexOf(i)!==-1){const u=a.shape.slice(1),l=s.slice(1);for(let c=0;c<u.length;++c){const h=u[c],d=l[c];if(d!=null&&h!==d)throw new ot(`A target Tensor with shape ${a.shape} was passed for an output of shape ${s}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function sF(n,t,e,r=!0,o=""){let a;if(Array.isArray(n)){if(n.length!==t.length)throw new ot(`Error when checking model ${o}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${t.length} Tensor(s), but instead got ${n.length} Tensors(s).`);a=n}else{if(t.length>1)throw new ot(`The model expects ${t.length} ${o} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(n.shape)}.`);a=[n]}if(e!=null)for(let i=0;i<t.length;++i){if(e[i]==null)continue;const s=a[i];if(s.shape.length!==e[i].length)throw new ot(`Error when checking ${o}: expected ${t[i]} to have ${e[i].length} dimension(s), but got array with shape ${JSON.stringify(s.shape)}`);for(let u=0;u<e[i].length;++u){if(u===0&&!r)continue;const l=s.shape[u],c=e[i][u];if(c!=null&&c!==l)throw new ot(`Error when checking ${o}: expected ${t[i]} to have shape ${JSON.stringify(e[i])} but got array with shape ${JSON.stringify(s.shape)}.`)}}}function Qwt(n,t){if(n==null||Array.isArray(n)&&n.length===0)return t.map(r=>[]);let e;if(typeof n=="string"||typeof n=="function")e=[n];else if(Array.isArray(n)||typeof n=="object")e=n;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${n}`);if(Array.isArray(e))return t.map(r=>e);{const r=[];for(const o of t){let a=e.hasOwnProperty(o)?e[o]:[];Array.isArray(a)||(a=[a]),r.push(a)}return r}}const Zwt="layers-model";class Tf extends ri{constructor(t){super(t),this.isTraining=!1}summary(t,e,r=console.log){if(!this.built)throw new ot("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");Owt(this,t,e,r)}compile(t){if(t.loss==null&&(t.loss=[]),this.loss=t.loss,typeof t.optimizer=="string")this.optimizer_=$wt(t.optimizer),this.isOptimizerOwned=!0;else{if(!(t.optimizer instanceof Il))throw new ot("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=t.optimizer,this.isOptimizerOwned=!1}let e=[];if(!Array.isArray(t.loss)&&typeof t.loss!="string"&&typeof t.loss!="function"){t.loss=t.loss;for(const i in t.loss)if(this.outputNames.indexOf(i)===-1)throw new ot(`Unknown entry in loss dictionary: "${i}". Only expected the following keys: ${this.outputNames}`);for(const i of this.outputNames)t.loss[i]==null&&console.warn(`Output "${i}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${i} during training`),e.push(pS(t.loss[i]))}else if(Array.isArray(t.loss)){if(t.loss.length!==this.outputs.length)throw new ot(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${t.loss}.`);e=t.loss.map(s=>pS(s))}else{const i=pS(t.loss);this.outputs.forEach(s=>{e.push(i)})}this.lossFunctions=e,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let i=0;i<this.outputs.length;++i){const s=this.internalOutputShapes[i],u=this.outputNames[i];this.feedOutputNames.push(u),this.feedOutputShapes.push(s),this.feedLossFns.push(this.lossFunctions[i])}const r=[];this.metrics=t.metrics,this.metricsNames=["loss"],this.metricsTensors=[],yc("loss",()=>{for(let i=0;i<this.outputs.length;++i){if(r.indexOf(i)!==-1)continue;const s=this.lossFunctions[i];this.outputs.length>1&&(this.metricsTensors.push([s,i]),this.metricsNames.push(this.outputNames[i]+"_loss"))}});const o=Qwt(t.metrics,this.outputNames),a=(i,s,u)=>{this.outputNames.length>1&&(s=this.outputNames[i]+"_"+s),this.metricsNames.push(s),this.metricsTensors.push([u,i])};yc("metric",()=>{for(let i=0;i<this.outputs.length;++i){if(r.indexOf(i)!==-1)continue;const s=o[i];(l=>{const c="";let h,d,p;for(const g of l){if(typeof g=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(g)!==-1){const y=this.internalOutputShapes[i];y[y.length-1]===1||this.lossFunctions[i]===$b?["accuracy","acc"].indexOf(g)!==-1?d=tV:["crossentropy","ce"].indexOf(g)!==-1&&(d=Swt):this.lossFunctions[i]===Dy?["accuracy","acc"].indexOf(g)!==-1?d=Ewt:["crossentropy","ce"].indexOf(g)!==-1&&(d=rV):["accuracy","acc"].indexOf(g)!==-1?d=eV:["crossentropy","ce"].indexOf(g)!==-1&&(d=nV);let b;["accuracy","acc"].indexOf(g)!==-1?b="acc":["crossentropy","ce"].indexOf(g)!==-1&&(b="ce"),p=d,h=c+b}else p=Dwt(g),h=c+Yx(g);let x;yc(h,()=>{x=p}),a(i,h,x)}})(s)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(t,e,r={}){const o=r.batchSize==null?32:r.batchSize;mS(o);const i=this.standardizeUserDataXY(t,e,!0,o);try{const s=i[0].concat(i[1]);this.makeTestFunction();const u=this.testFunction,l=this.testLoop(u,s,o,r.verbose,r.steps);return To(l)}finally{ni(i[0],t),ni(i[1],e)}}async evaluateDataset(t,e){return this.makeTestFunction(),jwt(this,t,e)}checkNumSamples(t,e,r,o="steps"){let a;if(r!=null){if(a=null,e!=null)throw new ot(`If ${o} is set, batchSize must be null or undefined.Got batchSize = ${e}`)}else if(t!=null)Array.isArray(t)?a=t[0].shape[0]:a=t.shape[0];else throw new ot(`Either the input data should have a defined shape, or ${o} shoud be specified.`);return a}execute(t,e){if(Array.isArray(e)&&e.length===0)throw new ot("`outputs` is an empty Array, which is not allowed.");const r=Array.isArray(e),o=r?e:[e],a=this.retrieveSymbolicTensors(o),i=new Xu;if(t instanceof pr&&(t=[t]),Array.isArray(t)){if(t.length!==this.inputs.length)throw new ot(`The number of inputs provided (${t.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let u=0;u<this.inputs.length;++u)i.add(this.inputs[u],t[u])}else for(const u of this.inputs){const l=t[u.name];if(l==null)throw new ot(`No value is provided for the model's input ${u.name}`);i.add(u,l)}const s=Vp(a,i);return r?s:s[0]}retrieveSymbolicTensors(t){const e=Mc(null,t.length);let r=t.length;for(const o of this.layers){const a=Array.isArray(o.output)?o.output:[o.output],i=a.map(s=>s.name);for(let s=0;s<t.length;++s){const u=i.indexOf(t[s]);if(u!==-1&&(e[s]=a[u],r--),r===0)break}if(r===0)break}if(r>0){const o=[];throw e.forEach((a,i)=>{a==null&&o.push(t[i])}),new ot(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(o)}`)}return e}predictLoop(t,e=32,r=!1){return gt(()=>{const o=this.checkNumSamples(t);if(r)throw new Ie("Verbose predictLoop() is not implemented yet.");const a=gS(o,e),i=this.outputs.map(s=>[]);for(let s=0;s<a.length;++s)gt(()=>{const l=a[s][0],c=a[s][1],h=Fp(t,l,c),d=[];if(Array.isArray(h))for(let g=0;g<h.length;++g)d.push({key:this.inputs[g],value:h[g]});else d.push({key:this.inputs[0],value:h});const p=new Xu(d);return Vp(this.outputs,p)}).forEach((l,c)=>i[c].push(l));return To(i.map(s=>No(s,0)))})}predict(t,e={}){const r=lV(t);sF(r,this.inputNames,this.feedInputShapes,!1);try{const o=e.batchSize==null?32:e.batchSize;return mS(o),this.predictLoop(r,o)}finally{ni(r,t)}}predictOnBatch(t){sF(t,this.inputNames,this.feedInputShapes,!0);const e=(Array.isArray(t)?t[0]:t).shape[0];return this.predictLoop(t,e)}standardizeUserDataXY(t,e,r=!0,o){if(this.optimizer_==null)throw new Ua("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const a=[];for(let i=0;i<this.feedOutputShapes.length;++i){const s=this.feedOutputShapes[i];this.feedLossFns[i]===Dy?a.push(s.slice(0,s.length-1).concat([1])):a.push(s)}if(t=iF(t,this.feedInputNames,this.feedInputShapes,!1,"input"),e=iF(e,this.feedOutputNames,a,!1,"target"),Kwt(t,e),Ywt(e,this.feedLossFns,this.feedOutputShapes),this.stateful&&o!=null&&o>0&&t[0].shape[0]%o!==0)throw new ot(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${o}. Found: ${t[0].shape[0]} sample(s).`);return[t,e]}async standardizeUserData(t,e,r,o,a=!0,i){const[s,u]=this.standardizeUserDataXY(t,e,a,i);if(r!=null)throw new Error("sample weight is not supported yet.");let l=null;if(o!=null){const c=iV(o,this.outputNames);l=[];for(let h=0;h<c.length;++h)l.push(await sV(u[h],null,c[h]))}return[s,u,l]}testLoop(t,e,r,o=0,a){return gt(()=>{const i=this.checkNumSamples(e,r,a,"steps"),s=[];if(o>0)throw new Ie("Verbose mode is not implemented yet.");if(a!=null)throw new Ie("steps mode in testLoop() is not implemented yet");{const u=gS(i,r),l=Go(xi(0,i));for(let c=0;c<u.length;++c){const h=u[c][0],d=u[c][1],p=bc(l,h,d-h),g=jE(e,p),x=t(g);if(c===0)for(let y=0;y<x.length;++y)s.push(Je(0));for(let y=0;y<x.length;++y){const b=x[y];s[y]=Bt(s[y],it(d-h,b))}}for(let c=0;c<s.length;++c)s[c]=fe(s[c],i)}return s})}getDedupedMetricsNames(){const t=this.metricsNames,e=[];for(let r=0;r<t.length;++r){const o=t[r];let a=o;if(H3(t,o)>1){const i=H3(t.slice(0,r),o);a+=`_${i}`}e.push(a)}return e}makeTrainFunction(){return t=>{const e=[],r=t.slice(0,this.inputs.length),o=t.slice(this.inputs.length,this.inputs.length+this.outputs.length),a=t.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),i=[],s=()=>{const h=[];for(let x=0;x<this.inputs.length;++x)h.push({key:this.inputs[x],value:r[x]});const d=new Xu(h),p=Vp(this.outputs,d,{training:!0});let g;for(let x=0;x<this.lossFunctions.length;++x){const y=this.lossFunctions[x];let b=y(o[x],p[x]);a[x]!=null&&(b=Uwt(b,a[x]));const C=sr(b);e.push(C),x===0?g=b:g=Bt(g,b)}for(let x=0;x<this.metricsTensors.length;++x){let y;if(this.outputs.length>1&&x<this.outputs.length)y=e[x];else{const b=this.metricsTensors[x][0],C=this.metricsTensors[x][1];y=sr(b(o[C],p[C]))}Yi(y),i.push(y)}return g=sr(g),this.calculateLosses().forEach(x=>{g=Bt(g,x)}),g},u=this.collectedTrainableWeights.map(h=>h.read());return[this.optimizer_.minimize(s,!0,u)].concat(i)}}makeTestFunction(){this.testFunction=t=>gt(()=>{const e=[];let r;const o=t.slice(0,this.inputs.length),a=t.slice(this.inputs.length,this.inputs.length+this.outputs.length),i=[];for(let l=0;l<this.inputs.length;++l)i.push({key:this.inputs[l],value:o[l]});const s=new Xu(i),u=Vp(this.outputs,s);for(let l=0;l<this.lossFunctions.length;++l){const c=this.lossFunctions[l],h=sr(c(a[l],u[l]));l===0?r=h:r=Bt(r,h),e.push(r)}for(let l=0;l<this.metricsTensors.length;++l){const c=this.metricsTensors[l][0],h=this.metricsTensors[l][1],d=sr(c(a[h],u[h]));e.push(d)}return e})}async fit(t,e,r={}){if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;let o,a,i,s,u,l,c,h,d;try{const p=r.batchSize==null?32:r.batchSize;mS(p);const x=await this.standardizeUserData(t,e,r.sampleWeight,r.classWeight,!1,p);o=x[0],a=x[1],d=x[2];let y=!1,b;if(r.validationData!=null&&r.validationData.length>0){if(y=!0,r.validationData.length===2)u=r.validationData[0],l=r.validationData[1];else throw r.validationData.length===3?new Ie("validationData including sample weights is not supported yet."):new ot(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${r.validationData} is invalid.`);const $=await this.standardizeUserData(u,l,null,null,!0,p);c=$[0],h=$[1],b=c.concat(h)}else if(r.validationSplit!=null&&r.validationSplit>0&&r.validationSplit<1){y=!0;const _=Math.floor(o[0].shape[0]*(1-r.validationSplit)),$=o[0].shape[0];c=Fp(o,_,$),i=o,o=Fp(o,0,_),h=Fp(a,_,$),s=a,a=Fp(a,0,_),b=c.concat(h)}else r.validationSteps!=null&&(y=!0);const C=o.concat(a).concat(d);this.checkTrainableWeightsConsistency();const E=this.makeTrainFunction(),S=this.getDedupedMetricsNames();let k,R;y?(this.makeTestFunction(),k=this.testFunction,R=S.slice().concat(S.map(_=>"val_"+_))):(k=null,b=[],R=S.slice());const A=QW(r.callbacks,r.yieldEvery);return await this.fitLoop(E,C,S,p,r.epochs,r.verbose,A,k,b,r.shuffle,R,r.initialEpoch,null,null)}finally{this.isTraining=!1,ni(o,t),ni(a,e),ni(i,t),ni(s,e),ni(c,u),ni(h,l),d!=null&&Oe(d)}}async fitLoop(t,e,r,o,a,i,s,u,l,c,h,d,p,g){o==null&&(o=32),a==null&&(a=1),c==null&&(c=!0),d==null&&(d=0);let x=!1;if(u!=null&&l!=null&&(x=!0),g!=null&&(x=!0,p==null))throw new ot("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const y=this.checkNumSamples(e,o,p,"steps_per_epoch");let b;y!=null&&(b=xi(0,y)),i==null&&(i=1);const{callbackList:C,history:E}=ZW(s,i,a,d,y,p,o,x,h);C.setModel(this),this.history=E,await C.onTrainBegin(),this.stopTraining_=!1;for(let S=d;S<a;++S){await C.onEpochBegin(S);const k={};if(p!=null)throw new Ie("stepsPerEpoch mode is not implemented yet.");{if(c==="batch")throw new Ie("batch shuffling is not implemneted yet");c&&Fdt(b);const R=Go(b),A=gS(y,o);for(let N=0;N<A.length;++N){const _={};if(await C.onBatchBegin(N,_),gt(()=>{const $=A[N][0],D=A[N][1],O=bc(R,$,D-$);_.batch=N,_.size=D-$;const P=jE(e,O),z=t(P);for(let W=0;W<r.length;++W){const F=r[W],B=z[W];_[F]=B,Yi(B)}if(N===A.length-1&&x){const W=this.testLoop(u,l,o);for(let F=0;F<r.length;++F){const B=r[F],U=W[F];Yi(U),k["val_"+B]=U}}}),await C.onBatchEnd(N,_),YW(_),this.stopTraining_)break}R.dispose()}if(await C.onEpochEnd(S,k),this.stopTraining_)break}return await C.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(t,e){return Gwt(this,t,e)}async trainOnBatch(t,e){const r=await this.standardizeUserData(t,e),o=r[0],a=r[1],s=this.makeTrainFunction()(o.concat(a)),u=[];for(const l of s){const c=await l.data();u.push(c[0])}return Oe(s),ni(r[0],t),ni(r[1],e),To(u)}getNamedWeights(t){const e=[],r=t!=null&&t.trainableOnly,o=r?this.trainableWeights:this.weights,a=this.getWeights(r);for(let i=0;i<o.length;++i)r&&!o[i].trainable||e.push({name:o[i].originalName,tensor:a[i]});return e}set stopTraining(t){this.stopTraining_=t}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(t){this.optimizer_!==t&&(this.optimizer_=t,this.isOptimizerOwned=!1)}dispose(){const t=super.dispose();if(t.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){const e=y3().numTensors;this.optimizer_.dispose(),t.numDisposedVariables+=e-y3().numTensors}return t}getLossIdentifiers(){let t;if(typeof this.loss=="string")t=Ps(this.loss);else if(Array.isArray(this.loss)){for(const e of this.loss)if(typeof e!="string")throw new Error("Serialization of non-string loss is not supported.");t=this.loss.map(e=>Ps(e))}else{const e=Object.keys(this.loss);t={};const r=this.loss;for(const o of e)if(typeof r[o]=="string")t[o]=Ps(r[o]);else throw new Error("Serialization of non-string loss is not supported.")}return t}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[Ps(Yx(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(t=>Ps(Yx(t)));{const t={};for(const e in this.metrics)t[e]=Ps(Yx(this.metrics[e]));return t}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(t){if(t.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(t.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(t.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");const e=HE(t.optimizer_config),r=qs(e);let o;if(typeof t.loss=="string")o=ac(t.loss);else if(Array.isArray(t.loss))o=t.loss.map(i=>ac(i));else if(t.loss!=null){o={};for(const i in t.loss)o[i]=ac(t.loss[i])}let a;if(Array.isArray(t.metrics))a=t.metrics.map(i=>ac(i));else if(t.metrics!=null){a={};for(const i in t.metrics)a[i]=ac(t.metrics[i])}this.compile({loss:o,metrics:a,optimizer:r})}async save(t,e){if(typeof t=="string"){const l=_pt(t);if(l.length===0)throw new ot(`Cannot find any save handlers for URL '${t}'`);if(l.length>1)throw new ot(`Found more than one (${l.length}) save handlers for URL '${t}'`);t=l[0]}if(t.save==null)throw new ot("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const r=await w3(this.getNamedWeights(e)),s={modelTopology:this.toJSON(null,!1),format:Zwt,generatedBy:`TensorFlow.js tfjs-layers v${aV}`,convertedBy:null};if((e==null?!1:e.includeOptimizer)&&this.optimizer!=null){s.trainingConfig=this.getTrainingConfig();const l="optimizer",{data:c,specs:h}=await w3(await this.optimizer.getWeights(),l);r.specs.push(...h),r.data=Apt([r.data,c])}return this.userDefinedMetadata!=null&&(nF(this.userDefinedMetadata,this.name,!0),s.userDefinedMetadata=this.userDefinedMetadata),s.weightData=r.data,s.weightSpecs=r.specs,t.save(s)}setUserDefinedMetadata(t){nF(t,this.name),this.userDefinedMetadata=t}getUserDefinedMetadata(){return this.userDefinedMetadata}}Tf.className="Model";Lt(Tf);class cV extends Tf{}cV.className="Functional";Lt(cV);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class pm extends Tf{constructor(t){if(super({inputs:[],outputs:[]}),t=t||{},this.trainable=!0,this.built=!1,this.name=t.name!=null?t.name:Nb("sequential_"),t.layers!=null)for(const e of t.layers)this.add(e)}checkShape(t){if(t.inboundNodes[0].outputTensors[0].shape.some(r=>r<0))throw new ot(`Negative dimension size caused by adding layer ${t.name} with input shape [${t.inboundNodes[0].inputTensors[0].shape}]`)}add(t){const e=t instanceof pm||t instanceof Tf;let r;if(e){if(r=t,r.outputs.length!==1)throw new ot("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(r.inputs.length!==1)throw new ot("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(t.inboundNodes.length===0){if(t.batchInputShape==null)throw new ot("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const o=twt({batchShape:t.batchInputShape,dtype:t.dtype,name:t.name+"_input"});t.apply(o)}if(e)this.outputs=r.outputs,this.inputs=r.inputs;else{if(t.inboundNodes.length!==1)throw new ot(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${t.name} which has ${t.inboundNodes.length} pre-existing inbound connections.`);if(t.inboundNodes[0].outputTensors.length!==1)throw new ot("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[t.inboundNodes[0].outputTensors[0]],this.inputs=HW(this.outputs[0])}this.inboundNodes=[],new _b({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:Mc(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(o=>o.shape),outputShapes:this.outputs[0].shape})}else{const o=t.apply(this.outputs[0]);if(Array.isArray(o))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[o],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(t),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const t=this.layers.length-1;this.layers[t].outboundNodes=[],this.outputs=[this.layers[t].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(t,e){return this.model==null&&this.build(),this.model.call(t,e)}build(t){if(Xe(t),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new Tf({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(t,e,r=console.log){this.built||this.build(),super.summary(t,e,r)}setWeights(t){this.model==null&&this.build(),this.model.setWeights(t)}evaluate(t,e,r={}){if(!this.built)throw new Ua("The model needs to be compiled before being used.");return this.model.evaluate(t,e,r)}async evaluateDataset(t,e){if(!this.built)throw new Ua("The model needs to be compiled before being used.");return this.model.evaluateDataset(t,e)}predict(t,e={}){return this.model==null&&this.build(),this.model.predict(t,e)}predictOnBatch(t){return this.model==null&&this.build(),this.model.predictOnBatch(t)}compile(t){this.build(),this.model.compile(t),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(t){this.model.optimizer=t}async fit(t,e,r={}){if(!this.built)throw new Ua("The model needs to be compiled before being used.");return this.model.fit(t,e,r)}async fitDataset(t,e){if(!this.built)throw new Ua("The model needs to be compiled before being used.");return this.model.fitDataset(t,e)}async trainOnBatch(t,e){return this.model.trainOnBatch(t,e)}static fromConfig(t,e,r={},o=!1){let a,i={};if(e instanceof Array){if(e[0].className==null||e[0].className==="Merge")throw new ot("Legacy serialization format not supported yet.");a=e}else H(e.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),a=e.layers,delete e.layers,i=e;const s=new t(i);if(!(s instanceof pm))throw new Ie(`Sequential.fromConfig called on non-Sequential input: ${s}`);for(const u of a){const c=qs(u,void 0,o);o&&c.setFastWeightInitDuringBuild(!0),s.add(c)}return s}set stopTraining(t){if(this.model==null)throw new ot("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=t}get stopTraining(){if(this.model==null)throw new ot("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const t=[];for(const e of this.layers){const r={};r.className=e.getClassName(),r.config=e.getConfig(),t.push(r)}return{name:this.name,layers:t}}}pm.className="Sequential";Lt(pm);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let oo=class extends gd{getConfig(){return{}}};class hV extends oo{apply(t,e=1){return Pbt(t,e)}}hV.className="elu";Lt(hV);class fV extends oo{apply(t){return NU(t)}}fV.className="selu";Lt(fV);class dV extends oo{apply(t){return nh(t)}}dV.className="relu";Lt(dV);class pV extends oo{apply(t){return gt(()=>cm(6,nh(t)))}}pV.className="relu6";Lt(pV);class mV extends oo{apply(t){return t}}mV.className="linear";Lt(mV);class gV extends oo{apply(t){return dd(t)}}gV.className="sigmoid";Lt(gV);class vV extends oo{apply(t){return zbt(t)}}vV.className="hardSigmoid";Lt(vV);class xV extends oo{apply(t){return Vg(t)}}xV.className="softplus";Lt(xV);class yV extends oo{apply(t){return Bbt(t)}}yV.className="softsign";Lt(yV);class bV extends oo{apply(t){return yb(t)}}bV.className="tanh";Lt(bV);let qT=class extends oo{apply(t,e=-1){return KR(t,e)}};qT.className="softmax";Lt(qT);class wV extends oo{apply(t,e=-1){return bU(t,e)}}wV.className="logSoftmax";Lt(wV);class CV extends oo{apply(t){return gt(()=>gt(()=>{const e=Math.sqrt(2),r=it(.5,Bt(1,mU(fe(t,e))));return it(t,r)}))}}CV.className="gelu";Lt(CV);class SV extends oo{apply(t){return gt(()=>it(.5,it(t,Bt(1,yb(it(eo(fe(2,Math.PI)),Bt(t,it(.044715,$c(t,3)))))))))}}SV.className="gelu_new";Lt(SV);class EV extends oo{apply(t){return gt(()=>it(t,yb(Vg(t))))}}EV.className="mish";Lt(EV);class kV extends oo{apply(t,e=1){return gt(()=>it(dd(it(t,e)),t))}}kV.className="swish";Lt(kV);function ll(n){return n.getClassName()}function vS(n,t={}){return Yg(n,Ba.getMap().classNameMap,t,"activation")}function cl(n){if(n==null){const t={};return t.className="linear",t.config={},vS(t)}if(typeof n=="string"){const t={};return t.className=n,t.config={},vS(t)}else return n instanceof oo?n:vS(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Jwt(n){if(n!=null&&typeof n!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${n}`)}class IV extends gd{}class RV extends IV{constructor(t){super(),Jwt(t),this.l1=t==null||t.l1==null?.01:t.l1,this.l2=t==null||t.l2==null?.01:t.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(t){return gt(()=>{let e=Rr([1]);return this.hasL1&&(e=Bt(e,ce(it(this.l1,fo(t))))),this.hasL2&&(e=Bt(e,ce(it(this.l2,Zg(t))))),ht(e,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(t,e){return new t({l1:e.l1,l2:e.l2})}}RV.className="L1L2";Lt(RV);const uF={l1l2:"L1L2"};function yn(n){return DT(n)}function lF(n,t={}){return Yg(n,Ba.getMap().classNameMap,t,"regularizer")}function On(n){if(n==null)return null;if(typeof n=="string"){const e={className:n in uF?uF[n]:n,config:{}};return lF(e)}else return n instanceof IV?n:lF(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class TV extends De{constructor(t){super(t??{}),this.supportsMasking=!0,t!=null&&(this.maxValue=t.maxValue)}call(t,e){t=xe(t);let r=nh(t);return this.maxValue!=null&&(r=wa(r,0,this.maxValue)),r}computeOutputShape(t){return t}getConfig(){const t={maxValue:this.maxValue},e=super.getConfig();return Object.assign(t,e),t}}TV.className="ReLU";Lt(TV);class NV extends De{constructor(t){super(t??{}),this.DEFAULT_ALPHA=.3,t==null&&(t={}),this.alpha=t.alpha==null?this.DEFAULT_ALPHA:t.alpha}call(t,e){const r=xe(t);return BR(r,this.alpha)}computeOutputShape(t){return t}getConfig(){const t={alpha:this.alpha},e=super.getConfig();return Object.assign(t,e),t}}NV.className="LeakyReLU";Lt(NV);class AV extends De{constructor(t){if(super(t??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",t==null&&(t={}),this.supportsMasking=!0,this.alphaInitializer=$n(t.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=On(t.alphaRegularizer),this.alphaConstraint=yr(t.alphaConstraint),t.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(t.sharedAxes))this.sharedAxes=t.sharedAxes;else if(typeof t.sharedAxes=="number")this.sharedAxes=[t.sharedAxes];else throw new ot(`Expected sharedAxes to be a number or an array of numbers, but got ${t.sharedAxes}`)}build(t){t=Xe(t);const e=t.slice(1);if(this.sharedAxes!=null)for(const o of this.sharedAxes)e[o-1]=1;this.alpha=this.addWeight("alpha",e,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const r={};if(this.sharedAxes!=null)for(let o=1;o<t.length;++o)r[o]=t[o];this.inputSpec=[new vr({ndim:t.length,axes:r})],this.built=!0}call(t,e){return t=xe(t),HR(t,this.alpha.read())}getConfig(){const t={alphaInitializer:Ln(this.alphaInitializer),alphaRegularizer:yn(this.alphaRegularizer),alphaConstraint:xr(this.alphaConstraint),sharedAxes:this.sharedAxes},e=super.getConfig();return Object.assign(t,e),t}}AV.className="PReLU";Lt(AV);let _V=class extends De{constructor(t){if(super(t??{}),this.DEFAULT_ALPHA=1,t==null&&(t={}),t.alpha!=null&&t.alpha!==this.DEFAULT_ALPHA)throw new Ie(`Non-default alpha value (${t.alpha}) is not supported by the ELU layer yet.`);this.alpha=t.alpha==null?this.DEFAULT_ALPHA:t.alpha}call(t,e){const r=xe(t);return Cb(r)}computeOutputShape(t){return t}getConfig(){const t={alpha:this.alpha},e=super.getConfig();return Object.assign(t,e),t}};_V.className="ELU";Lt(_V);class DV extends De{constructor(t){super(t??{}),this.DEFAULT_THETA=1,t==null&&(t={}),this.theta=t.theta==null?this.DEFAULT_THETA:t.theta}call(t,e){const r=xe(t);return it(r,jt(Ca(r,this.theta),"float32"))}computeOutputShape(t){return t}getConfig(){const t={theta:this.theta},e=super.getConfig();return Object.assign(t,e),t}}DV.className="ThresholdedReLU";Lt(DV);class $V extends De{constructor(t){super(t??{}),this.DEFAULT_AXIS=1,t==null&&(t={}),this.softmax=new qT().apply,this.axis=t.axis==null?this.DEFAULT_AXIS:t.axis}call(t,e){return gt(()=>{let r=xe(t);const o=e.mask;if(o!=null){const a=it(me(kl(r.shape),jt(o,r.dtype)),Je(-1e9));r=Bt(r,a)}return this.axis instanceof Array?this.axis.length>1?as(me(r,wU(r,this.axis,!0))):this.softmax(r,this.axis[0]):this.softmax(r,this.axis)})}computeOutputShape(t){return t}getConfig(){const t={axis:this.axis},e=super.getConfig();return Object.assign(t,e),t}}$V.className="Softmax";Lt($V);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Nf(n,t,e){if(typeof n=="number")return Mc(n,t);if(n.length!==t)throw new ot(`The ${e} argument must be an integer or tuple of ${t} integers. Received: ${n.length} elements.`);for(let r=0;r<t;++r){const o=n[r];if(!Obt(o))throw new ot(`The ${e} argument must be an integer or tuple of ${t} integers. Received: ${JSON.stringify(n)} including a non-integer number ${o}`)}return n}function gi(n,t,e,r,o=1){if(n==null)return n;const a=t+(t-1)*(o-1);let i;return e==="same"?i=n:i=n-a+1,Math.floor((i+r-1)/r)}function Ui(n,t,e,r){if(n==null)return null;if(r==="valid")n=n*t+ul([e-t,0]);else if(r==="same")n=n*t;else throw new ot(`Unsupport padding mode: ${r}.`);return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function jT(n,t){return gt(()=>(nr(t),t==="channelsFirst"?Ue(n,[0,2,3,1]):n))}function OV(n,t){return gt(()=>(nr(t),t==="channelsFirst"?Ue(n,[0,2,3,4,1]):n))}function t2t(n,t,e,r=1,o="valid",a,i=1){return gt(()=>{if(a==null&&(a=yi()),nr(a),n.shape.length!==3)throw new ot(`The input of a conv1dWithBias operation should be 3, but is ${n.shape.length} instead.`);if(t.shape.length!==3)throw new ot(`The kernel for a conv1dWithBias operation should be 3, but is ${t.shape.length} instead`);if(e!=null&&e.shape.length!==1)throw new ot(`The bias for a conv1dWithBias operation should be 1, but is ${e.shape.length} instead`);if(a==="channelsFirst"&&(n=Ue(n,[0,2,1])),o==="causal")throw new Ie("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let s=cU(n,t,r,o==="same"?"same":"valid","NWC",i);return e!=null&&(s=Si(s,e)),s})}function cF(n,t,e,r=[1,1],o="valid",a,i,s=null){return gt(()=>{if(a==null&&(a=yi()),nr(a),n.rank!==3&&n.rank!==4)throw new ot(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${n.rank}.`);if(t.rank!==3&&t.rank!==4)throw new ot(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${n.rank}.`);let u=jT(n,a);if(o==="causal")throw new Ie("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return u=l0t({x:u,filter:t,strides:r,pad:o==="same"?"same":"valid",dilations:i,dataFormat:"NHWC",bias:e,activation:s}),a==="channelsFirst"&&(u=Ue(u,[0,3,1,2])),u})}function e2t(n,t,e,r=[1,1,1],o="valid",a,i){return gt(()=>{if(a==null&&(a=yi()),nr(a),n.rank!==4&&n.rank!==5)throw new ot(`conv3dWithBias expects input to be of rank 4 or 5, but received ${n.rank}.`);if(t.rank!==4&&t.rank!==5)throw new ot(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${n.rank}.`);let s=OV(n,a);if(o==="causal")throw new Ie("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return s=sgt(s,t,r,o==="same"?"same":"valid","NDHWC",i),e!=null&&(s=Si(s,e)),a==="channelsFirst"&&(s=Ue(s,[0,4,1,2,3])),s})}class Ob extends De{constructor(t,e){if(super(e),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",Ob.verifyArgs(e),this.rank=t,Tr(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new Ie(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=Nf(e.kernelSize,t,"kernelSize"),this.strides=Nf(e.strides==null?1:e.strides,t,"strides"),this.padding=e.padding==null?"valid":e.padding,Sa(this.padding),this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,nr(this.dataFormat),this.activation=cl(e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.biasInitializer=$n(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=yr(e.biasConstraint),this.biasRegularizer=On(e.biasRegularizer),this.activityRegularizer=On(e.activityRegularizer),this.dilationRate=Nf(e.dilationRate==null?1:e.dilationRate,t,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new ot(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new ot(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new ot(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(t){if(zi("kernelSize"in t,"required key 'kernelSize' not in config"),typeof t.kernelSize!="number"&&!$T(t.kernelSize,"number",1,3))throw new ot(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(t.kernelSize)}.`)}getConfig(){const t={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:ll(this.activation),useBias:this.useBias,biasInitializer:Ln(this.biasInitializer),biasRegularizer:yn(this.biasRegularizer),activityRegularizer:yn(this.activityRegularizer),biasConstraint:xr(this.biasConstraint)},e=super.getConfig();return Object.assign(t,e),t}}class vd extends Ob{constructor(t,e){super(t,e),this.kernel=null,vd.verifyArgs(e),this.filters=e.filters,Tr(this.filters,"filters"),this.kernelInitializer=$n(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=yr(e.kernelConstraint),this.kernelRegularizer=On(e.kernelRegularizer)}build(t){t=Xe(t);const e=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[e]==null)throw new ot(`The channel dimension of the input should be defined. Found ${t[e]}`);const r=t[e],o=this.kernelSize.concat([r,this.filters]);this.kernel=this.addWeight("kernel",o,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[e]:r}}],this.built=!0}call(t,e){return gt(()=>{t=xe(t);let r;const o=this.bias==null?null:this.bias.read(),a=AW(this.activation.getClassName());if(a!=null&&this.rank===2)r=cF(t,this.kernel.read(),o,this.strides,this.padding,this.dataFormat,this.dilationRate,a);else{if(this.rank===1)r=t2t(t,this.kernel.read(),o,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)r=cF(t,this.kernel.read(),o,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)r=e2t(t,this.kernel.read(),o,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new Ie("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(r=this.activation.apply(r))}return r})}computeOutputShape(t){t=Xe(t);const e=[],r=this.dataFormat==="channelsLast"?t.slice(1,t.length-1):t.slice(2);for(let a=0;a<r.length;++a){const i=gi(r[a],this.kernelSize[a],this.padding,this.strides[a],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[a]);e.push(i)}let o=[t[0]];return this.dataFormat==="channelsLast"?(o=o.concat(e),o.push(this.filters)):(o.push(this.filters),o=o.concat(e)),o}getConfig(){const t={filters:this.filters,kernelInitializer:Ln(this.kernelInitializer),kernelRegularizer:yn(this.kernelRegularizer),kernelConstraint:xr(this.kernelConstraint)},e=super.getConfig();return Object.assign(t,e),t}static verifyArgs(t){if(!("filters"in t)||typeof t.filters!="number"||t.filters<1)throw new ot(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(t.filters)}`)}}class nv extends vd{constructor(t){super(2,t),nv.verifyArgs(t)}getConfig(){const t=super.getConfig();return delete t.rank,t}static verifyArgs(t){if(typeof t.kernelSize!="number"&&!$T(t.kernelSize,"number",1,2))throw new ot(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(t.kernelSize)}.`)}}nv.className="Conv2D";Lt(nv);class rv extends vd{constructor(t){super(3,t),rv.verifyArgs(t)}getConfig(){const t=super.getConfig();return delete t.rank,t}static verifyArgs(t){if(typeof t.kernelSize!="number"&&!(Array.isArray(t.kernelSize)&&(t.kernelSize.length===1||t.kernelSize.length===3)))throw new ot(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(t.kernelSize)}.`)}}rv.className="Conv3D";Lt(rv);class FV extends nv{constructor(t){if(super(t),this.inputSpec=[new vr({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new ot(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(t){if(t=Xe(t),t.length!==4)throw new ot("Input should have rank 4; Received input shape: "+JSON.stringify(t));const e=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[e]==null)throw new ot("The channel dimension of the inputs should be defined. Found `None`.");const r=t[e],o=this.kernelSize.concat([this.filters,r]);this.kernel=this.addWeight("kernel",o,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new vr({ndim:4,axes:{[e]:r}})],this.built=!0}call(t,e){return gt(()=>{let r=xe(t);if(r.shape.length!==4)throw new ot(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${r.shape.length}`);const o=r.shape,a=o[0];let i,s;this.dataFormat==="channelsFirst"?(i=2,s=3):(i=1,s=2);const u=o[i],l=o[s],c=this.kernelSize[0],h=this.kernelSize[1],d=this.strides[0],p=this.strides[1],g=Ui(u,d,c,this.padding),x=Ui(l,p,h,this.padding),y=[a,g,x,this.filters];this.dataFormat!=="channelsLast"&&(r=Ue(r,[0,2,3,1]));let b=hU(r,this.kernel.read(),y,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(b=Ue(b,[0,3,1,2])),this.bias!=null&&(b=Si(b,this.bias.read(),this.dataFormat)),this.activation!=null&&(b=this.activation.apply(b)),b})}computeOutputShape(t){t=Xe(t);const e=t.slice();let r,o,a;this.dataFormat==="channelsFirst"?(r=1,o=2,a=3):(r=3,o=1,a=2);const i=this.kernelSize[0],s=this.kernelSize[1],u=this.strides[0],l=this.strides[1];return e[r]=this.filters,e[o]=Ui(e[o],u,i,this.padding),e[a]=Ui(e[a],l,s,this.padding),e}getConfig(){const t=super.getConfig();return delete t.dilationRate,t}}FV.className="Conv2DTranspose";Lt(FV);class MV extends rv{constructor(t){if(super(t),this.inputSpec=[new vr({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new ot(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(t){if(t=Xe(t),t.length!==5)throw new ot("Input should have rank 5; Received input shape: "+JSON.stringify(t));const e=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[e]==null)throw new ot("The channel dimension of the inputs should be defined. Found `None`.");const r=t[e],o=this.kernelSize.concat([this.filters,r]);this.kernel=this.addWeight("kernel",o,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new vr({ndim:5,axes:{[e]:r}})],this.built=!0}call(t,e){return gt(()=>{let r=xe(t);if(r.shape.length!==5)throw new ot(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${r.shape.length}`);const o=r.shape,a=o[0];let i,s,u;this.dataFormat==="channelsFirst"?(u=2,i=3,s=4):(u=1,i=2,s=3);const l=o[u],c=o[i],h=o[s],d=this.kernelSize[0],p=this.kernelSize[1],g=this.kernelSize[2],x=this.strides[0],y=this.strides[1],b=this.strides[2],C=Ui(l,x,d,this.padding),E=Ui(c,y,p,this.padding),S=Ui(h,b,g,this.padding),k=[a,C,E,S,this.filters];this.dataFormat!=="channelsLast"&&(r=Ue(r,[0,2,3,4,1]));let R=cgt(r,this.kernel.read(),k,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(R=Ue(R,[0,4,1,2,3])),this.bias!==null&&(R=Si(R,this.bias.read(),this.dataFormat)),this.activation!==null&&(R=this.activation.apply(R)),R})}computeOutputShape(t){t=Xe(t);const e=t.slice();let r,o,a,i;this.dataFormat==="channelsFirst"?(r=1,o=2,a=3,i=4):(r=4,o=1,a=2,i=3);const s=this.kernelSize[0],u=this.kernelSize[1],l=this.kernelSize[2],c=this.strides[0],h=this.strides[1],d=this.strides[2];return e[r]=this.filters,e[o]=Ui(e[o],c,s,this.padding),e[a]=Ui(e[a],h,u,this.padding),e[i]=Ui(e[i],d,l,this.padding),e}getConfig(){const t=super.getConfig();return delete t.dilationRate,t}}MV.className="Conv3DTranspose";Lt(MV);class LV extends vd{constructor(t,e){if(super(t,e),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,e.filters==null)throw new ot("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(e.kernelInitializer!=null||e.kernelRegularizer!=null||e.kernelConstraint!=null)throw new ot("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(e.padding!=null&&e.padding!=="same"&&e.padding!=="valid")throw new ot(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(e.padding)}`);this.depthMultiplier=e.depthMultiplier==null?1:e.depthMultiplier,this.depthwiseInitializer=$n(e.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=On(e.depthwiseRegularizer),this.depthwiseConstraint=yr(e.depthwiseConstraint),this.pointwiseInitializer=$n(e.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=On(e.pointwiseRegularizer),this.pointwiseConstraint=yr(e.pointwiseConstraint)}build(t){if(t=Xe(t),t.length<this.rank+2)throw new ot(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(t)}`);const e=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[e]==null||t[e]<0)throw new ot(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(t[e])}`);const r=t[e],o=this.kernelSize.concat([r,this.depthMultiplier]),a=[];for(let s=0;s<this.rank;++s)a.push(1);a.push(r*this.depthMultiplier,this.filters);const i=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",o,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,i,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",a,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,i,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,i,this.biasConstraint):this.bias=null,this.inputSpec=[new vr({ndim:this.rank+2,axes:{[e]:r}})],this.built=!0}call(t,e){return gt(()=>{t=xe(t);let r;if(this.rank===1)throw new Ie("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(t=Ue(t,[0,2,3,1])),r=AU(t,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(r=Si(r,this.bias.read(),this.dataFormat)),this.activation!=null&&(r=this.activation.apply(r)),this.dataFormat==="channelsFirst"&&(r=Ue(r,[0,3,1,2])),r})}getConfig(){const t=super.getConfig();return delete t.rank,delete t.kernelInitializer,delete t.kernelRegularizer,delete t.kernelConstraint,t.depthwiseInitializer=Ln(this.depthwiseInitializer),t.pointwiseInitializer=Ln(this.pointwiseInitializer),t.depthwiseRegularizer=yn(this.depthwiseRegularizer),t.pointwiseRegularizer=yn(this.pointwiseRegularizer),t.depthwiseConstraint=xr(this.depthwiseConstraint),t.pointwiseConstraint=xr(this.pointwiseConstraint),t}}LV.className="SeparableConv";class PV extends LV{constructor(t){super(2,t)}}PV.className="SeparableConv2D";Lt(PV);class Fb extends vd{constructor(t){super(1,t),Fb.verifyArgs(t),this.inputSpec=[{ndim:3}]}getConfig(){const t=super.getConfig();return delete t.rank,delete t.dataFormat,t}static verifyArgs(t){if(typeof t.kernelSize!="number"&&!$T(t.kernelSize,"number",1,1))throw new ot(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(t.kernelSize)}.`)}}Fb.className="Conv1D";Lt(Fb);class BV extends De{constructor(t){super(t),typeof t.cropping=="number"?this.cropping=[[t.cropping,t.cropping],[t.cropping,t.cropping]]:typeof t.cropping[0]=="number"?this.cropping=[[t.cropping[0],t.cropping[0]],[t.cropping[1],t.cropping[1]]]:this.cropping=t.cropping,this.dataFormat=t.dataFormat===void 0?"channelsLast":t.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(t){return this.dataFormat==="channelsFirst"?[t[0],t[1],t[2]-this.cropping[0][0]-this.cropping[0][1],t[3]-this.cropping[1][0]-this.cropping[1][1]]:[t[0],t[1]-this.cropping[0][0]-this.cropping[0][1],t[2]-this.cropping[1][0]-this.cropping[1][1],t[3]]}call(t,e){return gt(()=>{if(t=xe(t),this.dataFormat==="channelsLast"){const r=Kx(t,this.cropping[0][0],t.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return Kx(r,this.cropping[1][0],t.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{const r=Kx(t,this.cropping[0][0],t.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return Kx(r,this.cropping[1][0],t.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){const t={cropping:this.cropping,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}BV.className="Cropping2D";Lt(BV);class zV extends De{constructor(t){super(t),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=t.size==null?this.DEFAULT_SIZE:t.size,this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,nr(this.dataFormat),this.interpolation=t.interpolation==null?"nearest":t.interpolation,_bt(this.interpolation)}computeOutputShape(t){if(this.dataFormat==="channelsFirst"){const e=t[2]==null?null:this.size[0]*t[2],r=t[3]==null?null:this.size[1]*t[3];return[t[0],t[1],e,r]}else{const e=t[1]==null?null:this.size[0]*t[1],r=t[2]==null?null:this.size[1]*t[2];return[t[0],e,r,t[3]]}}call(t,e){return gt(()=>{let r=xe(t);const o=r.shape;if(this.dataFormat==="channelsFirst"){r=Ue(r,[0,2,3,1]);const a=this.size[0]*o[2],i=this.size[1]*o[3],s=this.interpolation==="nearest"?Gs.resizeNearestNeighbor(r,[a,i]):Gs.resizeBilinear(r,[a,i]);return Ue(s,[0,3,1,2])}else{const a=this.size[0]*o[1],i=this.size[1]*o[2];return this.interpolation==="nearest"?Gs.resizeNearestNeighbor(r,[a,i]):Gs.resizeBilinear(r,[a,i])}})}getConfig(){const t={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},e=super.getConfig();return Object.assign(t,e),t}}zV.className="UpSampling2D";Lt(zV);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function n2t(n,t,e=[1,1],r="valid",o,a){return gt(()=>{o==null&&(o=yi()),nr(o);let i=jT(n,o);if(n.rank!==4)throw new ot(`Input for depthwiseConv2d is required to be 4-D, but is instead ${n.rank}-D`);if(t.rank!==4)throw new ot(`depthwiseKernel is required to be 4-D, but is instead ${t.rank}-D`);return i=FR(i,t,e,r==="same"?"same":"valid","NHWC",a),o==="channelsFirst"&&(i=Ue(i,[0,3,1,2])),i})}class UV extends Ob{constructor(t){super(2,t),this.depthwiseKernel=null,this.depthMultiplier=t.depthMultiplier==null?1:t.depthMultiplier,this.depthwiseInitializer=$n(t.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=yr(t.depthwiseConstraint),this.depthwiseRegularizer=On(t.depthwiseRegularizer)}build(t){if(t=Xe(t),t.length<4)throw new ot(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(t)}.`);const e=this.dataFormat==="channelsFirst"?1:3;if(t[e]==null||t[e]<0)throw new ot(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${t[e]}).`);const r=t[e],o=[this.kernelSize[0],this.kernelSize[1],r,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",o,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[r*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(t,e){return gt(()=>{t=xe(t);let r=n2t(t,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(r=Si(r,this.bias.read(),this.dataFormat)),this.activation!=null&&(r=this.activation.apply(r)),r})}computeOutputShape(t){t=Xe(t);const e=this.dataFormat==="channelsFirst"?t[2]:t[1],r=this.dataFormat==="channelsFirst"?t[3]:t[2],o=this.dataFormat==="channelsFirst"?t[1]*this.depthMultiplier:t[3]*this.depthMultiplier,a=gi(e,this.kernelSize[0],this.padding,this.strides[0]),i=gi(r,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[t[0],o,a,i]:[t[0],a,i,o]}getConfig(){const t=super.getConfig();return t.depthMultiplier=this.depthMultiplier,t.depthwiseInitializer=Ln(this.depthwiseInitializer),t.depthwiseRegularizer=yn(this.depthwiseRegularizer),t.depthwiseConstraint=xr(this.depthwiseRegularizer),t}}UV.className="DepthwiseConv2D";Lt(UV);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function WV(n,t,e,r){if(Array.isArray(n)){if(t!=null||e!=null)throw new ot("When inputs is an array, neither initialState or constants should be provided");r!=null&&(e=n.slice(n.length-r,n.length),n=n.slice(0,n.length-r)),n.length>1&&(t=n.slice(1,n.length)),n=n[0]}function o(a){return a==null||Array.isArray(a)?a:[a]}return t=o(t),e=o(e),{inputs:n,initialState:t,constants:e}}function VV(n,t,e,r=!1,o,a,i=!1,s=!1){return gt(()=>{const u=t.shape.length;if(u<3)throw new ot(`Input should be at least 3D, but is ${u}D.`);const l=[1,0].concat(xi(2,u));t=Ue(t,l),i&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),o!=null&&(o=jt(jt(o,"bool"),"float32"),o.rank===u-1&&(o=Ro(o,-1)),o=Ue(o,l)),r&&(t=Oc(t,0),o!=null&&(o=Oc(o,0)));const c=[];let h,d=e;const p=t.shape[0],g=Fc(t);let x;o!=null&&(x=Fc(o));for(let b=0;b<p;++b){const C=g[b],E=gt(()=>n(C,d));if(o==null)h=E[0],d=E[1];else{const S=gt(()=>{const k=x[b],R=me(Ka(k),k),A=Bt(it(E[0],k),it(d[0],R)),N=d.map((_,$)=>Bt(it(E[1][$],k),it(_,R)));return{output:A,newStates:N}});h=S.output,d=S.newStates}s&&c.push(h)}let y;return s&&(y=Ys(c,1)),[h,y,d]})}class Rl extends De{constructor(t){super(t);let e;if(t.cell==null)throw new ot("cell property is missing for the constructor of RNN.");if(Array.isArray(t.cell)?e=new YT({cells:t.cell}):e=t.cell,e.stateSize==null)throw new ot("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=e,this.returnSequences=t.returnSequences==null?!1:t.returnSequences,this.returnState=t.returnState==null?!1:t.returnState,this.goBackwards=t.goBackwards==null?!1:t.goBackwards,this._stateful=t.stateful==null?!1:t.stateful,this.unroll=t.unroll==null?!1:t.unroll,this.supportsMasking=!0,this.inputSpec=[new vr({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){const t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return xi(0,t).map(e=>null)}else return this.states_}setStates(t){this.states_=t}computeOutputShape(t){WE(t)&&(t=t[0]),t=t;let e=this.cell.stateSize;Array.isArray(e)||(e=[e]);const r=e[0];let o;if(this.returnSequences?o=[t[0],t[1],r]:o=[t[0],r],this.returnState){const a=[];for(const i of e)a.push([t[0],i]);return[o].concat(a)}else return o}computeMask(t,e){return gt(()=>{Array.isArray(e)&&(e=e[0]);const r=this.returnSequences?e:null;if(this.returnState){const o=this.states.map(a=>null);return[r].concat(o)}else return r})}get states(){if(this.states_==null){const t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,e=[];for(let r=0;r<t;++r)e.push(null);return e}else return this.states_}set states(t){this.states_=t}build(t){if(this.numConstants!=null)throw new Ie("Constants support is not implemented in RNN yet.");WE(t)&&(t=t[0]),t=t;const e=this.stateful?t[0]:null,r=t.slice(2);this.inputSpec[0]=new vr({shape:[e,null,...r]});const o=[t[0]].concat(t.slice(2));this.cell.build(o);let a;if(Array.isArray(this.cell.stateSize)?a=this.cell.stateSize:a=[this.cell.stateSize],this.stateSpec!=null){if(!tn(this.stateSpec.map(i=>i.shape[i.shape.length-1]),a))throw new ot(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=a.map(i=>new vr({shape:[null,i]}));this.stateful&&this.resetStates()}resetStates(t,e=!1){gt(()=>{if(!this.stateful)throw new Bi("Cannot call resetStates() on an RNN Layer that is not stateful.");const r=this.inputSpec[0].shape[0];if(r==null)throw new ot("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(o=>Rr([r,o])):this.states_=[Rr([r,this.cell.stateSize])];else if(t==null)Oe(this.states_),this.keptStates!=null&&(Oe(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(o=>Rr([r,o])):this.states_[0]=Rr([r,this.cell.stateSize]);else{if(Array.isArray(t)||(t=[t]),t.length!==this.states_.length)throw new ot(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${t.length} state value(s). Input received: ${t}`);e===!0?this.keptStates.push(this.states_.slice()):Oe(this.states_);for(let o=0;o<this.states_.length;++o){const a=t[o],i=Array.isArray(this.cell.stateSize)?this.cell.stateSize[o]:this.cell.stateSize,s=[r,i];if(!tn(a.shape,s))throw new ot(`State ${o} is incompatible with layer ${this.name}: expected shape=${s}, received shape=${a.shape}`);this.states_[o]=a}}this.states_=this.states_.map(o=>Yi(o.clone()))})}apply(t,e){let r=e==null?null:e.initialState,o=e==null?null:e.constants;e==null&&(e={});const a=WV(t,r,o,this.numConstants);t=a.inputs,r=a.initialState,o=a.constants;let i=[],s=[];if(r!=null){e.initialState=r,i=i.concat(r),this.stateSpec=[];for(const l of r)this.stateSpec.push(new vr({shape:l.shape}));s=s.concat(this.stateSpec)}if(o!=null&&(e.constants=o,i=i.concat(o),this.numConstants=o.length),i[0]instanceof ss){const l=[t].concat(i),c=this.inputSpec.concat(s),h=this.inputSpec;this.inputSpec=c;const d=super.apply(l,e);return this.inputSpec=h,d}else return super.apply(t,e)}call(t,e){return gt(()=>{const r=e==null?null:e.mask,o=e==null?null:e.training;let a=e==null?null:e.initialState;t=xe(t),a==null&&(this.stateful?a=this.states_:a=this.getInitialState(t));const i=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(a.length!==i)throw new ot(`RNN Layer has ${i} state(s) but was passed ${a.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const s={training:o},l=VV((g,x)=>{const y=this.cell.call([g].concat(x),s);return[y[0],y.slice(1)]},t,a,this.goBackwards,r,null,this.unroll,this.returnSequences),c=l[0],h=l[1],d=l[2];this.stateful&&this.resetStates(d,o);const p=this.returnSequences?h:c;return this.returnState?[p].concat(d):p})}getInitialState(t){return gt(()=>{let e=Rr(t.shape);return e=ce(e,[1,2]),e=Qg(e),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(r=>r>1?zE(e,[1,r]):e):this.cell.stateSize>1?[zE(e,[1,this.cell.stateSize])]:[e]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(t)}getConfig(){const t=super.getConfig(),e={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(e.numConstants=this.numConstants);const r=this.cell.getConfig();return this.getClassName()===Rl.className&&(e.cell={className:this.cell.getClassName(),config:r}),Object.assign(Object.assign(Object.assign({},r),t),e)}static fromConfig(t,e,r={}){const o=e.cell,a=qs(o,r);return new t(Object.assign(e,{cell:a}))}}Rl.className="RNN";Lt(Rl);class Mb extends De{}class XT extends Mb{constructor(t){super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=t.units,Tr(this.units,"units"),this.activation=cl(t.activation==null?this.DEFAULT_ACTIVATION:t.activation),this.useBias=t.useBias==null?!0:t.useBias,this.kernelInitializer=$n(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=$n(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=$n(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=On(t.kernelRegularizer),this.recurrentRegularizer=On(t.recurrentRegularizer),this.biasRegularizer=On(t.biasRegularizer),this.kernelConstraint=yr(t.kernelConstraint),this.recurrentConstraint=yr(t.recurrentConstraint),this.biasConstraint=yr(t.biasConstraint),this.dropout=qf([1,ul([0,t.dropout==null?0:t.dropout])]),this.recurrentDropout=qf([1,ul([0,t.recurrentDropout==null?0:t.recurrentDropout])]),this.dropoutFunc=t.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){t=Xe(t),this.kernel=this.addWeight("kernel",[t[t.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(t,e){return gt(()=>{if(t=t,t.length!==2)throw new ot(`SimpleRNNCell expects 2 input Tensors, got ${t.length}.`);let r=t[1];t=t[0];const o=e.training==null?!1:e.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=hl({ones:()=>Ka(t),rate:this.dropout,training:o,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=hl({ones:()=>Ka(r),rate:this.recurrentDropout,training:o,dropoutFunc:this.dropoutFunc}));let a;const i=this.dropoutMask,s=this.recurrentDropoutMask;i!=null?a=Ji(it(t,i),this.kernel.read()):a=Ji(t,this.kernel.read()),this.bias!=null&&(a=Si(a,this.bias.read())),s!=null&&(r=it(r,s));let u=Bt(a,Ji(r,this.recurrentKernel.read()));return this.activation!=null&&(u=this.activation.apply(u)),[u,u]})}getConfig(){const t=super.getConfig(),e={units:this.units,activation:ll(this.activation),useBias:this.useBias,kernelInitializer:Ln(this.kernelInitializer),recurrentInitializer:Ln(this.recurrentInitializer),biasInitializer:Ln(this.biasInitializer),kernelRegularizer:yn(this.kernelRegularizer),recurrentRegularizer:yn(this.recurrentRegularizer),biasRegularizer:yn(this.biasRegularizer),activityRegularizer:yn(this.activityRegularizer),kernelConstraint:xr(this.kernelConstraint),recurrentConstraint:xr(this.recurrentConstraint),biasConstraint:xr(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},t),e)}}XT.className="SimpleRNNCell";Lt(XT);class GV extends Rl{constructor(t){t.cell=new XT(t),super(t)}call(t,e){return gt(()=>{this.cell.dropoutMask!=null&&(Oe(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Oe(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const r=e==null?null:e.mask,o=e==null?null:e.training,a=e==null?null:e.initialState;return super.call(t,{mask:r,training:o,initialState:a})})}static fromConfig(t,e){return new t(e)}}GV.className="SimpleRNN";Lt(GV);class KT extends Mb{constructor(t){if(super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",t.resetAfter)throw new ot("GRUCell does not support reset_after parameter set to true.");this.units=t.units,Tr(this.units,"units"),this.activation=cl(t.activation===void 0?this.DEFAULT_ACTIVATION:t.activation),this.recurrentActivation=cl(t.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),this.useBias=t.useBias==null?!0:t.useBias,this.kernelInitializer=$n(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=$n(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=$n(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=On(t.kernelRegularizer),this.recurrentRegularizer=On(t.recurrentRegularizer),this.biasRegularizer=On(t.biasRegularizer),this.kernelConstraint=yr(t.kernelConstraint),this.recurrentConstraint=yr(t.recurrentConstraint),this.biasConstraint=yr(t.biasConstraint),this.dropout=qf([1,ul([0,t.dropout==null?0:t.dropout])]),this.recurrentDropout=qf([1,ul([0,t.recurrentDropout==null?0:t.recurrentDropout])]),this.dropoutFunc=t.dropoutFunc,this.implementation=t.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){t=Xe(t);const e=t[t.length-1];this.kernel=this.addWeight("kernel",[e,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(t,e){return gt(()=>{if(t=t,t.length!==2)throw new ot(`GRUCell expects 2 input Tensors (inputs, h, c), got ${t.length}.`);const r=e.training==null?!1:e.training;let o=t[1];t=t[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=hl({ones:()=>Ka(t),rate:this.dropout,training:r,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=hl({ones:()=>Ka(o),rate:this.recurrentDropout,training:r,count:3,dropoutFunc:this.dropoutFunc}));const a=this.dropoutMask,i=this.recurrentDropoutMask;let s,u,l;0<this.dropout&&this.dropout<1&&(t=it(t,a[0]));let c=Ji(t,this.kernel.read());this.useBias&&(c=Si(c,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(o=it(o,i[0]));const h=this.recurrentKernel.read(),[d,p]=ba(h,[2*this.units,this.units],h.rank-1),g=Ji(o,d),[x,y,b]=ba(c,3,c.rank-1),[C,E]=ba(g,2,g.rank-1);s=this.recurrentActivation.apply(Bt(x,C)),u=this.recurrentActivation.apply(Bt(y,E));const S=Ji(it(u,o),p);l=this.activation.apply(Bt(b,S));const k=Bt(it(s,o),it(Bt(1,Zn(s)),l));return[k,k]})}getConfig(){const t=super.getConfig(),e={units:this.units,activation:ll(this.activation),recurrentActivation:ll(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Ln(this.kernelInitializer),recurrentInitializer:Ln(this.recurrentInitializer),biasInitializer:Ln(this.biasInitializer),kernelRegularizer:yn(this.kernelRegularizer),recurrentRegularizer:yn(this.recurrentRegularizer),biasRegularizer:yn(this.biasRegularizer),activityRegularizer:yn(this.activityRegularizer),kernelConstraint:xr(this.kernelConstraint),recurrentConstraint:xr(this.recurrentConstraint),biasConstraint:xr(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},t),e)}}KT.className="GRUCell";Lt(KT);class HV extends Rl{constructor(t){t.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new KT(t),super(t)}call(t,e){return gt(()=>{this.cell.dropoutMask!=null&&(Oe(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Oe(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const r=e==null?null:e.mask,o=e==null?null:e.training,a=e==null?null:e.initialState;return super.call(t,{mask:r,training:o,initialState:a})})}static fromConfig(t,e){return e.implmentation===0&&(e.implementation=1),new t(e)}}HV.className="GRU";Lt(HV);class Lb extends Mb{constructor(t){super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=t.units,Tr(this.units,"units"),this.activation=cl(t.activation===void 0?this.DEFAULT_ACTIVATION:t.activation),this.recurrentActivation=cl(t.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),this.useBias=t.useBias==null?!0:t.useBias,this.kernelInitializer=$n(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=$n(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=$n(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=t.unitForgetBias,this.kernelRegularizer=On(t.kernelRegularizer),this.recurrentRegularizer=On(t.recurrentRegularizer),this.biasRegularizer=On(t.biasRegularizer),this.kernelConstraint=yr(t.kernelConstraint),this.recurrentConstraint=yr(t.recurrentConstraint),this.biasConstraint=yr(t.biasConstraint),this.dropout=qf([1,ul([0,t.dropout==null?0:t.dropout])]),this.recurrentDropout=qf([1,ul([0,t.recurrentDropout==null?0:t.recurrentDropout])]),this.dropoutFunc=t.dropoutFunc,this.implementation=t.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){var e;t=Xe(t);const r=t[t.length-1];this.kernel=this.addWeight("kernel",[r,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let o;if(this.useBias){if(this.unitForgetBias){const a=this.biasInitializer,i=this.units;o=new(e=class extends Qa{apply(u,l){const c=a.apply([i]),h=new FT().apply([i]),d=a.apply([i*2]);return j3(j3(c,h),d)}},e.className="CustomInit",e)}else o=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,o,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(t,e){return gt(()=>{const r=e.training==null?!1:e.training;if(t=t,t.length!==3)throw new ot(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${t.length}.`);let o=t[1];const a=t[2];t=t[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=hl({ones:()=>Ka(t),rate:this.dropout,training:r,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=hl({ones:()=>Ka(o),rate:this.recurrentDropout,training:r,count:4,dropoutFunc:this.dropoutFunc}));const i=this.dropoutMask,s=this.recurrentDropoutMask;let u,l,c,h;0<this.dropout&&this.dropout<1&&(t=it(t,i[0]));let d=Ji(t,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(o=it(o,s[0])),d=Bt(d,Ji(o,this.recurrentKernel.read())),this.useBias&&(d=Si(d,this.bias.read()));const[p,g,x,y]=ba(d,4,d.rank-1);u=this.recurrentActivation.apply(p),l=this.recurrentActivation.apply(g),c=Bt(it(l,a),it(u,this.activation.apply(x))),h=this.recurrentActivation.apply(y);const b=it(h,this.activation.apply(c));return[b,b,c]})}getConfig(){const t=super.getConfig(),e={units:this.units,activation:ll(this.activation),recurrentActivation:ll(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Ln(this.kernelInitializer),recurrentInitializer:Ln(this.recurrentInitializer),biasInitializer:Ln(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:yn(this.kernelRegularizer),recurrentRegularizer:yn(this.recurrentRegularizer),biasRegularizer:yn(this.biasRegularizer),activityRegularizer:yn(this.activityRegularizer),kernelConstraint:xr(this.kernelConstraint),recurrentConstraint:xr(this.recurrentConstraint),biasConstraint:xr(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},t),e)}}Lb.className="LSTMCell";Lt(Lb);class qV extends Rl{constructor(t){t.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new Lb(t),super(t)}call(t,e){return gt(()=>{this.cell.dropoutMask!=null&&(Oe(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Oe(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const r=e==null?null:e.mask,o=e==null?null:e.training,a=e==null?null:e.initialState;return super.call(t,{mask:r,training:o,initialState:a})})}static fromConfig(t,e){return e.implmentation===0&&(e.implementation=1),new t(e)}}qV.className="LSTM";Lt(qV);class YT extends Mb{constructor(t){super(t),this.cells=t.cells}get stateSize(){const t=[];for(const e of this.cells.slice().reverse())Array.isArray(e.stateSize)?t.push(...e.stateSize):t.push(e.stateSize);return t}call(t,e){return gt(()=>{t=t;let r=t.slice(1);const o=[];for(const s of this.cells.slice().reverse())Array.isArray(s.stateSize)?o.push(r.splice(0,s.stateSize.length)):o.push(r.splice(0,1));o.reverse();const a=[];let i;for(let s=0;s<this.cells.length;++s){const u=this.cells[s];r=o[s],s===0?i=[t[0]].concat(r):i=[i[0]].concat(r),i=u.call(i,e),a.push(i.slice(1))}r=[];for(const s of a.slice().reverse())r.push(...s);return[i[0]].concat(r)})}build(t){WE(t)&&(t=t[0]),t=t;let e;this.cells.forEach((r,o)=>{yc(`RNNCell_${o}`,()=>{r.build(t),Array.isArray(r.stateSize)?e=r.stateSize[0]:e=r.stateSize,t=[t[0],e]})}),this.built=!0}getConfig(){const t=super.getConfig(),e=a=>({className:a.getClassName(),config:a.getConfig()}),o={cells:this.cells.map(e)};return Object.assign(Object.assign({},t),o)}static fromConfig(t,e,r={}){const o=[];for(const a of e.cells)o.push(qs(a,r));return new t({cells:o})}get trainableWeights(){if(!this.trainable)return[];const t=[];for(const e of this.cells)t.push(...e.trainableWeights);return t}get nonTrainableWeights(){const t=[];for(const e of this.cells)t.push(...e.nonTrainableWeights);if(!this.trainable){const e=[];for(const r of this.cells)e.push(...r.trainableWeights);return e.concat(t)}return t}getWeights(){const t=[];for(const e of this.cells)t.push(...e.weights);return VE(t)}setWeights(t){const e=[];for(const r of this.cells){const o=r.weights.length,a=t.splice(o);for(let i=0;i<r.weights.length;++i)e.push([r.weights[i],a[i]])}WT(e)}}YT.className="StackedRNNCells";Lt(YT);function hl(n){const{ones:t,rate:e,training:r=!1,count:o=1,dropoutFunc:a}=n,i=()=>a!=null?a(t(),e):LW(t(),e),s=()=>Jg(i,t,r);return!o||o<=1?Yi(s().clone()):Array(o).fill(void 0).map(s).map(l=>Yi(l.clone()))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var r2t=function(n,t){var e={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.indexOf(r)<0&&(e[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(n);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(n,r[o])&&(e[r[o]]=n[r[o]]);return e};class jV extends Rl{constructor(t){if(t.unroll)throw new Ie("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(t.cell))throw new Ie("It is not possible at the moment to stack convolutional cells.");super(t),this.inputSpec=[new vr({ndim:5})]}call(t,e){return gt(()=>{if(this.cell.dropoutMask!=null&&(Oe(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Oe(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),e&&e.constants)throw new ot("ConvRNN2D cell does not support constants");const r=e==null?null:e.mask,o=e==null?null:e.training,a=e==null?null:e.initialState;return super.call(t,{mask:r,training:o,initialState:a})})}computeOutputShape(t){let e=this.computeSingleOutputShape(t);return this.returnSequences||(e=[e[0],...e.slice(2)]),this.returnState&&(e=[e,...Array(2).fill([t[0],...e.slice(-3)])]),e}getInitialState(t){return gt(()=>{const{stateSize:e}=this.cell,r=t.shape,o=this.computeSingleOutputShape(r),a=[o[0],...o.slice(2)],i=Rr(a);return Array.isArray(e)?Array(e.length).fill(i):[i]})}resetStates(t,e=!1){gt(()=>{if(!this.stateful)throw new Bi("Cannot call resetStates() on an RNN Layer that is not stateful.");const r=this.inputSpec[0].shape,o=this.computeSingleOutputShape(r),a=[o[0],...o.slice(2)];if(r[0]==null)throw new ot("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Rr(a)):this.states_=[Rr(a)];else if(t==null)Oe(this.states_),this.keptStates!=null&&(Oe(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Rr(a)):this.states_[0]=Rr(a);else{if(Array.isArray(t)||(t=[t]),t.length!==this.states_.length)throw new ot(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${t.length} state value(s). Input received: ${t}`);e?this.keptStates.push(this.states_.slice()):Oe(this.states_);for(let s=0;s<this.states_.length;++s){const u=t[s],l=a;if(!tn(u.shape,l))throw new ot(`State ${s} is incompatible with layer ${this.name}: expected shape=${l}, received shape=${u.shape}`);this.states_[s]=u}}this.states_=this.states_.map(s=>Yi(s.clone()))})}computeSingleOutputShape(t){const{dataFormat:e,filters:r,kernelSize:o,padding:a,strides:i,dilationRate:s}=this.cell,u=e==="channelsFirst",l=t[u?3:2],c=t[u?4:3],h=gi(l,o[0],a,i[0],s[0]),d=gi(c,o[1],a,i[1],s[1]);return[...t.slice(0,2),...u?[r,h,d]:[h,d,r]]}}jV.className="ConvRNN2D";class QT extends Lb{constructor(t){const{filters:e,kernelSize:r,strides:o,padding:a,dataFormat:i,dilationRate:s}=t;super(Object.assign(Object.assign({},t),{units:e})),this.filters=e,Tr(this.filters,"filters"),this.kernelSize=Nf(r,2,"kernelSize"),this.kernelSize.forEach(u=>Tr(u,"kernelSize")),this.strides=Nf(o||1,2,"strides"),this.strides.forEach(u=>Tr(u,"strides")),this.padding=a||"valid",Sa(this.padding),this.dataFormat=i||"channelsLast",nr(this.dataFormat),this.dilationRate=Nf(s||1,2,"dilationRate"),this.dilationRate.forEach(u=>Tr(u,"dilationRate"))}build(t){var e;t=Xe(t);const r=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[r]==null)throw new ot(`The channel dimension of the input should be defined. Found ${t[r]}`);const o=t[r],a=4,i=this.kernelSize.concat([o,this.filters*a]);this.kernel=this.addWeight("kernel",i,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const s=this.kernelSize.concat([this.filters,this.filters*a]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",s,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let u;if(this.unitForgetBias){const l=this.biasInitializer,c=this.filters;u=new(e=class extends Qa{apply(d,p){const g=l.apply([c]),x=kl([c]),y=l.apply([c*2]);return OT([g,x,y])}},e.className="CustomInit",e)}else u=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*a],null,u,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(t,e){return gt(()=>{if(t.length!==3)throw new ot(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${t.length}.`);const r=e.training||!1,o=t[0],a=t[1],i=t[2],s=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=hl({ones:()=>Ka(o),rate:this.dropout,training:r,count:s,dropoutFunc:this.dropoutFunc}));const u=this.dropoutMask,l=(M,G,Q)=>!G||!G[Q]?M:it(G[Q],M);let c=l(o,u,0),h=l(o,u,1),d=l(o,u,2),p=l(o,u,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=hl({ones:()=>Ka(a),rate:this.recurrentDropout,training:r,count:s,dropoutFunc:this.dropoutFunc}));const g=this.recurrentDropoutMask;let x=l(a,g,0),y=l(a,g,1),b=l(a,g,2),C=l(a,g,3);const E=3,[S,k,R,A]=ba(this.kernel.read(),s,E),[N,_,$,D]=this.useBias?ba(this.bias.read(),s):[null,null,null,null];c=this.inputConv(c,S,N,this.padding),h=this.inputConv(h,k,_,this.padding),d=this.inputConv(d,R,$,this.padding),p=this.inputConv(p,A,D,this.padding);const[O,P,z,W]=ba(this.recurrentKernel.read(),s,E);x=this.recurrentConv(x,O),y=this.recurrentConv(y,P),b=this.recurrentConv(b,z),C=this.recurrentConv(C,W);const F=this.recurrentActivation.apply(Bt(c,x)),B=this.recurrentActivation.apply(Bt(h,y)),U=Bt(it(B,i),it(F,this.activation.apply(Bt(d,b)))),q=it(this.recurrentActivation.apply(Bt(p,C)),this.activation.apply(U));return[q,q,U]})}getConfig(){const t=super.getConfig(),{units:e}=t,r=r2t(t,["units"]),o={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},r),o)}inputConv(t,e,r,o){const a=Dc(t,e,this.strides,o||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return r?Si(a,r,this.dataFormat):a}recurrentConv(t,e){return Dc(t,e,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}QT.className="ConvLSTM2DCell";Lt(QT);class XV extends jV{constructor(t){const e=new QT(t);super(Object.assign(Object.assign({},t),{cell:e}))}static fromConfig(t,e){return new t(e)}}XV.className="ConvLSTM2D";Lt(XV);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class ZT extends De{constructor(t){super(t),this.rate=Math.max(Math.min(t.rate,1),0),this.noiseShape=t.noiseShape,this.seed=t.seed,this.supportsMasking=!0}getNoiseShape(t){if(this.noiseShape==null)return this.noiseShape;const e=t.shape,r=[];for(let o=0;o<this.noiseShape.length;++o)r.push(this.noiseShape[o]==null?e[o]:this.noiseShape[o]);return r}call(t,e){return gt(()=>{this.invokeCallHook(t,e);const r=xe(t);if(0<this.rate&&this.rate<1){const o=e.training==null?!1:e.training,a=this.getNoiseShape(r);return Jg(()=>LW(r,this.rate,a,this.seed),()=>r,o)}return t})}getConfig(){const t={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},e=super.getConfig();return Object.assign(t,e),t}dispose(){return super.dispose()}}ZT.className="Dropout";Lt(ZT);class KV extends ZT{constructor(t){super(t),this.inputSpec=[{ndim:3}]}getNoiseShape(t){const e=t.shape;return[e[0],1,e[2]]}}KV.className="SpatialDropout1D";Lt(KV);class YV extends De{constructor(t){if(super(t),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",t.batchInputShape==null&&t.inputShape==null&&t.inputDim!=null){let e=null;t.batchSize!=null&&(e=t.batchSize),this.batchInputShape=[e,t.inputDim]}this.units=t.units,Tr(this.units,"units"),this.activation=cl(t.activation),t.useBias!=null&&(this.useBias=t.useBias),this.kernelInitializer=$n(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=$n(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=yr(t.kernelConstraint),this.biasConstraint=yr(t.biasConstraint),this.kernelRegularizer=On(t.kernelRegularizer),this.biasRegularizer=On(t.biasRegularizer),this.activityRegularizer=On(t.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(t){t=Xe(t);const e=t[t.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[e,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:e}}],this.built=!0}computeOutputShape(t){t=Xe(t);const e=t.slice();return e[e.length-1]=this.units,e}call(t,e){return gt(()=>{this.invokeCallHook(t,e);const r=xe(t),o=AW(this.activation.getClassName());let a;return o!=null?a=Ji(r,this.kernel.read(),o,this.bias?this.bias.read():null):(a=Ji(r,this.kernel.read()),this.bias!=null&&(a=Si(a,this.bias.read())),this.activation!=null&&(a=this.activation.apply(a))),a})}getConfig(){const t={units:this.units,activation:ll(this.activation),useBias:this.useBias,kernelInitializer:Ln(this.kernelInitializer),biasInitializer:Ln(this.biasInitializer),kernelRegularizer:yn(this.kernelRegularizer),biasRegularizer:yn(this.biasRegularizer),activityRegularizer:yn(this.activityRegularizer),kernelConstraint:xr(this.kernelConstraint),biasConstraint:xr(this.biasConstraint)},e=super.getConfig();return Object.assign(t,e),t}}YV.className="Dense";Lt(YV);class QV extends De{constructor(t){t=t||{},super(t),this.inputSpec=[{minNDim:3}],this.dataFormat=t.dataFormat}computeOutputShape(t){t=Xe(t);for(const e of t.slice(1))if(e==null)throw new ot(`The shape of the input to "Flatten" is not fully defined (got ${t.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[t[0],el(t,1)]}call(t,e){return gt(()=>{this.invokeCallHook(t,e);let r=xe(t);if(this.dataFormat==="channelsFirst"&&r.rank>1){const o=[0];for(let a=2;a<r.rank;++a)o.push(a);o.push(1),r=Ue(r,o)}return Lbt(r)})}getConfig(){const t={};this.dataFormat!=null&&(t.dataFormat=this.dataFormat);const e=super.getConfig();return Object.assign(t,e),t}}QV.className="Flatten";Lt(QV);class ZV extends De{constructor(t){super(t),this.supportsMasking=!0,this.activation=cl(t.activation)}call(t,e){return gt(()=>{this.invokeCallHook(t,e);const r=xe(t);return this.activation.apply(r)})}getConfig(){const t={activation:ll(this.activation)},e=super.getConfig();return Object.assign(t,e),t}}ZV.className="Activation";Lt(ZV);class JV extends De{constructor(t){super(t),this.n=t.n,this.inputSpec=[{ndim:2}]}computeOutputShape(t){return[t[0],this.n,t[1]]}call(t,e){return gt(()=>(t=xe(t),Fbt(t,this.n)))}getConfig(){const t={n:this.n},e=super.getConfig();return Object.assign(t,e),t}}JV.className="RepeatVector";Lt(JV);class tG extends De{constructor(t){super(t),this.targetShape=t.targetShape;for(let e=0;e<this.targetShape.length;++e)this.isUnknown(this.targetShape[e])&&(this.targetShape[e]=null)}isUnknown(t){return t<0||t==null}fixUnknownDimension(t,e){const r="Total size of new array must be unchanged.",o=e.slice();let a=1,i=null;for(let u=0;u<o.length;++u){const l=o[u];if(this.isUnknown(l))if(i===null)i=u;else throw new ot("Can only specifiy one unknown dimension.");else a*=l}const s=el(t);if(i!==null){if(a===0||s%a!==0)throw new ot(r);o[i]=s/a}else if(s!==a)throw new ot(r);return o}computeOutputShape(t){let e=!1;for(let r=0;r<t.length;++r)if(this.isUnknown(t[r])){e=!0;break}return e?t.slice(0,1).concat(this.targetShape):t.slice(0,1).concat(this.fixUnknownDimension(t.slice(1),this.targetShape))}call(t,e){return gt(()=>{this.invokeCallHook(t,e);const r=xe(t),o=r.shape,a=o.slice(0,1).concat(this.fixUnknownDimension(o.slice(1),this.targetShape));return ht(r,a)})}getConfig(){const t={targetShape:this.targetShape},e=super.getConfig();return Object.assign(t,e),t}}tG.className="Reshape";Lt(tG);class eG extends De{constructor(t){if(super(t),t.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(t.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${t.dims} instead.`);const e=xi(1,t.dims.length+1);if(!tn(t.dims.slice().sort(),e))throw new Error("Invalid permutation `dims`: "+JSON.stringify(t.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=t.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new vr({ndim:this.dims.length+1})]}computeOutputShape(t){t=Xe(t);const e=t.slice();return this.dims.forEach((r,o)=>{e[o+1]=t[r]}),e}call(t,e){return Ue(xe(t),this.dimsIncludingBatch)}getConfig(){const t={dims:this.dims},e=super.getConfig();return Object.assign(t,e),t}}eG.className="Permute";Lt(eG);class nG extends De{constructor(t){super(t??{}),this.supportsMasking=!0,t!=null?this.maskValue=t.maskValue==null?0:t.maskValue:this.maskValue=0}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),e={maskValue:this.maskValue};return Object.assign(e,t),e}computeMask(t,e){const r=xe(t);return $E(Ey(r,this.maskValue),-1)}call(t,e){return gt(()=>{this.invokeCallHook(t,e);const r=xe(t),i=$E(Ey(r,this.maskValue),-1,!0);return it(r,jt(i,r.dtype))})}}nG.className="Masking";Lt(nG);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class rG extends De{constructor(t){if(super(t),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",t.batchInputShape==null&&t.inputShape==null){let e=null;t.batchSize!=null&&(e=t.batchSize),t.inputLength==null?this.batchInputShape=[e,null]:this.batchInputShape=[e].concat(ln(t.inputLength))}this.inputDim=t.inputDim,Tr(this.inputDim,"inputDim"),this.outputDim=t.outputDim,Tr(this.outputDim,"outputDim"),this.embeddingsInitializer=$n(t.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=On(t.embeddingsRegularizer),this.activityRegularizer=On(t.activityRegularizer),this.embeddingsConstraint=yr(t.embeddingsConstraint),this.maskZero=t.maskZero,this.supportsMasking=t.maskZero,this.inputLength=t.inputLength}build(t){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(t){}computeMask(t,e){return gt(()=>this.maskZero?(t=xe(t),Ey(t,We(t))):null)}computeOutputShape(t){if(t=Xe(t),this.inputLength==null)return[...t,this.outputDim];const e=ln(this.inputLength);if(e.length!==t.length-1)throw new ot(`"inputLength" is ${this.inputLength}, but received input shape has shape ${t}`);{let r=0;for(let o=0;o<e.length;++o){const a=e[o],i=t[o+1];if(a!=null&&i!=null&&a!==i)throw new ot(`"inputLength" is ${this.inputLength}, but received input shape has shape ${t}`);a==null&&(e[r]=i),r++}}return[t[0],...e,this.outputDim]}call(t,e){return gt(()=>{this.invokeCallHook(t,e);let r=xe(t);r.dtype!=="int32"&&(r=Zi(r,"int32"));const o=MW(this.embeddings.read(),ht(r,[r.size]));return ht(o,Xe(this.computeOutputShape(r.shape)))})}getConfig(){const t={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:Ln(this.embeddingsInitializer),embeddingsRegularizer:yn(this.embeddingsRegularizer),activityRegularizer:yn(this.activityRegularizer),embeddingsConstraint:xr(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},e=super.getConfig();return Object.assign(t,e),t}}rG.className="Embedding";Lt(rG);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class ah extends De{constructor(t){super(t||{}),this.supportsMasking=!0}mergeFunction(t){throw new Ie}computeElementwiseOpOutputShape(t,e){if(t==null||e==null)return null;if(t.length<e.length)return this.computeElementwiseOpOutputShape(e,t);if(e.length===0)return t;const r=t.slice(0,t.length-e.length);for(let o=0;o<e.length;++o){const a=t[t.length-e.length+o],i=e[o];if(a==null||i==null||a<0||i<0)r.push(null);else if(a===1)r.push(i);else if(i===1)r.push(a);else{if(a!==i)throw new ot("Operands could not be broadcast together with shapes "+JSON.stringify(t)+" "+JSON.stringify(e));r.push(a)}}return r}build(t){if(Array.isArray(t)&&!Array.isArray(t[0])&&(t=[Xe(t)]),t=t,t.length<2)throw new ot(`A merge layer should be called on an Array of at least 2 inputs. Got ${t.length} input(s).`);let e=[];for(const a of t)a!=null&&a[0]!==null&&e.push(a[0]);if(e=tl(e),e.length>1)throw new ot(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(t)}.`);let r=t[0]==null?null:t[0].slice(1);for(let a=1;a<t.length;++a){const i=t[a]==null?null:t[a].slice(1);r=this.computeElementwiseOpOutputShape(r,i)}const o=t.map(a=>a.length);t.indexOf(null)===-1&&tl(o).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(t,e){return gt(()=>{if(t=t,this.reshapeRequired){const r=[],o=t.map(a=>a.rank);if(o.indexOf(null)===-1){const a=ul(o);for(let i of t){const s=i.rank;for(let u=0;u<a-s;++u)i=Qg(i,1);r.push(i)}return this.mergeFunction(r)}else{let a=!1;for(const u of t){const l=u.rank;if(l==null){const c=u.shape,h=c[0],d=c.slice(1).concat([h]);let p=ht(u,[h].concat(el(c.slice(1))));p=Ue(p,[1,0]),p=ht(p,d),r.push(p),a=!0}else if(l>1){const c=xi(1,l).concat([0]);r.push(Ue(u,c)),a=!0}else r.push(u)}let i=this.mergeFunction(r);const s=i.rank;if(a){if(s==null){const u=i.shape,l=u.length,c=u[l-1],h=[c].concat(u.slice(0,u.length-1));i=ht(Ue(ht(i,[-1,c]),[1,0]),h)}else if(s>1){const u=[s-1].concat(xi(0,s-1));i=Ue(i,u)}}return i}}else return this.mergeFunction(t)})}computeOutputShape(t){t=t;let e;t[0]==null?e=null:e=t[0].slice(1);for(let o=1;o<t.length;++o){const a=t[o]==null?null:t[o].slice(1);e=this.computeElementwiseOpOutputShape(e,a)}let r=[];for(const o of t)o!=null&&o[0]!==null&&r.push(o[0]);return r=tl(r),r.length===1?e=r.concat(e):e=[null].concat(e),e}computeMask(t,e){return gt(()=>{if(e==null)return null;if(!Array.isArray(e))throw new ot("`mask` should be an Array");if(!Array.isArray(t))throw new ot("`inputs` should be an Array");if(e.length!==t.length)throw new ot(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${t.length} vs ${e.length})`);if(e.every(o=>o==null))return null;e=e.map(o=>o==null?o:Ro(o,0));let r=e[0];for(let o=1;o<e.length-1;++o)r=Ks(r,e[o]);return r})}}class oG extends ah{constructor(t){super(t)}mergeFunction(t){return gt(()=>{let e=t[0].clone();for(let r=1;r<t.length;++r)e=Bt(e,t[r]);return e})}}oG.className="Add";Lt(oG);class aG extends ah{constructor(t){super(t)}mergeFunction(t){return gt(()=>{let e=t[0].clone();for(let r=1;r<t.length;++r)e=it(e,t[r]);return e})}}aG.className="Multiply";Lt(aG);class iG extends ah{constructor(t){super(t)}mergeFunction(t){return gt(()=>{let e=t[0].clone();for(let r=1;r<t.length;++r)e=Bt(e,t[r]);return it(1/t.length,e)})}}iG.className="Average";Lt(iG);class sG extends ah{constructor(t){super(t)}mergeFunction(t){return gt(()=>{let e=t[0];for(let r=1;r<t.length;++r)e=El(e,t[r]);return e})}}sG.className="Maximum";Lt(sG);class uG extends ah{constructor(t){super(t)}mergeFunction(t){return gt(()=>{let e=t[0];for(let r=1;r<t.length;++r)e=cm(e,t[r]);return e})}}uG.className="Minimum";Lt(uG);class lG extends ah{constructor(t){super(t),this.DEFAULT_AXIS=-1,t==null&&(t={}),this.axis=t.axis==null?this.DEFAULT_AXIS:t.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(t){if(!(Array.isArray(t)&&Array.isArray(t[0]))||t.length===1)throw new ot("A `Concatenate` layer should be called on a list of at least 2 inputs");t=t;let e=!0;for(const o of t)if(o!=null){e=!1;break}if(e)return;const r=[];for(let o=0;o<t.length;++o){const a=t[o].slice();a.splice(this.axis,1);let i=!1;for(const s of r)if(tn(s,a)){i=!0;break}i||r.push(a)}if(r.length>1)throw new ot("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(t))}mergeFunction(t){return gt(()=>OT(t,this.axis))}computeOutputShape(t){if(!(Array.isArray(t)&&Array.isArray(t[0])))throw new ot("A `Concatenate` layer should be called on a list of inputs.");const e=t,r=e[0].slice(),o=this.axis<0?r.length+this.axis:this.axis;for(const a of e.slice(1)){if(r[o]==null||a[o]==null){r[o]=null;break}r[o]+=a[o]}return r}computeMask(t,e){if(e==null)return null;if(!Array.isArray(e))throw new ot("`mask` should be an array for Concatenate");if(!Array.isArray(t))throw new ot("`inputs` should be an array for Concatenate");if(e.length!==t.length)throw new ot(`Mismatch in the length of mask (${e.length}) and the legnth of inputs (${t.length})`);return gt(()=>{let r=!0;if(e.forEach(i=>{if(i!=null){r=!1;return}}),r)return null;const o=[];for(let i=0;i<t.length;++i)e[i]==null?o.push(jt(Ka(t[i]),"bool")):e[i].rank<t[i].rank?o.push(Ro(e[i],-1)):o.push(e[i]);const a=No(o,this.axis);return lU(a,-1,!1)})}getConfig(){const t={axis:this.axis},e=super.getConfig();return Object.assign(t,e),t}}lG.className="Concatenate";Lt(lG);function Mp(n,t){for(;n<0;)n+=t;return n}function o2t(n,t,e){if(n.shape.length>3||t.shape.length>3)throw new Ie("batchDot is not implemented for tensors of 4D or higher rank yet");if(H(n.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${n.shape.length}`),H(n.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${t.shape.length}`),typeof e=="number"&&(e=[e,e]),n.dtype==="complex64"||t.dtype==="complex64")throw new Ie("batchDot is not implemented for complex64-type Tensors yet.");const r=n.shape.length,o=t.shape.length;e==null&&(e=[r-1,o-2]);const a=e;return gt(()=>{let i;if(r>o){i=r-o;const u=[];for(let l=0;l<i;++l)u.push(1);t=ht(t,t.shape.concat(u))}else if(o>r){i=o-r;const u=[];for(let l=0;l<i;++l)u.push(1);n=ht(n,n.shape.concat(u))}else i=0;let s;if(n.shape.length===2&&t.shape.length===2)a[0]===a[1]?s=ce(it(n,t),a[0]):s=ce(it(Ue(n,[1,0]),t),a[1]);else{const u=a[0]!==n.shape.length-1,l=a[1]===t.shape.length-1;s=Qe(n,t,u,l)}if(i>0){let u;r>o?u=r+o-3:u=r-1;const l=[];for(let c=u;c<u+i;++c)l.push(c);s=Hg(s,l)}return s.shape.length===1&&(s=Ro(s,1)),s})}class cG extends ah{constructor(t){super(t),this.axes=t.axes,this.normalize=t.normalize==null?!1:t.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(t){H(Array.isArray(t)&&t.length===2&&Array.isArray(t[0])&&Array.isArray(t[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const e=t[0],r=t[1];if(e.length>3||r.length>3)throw new Ie("Dot layer does not support tensors of 4D or higher rank yet.");const o=this.interpretAxes(e,r);if(e[o[0]]!==r[o[1]])throw new ot(`Dimension incompatibility: ${e[o[0]]} !== ${r[o[1]]}`)}mergeFunction(t){if(t.length!==2)throw new ot(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${t.length} input(s).`);let e=t[0],r=t[1],o;return Array.isArray(this.axes)?o=this.axes.map((a,i)=>Mp(a,t[i].shape.length)):o=[Mp(this.axes,e.shape.length),Mp(this.axes,r.shape.length)],this.normalize&&(e=_y(e,o[0]),r=_y(r,o[1])),o2t(e,r,o)}interpretAxes(t,e){let r;return Array.isArray(this.axes)?r=this.axes:r=[Mp(this.axes,t.length),Mp(this.axes,e.length)],r}computeOutputShape(t){H(Array.isArray(t)&&t.length===2&&Array.isArray(t[0])&&Array.isArray(t[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const e=t[0].slice(),r=t[1].slice();if(e.length>3||r.length>3)throw new Ie("Dot layer does not support tensors of 4D or higher rank yet.");const o=this.interpretAxes(e,r);e.splice(o[0],1),r.splice(o[1],1),r.splice(0,1);const a=e.concat(r);return a.length===1&&a.push(1),a}computeMask(t,e){return null}getConfig(){const t={axes:this.axes,normalize:this.normalize},e=super.getConfig();return Object.assign(t,e),t}}cG.className="Dot";Lt(cG);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class hG extends De{constructor(t){super(t),this.supportsMasking=!0,this.stddev=t.stddev}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),e={stddev:this.stddev};return Object.assign(e,t),e}call(t,e){return gt(()=>{this.invokeCallHook(t,e);const r=xe(t);return Jg(()=>Bt(Ab(r.shape,0,this.stddev),r),()=>r,e.training||!1)})}}hG.className="GaussianNoise";Lt(hG);class fG extends De{constructor(t){super(t),this.supportsMasking=!0,this.rate=t.rate}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),e={rate:this.rate};return Object.assign(e,t),e}call(t,e){return gt(()=>{this.invokeCallHook(t,e);const r=xe(t);return this.rate>0&&this.rate<1?Jg(()=>{const a=Math.sqrt(this.rate/(1-this.rate));return it(r,Ab(r.shape,1,a))},()=>r,e.training||!1):r})}}fG.className="GaussianDropout";Lt(fG);class dG extends De{constructor(t){super(t),this.supportsMasking=!0,this.rate=t.rate,this.noiseShape=t.noiseShape}_getNoiseShape(t){return this.noiseShape||xe(t).shape}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),e={rate:this.rate};return Object.assign(e,t),e}call(t,e){return gt(()=>{if(this.rate<1&&this.rate>0){const r=this._getNoiseShape(t);return Jg(()=>{const a=xe(t),s=-1.6732632423543772*1.0507009873554805;let u=eh(Gg(r),this.rate);u=Zi(u,"float32");const l=((1-this.rate)*(1+this.rate*s**2))**-.5,c=-l*s*this.rate,h=Bt(it(a,u),it(Bt(u,-1),s));return Bt(it(h,l),c)},()=>xe(t),e.training||!1)}return t})}}dG.className="AlphaDropout";Lt(dG);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function mm(n,t,e,r,o,a=.001){let i;if(n.rank===2)i=Lmt(n,t,e,r,o,a);else if(n.rank===3)i=Bmt(n,t,e,r,o,a);else if(n.rank===4)i=Umt(n,t,e,r,o,a);else throw new Ie(`batchNormalization is not implemented for array of rank ${n.rank} yet`);return i}function a2t(n,t,e,r,o=.001){return gt(()=>{const a=WR(n,r),i=a.mean,s=a.variance;return[mm(n,i,s,e,t,o),i,s]})}function i2t(n,t,e,r,o=.001){return gt(()=>{const a=WR(n,r),i=a.mean,s=a.variance,u=[];for(const g of xi(0,n.rank))r.indexOf(g)!==-1?u.push(1):u.push(n.shape[g]);const l=ht(i,u),c=ht(s,u),h=t==null?null:ht(t,u),d=e==null?null:ht(e,u);return[mm(n,l,c,d,h,o),i,s]})}function s2t(n,t,e,r,o=.001){return tn(r.slice().sort(),xi(0,n.rank-1))?a2t(n,t,e,r,o):i2t(n,t,e,r,o)}class pG extends De{constructor(t){t==null&&(t={}),super(t),this.supportsMasking=!0,this.axis=t.axis==null?-1:t.axis,this.momentum=t.momentum==null?.99:t.momentum,this.epsilon=t.epsilon==null?.001:t.epsilon,this.center=t.center==null?!0:t.center,this.scale=t.scale==null?!0:t.scale,this.betaInitializer=$n(t.betaInitializer||"zeros"),this.gammaInitializer=$n(t.gammaInitializer||"ones"),this.movingMeanInitializer=$n(t.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=$n(t.movingVarianceInitializer||"ones"),this.betaConstraint=yr(t.betaConstraint),this.gammaConstraint=yr(t.gammaConstraint),this.betaRegularizer=On(t.betaRegularizer),this.gammaRegularizer=On(t.gammaRegularizer)}build(t){t=Xe(t);const e=this.axis>=0?this.axis:this.axis+t.length,r=t[e];if(r==null)throw new ot(`Axis ${e} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(t)}.`);this.inputSpec=[new vr({ndim:t.length,axes:{[e]:r}})];const o=[r];this.scale&&(this.gamma=this.addWeight("gamma",o,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",o,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",o,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",o,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(t,e){return gt(()=>{const r=e.training==null?!1:e.training,o=xe(t),a=o.shape,i=a.length,s=xi(0,i),u=this.axis>=0?this.axis:this.axis+i;s.splice(u,1);const l=Mc(1,i);l[u]=a[u];const c=s.slice();c.sort();const h=!tn(c,xi(0,i).slice(0,i-1)),d=()=>{if(h){const C=ht(this.movingMean.read(),l),E=ht(this.movingVariance.read(),l),S=this.center?ht(this.beta.read(),l):null,k=this.scale?ht(this.gamma.read(),l):null;return mm(o,C,E,S,k,this.epsilon)}else return mm(o,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!r)return d();const[p,g,x]=s2t(o,this.gamma.read(),this.beta.read(),s,this.epsilon),y=(C,E,S)=>{gt(()=>{const k=1-S,R=C.read(),A=it(me(R,E),k);C.write(me(R,A))})};return(()=>{y(this.movingMean,g,this.momentum),y(this.movingVariance,x,this.momentum)})(),p})}getConfig(){const t={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Ln(this.betaInitializer),gammaInitializer:Ln(this.gammaInitializer),movingMeanInitializer:Ln(this.movingMeanInitializer),movingVarianceInitializer:Ln(this.movingVarianceInitializer),betaRegularizer:yn(this.betaRegularizer),gammaRegularizer:yn(this.gammaRegularizer),betaConstraint:xr(this.betaConstraint),gammaConstraint:xr(this.gammaConstraint)},e=super.getConfig();return Object.assign(t,e),t}}pG.className="BatchNormalization";Lt(pG);class mG extends De{constructor(t){if(t==null&&(t={}),super(t),this.axis=t.axis==null?-1:t.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(const e of this.axis)if(!Number.isInteger(e))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=t.epsilon==null?.001:t.epsilon,this.center=t.center==null?!0:t.center,this.scale=t.scale==null?!0:t.scale,this.betaInitializer=$n(t.betaInitializer||"zeros"),this.gammaInitializer=$n(t.gammaInitializer||"ones"),this.betaRegularizer=On(t.betaRegularizer),this.gammaRegularizer=On(t.gammaRegularizer),this.supportsMasking=!0}build(t){t=Xe(t);const e=t.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let a=0;a<this.axis.length;++a)this.axis[a]<0&&(this.axis[a]+=e);for(const a of this.axis)if(a<0||a>=e)throw new Error(`Invalid axis: ${a}`);if(this.axis.length!==tl(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const r=this.axis.map(a=>t[a]),o=!0;this.scale?this.gamma=this.addWeight("gamma",r,"float32",this.gammaInitializer,this.gammaRegularizer,o):this.gamma=null,this.center?this.beta=this.addWeight("beta",r,"float32",this.betaInitializer,this.betaRegularizer,o):this.beta=null,this.built=!0}call(t,e){const r=xe(t),o=r.shape,a=o.length;return gt(()=>{let{mean:s,variance:u}=WR(r,this.axis,!0);const l=Mc(1,a);for(const x of this.axis)l[x]=o[x];const c=x=>x!=null&&x.shape.length!==a?ht(x,l):x;let h=this.scale?c(this.gamma.read()):null,d=this.center?c(this.beta.read()):null;const p=[],g=[];for(let x=0;x<a;++x)this.axis.indexOf(x)!==-1?(p.push(o[x]),g.push(1)):(p.push(1),g.push(o[x]));return s=li(s,p),u=li(u,p),h!=null&&(h=li(h,g)),d!=null&&(d=li(d,g)),mm(r,s,u,d,h,this.epsilon)})}getConfig(){const t={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Ln(this.betaInitializer),gammaInitializer:Ln(this.gammaInitializer),betaRegularizer:yn(this.betaRegularizer),gammaRegularizer:yn(this.gammaRegularizer)},e=super.getConfig();return Object.assign(t,e),t}}mG.className="LayerNormalization";Lt(mG);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function u2t(n,t,e){return gt(()=>{if(n.rank!==4)throw new ot(`temporalPadding expects input tensor to be 4-D, but received a ${n.rank}-D tensor.`);if(t==null&&(t=[[1,1],[1,1]]),t.length!==2||t[0].length!==2||t[1].length!==2)throw new ot("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(e==null&&(e=yi()),e!=="channelsLast"&&e!=="channelsFirst")throw new ot(`Unknown data format: ${e}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let r;return e==="channelsFirst"?r=[[0,0],[0,0],t[0],t[1]]:r=[[0,0],t[0],t[1],[0,0]],VR(n,r)})}class gG extends De{constructor(t){if(t==null&&(t={}),super(t),this.dataFormat=t.dataFormat==null?yi():t.dataFormat,t.padding==null)this.padding=[[1,1],[1,1]];else if(typeof t.padding=="number")this.padding=[[t.padding,t.padding],[t.padding,t.padding]];else{if(t.padding=t.padding,t.padding.length!==2)throw new ot(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${t.padding.length} array.`);let e,r;if(typeof t.padding[0]=="number")e=[t.padding[0],t.padding[0]],r=[t.padding[1],t.padding[1]];else{if(t.padding=t.padding,t.padding[0].length!==2)throw new ot(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${t.padding[0].length} array.`);if(e=t.padding[0],t.padding[1].length!==2)throw new ot(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${t.padding[1].length} array.`);r=t.padding[1]}this.padding=[e,r]}this.inputSpec=[new vr({ndim:4})]}computeOutputShape(t){t=Xe(t);let e,r;return this.dataFormat==="channelsFirst"?(t[2]!=null&&t[2]>=0?e=t[2]+this.padding[0][0]+this.padding[0][1]:e=null,t[3]!=null&&t[3]>=0?r=t[3]+this.padding[1][0]+this.padding[1][1]:r=null,[t[0],t[1],e,r]):(t[1]!=null&&t[1]>=0?e=t[1]+this.padding[0][0]+this.padding[0][1]:e=null,t[2]!=null&&t[2]>=0?r=t[2]+this.padding[1][0]+this.padding[1][1]:r=null,[t[0],e,r,t[3]])}call(t,e){return gt(()=>u2t(xe(t),this.padding,this.dataFormat))}getConfig(){const t={padding:this.padding,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}gG.className="ZeroPadding2D";Lt(gG);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Pb(n,t,e,r,o,a){return gt(()=>{nr(o),DW(a),Sa(r),e==null&&(e=[1,1]),r==null&&(r="valid"),o==null&&(o=yi()),a==null&&(a="max"),n=jT(n,o);let i;const s=r==="same"?"same":"valid";return a==="max"?i=UR(n,t,e,s):i=_R(n,t,e,s),o==="channelsFirst"&&(i=Ue(i,[0,3,1,2])),i})}function vG(n,t,e,r,o,a){return gt(()=>{nr(o),DW(a),Sa(r),e==null&&(e=[1,1,1]),r==null&&(r="valid"),o==null&&(o=yi()),a==null&&(a="max"),n=OV(n,o);let i;const s=r==="same"?"same":"valid";return a==="max"?i=kvt(n,t,e,s):i=Rmt(n,t,e,s),o==="channelsFirst"&&(i=Ue(i,[0,4,1,2,3])),i})}class xG extends De{constructor(t){if(t.poolSize==null&&(t.poolSize=2),super(t),typeof t.poolSize=="number")this.poolSize=[t.poolSize];else if(Array.isArray(t.poolSize)&&t.poolSize.length===1&&typeof t.poolSize[0]=="number")this.poolSize=t.poolSize;else throw new ot(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(t.poolSize)}`);if(Tr(this.poolSize,"poolSize"),t.strides==null)this.strides=this.poolSize;else if(typeof t.strides=="number")this.strides=[t.strides];else if(Array.isArray(t.strides)&&t.strides.length===1&&typeof t.strides[0]=="number")this.strides=t.strides;else throw new ot(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(t.strides)}`);Tr(this.strides,"strides"),this.padding=t.padding==null?"valid":t.padding,Sa(this.padding),this.inputSpec=[new vr({ndim:3})]}computeOutputShape(t){t=Xe(t);const e=gi(t[1],this.poolSize[0],this.padding,this.strides[0]);return[t[0],e,t[2]]}call(t,e){return gt(()=>{this.invokeCallHook(t,e),t=Qg(xe(t),2);const r=this.poolingFunction(xe(t),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return Hg(r,[2])})}getConfig(){const t={poolSize:this.poolSize,padding:this.padding,strides:this.strides},e=super.getConfig();return Object.assign(t,e),t}}class yG extends xG{constructor(t){super(t)}poolingFunction(t,e,r,o,a){return nr(a),Sa(o),Pb(t,e,r,o,a,"max")}}yG.className="MaxPooling1D";Lt(yG);class bG extends xG{constructor(t){super(t)}poolingFunction(t,e,r,o,a){return nr(a),Sa(o),Pb(t,e,r,o,a,"avg")}}bG.className="AveragePooling1D";Lt(bG);class wG extends De{constructor(t){if(t.poolSize==null&&(t.poolSize=[2,2]),super(t),this.poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize],t.strides==null)this.strides=this.poolSize;else if(Array.isArray(t.strides)){if(t.strides.length!==2)throw new ot(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${t.strides.length}.`);this.strides=t.strides}else this.strides=[t.strides,t.strides];Tr(this.poolSize,"poolSize"),Tr(this.strides,"strides"),this.padding=t.padding==null?"valid":t.padding,this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,nr(this.dataFormat),Sa(this.padding),this.inputSpec=[new vr({ndim:4})]}computeOutputShape(t){t=Xe(t);let e=this.dataFormat==="channelsFirst"?t[2]:t[1],r=this.dataFormat==="channelsFirst"?t[3]:t[2];return e=gi(e,this.poolSize[0],this.padding,this.strides[0]),r=gi(r,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[t[0],t[1],e,r]:[t[0],e,r,t[3]]}call(t,e){return gt(()=>(this.invokeCallHook(t,e),this.poolingFunction(xe(t),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}class CG extends wG{constructor(t){super(t)}poolingFunction(t,e,r,o,a){return nr(a),Sa(o),Pb(t,e,r,o,a,"max")}}CG.className="MaxPooling2D";Lt(CG);class SG extends wG{constructor(t){super(t)}poolingFunction(t,e,r,o,a){return nr(a),Sa(o),Pb(t,e,r,o,a,"avg")}}SG.className="AveragePooling2D";Lt(SG);class EG extends De{constructor(t){if(t.poolSize==null&&(t.poolSize=[2,2,2]),super(t),this.poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize,t.poolSize],t.strides==null)this.strides=this.poolSize;else if(Array.isArray(t.strides)){if(t.strides.length!==3)throw new ot(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${t.strides.length}.`);this.strides=t.strides}else this.strides=[t.strides,t.strides,t.strides];Tr(this.poolSize,"poolSize"),Tr(this.strides,"strides"),this.padding=t.padding==null?"valid":t.padding,this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,nr(this.dataFormat),Sa(this.padding),this.inputSpec=[new vr({ndim:5})]}computeOutputShape(t){t=Xe(t);let e=this.dataFormat==="channelsFirst"?t[2]:t[1],r=this.dataFormat==="channelsFirst"?t[3]:t[2],o=this.dataFormat==="channelsFirst"?t[4]:t[3];return e=gi(e,this.poolSize[0],this.padding,this.strides[0]),r=gi(r,this.poolSize[1],this.padding,this.strides[1]),o=gi(o,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[t[0],t[1],e,r,o]:[t[0],e,r,o,t[4]]}call(t,e){return gt(()=>(this.invokeCallHook(t,e),this.poolingFunction(xe(t),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}class kG extends EG{constructor(t){super(t)}poolingFunction(t,e,r,o,a){return nr(a),Sa(o),vG(t,e,r,o,a,"max")}}kG.className="MaxPooling3D";Lt(kG);class IG extends EG{constructor(t){super(t)}poolingFunction(t,e,r,o,a){return nr(a),Sa(o),vG(t,e,r,o,a,"avg")}}IG.className="AveragePooling3D";Lt(IG);class RG extends De{constructor(t){super(t),this.inputSpec=[new vr({ndim:3})]}computeOutputShape(t){return[t[0],t[2]]}call(t,e){throw new Ie}}class TG extends RG{constructor(t){super(t||{})}call(t,e){return gt(()=>{const r=xe(t);return sr(r,1)})}}TG.className="GlobalAveragePooling1D";Lt(TG);class NG extends RG{constructor(t){super(t||{})}call(t,e){return gt(()=>{const r=xe(t);return mi(r,1)})}}NG.className="GlobalMaxPooling1D";Lt(NG);class AG extends De{constructor(t){super(t),this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,nr(this.dataFormat),this.inputSpec=[new vr({ndim:4})]}computeOutputShape(t){return t=t,this.dataFormat==="channelsLast"?[t[0],t[3]]:[t[0],t[1]]}call(t,e){throw new Ie}getConfig(){const t={dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}class _G extends AG{call(t,e){return gt(()=>{const r=xe(t);return this.dataFormat==="channelsLast"?sr(r,[1,2]):sr(r,[2,3])})}}_G.className="GlobalAveragePooling2D";Lt(_G);class DG extends AG{call(t,e){return gt(()=>{const r=xe(t);return this.dataFormat==="channelsLast"?mi(r,[1,2]):mi(r,[2,3])})}}DG.className="GlobalMaxPooling2D";Lt(DG);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class $G extends De{constructor(t){super(t),this.layer=t.layer}build(t){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(t){this.layer!=null&&(this.layer.trainable=t)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(t){this.layer.setWeights(t)}getConfig(){const t={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},e=super.getConfig();return Object.assign(t,e),t}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(t)}static fromConfig(t,e,r={}){const o=e.layer,a=qs(o,r);delete e.layer;const i={layer:a};return Object.assign(i,e),new t(i)}}class OG extends $G{constructor(t){super(t),this.supportsMasking=!0}build(t){if(t=Xe(t),t.length<3)throw new ot(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(t)}`);this.inputSpec=[{shape:t}];const e=[t[0]].concat(t.slice(2));this.layer.built||(this.layer.build(e),this.layer.built=!0),super.build(t)}computeOutputShape(t){t=Xe(t);const e=[t[0]].concat(t.slice(2)),r=this.layer.computeOutputShape(e),o=t[1];return[r[0],o].concat(r.slice(1))}call(t,e){return gt(()=>(t=xe(t),VV((i,s)=>[xe(this.layer.call(i,e)),[]],t,[],!1,null,null,!1,!0)[1]))}}OG.className="TimeDistributed";Lt(OG);function l2t(n){oh(Abt,"BidirectionalMergeMode",n)}const c2t="concat";class FG extends $G{constructor(t){super(t);const e=t.layer.getConfig(),r={};r.className=t.layer.getClassName(),r.config=e,this.forwardLayer=qs(r),e.goBackwards=e.goBackwards!==!0;const o={};if(o.className=t.layer.getClassName(),o.config=e,this.backwardLayer=qs(o),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=t.mergeMode===void 0?c2t:t.mergeMode,l2t(this.mergeMode),t.weights)throw new Ie("weights support is not implemented for Bidirectional layer yet.");this._stateful=t.layer.stateful,this.returnSequences=t.layer.returnSequences,this.returnState=t.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=t.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(t){this._trainable=t,this.forwardLayer!=null&&(this.forwardLayer.trainable=t),this.backwardLayer!=null&&(this.backwardLayer.trainable=t)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(t){const e=t.length,r=Math.floor(e/2);this.forwardLayer.setWeights(t.slice(0,r)),this.backwardLayer.setWeights(t.slice(r))}computeOutputShape(t){let e=this.forwardLayer.computeOutputShape(t);Array.isArray(e)&&Array.isArray(e[0])||(e=[e]),e=e;let r,o,a;return this.returnState&&(a=e.slice(1)),r=e[0],r=r,this.mergeMode==="concat"?(r[r.length-1]*=2,o=[r]):this.mergeMode==null?o=[r,r.slice()]:o=[r],this.returnState?this.mergeMode==null?o.concat(a).concat(a.slice()):[r].concat(a).concat(a.slice()):To(o)}apply(t,e){let r=e==null?null:e.initialState,o=e==null?null:e.constants;e==null&&(e={});const a=WV(t,r,o,this.numConstants);if(t=a.inputs,r=a.initialState,o=a.constants,Array.isArray(t)&&(r=t.slice(1),t=t[0]),(r==null||r.length===0)&&o==null)return super.apply(t,e);const i=[],s=[];if(r!=null){const l=r.length;if(l%2>0)throw new ot("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");e.initialState=r,i.push(...r);const c=r.map(h=>new vr({shape:h.shape}));this.forwardLayer.stateSpec=c.slice(0,l/2),this.backwardLayer.stateSpec=c.slice(l/2),s.push(...c)}if(o!=null)throw new Ie("Support for constants in Bidirectional layers is not implemented yet.");const u=i[0]instanceof ss;for(const l of i)if(l instanceof ss!==u)throw new ot("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(u){const l=[t].concat(i),c=this.inputSpec.concat(s),h=this.inputSpec;this.inputSpec=c;const d=super.apply(l,e);return this.inputSpec=h,d}else return super.apply(t,e)}call(t,e){return gt(()=>{const r=e.initialState;let o,a;if(r==null)o=this.forwardLayer.call(t,e),a=this.backwardLayer.call(t,e);else{const u=r.slice(0,r.length/2),l=r.slice(r.length/2);o=this.forwardLayer.call(t,Object.assign(e,{initialState:u})),a=this.backwardLayer.call(t,Object.assign(e,{initialState:l}))}let i;this.returnState&&(Array.isArray(o)&&(i=o.slice(1).concat(a.slice(1))),o=o[0],a=a[0]),this.returnSequences&&(a=Oc(a,1));let s;return this.mergeMode==="concat"?s=OT([o,a]):this.mergeMode==="sum"?s=Bt(o,a):this.mergeMode==="ave"?s=it(.5,Bt(o,a)):this.mergeMode==="mul"?s=it(o,a):this.mergeMode==null&&(s=[o,a]),this.returnState?this.mergeMode==null?s.concat(i):[s].concat(i):s})}resetStates(t){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(t){yc(this.forwardLayer.name,()=>{this.forwardLayer.build(t)}),yc(this.backwardLayer.name,()=>{this.backwardLayer.build(t)}),this.built=!0}computeMask(t,e){Array.isArray(e)&&(e=e[0]);let r;if(this.returnSequences?this.mergeMode==null?r=[e,e]:r=e:this.mergeMode==null?r=[null,null]:r=null,this.returnState){const a=this.forwardLayer.states.map(i=>null);return Array.isArray(r)?r.concat(a).concat(a):[r].concat(a).concat(a)}else return r}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(t),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(t)}getConfig(){const t={mergeMode:this.mergeMode},e=super.getConfig();return Object.assign(t,e),t}static fromConfig(t,e){const r=qs(e.layer);if(delete e.layer,e.numConstants!=null)throw new Ie("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const o=e;return o.layer=r,new t(o)}}FG.className="Bidirectional";Lt(FG);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class MG extends De{constructor(t){super(t),this.scale=t.scale,t.offset?this.offset=t.offset:this.offset=0}getConfig(){const t={scale:this.scale,offset:this.offset},e=super.getConfig();return Object.assign(t,e),t}call(t,e){return gt(()=>(t=xe(t),t.dtype!=="float32"&&(t=Zi(t,"float32")),Bt(it(t,this.scale),this.offset)))}}MG.className="Rescaling";Lt(MG);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const{resizeBilinear:h2t,cropAndResize:f2t}=Gs;class LG extends De{constructor(t){super(t),this.height=t.height,this.width=t.width}centerCrop(t,e,r,o,a,i,s,u){return gt(()=>{let l,c=!1;const h=e/i,d=r/s,p=(o+e)/i,g=(a+r)/s,x=[h,d,p,g],y=[];t.rank===3?(c=!0,l=Ys([t])):l=t;for(let k=0;k<l.shape[0];k++)y.push(x);const b=Jz(y,[y.length,4]),C=hm(0,y.length,1,"int32"),S=f2t(l,b,C,[o,a],"nearest");return Zi(c?xe(Fc(S)):S,u)})}upsize(t,e,r,o){return gt(()=>{const a=h2t(t,[e,r]);return Zi(a,o)})}call(t,e){return gt(()=>{const r=xe(t),o=r.dtype,a=r.shape,i=a[a.length-3],s=a[a.length-2];let u=0;i!==this.height&&(u=Math.floor((i-this.height)/2));let l=0;return s!==this.width&&(l=Math.floor((s-this.width)/2),l===0&&(l=1)),u>=0&&l>=0?this.centerCrop(r,u,l,this.height,this.width,i,s,o):this.upsize(t,this.height,this.width,o)})}getConfig(){const t={height:this.height,width:this.width},e=super.getConfig();return Object.assign(t,e),t}computeOutputShape(t){t=Xe(t);const e=t.length-3,r=t.length-2;return t[e]=this.height,t[r]=this.width,t}}LG.className="CenterCrop";Lt(LG);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function d2t(n,t,e,r){let o=xe(n);if(o.dtype!=="int32"&&(o=Zi(o,"int32")),t==="int")return o;const a=o.shape;if(o.rank===0&&(o=Ro(o,-1)),t==="oneHot"&&o.shape[o.shape.length-1]!==1&&(o=Ro(o,-1)),o.rank>2)throw new ot(`When outputMode is not int, maximum output rank is 2 Received outputMode ${t} and input shape ${a} which would result in output rank ${o.rank}.`);const i=["multiHot","oneHot"].includes(t),s=o;let u;if(typeof r<"u"&&t==="count"?u=E3(s,r,e,i):u=E3(s,[],e,i),t!=="tfIdf")return u;if(r)return it(u,r);throw new ot("When outputMode is 'tfIdf', weights must be provided.")}/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class PG extends De{constructor(t){super(t),this.numTokens=t.numTokens,t.outputMode?this.outputMode=t.outputMode:this.outputMode="multiHot"}getConfig(){const t={numTokens:this.numTokens,outputMode:this.outputMode},e=super.getConfig();return Object.assign(t,e),t}computeOutputShape(t){return t=Xe(t),t==null?[this.numTokens]:this.outputMode==="oneHot"&&t[t.length-1]!==1?(t.push(this.numTokens),t):(t[t.length-1]=this.numTokens,t)}call(t,e){return gt(()=>{t=xe(t),t.dtype!=="int32"&&(t=Zi(t,"int32"));let r;if(typeof e.countWeights<"u"){if(this.outputMode!=="count")throw new ot(`countWeights is not used when outputMode !== count.
              Received countWeights=${e.countWeights}`);r=xe(e.countWeights)}const o=mi(t),a=Cy(t),i=Ca(this.numTokens,o).bufferSync().get(0),s=eh(a,0).bufferSync().get(0);if(!(i&&s))throw new ot(`Input values must be between 0 < values <= numTokens with numTokens=${this.numTokens}`);return d2t(t,this.outputMode,this.numTokens,r)})}}PG.className="CategoryEncoding";Lt(PG);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const p2t=["bilinear","nearest"],hF=new Set(p2t);class BG extends De{constructor(t){if(super(t),this.height=t.height,this.width=t.width,t.interpolation)if(hF.has(t.interpolation))this.interpolation=t.interpolation;else throw new ot(`Invalid interpolation parameter: ${t.interpolation} is not implemented`);else this.interpolation="bilinear";this.cropToAspectRatio=!!t.cropToAspectRatio}computeOutputShape(t){t=Xe(t);const e=t[2];return[this.height,this.width,e]}getConfig(){const t={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},e=super.getConfig();return Object.assign(t,e),t}call(t,e){return gt(()=>{const r=[this.height,this.width];if(this.interpolation==="bilinear")return Gs.resizeBilinear(t,r,!this.cropToAspectRatio);if(this.interpolation==="nearest")return Gs.resizeNearestNeighbor(t,r,!this.cropToAspectRatio);throw new Error(`Interpolation is ${this.interpolation} but only ${[...hF]} are supported`)})}}BG.className="Resizing";Lt(BG);/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class zG{constructor(t){this.seed=t}next(){if(this.seed!==void 0)return this.seed++}}zG.className="RandomSeed";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class UG extends De{constructor(t){super(t),this.randomGenerator=new zG(t.seed)}getConfig(){const t={seed:this.randomGenerator.seed},e=super.getConfig();return Object.assign(t,e),t}}UG.className="BaseRandomLayer";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const m2t=["bilinear","nearest"],fF=new Set(m2t);class WG extends UG{constructor(t){super(t);const{factor:e,interpolation:r="bilinear"}=t;if(this.factor=e,Array.isArray(this.factor)&&this.factor.length===2)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else if(!Array.isArray(this.factor)&&this.factor>0)this.widthLower=-this.factor,this.widthUpper=this.factor;else throw new ot(`Invalid factor: ${this.factor}. Must be positive number or tuple of 2 numbers`);if(this.widthLower<-1||this.widthUpper<-1)throw new ot(`factor must have values larger than -1. Got: ${this.factor}`);if(this.widthUpper<this.widthLower)throw new ot(`factor cannot have upper bound less than lower bound.
        Got upper bound: ${this.widthUpper}.
        Got lower bound: ${this.widthLower}
      `);if(r)if(fF.has(r))this.interpolation=r;else throw new ot(`Invalid interpolation parameter: ${r} is not implemented`)}getConfig(){const t={factor:this.factor,interpolation:this.interpolation},e=super.getConfig();return Object.assign(t,e),t}computeOutputShape(t){t=Xe(t);const e=t[2];return[this.imgHeight,-1,e]}call(t,e){return gt(()=>{const r=xe(t);this.imgHeight=r.shape[r.shape.length-3];const o=r.shape[r.shape.length-2];this.widthFactor=Gg([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let a=this.widthFactor.dataSync()[0]*o;a=Math.round(a);const i=[this.imgHeight,a];switch(this.interpolation){case"bilinear":return Gs.resizeBilinear(t,i);case"nearest":return Gs.resizeNearestNeighbor(t,i);default:throw new Error(`Interpolation is ${this.interpolation}
          but only ${[...fF]} are supported`)}})}}WG.className="RandomWidth";Lt(WG);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const g2t=yt();g2t.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,n=>{n&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var dF;(function(n){n[n.DT_INVALID=0]="DT_INVALID",n[n.DT_FLOAT=1]="DT_FLOAT",n[n.DT_DOUBLE=2]="DT_DOUBLE",n[n.DT_INT32=3]="DT_INT32",n[n.DT_UINT8=4]="DT_UINT8",n[n.DT_INT16=5]="DT_INT16",n[n.DT_INT8=6]="DT_INT8",n[n.DT_STRING=7]="DT_STRING",n[n.DT_COMPLEX64=8]="DT_COMPLEX64",n[n.DT_INT64=9]="DT_INT64",n[n.DT_BOOL=10]="DT_BOOL",n[n.DT_QINT8=11]="DT_QINT8",n[n.DT_QUINT8=12]="DT_QUINT8",n[n.DT_QINT32=13]="DT_QINT32",n[n.DT_BFLOAT16=14]="DT_BFLOAT16",n[n.DT_QINT16=15]="DT_QINT16",n[n.DT_QUINT16=16]="DT_QUINT16",n[n.DT_UINT16=17]="DT_UINT16",n[n.DT_COMPLEX128=18]="DT_COMPLEX128",n[n.DT_HALF=19]="DT_HALF",n[n.DT_RESOURCE=20]="DT_RESOURCE",n[n.DT_VARIANT=21]="DT_VARIANT",n[n.DT_UINT32=22]="DT_UINT32",n[n.DT_UINT64=23]="DT_UINT64",n[n.DT_FLOAT_REF=101]="DT_FLOAT_REF",n[n.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",n[n.DT_INT32_REF=103]="DT_INT32_REF",n[n.DT_UINT8_REF=104]="DT_UINT8_REF",n[n.DT_INT16_REF=105]="DT_INT16_REF",n[n.DT_INT8_REF=106]="DT_INT8_REF",n[n.DT_STRING_REF=107]="DT_STRING_REF",n[n.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",n[n.DT_INT64_REF=109]="DT_INT64_REF",n[n.DT_BOOL_REF=110]="DT_BOOL_REF",n[n.DT_QINT8_REF=111]="DT_QINT8_REF",n[n.DT_QUINT8_REF=112]="DT_QUINT8_REF",n[n.DT_QINT32_REF=113]="DT_QINT32_REF",n[n.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",n[n.DT_QINT16_REF=115]="DT_QINT16_REF",n[n.DT_QUINT16_REF=116]="DT_QUINT16_REF",n[n.DT_UINT16_REF=117]="DT_UINT16_REF",n[n.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",n[n.DT_HALF_REF=119]="DT_HALF_REF",n[n.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",n[n.DT_VARIANT_REF=121]="DT_VARIANT_REF",n[n.DT_UINT32_REF=122]="DT_UINT32_REF",n[n.DT_UINT64_REF=123]="DT_UINT64_REF"})(dF||(dF={}));var pF;(function(n){(function(t){t[t.LEGACY=0]="LEGACY",t[t.V1=1]="V1",t[t.V2=2]="V2"})(n.CheckpointFormatVersion||(n.CheckpointFormatVersion={}))})(pF||(pF={}));var x0={exports:{}},v2t=x0.exports,mF;function x2t(){return mF||(mF=1,function(n){(function(t,e,r){function o(u){var l=this,c=s();l.next=function(){var h=2091639*l.s0+l.c*23283064365386963e-26;return l.s0=l.s1,l.s1=l.s2,l.s2=h-(l.c=h|0)},l.c=1,l.s0=c(" "),l.s1=c(" "),l.s2=c(" "),l.s0-=c(u),l.s0<0&&(l.s0+=1),l.s1-=c(u),l.s1<0&&(l.s1+=1),l.s2-=c(u),l.s2<0&&(l.s2+=1),c=null}function a(u,l){return l.c=u.c,l.s0=u.s0,l.s1=u.s1,l.s2=u.s2,l}function i(u,l){var c=new o(u),h=l&&l.state,d=c.next;return d.int32=function(){return c.next()*4294967296|0},d.double=function(){return d()+(d()*2097152|0)*11102230246251565e-32},d.quick=d,h&&(typeof h=="object"&&a(h,c),d.state=function(){return a(c,{})}),d}function s(){var u=4022871197,l=function(c){c=String(c);for(var h=0;h<c.length;h++){u+=c.charCodeAt(h);var d=.02519603282416938*u;u=d>>>0,d-=u,d*=u,u=d>>>0,d-=u,u+=d*4294967296}return(u>>>0)*23283064365386963e-26};return l}e&&e.exports?e.exports=i:this.alea=i})(v2t,n)}(x0)),x0.exports}var y0={exports:{}},y2t=y0.exports,gF;function b2t(){return gF||(gF=1,function(n){(function(t,e,r){function o(s){var u=this,l="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var h=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^h^h>>>8},s===(s|0)?u.x=s:l+=s;for(var c=0;c<l.length+64;c++)u.x^=l.charCodeAt(c)|0,u.next()}function a(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function i(s,u){var l=new o(s),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,g=(d+p)/(1<<21);while(g===0);return g},h.int32=l.next,h.quick=h,c&&(typeof c=="object"&&a(c,l),h.state=function(){return a(l,{})}),h}e&&e.exports?e.exports=i:this.xor128=i})(y2t,n)}(y0)),y0.exports}var b0={exports:{}},w2t=b0.exports,vF;function C2t(){return vF||(vF=1,function(n){(function(t,e,r){function o(s){var u=this,l="";u.next=function(){var h=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^(h^h<<1))|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(s|0)?u.x=s:l+=s;for(var c=0;c<l.length+64;c++)u.x^=l.charCodeAt(c)|0,c==l.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function a(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function i(s,u){var l=new o(s),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,g=(d+p)/(1<<21);while(g===0);return g},h.int32=l.next,h.quick=h,c&&(typeof c=="object"&&a(c,l),h.state=function(){return a(l,{})}),h}e&&e.exports?e.exports=i:this.xorwow=i})(w2t,n)}(b0)),b0.exports}var w0={exports:{}},S2t=w0.exports,xF;function E2t(){return xF||(xF=1,function(n){(function(t,e,r){function o(s){var u=this;u.next=function(){var c=u.x,h=u.i,d,p;return d=c[h],d^=d>>>7,p=d^d<<24,d=c[h+1&7],p^=d^d>>>10,d=c[h+3&7],p^=d^d>>>3,d=c[h+4&7],p^=d^d<<7,d=c[h+7&7],d=d^d<<13,p^=d^d<<9,c[h]=p,u.i=h+1&7,p};function l(c,h){var d,p=[];if(h===(h|0))p[0]=h;else for(h=""+h,d=0;d<h.length;++d)p[d&7]=p[d&7]<<15^h.charCodeAt(d)+p[d+1&7]<<13;for(;p.length<8;)p.push(0);for(d=0;d<8&&p[d]===0;++d);for(d==8?p[7]=-1:p[d],c.x=p,c.i=0,d=256;d>0;--d)c.next()}l(u,s)}function a(s,u){return u.x=s.x.slice(),u.i=s.i,u}function i(s,u){s==null&&(s=+new Date);var l=new o(s),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,g=(d+p)/(1<<21);while(g===0);return g},h.int32=l.next,h.quick=h,c&&(c.x&&a(c,l),h.state=function(){return a(l,{})}),h}e&&e.exports?e.exports=i:this.xorshift7=i})(S2t,n)}(w0)),w0.exports}var C0={exports:{}},k2t=C0.exports,yF;function I2t(){return yF||(yF=1,function(n){(function(t,e,r){function o(s){var u=this;u.next=function(){var c=u.w,h=u.X,d=u.i,p,g;return u.w=c=c+1640531527|0,g=h[d+34&127],p=h[d=d+1&127],g^=g<<13,p^=p<<17,g^=g>>>15,p^=p>>>12,g=h[d]=g^p,u.i=d,g+(c^c>>>16)|0};function l(c,h){var d,p,g,x,y,b=[],C=128;for(h===(h|0)?(p=h,h=null):(h=h+"\0",p=0,C=Math.max(C,h.length)),g=0,x=-32;x<C;++x)h&&(p^=h.charCodeAt((x+32)%h.length)),x===0&&(y=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,x>=0&&(y=y+1640531527|0,d=b[x&127]^=p+y,g=d==0?g+1:0);for(g>=128&&(b[(h&&h.length||0)&127]=-1),g=127,x=4*128;x>0;--x)p=b[g+34&127],d=b[g=g+1&127],p^=p<<13,d^=d<<17,p^=p>>>15,d^=d>>>12,b[g]=p^d;c.w=y,c.X=b,c.i=g}l(u,s)}function a(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function i(s,u){s==null&&(s=+new Date);var l=new o(s),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,g=(d+p)/(1<<21);while(g===0);return g},h.int32=l.next,h.quick=h,c&&(c.X&&a(c,l),h.state=function(){return a(l,{})}),h}e&&e.exports?e.exports=i:this.xor4096=i})(k2t,n)}(C0)),C0.exports}var S0={exports:{}},R2t=S0.exports,bF;function T2t(){return bF||(bF=1,function(n){(function(t,e,r){function o(s){var u=this,l="";u.next=function(){var h=u.b,d=u.c,p=u.d,g=u.a;return h=h<<25^h>>>7^d,d=d-p|0,p=p<<24^p>>>8^g,g=g-h|0,u.b=h=h<<20^h>>>12^d,u.c=d=d-p|0,u.d=p<<16^d>>>16^g,u.a=g-h|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=s|0):l+=s;for(var c=0;c<l.length+20;c++)u.b^=l.charCodeAt(c)|0,u.next()}function a(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function i(s,u){var l=new o(s),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,g=(d+p)/(1<<21);while(g===0);return g},h.int32=l.next,h.quick=h,c&&(typeof c=="object"&&a(c,l),h.state=function(){return a(l,{})}),h}e&&e.exports?e.exports=i:this.tychei=i})(R2t,n)}(S0)),S0.exports}var E0={exports:{}},N2t=E0.exports,wF;function A2t(){return wF||(wF=1,function(n){(function(t,e,r){var o=256,a=6,i=52,s="random",u=r.pow(o,a),l=r.pow(2,i),c=l*2,h=o-1,d;function p(S,k,R){var A=[];k=k==!0?{entropy:!0}:k||{};var N=b(y(k.entropy?[S,E(e)]:S??C(),3),A),_=new g(A),$=function(){for(var D=_.g(a),O=u,P=0;D<l;)D=(D+P)*o,O*=o,P=_.g(1);for(;D>=c;)D/=2,O/=2,P>>>=1;return(D+P)/O};return $.int32=function(){return _.g(4)|0},$.quick=function(){return _.g(4)/4294967296},$.double=$,b(E(_.S),e),(k.pass||R||function(D,O,P,z){return z&&(z.S&&x(z,_),D.state=function(){return x(_,{})}),P?(r[s]=D,O):D})($,N,"global"in k?k.global:this==r,k.state)}function g(S){var k,R=S.length,A=this,N=0,_=A.i=A.j=0,$=A.S=[];for(R||(S=[R++]);N<o;)$[N]=N++;for(N=0;N<o;N++)$[N]=$[_=h&_+S[N%R]+(k=$[N])],$[_]=k;(A.g=function(D){for(var O,P=0,z=A.i,W=A.j,F=A.S;D--;)O=F[z=h&z+1],P=P*o+F[h&(F[z]=F[W=h&W+O])+(F[W]=O)];return A.i=z,A.j=W,P})(o)}function x(S,k){return k.i=S.i,k.j=S.j,k.S=S.S.slice(),k}function y(S,k){var R=[],A=typeof S,N;if(k&&A=="object")for(N in S)try{R.push(y(S[N],k-1))}catch{}return R.length?R:A=="string"?S:S+"\0"}function b(S,k){for(var R=S+"",A,N=0;N<R.length;)k[h&N]=h&(A^=k[h&N]*19)+R.charCodeAt(N++);return E(k)}function C(){try{var S;return d&&(S=d.randomBytes)?S=S(o):(S=new Uint8Array(o),(t.crypto||t.msCrypto).getRandomValues(S)),E(S)}catch{var k=t.navigator,R=k&&k.plugins;return[+new Date,t,R,t.screen,E(e)]}}function E(S){return String.fromCharCode.apply(0,S)}if(b(r.random(),e),n.exports){n.exports=p;try{d=qR}catch{}}else r["seed"+s]=p})(typeof self<"u"?self:N2t,[],Math)}(E0)),E0.exports}var xS,CF;function _2t(){if(CF)return xS;CF=1;var n=x2t(),t=b2t(),e=C2t(),r=E2t(),o=I2t(),a=T2t(),i=A2t();return i.alea=n,i.xor128=t,i.xorwow=e,i.xorshift7=r,i.xor4096=o,i.tychei=a,xS=i,xS}_2t();/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var SF;(function(n){n[n.FAIL=0]="FAIL",n[n.SHORTEST=1]="SHORTEST",n[n.LONGEST=2]="LONGEST"})(SF||(SF={}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xt(n,t){Array.isArray(n)||(n=[n]),n.forEach(e=>{e!=null&&H(e.dtype!=="complex64",()=>`${t} does not support complex64 tensors in the CPU backend.`)})}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const D2t=PU;class Bb extends FI{nextDataId(){return Bb.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new sz(this,Fi())}write(t,e,r){this.firstUse&&(this.firstUse=!1,yt().get("IS_NODE")&&pa(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));const o={id:this.nextDataId()};return this.data.set(o,{values:t,dtype:r,refCount:1}),o}makeTensorInfo(t,e,r){let o;if(e==="string"&&r!=null&&r.length>0&&qm(r[0])){const a=r.map(i=>Ju(i));o=this.write(a,t,e)}else o=this.write(r,t,e);return{dataId:o,shape:t,dtype:e}}refCount(t){return this.data.has(t)?this.data.get(t).refCount:0}incRef(t){const e=this.data.get(t);e.refCount++}decRef(t){if(this.data.has(t)){const e=this.data.get(t);e.refCount--}}move(t,e,r,o,a){this.data.set(t,{values:e,dtype:o,refCount:a})}numDataIds(){return this.data.numDataIds()}async read(t){return this.readSync(t)}readSync(t){const{dtype:e,complexTensorInfos:r}=this.data.get(t);if(e==="complex64"){const o=this.readSync(r.real.dataId),a=this.readSync(r.imag.dataId);return Qs(o,a)}return Udt(this.data.get(t).values,e)}bufferSync(t){const e=this.readSync(t.dataId);if(t.dtype==="string")try{const r=e.map(o=>sl(o));return Ae(t.shape,t.dtype,r)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Ae(t.shape,t.dtype,e)}makeOutput(t,e,r){return Fi().makeTensorFromTensorInfo(this.makeTensorInfo(e,r,t),this)}disposeData(t,e=!1){if(this.data.has(t)){if(this.data.get(t).refCount--,!e&&this.data.get(t).refCount>0)return!1;const{complexTensorInfos:r}=this.data.get(t);r!=null&&(this.disposeData(r.real.dataId,!0),this.disposeData(r.imag.dataId,!0)),this.data.delete(t)}return!0}disposeIntermediateTensorInfo(t){this.disposeData(t.dataId)}async time(t){const e=Io();return t(),{kernelMs:Io()-e}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(t){Xt([t],"where");const e=this.readSync(t.dataId);return D2t(t.shape,e)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}Bb.nextDataId=0;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VG(n){const t=new Float32Array(n.length);for(let e=0;e<n.length;++e)t[e]=Math.abs(n[e]);return t}const $2t=n=>{const{x:t}=n.inputs,e=n.backend;Xt(t,"abs");let r=new Float32Array(It(t.shape));const o=e.data.get(t.dataId).values;return r=VG(o),e.makeOutput(r,t.shape,t.dtype)},O2t={kernelName:g1,backendName:"cpu",kernelFunc:$2t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rr(n){return(t,e,r,o,a)=>{const i=Ee(t,e),s=i.length,u=ue(i),l=It(i),c=Jr(a,l),h=t.length,d=e.length,p=ue(t),g=ue(e),x=Gf(t,i),y=Gf(e,i);if(x.length+y.length===0)for(let b=0;b<c.length;++b)c[b]=n(r[b%r.length],o[b%o.length]);else for(let b=0;b<c.length;++b){const C=cd(b,s,u),E=C.slice(-h);x.forEach(A=>E[A]=0);const S=Ki(E,h,p),k=C.slice(-d);y.forEach(A=>k[A]=0);const R=Ki(k,d,g);c[b]=n(r[S],o[R])}return[c,i]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vo(n){const{inputs:t,backend:e}=n,{real:r,imag:o}=t,a=e.data.get(r.dataId).values,i=e.data.get(o.dataId).values,s=e.makeTensorInfo(r.shape,"complex64"),u=e.data.get(s.dataId);return u.complexTensorInfos={real:e.makeTensorInfo(r.shape,"float32",a),imag:e.makeTensorInfo(o.shape,"float32",i)},s}const F2t={kernelName:XI,backendName:"cpu",kernelFunc:Vo};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function My(n,t,e="float32"){if(e==="complex64"){const o=My(n,t,"float32"),a=My(n,t,"float32");return Vo({inputs:{real:o,imag:a},backend:n})}const r=to(It(t),e);return n.makeTensorInfo(t,e,r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function us(n){const{inputs:t,backend:e}=n,{x:r}=t;return e.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}const M2t={kernelName:dg,backendName:"cpu",kernelFunc:us};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lc(n){const{inputs:t,backend:e}=n,{input:r}=t,o=e.data.get(r.dataId).complexTensorInfos.real,a=e.data.get(o.dataId).values;return e.makeTensorInfo(o.shape,o.dtype,a)}const L2t={kernelName:xR,backendName:"cpu",kernelFunc:Lc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GG(n,t,e,r){if(r==="int32"){const o=Int32Array.from(n);return[t,"int32",o]}if(r==="bool"){const o=th([0],e),[a,i]=rr((s,u)=>s!==u?1:0)(t,[],n,o,"bool");return[i,"bool",a]}throw new Error(`Error in Cast: failed to cast ${e} to ${r}`)}function fl(n){const{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{dtype:a}=r;if(a==="complex64"){if(o.dtype==="complex64")return us({inputs:{x:o},backend:e});const c=My(e,o.shape,o.dtype),h=fl({inputs:{x:o},backend:e,attrs:{dtype:"float32"}}),d=Vo({inputs:{real:h,imag:c},backend:e});return e.disposeIntermediateTensorInfo(c),e.disposeIntermediateTensorInfo(h),d}if(o.dtype==="complex64"){const c=Lc({inputs:{input:o},backend:e}),h=fl({inputs:{x:c},backend:e,attrs:{dtype:a}});return e.disposeIntermediateTensorInfo(c),h}if(!cz(o.dtype,a)){const c=us({inputs:{x:o},backend:e});return{dataId:c.dataId,shape:c.shape,dtype:a}}const i=e.data.get(o.dataId).values,[s,u,l]=GG(i,o.shape,o.dtype,a);return e.makeTensorInfo(s,u,l)}const P2t={kernelName:tg,backendName:"cpu",kernelFunc:fl};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wr(n,t,e,r){return e==null?({inputs:o,backend:a})=>{const{a:i,b:s}=o,u=a;Xt([i,s],n);const l=u.data.get(i.dataId).values,c=u.data.get(s.dataId).values,h=i.dtype==="string"?Zs(l):l,d=i.dtype==="string"?Zs(c):c,p=r||i.dtype,[g,x]=t(i.shape,s.shape,h,d,p);return u.makeTensorInfo(x,p,g)}:({inputs:o,backend:a})=>{const{a:i,b:s}=o,u=a;if(i.dtype==="complex64"||s.dtype==="complex64"){const l=fl({inputs:{x:i},backend:u,attrs:{dtype:"complex64"}}),c=u.data.get(l.dataId),h=c.complexTensorInfos.real,d=c.complexTensorInfos.imag,p=u.data.get(h.dataId).values,g=u.data.get(d.dataId).values,x=fl({inputs:{x:s},backend:u,attrs:{dtype:"complex64"}}),y=u.data.get(x.dataId),b=y.complexTensorInfos.real,C=y.complexTensorInfos.imag,E=u.data.get(b.dataId).values,S=u.data.get(C.dataId).values,[k,R,A]=e(i.shape,s.shape,p,g,E,S),N=u.makeTensorInfo(A,"float32",k),_=u.makeTensorInfo(A,"float32",R),$=Vo({inputs:{real:N,imag:_},backend:u});return u.disposeIntermediateTensorInfo(l),u.disposeIntermediateTensorInfo(x),u.disposeIntermediateTensorInfo(N),u.disposeIntermediateTensorInfo(_),$}else{const l=u.data.get(i.dataId).values,c=u.data.get(s.dataId).values,h=r||i.dtype,[d,p]=t(i.shape,s.shape,l,c,h);return u.makeTensorInfo(p,h,d)}}}function JT(n){return(t,e,r,o,a,i)=>{const s=Ee(t,e),u=It(s),l=s.length,c=ue(s),h=Jr("float32",u),d=Jr("float32",u),p=Gf(t,s),g=Gf(e,s),x=Qs(r,o),y=Qs(a,i),b=t.length,C=ue(t),E=e.length,S=ue(e);if(p.length+g.length===0)for(let k=0;k<h.length;k++){const R=k%x.length,A=k%y.length,N=n(x[R*2],x[R*2+1],y[A*2],y[A*2+1]);h[k]=N.real,d[k]=N.imag}else for(let k=0;k<h.length;k++){const R=cd(k,l,c),A=R.slice(-b);p.forEach(O=>A[O]=0);const N=Ki(A,b,C),_=R.slice(-E);g.forEach(O=>_[O]=0);const $=Ki(_,E,S),D=n(x[N*2],x[N*2+1],y[$*2],y[$*2+1]);h[k]=D.real,d[k]=D.imag}return[h,d,s]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HG=rr((n,t)=>n+t),B2t=JT((n,t,e,r)=>({real:n+e,imag:t+r})),jf=wr(hd,HG,B2t),z2t={kernelName:hd,backendName:"cpu",kernelFunc:jf};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tN(n,t,e,r,o){const a=It(r),i=to(o,e);for(let s=0;s<n.length;s++){const u=n[s];if(u<0)throw new Error("Input x must be non-negative!");u>=o||(a>0?i[u]+=t[s]:i[u]+=1)}return i}function qG(n,t,e,r=!1){const o=n.shape[0],a=n.shape[1],i=Ae([o,e],t.dtype);for(let s=0;s<o;s++)for(let u=0;u<a;u++){const l=n.get(s,u);if(l<0)throw new Error("Input x must be non-negative!");l>=e||(r?i.set(1,s,l):t.size>0?i.set(i.get(s,l)+t.get(s,u),s,l):i.set(i.get(s,l)+1,s,l))}return i}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jG=rr((n,t)=>n&t),U2t=wr(jI,jG),W2t={kernelName:jI,backendName:"cpu",kernelFunc:U2t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xs(n){return(t,e,r)=>{const o=Qn(e,t.length);for(let a=0;a<t.length;++a)o[a]=n(t[a],r);return o}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hn(n,t,e){const r=xs(t);return Tl(n,r,e)}function Tl(n,t,e){return({inputs:r,attrs:o,backend:a})=>{const{x:i}=r;Xt(i,n);const s=a,u=s.data.get(i.dataId).values;let l;if(i.dtype==="string"){if(!Array.isArray(u))throw new Error("String tensor's value was not an instance of Array");l=Zs(u)}else l=u;const c=e||i.dtype,h=t(l,c,o);return s.makeTensorInfo(i.shape,c,h)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XG=xs(n=>Math.ceil(n)),V2t=Tl(eg,XG),G2t={kernelName:eg,backendName:"cpu",kernelFunc:V2t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KG(n,t,e,r){const o=Qn(e,It(t));if(r&&e!=="string"){let a=0;n.forEach(i=>{const s=It(i.shape);o.set(i.vals,a),a+=s})}else{let a=0;n.forEach(i=>{const s=e==="string"?Zs(i.vals):i.vals;let u=0;for(let l=0;l<i.shape[0];++l){const c=l*t[1]+a;for(let h=0;h<i.shape[1];++h)o[c+h]=s[u++]}a+=i.shape[1]})}return o}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YG=rr((n,t)=>n===t?1:0),QG=wr(_1,YG,null,"bool"),H2t={kernelName:_1,backendName:"cpu",kernelFunc:QG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZG=xs(n=>Math.exp(n)),JG=Tl(ug,ZG,"float32"),q2t={kernelName:ug,backendName:"cpu",kernelFunc:JG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tH=xs(n=>Math.expm1(n)),j2t=Tl(lg,tH),X2t={kernelName:lg,backendName:"cpu",kernelFunc:j2t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eH=xs(n=>Math.floor(n)),K2t=Tl(cg,eH),Y2t={kernelName:cg,backendName:"cpu",kernelFunc:K2t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nH=rr((n,t)=>Math.floor(n/t)),Q2t=wr(hg,nH,null,"int32"),Z2t={kernelName:hg,backendName:"cpu",kernelFunc:Q2t};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rH(n,t,e,r,o,a,i,s,u){const l=Ae([r,a],e);for(let c=0;c<r;c++){const h=[];let d=0;for(let p=0;p<o;p++){const g=n[c*o+p];d+=g*i[p],h.push(g)}if(d<0||d>=u/a)throw new Error(`Invalid indices: ${h} does not index into ${s}`);for(let p=0;p<a;p++)l.values[c*a+p]=t.get(...t.indexToLoc(d*a+p))}return l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oH(n,t,e){const r=Ae(e,n.dtype);for(let o=0;o<r.size;++o){const i=r.indexToLoc(o).slice(),s=i[0],u=i[2],l=t.locToIndex([s,u]);i[2]=t.values[l];const c=n.locToIndex(i);0<=c&&c<n.values.length&&(r.values[o]=n.values[c])}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aH=rr((n,t)=>n>t?1:0),J2t=wr(F1,aH,null,"bool"),tCt={kernelName:F1,backendName:"cpu",kernelFunc:J2t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iH=rr((n,t)=>n>=t?1:0),eCt=wr(fg,iH,null,"bool"),nCt={kernelName:fg,backendName:"cpu",kernelFunc:eCt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sH=rr((n,t)=>n<t?1:0),rCt=wr(L1,sH,null,"bool"),oCt={kernelName:L1,backendName:"cpu",kernelFunc:rCt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uH=rr((n,t)=>n<=t?1:0),aCt=wr(P1,uH,null,"bool"),iCt={kernelName:P1,backendName:"cpu",kernelFunc:aCt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lH(n,t,e){const r=(t-n)/(e-1),o=to(e,"float32");o[0]=n;for(let a=1;a<o.length;a++)o[a]=o[a-1]+r;return o}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cH=xs(n=>Math.log(n)),sCt=Tl(vg,cH),uCt={kernelName:vg,backendName:"cpu",kernelFunc:sCt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hH(n,t,e,r){const o=Jr(r,It(e));for(let a=0;a<o.length;++a){const i=a*t;let s=n[i];for(let u=0;u<t;++u){const l=n[i+u];(Number.isNaN(l)||l>s)&&(s=l)}o[a]=s}return o}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fH=rr((n,t)=>Math.max(n,t)),lCt=wr(yg,fH),cCt={kernelName:yg,backendName:"cpu",kernelFunc:lCt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dH=rr((n,t)=>Math.min(n,t)),hCt=wr(bg,dH),fCt={kernelName:bg,backendName:"cpu",kernelFunc:hCt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eN=rr((n,t)=>n*t),dCt=JT((n,t,e,r)=>({real:n*e-t*r,imag:n*r+t*e})),zb=wr(Cg,eN,dCt),pCt={kernelName:Cg,backendName:"cpu",kernelFunc:zb};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pH(n,t,e){const r=wl(-1,e);return eN([],t,r,n,e)}function mCt(n){const{inputs:t,backend:e}=n,{x:r}=t;Xt(r,"neg");const o=e.data.get(r.dataId).values,[a,i]=pH(o,r.shape,r.dtype);return e.makeTensorInfo(i,r.dtype,a)}const gCt={kernelName:K1,backendName:"cpu",kernelFunc:mCt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mH=rr((n,t)=>n!==t?1:0),vCt=wr(Y1,mH,null,"bool"),xCt={kernelName:Y1,backendName:"cpu",kernelFunc:vCt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nN(n,t,e,r,o){const a=t.length,i=It(t),s=ue(t),u=ue(o),l=Jr(e,It(o));for(let c=0;c<i;++c){const h=cd(c,a,s),d=new Array(h.length);for(let g=0;g<d.length;g++)d[g]=h[r[g]];const p=Ki(d,a,u);l[p]=n[c]}return l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $o(n){const{inputs:t,attrs:e,backend:r}=n,{x:o}=t,{perm:a}=e;Xt(o,"transpose");const i=o.shape.length,s=new Array(i);for(let h=0;h<s.length;h++)s[h]=o.shape[a[h]];const u=r.data.get(o.dataId).values,l=nN(u,o.shape,o.dtype,a,s);return{dataId:r.write(l,s,o.dtype),shape:s,dtype:o.dtype}}const yCt={kernelName:If,backendName:"cpu",kernelFunc:$o};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gH(n,t,e,r){const[o,a]=Dr(n,r),i=Yo(t,"int32"),s=to(It(o),i),u=It(a);for(let l=0;l<s.length;++l){const c=l*u;let h=1;for(let d=0;d<u;++d)h*=e[c+d];s[l]=h}return{outVals:s,outShape:o,outDtype:i}}function bCt(n){const{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{axis:a,keepDims:i}=r;Xt(o,"prod");const s=o.shape.length,u=_e(a,o.shape),l=Pn(u,s);let c=u,h=o;const d=[];l!=null&&(h=$o({inputs:{x:o},backend:e,attrs:{perm:l}}),d.push(h),c=er(c.length,s));const p=e.data.get(h.dataId).values,{outVals:g,outShape:x,outDtype:y}=gH(h.shape,h.dtype,p,c);let b=x;return i&&(b=lr(x,u)),d.forEach(C=>e.disposeIntermediateTensorInfo(C)),e.makeTensorInfo(b,y,g)}const wCt={kernelName:nb,backendName:"cpu",kernelFunc:bCt};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CCt(n,t,e){n.forEach((r,o)=>{if(r<0||r>=e){const a=cd(o,t.length,ue(t)).join(",");throw new Error(`indices[${a}] = ${r} is not in [0, ${e})`)}})}function SCt(n,t){for(let e=0;e<n.length;++e){const r=n[e],o=e===n.length-1?t:n[e+1].length;if(r.length===0)throw new Error("Ragged splits may not be empty");if(r[0]<0)throw new Error("Ragged splits must be non-negative");if(r[r.length-1]>o)throw new Error("Ragged splits must not point past values");for(let a=1;a<r.length;++a)if(r[a-1]>r[a])throw new Error("Ragged splits must be sorted in ascending order")}}function ECt(n,t,e,r){const o=[];let a=0;const i=t.length-1+e.length,s=new Array(i).fill(null).map(()=>[0]);SCt(e,r);let u=1;for(let l=0;l<t.length-1;++l){u*=t[l];const c=t[l+1];for(let h=1;h<u+1;++h)s[l].push(h*c)}for(let l=0;l<n.length;++l){let c=n[l],h=n[l]+1;for(let d=0;d<e.length;++d){const p=e[d],g=d+t.length-1;if(g>=0){const x=s[g],y=x[x.length-1]-p[c];for(let b=c;b<h;++b)s[g].push(p[b+1]+y)}c=p[c],h=p[h]}h!==c&&(o.push([c,h]),a+=h-c)}return{outSplits:s,valueSlices:o,numValues:a}}function kCt(n){const t=[];for(let e=0;e<n.length;++e){const r=n[e].length,o=Qn("int32",r);t.push(o),n[e].forEach((a,i)=>o[i]=a)}return t}function EF(n,t){const e=n.slice(0,t);for(;e.length<t;)e.push(1);for(let r=t;r<n.length;r++)e[t-1]*=n[r];return e}function ICt(n,t,e,r,o,a){const i=EF(t,2)[1],s=EF(a,2)[1];let u=0;for(const l of e)for(let c=l[0];c<l[1];++c){for(let h=0;h<r;++h)o[u*s+h]=n[c*i+h];++u}}function RCt(n,t,e,r,o){const a=t.slice();a[0]=o;const i=Qn(e,It(a)),s=n.length,u=s===0?0:s/t[0];return ICt(n,t,r,u,i,a),[i,a]}function vH(n,t,e,r,o,a,i,s){if(n.length===0)throw new Error("paramsNestedSplits must be non empty");if(t[0].length===0)throw new Error("Split tensors must not be scalars");const u=t[0][0]-1;if(CCt(a,i,u),r.length===0)throw new Error("params.rank must be nonzero");const l=r[0],{outSplits:c,valueSlices:h,numValues:d}=ECt(a,i,n,l),p=kCt(c),g=RCt(e,r,o,h,d);return[p,g[0],g[1]]}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kF=2147483647;function xH(n,t,e,r,o,a,i){if(t.length>1)throw new Error("starts must be a scalar or vector");if(o.length>1)throw new Error("limits must be a scalar or vector");if(i.length>1)throw new Error("deltas must be a scalar or vector");const s=t.length===0,u=o.length===0,l=i.length===0,c=[];s||c.push(t[0]),u||c.push(o[0]),l||c.push(i[0]);for(let y=1;y<c.length;++y)if(c[y]!==c[y-1])throw new Error("starts, limits, and deltas must have the same shape");const h=c.length===0?1:c[0],d=Qn("int32",h+1);d[0]=0;for(let y=0;y<h;++y){const b=s?n[0]:n[y],C=u?r[0]:r[y],E=l?a[0]:a[y];if(E===0)throw new Error("Requires delta != 0");let S;if(E>0&&C<b||E<0&&C>b)S=0;else if(S=Math.ceil(Math.abs((C-b)/E)),S>kF)throw new Error(`Requires ((limit - start) / delta) <= ${kF}`);d[y+1]=d[y]+S}const p=d[h],g=Qn(e,p);let x=0;for(let y=0;y<h;++y){const b=d[y+1]-d[y];let C=s?n[0]:n[y];const E=l?a[0]:a[y];for(let S=0;S<b;++S)g[x++]=C,C+=E}return[d,g]}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Oa=si;class Ly{constructor(t,e,r,o,a,i,s,u,l,c){this.shape=t,this.shapeShape=e,this.values=r,this.valuesShape=o,this.valuesDType=a,this.defaultValue=i,this.defaultValueShape=s,this.rowPartitionValues=u,this.rowPartitionValuesShapes=l,this.rowPartitionTypes=rW(c),this.raggedRank=oW(this.rowPartitionTypes)}getRowPartitionTypeByDimension(t){return this.rowPartitionTypes[0]===Oa.FIRST_DIM_SIZE?this.rowPartitionTypes[t+1]:this.rowPartitionTypes[t]}getRowPartitionTensor(t){return this.rowPartitionTypes[0]===Oa.FIRST_DIM_SIZE?this.rowPartitionValues[t+1]:this.rowPartitionValues[t]}getMaxWidth(t){const e=this.getRowPartitionTensor(t-1);switch(this.getRowPartitionTypeByDimension(t-1)){case Oa.VALUE_ROWIDS:return Ly.getMaxWidthValueRowID(e);case Oa.ROW_SPLITS:return Ly.getMaxWidthRowSplit(e);default:throw new Error(`Cannot handle partition type ${Oa[this.getRowPartitionTypeByDimension(t-1)]}`)}}static getMaxWidthRowSplit(t){const e=t.length;if(e===0||e===1)return 0;let r=0;for(let o=0;o<e-1;++o){const a=t[o+1]-t[o];a>r&&(r=a)}return r}static getMaxWidthValueRowID(t){const e=t.length;if(e===0)return 0;let r=0,o=t[0],a=0;for(let i=1;i<e;++i){const s=t[i];s!==o&&(o=s,a=Math.max(i-r,a),r=i)}return Math.max(e-r,a)}tensorShapeFromTensor(t,e,r=!0){if(e.length===0){if(t[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return RF(t,r)}calculateOutputSize(t){const e=this.valuesShape,r=this.defaultValueShape;aW(r,e);const o=this.tensorShapeFromTensor(this.shape,this.shapeShape),i=nW(this.raggedRank,o,e);i[0]<0&&(i[0]=t);for(let s=1;s<=this.raggedRank;++s)i[s]<0&&(i[s]=this.getMaxWidth(s));return i}calculateFirstParentOutputIndex(t,e,r){const o=Math.min(t,r),a=[];let i=0;for(let s=0;s<o;++s,i+=e)a.push(i);for(let s=o;s<t;++s)a.push(-1);return H(a.length===t,()=>"Final length of result must be equal to firstDimension."),a}calculateOutputIndexRowSplit(t,e,r,o){const a=t.length,i=[];for(let s=0;s<a-1;++s){const u=t[s+1]-t[s];let l=Math.min(o,u),c=e[s];c===-1&&(l=0);for(let h=0;h<l;++h)i.push(c),c+=r;for(let h=0;h<u-l;++h)i.push(-1)}if(a>0&&i.length!==t[a-1])throw new Error("Invalid row split size.");return i}calculateOutputIndexValueRowID(t,e,r,o){const a=t.length,i=[];if(a===0)return[];let s=0,u=t[0];if(u>=e.length)throw new Error(`Got currentValueRowId=${u}, which is not less than ${e.length}`);let l=e[u];i.push(l);for(let c=1;c<a;++c){const h=t[c];if(h===u)l>=0&&(++s,s<o?l+=r:l=-1);else{if(s=0,u=h,h>=e.length)throw new Error(`Got nextValueRowId=${h} which is not less than ${e.length}`);l=e[h]}i.push(l)}if(i.length!==t.length)throw new Error("Invalid row ids.");return i}calculateOutputIndex(t,e,r,o){const a=this.getRowPartitionTensor(t),i=this.getRowPartitionTypeByDimension(t);switch(i){case Oa.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(a,e,r,o);case Oa.ROW_SPLITS:if(a.length-1>e.length)throw new Error(`Row partition size is greater than output size: ${a.length-1} > ${e.length}`);return this.calculateOutputIndexRowSplit(a,e,r,o);default:throw new Error(`Unsupported partition type: ${Oa[i]}`)}}getFirstDimensionSize(){const t=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");const e=this.rowPartitionTypes[0];switch(e){case Oa.FIRST_DIM_SIZE:return t[0];case Oa.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case Oa.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${Oa[e]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const e=this.getFirstDimensionSize(),r=this.calculateOutputSize(e),o=new Array(this.raggedRank+1);o[o.length-1]=1;for(let u=o.length-2;u>=0;--u)o[u]=o[u+1]*r[u+1];const a=RF(r,!1),i=Qn(this.valuesDType,It(a));if(o[0]*r[0]>0){let u=this.calculateFirstParentOutputIndex(e,o[0],r[0]);for(let l=1;l<=this.raggedRank;++l)u=this.calculateOutputIndex(l-1,u,o[l],r[l]);this.setOutput(this.raggedRank,u,i,a)}return[a,i]}setOutput(t,e,r,o){if(r.length===0)return;const a=this.values,i=r;let s=o.slice();s=s.slice(t+1);const u=It(s),l=e.length;let c=this.defaultValue;if(c.length!==u&&c.length!==1){const g=this.defaultValueShape;gt(()=>{const x=ht(c,g);c=Qp(x,s).dataSync()})}let h=0,d=0,p=0;for(let g=0;g<=l;++g){let x=g<l?e[g]:-1;if(x===p){++p;continue}if(d<p){const y=a.subarray(h*u),b=i.subarray(d*u),C=(p-d)*u;IF(b,y,C)}if(g>=l){const y=r.length;x=Math.floor(y/u)}if(x>p)if(this.defaultValue.length===1)i.subarray(p*u,x*u).fill(this.defaultValue[0]),p=x;else for(;x>p;){const y=i.slice(p*u);IF(y,c,u),++p}x<0?(h=g+1,d=p):(h=g,d=p,p=d+1)}}}function IF(n,t,e){for(let r=0;r<e;r++)n[r]=t[r]}function RF(n,t){const e=[];for(let r of n){if(r<0){if(!t)throw new Error(`Dimension ${r} must be >= 0`);if(r<-1)throw new Error(`Dimension ${r} must be >= -1`);r=-1}e.push(r)}return e}function yH(n,t,e,r,o,a,i,s,u,l){return new Ly(n,t,e,r,o,a,i,s,u,l).compute()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bH(n,t,e,r){const o=n===t,a=n<t&&e<0,i=t<n&&e>1;if(o||a||i)return to(0,r);const s=Math.abs(Math.ceil((t-n)/e)),u=to(s,r);t<n&&e===1&&(e=-1),u[0]=n;for(let l=1;l<u.length;l++)u[l]=u[l-1]+e;return u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wH=xs(n=>1/Math.sqrt(n)),TCt=Tl(Tg,wH),NCt={kernelName:Tg,backendName:"cpu",kernelFunc:TCt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fc(n,t,e,r,o,a,i,s,u,l){const c=[r/o,o],h=n.values,d=t.values;if(r===0)return Ae(e,t.dtype);const p=u instanceof Ur?u:Ae(c,t.dtype);typeof u=="string"||typeof u=="number"?p.values.fill(u):typeof u=="boolean"&&p.values.fill(+u);for(let g=0;g<a;g++){const x=[];let y=0;for(let b=0;b<i;b++){const C=h[g*i+b];x.push(C),y+=C*s[b]}if(y<0||y>=r/o)throw new Error(`Invalid indices: ${x} does not index into ${e}`);for(let b=0;b<o;b++)l?p.values[y*o+b]+=d[g*o+b]:p.values[y*o+b]=t.rank===0?d[0]:d[g*o+b]}return p}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ACt=xs(n=>1/(1+Math.exp(-n))),CH=hn($g,n=>1/(1+Math.exp(-n))),_Ct={kernelName:$g,backendName:"cpu",kernelFunc:CH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SH(n,t,e,r,o){const a=lT(r,t,e),i=It(e),s=ue(r);if(a){const h=cT(t,s);return o==="string"?n.slice(h,h+i):n.subarray(h,h+i)}const u=o==="string"?Zs(n):n,l=Ae(r,o,u),c=Ae(e,o);for(let h=0;h<c.size;++h){const d=c.indexToLoc(h),p=d.map((g,x)=>g+t[x]);c.set(l.get(...p),...d)}return o==="string"?kW(c.values):c.values}function Pc(n){const{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{begin:a,size:i}=r;Xt(o,"slice");const[s,u]=kb(o,a,i);sT(o,s,u);const l=e.data.get(o.dataId).values,c=SH(l,s,u,o.shape,o.dtype);return e.makeTensorInfo(u,o.dtype,c)}const DCt={kernelName:ub,backendName:"cpu",kernelFunc:Pc};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EH(n,t,e,r,o,a,i){const s=t[0],u=a[0],l=new Array(u),c=new Array(s),h=t[1];if(u===0){if(s!==0)throw new Error(fW(s));const y=Qn(e,0),b=Qn(o,0);return[y,[0,h],b,l,c]}let d=!0,p=0;const g=new Array(u).fill(0);for(let y=0;y<s;++y){const b=n[y*h];if(b<0)throw new Error(dW(y,b));if(b>=u)throw new Error(pW(y,b,u));++g[b],d=d&&b>=p,p=b}let x=!0;for(let y=0;y<u;++y){const b=g[y]===0;l[y]=b,x=x&&!b,g[y]=Math.max(g[y],1),y>0&&(g[y]+=g[y-1])}if(x&&d){const y=n,b=r;for(let C=0;C<s;++C)c[C]=C;return[y,[s,h],b,l,c]}else{const y=g[u-1],b=Qn(e,y*h),C=Qn(o,y),E=new Array(u).fill(0);for(let S=0;S<s;++S){const k=n[S*h],R=E[k],A=(k===0?0:g[k-1])+R;E[k]++;for(let N=0;N<h;++N)b[A*h+N]=n[S*h+N];C[A]=r[S],c[S]=A}for(let S=0;S<u;++S)if(E[S]===0){const R=S===0?0:g[S-1];b[R*h+0]=S;for(let A=1;A<h;++A)b[R*h+A]=0;C[R]=i}return[b,[y,h],C,l,c]}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kH(n,t,e,r,o){const a=It(r),i=t[0],s=o.length,u=[];let l=1,c=-1;for(let y=0;y<s;++y){const b=o[y];if(b===-1){if(c!==-1)throw new Error(mW(c,y));c=y,u.push(1)}else{if(b<0)throw new Error(gW(y,b));l*=b,u.push(b)}}if(c!==-1){if(l<=0)throw new Error(vW());const y=Math.trunc(a/l);if(l*y!==a)throw new Error(xW(r,u));u[c]=y}if(It(u)!==a)throw new Error(yW(r,u));const d=r.length,p=[];if(d>0){p[d-1]=1;for(let y=d-2;y>=0;--y)p[y]=p[y+1]*r[y+1]}const g=[];if(s>0){g[s-1]=1;for(let y=s-2;y>=0;--y)g[y]=g[y+1]*u[y+1]}const x=Qn(e,i*s);for(let y=0;y<i;++y){let b=0;for(let C=0;C<d;++C)b+=n[y*d+C]*p[C];for(let C=0;C<s;++C)x[y*s+C]=Math.trunc(b/g[C]),b%=g[C]}return[x,[i,s],u]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rN(n,t,e,r,o,a=!1,i=0){const s=r.length,u=[t[0],n.length/t[0]],l=u[1],h=s>0?o[s-1]+1:0;if(h<0)throw new Error(PE());const d=t.slice();d[0]=h;const p=d.reduce((E,S)=>E*S,1),g=Qn(e,p);if(s===0)return h>0&&g.fill(i),[g,d];if(h<=0)throw new Error(PE());let x=0,y=1,b=0,C=o[x];for(;;){let E=0;if(y<s){if(E=o[y],C===E){++y;continue}if(C>=E)throw new Error(bW())}if(C<0||C>=h)throw new Error(wW(C,h));C>b&&g.fill(i,b*l,C*l);for(let S=x;S<y;++S){const k=r[S];if(k<0||k>=u[0])throw new Error(CW(S,r[S],u[0]));for(let R=0;R<l;R++)g[C*l+R]+=n[k*l+R]}if(a)for(let S=0;S<l;S++)g[C*l+S]/=y-x;if(x=y,++y,b=C+1,C=E,y>s)break}return b<h&&g.fill(i,b*l,h*l),[g,d]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $Ct=xs(n=>Math.sqrt(n)),OCt=hn(Fg,n=>Math.sqrt(n)),FCt={kernelName:Fg,backendName:"cpu",kernelFunc:OCt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IH=rr((n,t)=>{const e=n-t;return e*e}),MCt=wr(Mg,IH),LCt={kernelName:Mg,backendName:"cpu",kernelFunc:MCt};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RH=xs((n,t)=>{const{pattern:e,replaceGlobal:r,rewrite:o}=t;return n.replace(new RegExp(e,r?"g":""),o)}),PCt=Tl(CR,RH),BCt={kernelName:CR,backendName:"cpu",kernelFunc:PCt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TH(n,t,e,r){const o=Ae(n,t.dtype);for(let a=0;a<o.size;a++){const i=o.indexToLoc(a),s=new Array(i.length);for(let u=0;u<s.length;u++)s[u]=i[u]*e[u]+r[u];o.set(t.get(...s),...i)}return o}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zCt{constructor(t,e,r,o,a,i){this.separator=Ju(t),this.nGramWidths=e,this.leftPad=Ju(r),this.rightPad=Ju(o),this.padWidth=a,this.preserveShort=i}getPadWidth(t){return Math.min(this.padWidth<0?t-1:this.padWidth,t-1)}getNumNGrams(t,e){const r=this.getPadWidth(e);return Math.max(0,t+2*r-e+1)}createNGrams(t,e,r,o,a,i){for(let s=0;s<a;++s){const u=this.getPadWidth(i),l=Math.max(0,u-s),c=Math.max(0,u-(a-(s+1))),h=i-(l+c),d=e+(l>0?0:s-u);let p=0;p+=l*this.leftPad.length;for(let C=0;C<h;++C)p+=t[d+C].length;p+=c*this.rightPad.length;const g=l+c+h-1;p+=g*this.separator.length,r[o+s]=new Uint8Array(p);const x=r[o+s];let y=0;const b=C=>C.forEach(E=>x[y++]=E);for(let C=0;C<l;++C)b(this.leftPad),b(this.separator);for(let C=0;C<h-1;++C)b(t[d+C]),b(this.separator);if(h>0){b(t[d+h-1]);for(let C=0;C<c;++C)b(this.separator),b(this.rightPad)}else{for(let C=0;C<c-1;++C)b(this.rightPad),b(this.separator);b(this.rightPad)}}}compute(t,e){const r=t.length,o=e.length;if(o>0){let u=e[0];if(u!==0)throw new Error(`First split value must be 0, got ${u}`);for(let l=1;l<o;++l){let c=e[l]>=u;if(c=c&&e[l]<=r,!c)throw new Error(`Invalid split value ${e[l]}, must be in [${u}, ${r}]`);u=e[l]}if(u!==r)throw new Error(`Last split value must be data size. Expected ${r}, got ${u}`)}const a=o-1,i=Qn("int32",o);if(r===0||o===0){const u=new Array(r);for(let l=0;l<=a;++l)i[l]=0;return[u,i]}i[0]=0;for(let u=1;u<=a;++u){const l=e[u]-e[u-1];let c=0;this.nGramWidths.forEach(h=>{c+=this.getNumNGrams(l,h)}),this.preserveShort&&l>0&&c===0&&(c=1),i[u]=i[u-1]+c}const s=new Array(i[a]);for(let u=0;u<a;++u){const l=e[u];let c=i[u];if(this.nGramWidths.forEach(h=>{const d=e[u+1]-e[u],p=this.getNumNGrams(d,h);this.createNGrams(t,l,s,c,p,h),c+=p}),this.preserveShort&&c===i[u]){const h=e[u+1]-e[u];if(h===0)continue;const d=h+2*this.padWidth;this.createNGrams(t,l,s,c,1,d)}}return[s,i]}}function NH(n,t,e,r,o,a,i,s){return new zCt(e,r,o,a,i,s).compute(n,t)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UCt(n,t,e,r){if(!n.length)return;if(t.length===0){for(let a=0;a<n.length;++a)r.push(n.subarray(a,a+1));return}if(t.length===1){const a=t[0];let i=n.indexOf(a);for(;i!==-1;){const s=n.subarray(0,i);(!e||s.length!==0)&&r.push(s),n=n.subarray(i+1),i=n.indexOf(a)}(!e||n.length!==0)&&r.push(n);return}let o=0;for(let a=0;a<n.length+1;a++)if(a===n.length||t.indexOf(n[a])!==-1){const i=n.subarray(o,a);(!e||i.length!==0)&&r.push(i),o=a+1}}function AH(n,t,e){const r=n.length,o=[];let a=0,i=0;const s=new Array(r);for(let d=0;d<r;++d){const p=o.length;UCt(n[d],t,e,o);const g=o.length-p;s[d]=g,a+=g,i=Math.max(i,g)}const u=Qn("int32",a*2),l=new Array(a),c=[r,i];let h=0;for(let d=0;d<r;++d)for(let p=0;p<s[d];++p)u[h*2]=d,u[h*2+1]=p,l[h]=o[h],++h;return[u,l,c]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _H(n,t){const e=Qn("int32",n.length);for(let r=0;r<n.length;++r)e[r]=ipt(n[r]).modulo(t).getLowBitsUnsigned();return e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DH=rr((n,t)=>n-t),WCt=JT((n,t,e,r)=>({real:n-e,imag:t-r})),oN=wr(Lg,DH,WCt),VCt={kernelName:Lg,backendName:"cpu",kernelFunc:oN};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $H(n,t){const e=new Array(n.rank);for(let o=0;o<e.length;o++)e[o]=n.shape[o]*t[o];const r=Ae(e,n.dtype);for(let o=0;o<r.values.length;++o){const a=r.indexToLoc(o),i=new Array(n.rank);for(let u=0;u<i.length;u++)i[u]=a[u]%n.shape[u];const s=n.locToIndex(i);r.values[o]=n.values[s]}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gp=(n,t)=>{const e=t.value-n.value;return e===0?n.index-t.index:e};function OH(n,t,e=0,r=n.length-1){for(;r>e;){if(r-e>600){const s=r-e+1,u=t-e+1,l=Math.log(s),c=.5*Math.exp(2*l/3),h=.5*Math.sqrt(l*c*(s-c)/s)*Math.sign(u-s/2),d=Math.max(e,Math.floor(t-u*c/s+h)),p=Math.min(r,Math.floor(t+(s-u)*c/s+h));OH(n,t,d,p)}const o=n[t];let a=e,i=r;for(cf(n,e,t),Gp(n[r],o)>0&&cf(n,e,r);a<i;){for(cf(n,a,i),a++,i--;Gp(n[a],o)<0;)a=a+1;for(;Gp(n[i],o)>0;)i=i-1}Gp(n[e],o)===0?cf(n,e,i):(i=i+1,cf(n,i,r)),i<=t&&(e=i+1),t<=i&&(r=i-1)}}function FH(n,t,e,r,o){const a=t[t.length-1],[i,s]=[n.length/a,a],u=Jr(e,i*r),l=Jr("int32",i*r);for(let h=0;h<i;h++){const d=h*s,p=n.subarray(d,d+s);let g=new Array(p.length);p.forEach((C,E)=>g[E]={value:C,index:E}),r<g.length&&(OH(g,r),g=g.slice(0,r)),o&&g.sort(Gp);const x=h*r,y=u.subarray(x,x+r),b=l.subarray(x,x+r);for(let C=0;C<r;C++)y[C]=g[C].value,b[C]=g[C].index}const c=t.slice();return c[c.length-1]=r,[Ae(c,e,u),Ae(c,"int32",l)]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MH(n,t,e,r){const o=_e(t,e)[0],a=[1,e[0],1];for(let g=0;g<o;g++)a[0]*=e[g];a[1]=e[o];for(let g=o+1;g<e.length;g++)a[2]*=e[g];const i=new Map,s=new Int32Array(e[o]),u=new Ur(a,r,n),l=[],c=a[0]===1&&a[2]===1;for(let g=0;g<e[o];g++){let x;if(c)x=n[g].toString();else{const b=[];for(let C=0;C<a[0];C++)for(let E=0;E<a[2];E++)b.push(u.get(C,g,E));x=b.join(",")}const y=i.get(x);if(y!=null)s[g]=y;else{const b=i.size;i.set(x,b),s[g]=b,l.push(g)}}const h=a.slice();h[1]=i.size;const d=new Ur(h,r);l.forEach((g,x)=>{for(let y=0;y<a[0];y++)for(let b=0;b<a[2];b++)d.set(u.get(y,g,b),y,x,b)});const p=e.slice();return p[o]=h[1],{outputValues:d.values,outputShape:p,indices:s}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GCt=Object.freeze(Object.defineProperty({__proto__:null,addImpl:HG,bincountImpl:tN,bincountReduceImpl:qG,bitwiseAndImpl:jG,castImpl:GG,ceilImpl:XG,concatImpl:KG,equalImpl:YG,expImpl:ZG,expm1Impl:tH,floorDivImpl:nH,floorImpl:eH,gatherNdImpl:rH,gatherV2Impl:oH,greaterEqualImpl:iH,greaterImpl:aH,lessEqualImpl:uH,lessImpl:sH,linSpaceImpl:lH,logImpl:cH,maxImpl:hH,maximumImpl:fH,minimumImpl:dH,multiplyImpl:eN,negImpl:pH,notEqualImpl:mH,prodImpl:gH,raggedGatherImpl:vH,raggedRangeImpl:xH,raggedTensorToTensorImpl:yH,rangeImpl:bH,rsqrtImpl:wH,scatterImpl:fc,sigmoidImpl:ACt,simpleAbsImpl:VG,sliceImpl:SH,sparseFillEmptyRowsImpl:EH,sparseReshapeImpl:kH,sparseSegmentReductionImpl:rN,sqrtImpl:$Ct,squaredDifferenceImpl:IH,staticRegexReplaceImpl:RH,stridedSliceImpl:TH,stringNGramsImpl:NH,stringSplitImpl:AH,stringToHashBucketFastImpl:_H,subImpl:DH,tileImpl:$H,topKImpl:FH,transposeImpl:nN,uniqueImpl:MH},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */tU("cpu",()=>new Bb,1);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LH=hn(ig,n=>n>=0?n:Math.exp(n)-1),HCt={kernelName:ig,backendName:"cpu",kernelFunc:LH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PH(n){const{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{alpha:a}=r;Xt([o],"leakyRelu");const i=It(o.shape),s=e.data.get(o.dataId).values,u=Jr("float32",i);for(let l=0;l<s.length;l++)u[l]=s[l]<0?a*s[l]:s[l];return e.makeTensorInfo(o.shape,"float32",u)}const qCt={kernelName:M1,backendName:"cpu",kernelFunc:PH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jCt=rr((n,t)=>n<0?t*n:n);function BH(n){const{inputs:t,backend:e}=n,{x:r,alpha:o}=t;Xt([r,o],"prelu");const a=e.data.get(r.dataId).values,i=e.data.get(o.dataId).values,[s,u]=jCt(r.shape,o.shape,a,i,"float32");return e.makeTensorInfo(u,"float32",s)}const XCt={kernelName:eb,backendName:"cpu",kernelFunc:BH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zH=hn(kg,n=>Math.max(0,n)),KCt={kernelName:kg,backendName:"cpu",kernelFunc:zH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UH=hn(Ig,n=>Math.min(Math.max(0,n),6)),YCt={kernelName:Ig,backendName:"cpu",kernelFunc:UH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Py(n,t,e,r,o){if(e==="linear")return us({inputs:{x:t},backend:n});if(e==="relu")return zH({inputs:{x:t},backend:n});if(e==="elu")return LH({inputs:{x:t},backend:n});if(e==="relu6")return UH({inputs:{x:t},backend:n});if(e==="prelu")return BH({inputs:{x:t,alpha:r},backend:n});if(e==="leakyrelu")return PH({inputs:{x:t},backend:n,attrs:{alpha:o}});if(e==="sigmoid")return CH({inputs:{x:t},backend:n});throw new Error(`Activation ${e} has not been implemented for the CPU backend.`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function In(n){const{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{shape:a}=r,i=It(o.shape),s=lz(a,i),u=It(s);H(i===u,()=>`The new shape (${s}) has ${u} elements and the old shape (${o.shape}) has ${i} elements. The new shape and old shape must have the same number of elements.`),e.incRef(o.dataId);const l=e.data.get(o.dataId);if(l.complexTensorInfos!=null){const c=l.complexTensorInfos.real,h=l.complexTensorInfos.imag;c.shape=s,h.shape=s}return{dataId:o.dataId,shape:s,dtype:o.dtype}}const QCt={kernelName:rb,backendName:"cpu",kernelFunc:In};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WH(n){const{inputs:t,backend:e,attrs:r}=n,{a:o,b:a}=t,{transposeA:i,transposeB:s}=r;Xt([o,a],"matMul");const u=o.shape.length,l=a.shape.length,c=i?o.shape[u-2]:o.shape[u-1],h=s?a.shape[l-1]:a.shape[l-2],d=i?o.shape[u-1]:o.shape[u-2],p=s?a.shape[l-2]:a.shape[l-1],g=o.shape.slice(0,-2),x=a.shape.slice(0,-2),y=It(g),b=It(x),E=Ee(o.shape.slice(0,-2),a.shape.slice(0,-2)).concat([d,p]);H(c===h,()=>`Error in matMul: inner shapes (${c}) and (${h}) of Tensors with shapes ${o.shape} and ${a.shape} and transposeA=${i} and transposeB=${s} must match.`);const S=i?[y,c,d]:[y,d,c],k=s?[b,p,h]:[b,h,p],R=In({inputs:{x:o},backend:e,attrs:{shape:S}}),A=In({inputs:{x:a},backend:e,attrs:{shape:k}}),N=i?R.shape[1]:R.shape[2],_=i?R.shape[2]:R.shape[1],$=s?A.shape[1]:A.shape[2],D=Math.max(y,b),O=e.data.get(R.dataId).values,P=e.data.get(A.dataId).values,z=ue(R.shape),W=ue(A.shape),[F,B,U]=i?[z[0],1,z[1]]:[z[0],z[1],1],[q,M,G]=s?[1,W[1],W[0]]:[W[1],1,W[0]],Q=_*$,Z=Ae([D,_,$],R.dtype),rt=Z.values,ct=e.blockSize;for(let pt=0;pt<D;pt++){const Rt=pt%y,Ct=pt%b;for(let Ft=0;Ft<_;Ft+=ct){const Ut=Math.min(Ft+ct,_);for(let Pt=0;Pt<$;Pt+=ct){const Vt=Math.min(Pt+ct,$);for(let Ht=0;Ht<N;Ht+=ct){const ee=Math.min(Ht+ct,N);for(let te=Ft;te<Ut;te++)for(let ne=Pt;ne<Vt;ne++){let ge=0;for(let we=Ht;we<ee;we++){const en=O[Rt*F+te*B+we*U],ze=P[we*q+ne*M+Ct*G];ge+=en*ze}rt[pt*Q+(te*$+ne)]+=ge}}}}}return e.disposeIntermediateTensorInfo(R),e.disposeIntermediateTensorInfo(A),e.makeTensorInfo(E,Z.dtype,Z.values)}const ZCt={kernelName:w1,backendName:"cpu",kernelFunc:WH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JCt(n){const{inputs:t,backend:e,attrs:r}=n,{a:o,b:a,bias:i,preluActivationWeights:s}=t,{transposeA:u,transposeB:l,activation:c,leakyreluAlpha:h}=r;let d,p,g;const x=[];d=WH({inputs:{a:o,b:a},attrs:{transposeA:u,transposeB:l},backend:e}),i&&(p=jf({inputs:{a:d,b:i},backend:e}),x.push(d),d=p),c&&(g=Py(e,d,c,s,h),x.push(d),d=g);for(const b of x)e.disposeIntermediateTensorInfo(b);return d}const tSt={kernelName:xy,backendName:"cpu",kernelFunc:JCt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eSt=hn(jm,n=>Math.acos(n)),nSt={kernelName:jm,backendName:"cpu",kernelFunc:eSt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rSt=hn(Xm,n=>Math.acosh(n)),oSt={kernelName:Xm,backendName:"cpu",kernelFunc:rSt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aSt(n){const{inputs:t,backend:e}=n,r=t;Xt(t,"addN");const o=r.map(s=>e.data.get(s.dataId).values),a=Ae(r[0].shape,r[0].dtype),i=a.values;for(let s=0;s<r.length;s++){const u=o[s];for(let l=0;l<i.length;l++)i[l]+=u[l]}return e.makeTensorInfo(a.shape,a.dtype,a.values)}const iSt={kernelName:UI,backendName:"cpu",kernelFunc:aSt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sSt(n){const{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{axis:a,keepDims:i}=r;Xt(o,"all");const s=_e(a,o.shape);let u=s;const l=Pn(u,o.shape.length);let c=o;l!=null&&(c=$o({inputs:{x:o},backend:e,attrs:{perm:l}}),u=er(u.length,o.shape.length)),Gr("all",u,c.shape.length);const[h,d]=Dr(c.shape,u),p=It(d),g=to(It(h),c.dtype),x=e.data.get(c.dataId).values;for(let b=0;b<g.length;++b){const C=b*p;let E=x[C];for(let S=0;S<p;++S){const k=x[C+S];E=E&&k}g[b]=E}l!=null&&e.disposeIntermediateTensorInfo(c);const y=e.makeTensorInfo(h,c.dtype,g);if(i){const b=lr(h,s),C=In({inputs:{x:y},backend:e,attrs:{shape:b}});return e.disposeIntermediateTensorInfo(y),C}return y}const uSt={kernelName:WI,backendName:"cpu",kernelFunc:sSt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lSt(n){const{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{axis:a,keepDims:i}=r;Xt(o,"any");const s=_e(a,o.shape);let u=s;const l=Pn(u,o.shape.length);let c=o;l!=null&&(c=$o({inputs:{x:o},backend:e,attrs:{perm:l}}),u=er(u.length,o.shape.length)),Gr("any",u,c.shape.length);const[h,d]=Dr(c.shape,u),p=It(d),g=to(It(h),c.dtype),x=e.data.get(c.dataId).values;for(let b=0;b<g.length;++b){const C=b*p;let E=x[C];for(let S=0;S<p;++S){const k=x[C+S];E=E||k}g[b]=E}l!=null&&e.disposeIntermediateTensorInfo(c);const y=e.makeTensorInfo(h,c.dtype,g);if(i){const b=lr(h,s),C=In({inputs:{x:y},backend:e,attrs:{shape:b}});return e.disposeIntermediateTensorInfo(y),C}return y}const cSt={kernelName:VI,backendName:"cpu",kernelFunc:lSt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hSt(n){const{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{axis:a}=r;Xt(o,"argMax");let i=_e(a,o.shape);const s=Pn(i,o.shape.length);let u=o;const l=[];s!=null&&(u=$o({inputs:{x:o},backend:e,attrs:{perm:s}}),l.push(u),i=er(i.length,u.shape.length)),i=[i[0]],Gr("argMax",i,u.shape.length);const[c,h]=Dr(u.shape,i),d=It(c),p=to(d,"int32"),g=It(h),x=e.data.get(u.dataId).values;for(let y=0;y<p.length;++y){const b=y*g;let C=x[b],E=0;for(let S=0;S<g;++S){const k=x[b+S];k>C&&(C=k,E=S)}p[y]=E}return l.forEach(y=>e.disposeIntermediateTensorInfo(y)),e.makeTensorInfo(c,"int32",p)}const fSt={kernelName:v1,backendName:"cpu",kernelFunc:hSt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dSt(n){const{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{axis:a}=r;Xt(o,"argMin");let i=_e(a,o.shape);const s=Pn(i,o.shape.length);let u=o;const l=[];s!=null&&(u=$o({inputs:{x:o},backend:e,attrs:{perm:s}}),l.push(u),i=er(i.length,u.shape.length)),i=[i[0]],Gr("argMin",i,u.shape.length);const[c,h]=Dr(u.shape,i),d=It(c),p=to(d,"int32"),g=It(h),x=e.data.get(u.dataId).values;for(let y=0;y<p.length;++y){const b=y*g;let C=x[b],E=0;for(let S=0;S<g;++S){const k=x[b+S];k<C&&(C=k,E=S)}p[y]=E}return l.forEach(y=>e.disposeIntermediateTensorInfo(y)),e.makeTensorInfo(c,"int32",p)}const pSt={kernelName:x1,backendName:"cpu",kernelFunc:dSt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mSt=hn(Km,n=>Math.asin(n)),gSt={kernelName:Km,backendName:"cpu",kernelFunc:mSt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vSt=hn(Ym,n=>Math.asinh(n)),xSt={kernelName:Ym,backendName:"cpu",kernelFunc:vSt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ySt=hn(Qm,n=>Math.atan(n)),bSt={kernelName:Qm,backendName:"cpu",kernelFunc:ySt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wSt=rr((n,t)=>Math.atan2(n,t)),CSt=wr(Jm,wSt),SSt={kernelName:Jm,backendName:"cpu",kernelFunc:CSt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ESt=hn(Zm,n=>Math.atanh(n)),kSt={kernelName:Zm,backendName:"cpu",kernelFunc:ESt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aN(n,t,e,r,o,a){const i=o.strideHeight,s=o.strideWidth,u=o.dilationHeight,l=o.dilationWidth,c=o.effectiveFilterHeight,h=o.effectiveFilterWidth,d=o.padInfo.top,p=o.padInfo.left,g=a==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,x=Ae(o.outShape,e),y=x.values,b=o.outShape[1]*o.outShape[2]*o.outShape[3],C=o.outShape[2]*o.outShape[3],E=o.outShape[3];for(let S=0;S<o.batchSize;++S){const k=S*b,R=S*r[0];for(let A=0;A<o.inChannels;++A)for(let N=0;N<o.outHeight;++N){const _=N*i-d,$=Math.max(0,_),D=Math.min(o.inHeight,c+_),O=k+N*C;for(let P=0;P<o.outWidth;++P){const z=P*s-p,W=Math.max(0,z),F=Math.min(o.inWidth,h+z);let B=g,U=0,q=0;for(let G=$;G<D;G+=u){const Q=R+G*r[1];for(let Z=W;Z<F;Z+=l){const rt=Q+Z*r[2],ct=n[rt+A];a==="max"&&ct>B?B=ct:a==="avg"&&(U+=ct,q++)}if(isNaN(B))break}const M=O+P*E+A;y[M]=a==="avg"?U/q:B}}}return x}function VH(n,t,e,r,o=!1,a=!1){const i=Ae(r.outShape,"int32"),s=r.strideHeight,u=r.strideWidth,l=r.dilationHeight,c=r.dilationWidth,h=r.effectiveFilterHeight,d=r.effectiveFilterWidth,p=r.padInfo.top,g=r.padInfo.left,x=Ae(t,e,n);for(let y=0;y<r.batchSize;++y)for(let b=0;b<r.inChannels;++b)for(let C=0;C<r.outHeight;++C){const E=C*s-p;let S=E;for(;S<0;)S+=l;const k=Math.min(r.inHeight,h+E);for(let R=0;R<r.outWidth;++R){const A=R*u-g;let N=A;for(;N<0;)N+=c;const _=Math.min(r.inWidth,d+A);let $=Number.NEGATIVE_INFINITY,D=-1;for(let O=S;O<k;O+=l){const P=O-E;for(let z=N;z<_;z+=c){const W=z-A,F=x.get(y,O,z,b);F>$&&($=F,o?D=a?((y*r.inHeight+O)*r.inWidth+z)*r.inChannels+b:(O*r.inWidth+z)*r.inChannels+b:D=P*d+W)}}i.set(D,y,C,R,b)}}return i}function GH(n,t,e,r,o,a){const i=o.strideDepth,s=o.strideHeight,u=o.strideWidth,l=o.dilationDepth,c=o.dilationHeight,h=o.dilationWidth,d=o.effectiveFilterDepth,p=o.effectiveFilterHeight,g=o.effectiveFilterWidth,x=o.padInfo.front,y=o.padInfo.top,b=o.padInfo.left,C=a==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,E=Ae(o.outShape,e),S=E.values,k=o.outShape[1]*o.outShape[2]*o.outShape[3]*o.outShape[4],R=o.outShape[2]*o.outShape[3]*o.outShape[4],A=o.outShape[3]*o.outShape[4],N=o.outShape[4];for(let _=0;_<o.batchSize;++_){const $=_*k,D=_*r[0];for(let O=0;O<o.inChannels;++O)for(let P=0;P<o.outDepth;++P){const z=P*i-x;let W=z;for(;W<0;)W+=l;const F=Math.min(o.inDepth,d+z),B=$+P*R;for(let U=0;U<o.outHeight;++U){const q=U*s-y;let M=q;for(;M<0;)M+=c;const G=Math.min(o.inHeight,p+q),Q=B+U*A;for(let Z=0;Z<o.outWidth;++Z){const rt=Z*u-b;let ct=rt;for(;ct<0;)ct+=h;const pt=Math.min(o.inWidth,g+rt),Rt=Q+Z*N;let Ct=C,Ft=0,Ut=0;for(let Vt=W;Vt<F;Vt+=l){const Ht=D+Vt*r[1];for(let ee=M;ee<G;ee+=c){const te=Ht+ee*r[2];for(let ne=ct;ne<pt;ne+=h){const ge=te+ne*r[3],we=n[ge+O];if(a==="max"&&we>Ct?Ct=we:a==="avg"&&(Ft+=we,Ut++),isNaN(Ct))break}if(isNaN(Ct))break}if(isNaN(Ct))break}const Pt=Rt+O;S[Pt]=a==="avg"?Ft/Math.max(Ut,1):Ct}}}}return E}function ISt(n,t){const e=Ae(t.outShape,"int32"),r=t.strideDepth,o=t.strideHeight,a=t.strideWidth,i=t.dilationDepth,s=t.dilationHeight,u=t.dilationWidth,l=t.effectiveFilterDepth,c=t.effectiveFilterHeight,h=t.effectiveFilterWidth,d=t.padInfo.front,p=t.padInfo.top,g=t.padInfo.left;for(let x=0;x<t.batchSize;++x)for(let y=0;y<t.inChannels;++y)for(let b=0;b<t.outDepth;++b){const C=b*r-d;let E=C;for(;E<0;)E+=i;const S=Math.min(t.inDepth,l+C);for(let k=0;k<t.outHeight;++k){const R=k*o-p;let A=R;for(;A<0;)A+=s;const N=Math.min(t.inHeight,c+R);for(let _=0;_<t.outWidth;++_){const $=_*a-g;let D=$;for(;D<0;)D+=u;const O=Math.min(t.inWidth,h+$);let P=Number.NEGATIVE_INFINITY,z=-1;for(let W=E;W<S;W+=i){const F=W-C;for(let B=A;B<N;B+=s){const U=B-R;for(let q=D;q<O;q+=u){const M=q-$,G=n.get(x,W,B,q,y);G>=P&&(P=G,z=F*c*h+U*c+M)}}}e.set(z,x,b,k,_,y)}}}return e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RSt(n){const{inputs:t,backend:e,attrs:r}=n,{x:o}=t;Xt(o,"avgPool");const{filterSize:a,strides:i,pad:s,dimRoundingMode:u}=r,l=1;H(ro(i,l),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${l}'`);const c=Ya(o.shape,a,i,l,s,u);let h;if(c.filterWidth===1&&c.filterHeight===1&&tn(c.inShape,c.outShape))h=us({inputs:{x:o},backend:e});else{const d=e.data.get(o.dataId).values,p=ue(o.shape),g=aN(d,o.shape,o.dtype,p,c,"avg");h=e.makeTensorInfo(c.outShape,o.dtype,g.values)}return h}const TSt={kernelName:y1,backendName:"cpu",kernelFunc:RSt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NSt(n){const{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{filterSize:a,strides:i,pad:s,dimRoundingMode:u,dataFormat:l}=r;Xt(o,"avgPool3d");const c=hu(o.shape,a,i,1,s,u,l),h=e.data.get(o.dataId).values,d=GH(h,o.shape,o.dtype,ue(o.shape),c,"avg");return e.makeTensorInfo(d.shape,"float32",d.values)}const ASt={kernelName:b1,backendName:"cpu",kernelFunc:NSt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _St(n){const{inputs:t,backend:e,attrs:r}=n,{dy:o,input:a}=t,{filterSize:i,strides:s,pad:u,dimRoundingMode:l}=r;Xt([o,a],"avgPool3DGrad");const c=hu(a.shape,i,s,1,u,l),h=c.strideDepth,d=c.strideHeight,p=c.strideWidth,g=c.filterDepth,x=c.filterHeight,y=c.filterWidth,b=c.dilationDepth,C=c.dilationHeight,E=c.dilationWidth,S=c.effectiveFilterDepth,k=c.effectiveFilterHeight,R=c.effectiveFilterWidth,A=S-1-c.padInfo.front,N=R-1-c.padInfo.left,_=k-1-c.padInfo.top,$=Ae(a.shape,"float32"),D=1/(g*x*y),O=e.bufferSync(o);for(let P=0;P<c.batchSize;++P)for(let z=0;z<c.inChannels;++z)for(let W=0;W<c.inDepth;++W)for(let F=0;F<c.inHeight;++F)for(let B=0;B<c.inWidth;++B){const U=W-A,q=F-_,M=B-N;let G=0;for(let Q=0;Q<S;Q+=b){const Z=(U+Q)/h;if(!(Z<0||Z>=c.outDepth||Math.floor(Z)!==Z))for(let rt=0;rt<k;rt+=C){const ct=(q+rt)/d;if(!(ct<0||ct>=c.outHeight||Math.floor(ct)!==ct))for(let pt=0;pt<R;pt+=E){const Rt=(M+pt)/p;if(Rt<0||Rt>=c.outWidth||Math.floor(Rt)!==Rt)continue;const Ct=O.get(P,Z,ct,Rt,z);G+=Ct}}}$.set(G*D,P,W,F,B,z)}return e.makeTensorInfo($.shape,$.dtype,$.values)}const DSt={kernelName:HI,backendName:"cpu",kernelFunc:_St};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $St(n){const{inputs:t,backend:e,attrs:r}=n,{dy:o,input:a}=t,i=a;Xt([o,a],"avgPoolGrad");const{filterSize:s,strides:u,pad:l}=r,c=Ya(i.shape,s,u,1,l),h=c.strideHeight,d=c.strideWidth,p=c.filterHeight,g=c.filterWidth,x=c.dilationHeight,y=c.dilationWidth,b=c.effectiveFilterHeight,C=c.effectiveFilterWidth,E=C-1-c.padInfo.left,S=b-1-c.padInfo.top,k=Ae(i.shape,"float32"),R=1/(p*g),A=e.data.get(o.dataId).values,N=Ae(o.shape,"float32",A);for(let _=0;_<c.batchSize;++_)for(let $=0;$<c.inChannels;++$)for(let D=0;D<c.inHeight;++D)for(let O=0;O<c.inWidth;++O){const P=D-S,z=O-E;let W=0;for(let F=0;F<b;F+=x){const B=(P+F)/h;if(!(B<0||B>=c.outHeight||Math.floor(B)!==B))for(let U=0;U<C;U+=y){const q=(z+U)/d;if(q<0||q>=c.outWidth||Math.floor(q)!==q)continue;const M=N.get(_,B,q,$);W+=M}}k.set(W*R,_,D,O,$)}return e.makeTensorInfo(k.shape,k.dtype,k.values)}const OSt={kernelName:GI,backendName:"cpu",kernelFunc:$St};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FSt(n){const{inputs:t,backend:e,attrs:r}=n,{x:o,scale:a,offset:i,mean:s,variance:u}=t;H(s.shape.length===u.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),H(i==null||s.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),H(a==null||s.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),Xt([o,s,u,a,i],"batchNorm");let{varianceEpsilon:l}=r;l==null&&(l=.001);const c=e.data.get(o.dataId).values,h=e.data.get(s.dataId).values,d=e.data.get(u.dataId).values,p=a?e.data.get(a.dataId).values:new Float32Array([1]),g=i?e.data.get(i.dataId).values:new Float32Array([0]),x=new Float32Array(c.length),y=g.length,b=p.length,C=d.length,E=h.length;let S=0,k=0,R=0,A=0;for(let N=0;N<c.length;++N)x[N]=g[S++]+(c[N]-h[k++])*p[R++]/Math.sqrt(d[A++]+l),S>=y&&(S=0),k>=E&&(k=0),R>=b&&(R=0),A>=C&&(A=0);return e.makeTensorInfo(o.shape,o.dtype,x)}const MSt={kernelName:$1,backendName:"cpu",kernelFunc:FSt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LSt(n){const{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{blockShape:a,crops:i}=r;Xt([o],"batchToSpaceND");const s=a.reduce((b,C)=>b*C),u=jg(o.shape,a,s),l=Xg(u.length,a.length),c=Kg(o.shape,a,s),h=mT(i,a.length),d=gT(c,i,a.length),p=In({inputs:{x:o},backend:e,attrs:{shape:u}}),g=$o({inputs:{x:p},backend:e,attrs:{perm:l}}),x=In({inputs:{x:g},backend:e,attrs:{shape:c}}),y=Pc({inputs:{x},backend:e,attrs:{begin:h,size:d}});return e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(g),e.disposeIntermediateTensorInfo(x),y}const PSt={kernelName:C1,backendName:"cpu",kernelFunc:LSt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BSt(n){const{inputs:t,backend:e,attrs:r}=n,{x:o,weights:a}=t,{size:i}=r,s=e.data.get(o.dataId).values,u=e.data.get(a.dataId).values,l=tN(s,u,a.dtype,a.shape,i);return e.makeTensorInfo([i],a.dtype,l)}const zSt={kernelName:qI,backendName:"cpu",kernelFunc:BSt};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function USt(n){const{inputs:t,backend:e}=n,{s0:r,s1:o}=t,a=e.data.get(r.dataId).values,i=e.data.get(o.dataId).values,s=Ee(Array.from(a),Array.from(i));return e.makeTensorInfo([s.length],"int32",Int32Array.from(s))}const WSt={kernelName:mz,backendName:"cpu",kernelFunc:USt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VSt=hn(ng,(n,t)=>{const e=t;return n>e.clipValueMax?e.clipValueMax:n<e.clipValueMin?e.clipValueMin:n}),GSt={kernelName:ng,backendName:"cpu",kernelFunc:VSt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HSt=n=>{const{x:t}=n.inputs,e=n.backend,r=new Float32Array(It(t.shape)),o=e.data.get(t.dataId),a=o.complexTensorInfos.real,i=o.complexTensorInfos.imag,s=e.data.get(a.dataId).values,u=e.data.get(i.dataId).values;for(let l=0;l<s.length;l++){const c=s[l],h=u[l];r[l]=Math.hypot(c,h)}return e.makeOutput(r,t.shape,"float32")},qSt={kernelName:S1,backendName:"cpu",kernelFunc:HSt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xf(n){const{inputs:t,backend:e}=n,{input:r}=t,o=e.data.get(r.dataId).complexTensorInfos.imag,a=e.data.get(o.dataId).values;return e.makeTensorInfo(o.shape,o.dtype,a)}const jSt={kernelName:cR,backendName:"cpu",kernelFunc:Xf};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kf(n){const{inputs:t,backend:e,attrs:r}=n,{axis:o}=r,a=_e(o,t[0].shape)[0],i=t.map(x=>x.shape);fT(i,a);let s=Qi(t.map(x=>x.shape),a);if(It(s)===0)return e.makeTensorInfo(s,t[0].dtype,[]);const u=t.filter(x=>It(x.shape)>0);if(u.length===1)return us({inputs:{x:u[0]},backend:e});if(u[0].dtype==="complex64"){const x=u.map(S=>Lc({inputs:{input:S},backend:e})),y=u.map(S=>Xf({inputs:{input:S},backend:e})),b=Kf({inputs:x,backend:e,attrs:{axis:a}}),C=Kf({inputs:y,backend:e,attrs:{axis:a}}),E=Vo({inputs:{real:b,imag:C},backend:e});return x.forEach(S=>e.disposeIntermediateTensorInfo(S)),y.forEach(S=>e.disposeIntermediateTensorInfo(S)),e.disposeIntermediateTensorInfo(b),e.disposeIntermediateTensorInfo(C),E}const l=u.map(x=>{const b=[-1,It(x.shape.slice(a))];return In({inputs:{x},backend:e,attrs:{shape:b}})}),c=l.map(x=>({vals:e.data.get(x.dataId).values,shape:x.shape}));s=Qi(l.map(x=>x.shape),1);const h=l[0].shape[0]===1,d=KG(c,s,t[0].dtype,h),p=Qi(u.map(x=>x.shape),a),g=e.makeTensorInfo(p,t[0].dtype,d);return l.forEach(x=>e.disposeIntermediateTensorInfo(x)),g}const XSt={kernelName:E1,backendName:"cpu",kernelFunc:Kf};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HH(n){const{inputs:t,backend:e,attrs:r}=n,{x:o,filter:a}=t,{strides:i,pad:s,dataFormat:u,dilations:l,dimRoundingMode:c}=r;Xt([o,a],"conv2d");const h=fu(u),d=Vr(o.shape,a.shape,i,l,s,c,!1,h),p=d.filterHeight,g=d.filterWidth,x=d.dilationHeight,y=d.dilationWidth,b=d.padInfo.left,C=d.padInfo.top,E=d.dataFormat==="channelsLast",S=new Ur(d.outShape,o.dtype),k=ue(o.shape),R=ue(a.shape),A=k[0],N=E?k[1]:k[2],_=E?k[2]:1,$=E?1:k[1],D=S.strides[0],O=E?S.strides[1]:S.strides[2],P=E?S.strides[2]:1,z=E?1:S.strides[1],W=e.data.get(o.dataId).values,F=e.data.get(a.dataId).values,B=S.values;for(let U=0;U<d.batchSize;++U){const q=U*A,M=U*D;for(let G=0;G<d.outHeight;++G){const Q=M+G*O,Z=G*d.strideHeight-C;for(let rt=0;rt<p;++rt){const ct=Z+rt*x;if(ct<0||ct>=d.inHeight)continue;const pt=rt*R[0],Rt=q+ct*N;for(let Ct=0;Ct<d.outWidth;++Ct){const Ft=Q+Ct*P,Ut=Ct*d.strideWidth-b;for(let Pt=0;Pt<g;++Pt){const Vt=Ut+Pt*y;if(Vt<0||Vt>=d.inWidth)continue;const Ht=pt+Pt*R[1],ee=Rt+Vt*_;let te=Ht;for(let ne=0;ne<d.inChannels;++ne){const ge=W[ee+ne*$];for(let we=0;we<d.outChannels;++we)B[Ft+we*z]+=ge*F[te+we];te+=d.outChannels}}}}}}return e.makeTensorInfo(S.shape,S.dtype,B)}const KSt={kernelName:k1,backendName:"cpu",kernelFunc:HH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YSt(n){const{inputs:t,backend:e,attrs:r}=n,{x:o,dy:a}=t,{strides:i,pad:s,dataFormat:u,dimRoundingMode:l,filterShape:c}=r;Xt([o,a],"conv2dBackpropFilter");const h=fu(u),d=Vr(o.shape,c,i,1,s,l,!1,h),{strideHeight:p,strideWidth:g,filterHeight:x,filterWidth:y}=d,b=d.dataFormat==="channelsLast",C=new Ur(d.filterShape,"float32"),E=d.padInfo.left,S=d.padInfo.top,k=e.data.get(o.dataId).values,R=e.data.get(a.dataId).values,A=new Ur(o.shape,o.dtype,k),N=new Ur(a.shape,a.dtype,R);for(let _=0;_<x;++_){const $=Math.max(0,Math.ceil((S-_)/p)),D=Math.min(d.outHeight,(d.inHeight+S-_)/p);for(let O=0;O<y;++O){const P=Math.max(0,Math.ceil((E-O)/g)),z=Math.min(d.outWidth,(d.inWidth+E-O)/g);for(let W=0;W<d.inChannels;++W)for(let F=0;F<d.outChannels;++F){let B=0;for(let U=0;U<d.batchSize;++U)for(let q=$;q<D;++q){const M=_+q*p-S;for(let G=P;G<z;++G){const Q=O+G*g-E;b?B+=A.get(U,M,Q,W)*N.get(U,q,G,F):B+=A.get(U,W,M,Q)*N.get(U,F,q,G)}}C.set(B,_,O,W,F)}}}return e.makeTensorInfo(C.shape,C.dtype,C.values)}const QSt={kernelName:KI,backendName:"cpu",kernelFunc:YSt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZSt(n){const{inputs:t,backend:e,attrs:r}=n,{dy:o,filter:a}=t,{inputShape:i,strides:s,pad:u,dataFormat:l,dimRoundingMode:c}=r;Xt([o,a],"conv2dBackpropInput");const h=ue(a.shape),d=ue(o.shape);let p=fu(l);const g=Vr(i,a.shape,s,1,u,c,!1,p),x=new Ur(g.inShape,"float32"),y=x.values,b=e.data.get(o.dataId).values,C=e.data.get(a.dataId).values,[E,S,k]=h,{batchSize:R,filterHeight:A,filterWidth:N,inChannels:_,inHeight:$,inWidth:D,outChannels:O,outHeight:P,outWidth:z,strideHeight:W,strideWidth:F}=g;p=g.dataFormat;const B=A-1-g.padInfo.top,U=N-1-g.padInfo.left,q=p==="channelsLast",M=x.strides[0],G=q?x.strides[1]:x.strides[2],Q=q?x.strides[2]:1,Z=q?1:x.strides[1],rt=d[0],ct=q?d[1]:d[2],pt=q?d[2]:1,Rt=q?1:d[1];for(let Ct=0;Ct<R;++Ct)for(let Ft=0;Ft<_;++Ft)for(let Ut=0;Ut<$;++Ut){const Pt=Ut-B,Vt=Math.max(0,Math.ceil(Pt/W)),Ht=Math.min(P,(A+Pt)/W);for(let ee=0;ee<D;++ee){const te=ee-U,ne=Math.max(0,Math.ceil(te/F)),ge=Math.min(z,(N+te)/F);let we=0;for(let ze=Vt;ze<Ht;++ze){const un=ze*W-Pt;for(let nn=ne;nn<ge;++nn){const Gn=nn*F-te,Dn=rt*Ct+ct*ze+pt*nn,Bn=E*(A-1-un)+S*(N-1-Gn)+k*Ft;for(let cr=0;cr<O;++cr){const Ge=b[Dn+Rt*cr],mn=C[Bn+cr];we+=Ge*mn}}}const en=M*Ct+G*Ut+Q*ee+Z*Ft;y[en]=we}}return e.makeTensorInfo(x.shape,x.dtype,x.values)}const JSt={kernelName:I1,backendName:"cpu",kernelFunc:ZSt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tEt(n){const{inputs:t,backend:e,attrs:r}=n,{x:o,filter:a}=t,{strides:i,pad:s,dilations:u}=r;Xt([o,a],"conv3d");const l=Cl(o.shape,a.shape,i,u,s),{filterDepth:c,filterHeight:h,filterWidth:d,dilationDepth:p,dilationHeight:g,dilationWidth:x,padInfo:y}=l,b=y.front,C=y.left,E=y.top,S=new Ur(l.outShape,o.dtype),k=e.data.get(o.dataId).values,R=e.data.get(a.dataId).values,A=S.values,N=ue(o.shape),_=ue(a.shape);for(let $=0;$<l.batchSize;++$){const D=$*N[0],O=$*S.strides[0];for(let P=0;P<l.outDepth;++P){const z=O+P*S.strides[1],W=P*l.strideDepth-b;for(let F=0;F<c;++F){const B=W+F*p;if(B<0||B>=l.inDepth)continue;const U=F*_[0],q=D+B*N[1];for(let M=0;M<l.outHeight;++M){const G=z+M*S.strides[2],Q=M*l.strideHeight-E;for(let Z=0;Z<h;++Z){const rt=Q+Z*g;if(rt<0||rt>=l.inHeight)continue;const ct=U+Z*_[1],pt=q+rt*N[2];for(let Rt=0;Rt<l.outWidth;++Rt){const Ct=G+Rt*l.outChannels,Ft=Rt*l.strideWidth-C;for(let Ut=0;Ut<d;++Ut){const Pt=Ft+Ut*x;if(Pt<0||Pt>=l.inWidth)continue;const Vt=ct+Ut*_[2],Ht=pt+Pt*l.inChannels;let ee=Vt;for(let te=0;te<l.inChannels;++te){const ne=k[Ht+te];for(let ge=0;ge<l.outChannels;++ge)A[Ct+ge]+=ne*R[ee+ge];ee+=l.outChannels}}}}}}}}return e.makeTensorInfo(S.shape,S.dtype,S.values)}const eEt={kernelName:R1,backendName:"cpu",kernelFunc:tEt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nEt(n){const{inputs:t,backend:e,attrs:r}=n,{x:o,dy:a}=t,{strides:i,pad:s,filterShape:u}=r;Xt([o,a],"conv3dBackpropFilterV2");const l=ue(o.shape),c=ue(a.shape),h=Cl(o.shape,u,i,1,s),d=h.strideDepth,p=h.strideHeight,g=h.strideWidth,x=h.filterDepth,y=h.filterHeight,b=h.filterWidth,C=new Ur(h.filterShape,"float32"),E=C.values,[S,k,R,A]=C.strides,N=e.data.get(a.dataId).values,[_,$,D,O]=c,P=e.data.get(o.dataId).values,[z,W,F,B]=l,U=h.padInfo.front,q=h.padInfo.left,M=h.padInfo.top;for(let G=0;G<x;++G){const Q=Math.max(0,Math.ceil((U-G)/d)),Z=Math.min(h.outDepth,(h.inDepth+U-G)/d),rt=G*S;for(let ct=0;ct<y;++ct){const pt=Math.max(0,Math.ceil((M-ct)/p)),Rt=Math.min(h.outHeight,(h.inHeight+M-ct)/p),Ct=ct*k+rt;for(let Ft=0;Ft<b;++Ft){const Ut=Math.max(0,Math.ceil((q-Ft)/g)),Pt=Math.min(h.outWidth,(h.inWidth+q-Ft)/g),Vt=Ft*R+Ct;for(let Ht=0;Ht<h.inChannels;++Ht){const ee=Ht*A+Vt;for(let te=0;te<h.outChannels;++te){let ne=0;for(let ge=0;ge<h.batchSize;++ge){const we=ge*z,en=ge*_;for(let ze=Q;ze<Z;++ze){const nn=(G+ze*d-U)*W+we,Gn=ze*$+en;for(let Dn=pt;Dn<Rt;++Dn){const cr=(ct+Dn*p-M)*F+nn,Ge=Dn*D+Gn;for(let mn=Ut;mn<Pt;++mn){const Al=(Ft+mn*g-q)*B+cr,_l=mn*O+Ge;ne+=P[Al+Ht]*N[_l+te]}}}}E[ee+te]=ne}}}}}return e.makeTensorInfo(C.shape,C.dtype,C.values)}const rEt={kernelName:YI,backendName:"cpu",kernelFunc:nEt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oEt(n){const{inputs:t,backend:e,attrs:r}=n,{dy:o,filter:a}=t,{pad:i,strides:s,inputShape:u}=r;Xt([o],"conv3dBackpropInputV2");const l=ue(o.shape),c=ue(a.shape),h=Cl(u,a.shape,s,1,i),d=new Ur(h.inShape,"float32"),p=d.values,[g,x,y,b]=d.strides,C=e.data.get(o.dataId).values,[E,S,k,R]=l,A=e.data.get(a.dataId).values,[N,_,$,D]=c,{batchSize:O,filterDepth:P,filterHeight:z,filterWidth:W,inChannels:F,inDepth:B,inHeight:U,inWidth:q,outChannels:M,outDepth:G,outHeight:Q,outWidth:Z,strideDepth:rt,strideHeight:ct,strideWidth:pt}=h,Rt=P-1-h.padInfo.front,Ct=z-1-h.padInfo.top,Ft=W-1-h.padInfo.left;for(let Ut=0;Ut<O;++Ut)for(let Pt=0;Pt<F;++Pt)for(let Vt=0;Vt<B;++Vt){const Ht=Vt-Rt,ee=Math.max(0,Math.ceil(Ht/rt)),te=Math.min(G,(P+Ht)/rt);for(let ne=0;ne<U;++ne){const ge=ne-Ct,we=Math.max(0,Math.ceil(ge/ct)),en=Math.min(Q,(z+ge)/ct);for(let ze=0;ze<q;++ze){const un=ze-Ft,nn=Math.max(0,Math.ceil(un/pt)),Gn=Math.min(Z,(W+un)/pt);let Dn=0;for(let Bn=ee;Bn<te;++Bn){const cr=Bn*rt-Ht;for(let Ge=we;Ge<en;++Ge){const mn=Ge*ct-ge;for(let zn=nn;zn<Gn;++zn){const Al=zn*pt-un,_l=E*Ut+S*Bn+k*Ge+R*zn,Td=N*(P-1-cr)+_*(z-1-mn)+$*(W-1-Al)+D*Pt;for(let Jo=0;Jo<M;++Jo){const ki=C[_l+Jo],ta=A[Td+Jo];Dn+=ki*ta}}}}p[g*Ut+x*Vt+y*ne+b*ze+Pt]=Dn}}}return e.makeTensorInfo(d.shape,d.dtype,d.values)}const aEt={kernelName:QI,backendName:"cpu",kernelFunc:oEt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iEt=hn(rg,n=>Math.cos(n)),sEt={kernelName:rg,backendName:"cpu",kernelFunc:iEt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uEt=hn(og,n=>Math.cosh(n)),lEt={kernelName:og,backendName:"cpu",kernelFunc:uEt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cEt(n){const{inputs:t,backend:e,attrs:r}=n,{image:o,boxes:a,boxInd:i}=t,{cropSize:s,method:u,extrapolationValue:l}=r,[c,h,d,p]=o.shape,g=a.shape[0],[x,y]=s,b=Ae([g,x,y,p],"float32"),C=e.data.get(a.dataId).values,E=e.data.get(i.dataId).values,S=e.data.get(o.dataId).values,k=ue(o.shape),R=ue(b.shape);for(let A=0;A<g;A++){const N=A*4,_=C[N],$=C[N+1],D=C[N+2],O=C[N+3],P=E[A];if(P>=c)continue;const z=x>1?(D-_)*(h-1)/(x-1):0,W=y>1?(O-$)*(d-1)/(y-1):0;for(let F=0;F<x;F++){const B=x>1?_*(h-1)+F*z:.5*(_+D)*(h-1);if(B<0||B>h-1){for(let U=0;U<y;U++)for(let q=0;q<p;q++){const M=q+U*R[2]+F*R[1]+A*R[0];b.values[M]=l}continue}if(u==="bilinear"){const U=Math.floor(B),q=Math.ceil(B),M=B-U;for(let G=0;G<y;G++){const Q=y>1?$*(d-1)+G*W:.5*($+O)*(d-1);if(Q<0||Q>d-1){for(let pt=0;pt<p;pt++){const Rt=pt+G*R[2]+F*R[1]+A*R[0];b.values[Rt]=l}continue}const Z=Math.floor(Q),rt=Math.ceil(Q),ct=Q-Z;for(let pt=0;pt<p;pt++){let Rt=pt+Z*k[2]+U*k[1]+P*k[0];const Ct=S[Rt];Rt=pt+rt*k[2]+U*k[1]+P*k[0];const Ft=S[Rt];Rt=pt+Z*k[2]+q*k[1]+P*k[0];const Ut=S[Rt];Rt=pt+rt*k[2]+q*k[1]+P*k[0];const Pt=S[Rt],Vt=Ct+(Ft-Ct)*ct,Ht=Ut+(Pt-Ut)*ct;Rt=pt+G*R[2]+F*R[1]+A*R[0],b.values[Rt]=Vt+(Ht-Vt)*M}}}else for(let U=0;U<y;++U){const q=y>1?$*(d-1)+U*W:.5*($+O)*(d-1);if(q<0||q>d-1){for(let Q=0;Q<p;Q++){const Z=Q+U*R[2]+F*R[1]+A*R[0];b.values[Z]=l}continue}const M=Math.round(q),G=Math.round(B);for(let Q=0;Q<p;Q++){const Z=Q+M*k[2]+G*k[1]+P*k[0],rt=Q+U*R[2]+F*R[1]+A*R[0];b.values[rt]=S[Z]}}}}return e.makeTensorInfo(b.shape,b.dtype,b.values)}const hEt={kernelName:JI,backendName:"cpu",kernelFunc:cEt};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fEt(n){const{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{axis:a,exclusive:i,reverse:s}=r;Xt(o,"cumprod");const u=Pn([a],o.shape.length);let l=o;u!=null&&(l=$o({inputs:{x:o},backend:e,attrs:{perm:u}}));const c=er(1,o.shape.length)[0];if(c!==l.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${l.shape.length-1} but got axis=${c}`);const h=Yo(l.dtype,"int32"),d=PI(It(l.shape),h),p=e.data.get(l.dataId).values,g=l.shape[l.shape.length-1],x=s?(b,C)=>b+g-C-1:(b,C)=>b+C;for(let b=0;b<p.length;b+=g)for(let C=0;C<g;C++){const E=x(b,C);if(C===0)d[E]=i?1:p[E];else{const S=x(b,C-1);d[E]=i?p[S]*d[S]:p[E]*d[S]}}const y=e.makeTensorInfo(l.shape,h,d);if(u!=null){const b=Sl(u),C=$o({inputs:{x:y},backend:e,attrs:{perm:b}});return e.disposeIntermediateTensorInfo(y),e.disposeIntermediateTensorInfo(l),C}return y}const dEt={kernelName:ZI,backendName:"cpu",kernelFunc:fEt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pEt(n){const{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{axis:a,exclusive:i,reverse:s}=r;Xt(o,"cumsum");const u=Pn([a],o.shape.length);let l=o;u!=null&&(l=$o({inputs:{x:o},backend:e,attrs:{perm:u}}));const c=er(1,o.shape.length)[0];if(c!==l.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${l.shape.length-1} but got axis=${c}`);const h=Yo(l.dtype,"int32"),d=to(It(l.shape),h),p=e.data.get(l.dataId).values,g=l.shape[l.shape.length-1],x=s?(b,C)=>b+g-C-1:(b,C)=>b+C;for(let b=0;b<p.length;b+=g)for(let C=0;C<g;C++){const E=x(b,C);if(C===0)d[E]=i?0:p[E];else{const S=x(b,C-1);d[E]=i?p[S]+d[S]:p[E]+d[S]}}const y=e.makeTensorInfo(l.shape,h,d);if(u!=null){const b=Sl(u),C=$o({inputs:{x:y},backend:e,attrs:{perm:b}});return e.disposeIntermediateTensorInfo(y),e.disposeIntermediateTensorInfo(l),C}return y}const mEt={kernelName:T1,backendName:"cpu",kernelFunc:pEt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gEt(n){const{inputs:t,backend:e,attrs:r}=n,{x:o,weights:a}=t,{size:i,binaryOutput:s}=r;if(o.shape.length===1){const u=e.data.get(o.dataId).values,l=e.data.get(a.dataId).values,c=tN(u,l,a.dtype,a.shape,i);return e.makeTensorInfo([i],a.dtype,c)}else if(o.shape.length===2){const u=e.bufferSync(o),l=e.bufferSync(a),c=qG(u,l,i,s);return e.makeTensorInfo(c.shape,a.dtype,c.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${o.shape.length}.`)}const vEt={kernelName:tR,backendName:"cpu",kernelFunc:gEt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xEt(n){const{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{blockSize:a,dataFormat:i}=r;H(i==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${i}`);const s=o.shape[0],u=o.shape[1],l=o.shape[2],c=o.shape[3],h=u*a,d=l*a,p=c/(a*a),g=e.data.get(o.dataId).values,x=new Float32Array(s*h*d*p);let y=0;for(let b=0;b<s;++b)for(let C=0;C<h;++C){const E=Math.floor(C/a),S=C%a;for(let k=0;k<d;++k){const R=Math.floor(k/a),A=k%a,N=(S*a+A)*p;for(let _=0;_<p;++_){const D=_+N+c*(R+l*(E+u*b));x[y++]=g[D]}}}return e.makeTensorInfo([s,h,d,p],o.dtype,x)}const yEt={kernelName:eR,backendName:"cpu",kernelFunc:xEt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qH(n){const{inputs:t,backend:e,attrs:r}=n,{x:o,filter:a}=t,{strides:i,pad:s,dilations:u,dimRoundingMode:l}=r;Xt([o,a],"depthwiseConv2DNative");const c=ue(o.shape),h=ue(a.shape);let d=u;d==null&&(d=[1,1]),H(ro(i,d),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${i} and dilations '${d}'`);const p=Vr(o.shape,a.shape,i,d,s,l,!0),{filterHeight:g,filterWidth:x,dilationHeight:y,dilationWidth:b,padInfo:C}=p,E=C.left,S=C.top,k=p.outChannels/p.inChannels,R=new Ur(p.outShape,o.dtype),A=e.data.get(o.dataId).values,N=e.data.get(a.dataId).values,_=R.values;for(let $=0;$<p.batchSize;++$){const D=$*c[0],O=$*R.strides[0];for(let P=0;P<p.outHeight;++P){const z=O+P*R.strides[1],W=P*p.strideHeight-S;for(let F=0;F<g;++F){const B=W+F*y;if(B<0||B>=p.inHeight)continue;const U=F*h[0],q=D+B*c[1];for(let M=0;M<p.outWidth;++M){const G=z+M*R.strides[2],Q=M*p.strideWidth-E;for(let Z=0;Z<x;++Z){const rt=Q+Z*b;if(rt<0||rt>=p.inWidth)continue;const ct=U+Z*h[1],pt=q+rt*p.inChannels;let Rt=G,Ct=ct;for(let Ft=0;Ft<p.inChannels;++Ft){const Ut=A[pt+Ft];for(let Pt=0;Pt<k;++Pt)_[Rt+Pt]+=Ut*N[Ct+Pt];Rt+=k,Ct+=k}}}}}}return e.makeTensorInfo(R.shape,R.dtype,R.values)}const bEt={kernelName:N1,backendName:"cpu",kernelFunc:qH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wEt(n){const{inputs:t,backend:e,attrs:r}=n,{x:o,dy:a}=t,{strides:i,dilations:s,pad:u,dimRoundingMode:l,filterShape:c}=r;Xt([o,a],"depthwiseConv2dNativeBackpropFilter");const h=Vr(o.shape,c,i,s,u,l,!0),{strideHeight:d,strideWidth:p,filterHeight:g,filterWidth:x}=h,y=new Ur(h.filterShape,"float32"),b=h.padInfo.left,C=h.padInfo.top,E=h.outChannels/h.inChannels,S=e.data.get(o.dataId).values,k=new Ur(o.shape,o.dtype,S),R=e.data.get(a.dataId).values,A=new Ur(a.shape,a.dtype,R);for(let N=0;N<g;++N){const _=Math.max(0,Math.ceil((C-N)/d)),$=Math.min(h.outHeight,(h.inHeight+C-N)/d);for(let D=0;D<x;++D){const O=Math.max(0,Math.ceil((b-D)/p)),P=Math.min(h.outWidth,(h.inWidth+b-D)/p);for(let z=0;z<h.outChannels;++z){const W=Math.trunc(z/E),F=z%E;let B=0;for(let U=0;U<h.batchSize;++U)for(let q=_;q<$;++q){const M=N+q*d-C;for(let G=O;G<P;++G){const Q=D+G*p-b;B+=k.get(U,M,Q,W)*A.get(U,q,G,z)}}y.set(B,N,D,W,F)}}}return e.makeTensorInfo(y.shape,y.dtype,y.values)}const CEt={kernelName:nR,backendName:"cpu",kernelFunc:wEt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SEt(n){const{inputs:t,backend:e,attrs:r}=n,{dy:o,filter:a}=t,{strides:i,dilations:s,pad:u,dimRoundingMode:l,inputShape:c}=r;Xt([o,a],"depthwiseConv2DNativeBackpropInput");const h=ue(o.shape),d=ue(a.shape),p=Vr(c,a.shape,i,s,u,l,!0),g=new Ur(p.inShape,"float32"),x=g.values,[y,b,C]=g.strides,E=e.data.get(o.dataId).values,[S,k,R]=h,A=e.data.get(a.dataId).values,[N,_,$]=d,{batchSize:D,filterHeight:O,filterWidth:P,inChannels:z,inHeight:W,inWidth:F,outChannels:B,outHeight:U,outWidth:q,strideHeight:M,strideWidth:G}=p,Q=O-1-p.padInfo.top,Z=P-1-p.padInfo.left,rt=B/z;for(let ct=0;ct<D;++ct)for(let pt=0;pt<z;++pt)for(let Rt=0;Rt<W;++Rt){const Ct=Rt-Q,Ft=Math.max(0,Math.ceil(Ct/M)),Ut=Math.min(U,(O+Ct)/M);for(let Pt=0;Pt<F;++Pt){const Vt=Pt-Z,Ht=Math.max(0,Math.ceil(Vt/G)),ee=Math.min(q,(P+Vt)/G);let te=0;for(let ne=Ft;ne<Ut;++ne){const ge=ne*M-Ct;for(let we=Ht;we<ee;++we){const en=we*G-Vt,ze=S*ct+k*ne+R*we,un=N*(O-1-ge)+_*(P-1-en)+$*pt;for(let nn=0;nn<rt;++nn){const Gn=pt*rt+nn,Dn=E[ze+Gn],Bn=A[un+nn];te+=Dn*Bn}}}x[y*ct+b*Rt+C*Pt+pt]=te}}return e.makeTensorInfo(g.shape,g.dtype,g.values)}const EEt={kernelName:rR,backendName:"cpu",kernelFunc:SEt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kEt(n){const{inputs:t,backend:e}=n,{x:r}=t,o=It(r.shape),a=e.data.get(r.dataId).values,i=Ae([o,o],r.dtype),s=i.values;for(let l=0;l<a.length;l++)s[l*o+l]=a[l];const u=[...r.shape,...r.shape];return e.makeTensorInfo(u,i.dtype,i.values)}const IEt={kernelName:gz,backendName:"cpu",kernelFunc:kEt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const REt={kernelName:A1,backendName:"cpu",kernelFunc:({inputs:n,backend:t,attrs:e})=>{const{x:r,filter:o}=n,{strides:a,pad:i,dilations:s}=e,u=t,l=u.data.get(r.dataId).values,c=r.shape.length,h=u.data.get(o.dataId).values,d=o.shape.length,{batchSize:p,inHeight:g,inWidth:x,inChannels:y,outHeight:b,outWidth:C,padInfo:E,strideHeight:S,strideWidth:k,filterHeight:R,filterWidth:A,dilationHeight:N,dilationWidth:_,outShape:$}=Wg(r.shape,o.shape,a,i,"NHWC",s),D=It($),O=$.length,P=Qn(r.dtype,D);for(let W=0;W<p;++W)for(let F=0;F<b;++F){const B=F*S-E.top;for(let U=0;U<C;++U){const q=U*k-E.left;for(let M=0;M<y;++M){let G=Number.MIN_SAFE_INTEGER;for(let Z=0;Z<R;++Z){const rt=B+Z*N;if(rt>=0&&rt<g)for(let ct=0;ct<A;++ct){const pt=q+ct*_;if(pt>=0&&pt<x){const Rt=Ki([W,rt,pt,M],c,ue(r.shape)),Ct=Ki([Z,ct,M],d,ue(o.shape)),Ft=l[Rt]+h[Ct];Ft>G&&(G=Ft)}}}const Q=Ki([W,F,U,M],O,ue($));P[Q]=G}}}return{dataId:u.write(th(P,r.dtype),$,r.dtype),shape:$,dtype:r.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TEt={kernelName:SE,backendName:"cpu",kernelFunc:({inputs:n,backend:t,attrs:e})=>{const{x:r,filter:o,dy:a}=n,{strides:i,pad:s,dilations:u}=e,l=t,c=pi(r.shape,l.data.get(r.dataId).values),h=pi(o.shape,l.data.get(o.dataId).values),{batchSize:d,inHeight:p,inWidth:g,inChannels:x,outHeight:y,outWidth:b,padInfo:C,strideHeight:E,strideWidth:S,filterHeight:k,filterWidth:R,dilationHeight:A,dilationWidth:N,outShape:_}=Wg(r.shape,o.shape,i,s,"NHWC",u);H(a.rank===_.length,()=>`Error in ${SE}, dy must have the same rank as output ${_.length}, but got ${a.rank}`);const $=pi(_,l.data.get(a.dataId).values),D=fz(o.shape,o.dtype);for(let P=0;P<d;++P)for(let z=0;z<y;++z){const W=z*E-C.top;for(let F=0;F<b;++F){const B=F*S-C.left;for(let U=0;U<x;++U){let q=Number.MIN_SAFE_INTEGER,M=0,G=0;for(let Q=0;Q<k;++Q){const Z=W+Q*A;if(Z>=0&&Z<p)for(let rt=0;rt<R;++rt){const ct=B+rt*N;if(ct>=0&&ct<g){const pt=c[P][Z][ct][U]+h[Q][rt][U];pt>q&&(q=pt,M=Q,G=rt)}}}D[M][G][U]+=$[P][z][F][U]}}}return{dataId:l.write(th(D,r.dtype),o.shape,o.dtype),shape:o.shape,dtype:o.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NEt={kernelName:CE,backendName:"cpu",kernelFunc:({inputs:n,backend:t,attrs:e})=>{const{x:r,filter:o,dy:a}=n,{strides:i,pad:s,dilations:u}=e,l=t,c=pi(r.shape,l.data.get(r.dataId).values),h=pi(o.shape,l.data.get(o.dataId).values),{batchSize:d,inHeight:p,inWidth:g,inChannels:x,outHeight:y,outWidth:b,padInfo:C,strideHeight:E,strideWidth:S,filterHeight:k,filterWidth:R,dilationHeight:A,dilationWidth:N,outShape:_}=Wg(r.shape,o.shape,i,s,"NHWC",u);H(a.rank===_.length,()=>`Error in ${CE}, dy must have the same rank as output ${_.length}, but got ${a.rank}`);const $=pi(_,l.data.get(a.dataId).values),D=fz(r.shape,r.dtype);for(let P=0;P<d;++P)for(let z=0;z<y;++z){const W=z*E-C.top;for(let F=0;F<b;++F){const B=F*S-C.left;for(let U=0;U<x;++U){let q=Number.MIN_SAFE_INTEGER,M=W<0?0:W,G=B<0?0:B;for(let Q=0;Q<k;++Q){const Z=W+Q*A;if(Z>=0&&Z<p)for(let rt=0;rt<R;++rt){const ct=B+rt*N;if(ct>=0&&ct<g){const pt=c[P][Z][ct][U]+h[Q][rt][U];pt>q&&(q=pt,M=Z,G=ct)}}}D[P][M][G][U]+=$[P][z][F][U]}}}return{dataId:l.write(th(D,r.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AEt(n){const{inputs:t,backend:e,attrs:r}=n,{image:o}=t,{canvas:a,options:i}=r,{contextOptions:s,imageOptions:u}=i||{},l=u?.alpha||1,c=s?.contextType||"2d";if(c!=="2d")throw new Error(`Context type ${s.contextType} is not supported by the CPU backend.`);const h=a.getContext(c,s?.contextAttributes||{});if(h==null)throw new Error(`Could not get the context with ${c} type.`);const[d,p]=o.shape.slice(0,2),g=o.shape.length===2?1:o.shape[2],x=e.data.get(o.dataId).values,y=o.dtype==="float32"?255:1,b=new Uint8ClampedArray(p*d*4);for(let E=0;E<d*p;++E){const S=[0,0,0,255*l];for(let R=0;R<g;R++){const A=x[E*g+R];if(o.dtype==="float32"){if(A<0||A>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${A}.`)}else if(o.dtype==="int32"&&(A<0||A>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${A}.`);g===1?(S[0]=A*y,S[1]=A*y,S[2]=A*y):S[R]=A*y}const k=E*4;b[k+0]=Math.round(S[0]),b[k+1]=Math.round(S[1]),b[k+2]=Math.round(S[2]),b[k+3]=Math.round(S[3])}a.width=p,a.height=d;const C=new ImageData(b,p,d);return h.putImageData(C,0,0),o}const _Et={kernelName:Kdt,backendName:"cpu",kernelFunc:AEt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ov(n){const{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{axis:a,keepDims:i}=r;Xt(o,"sum");let s;o.dtype==="bool"?s=fl({inputs:{x:o},backend:e,attrs:{dtype:"int32"}}):s=us({inputs:{x:o},backend:e});const u=s.shape.length,l=_e(a,s.shape),c=Pn(l,u);let h=l,d=s;c!=null&&(d=$o({inputs:{x:s},backend:e,attrs:{perm:c}}),h=er(h.length,u)),Gr("sum",h,d.shape.length);const[p,g]=Dr(d.shape,h),x=Yo(d.dtype,"int32");let y=My(e,p,x);const b=It(g),C=e.data.get(y.dataId).values,E=e.data.get(d.dataId).values;for(let S=0;S<C.length;++S){const k=S*b;let R=0;for(let A=0;A<b;++A)R+=E[k+A];C[S]=R}if(i){const S=lr(y.shape,l),k=y;y=In({inputs:{x:y},backend:e,attrs:{shape:S}}),e.disposeIntermediateTensorInfo(k)}return e.disposeIntermediateTensorInfo(s),c!=null&&e.disposeIntermediateTensorInfo(d),y}const DEt={kernelName:lb,backendName:"cpu",kernelFunc:ov};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $Et(n){const{inputs:t,backend:e,attrs:r}=n,{equation:o}=r,a=t,{allDims:i,summedDims:s,idDims:u}=ET(o,a.length);IT(i.length,u,a);const{path:l,steps:c}=RT(s,u),h=c.length;let d=null,p=i.length;const g=[];for(let x=0;x<h;++x){for(const y of c[x]){const{permutationIndices:b,expandDims:C}=kT(p,u[y]);let E;TT(b)?E=a[y]:(E=$o({inputs:{x:a[y]},backend:e,attrs:{perm:b}}),g.push(E));const S=E.shape.slice();for(let k=0;k<C.length;++k)S.splice(C[k],0,1);tn(E.shape,S)||(E=In({inputs:{x:E},backend:e,attrs:{shape:S}}),g.push(E)),d===null?d=E:(d=zb({inputs:{a:E,b:d},backend:e}),g.push(d))}x<h-1&&(l[x]>=0&&(d=ov({inputs:{x:d},backend:e,attrs:{axis:l[x]-(i.length-p),keepDims:!1}}),g.push(d)),p--)}for(const x of g)x!==d&&e.disposeIntermediateTensorInfo(x);return d}const OEt={kernelName:oR,backendName:"cpu",kernelFunc:$Et};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FEt(n){const{inputs:t,backend:e}=n,{dy:r,y:o}=t;Xt([r,o],"eluGrad");const a=new Float32Array(It(o.shape)),i=e.data.get(o.dataId).values,s=e.data.get(r.dataId).values;for(let u=0;u<i.length;++u){const l=i[u];l>=0?a[u]=s[u]:a[u]=s[u]*(l+1)}return e.makeTensorInfo(o.shape,"float32",a)}const MEt={kernelName:aR,backendName:"cpu",kernelFunc:FEt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LEt=vT,PEt=xT,BEt=yT,zEt=bT,UEt=wT,WEt=CT,VEt=hn(sg,n=>{const t=Math.sign(n),e=Math.abs(n),r=1/(1+LEt*e);return t*(1-((((WEt*r+UEt)*r+zEt)*r+BEt)*r+PEt)*r*Math.exp(-e*e))}),GEt={kernelName:sg,backendName:"cpu",kernelFunc:VEt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function By(n){const{inputs:t,backend:e,attrs:r}=n,{input:o}=t,{dim:a}=r,i=o.shape.length,s=o.shape.slice();let u=a;return a<0&&(H(-(i+1)<=a,()=>`Axis must be in the interval [${-(i+1)}, ${i}]`),u=i+a+1),s.splice(u,0,1),In({inputs:{x:o},backend:e,attrs:{shape:s}})}const HEt={kernelName:D1,backendName:"cpu",kernelFunc:By};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qEt=rr((n,t)=>n/t),iN=wr(ag,qEt),KE={kernelName:ag,backendName:"cpu",kernelFunc:iN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jH(n,t,e){const r=n.shape,o=r[0],a=r[1],i=e.data.get(n.dataId),s=i.complexTensorInfos.real,u=i.complexTensorInfos.imag,l=[o,a],c=It(l),h=Jr("float32",c),d=Jr("float32",c);for(let y=0;y<o;y++){const b=Pc({inputs:{x:s},backend:e,attrs:{begin:[y,0],size:[1,a]}}),C=Pc({inputs:{x:u},backend:e,attrs:{begin:[y,0],size:[1,a]}}),E=Vo({inputs:{real:b,imag:C},backend:e}),{real:S,imag:k}=jEt(E,t,e),R=Qs(S,k);for(let A=0;A<a;A++){const N=ST(R,A);h[y*a+A]=N.real,d[y*a+A]=N.imag}e.disposeIntermediateTensorInfo(b),e.disposeIntermediateTensorInfo(C),e.disposeIntermediateTensorInfo(E)}const p=e.makeTensorInfo(l,"float32",h),g=e.makeTensorInfo(l,"float32",d),x=Vo({inputs:{real:p,imag:g},backend:e});return e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(g),x}function jEt(n,t,e){const r=It(n.shape),o=e.data.get(n.dataId),a=e.data.get(o.complexTensorInfos.real.dataId).values,i=e.data.get(o.complexTensorInfos.imag.dataId).values;if(XEt(r)){const s=YE(a,i,r,t,e),u=[n.shape[0],n.shape[1]];if(t){const l=e.makeTensorInfo(u,"float32",s.real),c=e.makeTensorInfo(u,"float32",s.imag),h=e.makeTensorInfo([],"float32",wl(r,"float32")),d=us({inputs:{x:h},backend:e}),p=KE.kernelFunc({inputs:{a:l,b:h},backend:e}),g=KE.kernelFunc({inputs:{a:c,b:d},backend:e}),x=e.data.get(p.dataId).values,y=e.data.get(g.dataId).values;return e.disposeIntermediateTensorInfo(l),e.disposeIntermediateTensorInfo(c),e.disposeIntermediateTensorInfo(h),e.disposeIntermediateTensorInfo(d),e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(g),{real:x,imag:y}}return s}else{const s=Qs(a,i),u=KEt(s,r,t);return iW(u)}}function XEt(n){return(n&n-1)===0}function YE(n,t,e,r,o){if(e===1)return{real:n,imag:t};const a=Qs(n,t),i=e/2,s=sW(a),u=s.real,l=s.imag,c=[u.length],h=o.makeTensorInfo(c,"float32",u),d=o.makeTensorInfo(c,"float32",l),p=Vo({inputs:{real:h,imag:d},backend:o}),g=uW(a),x=g.real,y=g.imag,b=[x.length],C=o.makeTensorInfo(b,"float32",x),E=o.makeTensorInfo(b,"float32",y),S=Vo({inputs:{real:C,imag:E},backend:o}),k=YE(u,l,i,r,o),R=k.real,A=k.imag,N=[R.length],_=o.makeTensorInfo(N,"float32",R),$=o.makeTensorInfo(N,"float32",A),D=Vo({inputs:{real:_,imag:$},backend:o}),O=YE(x,y,i,r,o),P=O.real,z=O.imag,W=[P.length],F=o.makeTensorInfo(W,"float32",P),B=o.makeTensorInfo(W,"float32",z),U=Vo({inputs:{real:F,imag:B},backend:o}),q=cW(e,r),M=[q.real.length],G=o.makeTensorInfo(M,"float32",q.real),Q=o.makeTensorInfo(M,"float32",q.imag),Z=Vo({inputs:{real:G,imag:Q},backend:o}),rt=zb({inputs:{a:Z,b:U},backend:o}),ct=jf({inputs:{a:D,b:rt},backend:o}),pt=oN({inputs:{a:D,b:rt},backend:o}),Rt=Lc({inputs:{input:ct},backend:o}),Ct=Lc({inputs:{input:pt},backend:o}),Ft=Xf({inputs:{input:ct},backend:o}),Ut=Xf({inputs:{input:pt},backend:o}),Pt=Kf({inputs:[Rt,Ct],backend:o,attrs:{axis:0}}),Vt=Kf({inputs:[Ft,Ut],backend:o,attrs:{axis:0}}),Ht=o.data.get(Pt.dataId).values,ee=o.data.get(Vt.dataId).values;return o.disposeIntermediateTensorInfo(h),o.disposeIntermediateTensorInfo(d),o.disposeIntermediateTensorInfo(p),o.disposeIntermediateTensorInfo(C),o.disposeIntermediateTensorInfo(E),o.disposeIntermediateTensorInfo(S),o.disposeIntermediateTensorInfo(_),o.disposeIntermediateTensorInfo($),o.disposeIntermediateTensorInfo(D),o.disposeIntermediateTensorInfo(F),o.disposeIntermediateTensorInfo(B),o.disposeIntermediateTensorInfo(U),o.disposeIntermediateTensorInfo(G),o.disposeIntermediateTensorInfo(Q),o.disposeIntermediateTensorInfo(Z),o.disposeIntermediateTensorInfo(rt),o.disposeIntermediateTensorInfo(ct),o.disposeIntermediateTensorInfo(pt),o.disposeIntermediateTensorInfo(Rt),o.disposeIntermediateTensorInfo(Ft),o.disposeIntermediateTensorInfo(Ct),o.disposeIntermediateTensorInfo(Ut),o.disposeIntermediateTensorInfo(Pt),o.disposeIntermediateTensorInfo(Vt),{real:Ht,imag:ee}}function KEt(n,t,e){const r=new Float32Array(t*2);for(let o=0;o<t;o++){let a=0,i=0;for(let s=0;s<t;s++){const u=hW(o*s,t,e),l=ST(n,s);a+=l.real*u.real-l.imag*u.imag,i+=l.real*u.imag+l.imag*u.real}e&&(a/=t,i/=t),lW(r,a,i,o)}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YEt(n){const{inputs:t,backend:e}=n,{input:r}=t,o=It(r.shape),a=r.shape[r.shape.length-1],i=o/a,s=In({inputs:{x:r},backend:e,attrs:{shape:[i,a]}}),u=jH(s,!1,e),l=In({inputs:{x:u},backend:e,attrs:{shape:r.shape}});return e.disposeIntermediateTensorInfo(s),e.disposeIntermediateTensorInfo(u),l}const QEt={kernelName:iR,backendName:"cpu",kernelFunc:YEt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sN(n){const{backend:t,attrs:e}=n,{shape:r,value:o,dtype:a}=e,i=a||ld(o),s=Qn(i,It(r));return JEt(s,o,i),t.makeTensorInfo(r,i,s)}const ZEt={kernelName:sR,backendName:"cpu",kernelFunc:sN};function JEt(n,t,e){n.fill(t)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tkt={kernelName:uR,backendName:"cpu",kernelFunc:({inputs:n,attrs:t,backend:e})=>{const{image:r}=n,o=e,a=Jr(r.dtype,It(r.shape)),[i,s,u,l]=r.shape,c=o.data.get(r.dataId).values;for(let d=0;d<i;d++){const p=d*u*s*l;for(let g=0;g<s;g++){const x=g*(u*l);for(let y=0;y<u;y++){const b=y*l;for(let C=0;C<l;C++){const E=Math.round(u-y-1),S=p+x+b+C;let k=c[S];if(E>=0&&E<u){const R=E*l,A=p+x+R+C;k=c[A]}a[S]=k}}}}return{dataId:o.write(a,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ekt(n){const{inputs:t,backend:e,attrs:r}=n,{x:o,filter:a,bias:i,preluActivationWeights:s}=t,{strides:u,pad:l,dataFormat:c,dilations:h,dimRoundingMode:d,activation:p,leakyreluAlpha:g}=r;let x=HH({inputs:{x:o,filter:a},backend:e,attrs:{strides:u,pad:l,dataFormat:c,dilations:h,dimRoundingMode:d}});if(i){const y=x;if(c==="NCHW"&&i.shape.length===1&&i.shape[0]!==1){const b=In({inputs:{x:i},backend:e,attrs:{shape:[i.shape[0],1,1]}});x=jf({inputs:{a:x,b},backend:e}),e.disposeIntermediateTensorInfo(b)}else x=jf({inputs:{a:x,b:i},backend:e});e.disposeIntermediateTensorInfo(y)}if(p){const y=x;if(c==="NCHW"&&p==="prelu"&&s.shape.length===1&&s.shape[0]!==1){const b=In({inputs:{x:s},backend:e,attrs:{shape:[s.shape[0],1,1]}});x=Py(e,x,p,b,g),e.disposeIntermediateTensorInfo(b)}else x=Py(e,x,p,s,g);e.disposeIntermediateTensorInfo(y)}return x}const nkt={kernelName:yy,backendName:"cpu",kernelFunc:ekt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rkt(n){const{inputs:t,backend:e,attrs:r}=n,{x:o,filter:a,bias:i,preluActivationWeights:s}=t,{strides:u,pad:l,dataFormat:c,dilations:h,dimRoundingMode:d,activation:p,leakyreluAlpha:g}=r;let x=qH({inputs:{x:o,filter:a},backend:e,attrs:{strides:u,pad:l,dataFormat:c,dilations:h,dimRoundingMode:d}});if(i){const y=x;x=jf({inputs:{a:x,b:i},backend:e}),e.disposeIntermediateTensorInfo(y)}if(p){const y=x;x=Py(e,x,p,s,g),e.disposeIntermediateTensorInfo(y)}return x}const okt={kernelName:Fz,backendName:"cpu",kernelFunc:rkt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function akt(n){const{inputs:t,backend:e}=n,{params:r,indices:o}=t,a=It(r.shape),i=o.shape,s=i[i.length-1],[u,l,c,h]=iT(r,o);if(l===0)return e.makeTensorInfo(u,r.dtype,[]);const d=e.data.get(o.dataId).values,p=e.bufferSync(r),g=rH(d,p,r.dtype,l,s,c,h,r.shape,a);return e.makeTensorInfo(u,r.dtype,g.values)}const ikt={kernelName:vz,backendName:"cpu",kernelFunc:akt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function skt(n){const{inputs:t,backend:e,attrs:r}=n,{x:o,indices:a}=t,{axis:i,batchDims:s}=r;Xt([o,a],"gatherV2");const u=_e(i,o.shape)[0],l=e.data.get(a.dataId).values,c=o.shape[u];for(let S=0;S<l.length;++S){const k=l[S];H(k<=c-1&&k>=0,()=>`GatherV2: the index value ${k} is not in [0, ${c-1}]`)}let h=s;s==null&&(h=0);const d=It(a.shape),p=AT(o,a,u,h),g=In({inputs:{x:o},backend:e,attrs:{shape:[p.batchSize,p.outerSize,p.dimSize,p.sliceSize]}}),x=In({inputs:{x:a},backend:e,attrs:{shape:[p.batchSize,d/p.batchSize]}}),y=[p.batchSize,p.outerSize,d/p.batchSize,p.sliceSize],b=e.bufferSync(x),C=e.bufferSync(g),E=oH(C,b,y);return e.disposeIntermediateTensorInfo(g),e.disposeIntermediateTensorInfo(x),e.makeTensorInfo(p.outputShape,E.dtype,E.values)}const ukt={kernelName:O1,backendName:"cpu",kernelFunc:skt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lkt(n){const{inputs:t,backend:e}=n,{input:r}=t,o=It(r.shape),a=r.shape[r.shape.length-1],i=o/a,s=In({inputs:{x:r},backend:e,attrs:{shape:[i,a]}}),u=jH(s,!0,e),l=In({inputs:{x:u},backend:e,attrs:{shape:r.shape}});return e.disposeIntermediateTensorInfo(s),e.disposeIntermediateTensorInfo(u),l}const ckt={kernelName:lR,backendName:"cpu",kernelFunc:lkt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hkt=hn(pg,n=>Number.isFinite(n)?1:0,"bool"),fkt={kernelName:pg,backendName:"cpu",kernelFunc:hkt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dkt=hn(mg,n=>Math.abs(n)===1/0?1:0,"bool"),pkt={kernelName:mg,backendName:"cpu",kernelFunc:dkt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mkt=hn(gg,n=>Number.isNaN(n)?1:0,"bool"),gkt={kernelName:gg,backendName:"cpu",kernelFunc:mkt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vkt(n){const{backend:t,attrs:e}=n,{start:r,stop:o,num:a}=e,i=lH(r,o,a);return t.makeTensorInfo([i.length],"float32",i)}const xkt={kernelName:xz,backendName:"cpu",kernelFunc:vkt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ykt=hn(xg,n=>Math.log1p(n)),bkt={kernelName:xg,backendName:"cpu",kernelFunc:ykt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wkt=rr((n,t)=>n&&t),Ckt=wr(B1,wkt,null,"bool"),Skt={kernelName:B1,backendName:"cpu",kernelFunc:Ckt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ekt=hn(z1,n=>n?0:1,"bool"),kkt={kernelName:z1,backendName:"cpu",kernelFunc:Ekt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ikt=rr((n,t)=>n||t),Rkt=wr(U1,Ikt,null,"bool"),Tkt={kernelName:U1,backendName:"cpu",kernelFunc:Rkt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nkt(n){const{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{depthRadius:a,bias:i,alpha:s,beta:u}=r;Xt(o,"LRN");const l=o.shape[3],c=l-1,h=e.data.get(o.dataId).values,d=It(o.shape),p=new Float32Array(d);function g(x){const y=x%l;let b=x-y+Math.max(0,y-a);const C=x-y+Math.min(y+a,c);let E=0;for(;b<=C;b++){const S=h[b];E+=S*S}return E}for(let x=0;x<d;x++){const y=g(x),b=h[x]*Math.pow(i+s*y,-u);p[x]=b}return e.makeTensorInfo(o.shape,o.dtype,p)}const Akt={kernelName:W1,backendName:"cpu",kernelFunc:Nkt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _kt(n){const{inputs:t,backend:e,attrs:r}=n,{x:o,y:a,dy:i}=t,{depthRadius:s,bias:u,alpha:l,beta:c}=r;Xt(i,"LRNGrad");const h=It(i.shape),d=i.shape[3],p=e.data.get(i.dataId).values,g=e.data.get(o.dataId).values,x=e.data.get(a.dataId).values,y=new Float32Array(h),b=h;for(let C=0;C<b;C++){const E=C%d,S=C-E+Math.max(0,E-s),k=C-E+Math.min(d,E+s+1);let R=0;for(let A=S;A<k;A++)R+=Math.pow(g[A],2);R=l*R+u;for(let A=S;A<k;A++){let N=-2*l*c*g[A]*x[C]/R;C===A&&(N+=Math.pow(R,-c)),N*=p[C],y[A]+=N}}return e.makeTensorInfo(i.shape,o.dtype,y)}const Dkt={kernelName:hR,backendName:"cpu",kernelFunc:_kt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XH(n){const{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{reductionIndices:a,keepDims:i}=r,s=e;let u=o.shape;const l=u.length,c=_e(a,u);let h=c;const d=Pn(h,l);let p=s.data.get(o.dataId).values;if(d!=null){const S=new Array(l);for(let k=0;k<S.length;k++)S[k]=u[d[k]];p=nN(p,u,o.dtype,d,S),h=er(h.length,l),u=S}Xt(o,"max"),Gr("max",h,l);const[g,x]=Dr(u,h),y=It(x),b=hH(p,y,g,o.dtype),C=s.write(b,g,o.dtype);let E=g;return i&&(E=lr(g,c)),{dataId:C,shape:E,dtype:o.dtype}}const $kt={kernelName:V1,backendName:"cpu",kernelFunc:XH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Okt(n){const{inputs:t,backend:e,attrs:r}=n,{x:o}=t;Xt(o,"maxPool");const{filterSize:a,strides:i,pad:s,dimRoundingMode:u}=r,l=1;H(ro(i,l),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${l}'`);const c=Ya(o.shape,a,i,l,s,u);let h;if(c.filterWidth===1&&c.filterHeight===1&&tn(c.inShape,c.outShape))h=us({inputs:{x:o},backend:e});else{const d=e.data.get(o.dataId).values,p=ue(o.shape),g=aN(d,o.shape,o.dtype,p,c,"max");h=e.makeTensorInfo(c.outShape,o.dtype,g.values)}return h}const Fkt={kernelName:G1,backendName:"cpu",kernelFunc:Okt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mkt(n){const{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{filterSize:a,strides:i,pad:s,dimRoundingMode:u,dataFormat:l}=r;Xt(o,"maxPool3d");const c=hu(o.shape,a,i,1,s,u,l),h=e.data.get(o.dataId).values,d=GH(h,o.shape,o.dtype,ue(o.shape),c,"max");return e.makeTensorInfo(d.shape,"float32",d.values)}const Lkt={kernelName:H1,backendName:"cpu",kernelFunc:Mkt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pkt(n){const{inputs:t,backend:e,attrs:r}=n,{dy:o,input:a}=t,{filterSize:i,strides:s,pad:u,dimRoundingMode:l}=r;Xt([o,a],"maxPool3DGrad");const c=hu(a.shape,i,s,1,u,l),h=e.bufferSync(a),d=ISt(h,c),p=c.strideDepth,g=c.strideHeight,x=c.strideWidth,y=c.dilationDepth,b=c.dilationHeight,C=c.dilationWidth,E=c.effectiveFilterDepth,S=c.effectiveFilterHeight,k=c.effectiveFilterWidth,R=E-1-c.padInfo.front,A=k-1-c.padInfo.left,N=S-1-c.padInfo.top,_=Ae(a.shape,"float32"),$=e.bufferSync(o);for(let D=0;D<c.batchSize;++D)for(let O=0;O<c.inChannels;++O)for(let P=0;P<c.inDepth;++P)for(let z=0;z<c.inHeight;++z)for(let W=0;W<c.inWidth;++W){const F=P-R,B=z-N,U=W-A;let q=0;for(let M=0;M<E;M+=y){const G=(F+M)/p;if(!(G<0||G>=c.outDepth||Math.floor(G)!==G))for(let Q=0;Q<S;Q+=b){const Z=(B+Q)/g;if(!(Z<0||Z>=c.outHeight||Math.floor(Z)!==Z))for(let rt=0;rt<k;rt+=C){const ct=(U+rt)/x;if(ct<0||ct>=c.outWidth||Math.floor(ct)!==ct)continue;const pt=E*S*k-1-d.get(D,G,Z,ct,O),Rt=M*S*k+Q*k+rt,Ct=pt===Rt?1:0;if(Ct===0)continue;const Ft=$.get(D,G,Z,ct,O);q+=Ft*Ct}}}_.set(q,D,P,z,W,O)}return e.makeTensorInfo(_.shape,_.dtype,_.values)}const Bkt={kernelName:dR,backendName:"cpu",kernelFunc:Pkt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zkt(n){const{inputs:t,backend:e,attrs:r}=n,{dy:o,input:a,output:i}=t,s=a;Xt([a,i],"maxPoolGrad");const{filterSize:u,strides:l,pad:c,dimRoundingMode:h}=r,d=Ya(s.shape,u,l,1,c,h),p=e.data.get(s.dataId).values,g=Ae(d.outShape,s.dtype,VH(p,s.shape,s.dtype,d).values),x=d.strideHeight,y=d.strideWidth,b=d.dilationHeight,C=d.dilationWidth,E=d.effectiveFilterHeight,S=d.effectiveFilterWidth,k=S-1-d.padInfo.left,R=E-1-d.padInfo.top,A=Ae(s.shape,"float32"),N=e.data.get(o.dataId).values,_=Ae(o.shape,"float32",N);for(let $=0;$<d.batchSize;++$)for(let D=0;D<d.inChannels;++D)for(let O=0;O<d.inHeight;++O)for(let P=0;P<d.inWidth;++P){const z=O-R,W=P-k;let F=0;for(let B=0;B<E;B+=b){const U=(z+B)/x;if(!(U<0||U>=d.outHeight||Math.floor(U)!==U))for(let q=0;q<S;q+=C){const M=(W+q)/y;if(M<0||M>=d.outWidth||Math.floor(M)!==M)continue;const G=E*S-1-g.get($,U,M,D),Q=B*S+q,Z=G===Q?1:0;if(Z===0)continue;const rt=_.get($,U,M,D);F+=rt*Z}}A.set(F,$,O,P,D)}return e.makeTensorInfo(A.shape,A.dtype,A.values)}const Ukt={kernelName:fR,backendName:"cpu",kernelFunc:zkt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wkt(n,t,e,r,o){const a=ue(t),i=aN(n,t,e,a,o,"max"),s=VH(n,t,e,o,!0,r);return[i.values,s.values]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vkt={kernelName:yz,backendName:"cpu",kernelFunc:({inputs:n,attrs:t,backend:e})=>{const{x:r}=n,{filterSize:o,strides:a,pad:i,includeBatchInIndex:s}=t,u=e;Xt(r,"MaxPoolWithArgmax");const l=u.data.get(r.dataId).values,c=Ya(r.shape,o,a,[1,1],i),[h,d]=Wkt(l,r.shape,r.dtype,s,c),p=u.write(h,c.outShape,r.dtype),g=u.write(d,c.outShape,r.dtype);return[{dataId:p,shape:c.outShape,dtype:r.dtype},{dataId:g,shape:c.outShape,dtype:"int32"}]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gkt(n){const{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{axis:a,keepDims:i}=r,s=_e(a,o.shape),l=Dr(o.shape,s)[1],c=It(l),h=[],d=e.makeTensorInfo([],"float32",new Float32Array([c]));h.push(d);const p=fl({inputs:{x:o},backend:e,attrs:{dtype:"float32"}});h.push(p);const g=iN({inputs:{a:p,b:d},backend:e});h.push(g);const x=ov({inputs:{x:g},backend:e,attrs:{axis:a,keepDims:i}});return h.forEach(y=>e.disposeIntermediateTensorInfo(y)),x}const Hkt={kernelName:q1,backendName:"cpu",kernelFunc:Gkt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qkt(n){const{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{axis:a,keepDims:i}=r;Xt(o,"min");const s=_e(a,o.shape);let u=s;const l=Pn(u,o.shape.length);let c=o;l!=null&&(c=$o({inputs:{x:o},backend:e,attrs:{perm:l}}),u=er(u.length,o.shape.length)),Gr("min",u,c.shape.length);const[h,d]=Dr(c.shape,u),p=It(d),g=to(It(h),c.dtype),x=e.data.get(c.dataId).values;for(let b=0;b<g.length;++b){const C=b*p;let E=x[C];for(let S=0;S<p;++S){const k=x[C+S];(Number.isNaN(k)||k<E)&&(E=k)}g[b]=E}l!=null&&e.disposeIntermediateTensorInfo(c);const y=e.makeTensorInfo(h,c.dtype,g);if(i){const b=lr(h,s),C=In({inputs:{x:y},backend:e,attrs:{shape:b}});return e.disposeIntermediateTensorInfo(y),C}return y}const jkt={kernelName:j1,backendName:"cpu",kernelFunc:qkt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xkt(n){const{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{paddings:a,mode:i}=r;Xt(o,"mirrorPad");const s=a.map((E,S)=>E[0]+o.shape[S]+E[1]),u=a.map(E=>E[0]),l=a.map((E,S)=>E[0]+o.shape[S]),c=i==="reflect"?0:1,h=e.data.get(o.dataId).values,d=o.shape.length,p=ue(o.shape),g=It(s),x=s.length,y=ue(s),b=Jr(o.dtype,g);for(let E=0;E<g;E++){let S=cd(E,x,y);for(let R=0;R<x;R++)S[R]<u[R]?S[R]=u[R]*2-S[R]-c:S[R]>=l[R]&&(S[R]=(l[R]-1)*2-S[R]+c);S=S.map((R,A)=>R-u[A]);const k=Ki(S,d,p);b[E]=h[k]}return{dataId:e.write(b,s,o.dtype),shape:s,dtype:o.dtype}}const Kkt={kernelName:X1,backendName:"cpu",kernelFunc:Xkt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ykt=rr((n,t)=>{const e=n%t;return n<0&&t<0||n>=0&&t>=0?e:(e+t)%t}),Qkt=wr(wg,Ykt),Zkt={kernelName:wg,backendName:"cpu",kernelFunc:Qkt};var k0={exports:{}},Jkt=k0.exports,TF;function tIt(){return TF||(TF=1,function(n){(function(t,e,r){function o(u){var l=this,c=s();l.next=function(){var h=2091639*l.s0+l.c*23283064365386963e-26;return l.s0=l.s1,l.s1=l.s2,l.s2=h-(l.c=h|0)},l.c=1,l.s0=c(" "),l.s1=c(" "),l.s2=c(" "),l.s0-=c(u),l.s0<0&&(l.s0+=1),l.s1-=c(u),l.s1<0&&(l.s1+=1),l.s2-=c(u),l.s2<0&&(l.s2+=1),c=null}function a(u,l){return l.c=u.c,l.s0=u.s0,l.s1=u.s1,l.s2=u.s2,l}function i(u,l){var c=new o(u),h=l&&l.state,d=c.next;return d.int32=function(){return c.next()*4294967296|0},d.double=function(){return d()+(d()*2097152|0)*11102230246251565e-32},d.quick=d,h&&(typeof h=="object"&&a(h,c),d.state=function(){return a(c,{})}),d}function s(){var u=4022871197,l=function(c){c=String(c);for(var h=0;h<c.length;h++){u+=c.charCodeAt(h);var d=.02519603282416938*u;u=d>>>0,d-=u,d*=u,u=d>>>0,d-=u,u+=d*4294967296}return(u>>>0)*23283064365386963e-26};return l}e&&e.exports?e.exports=i:this.alea=i})(Jkt,n)}(k0)),k0.exports}var I0={exports:{}},eIt=I0.exports,NF;function nIt(){return NF||(NF=1,function(n){(function(t,e,r){function o(s){var u=this,l="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var h=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^h^h>>>8},s===(s|0)?u.x=s:l+=s;for(var c=0;c<l.length+64;c++)u.x^=l.charCodeAt(c)|0,u.next()}function a(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function i(s,u){var l=new o(s),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,g=(d+p)/(1<<21);while(g===0);return g},h.int32=l.next,h.quick=h,c&&(typeof c=="object"&&a(c,l),h.state=function(){return a(l,{})}),h}e&&e.exports?e.exports=i:this.xor128=i})(eIt,n)}(I0)),I0.exports}var R0={exports:{}},rIt=R0.exports,AF;function oIt(){return AF||(AF=1,function(n){(function(t,e,r){function o(s){var u=this,l="";u.next=function(){var h=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^(h^h<<1))|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(s|0)?u.x=s:l+=s;for(var c=0;c<l.length+64;c++)u.x^=l.charCodeAt(c)|0,c==l.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function a(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function i(s,u){var l=new o(s),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,g=(d+p)/(1<<21);while(g===0);return g},h.int32=l.next,h.quick=h,c&&(typeof c=="object"&&a(c,l),h.state=function(){return a(l,{})}),h}e&&e.exports?e.exports=i:this.xorwow=i})(rIt,n)}(R0)),R0.exports}var T0={exports:{}},aIt=T0.exports,_F;function iIt(){return _F||(_F=1,function(n){(function(t,e,r){function o(s){var u=this;u.next=function(){var c=u.x,h=u.i,d,p;return d=c[h],d^=d>>>7,p=d^d<<24,d=c[h+1&7],p^=d^d>>>10,d=c[h+3&7],p^=d^d>>>3,d=c[h+4&7],p^=d^d<<7,d=c[h+7&7],d=d^d<<13,p^=d^d<<9,c[h]=p,u.i=h+1&7,p};function l(c,h){var d,p=[];if(h===(h|0))p[0]=h;else for(h=""+h,d=0;d<h.length;++d)p[d&7]=p[d&7]<<15^h.charCodeAt(d)+p[d+1&7]<<13;for(;p.length<8;)p.push(0);for(d=0;d<8&&p[d]===0;++d);for(d==8?p[7]=-1:p[d],c.x=p,c.i=0,d=256;d>0;--d)c.next()}l(u,s)}function a(s,u){return u.x=s.x.slice(),u.i=s.i,u}function i(s,u){s==null&&(s=+new Date);var l=new o(s),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,g=(d+p)/(1<<21);while(g===0);return g},h.int32=l.next,h.quick=h,c&&(c.x&&a(c,l),h.state=function(){return a(l,{})}),h}e&&e.exports?e.exports=i:this.xorshift7=i})(aIt,n)}(T0)),T0.exports}var N0={exports:{}},sIt=N0.exports,DF;function uIt(){return DF||(DF=1,function(n){(function(t,e,r){function o(s){var u=this;u.next=function(){var c=u.w,h=u.X,d=u.i,p,g;return u.w=c=c+1640531527|0,g=h[d+34&127],p=h[d=d+1&127],g^=g<<13,p^=p<<17,g^=g>>>15,p^=p>>>12,g=h[d]=g^p,u.i=d,g+(c^c>>>16)|0};function l(c,h){var d,p,g,x,y,b=[],C=128;for(h===(h|0)?(p=h,h=null):(h=h+"\0",p=0,C=Math.max(C,h.length)),g=0,x=-32;x<C;++x)h&&(p^=h.charCodeAt((x+32)%h.length)),x===0&&(y=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,x>=0&&(y=y+1640531527|0,d=b[x&127]^=p+y,g=d==0?g+1:0);for(g>=128&&(b[(h&&h.length||0)&127]=-1),g=127,x=4*128;x>0;--x)p=b[g+34&127],d=b[g=g+1&127],p^=p<<13,d^=d<<17,p^=p>>>15,d^=d>>>12,b[g]=p^d;c.w=y,c.X=b,c.i=g}l(u,s)}function a(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function i(s,u){s==null&&(s=+new Date);var l=new o(s),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,g=(d+p)/(1<<21);while(g===0);return g},h.int32=l.next,h.quick=h,c&&(c.X&&a(c,l),h.state=function(){return a(l,{})}),h}e&&e.exports?e.exports=i:this.xor4096=i})(sIt,n)}(N0)),N0.exports}var A0={exports:{}},lIt=A0.exports,$F;function cIt(){return $F||($F=1,function(n){(function(t,e,r){function o(s){var u=this,l="";u.next=function(){var h=u.b,d=u.c,p=u.d,g=u.a;return h=h<<25^h>>>7^d,d=d-p|0,p=p<<24^p>>>8^g,g=g-h|0,u.b=h=h<<20^h>>>12^d,u.c=d=d-p|0,u.d=p<<16^d>>>16^g,u.a=g-h|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=s|0):l+=s;for(var c=0;c<l.length+20;c++)u.b^=l.charCodeAt(c)|0,u.next()}function a(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function i(s,u){var l=new o(s),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,g=(d+p)/(1<<21);while(g===0);return g},h.int32=l.next,h.quick=h,c&&(typeof c=="object"&&a(c,l),h.state=function(){return a(l,{})}),h}e&&e.exports?e.exports=i:this.tychei=i})(lIt,n)}(A0)),A0.exports}var _0={exports:{}},hIt=_0.exports,OF;function fIt(){return OF||(OF=1,function(n){(function(t,e,r){var o=256,a=6,i=52,s="random",u=r.pow(o,a),l=r.pow(2,i),c=l*2,h=o-1,d;function p(S,k,R){var A=[];k=k==!0?{entropy:!0}:k||{};var N=b(y(k.entropy?[S,E(e)]:S??C(),3),A),_=new g(A),$=function(){for(var D=_.g(a),O=u,P=0;D<l;)D=(D+P)*o,O*=o,P=_.g(1);for(;D>=c;)D/=2,O/=2,P>>>=1;return(D+P)/O};return $.int32=function(){return _.g(4)|0},$.quick=function(){return _.g(4)/4294967296},$.double=$,b(E(_.S),e),(k.pass||R||function(D,O,P,z){return z&&(z.S&&x(z,_),D.state=function(){return x(_,{})}),P?(r[s]=D,O):D})($,N,"global"in k?k.global:this==r,k.state)}function g(S){var k,R=S.length,A=this,N=0,_=A.i=A.j=0,$=A.S=[];for(R||(S=[R++]);N<o;)$[N]=N++;for(N=0;N<o;N++)$[N]=$[_=h&_+S[N%R]+(k=$[N])],$[_]=k;(A.g=function(D){for(var O,P=0,z=A.i,W=A.j,F=A.S;D--;)O=F[z=h&z+1],P=P*o+F[h&(F[z]=F[W=h&W+O])+(F[W]=O)];return A.i=z,A.j=W,P})(o)}function x(S,k){return k.i=S.i,k.j=S.j,k.S=S.S.slice(),k}function y(S,k){var R=[],A=typeof S,N;if(k&&A=="object")for(N in S)try{R.push(y(S[N],k-1))}catch{}return R.length?R:A=="string"?S:S+"\0"}function b(S,k){for(var R=S+"",A,N=0;N<R.length;)k[h&N]=h&(A^=k[h&N]*19)+R.charCodeAt(N++);return E(k)}function C(){try{var S;return d&&(S=d.randomBytes)?S=S(o):(S=new Uint8Array(o),(t.crypto||t.msCrypto).getRandomValues(S)),E(S)}catch{var k=t.navigator,R=k&&k.plugins;return[+new Date,t,R,t.screen,E(e)]}}function E(S){return String.fromCharCode.apply(0,S)}if(b(r.random(),e),n.exports){n.exports=p;try{d=qR}catch{}}else r["seed"+s]=p})(typeof self<"u"?self:hIt,[],Math)}(_0)),_0.exports}var yS,FF;function dIt(){if(FF)return yS;FF=1;var n=tIt(),t=nIt(),e=oIt(),r=iIt(),o=uIt(),a=cIt(),i=fIt();return i.alea=n,i.xor128=t,i.xorwow=e,i.xorshift7=r,i.xor4096=o,i.tychei=a,yS=i,yS}var pIt=dIt();/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KH(n){const{inputs:t,backend:e,attrs:r}=n,{logits:o}=t,{dim:a}=r,i=o.shape.length;let s=a;if(s===-1&&(s=i-1),s!==i-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${i} and dim was ${s}`);const u=_e([s],o.shape),l=XH({inputs:{x:o},backend:e,attrs:{reductionIndices:u,keepDims:!1}}),c=lr(l.shape,u),h=In({inputs:{x:l},backend:e,attrs:{shape:c}}),d=oN({inputs:{a:o,b:h},backend:e}),p=JG({inputs:{x:d},backend:e}),g=ov({inputs:{x:p},backend:e,attrs:{axis:u,keepDims:!1}}),x=In({inputs:{x:g},backend:e,attrs:{shape:c}}),y=iN({inputs:{a:p,b:x},backend:e});return e.disposeIntermediateTensorInfo(l),e.disposeIntermediateTensorInfo(h),e.disposeIntermediateTensorInfo(d),e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(g),e.disposeIntermediateTensorInfo(x),y}const mIt={kernelName:fb,backendName:"cpu",kernelFunc:KH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gIt(n){const{inputs:t,backend:e,attrs:r}=n,{logits:o}=t,{numSamples:a,seed:i,normalized:s}=r;Xt(o,"multinomial");const u=s?o:KH({inputs:{logits:o},backend:e,attrs:{dim:-1}}),l=u.shape[0],c=u.shape[1],h=e.data.get(u.dataId).values,d=[l,a],p=to(It(d),"int32");for(let g=0;g<l;++g){const x=g*c,y=new Float32Array(c-1);y[0]=h[x];for(let E=1;E<y.length;++E)y[E]=y[E-1]+h[x+E];const b=pIt.alea(i.toString()),C=g*a;for(let E=0;E<a;++E){const S=b();p[C+E]=y.length;for(let k=0;k<y.length;k++)if(S<y[k]){p[C+E]=k;break}}}return s||e.disposeIntermediateTensorInfo(u),e.makeTensorInfo(d,"int32",p)}const vIt={kernelName:bz,backendName:"cpu",kernelFunc:gIt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xIt=eT;function yIt(n){const{inputs:t,backend:e,attrs:r}=n,{boxes:o,scores:a}=t,{maxOutputSize:i,iouThreshold:s,scoreThreshold:u}=r;Xt(o,"NonMaxSuppression");const l=e.data.get(o.dataId).values,c=e.data.get(a.dataId).values,{selectedIndices:h}=xIt(l,c,i,s,u);return e.makeTensorInfo([h.length],"int32",new Int32Array(h))}const bIt={kernelName:pR,backendName:"cpu",kernelFunc:yIt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wIt=nT;function CIt(n){const{inputs:t,backend:e,attrs:r}=n,{boxes:o,scores:a}=t,{maxOutputSize:i,iouThreshold:s,scoreThreshold:u,padToMaxOutputSize:l}=r;Xt(o,"NonMaxSuppressionPadded");const c=e.data.get(o.dataId).values,h=e.data.get(a.dataId).values,{selectedIndices:d,validOutputs:p}=wIt(c,h,i,s,u,l);return[e.makeTensorInfo([d.length],"int32",new Int32Array(d)),e.makeTensorInfo([],"int32",new Int32Array([p]))]}const SIt={kernelName:mR,backendName:"cpu",kernelFunc:CIt};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EIt=rT;function kIt(n){const{inputs:t,backend:e,attrs:r}=n,{boxes:o,scores:a}=t,{maxOutputSize:i,iouThreshold:s,scoreThreshold:u,softNmsSigma:l}=r;Xt(o,"NonMaxSuppressionWithScore");const c=e.data.get(o.dataId).values,h=e.data.get(a.dataId).values,d=i,p=s,g=u,x=l,{selectedIndices:y,selectedScores:b}=EIt(c,h,d,p,g,x);return[e.makeTensorInfo([y.length],"int32",new Int32Array(y)),e.makeTensorInfo([b.length],"float32",new Float32Array(b))]}const IIt={kernelName:gR,backendName:"cpu",kernelFunc:kIt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RIt(n){const{inputs:t,backend:e,attrs:r}=n,{indices:o}=t,{dtype:a,depth:i,onValue:s,offValue:u}=r;Xt(o,"oneHot");const l=It(o.shape),c=new Float32Array(l*i);c.fill(u);const h=e.data.get(o.dataId).values;for(let d=0;d<l;++d)h[d]>=0&&h[d]<i&&(c[d*i+h[d]]=s);return e.makeTensorInfo([...o.shape,i],a,c)}const TIt={kernelName:Z1,backendName:"cpu",kernelFunc:RIt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zy(n){const{inputs:t,backend:e}=n,{x:r}=t;if(r.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(r.dtype==="complex64"){const o=Lc({inputs:{input:r},backend:e}),a=zy({inputs:{x:o},backend:e}),i=Xf({inputs:{input:r},backend:e}),s=zy({inputs:{x:i},backend:e}),u=Vo({inputs:{real:a,imag:s},backend:e});return e.disposeIntermediateTensorInfo(o),e.disposeIntermediateTensorInfo(a),e.disposeIntermediateTensorInfo(i),e.disposeIntermediateTensorInfo(s),u}else return sN({backend:e,attrs:{shape:r.shape,value:0,dtype:r.dtype}})}const NIt={kernelName:mb,backendName:"cpu",kernelFunc:zy};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YH(n){const{inputs:t,backend:e}=n,{x:r}=t;if(r.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(r.dtype==="complex64"){const o=Lc({inputs:{input:r},backend:e}),a=YH({inputs:{x:o},backend:e}),i=Xf({inputs:{input:r},backend:e}),s=zy({inputs:{x:i},backend:e}),u=Vo({inputs:{real:a,imag:s},backend:e});return e.disposeIntermediateTensorInfo(o),e.disposeIntermediateTensorInfo(a),e.disposeIntermediateTensorInfo(i),e.disposeIntermediateTensorInfo(s),u}else return sN({backend:e,attrs:{shape:r.shape,value:1,dtype:r.dtype}})}const AIt={kernelName:Q1,backendName:"cpu",kernelFunc:YH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QH(n){const{inputs:t,backend:e,attrs:r}=n,{axis:o}=r;if(t.length===1)return By({inputs:{input:t[0]},backend:e,attrs:{dim:o}});const a=t[0].shape,i=t[0].dtype;t.forEach(c=>{LI(a,c.shape,"All tensors passed to stack must have matching shapes"),H(i===c.dtype,()=>"All tensors passed to stack must have matching dtypes")});const s=[],u=t.map(c=>{const h=By({inputs:{input:c},backend:e,attrs:{dim:o}});return s.push(h),h}),l=Kf({inputs:u,backend:e,attrs:{axis:o}});return s.forEach(c=>e.disposeIntermediateTensorInfo(c)),l}const _It={kernelName:J1,backendName:"cpu",kernelFunc:QH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DIt(n){const{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{paddings:a,constantValue:i}=r;Xt(o,"pad");const s=a.map((C,E)=>C[0]+o.shape[E]+C[1]),u=a.map(C=>C[0]),l=e.data.get(o.dataId).values,c=It(o.shape),h=o.shape.length,d=ue(o.shape),p=It(s),g=s.length,x=ue(s),y=Jr(o.dtype,p);i!==0&&y.fill(i);for(let C=0;C<c;C++){const S=cd(C,h,d).map((R,A)=>R+u[A]),k=Ki(S,g,x);y[k]=l[C]}return{dataId:e.write(y,s,o.dtype),shape:s,dtype:o.dtype}}const ZH={kernelName:tb,backendName:"cpu",kernelFunc:DIt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $It=rr((n,t)=>Math.pow(n,t)),OIt=wr(Sg,$It),FIt={kernelName:Sg,backendName:"cpu",kernelFunc:OIt};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MIt(n){const{inputs:t,backend:e,attrs:r}=n,{paramsNestedSplits:o,paramsDenseValues:a,indices:i}=t,{outputRaggedRank:s}=r,u=o.map(b=>e.data.get(b.dataId).values),l=o.map(b=>b.shape),c=e.data.get(a.dataId).values,h=e.data.get(i.dataId).values,[d,p,g]=vH(u,l,c,a.shape,a.dtype,h,i.shape),x=d.map(b=>e.makeTensorInfo([b.length],"int32",b)),y=e.makeTensorInfo(g,a.dtype,p);return x.concat([y])}const LIt={kernelName:wz,backendName:"cpu",kernelFunc:MIt};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PIt(n){const{inputs:t,backend:e}=n,{starts:r,limits:o,deltas:a}=t,i=e.data.get(r.dataId).values,s=e.data.get(o.dataId).values,u=e.data.get(a.dataId).values,[l,c]=xH(i,r.shape,r.dtype,s,o.shape,u,a.shape),h=e.makeTensorInfo([l.length],"int32",l),d=e.makeTensorInfo([c.length],r.dtype,c);return[h,d]}const BIt={kernelName:Cz,backendName:"cpu",kernelFunc:PIt};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zIt(n){const{inputs:t,backend:e,attrs:r}=n,{shape:o,values:a,defaultValue:i,rowPartitionTensors:s}=t,{rowPartitionTypes:u}=r,l=e.data.get(o.dataId).values,c=e.data.get(a.dataId).values,h=e.data.get(i.dataId).values,d=s.map(y=>e.data.get(y.dataId).values),p=s.map(y=>y.shape),[g,x]=yH(l,o.shape,c,a.shape,a.dtype,h,i.shape,d,p,u);return e.makeTensorInfo(g,a.dtype,x)}const UIt={kernelName:Sz,backendName:"cpu",kernelFunc:zIt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WIt(n){const{backend:t,attrs:e}=n,{start:r,stop:o,dtype:a,step:i}=e,s=bH(r,o,i,a);return t.makeTensorInfo([s.length],a,s)}const VIt={kernelName:vR,backendName:"cpu",kernelFunc:WIt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GIt=hn(Eg,n=>1/n),HIt={kernelName:Eg,backendName:"cpu",kernelFunc:GIt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qIt(n){const{inputs:t,backend:e,attrs:r}=n,{images:o}=t,{alignCorners:a,halfPixelCenters:i,size:s}=r;Xt(o,"resizeBilinear");const u=ue(o.shape),[l,c]=s,[h,d,p,g]=o.shape,x=e.data.get(o.dataId).values,y=new Float32Array(It([h,l,c,g])),b=[a&&l>1?d-1:d,a&&c>1?p-1:p],C=[a&&l>1?l-1:l,a&&c>1?c-1:c];let E=0;const S=b[0]/C[0],k=b[1]/C[1];for(let R=0;R<h;R++)for(let A=0;A<l;A++){let N;i?N=S*(A+.5)-.5:N=S*A;const _=Math.max(0,Math.floor(N)),$=N-_,D=Math.min(d-1,Math.ceil(N)),O=R*u[0]+_*u[1],P=R*u[0]+D*u[1];for(let z=0;z<c;z++){let W;i?W=k*(z+.5)-.5:W=k*z;const F=Math.max(0,Math.floor(W)),B=W-F,U=Math.min(p-1,Math.ceil(W)),q=O+F*u[2],M=P+F*u[2],G=O+U*u[2],Q=P+U*u[2];for(let Z=0;Z<g;Z++){const rt=x[q+Z],ct=x[M+Z],pt=x[G+Z],Rt=x[Q+Z],Ct=rt+(pt-rt)*B,Ft=ct+(Rt-ct)*B,Ut=Ct+(Ft-Ct)*$;y[E++]=Ut}}}return e.makeTensorInfo([h,l,c,g],"float32",y)}const jIt={kernelName:ab,backendName:"cpu",kernelFunc:qIt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XIt(n){const{inputs:t,backend:e,attrs:r}=n,{images:o,dy:a}=t,{alignCorners:i}=r;Xt([a,o],"resizeBilinearGrad");const s=ue(o.shape),[u,l,c,h]=o.shape,[,d,p]=a.shape,g=new Float32Array(u*l*c*h),x=[i&&d>1?l-1:l,i&&p>1?c-1:c],y=[i&&d>1?d-1:d,i&&p>1?p-1:p],b=x[0]/y[0],C=x[1]/y[1],E=e.data.get(a.dataId).values;let S=0;for(let k=0;k<u;k++){const R=k*s[0];for(let A=0;A<d;A++){const N=A*b,_=Math.floor(N),$=Math.min(Math.ceil(N),l-1),D=R+_*s[1],O=R+$*s[1],P=N-_,z=1-P;for(let W=0;W<p;W++){const F=W*C,B=Math.floor(F),U=Math.min(Math.ceil(F),c-1),q=F-B,M=1-q,G=D+B*s[2],Q=D+U*s[2],Z=O+B*s[2],rt=O+U*s[2],ct=z*M,pt=z*q,Rt=P*M,Ct=P*q;for(let Ft=0;Ft<h;Ft++){const Ut=E[S++];g[G+Ft]+=Ut*ct,g[Q+Ft]+=Ut*pt,g[Z+Ft]+=Ut*Rt,g[rt+Ft]+=Ut*Ct}}}}return e.makeTensorInfo([u,c,l,h],"float32",g)}const KIt={kernelName:bR,backendName:"cpu",kernelFunc:XIt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YIt(n){const{inputs:t,backend:e,attrs:r}=n,{images:o}=t,{alignCorners:a,halfPixelCenters:i,size:s}=r;Xt(o,"resizeNearestNeighbor");const u=ue(o.shape),[l,c]=s,[h,d,p,g]=o.shape,x=e.data.get(o.dataId).values,y=new Float32Array(h*l*c*g),b=[a&&l>1?d-1:d,a&&c>1?p-1:p],C=[a&&l>1?l-1:l,a&&c>1?c-1:c],E=b[0]/C[0],S=b[1]/C[1];let k=0;for(let R=0;R<h;R++){const A=R*u[0];for(let N=0;N<l;N++){const _=i?E*(N+.5):E*N;let $=Math.min(d-1,a?Math.round(_):Math.floor(_));i&&($=Math.max(0,$));const D=A+$*u[1];for(let O=0;O<c;O++){const P=i?S*(O+.5):S*O;let z=Math.min(p-1,a?Math.round(P):Math.floor(P));i&&(z=Math.max(0,z));const W=D+z*u[2];for(let F=0;F<g;F++){const B=x[W+F];y[k++]=B}}}}return e.makeTensorInfo([h,l,c,g],o.dtype,y)}const QIt={kernelName:ob,backendName:"cpu",kernelFunc:YIt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZIt(n){const{inputs:t,backend:e,attrs:r}=n,{images:o,dy:a}=t,{alignCorners:i}=r;Xt([a,o],"resizeNearestNeighborGrad");const s=ue(o.shape),u=ue(a.shape),[l,c,h,d]=o.shape,[,p,g]=a.shape,x=new Float32Array(l*c*h*d),y=e.data.get(a.dataId).values,b=[i&&p>1?c-1:c,i&&g>1?h-1:h],C=[i&&p>1?p-1:p,i&&g>1?g-1:g],E=b[0]/C[0],S=b[1]/C[1],k=1/E,R=1/S,A=Math.ceil(k)*2+2,N=Math.ceil(R)*2+2;for(let _=0;_<l;_++){const $=_*s[0];for(let D=0;D<c;D++){const O=$+D*s[1],P=Math.floor(D*k),z=Math.floor(P-A/2);for(let W=0;W<h;W++){const F=O+W*s[2],B=Math.floor(W*R),U=Math.floor(B-N/2);for(let q=0;q<d;q++){let M=0;for(let G=0;G<A;G++){const Q=G+z;if(Q<0||Q>=p)continue;const Z=$+Q*u[1],rt=Q*E,ct=Math.min(c-1,i?Math.round(rt):Math.floor(rt));if(D===ct)for(let pt=0;pt<N;pt++){const Rt=pt+U;if(Rt<0||Rt>=g)continue;const Ct=Z+Rt*u[2],Ft=Rt*S,Ut=Math.min(h-1,i?Math.round(Ft):Math.floor(Ft));W===Ut&&(M+=y[Ct+q])}}x[F+q]=M}}}}return e.makeTensorInfo(o.shape,o.dtype,x)}const JIt={kernelName:yR,backendName:"cpu",kernelFunc:ZIt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tRt(n){const{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{dims:a}=r;Xt(o,"reverse");const i=o.shape.length,s=_e(a,o.shape);if(i===0)return us({inputs:{x:o},backend:e});const u=new Ur(o.shape,o.dtype),l=e.bufferSync(o);for(let c=0;c<u.size;c++){const h=u.indexToLoc(c),d=h.slice();s.forEach(p=>d[p]=o.shape[p]-1-d[p]),u.set(l.get(...d),...h)}return e.makeTensorInfo(u.shape,u.dtype,u.values)}const eRt={kernelName:ib,backendName:"cpu",kernelFunc:tRt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nRt={kernelName:RR,backendName:"cpu",kernelFunc:({inputs:n,attrs:t,backend:e})=>{const{image:r}=n,{radians:o,fillValue:a,center:i}=t,s=e,u=Jr(r.dtype,It(r.shape)),[l,c,h,d]=r.shape,[p,g]=pT(i,c,h),x=255,y=Math.sin(o),b=Math.cos(o),C=s.data.get(r.dataId).values;for(let S=0;S<l;S++){const k=S*h*c*d;for(let R=0;R<c;R++){const A=R*(h*d);for(let N=0;N<h;N++){const _=N*d;for(let $=0;$<d;$++){const D=[l,R,N,$],O=D[2],P=D[1];let z=(O-p)*b-(P-g)*y,W=(O-p)*y+(P-g)*b;z=Math.round(z+p),W=Math.round(W+g);let F=a;if(typeof a!="number"&&($===3?F=x:F=a[$]),z>=0&&z<h&&W>=0&&W<c){const U=W*(h*d),q=z*d,M=k+U+q+$;F=C[M]}const B=k+A+_+$;u[B]=F}}}}return{dataId:s.write(u,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rRt=hn(Rg,n=>{const t=Math.floor(n);return n-t<.5?Math.floor(n):n-t>.5?Math.ceil(n):t%2===0?t:t+1}),oRt={kernelName:Rg,backendName:"cpu",kernelFunc:rRt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aRt(n){const{inputs:t,backend:e,attrs:r}=n,{indices:o,updates:a}=t,{shape:i}=r,{sliceRank:s,numUpdates:u,sliceSize:l,strides:c,outputSize:h}=rh(a,o,i),d=!0,p=e.bufferSync(o),g=e.bufferSync(a),x=fc(p,g,i,h,l,u,s,c,0,d);return e.makeTensorInfo(i,x.dtype,x.values)}const iRt={kernelName:Ez,backendName:"cpu",kernelFunc:aRt};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sRt(n,t){let e=0,r=n.length,o=0;for(;e<r;)o=Math.floor((e+r)/2),n[o]<t?e=o+1:r=o;return r}function uRt(n,t){let e=0,r=n.length,o=0;for(;e<r;)o=Math.floor((e+r)/2),n[o]<=t?e=o+1:r=o;return r}function lRt(n,t,e,r,o,a){const i=Qn("int32",e*o);for(let s=0;s<e;++s){const u=n.slice(s*r,(s+1)*r),l=s*o;for(let c=0;c<o;++c)i[l+c]=a==="left"?sRt(u,t[c+l]):uRt(u,t[c+l])}return i}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cRt(n){const{inputs:t,backend:e,attrs:r}=n,{sortedSequence:o,values:a}=t,{side:i}=r,s=e.data.get(o.dataId).values,u=e.data.get(a.dataId).values,l=lRt(s,u,o.shape[0],o.shape[1],a.shape[1],i);return e.makeTensorInfo(a.shape,"int32",l)}const hRt={kernelName:Iz,backendName:"cpu",kernelFunc:cRt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fRt(n){const{inputs:t,backend:e}=n,{condition:r,t:o,e:a}=t;Xt([r,o,a],"select");const i=r.shape.length,s=e.data.get(r.dataId).values,u=e.data.get(o.dataId).values,l=e.data.get(a.dataId).values,c=Yo(o.dtype,a.dtype),h=to(It(o.shape),c);let d=0;const p=i===0||i>1||o.shape.length===1?1:It(o.shape.slice(1));for(let g=0;g<s.length;g++)for(let x=0;x<p;x++)s[g]===1?h[d++]=u[g]:h[d++]=l[g];return e.makeTensorInfo(o.shape,c,h)}const dRt={kernelName:sb,backendName:"cpu",kernelFunc:fRt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pRt=Rb,mRt=Tb,gRt=hn(Ng,n=>n>=0?mRt*n:pRt*(Math.exp(n)-1)),vRt={kernelName:Ng,backendName:"cpu",kernelFunc:gRt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xRt=hn(Dg,n=>n<0?-1:n>0?1:0),yRt={kernelName:Dg,backendName:"cpu",kernelFunc:xRt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bRt=hn(Ag,n=>Math.sin(n)),wRt={kernelName:Ag,backendName:"cpu",kernelFunc:bRt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CRt=hn(_g,n=>Math.sinh(n)),SRt={kernelName:_g,backendName:"cpu",kernelFunc:CRt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ERt=11920928955078125e-23,MF=Math.log(ERt)+2,kRt=hn(Og,n=>{const t=n>-MF,e=n<MF,r=Math.exp(n);let o;return e?o=r:t?o=n:o=Math.log(1+r),o}),IRt={kernelName:Og,backendName:"cpu",kernelFunc:kRt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RRt(n){const{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{blockShape:a,paddings:i}=r;Xt([o],"spaceToBatchND");const s=It(a),u=[[0,0]];u.push(...i);for(let R=1+a.length;R<o.shape.length;++R)u.push([0,0]);const l=ZH.kernelFunc({inputs:{x:o},backend:e,attrs:{paddings:u,constantValue:0}}),c=jg(l.shape,a,s,!1),h=Xg(c.length,a.length,!1),d=Kg(l.shape,a,s,!1),x=In({inputs:{x:l},backend:e,attrs:{shape:c}}),C=$o({inputs:{x},backend:e,attrs:{perm:h}}),k=In({inputs:{x:C},backend:e,attrs:{shape:d}});return e.disposeIntermediateTensorInfo(l),e.disposeIntermediateTensorInfo(x),e.disposeIntermediateTensorInfo(C),k}const TRt={kernelName:cb,backendName:"cpu",kernelFunc:RRt};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NRt(n){const{inputs:t,backend:e}=n,{indices:r,values:o,denseShape:a,defaultValue:i}=t;if(a.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${a.shape}`);if(r.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${r.shape}`);if(o.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${o.shape}`);if(i.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${i.shape}`);const s=e.data.get(r.dataId).values,u=e.data.get(o.dataId).values,l=e.data.get(a.dataId).values,c=e.data.get(i.dataId).values[0],[h,d,p,g,x]=EH(s,r.shape,r.dtype,u,o.dtype,l,c);return[e.makeTensorInfo(d,r.dtype,h),e.makeTensorInfo([d[0]],o.dtype,p),e.makeTensorInfo([g.length],"bool",new Uint8Array(g.map(y=>Number(y)))),e.makeTensorInfo([x.length],r.dtype,new Int32Array(x))]}const ARt={kernelName:Rz,backendName:"cpu",kernelFunc:NRt};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Rt(n){const{inputs:t,backend:e}=n,{inputIndices:r,inputShape:o,newShape:a}=t;if(r.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${r.shape}`);if(o.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${o.shape}`);if(a.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${a.shape}`);const i=Array.from(e.data.get(o.dataId).values),s=e.data.get(r.dataId).values,u=Array.from(e.data.get(a.dataId).values),[l,c,h]=kH(s,r.shape,r.dtype,i,u);return[e.makeTensorInfo(c,r.dtype,l),e.makeTensorInfo([h.length],a.dtype,new Int32Array(h))]}const DRt={kernelName:Tz,backendName:"cpu",kernelFunc:_Rt};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $Rt(n){const{inputs:t,backend:e}=n,{data:r,indices:o,segmentIds:a}=t;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(o.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${o.shape}`);if(a.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${a.shape}`);if(o.shape[0]!==a.shape[0])throw new Error("segmentIds and indices should have same size.");const i=e.data.get(r.dataId).values,s=e.data.get(o.dataId).values,u=e.data.get(a.dataId).values,[l,c]=rN(i,r.shape,r.dtype,s,u,!0);return e.makeTensorInfo(c,r.dtype,l)}const ORt={kernelName:Nz,backendName:"cpu",kernelFunc:$Rt};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FRt(n){const{inputs:t,backend:e}=n,{data:r,indices:o,segmentIds:a}=t;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(o.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${o.shape}`);if(a.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${a.shape}`);if(o.shape[0]!==a.shape[0])throw new Error("segmentIds and indices should have same size.");const i=e.data.get(r.dataId).values,s=e.data.get(o.dataId).values,u=e.data.get(a.dataId).values,[l,c]=rN(i,r.shape,r.dtype,s,u);return e.makeTensorInfo(c,r.dtype,l)}const MRt={kernelName:Az,backendName:"cpu",kernelFunc:FRt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LRt(n){const{inputs:t,backend:e,attrs:r}=n,{sparseIndices:o,sparseValues:a,defaultValue:i}=t,{outputShape:s}=r,{sliceRank:u,numUpdates:l,sliceSize:c,strides:h,outputSize:d}=rh(a,o,s),p=!1,g=e.bufferSync(o);let x;switch(a.dtype){case"bool":{const y=e.bufferSync(a),b=!!e.data.get(i.dataId).values[0];x=fc(g,y,s,d,c,l,u,h,b,p);break}case"float32":{const y=e.bufferSync(a),b=e.data.get(i.dataId).values[0];x=fc(g,y,s,d,c,l,u,h,b,p);break}case"int32":{const y=e.bufferSync(a),b=e.data.get(i.dataId).values[0];x=fc(g,y,s,d,c,l,u,h,b,p);break}case"string":{const y=e.bufferSync(a),b=sl(e.data.get(i.dataId).values[0]);x=fc(g,y,s,d,c,l,u,h,b,p);break}default:throw new Error(`Unsupported type ${a.dtype}`)}return e.makeTensorInfo(s,x.dtype,x.values)}const PRt={kernelName:_z,backendName:"cpu",kernelFunc:LRt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BRt(n){const{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{numOrSizeSplits:a,axis:i}=r,s=_e(i,o.shape)[0],u=NT(o,a,s),l=new Array(o.shape.length).fill(0),c=o.shape.slice();return u.map(h=>{const d=[...c];d[s]=h;const p=Pc({inputs:{x:o},backend:e,attrs:{begin:l,size:d}});return l[s]+=h,p})}const zRt={kernelName:hb,backendName:"cpu",kernelFunc:BRt};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const URt={kernelName:wR,backendName:"cpu",kernelFunc:({inputs:n,backend:t})=>{const{x:e}=n,r=t;Xt(e,"square");const o=r.data.get(e.dataId).values,a=new Float32Array(o.length);for(let s=0;s<o.length;++s){const u=o[s];a[s]=u*u}return{dataId:r.write(a,e.shape,e.dtype),shape:e.shape,dtype:e.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WRt=hn(Ug,(n,t)=>{const e=t;return isNaN(n)?NaN:n>0?1:e.alpha}),VRt={kernelName:Ug,backendName:"cpu",kernelFunc:WRt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GRt(n){const{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{begin:a,end:i,strides:s,beginMask:u,endMask:l,ellipsisMask:c,newAxisMask:h,shrinkAxisMask:d}=r;Xt(o,"stridedSlice");const{finalShapeSparse:p,finalShape:g,isIdentity:x,sliceDim0:y,isSimpleSlice:b,begin:C,end:E,strides:S}=hT(o.shape,a,i,s,u,l,c,h,d);let k;if(x)k=In({inputs:{x:o},backend:e,attrs:{shape:g}});else if(y||b){H(o.shape.length>=1,()=>`Input must have rank at least 1, got: ${o.shape.length}`);const R=uT(C,E,S),A=Pc({inputs:{x:o},backend:e,attrs:{begin:C,size:R}});k=In({inputs:{x:A},backend:e,attrs:{shape:g}}),e.disposeIntermediateTensorInfo(A)}else{const R=e.bufferSync(o),A=TH(p,R,S,C);k=e.makeTensorInfo(g,A.dtype,A.values)}return k}const HRt={kernelName:SR,backendName:"cpu",kernelFunc:GRt};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qRt(n){const{inputs:t,backend:e,attrs:r}=n,{separator:o,nGramWidths:a,leftPad:i,rightPad:s,padWidth:u,preserveShortSequences:l}=r,{data:c,dataSplits:h}=t,d=e.data.get(c.dataId).values,p=e.data.get(h.dataId).values,[g,x]=NH(d,p,o,a,i,s,u,l);return[e.makeTensorInfo([g.length],"string",g),e.makeTensorInfo(h.shape,"int32",x)]}const jRt={kernelName:Dz,backendName:"cpu",kernelFunc:qRt};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XRt(n){const{inputs:t,backend:e,attrs:r}=n,{skipEmpty:o}=r,{input:a,delimiter:i}=t;if(a.dtype!=="string")throw new Error("Input must be of datatype string");if(a.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${a.shape}`);if(i.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${i.shape}`);const s=e.data.get(a.dataId).values,u=e.data.get(i.dataId).values[0],[l,c,h]=AH(s,u,o),d=c.length;return[e.makeTensorInfo([d,2],"int32",l),e.makeTensorInfo([d],"string",c),e.makeTensorInfo([2],"int32",new Int32Array(h))]}const KRt={kernelName:$z,backendName:"cpu",kernelFunc:XRt};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YRt(n){const{inputs:t,backend:e,attrs:r}=n,{numBuckets:o}=r,{input:a}=t;if(a.dtype!=="string")throw new Error("Input must be of datatype string");if(o<=0)throw new Error("Number of buckets must be at least 1");const i=e.data.get(a.dataId).values,s=_H(i,o);return e.makeTensorInfo(a.shape,"int32",s)}const QRt={kernelName:Oz,backendName:"cpu",kernelFunc:YRt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZRt=hn(Pg,n=>Math.tan(n)),JRt={kernelName:Pg,backendName:"cpu",kernelFunc:ZRt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tTt=hn(Bg,n=>Math.tanh(n)),eTt={kernelName:Bg,backendName:"cpu",kernelFunc:tTt};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nTt(n){const{inputs:t,backend:e}=n,{tensor:r,indices:o,updates:a}=t,{sliceRank:i,numUpdates:s,sliceSize:u,strides:l,outputSize:c}=rh(a,o,r.shape),h=!1,d=e.bufferSync(o),p=e.bufferSync(a),g=e.bufferSync(r),x=fc(d,p,r.shape,c,u,s,i,l,g,h);return e.makeTensorInfo(r.shape,x.dtype,x.values)}const rTt={kernelName:kz,backendName:"cpu",kernelFunc:nTt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oTt(n){const{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{reps:a}=r;Xt(o,"tile");const i=$H(e.bufferSync(o),a);return e.makeTensorInfo(i.shape,i.dtype,i.values)}const aTt={kernelName:zg,backendName:"cpu",kernelFunc:oTt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iTt(n){const{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{k:a,sorted:i}=r;Xt(o,"topk");const s=e.data.get(o.dataId).values,[u,l]=FH(s,o.shape,o.dtype,a,i);return[e.makeTensorInfo(u.shape,u.dtype,u.values),e.makeTensorInfo(l.shape,l.dtype,l.values)]}const sTt={kernelName:ER,backendName:"cpu",kernelFunc:iTt};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uTt(n){const{inputs:t,attrs:e,backend:r}=n,{image:o,transforms:a}=t,{interpolation:i,fillMode:s,fillValue:u,outputShape:l}=e,[c,h,d,p]=o.shape,[g,x]=l??[h,d],y=[c,g,x,p],b=ue(o.shape),C=b[0],E=b[1],S=b[2],k=ue(y),R=k[0],A=k[1],N=k[2],_=Jr(o.dtype,It(y));_.fill(u);const $=r.data.get(o.dataId).values,D=r.data.get(a.dataId).values;for(let P=0;P<c;++P){const z=a.shape[0]===1?D:D.subarray(P*8,P*8+8);for(let W=0;W<g;++W)for(let F=0;F<x;++F)for(let B=0;B<p;++B){let U;const q=z[6]*F+z[7]*W+1;if(q===0)continue;const M=(z[0]*F+z[1]*W+z[2])/q,G=(z[3]*F+z[4]*W+z[5])/q,Q=LF(M,d,s),Z=LF(G,h,s);switch(i){case"nearest":U=pTt($,h,d,C,E,S,P,Z,Q,B,u);break;case"bilinear":U=mTt($,h,d,C,E,S,P,Z,Q,B,u);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${i}`)}const rt=P*R+W*A+F*N+B;_[rt]=U}return r.makeTensorInfo(y,o.dtype,_)}return{dataId:r.write(_,y,o.dtype),shape:o.shape,dtype:o.dtype}}const lTt={kernelName:kR,backendName:"cpu",kernelFunc:uTt};function LF(n,t,e){switch(e){case"reflect":return cTt(n,t);case"wrap":return hTt(n,t);case"nearest":return dTt(n,t);case"constant":default:return fTt(n)}}function cTt(n,t){let e=n;if(e<0)if(t<=1)e=0;else{const r=2*t;e<r&&(e=r*Math.trunc(-e/r)+e),e=e<-t?e+r:-e-1}else if(e>t-1)if(t<=1)e=0;else{const r=2*t;e-=r*Math.trunc(e/r),e>=t&&(e=r-e-1)}return Ic(0,e,t-1)}function hTt(n,t){let e=n;if(e<0)if(t<=1)e=0;else{const r=t-1;e+=t*(Math.trunc(-e/r)+1)}else if(e>t-1)if(t<=1)e=0;else{const r=t-1;e-=t*Math.trunc(e/r)}return Ic(0,e,t-1)}function fTt(n,t){return n}function dTt(n,t){return Ic(0,n,t-1)}function Hp(n,t,e,r,o,a,i,s,u,l,c){const h=i*r+s*o+u*a+l;return 0<=s&&s<t&&0<=u&&u<e?n[h]:c}function pTt(n,t,e,r,o,a,i,s,u,l,c){const h=Math.round(s),d=Math.round(u);return Hp(n,t,e,r,o,a,i,h,d,l,c)}function mTt(n,t,e,r,o,a,i,s,u,l,c){const h=Math.floor(s),d=Math.floor(u),p=h+1,g=d+1,x=(g-u)*Hp(n,t,e,r,o,a,i,h,d,l,c)+(u-d)*Hp(n,t,e,r,o,a,i,h,g,l,c),y=(g-u)*Hp(n,t,e,r,o,a,i,p,d,l,c)+(u-d)*Hp(n,t,e,r,o,a,i,p,g,l,c);return(p-s)*x+(s-h)*y}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gTt(n){const{inputs:t,attrs:e,backend:r}=n,{axis:o}=e,{x:a}=t;Xt(a,"unique");const i=r.data.get(a.dataId).values,{outputValues:s,outputShape:u,indices:l}=MH(i,o,a.shape,a.dtype);return[r.makeTensorInfo(u,a.dtype,s),r.makeTensorInfo([l.length],"int32",l)]}const vTt={kernelName:IR,backendName:"cpu",kernelFunc:gTt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xTt(n){const{inputs:t,backend:e,attrs:r}=n,{value:o}=t;let{axis:a}=r;a<0&&(a+=o.shape.length);const i=o.shape.length,s=o.shape[a],u=new Array(i-1);let l=0;for(let p=0;p<i;p++)p!==a&&(u[l++]=o.shape[p]);const c=new Array(i).fill(0),h=o.shape.slice();h[a]=1;const d=new Array(s);for(let p=0;p<d.length;p++){c[a]=p;const g=Pc({inputs:{x:o},backend:e,attrs:{begin:c,size:h}});d[p]=In({inputs:{x:g},backend:e,attrs:{shape:u}}),e.disposeIntermediateTensorInfo(g)}return d}const yTt={kernelName:db,backendName:"cpu",kernelFunc:xTt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bTt(n){const{inputs:t,backend:e,attrs:r}=n,{x:o,segmentIds:a}=t,{numSegments:i}=r;Xt(o,"unsortedSegmentSum");const s=o.shape.length,u=a.shape.length,l=[],c=[],h=s-u;let d=a;for(let g=0;g<h;++g){const x=By({inputs:{input:d},backend:e,attrs:{dim:g+1}});d=x,c.push(x)}for(let g=0;g<i;++g){const x=wl(g,"int32"),y=e.makeTensorInfo([],"int32",x),b=QG({inputs:{a:y,b:d},backend:e}),C=fl({inputs:{x:b},backend:e,attrs:{dtype:"float32"}}),E=zb({inputs:{a:C,b:o},backend:e}),S=ov({inputs:{x:E},backend:e,attrs:{axis:0,keepDims:!1}});l.push(S),c.push(y),c.push(b),c.push(C),c.push(E),c.push(S)}const p=QH({inputs:l,backend:e,attrs:{axis:0}});return c.forEach(g=>e.disposeIntermediateTensorInfo(g)),p}const wTt={kernelName:pb,backendName:"cpu",kernelFunc:bTt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CTt=[tSt,O2t,nSt,oSt,z2t,iSt,uSt,cSt,fSt,pSt,gSt,xSt,bSt,SSt,kSt,TSt,ASt,DSt,OSt,ZCt,MSt,PSt,zSt,W2t,WSt,P2t,G2t,GSt,F2t,qSt,XSt,KSt,QSt,JSt,eEt,rEt,aEt,sEt,lEt,hEt,dEt,mEt,vEt,yEt,bEt,CEt,EEt,IEt,REt,TEt,NEt,_Et,OEt,HCt,MEt,H2t,GEt,q2t,HEt,X2t,QEt,ZEt,tkt,Y2t,Z2t,nkt,okt,ikt,ukt,tCt,nCt,M2t,ckt,jSt,fkt,pkt,gkt,qCt,oCt,iCt,xkt,uCt,bkt,Skt,kkt,Tkt,Akt,Dkt,$kt,cCt,Fkt,Lkt,Bkt,Ukt,Vkt,Hkt,jkt,fCt,Kkt,Zkt,vIt,pCt,gCt,bIt,SIt,IIt,xCt,TIt,AIt,_It,ZH,FIt,XCt,wCt,LIt,BIt,UIt,VIt,L2t,KE,HIt,KCt,YCt,QCt,jIt,KIt,QIt,JIt,eRt,nRt,oRt,NCt,iRt,hRt,dRt,vRt,_Ct,yRt,wRt,SRt,DCt,mIt,IRt,TRt,ARt,DRt,ORt,MRt,PRt,zRt,FCt,URt,LCt,BCt,VRt,HRt,jRt,KRt,QRt,VCt,DEt,JRt,eTt,rTt,aTt,sTt,lTt,yCt,vTt,yTt,wTt,NIt];for(const n of CTt)Mz(n);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ic={},Qx={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function STt(n,t){ic[n]=t}function bi(n,t){if(!(n in ic)||t!=null){const r=kTt(n,t);if(r!==null)ic[n]=r;else return console.log("Could not get context for WebGL version",n),null}const e=ic[n];return e==null||e.isContextLost()?(delete ic[n],bi(n)):(e.disable(e.DEPTH_TEST),e.disable(e.STENCIL_TEST),e.disable(e.BLEND),e.disable(e.DITHER),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SAMPLE_COVERAGE),e.enable(e.SCISSOR_TEST),e.enable(e.CULL_FACE),e.cullFace(e.BACK),ic[n])}function ETt(n){if(!yt().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&n===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function kTt(n,t){if(n!==1&&n!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const e=t??ETt(n);return e.addEventListener("webglcontextlost",r=>{r.preventDefault(),delete ic[n]},!1),yt().getBool("SOFTWARE_WEBGL_ENABLED")&&(Qx.failIfMajorPerformanceCaveat=!1),n===1?e.getContext("webgl",Qx)||e.getContext("experimental-webgl",Qx):e.getContext("webgl2",Qx)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var gm;(function(n){n[n.DENSE=0]="DENSE",n[n.SHARED_BATCH=1]="SHARED_BATCH"})(gm||(gm={}));var xa;(function(n){n[n.RENDER=0]="RENDER",n[n.UPLOAD=1]="UPLOAD",n[n.PIXELS=2]="PIXELS",n[n.DOWNLOAD=3]="DOWNLOAD"})(xa||(xa={}));var Br;(function(n){n[n.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",n[n.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",n[n.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",n[n.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",n[n.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(Br||(Br={}));function av(n,t){return[t,n]}function ITt(n,t){return n*t}function Zx(n){const t=It(n),e=Math.ceil(t/4);return xE(e)}function xd(n,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(n/2))]}function RTt(n,t){const[e,r]=xd(n,t);return e*r*4}function uN(n,t){const e=n;let r,o,a,i,s,u,l,c,h,d;return yt().getNumber("WEBGL_VERSION")===2?(r=e.R32F,o=e.R16F,a=e.RGBA16F,i=e.RGBA32F,s=e.RED,l=4,c=1,h=e.HALF_FLOAT,d=e.FLOAT,u=e.RGBA8):(r=n.RGBA,o=n.RGBA,a=n.RGBA,i=e.RGBA,s=n.RGBA,l=4,c=4,h=t!=null?t.HALF_FLOAT_OES:null,d=n.FLOAT,u=n.RGBA),{internalFormatFloat:r,internalFormatHalfFloat:o,internalFormatPackedHalfFloat:a,internalFormatPackedFloat:i,textureFormatFloat:s,downloadTextureFormat:u,downloadUnpackNumChannels:l,defaultNumChannels:c,textureTypeHalfFloat:h,textureTypeFloat:d}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qt(n,t){const e=t();return yt().getBool("DEBUG")&&TTt(n),e}function TTt(n){const t=n.getError();if(t!==n.NO_ERROR)throw new Error("WebGL Error: "+DTt(n,t))}const NTt=596e-10,ATt=65504;function _Tt(n){return!!(yt().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||n===0||NTt<Math.abs(n)&&Math.abs(n)<ATt)}function DTt(n,t){switch(t){case n.NO_ERROR:return"NO_ERROR";case n.INVALID_ENUM:return"INVALID_ENUM";case n.INVALID_VALUE:return"INVALID_VALUE";case n.INVALID_OPERATION:return"INVALID_OPERATION";case n.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case n.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case n.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${t}`}}function Jx(n,t){return du(n,()=>n.getExtension(t),'Extension "'+t+'" not supported on this browser.')}function $Tt(n,t){const e=du(n,()=>n.createShader(n.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(qt(n,()=>n.shaderSource(e,t)),qt(n,()=>n.compileShader(e)),n.getShaderParameter(e,n.COMPILE_STATUS)===!1)throw console.log(n.getShaderInfoLog(e)),new Error("Failed to compile vertex shader.");return e}function OTt(n,t){const e=du(n,()=>n.createShader(n.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(qt(n,()=>n.shaderSource(e,t)),qt(n,()=>n.compileShader(e)),yt().get("ENGINE_COMPILE_ONLY"))return e;if(n.getShaderParameter(e,n.COMPILE_STATUS)===!1)throw JH(t,n.getShaderInfoLog(e)),new Error("Failed to compile fragment shader.");return e}const FTt=/ERROR: [0-9]+:([0-9]+):/g;function JH(n,t){const e=FTt.exec(t);if(e==null){console.log(`Couldn't parse line number in error: ${t}`),console.log(n);return}const r=+e[1],o=n.split(`
`),a=o.length.toString().length+2,i=o.map((h,d)=>kf((d+1).toString(),a)+h);let s=0;for(let h=0;h<i.length;h++)s=Math.max(i[h].length,s);const u=i.slice(0,r-1),l=i.slice(r-1,r),c=i.slice(r);console.log(u.join(`
`)),console.log(t.split(`
`)[0]),console.log(`%c ${kf(l[0],s)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(c.join(`
`))}function MTt(n){return du(n,()=>n.createProgram(),"Unable to create WebGLProgram.")}function LTt(n,t){if(qt(n,()=>n.linkProgram(t)),!yt().get("ENGINE_COMPILE_ONLY")&&n.getProgramParameter(t,n.LINK_STATUS)===!1)throw console.log(n.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}function bS(n,t){if(qt(n,()=>n.validateProgram(t)),n.getProgramParameter(t,n.VALIDATE_STATUS)===!1)throw console.log(n.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function PTt(n,t){const e=du(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return qt(n,()=>n.bindBuffer(n.ARRAY_BUFFER,e)),qt(n,()=>n.bufferData(n.ARRAY_BUFFER,t,n.STATIC_DRAW)),e}function BTt(n,t){const e=du(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return qt(n,()=>n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e)),qt(n,()=>n.bufferData(n.ELEMENT_ARRAY_BUFFER,t,n.STATIC_DRAW)),e}function zTt(n){return du(n,()=>n.createTexture(),"Unable to create WebGLTexture.")}function UTt(n,t){const e=yt().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n<=0||t<=0){const r=`[${n}x${t}]`;throw new Error("Requested texture size "+r+" is invalid.")}if(n>e||t>e){const r=`[${n}x${t}]`,o=`[${e}x${e}]`;throw new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+o+".")}}function WTt(n){return du(n,()=>n.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function PF(n,t,e,r,o,a,i){const s=n.getAttribLocation(t,e);return s===-1?!1:(qt(n,()=>n.bindBuffer(n.ARRAY_BUFFER,r)),qt(n,()=>n.vertexAttribPointer(s,o,n.FLOAT,!1,a,i)),qt(n,()=>n.enableVertexAttribArray(s)),!0)}function VTt(n,t,e){XTt(n,e),qt(n,()=>n.activeTexture(n.TEXTURE0+e)),qt(n,()=>n.bindTexture(n.TEXTURE_2D,t))}function GTt(n,t,e){return du(n,()=>n.getUniformLocation(t,e),'uniform "'+e+'" not present in program.')}function HTt(n,t,e){return n.getUniformLocation(t,e)}function qTt(n,t,e,r){qt(n,()=>VTt(n,t,r)),qt(n,()=>n.uniform1i(e,r))}function wS(n,t,e){qt(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,e)),qt(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0))}function BF(n,t){qt(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,t)),qt(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0))}function t0(n){const t=n.checkFramebufferStatus(n.FRAMEBUFFER);if(t!==n.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+jTt(n,t))}function jTt(n,t){switch(t){case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case n.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${t}`}}function du(n,t,e){const r=qt(n,()=>t());if(r==null)throw new Error(e);return r}function XTt(n,t){const e=n.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+n.TEXTURE0;if(r<n.TEXTURE0||r>e){const o=`[gl.TEXTURE0, gl.TEXTURE${e}]`;throw new Error(`textureUnit must be in ${o}.`)}}function Yf(n,t=2){return It(n.slice(0,n.length-t))}function Qf(n){if(n.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[n.length>1?n[n.length-2]:1,n[n.length-1]]}function e0(n){let t=[1,1,1];return n.length===0||n.length===1&&n[0]===1||(t=[Yf(n),...Qf(n)]),t}function KTt(n,t=!1){let e=yt().getNumber("WEBGL_MAX_TEXTURE_SIZE"),r=yt().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");r===1/0&&yt().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(r=e/2),t&&(e=e*2,r=r*2,n=n.map((s,u)=>u>=n.length-2?MI(n[u]):n[u]),n.length===1&&(n=[2,n[0]])),n.length!==2&&(n=bl(n).newShape);let o=It(n),a=null;n.length<=1&&o<=e?a=[1,o]:n.length===2&&n[0]<=e&&n[1]<=e?a=n:n.length===3&&n[0]*n[1]<=e&&n[2]<=e?a=[n[0]*n[1],n[2]]:n.length===3&&n[0]<=e&&n[1]*n[2]<=e?a=[n[0],n[1]*n[2]]:n.length===4&&n[0]*n[1]*n[2]<=e&&n[3]<=e?a=[n[0]*n[1]*n[2],n[3]]:n.length===4&&n[0]<=e&&n[1]*n[2]*n[3]<=e&&(a=[n[0],n[1]*n[2]*n[3]]);const i=a!=null&&Math.max(...a)>r&&Math.min(...a)<=(t?2:1)&&Math.min(...a)>0;if(a==null||i)if(t){const s=Yf(n);let u=2,l=2;n.length&&([u,l]=Qf(n)),o=s*(u/2)*(l/2),a=xE(o).map(c=>c*2)}else a=xE(o);return a}function n0(n){return n%2===0}function Uy(n,t){if(n=n.slice(-2),t=t.slice(-2),tn(n,t)||!n.length||!t.length||n[0]===0||n[1]===0||t[0]===0||t[1]===0)return!0;if(n.length!==t.length){const e=n[n.length-1],r=t[t.length-1];if(e===r||n0(e)&&n0(r)&&(n[0]===1||t[0]===1))return!0}return n[1]===t[1]&&n0(n[0])&&n0(t[0])}let CS,SS;function YTt(n){if(CS==null){const t=bi(n);CS=t.getParameter(t.MAX_TEXTURE_SIZE)}return CS}function QTt(n){if(SS==null){const t=bi(n);SS=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,SS)}function ZTt(n){if(n===0)return 0;let t;const e=bi(n);return Wa(e,"EXT_disjoint_timer_query_webgl2")&&n===2?t=2:Wa(e,"EXT_disjoint_timer_query")?t=1:t=0,t}function Wa(n,t){return n.getExtension(t)!=null}function zF(n){try{if(bi(n)!=null)return!0}catch(t){return console.log("Error when getting WebGL context: ",t),!1}return!1}function JTt(n){if(n===0)return!1;const t=bi(n);if(n===1){if(!Wa(t,"OES_texture_float"))return!1}else if(!Wa(t,"EXT_color_buffer_float"))return!1;return QE(t)}function tNt(n){if(n===0)return!1;const t=bi(n);if(n===1){if(!Wa(t,"OES_texture_float")||!Wa(t,"WEBGL_color_buffer_float"))return!1}else{if(Wa(t,"EXT_color_buffer_float"))return QE(t);const r="EXT_color_buffer_half_float";if(Wa(t,r)){const o=t.getExtension(r);return eNt(t,o)}return!1}return QE(t)}function QE(n){const t=uN(n),e=n.createTexture();n.bindTexture(n.TEXTURE_2D,e),n.texImage2D(n.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);const a=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,a),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0);const i=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(e),n.deleteFramebuffer(a),i}function eNt(n,t){const e=uN(n,t),r=n.createTexture();n.bindTexture(n.TEXTURE_2D,r),n.texImage2D(n.TEXTURE_2D,0,e.internalFormatHalfFloat,1,1,0,e.textureFormatFloat,e.textureTypeHalfFloat,null);const i=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,i),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,r,0);const s=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(r),n.deleteFramebuffer(i),s}function nNt(n){return n!==2?!1:bi(n).fenceSync!=null}function iv(n,t){Array.isArray(n)||(n=[n]),n.forEach(e=>{e!=null&&H(e.dtype!=="complex64",()=>`${t} does not support complex64 tensors in the WebGL backend.`)})}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jt=yt();Jt.registerFlag("HAS_WEBGL",()=>Jt.getNumber("WEBGL_VERSION")>0);Jt.registerFlag("WEBGL_VERSION",()=>zF(2)?2:zF(1)?1:0);Jt.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);Jt.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>Jt.get("WEBGL_VERSION")===2);Jt.registerFlag("WEBGL_CPU_FORWARD",()=>!0);Jt.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);Jt.registerFlag("WEBGL_PACK",()=>Jt.getBool("HAS_WEBGL"));Jt.registerFlag("WEBGL_PACK_NORMALIZATION",()=>Jt.getBool("WEBGL_PACK"));Jt.registerFlag("WEBGL_PACK_CLIP",()=>Jt.getBool("WEBGL_PACK"));Jt.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>Jt.getBool("WEBGL_PACK"));Jt.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>Jt.getBool("WEBGL_PACK"));Jt.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>Jt.getBool("WEBGL_PACK"));Jt.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>Jt.getBool("WEBGL_PACK"));Jt.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>Jt.getBool("WEBGL_PACK"));Jt.registerFlag("WEBGL_PACK_REDUCE",()=>Jt.getBool("WEBGL_PACK"));Jt.registerFlag("WEBGL_LAZILY_UNPACK",()=>Jt.getBool("WEBGL_PACK"));Jt.registerFlag("WEBGL_CONV_IM2COL",()=>Jt.getBool("WEBGL_PACK"));Jt.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",()=>Jt.getBool("WEBGL_PACK"));Jt.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>YTt(Jt.getNumber("WEBGL_VERSION")));Jt.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>QTt(Jt.getNumber("WEBGL_VERSION")));Jt.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const n=Jt.getNumber("WEBGL_VERSION");return n===0?0:ZTt(n)});Jt.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>Jt.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!Kz());Jt.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>JTt(Jt.getNumber("WEBGL_VERSION")));Jt.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>Jt.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:Jt.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));Jt.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>tNt(Jt.getNumber("WEBGL_VERSION")));Jt.registerFlag("WEBGL_FENCE_API_ENABLED",()=>nNt(Jt.getNumber("WEBGL_VERSION")));Jt.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>Jt.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);Jt.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,n=>{if(typeof n!="number")throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but got ${n}.`);if(n<0&&n!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${n}.`)});Jt.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>Kz()?1:-1,n=>{if(typeof n!="number")throw new Error(`WEBGL_FLUSH_THRESHOLD must be a number but got ${n}.`);if(n<0&&n!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${n}.`)});Jt.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128);Jt.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1);Jt.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5);Jt.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128);Jt.registerFlag("WEBGL_EXP_CONV",()=>!1);Jt.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>Jt.getBool("IS_TEST"));Jt.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0);Jt.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1);Jt.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1);Jt.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function So(){let n,t,e,r,o,a,i,s,u,l;return yt().getNumber("WEBGL_VERSION")===2?(n="#version 300 es",t="in",e="out",r="in",o="texture",a="outputColor",i="out vec4 outputColor;",s=yt().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",u="",l=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(n="",t="attribute",e="varying",r="varying",o="texture2D",a="gl_FragColor",i="",s=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,u=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,l=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:n,attribute:t,varyingVs:e,varyingFs:r,texture2D:o,output:a,defineOutput:i,defineSpecialNaN:s,defineSpecialInf:u,defineRound:l}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ih(n,t,e="index"){const r=ue(t);return r.map((o,a)=>{const i=`int ${n[a]} = ${e} / ${o}`,s=a===r.length-1?`int ${n[a+1]} = ${e} - ${n[a]} * ${o}`:`index -= ${n[a]} * ${o}`;return`${i}; ${s};`}).join("")}function Ub(n,t,e="index"){const r=ue(t);return r.map((o,a)=>{const i=`int ${n[a]} = ${e} / outShapeStrides[${a}]`,s=a===r.length-1?`int ${n[a+1]} = ${e} - ${n[a]} * outShapeStrides[${a}]`:`index -= ${n[a]} * outShapeStrides[${a}]`;return`${i}; ${s};`}).join("")}function rNt(n,t){const e=n.length,r=n.map(a=>`${t}[${a}]`),o=new Array(e-1);o[e-2]=r[e-1];for(let a=e-3;a>=0;--a)o[a]=`(${o[a+1]} * ${r[a+1]})`;return o}function oNt(n,t,e="index"){const r=n.map((a,i)=>i),o=rNt(r,t);return o.map((a,i)=>{const s=`int ${n[i]} = ${e} / ${o[i]}`,u=i===o.length-1?`int ${n[i+1]} = ${e} - ${n[i]} * ${o[i]}`:`index -= ${n[i]} * ${o[i]}`;return`${s}; ${u};`}).join("")}function lN(n){const t=ue(n).map(e=>e.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${t[0]} + coords.y * ${t[1]} + coords.z;
  }
`}function cN(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}const t6=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{getBroadcastDims:e6}=vyt;function aNt(n,t,e){const r=[];if(n.forEach(p=>{const g=It(p.shapeInfo.logicalShape);if(p.shapeInfo.isUniform?r.push(`uniform float ${p.name}${g>1?`[${g}]`:""};`):(r.push(`uniform sampler2D ${p.name};`),r.push(`uniform int offset${p.name};`)),e.enableShapeUniforms){const{uniformShape:x}=hN(e.packedInputs,p.shapeInfo.logicalShape,p.shapeInfo.texShape);switch(x.length){case 1:r.push(`uniform int ${p.name}Shape;`);break;case 2:r.push(`uniform ivec2 ${p.name}Shape;`);break;case 3:r.push(`uniform ivec3 ${p.name}Shape;`);break;case 4:r.push(`uniform ivec4 ${p.name}Shape;`);break}r.push(`uniform ivec2 ${p.name}TexShape;`)}}),e.enableShapeUniforms){switch(t.logicalShape.length){case 1:r.push("uniform int outShape;");break;case 2:r.push("uniform ivec2 outShape;"),r.push("uniform int outShapeStrides;");break;case 3:r.push("uniform ivec3 outShape;"),r.push("uniform ivec2 outShapeStrides;");break;case 4:r.push("uniform ivec4 outShape;"),r.push("uniform ivec3 outShapeStrides;");break}r.push("uniform ivec2 outTexShape;")}e.customUniforms&&e.customUniforms.forEach(p=>{r.push(`uniform ${p.type} ${p.name}${p.arrayIndex?`[${p.arrayIndex}]`:""};`)});const o=r.join(`
`),a=n.map(p=>iNt(p,t,e.packedInputs,e.enableShapeUniforms)).join(`
`),i=t.texShape,s=So(),u=lNt(s);let l,c,h=fNt(s);return t.isPacked?(l=sNt(t.logicalShape,i,e.enableShapeUniforms),c=hNt(s)):(l=uNt(t.logicalShape,i,e.enableShapeUniforms),c=cNt(s)),e.packedInputs&&(h+=gNt),[h,u,c,o,l,a,e.userCode].join(`
`)}function yd(n,t=!1){const e=n.shapeInfo.logicalShape;switch(e.length){case 0:return TNt(n,t);case 1:return ANt(n,t);case 2:return DNt(n,t);case 3:return ONt(n,t);case 4:return MNt(n,t);case 5:return LNt(n);case 6:return PNt(n);default:throw new Error(`${e.length}-D input sampling is not yet supported`)}}function n6(n,t){switch(n.shapeInfo.logicalShape.length){case 0:return RNt(n);case 1:return NNt(n,t);case 2:return _Nt(n,t);case 3:return $Nt(n,t);default:return FNt(n,t)}}function iNt(n,t,e=!1,r){let o="";e?o+=n6(n,r):o+=yd(n,r);const a=n.shapeInfo.logicalShape,i=t.logicalShape;return a.length<=i.length&&(e?o+=BNt(n,t):o+=zNt(n,t)),o}function sNt(n,t,e){switch(n.length){case 0:return r6();case 1:return vNt(n,t,e);case 2:return kNt(n,t,e);case 3:return yNt(n,t,e);default:return wNt(n,t,e)}}function uNt(n,t,e){switch(n.length){case 0:return r6();case 1:return xNt(n,t,e);case 2:return INt(n,t,e);case 3:return bNt(n,t,e);case 4:return CNt(n,t,e);case 5:return SNt(n,t);case 6:return ENt(n,t);default:throw new Error(`${n.length}-D output sampling is not yet supported`)}}function lNt(n){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${n.texture2D}(textureSampler, uv).r;
    }
  `}function cNt(n){return`
    void setOutput(float val) {
      ${n.output} = vec4(val, 0, 0, 0);
    }
  `}function hNt(n){return`
    void setOutput(vec4 val) {
      ${n.output} = val;
    }
  `}function fNt(n){return`${n.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${n.varyingFs} vec2 resultUV;
    ${n.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${n.defineSpecialNaN}
    ${n.defineSpecialInf}
    ${n.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${dNt}
    ${pNt}
    ${mNt}
  `}const dNt=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,pNt=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,mNt=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,gNt=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function r6(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function vNt(n,t,e){const r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];return r[0]===1?e?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${r[1]}.0);
      }
    `:r[1]===1?e?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${r[0]}.0);
      }
    `:e?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      return 2 * (resTexRC.x * ${r[1]} + resTexRC.y);
    }
  `}function xNt(n,t,e){return t[0]===1?e?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${t[1]}.0);
      }
    `:t[1]===1?e?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${t[0]}.0);
      }
    `:e?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${t[0]}, ${t[1]}));
      return resTexRC.x * ${t[1]} + resTexRC.y;
    }
  `}function yNt(n,t,e){if(e)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;const r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],o=Math.ceil(n[2]/2),a=o*Math.ceil(n[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      int index = resTexRC.x * ${r[1]} + resTexRC.y;

      int b = index / ${a};
      index -= b * ${a};

      int r = 2 * (index / ${o});
      int c = imod(index, ${o}) * 2;

      return ivec3(b, r, c);
    }
  `}function bNt(n,t,e){if(e)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${Ub(["r","c","d"],n)}
    return ivec3(r, c, d);
  }
`;const r=ih(["r","c","d"],n);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;
      ${r}
      return ivec3(r, c, d);
    }
  `}function wNt(n,t,e){if(e)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;const r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],o=Math.ceil(n[n.length-1]/2),a=o*Math.ceil(n[n.length-2]/2);let i=a,s="",u="b, r, c";for(let l=2;l<n.length-1;l++)i*=n[n.length-l-1],s=`
      int b${l} = index / ${i};
      index -= b${l} * ${i};
    `+s,u=`b${l}, `+u;return`
    ivec${n.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      int index = resTexRC.x * ${r[1]} + resTexRC.y;

      ${s}

      int b = index / ${a};
      index -= b * ${a};

      int r = 2 * (index / ${o});
      int c = imod(index, ${o}) * 2;

      return ivec${n.length}(${u});
    }
  `}function CNt(n,t,e){if(e)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${Ub(["r","c","d","d2"],n)}
      return ivec4(r, c, d, d2);
    }
  `;const r=ih(["r","c","d","d2"],n);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;
      ${r}
      return ivec4(r, c, d, d2);
    }
  `}function SNt(n,t){const e=ih(["r","c","d","d2","d3"],n);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${t[0]},
                             ${t[1]}));

      int index = resTexRC.x * ${t[1]} + resTexRC.y;

      ${e}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function ENt(n,t){const e=ih(["r","c","d","d2","d3","d4"],n);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;

      ${e}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function kNt(n,t,e){const r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(tn(n,t))return e?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${r[0]}, ${r[1]}));
      }
    `;const o=Math.ceil(n[1]/2);return e?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));

      int index = resTexRC.x * ${r[1]} + resTexRC.y;
      int r = 2 * (index / ${o});
      int c = imod(index, ${o}) * 2;

      return ivec2(r, c);
    }
  `}function INt(n,t,e){return tn(n,t)?e?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${t[0]}, ${t[1]}));
      }
    `:n[1]===1?e?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${t[0]}, ${t[1]}));
        int index = resTexRC.x * ${t[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:n[0]===1?e?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${t[0]}, ${t[1]}));
        int index = resTexRC.x * ${t[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:e?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;
      int r = index / ${n[1]};
      int c = index - r * ${n[1]};
      return ivec2(r, c);
    }
  `}function sh(n){return`offset${n}`}function RNt(n){const t=n.name,e="get"+t.charAt(0).toUpperCase()+t.slice(1),r=So();return`
    vec4 ${e}() {
      return ${r.texture2D}(${t}, halfCR);
    }
  `}function TNt(n,t){const e=n.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1);if(n.shapeInfo.isUniform)return`float ${r}() {return ${e};}`;const[o,a]=n.shapeInfo.texShape;if(o===1&&a===1)return`
      float ${r}() {
        return sampleTexture(${e}, halfCR);
      }
    `;const i=sh(e);if(t)return`
    float ${r}() {
      vec2 uv = uvFromFlat(${e}TexShape[0], ${e}TexShape[1], ${i});
      return sampleTexture(${e}, uv);
    }
  `;const[s,u]=n.shapeInfo.texShape;return`
    float ${r}() {
      vec2 uv = uvFromFlat(${s}, ${u}, ${i});
      return sampleTexture(${e}, uv);
    }
  `}function NNt(n,t){const e=n.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1),o=n.shapeInfo.texShape,a=So();if(t)return`
    vec4 ${r}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${e}TexShape[0]) / 2.0), ceil(float(${e}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${a.texture2D}(${e}, uv);
    }
  `;const i=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];return`
    vec4 ${r}(int index) {
      vec2 uv = packedUVfrom1D(
        ${i[0]}, ${i[1]}, index);
      return ${a.texture2D}(${e}, uv);
    }
  `}function ANt(n,t){const e=n.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1);if(n.shapeInfo.isUniform)return`
      float ${r}(int index) {
        ${bd(n)}
      }
    `;const o=n.shapeInfo.texShape,a=o[0],i=o[1];if(i===1&&a===1)return`
      float ${r}(int index) {
        return sampleTexture(${e}, halfCR);
      }
    `;const s=sh(e);return i===1?t?`
      float ${r}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${s}) + 0.5) / float(${e}TexShape[0]));
        return sampleTexture(${e}, uv);
      }
    `:`
      float ${r}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${s}) + 0.5) / ${a}.0);
        return sampleTexture(${e}, uv);
      }
    `:a===1?t?`
      float ${r}(int index) {
        vec2 uv = vec2((float(index + ${s}) + 0.5) / float(${e}TexShape[1]), 0.5);
        return sampleTexture(${e}, uv);
      }
    `:`
      float ${r}(int index) {
        vec2 uv = vec2((float(index + ${s}) + 0.5) / ${i}.0, 0.5);
        return sampleTexture(${e}, uv);
      }
    `:t?`
    float ${r}(int index) {
      vec2 uv = uvFromFlat(${e}TexShape[0], ${e}TexShape[1], index + ${s});
      return sampleTexture(${e}, uv);
    }
  `:`
    float ${r}(int index) {
      vec2 uv = uvFromFlat(${a}, ${i}, index + ${s});
      return sampleTexture(${e}, uv);
    }
  `}function _Nt(n,t){const e=n.shapeInfo.logicalShape,r=n.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),a=n.shapeInfo.texShape,i=a[0],s=a[1],u=So();if(a!=null&&tn(e,a))return t?`
      vec4 ${o}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);

        return ${u.texture2D}(${r}, uv);
      }
    `:`
      vec4 ${o}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}.0, ${i}.0);

        return ${u.texture2D}(${r}, uv);
      }
    `;if(t)return`
    vec4 ${o}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${r}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${u.texture2D}(${r}, uv);
    }
  `;const l=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],c=Math.ceil(e[1]/2);return`
    vec4 ${o}(int row, int col) {
      vec2 uv = packedUVfrom2D(${c}, ${l[0]}, ${l[1]}, row, col);
      return ${u.texture2D}(${r}, uv);
    }
  `}function DNt(n,t){const e=n.shapeInfo.logicalShape,r=n.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),a=n.shapeInfo.texShape;if(a!=null&&tn(e,a)){if(t)return`
      float ${o}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `;const d=a[0],p=a[1];return`
    float ${o}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${p}.0, ${d}.0);
      return sampleTexture(${r}, uv);
    }
  `}const{newShape:i,keptDims:s}=bl(e),u=i;if(u.length<e.length){const d=wd(n,u),p=["row","col"];return`
      ${yd(d,t)}
      float ${o}(int row, int col) {
        return ${o}(${Cd(p,s)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${o}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${e[1]}, 1)));
        ${bd(n)}
      }
    `;const l=a[0],c=a[1],h=sh(r);return c===1?t?`
      float ${o}(int row, int col) {
        float index = dot(vec3(row, col, ${h}), vec3(${r}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${r}TexShape[0]));
        return sampleTexture(${r}, uv);
      }
    `:`
    float ${o}(int row, int col) {
      float index = dot(vec3(row, col, ${h}), vec3(${e[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${l}.0);
      return sampleTexture(${r}, uv);
    }
  `:l===1?t?`
      float ${o}(int row, int col) {
        float index = dot(vec3(row, col, ${h}), vec3(${r}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${r}TexShape[1]), 0.5);
        return sampleTexture(${r}, uv);
      }
    `:`
    float ${o}(int row, int col) {
      float index = dot(vec3(row, col, ${h}), vec3(${e[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${c}.0, 0.5);
      return sampleTexture(${r}, uv);
    }
  `:t?`
      float ${o}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${r}Shape[1] + col + ${h};
        vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index);
        return sampleTexture(${r}, uv);
      }
    `:`
  float ${o}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${e[1]} + col + ${h};
    vec2 uv = uvFromFlat(${l}, ${c}, index);
    return sampleTexture(${r}, uv);
  }
`}function $Nt(n,t){const e=n.shapeInfo.logicalShape,r=n.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),a=n.shapeInfo.texShape,i=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];if(e[0]===1){const d=e.slice(1),p=[1,2],g=wd(n,d),x=["b","row","col"];return`
        ${n6(g,t)}
        vec4 ${o}(int b, int row, int col) {
          return ${o}(${Cd(x,p)});
        }
      `}const s=So();if(t)return`
    vec4 ${o}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${r}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${r}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${s.texture2D}(${r}, uv);
    }
  `;const u=i[0],l=i[1],c=Math.ceil(e[2]/2),h=c*Math.ceil(e[1]/2);return`
    vec4 ${o}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${u}, ${l}, ${h}, ${c}, b, row, col);
      return ${s.texture2D}(${r}, uv);
    }
  `}function ONt(n,t){const e=n.shapeInfo.logicalShape,r=n.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),a=e[1]*e[2],i=e[2],{newShape:s,keptDims:u}=bl(e),l=s;if(l.length<e.length){const x=wd(n,l),y=["row","col","depth"];return`
        ${yd(x,t)}
        float ${o}(int row, int col, int depth) {
          return ${o}(${Cd(y,u)});
        }
      `}if(n.shapeInfo.isUniform)return`
      float ${o}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${a}, ${i}, 1)));
        ${bd(n)}
      }
    `;const c=n.shapeInfo.texShape,h=c[0],d=c[1],p=n.shapeInfo.flatOffset;if(d===a&&p==null)return t?`
      float ${o}(int row, int col, int depth) {
        int stride1 = ${r}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
        float ${o}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${i}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${d}.0, ${h}.0);
          return sampleTexture(${r}, uv);
        }
      `;if(d===i&&p==null)return t?`
      float ${o}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${r}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
    float ${o}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${e[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${d}.0, ${h}.0);
      return sampleTexture(${r}, uv);
    }
  `;const g=sh(r);return t?`
    float ${o}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${r}Shape[1] * ${r}Shape[2];
      int stride1 = ${r}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${g};
      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index);
      return sampleTexture(${r}, uv);
    }
    `:`
      float ${o}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${a} + col * ${i} + depth + ${g};
        vec2 uv = uvFromFlat(${h}, ${d}, index);
        return sampleTexture(${r}, uv);
      }
  `}function FNt(n,t){const e=n.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1),o=So();if(t)return`
    vec4 ${r}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${e}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${e}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${e}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${e}TexShape[0]) / 2.0), ceil(float(${e}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${o.texture2D}(${e}, uv);
    }
  `;const a=n.shapeInfo.logicalShape,i=a.length,s=n.shapeInfo.texShape,u=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],l=u[0],c=u[1],h=Math.ceil(a[i-1]/2);let d=h*Math.ceil(a[i-2]/2),p="int b, int row, int col",g=`b * ${d} + (row / 2) * ${h} + (col / 2)`;for(let x=2;x<i-1;x++)p=`int b${x}, `+p,d*=a[i-x-1],g=`b${x} * ${d} + `+g;return`
    vec4 ${r}(${p}) {
      int index = ${g};
      int texR = index / ${c};
      int texC = index - texR * ${c};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${c}, ${l});
      return ${o.texture2D}(${e}, uv);
    }
  `}function MNt(n,t){const e=n.shapeInfo.logicalShape,r=n.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),a=e[3],i=e[2]*a,s=e[1]*i,{newShape:u,keptDims:l}=bl(e);if(u.length<e.length){const C=wd(n,u),E=["row","col","depth","depth2"];return`
      ${yd(C,t)}
      float ${o}(int row, int col, int depth, int depth2) {
        return ${o}(${Cd(E,l)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${o}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${s}, ${i}, ${a}, 1)));
        ${bd(n)}
      }
    `;const c=n.shapeInfo.flatOffset,h=n.shapeInfo.texShape,d=h[0],p=h[1],g=`int stride2 = ${r}Shape[3];`,x=`int stride1 = ${r}Shape[2] * stride2;`,y=`int stride0 = ${r}Shape[1] * stride1;`;if(p===s&&c==null)return t?`
      float ${o}(int row, int col, int depth, int depth2) {
        ${g}
        ${x}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
      float ${o}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${i}, ${a}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${p}.0, ${d}.0);
        return sampleTexture(${r}, uv);
      }
    `;if(p===a&&c==null)return t?`
      float ${o}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${r}Shape[1] * ${r}Shape[2], ${r}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
      float ${o}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${e[1]*e[2]}, ${e[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${p}.0, ${d}.0);
        return sampleTexture(${r}, uv);
      }
    `;const b=sh(r);return t?`
    float ${o}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${g}
      ${x}
      ${y}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index + ${b});
      return sampleTexture(${r}, uv);
    }
  `:`
    float ${o}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${s} + col * ${i} +
          depth * ${a} + depth2;
      vec2 uv = uvFromFlat(${d}, ${p}, index + ${b});
      return sampleTexture(${r}, uv);
    }
  `}function LNt(n){const t=n.shapeInfo.logicalShape,e=n.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1),o=t[4],a=t[3]*o,i=t[2]*a,s=t[1]*i,{newShape:u,keptDims:l}=bl(t);if(u.length<t.length){const x=wd(n,u),y=["row","col","depth","depth2","depth3"];return`
      ${yd(x)}
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        return ${r}(${Cd(y,l)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${s}, ${i}, ${a}, ${o})) +
          depth3;
        ${bd(n)}
      }
    `;const c=n.shapeInfo.flatOffset,h=n.shapeInfo.texShape,d=h[0],p=h[1];if(p===s&&c==null)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${i}, ${a}, ${o}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${p}.0, ${d}.0);
        return sampleTexture(${e}, uv);
      }
    `;if(p===o&&c==null)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${t[1]*t[2]*t[3]},
               ${t[2]*t[3]}, ${t[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${p}.0, ${d}.0);
        return sampleTexture(${e}, uv);
      }
    `;const g=sh(e);return`
    float ${r}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${s} + col * ${i} + depth * ${a} +
          depth2 * ${o} + depth3 + ${g};
      vec2 uv = uvFromFlat(${d}, ${p}, index);
      return sampleTexture(${e}, uv);
    }
  `}function PNt(n){const t=n.shapeInfo.logicalShape,e=n.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1),{newShape:o,keptDims:a}=bl(t);if(o.length<t.length){const y=wd(n,o),b=["row","col","depth","depth2","depth3","depth4"];return`
      ${yd(y)}
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${r}(${Cd(b,a)});
      }
    `}const i=t[5],s=t[4]*i,u=t[3]*s,l=t[2]*u,c=t[1]*l;if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${c}, ${l}, ${u}, ${s})) +
          dot(
            vec2(depth3, depth4),
            vec2(${i}, 1)));
        ${bd(n)}
      }
    `;const h=n.shapeInfo.flatOffset,d=n.shapeInfo.texShape,p=d[0],g=d[1];if(g===c&&h==null)return`
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${l}, ${u}, ${s}, ${i})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${g}.0, ${p}.0);
        return sampleTexture(${e}, uv);
      }
    `;if(g===i&&h==null)return`
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${t[1]*t[2]*t[3]*t[4]},
               ${t[2]*t[3]*t[4]},
               ${t[3]*t[4]},
               ${t[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${g}.0, ${p}.0);
        return sampleTexture(${e}, uv);
      }
    `;const x=sh(e);return`
    float ${r}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${c} + col * ${l} + depth * ${u} +
          depth2 * ${s} + depth3 * ${i} + depth4 + ${x};
      vec2 uv = uvFromFlat(${p}, ${g}, index);
      return sampleTexture(${e}, uv);
    }
  `}function bd(n){const t=n.name,e=It(n.shapeInfo.logicalShape);return e<2?`return ${t};`:`
    for (int i = 0; i < ${e}; i++) {
      if (i == index) {
        return ${t}[i];
      }
    }
  `}function BNt(n,t){const e=n.name,r=e.charAt(0).toUpperCase()+e.slice(1),o="get"+r+"AtOutCoords",a=n.shapeInfo.logicalShape.length,i=t.logicalShape.length,s=e6(n.shapeInfo.logicalShape,t.logicalShape),u=pn(i),l=i-a;let c;const h=["x","y","z","w","u","v"];a===0?c="":i<2&&s.length>=1?c="coords = 0;":c=s.map(C=>`coords.${h[C+l]} = 0;`).join(`
`);let d="";i<2&&a>0?d="coords":d=n.shapeInfo.logicalShape.map((C,E)=>`coords.${h[E+l]}`).join(", ");let p="return outputValue;";const x=It(n.shapeInfo.logicalShape)===1,b=It(t.logicalShape)===1;if(a===1&&!x&&!b)p=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(x&&!b)i===1?p=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:p=`
        return vec4(outputValue.x);
      `;else if(s.length){const C=a-2,E=a-1;s.indexOf(C)>-1&&s.indexOf(E)>-1?p="return vec4(outputValue.x);":s.indexOf(C)>-1?p="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":s.indexOf(E)>-1&&(p="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${o}() {
      ${u} coords = getOutputCoords();
      ${c}
      vec4 outputValue = get${r}(${d});
      ${p}
    }
  `}function zNt(n,t){const e=n.name,r=e.charAt(0).toUpperCase()+e.slice(1),o="get"+r+"AtOutCoords",a=t.texShape,i=n.shapeInfo.texShape,s=n.shapeInfo.logicalShape.length,u=t.logicalShape.length;if(!n.shapeInfo.isUniform&&s===u&&n.shapeInfo.flatOffset==null&&tn(i,a))return`
      float ${o}() {
        return sampleTexture(${e}, resultUV);
      }
    `;const l=pn(u),c=e6(n.shapeInfo.logicalShape,t.logicalShape),h=u-s;let d;const p=["x","y","z","w","u","v"];s===0?d="":u<2&&c.length>=1?d="coords = 0;":d=c.map(x=>`coords.${p[x+h]} = 0;`).join(`
`);let g="";return u<2&&s>0?g="coords":g=n.shapeInfo.logicalShape.map((x,y)=>`coords.${p[y+h]}`).join(", "),`
    float ${o}() {
      ${l} coords = getOutputCoords();
      ${d}
      return get${r}(${g});
    }
  `}function pn(n){if(n<=1)return"int";if(n===2)return"ivec2";if(n===3)return"ivec3";if(n===4)return"ivec4";if(n===5)return"ivec5";if(n===6)return"ivec6";throw Error(`GPU for rank ${n} is not yet supported`)}function hN(n,t,e){const{newShape:r,keptDims:o}=bl(t),a=t.length,i=n&&a===3&&t[0]===1,s=i?t.slice(1):r,u=!n&&a>1&&!tn(t,e)&&r.length<a||i;return{useSqueezeShape:u,uniformShape:u?s:t,keptDims:o}}function wd(n,t){const e=JSON.parse(JSON.stringify(n));return e.shapeInfo.logicalShape=t,e}function Cd(n,t){return t.map(e=>n[e]).join(", ")}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UNt(n,t,e,r){const o=e.map((c,h)=>{const d={logicalShape:c.shape,texShape:c.isUniform?null:c.texData.texShape,isUniform:c.isUniform,isPacked:c.isUniform?!1:c.texData.isPacked,flatOffset:null};return c.texData!=null&&c.texData.slice!=null&&c.texData.slice.flatOffset>0&&(d.flatOffset=c.texData.slice.flatOffset),{name:t.variableNames[h],shapeInfo:d}}),a=o.map(c=>c.shapeInfo),i={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},s=aNt(o,i,t),u=OTt(n.gl,s),l=n.createProgram(u);return yt().get("ENGINE_COMPILE_ONLY")?{program:t,fragmentShader:u,source:s,webGLProgram:l,inShapeInfos:a,outShapeInfo:i,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(n.buildVao(l),Object.assign({program:t,fragmentShader:u,source:s,webGLProgram:l,inShapeInfos:a,outShapeInfo:i},o6(n,t,l)))}function o6(n,t,e){const r=[],o=[];let a,i,s,u=null,l=null;l=n.getUniformLocation(e,"NAN",!1),yt().getNumber("WEBGL_VERSION")===1&&(u=n.getUniformLocation(e,"INFINITY",!1));const c=!1;for(const h of t.variableNames){const d={name:h,uniform:n.getUniformLocation(e,h,c),offset:n.getUniformLocation(e,`offset${h}`,c)};t.enableShapeUniforms&&(d.shape=n.getUniformLocation(e,`${h}Shape`,c),d.texShape=n.getUniformLocation(e,`${h}TexShape`,c)),r.push(d)}if(t.enableShapeUniforms&&(a=n.getUniformLocation(e,"outShape",c),s=n.getUniformLocation(e,"outShapeStrides",c),i=n.getUniformLocation(e,"outTexShape",c)),t.customUniforms)for(const h of t.customUniforms)o.push(n.getUniformLocation(e,h.name,c));return{variablesLocations:r,customUniformLocations:o,infLoc:u,nanLoc:l,outShapeLocation:a,outShapeStridesLocation:s,outTexShapeLocation:i}}function UF(n,t){if(n.length!==t.length)throw Error(`Binary was compiled with ${n.length} inputs, but was executed with ${t.length} inputs`);n.forEach((e,r)=>{const o=e.logicalShape,a=t[r],i=a.shape;if(!tn(o,i))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${o} and ${i} must match`);if(e.isUniform&&a.isUniform)return;const s=e.texShape,u=a.isUniform?null:a.texData.texShape;if(!tn(s,u))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${s} and ${u} must match`)})}function WNt(n,t,e,r,o){t.program.enableShapeUniforms||(UF(t.inShapeInfos,e),UF([t.outShapeInfo],[r]));const a=r.texData.texture,i=r.texData.texShape;r.texData.isPacked?n.setOutputPackedMatrixTexture(a.texture,i[0],i[1]):n.setOutputMatrixTexture(a.texture,i[0],i[1]),n.setProgram(t.webGLProgram),n.bindVertexArray(t.webGLProgram.vao),yt().getNumber("WEBGL_VERSION")===1&&t.infLoc!==null&&n.gl.uniform1f(t.infLoc,1/0),t.nanLoc!==null&&n.gl.uniform1f(t.nanLoc,NaN);for(let u=0;u<e.length;++u){const l=e[u],{uniform:c,offset:h,shape:d,texShape:p}=t.variablesLocations[u];if(d){const{uniformShape:g}=hN(t.program.packedInputs,l.shape,l.texData.texShape);switch(g.length){case 1:n.gl.uniform1iv(d,new Int32Array(g));break;case 2:n.gl.uniform2iv(d,new Int32Array(g));break;case 3:n.gl.uniform3iv(d,new Int32Array(g));break;case 4:n.gl.uniform4iv(d,new Int32Array(g));break}}if(p&&n.gl.uniform2i(p,l.texData.texShape[0],l.texData.texShape[1]),c!=null){if(l.isUniform){if(It(l.shape)<2)n.gl.uniform1f(c,l.uniformValues[0]);else{let g=l.uniformValues;g instanceof Float32Array||(g=new Float32Array(g)),n.gl.uniform1fv(c,g)}continue}l.texData.slice!=null&&h!=null&&n.gl.uniform1i(h,l.texData.slice.flatOffset),n.setInputMatrixTexture(l.texData.texture.texture,c,u)}}const s=t.outShapeLocation;if(s)switch(r.shape.length){case 1:n.gl.uniform1iv(s,new Int32Array(r.shape));break;case 2:n.gl.uniform2iv(s,new Int32Array(r.shape));break;case 3:n.gl.uniform3iv(s,new Int32Array(r.shape));break;case 4:n.gl.uniform4iv(s,new Int32Array(r.shape));break}if(t.outShapeStridesLocation){const u=ue(r.shape);switch(r.shape.length){case 2:n.gl.uniform1iv(t.outShapeStridesLocation,new Int32Array(u));break;case 3:n.gl.uniform2iv(t.outShapeStridesLocation,new Int32Array(u));break;case 4:n.gl.uniform3iv(t.outShapeStridesLocation,new Int32Array(u));break}}if(t.outTexShapeLocation&&n.gl.uniform2i(t.outTexShapeLocation,r.texData.texShape[0],r.texData.texShape[1]),t.program.customUniforms&&o)for(let u=0;u<t.program.customUniforms.length;++u){const l=t.program.customUniforms[u],c=t.customUniformLocations[u],h=o[u];if(l.type==="float")n.gl.uniform1fv(c,h);else if(l.type==="vec2")n.gl.uniform2fv(c,h);else if(l.type==="vec3")n.gl.uniform3fv(c,h);else if(l.type==="vec4")n.gl.uniform4fv(c,h);else if(l.type==="int")n.gl.uniform1iv(c,h);else if(l.type==="ivec2")n.gl.uniform2iv(c,h);else if(l.type==="ivec3")n.gl.uniform3iv(c,h);else if(l.type==="ivec4")n.gl.uniform4iv(c,h);else throw Error(`uniform type ${l.type} is not supported yet.`)}n.executeProgram()}function VNt(n,t,e){let r="";t.concat(e).forEach(i=>{const s=i.texData!=null&&i.texData.slice!=null&&i.texData.slice.flatOffset>0;if(n.enableShapeUniforms&&!i.isUniform){const u=i.texData.texShape,{useSqueezeShape:l,uniformShape:c,keptDims:h}=hN(n.packedInputs,i.shape,u);let d="",p="",g="";if(c.length===1&&n.packedInputs){const k=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];d=`${k[0]>1}_${k[1]>1}`}else if(c.length===2&&!n.packedInputs)p=`${c[0]>1}_${c[1]>1}`;else if(c.length>2&&!n.packedInputs){const k=ue(c);g=`${k[0]===u[1]}_${k[k.length-1]===u[1]}`}const x=i.shape.length,y=c.length===2&&tn(i.shape,u),b=It(i.shape)===1,C=Gf(i.shape,e.shape),E=!n.packedInputs&&x===e.shape.length&&tn(u,e.texData.texShape),S=n.packedInputs||c.length>2?"":`${u[0]>1}_${u[1]>1}`;r+=`${x}_${E}_${l?h:""}_${c.length}_${b}_${C}_${y}_${d}_${p}_${g}_${S}_${s}`}else{const u=i.isUniform?"uniform":i.texData.texShape;r+=`${i.shape}_${u}_${s}`}});const o=n.userCode;let a=n.constructor.name;return a+="_"+r+"_"+o+`${yt().getNumber("WEBGL_VERSION")}`,a}function ao(n){return yt().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&n<=4}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class GNt{constructor(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=gm.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const e=So();this.outputShape=t,this.enableShapeUniforms=ao(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?Ub(["r","c","d"],t):ih(["r","c","d"],t)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${e.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class HNt{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=gm.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const e=So();this.outputShape=t,this.enableShapeUniforms=ao(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?Ub(["r","c","d"],t):ih(["r","c","d"],t)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${e.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qNt{constructor(t){this.variableNames=["A"],this.outTexUsage=xa.DOWNLOAD;const e=So();this.outputShape=t,this.userCode=`
      ${t6}

      void main() {
        float x = getAAtOutCoords();
        ${e.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jNt{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=xa.DOWNLOAD;const e=So();this.outputShape=t,this.userCode=`
      ${t6}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${e.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XNt={R:0,G:1,B:2,A:3};class WF{constructor(t,e=!1,r="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const o=So();this.outputShape=t,this.enableShapeUniforms=ao(this.outputShape.length);let a="result";e&&(a="floor(result * 255. + 0.5)");let i="";for(let s=0;s<r.length;s++){const u=r[s];i+=`
          if(offset == ${s}) {
            result = values[${XNt[u]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?cN():lN(t)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${r.length});

        flatIndex = idiv(flatIndex, ${r.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${o.texture2D}(A, uv);
          ${i}
        }
        ${o.output} = vec4(${a}, 0., 0., 0.);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class KNt{constructor(t,e=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const r=So();this.outputShape=t,this.enableShapeUniforms=ao(this.outputShape.length);let o="",a="result";e&&(a="floor(result * 255. + 0.5)");for(let i=0;i<=1;i++)for(let s=0;s<=1;s++){const u=i*2+s;o+=`
          localCoords = coords;
          if(localCoords[2] + ${s} < ${this.enableShapeUniforms?"outShape[2]":`${t[2]}`}) {
          localCoords[2] += ${s};
          if (localCoords[1] + ${i} < ${this.enableShapeUniforms?"outShape[1]":`${t[1]}`}) {
            localCoords[1] += ${i};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${r.texture2D}(A, uv);

            if (offset == 0) {
              result[${u}] = values[0];
            } else if (offset == 1) {
              result[${u}] = values[1];
            } else if (offset == 2) {
              result[${u}] = values[2];
            } else {
              result[${u}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?cN():lN(t)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${o}

          ${r.output} = ${a};
        }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YNt(n){const t=So(),e=`${t.version}
    precision highp float;
    ${t.attribute} vec3 clipSpacePos;
    ${t.attribute} vec2 uv;
    ${t.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return $Tt(n,e)}function QNt(n){const t=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return PTt(n,t)}function ZNt(n){const t=new Uint16Array([0,1,2,2,1,3]);return BTt(n,t)}function sv(n,t,e,r,o,a){UTt(t,e);const i=zTt(n),s=n.TEXTURE_2D;return qt(n,()=>n.bindTexture(s,i)),qt(n,()=>n.texParameteri(s,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE)),qt(n,()=>n.texParameteri(s,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)),qt(n,()=>n.texParameteri(s,n.TEXTURE_MIN_FILTER,n.NEAREST)),qt(n,()=>n.texParameteri(s,n.TEXTURE_MAG_FILTER,n.NEAREST)),yt().getNumber("WEBGL_VERSION")===1?qt(n,()=>n.texImage2D(s,0,r,t,e,0,o,a,null)):qt(n,()=>n.texStorage2D(s,1,r,t,e)),qt(n,()=>n.bindTexture(n.TEXTURE_2D,null)),{texture:i,texShape:[e,t]}}function a6(n){return n.internalFormatFloat}function JNt(n,t,e,r){const[o,a]=av(t,e);return sv(n,o,a,a6(r),r.textureFormatFloat,n.FLOAT)}function i6(n){return n.internalFormatHalfFloat}function tAt(n,t,e,r){const[o,a]=av(t,e);return sv(n,o,a,i6(r),r.textureFormatFloat,r.textureTypeHalfFloat)}function s6(n){return n.downloadTextureFormat}function eAt(n,t,e,r){const[o,a]=av(t,e);return sv(n,o,a,s6(r),n.RGBA,n.UNSIGNED_BYTE)}function u6(n){return n.internalFormatPackedFloat}function nAt(n,t,e,r){const[o,a]=xd(t,e);return sv(n,o,a,u6(r),n.RGBA,n.FLOAT)}function l6(n){return n.internalFormatPackedHalfFloat}function rAt(n,t,e,r){const[o,a]=xd(t,e);return sv(n,o,a,l6(r),n.RGBA,r.textureTypeHalfFloat)}function oAt(n,t,e){return qt(n,()=>n.bindBuffer(n.ARRAY_BUFFER,e)),PF(n,t,"clipSpacePos",e,3,20,0)&&PF(n,t,"uv",e,2,20,12)}function aAt(n,t,e,r,o,a){qt(n,()=>n.bindTexture(n.TEXTURE_2D,t));let i,s,u;o instanceof Uint8Array?(i=new Uint8Array(e*r*4),s=n.UNSIGNED_BYTE,u=n.RGBA):(i=new Float32Array(e*r*4),s=n.FLOAT,u=a.internalFormatPackedFloat),i.set(o),yt().getNumber("WEBGL_VERSION")===2?qt(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,e,r,n.RGBA,s,i)):qt(n,()=>n.texImage2D(n.TEXTURE_2D,0,u,e,r,0,n.RGBA,s,i)),qt(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function iAt(n,t,e){qt(n,()=>n.bindTexture(n.TEXTURE_2D,t)),e.data instanceof Uint8Array?yt().getNumber("WEBGL_VERSION")===2?qt(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,e.width,e.height,n.RGBA,n.UNSIGNED_BYTE,e.data)):qt(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,e.width,e.height,0,n.RGBA,n.UNSIGNED_BYTE,e.data)):yt().getNumber("WEBGL_VERSION")===2?qt(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,e)):qt(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,e)),qt(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function sAt(n,t,e,r){const o=n.createBuffer();qt(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,o));const s=4*4*t*e;return qt(n,()=>n.bufferData(n.PIXEL_PACK_BUFFER,s,n.STREAM_READ)),qt(n,()=>n.readPixels(0,0,e,t,n.RGBA,n.FLOAT,0)),qt(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,null)),o}function uAt(n,t,e){const r=n,o=new Float32Array(e);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,o),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),o}function lAt(n,t,e,r){const[o,a]=av(t,e),i=4,s=new Uint8Array(ITt(t*e,i));return qt(n,()=>n.readPixels(0,0,o,a,r.downloadTextureFormat,n.UNSIGNED_BYTE,s)),new Float32Array(s.buffer)}function cAt(n,t,e,r,o,a,i,s){const u=n,l=new Float32Array(RTt(a,i));return u.bindBuffer(u.PIXEL_PACK_BUFFER,t),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,l),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),l}function hAt(n,t,e){const r=new Float32Array(t*e*4);return qt(n,()=>n.readPixels(0,0,e,t,n.RGBA,n.FLOAT,r)),r}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ES{constructor(t){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const e=yt().getNumber("WEBGL_VERSION");if(t!=null?(this.gl=t,STt(e,t)):this.gl=bi(e),t=this.gl,yt().getNumber("WEBGL_VERSION")===2){const a=t;this.createVertexArray=()=>qt(a,()=>a.createVertexArray()),this.bindVertexArray=i=>qt(a,()=>a.bindVertexArray(i)),this.deleteVertexArray=i=>qt(a,()=>a.deleteVertexArray(i)),this.getVertexArray=()=>qt(a,()=>a.getParameter(a.VERTEX_ARRAY_BINDING))}else if(t!=null){const a=t.getExtension("OES_vertex_array_object");if(a==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>qt(t,()=>a.createVertexArrayOES()),this.bindVertexArray=i=>qt(t,()=>a.bindVertexArrayOES(i)),this.deleteVertexArray=i=>qt(t,()=>a.deleteVertexArrayOES(i)),this.getVertexArray=()=>qt(t,()=>t.getParameter(a.VERTEX_ARRAY_BINDING_OES))}let r="WEBGL_color_buffer_float";const o="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),yt().getNumber("WEBGL_VERSION")===1){const a="OES_texture_float",i="OES_texture_half_float";if(this.textureFloatExtension=Jx(this.gl,a),Wa(this.gl,i))this.textureHalfFloatExtension=Jx(this.gl,i);else if(yt().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),Wa(this.gl,o))this.colorBufferHalfFloatExtension=Jx(this.gl,o);else if(yt().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",Wa(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else if(Wa(this.gl,o))this.colorBufferHalfFloatExtension=this.gl.getExtension(o);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=QNt(this.gl),this.indexBuffer=ZNt(this.gl),this.framebuffer=WTt(this.gl),this.textureConfig=uN(this.gl,this.textureHalfFloatExtension)}get debug(){return yt().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const t=this.gl;qt(t,()=>t.finish()),qt(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,null)),qt(t,()=>t.deleteFramebuffer(this.framebuffer)),qt(t,()=>t.bindBuffer(t.ARRAY_BUFFER,null)),qt(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)),qt(t,()=>t.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(t,e){return this.throwIfDisposed(),JNt(this.gl,t,e,this.textureConfig)}createFloat16MatrixTexture(t,e){return this.throwIfDisposed(),tAt(this.gl,t,e,this.textureConfig)}createUnsignedBytesMatrixTexture(t,e){return this.throwIfDisposed(),eAt(this.gl,t,e,this.textureConfig)}uploadPixelDataToTexture(t,e){this.throwIfDisposed(),iAt(this.gl,t,e)}uploadDenseMatrixToTexture(t,e,r,o){this.throwIfDisposed(),aAt(this.gl,t,e,r,o,this.textureConfig)}createFloat16PackedMatrixTexture(t,e){return this.throwIfDisposed(),rAt(this.gl,t,e,this.textureConfig)}createPackedMatrixTexture(t,e){return this.throwIfDisposed(),nAt(this.gl,t,e,this.textureConfig)}deleteMatrixTexture(t){this.throwIfDisposed(),this.outputTexture===t&&(BF(this.gl,this.framebuffer),this.outputTexture=null),qt(this.gl,()=>this.gl.deleteTexture(t))}downloadByteEncodedFloatMatrixFromOutputTexture(t,e,r){return this.downloadMatrixDriver(t,()=>lAt(this.gl,e,r,this.textureConfig))}downloadPackedMatrixFromBuffer(t,e,r,o,a,i){return cAt(this.gl,t,e,r,o,a,i,this.textureConfig)}downloadFloat32MatrixFromBuffer(t,e){return uAt(this.gl,t,e)}createBufferFromTexture(t,e,r){this.bindTextureToFrameBuffer(t);const o=sAt(this.gl,e,r,this.textureConfig);return this.unbindTextureToFrameBuffer(),o}createAndWaitForFence(){const t=this.createFence(this.gl);return this.pollFence(t)}createFence(t){let e,r;if(yt().getBool("WEBGL_FENCE_API_ENABLED")){const o=t,a=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);t.flush(),r=()=>{const i=o.clientWaitSync(a,0,0);return i===o.ALREADY_SIGNALED||i===o.CONDITION_SATISFIED},e=a}else yt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(e=this.beginQuery(),this.endQuery(),r=()=>this.isQueryAvailable(e,yt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):r=()=>!0;return{query:e,isFencePassed:r}}downloadMatrixFromPackedTexture(t,e,r){return this.downloadMatrixDriver(t,()=>hAt(this.gl,e,r))}createProgram(t){this.throwIfDisposed();const e=this.gl;this.vertexShader==null&&(this.vertexShader=YNt(e));const r=MTt(e);qt(e,()=>e.attachShader(r,this.vertexShader)),qt(e,()=>e.attachShader(r,t)),LTt(e,r);const o=Object.assign(r,{vao:this.createVertexArray()});return this.debug&&bS(e,o),o}buildVao(t){this.setProgram(t),this.bindVertexArray(t.vao);const e=this.gl;qt(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),oAt(e,t,this.vertexBuffer)}deleteProgram(t){this.throwIfDisposed(),t===this.program&&(this.program=null),t!=null&&(qt(this.gl,()=>this.gl.deleteProgram(t)),this.deleteVertexArray(t.vao))}setProgram(t){this.throwIfDisposed(),this.program=t,this.program!=null&&this.debug&&bS(this.gl,this.program),qt(this.gl,()=>this.gl.useProgram(t))}getUniformLocation(t,e,r=!0){return this.throwIfDisposed(),r?GTt(this.gl,t,e):HTt(this.gl,t,e)}getAttributeLocation(t,e){return this.throwIfDisposed(),qt(this.gl,()=>this.gl.getAttribLocation(t,e))}getUniformLocationNoThrow(t,e){return this.throwIfDisposed(),this.gl.getUniformLocation(t,e)}setInputMatrixTexture(t,e,r){this.throwIfDisposed(),this.throwIfNoProgram(),qTt(this.gl,t,e,r)}setOutputMatrixTexture(t,e,r){this.setOutputMatrixTextureDriver(t,r,e)}setOutputPackedMatrixTexture(t,e,r){this.throwIfDisposed();const[o,a]=xd(e,r);this.setOutputMatrixTextureDriver(t,o,a)}setOutputMatrixWriteRegion(t,e,r,o){this.setOutputMatrixWriteRegionDriver(r,t,o,e)}setOutputPackedMatrixWriteRegion(t,e,r,o){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&bS(this.gl,this.program),t0(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const t=this.gl;if(this.debug){const e=this.getVertexArray();console.assert(e===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}qt(t,()=>t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),qt(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=Jx(this.gl,yt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(yt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const r=this.gl,o=this.getQueryTimerExtensionWebGL2(),a=r.createQuery();return r.beginQuery(o.TIME_ELAPSED_EXT,a),a}const t=this.getQueryTimerExtensionWebGL1(),e=t.createQueryEXT();return t.beginQueryEXT(t.TIME_ELAPSED_EXT,e),e}endQuery(){if(yt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const e=this.gl,r=this.getQueryTimerExtensionWebGL2();e.endQuery(r.TIME_ELAPSED_EXT);return}const t=this.getQueryTimerExtensionWebGL1();t.endQueryEXT(t.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(t){return await u3(()=>this.disposed||this.isQueryAvailable(t,yt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(t,yt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(t,e){if(e===0)return null;if(e===2){const r=this.gl;return r.getQueryParameter(t,r.QUERY_RESULT)/1e6}else{const r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(t,r.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(t,e){if(e===0)return!0;if(e===2){const r=this.gl,o=this.getQueryTimerExtensionWebGL2(),a=r.getQueryParameter(t,r.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(o.GPU_DISJOINT_EXT)),a&&!this.disjoint}else{const r=this.getQueryTimerExtensionWebGL1(),o=r.getQueryObjectEXT(t,r.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),o&&!this.disjoint}}pollFence(t){return new Promise(e=>{this.addItemToPoll(()=>t.isFencePassed(),()=>e())})}pollItems(){const t=fAt(this.itemsToPoll.map(e=>e.isDoneFn));for(let e=0;e<=t;++e){const{resolveFn:r}=this.itemsToPoll[e];r()}this.itemsToPoll=this.itemsToPoll.slice(t+1)}addItemToPoll(t,e){if(this.itemsToPoll.push({isDoneFn:t,resolveFn:e}),this.itemsToPoll.length>1)return;let r;"setTimeoutCustom"in yt().platform&&(r=yt().platform.setTimeoutCustom.bind(yt().platform)),u3(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,r)}bindTextureToFrameBuffer(t){this.throwIfDisposed(),wS(this.gl,t,this.framebuffer),this.debug&&t0(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(wS(this.gl,this.outputTexture,this.framebuffer),this.debug&&t0(this.gl)):BF(this.gl,this.framebuffer)}downloadMatrixDriver(t,e){this.bindTextureToFrameBuffer(t);const r=e();return this.unbindTextureToFrameBuffer(),r}setOutputMatrixTextureDriver(t,e,r){this.throwIfDisposed();const o=this.gl;wS(o,t,this.framebuffer),this.debug&&t0(o),this.outputTexture=t,qt(o,()=>o.viewport(0,0,e,r)),qt(o,()=>o.scissor(0,0,e,r))}setOutputMatrixWriteRegionDriver(t,e,r,o){this.throwIfDisposed(),qt(this.gl,()=>this.gl.scissor(t,e,r,o))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}}function fAt(n){let t=0;for(;t<n.length&&n[t]();++t);return t-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{addImpl:dAt,bincountImpl:c6,bincountReduceImpl:pAt,bitwiseAndImpl:mAt,castImpl:gAt,ceilImpl:vAt,concatImpl:xAt,equalImpl:yAt,expImpl:bAt,expm1Impl:wAt,floorImpl:CAt,gatherNdImpl:SAt,gatherV2Impl:EAt,greaterImpl:kAt,greaterEqualImpl:IAt,lessImpl:RAt,lessEqualImpl:TAt,linSpaceImpl:NAt,logImpl:AAt,maxImpl:_At,maximumImpl:DAt,minimumImpl:$At,multiplyImpl:OAt,negImpl:FAt,notEqualImpl:MAt,prodImpl:LAt,raggedGatherImpl:PAt,raggedRangeImpl:BAt,raggedTensorToTensorImpl:zAt,rangeImpl:UAt,rsqrtImpl:WAt,scatterImpl:VAt,sigmoidImpl:GAt,simpleAbsImpl:h6,sliceImpl:HAt,sparseFillEmptyRowsImpl:qAt,sparseReshapeImpl:jAt,sparseSegmentReductionImpl:f6,sqrtImpl:XAt,staticRegexReplaceImpl:KAt,stridedSliceImpl:YAt,stringNGramsImpl:QAt,stringSplitImpl:ZAt,stringToHashBucketFastImpl:JAt,subImpl:t_t,tileImpl:e_t,topKImpl:n_t,transposeImpl:fN,uniqueImpl:r_t}=GCt;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d6(n,t){return["x","y","z","w","u","v"].slice(0,t).map(e=>`${n}.${e}`)}function xo(n,t){return t===1?[n]:d6(n,t)}function o_t(n,t){if(n===1)return"rc";let e="";for(let r=0;r<n;r++)e+=t[r],r<n-1&&(e+=",");return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class a_t{constructor(t){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.enableShapeUniforms=ao(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{const e=xo("rc",this.rank),r=pn(this.rank),o=this.getOutOfBoundsCondition(e),a=this.getSetup(e),i=this.getOutput(e);this.userCode=`
        void main() {
          ${r} rc = getOutputCoords();

          if(${o}) {
            setOutput(vec4(0));
          } else {
            ${a}

            setOutput(vec4(${i}));
          }
        }
      `}}getSourceCoordsArr(t){const e=[];for(let r=0;r<=1;r++)for(let o=0;o<=1;o++){let a=`${r===0?"r":"rp1"}, ${o===0?"c":"cp1"}`;for(let i=2;i<this.rank;i++)a=`${t[t.length-1-i]},`+a;e.push(a)}return e}getOutOfBoundsCondition(t){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let e="";for(let r=this.rank-2;r<this.rank;r++)e+=`${t[r]} >= ${this.enableShapeUniforms?`outShape[${r}]`:this.outputShape[r]}`,r<this.rank-1&&(e+="||");return e}getSetup(t){if(this.rank===1)return"";const e=t.slice(-2),r=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],o=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${e[0]};
      int c = ${e[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${r};
      bool rEdge = rp1 >= ${o};
    `}getOutput(t){const e=this.getSourceCoordsArr(t);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${e[0]}),
            cEdge ? 0. : getA(${e[1]}),
            rEdge ? 0. : getA(${e[2]}),
            rEdge || cEdge ? 0. : getA(${e[3]})`}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class p6{constructor(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=t,this.enableShapeUniforms=ao(this.outputShape.length);let r="";for(let o=0;o<4;o++){let a="thisRC = rc;";o%2===1&&(a+="thisRC.z += 1;"),o>1&&(a+="thisRC.y += 1;"),r+=`
        ${a}
        ${o>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${o}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${o>0?"}":""}
      `}this.userCode=`
      ${i_t(e,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?cN():lN(t)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":t[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":t[2]};

        ${r}

        setOutput(result);
      }
    `}}function i_t(n,t){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${t?oNt(["r","c","d"],"inputShape"):ih(["r","c","d"],n)}
      return ivec3(r, c, d);
    }
  `}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class s_t{constructor(t){this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(t,e,r){const o=GF(e,r),a=HF(t,o,r);a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]);const i=VF(t,o,this.gpgpu.gl,this.gpgpu.textureConfig,r);if(this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=i,this.log();const u=this.freeTextures[a].pop();return this.usedTextures[a].push(u),u}let s;return o===Br.PACKED_2X2_FLOAT32?s=this.gpgpu.createPackedMatrixTexture(t[0],t[1]):o===Br.PACKED_2X2_FLOAT16?s=this.gpgpu.createFloat16PackedMatrixTexture(t[0],t[1]):o===Br.UNPACKED_FLOAT32?s=this.gpgpu.createFloat32MatrixTexture(t[0],t[1]):o===Br.UNPACKED_FLOAT16?s=this.gpgpu.createFloat16MatrixTexture(t[0],t[1]):o===Br.PACKED_4X1_UNSIGNED_BYTE&&(s=this.gpgpu.createUnsignedBytesMatrixTexture(t[0],t[1])),this.usedTextures[a].push(s),this.numUsedTextures++,this._numBytesAllocated+=i,this.log(),s}releaseTexture(t,e,r,o){if(this.freeTextures==null)return;const a=GF(r,o),i=HF(e,a,o);i in this.freeTextures||(this.freeTextures[i]=[]);const s=VF(e,a,this.gpgpu.gl,this.gpgpu.textureConfig,o),u=yt().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");u!==-1&&this._numBytesAllocated>u?(this.gpgpu.deleteMatrixTexture(t.texture),this._numBytesAllocated-=s):(this.freeTextures[i].push(t),this.numFreeTextures++,this._numBytesFree+=s),this.numUsedTextures--;const l=this.usedTextures[i],c=l&&l.indexOf(t);if(c==null||c<0)throw new Error("Cannot release a texture that was never provided by this texture manager");l[c]=l[l.length-1],l.pop(),this.log()}log(){if(!this.logEnabled)return;const t=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${t})`);const e=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*e)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(const t in this.freeTextures)this.freeTextures[t].forEach(e=>{this.gpgpu.deleteMatrixTexture(e.texture)});for(const t in this.usedTextures)this.usedTextures[t].forEach(e=>{this.gpgpu.deleteMatrixTexture(e.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function u_t(n,t){const e=n;if(t===e.R32F)return 4;if(t===e.R16F)return 2;if(t===e.RGBA32F)return 16;if(t===n.RGBA)return 16;if(t===e.RGBA16F)return 8;if(t===e.RGBA8)return 4;throw new Error(`Unknown internal format ${t}`)}function VF(n,t,e,r,o){const a=l_t(t,r);let i;if(o){const[u,l]=xd(n[0],n[1]);i=u*l}else{const[u,l]=av(n[0],n[1]);i=u*l}const s=u_t(e,a);return i*s}function l_t(n,t){switch(n){case Br.PACKED_2X2_FLOAT32:return u6(t);case Br.PACKED_2X2_FLOAT16:return l6(t);case Br.UNPACKED_FLOAT32:return a6(t);case Br.UNPACKED_FLOAT16:return i6(t);case Br.PACKED_4X1_UNSIGNED_BYTE:return s6(t);default:throw new Error(`Unknown physical texture type ${n}`)}}function c_t(n){return yt().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?n?Br.PACKED_2X2_FLOAT32:Br.UNPACKED_FLOAT32:n?Br.PACKED_2X2_FLOAT16:Br.UNPACKED_FLOAT16}function GF(n,t){if(n===xa.UPLOAD)return Br.PACKED_2X2_FLOAT32;if(n===xa.RENDER||n==null)return c_t(t);if(n===xa.DOWNLOAD||n===xa.PIXELS)return Br.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${n}`)}function HF(n,t,e){return`${n[0]}_${n[1]}_${t}_${e}`}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ji{constructor(t,e){this.variableNames=["A"],this.outputShape=t,this.enableShapeUniforms=ao(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${e}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}const Za="if (isnan(x)) return x;",h_t="return x;",qF="return abs(x);",f_t="return (x >= 0.0) ? x : (exp(x) - 1.0);",d_t=Za+`
  return (x < 0.0) ? 0.0 : x;
`,p_t=Za+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Wu="return x;",m_t="return 1.0 / (1.0 + exp(-1.0 * x));";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const g_t="return x;",v_t=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,x_t=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,y_t=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,b_t="return 1.0 / (1.0 + exp(-1.0 * x));";class Ku{constructor(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.enableShapeUniforms=ao(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${e}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class w_t{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=t,this.enableShapeUniforms=ao(this.outputShape.length);const e=t.length,r=xo("rc",e),o=pn(e),a=o_t(e,r),i=r.slice(-2),s=e<=1?"rc":`vec2(${i.join(",")})`;this.userCode=`
      void main() {
        ${o} rc = getOutputCoords();
        vec4 packedInput = getA(${a});

        setOutput(getChannel(packedInput, ${s}));
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const C_t=PU,S_t=1e-7,E_t=1e-4,r0={};function k_t(n){return n in r0||(r0[n]={}),r0[n]}const I_t=yt().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),R_t=600;function T_t(){return yt().global.screen==null?1024:yt().global.screen.height*yt().global.screen.width*window.devicePixelRatio*R_t/1024/1024}class Wb extends FI{nextDataId(){return Wb.nextDataId++}constructor(t){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!yt().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let e;if(t!=null){if(t instanceof ES)e=t;else{const r=bi(yt().getNumber("WEBGL_VERSION"),t);e=new ES(r)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const r=bi(yt().getNumber("WEBGL_VERSION"));e=new ES(r),this.binaryCache=k_t(yt().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=e,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new s_t(this.gpgpu),this.numMBBeforeWarning=T_t(),this.texData=new sz(this,Fi())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(t,e,r,o,a,i){const s=this.makeTensorInfo(e,r),u=this.texData.get(s.dataId);u.isPacked=!1,u.texture={texture:t,texShape:[o,a]},u.texShape=[o,a];const l=e0(e),c=new WF(l,!1,i),h=this.runWebGLProgram(c,[s],r,[[o,a]]);return h.shape=e,u.texture=null,this.disposeIntermediateTensorInfo(s),h.dataId}write(t,e,r){if((yt().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||yt().getBool("DEBUG"))&&this.checkNumericalProblems(t),r==="complex64"&&t!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const o={id:this.nextDataId()};return this.texData.set(o,{shape:e,dtype:r,values:t,usage:xa.UPLOAD,refCount:1}),o}refCount(t){return this.texData.has(t)?this.texData.get(t).refCount:0}incRef(t){const e=this.texData.get(t);e.refCount++}decRef(t){if(this.texData.has(t)){const e=this.texData.get(t);e.refCount--}}move(t,e,r,o,a){if(yt().getBool("DEBUG")&&this.checkNumericalProblems(e),o==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:r,dtype:o,values:e,usage:xa.UPLOAD,refCount:a})}disposeIntermediateTensorInfo(t){this.disposeData(t.dataId)}readSync(t){const e=this.texData.get(t),{values:r,dtype:o,complexTensorInfos:a,slice:i,shape:s,isPacked:u}=e;if(i!=null){let d;u?d=new Ku(s,Wu):d=new ji(s,Wu);const p=this.runWebGLProgram(d,[{dataId:t,shape:s,dtype:o}],o),g=this.readSync(p.dataId);return this.disposeIntermediateTensorInfo(p),g}if(r!=null)return this.convertAndCacheOnCPU(t);if(o==="string")return r;const l=this.activeTimers!=null;let c;l&&(c=Io());let h;if(o==="complex64"){const d=this.readSync(a.real.dataId),p=this.readSync(a.imag.dataId);h=Qs(d,p)}else h=this.getValuesFromTexture(t);return l&&(this.downloadWaitMs+=Io()-c),this.convertAndCacheOnCPU(t,h)}async read(t){if(this.pendingRead.has(t)){const g=this.pendingRead.get(t);return new Promise(x=>g.push(x))}const e=this.texData.get(t),{values:r,shape:o,slice:a,dtype:i,complexTensorInfos:s,isPacked:u}=e;if(a!=null){let g;u?g=new Ku(o,Wu):g=new ji(o,Wu);const x=this.runWebGLProgram(g,[{dataId:t,shape:o,dtype:i}],i),y=this.read(x.dataId);return this.disposeIntermediateTensorInfo(x),y}if(r!=null)return this.convertAndCacheOnCPU(t);if(yt().getBool("DEBUG")&&!yt().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&yt().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let l=null,c;if(i!=="complex64"&&yt().get("WEBGL_BUFFER_SUPPORTED")){c=this.decode(t);const g=this.texData.get(c.dataId);l=this.gpgpu.createBufferFromTexture(g.texture.texture,...Zx(o))}this.pendingRead.set(t,[]),i!=="complex64"&&await this.gpgpu.createAndWaitForFence();let h;if(i==="complex64"){const g=await Promise.all([this.read(s.real.dataId),this.read(s.imag.dataId)]),x=g[0],y=g[1];h=Qs(x,y)}else if(l==null)h=this.getValuesFromTexture(t);else{const g=It(o);h=this.gpgpu.downloadFloat32MatrixFromBuffer(l,g)}if(c!=null&&this.disposeIntermediateTensorInfo(c),l!=null){const g=this.gpgpu.gl;qt(g,()=>g.deleteBuffer(l))}const d=this.convertAndCacheOnCPU(t,h),p=this.pendingRead.get(t);return this.pendingRead.delete(t),p.forEach(g=>g(d)),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t)&&Fi().removeDataId(t,this),this.pendingDeletes--),d}readToGPU(t,e={}){const r=this.texData.get(t),{values:o,shape:a,slice:i,dtype:s,isPacked:u,texture:l}=r;if(s==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(i!=null){let p;u?p=new Ku(a,Wu):p=new ji(a,Wu);const g=this.runWebGLProgram(p,[{dataId:t,shape:a,dtype:s}],s),x=this.readToGPU(g,e);return this.disposeIntermediateTensorInfo(g),x}if(l==null)throw o!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const c=this.decode(t,e.customTexShape),h=Fi().makeTensorFromTensorInfo(c),d=this.texData.get(c.dataId);return Object.assign({tensorRef:h},d.texture)}bufferSync(t){const e=this.readSync(t.dataId);if(t.dtype==="string")try{const r=e.map(o=>sl(o));return Ae(t.shape,t.dtype,r)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Ae(t.shape,t.dtype,e)}checkNumericalProblems(t){if(t!=null)for(let e=0;e<t.length;e++){const r=t[e];if(!_Tt(r))throw yt().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${r} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${r} cannot be represented on this device.`)}}getValuesFromTexture(t){const{shape:e,dtype:r,isPacked:o}=this.texData.get(t),a=It(e);if(yt().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const d=this.decode(t),p=this.texData.get(d.dataId),g=this.gpgpu.downloadMatrixFromPackedTexture(p.texture.texture,...Zx(e)).subarray(0,a);return this.disposeIntermediateTensorInfo(d),g}const i=yt().getBool("WEBGL_PACK")&&o===!0,s=i?e0(e):e,u=i?new jNt(s):new qNt(s),l=this.runWebGLProgram(u,[{shape:s,dtype:r,dataId:t}],"float32"),c=this.texData.get(l.dataId),h=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(c.texture.texture,c.texShape[0],c.texShape[1]).subarray(0,a);return this.disposeIntermediateTensorInfo(l),h}timerAvailable(){return yt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(t){const e=this.activeTimers,r=[];let o=!1;this.programTimersStack==null?(this.programTimersStack=r,o=!0):this.activeTimers.push(r),this.activeTimers=r,t();const a=Rc(this.activeTimers.map(u=>u.query)).filter(u=>u!=null),i=Rc(this.activeTimers.map(u=>u.name)).filter(u=>u!=null);this.activeTimers=e,o&&(this.programTimersStack=null);const s={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(yt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const u=await Promise.all(a);s.kernelMs=Mdt(u),s.getExtraProfileInfo=()=>u.map((l,c)=>({name:i[c],ms:l})).map(l=>`${l.name}: ${l.ms}`).join(", ")}else s.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,s})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return yt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Io(),endMs:null}}endTimer(t){return yt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=Io(),t)}async getQueryTime(t){if(yt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(t);const e=t;return e.endMs-e.startMs}disposeData(t,e=!1){if(this.pendingDisposal.has(t))return!1;if(!this.texData.has(t))return!0;if(e?this.texData.get(t).refCount=0:this.texData.get(t).refCount--,!e&&this.texData.get(t).refCount>0)return!1;if(this.pendingRead.has(t))return this.pendingDisposal.add(t),this.pendingDeletes++,!1;this.releaseGPUData(t);const{complexTensorInfos:r}=this.texData.get(t);return r!=null&&(this.disposeData(r.real.dataId,e),this.disposeData(r.imag.dataId,e)),this.texData.delete(t),!0}releaseGPUData(t){const{texture:e,dtype:r,texShape:o,usage:a,isPacked:i,slice:s}=this.texData.get(t),u=s&&s.origDataId||t,l=this.dataRefCount.get(u);l>1?this.dataRefCount.set(u,l-1):(this.dataRefCount.delete(u),e!=null&&(this.numBytesInGPU-=this.computeBytes(o,r),this.textureManager.releaseTexture(e,o,a,i)));const c=this.texData.get(t);c.texture=null,c.texShape=null,c.isPacked=!1,c.slice=null}getTexture(t){return this.uploadToGPU(t),this.texData.get(t).texture.texture}getDataInfo(t){return this.texData.get(t)}shouldExecuteOnCPU(t,e=I_t){return yt().getBool("WEBGL_CPU_FORWARD")&&t.every(r=>this.texData.get(r.dataId).texture==null&&It(r.shape)<e)}getGPGPUContext(){return this.gpgpu}where(t){pa("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const e=t.dataSync();return C_t(t.shape,e)}packedUnaryOp(t,e,r){const o=new Ku(t.shape,e),a=this.compileAndRun(o,[t],r);return Fi().makeTensorFromTensorInfo(a)}abs(t){if(this.shouldExecuteOnCPU([t])&&t.dtype!=="complex64"){const o=h6(this.texData.get(t.dataId).values);return this.makeOutput(t.shape,t.dtype,o)}if(yt().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,qF,t.dtype);const e=new ji(t.shape,qF),r=this.compileAndRun(e,[t]);return Fi().makeTensorFromTensorInfo(r)}makeTensorInfo(t,e,r){let o;if(e==="string"&&r!=null&&r.length>0&&qm(r[0])){const a=r.map(i=>Ju(i));o=this.write(a,t,e)}else o=this.write(r,t,e);return this.texData.get(o).usage=null,{dataId:o,shape:t,dtype:e}}makeOutput(t,e,r){return Fi().makeTensorFromTensorInfo(this.makeTensorInfo(t,e,r),this)}unpackTensor(t){const e=new w_t(t.shape);return this.runWebGLProgram(e,[t],t.dtype)}packTensor(t){const e=new a_t(t.shape);return this.runWebGLProgram(e,[t],t.dtype,null,!0)}packedReshape(t,e){const r=[Yf(t.shape),...Qf(t.shape)],o={dtype:t.dtype,shape:r,dataId:t.dataId},a=[Yf(e),...Qf(e)],i=new p6(a,r),s=!0,u=[r],l=this.runWebGLProgram(i,[o],t.dtype,u,s);return{dataId:l.dataId,shape:e,dtype:l.dtype}}decode(t,e){const r=this.texData.get(t),{isPacked:o,shape:a,dtype:i}=r;if(e!=null){const d=It(a),p=e[0]*e[1]*4;H(d<=p,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}const s=e0(a);let u;o?u=new HNt(s):u=new GNt(s);const l=!0,c=[e??Zx(s)],h=this.runWebGLProgram(u,[{shape:s,dtype:i,dataId:t}],i,c,l,e);return{dtype:i,shape:a,dataId:h.dataId}}runWebGLProgram(t,e,r,o,a=!1,i){const s=this.makeTensorInfo(t.outputShape,r),u=this.texData.get(s.dataId);if(t.packedOutput&&(u.isPacked=!0),t.outPackingScheme===gm.DENSE){const b=i??Zx(t.outputShape);u.texShape=b.map(C=>C*2)}if(t.outTexUsage!=null&&(u.usage=t.outTexUsage),It(s.shape)===0)return u.values=Jr(s.dtype,0),s;const l=[],c=e.map(b=>{if(b.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let C=this.texData.get(b.dataId);if(C.texture==null){if(!t.packedInputs&&It(b.shape)<=yt().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:b.shape,texData:null,isUniform:!0,uniformValues:C.values};t.packedInputs&&(C.isPacked=!0,C.shape=b.shape)}if(this.uploadToGPU(b.dataId),!!C.isPacked!=!!t.packedInputs)b=C.isPacked?this.unpackTensor(b):this.packTensor(b),l.push(b),C=this.texData.get(b.dataId);else if(C.isPacked&&!Uy(C.shape,b.shape)){const E=b,S=b.shape;b.shape=C.shape,b=this.packedReshape(b,S),l.push(b),C=this.texData.get(b.dataId),E.shape=S}return{shape:b.shape,texData:C,isUniform:!1}});this.uploadToGPU(s.dataId);const h={shape:s.shape,texData:u,isUniform:!1},d=VNt(t,c,h),p=this.getAndSaveBinary(d,()=>UNt(this.gpgpu,t,c,h)),g=this.activeTimers!=null;let x;g&&(x=this.startTimer()),yt().get("ENGINE_COMPILE_ONLY")||WNt(this.gpgpu,p,c,h,o),l.forEach(b=>this.disposeIntermediateTensorInfo(b)),g&&(x=this.endTimer(x),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(x)}));const y=yt().getNumber("WEBGL_FLUSH_THRESHOLD");if(y>0){const b=Io();b-this.lastGlFlushTime>y&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=b)}if(!yt().getBool("WEBGL_LAZILY_UNPACK")&&u.isPacked&&a===!1){const b=this.unpackTensor(s);return this.disposeIntermediateTensorInfo(s),b}return s}compileAndRun(t,e,r,o,a=!1){return r=r||e[0].dtype,this.runWebGLProgram(t,e,r,o,a)}getAndSaveBinary(t,e){return t in this.binaryCache||(this.binaryCache[t]=e()),this.binaryCache[t]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(yt().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(e=>{this.gpgpu.deleteProgram(this.binaryCache[e].webGLProgram),delete this.binaryCache[e]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=gt(()=>{if(!yt().get("WEBGL_RENDER_FLOAT32_ENABLED")){const t=yt().getBool("DEBUG");yt().set("DEBUG",!1);const e=this.abs(Je(1e-8)).dataSync()[0];if(yt().set("DEBUG",t),e>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?S_t:E_t}uploadToGPU(t){const e=this.texData.get(t),{shape:r,dtype:o,values:a,texture:i,usage:s,isPacked:u}=e;if(i!=null)return;const l=this.activeTimers!=null;let c;l&&(c=Io());let h=e.texShape;if(h==null&&(h=KTt(r,u),e.texShape=h),a!=null){const d=e0(r);let p,g=h[1],x=h[0];const y=a instanceof Uint8Array||a instanceof Uint8ClampedArray;(u||!y)&&([g,x]=xd(h[0],h[1])),u?p=new KNt(d,y):p=new WF(d,y);const b=y?[x,g]:h,C=this.makeTensorInfo(b,o),E=this.texData.get(C.dataId);y?E.usage=xa.PIXELS:E.usage=xa.UPLOAD,E.texShape=b,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(C.dataId),g,x,a);const S=[[x,g]],R=this.runWebGLProgram(p,[C],o,S,!0),A=this.texData.get(R.dataId);e.texShape=A.texShape,e.isPacked=A.isPacked,e.usage=A.usage,yt().get("ENGINE_COMPILE_ONLY")?this.disposeData(R.dataId):(e.texture=A.texture,e.values=null,this.texData.delete(R.dataId)),this.disposeIntermediateTensorInfo(C),l&&(this.uploadWaitMs+=Io()-c)}else{const d=this.acquireTexture(h,s,o,u);e.texture=d}}convertAndCacheOnCPU(t,e){const r=this.texData.get(t),{dtype:o}=r;return e!=null&&(r.values=N_t(e,o)),r.values}acquireTexture(t,e,r,o){if(this.numBytesInGPU+=this.computeBytes(t,r),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){const a=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${a} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(t,e,o)}computeBytes(t,e){return t[0]*t[1]*vy(e)}checkCompileCompletion(){for(const[,t]of Object.entries(this.binaryCache))this.checkCompletion_(t)}async checkCompileCompletionAsync(){const t=[];if(this.gpgpu.parallelCompilationExtension){for(const[,e]of Object.entries(this.binaryCache))t.push(this.checkCompletionAsync_(e));return Promise.all(t)}else{for(const[,e]of Object.entries(this.binaryCache)){const r=new Promise(o=>{try{this.checkCompletion_(e),o(!0)}catch(a){throw a}});t.push(r)}return Promise.all(t)}}async checkCompletionAsync_(t){return this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(t):(await eW(),this.checkCompletionAsync_(t))}checkCompletion_(t){if(this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(t.webGLProgram)),this.gpgpu.gl.getShaderParameter(t.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(JH(t.source,this.gpgpu.gl.getShaderInfoLog(t.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(const t of Object.values(this.binaryCache)){this.gpgpu.buildVao(t.webGLProgram);const{variablesLocations:e,customUniformLocations:r,infLoc:o,nanLoc:a,outShapeLocation:i,outShapeStridesLocation:s,outTexShapeLocation:u}=o6(this.gpgpu,t.program,t.webGLProgram);t.variablesLocations=e,t.customUniformLocations=r,t.infLoc=o,t.nanLoc=a,t.outShapeLocation=i,t.outShapeStridesLocation=s,t.outTexShapeLocation=u}}createTensorFromGPUData(t,e,r){t.channels=t.channels||"RGBA";const{texture:o,height:a,width:i,channels:s}=t,u=Fi().backend;if(!u.gpgpu.gl.isTexture(o))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const l=u.writeTexture(o,e,r,a,i,s);return Fi().makeTensorFromDataId(l,e,r,u)}}Wb.nextDataId=0;function N_t(n,t){if(t==="float32"||t==="complex64")return n;if(t==="int32"||t==="bool"){const e=t==="int32"?new Int32Array(n.length):new Uint8Array(n.length);for(let r=0;r<e.length;++r)e[r]=Math.round(n[r]);return e}else throw new Error(`Unknown dtype ${t}`)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Yz()&&tU("webgl",()=>new Wb,2);/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dN=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;class Bc{constructor(t,e,r){this.variableNames=["A","B"],this.outputShape=Ee(e,r),this.enableShapeUniforms=ao(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${t}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uh=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;class Sd{constructor(t,e,r,o=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Ee(e,r);const a=this.outputShape.length;this.enableShapeUniforms=ao(a);let i="";if(o)if(a===0||It(this.outputShape)===1)i=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(i=`
          ${pn(a)} coords = getOutputCoords();
        `,a===1)this.enableShapeUniforms?i+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:i+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{const u=xo("coords",a);this.enableShapeUniforms?i+=`
            bool nextRowOutOfBounds =
              (${u[a-2]} + 1) >= outShape[${a} - 2];
            bool nextColOutOfBounds =
              (${u[a-1]} + 1) >= outShape[${a} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:i+=`
            bool nextRowOutOfBounds =
              (${u[a-2]} + 1) >= ${this.outputShape[a-2]};
            bool nextColOutOfBounds =
              (${u[a-1]} + 1) >= ${this.outputShape[a-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${t}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${i}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zo(n){const{inputs:t,backend:e}=n,{x:r}=t;return e.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}const A_t={kernelName:dg,backendName:"webgl",kernelFunc:Zo};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nl(n){const{inputs:t,backend:e}=n,{real:r,imag:o}=t,a=e.makeTensorInfo(r.shape,"complex64"),i=e.texData.get(a.dataId),s=Zo({inputs:{x:r},backend:e}),u=Zo({inputs:{x:o},backend:e});return i.complexTensorInfos={real:s,imag:u},a}const __t={kernelName:XI,backendName:"webgl",kernelFunc:Nl};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m6="return (a < 0.) ? b * a : a;",g6=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function D_t(n){const{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{alpha:a}=r,i=e.makeTensorInfo([],"float32",wl(a,"float32")),s=yt().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Sd(g6,o.shape,i.shape):new Bc(m6,o.shape,i.shape),u=e.runWebGLProgram(s,[o,i],"float32");return e.disposeIntermediateTensorInfo(i),u}const $_t={kernelName:M1,backendName:"webgl",kernelFunc:D_t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const v6="return (a < 0.) ? b * a : a;",x6=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function O_t(n){const{inputs:t,backend:e}=n,{x:r,alpha:o}=t,a=yt().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Sd(x6,r.shape,o.shape):new Bc(v6,r.shape,o.shape);return e.runWebGLProgram(a,[r,o],"float32")}const F_t={kernelName:eb,backendName:"webgl",kernelFunc:O_t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ed="if (isnan(x)) return x;";function Ve({opSnippet:n,packedOpSnippet:t,cpuKernelImpl:e,dtype:r}){return({inputs:o,backend:a})=>{const{x:i}=o,s=a,u=r||i.dtype;if(s.shouldExecuteOnCPU([i])&&e!=null){const h=s.texData.get(i.dataId),d=e(h.values,u);return s.makeTensorInfo(i.shape,u,d)}const l=yt().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&t!=null;let c;return l?c=new Ku(i.shape,t):c=new ji(i.shape,n),s.runWebGLProgram(c,[i],u)}}function Hr({opSnippet:n,packedOpSnippet:t,checkOutOfBounds:e=!1,supportsComplex:r=!1,cpuKernelImpl:o,dtype:a}){return({inputs:i,backend:s})=>{const{a:u,b:l}=i,c=s;if(r&&u.dtype==="complex64"){const g=c.texData.get(u.dataId),x=c.texData.get(l.dataId),[y,b]=[[g.complexTensorInfos.real,x.complexTensorInfos.real],[g.complexTensorInfos.imag,x.complexTensorInfos.imag]].map(E=>{const[S,k]=E,R={dataId:S.dataId,dtype:S.dtype,shape:u.shape},A={dataId:k.dataId,dtype:k.dtype,shape:l.shape},N=new Bc(n,u.shape,l.shape);return c.runWebGLProgram(N,[R,A],Yo(S.dtype,k.dtype))}),C=Nl({inputs:{real:y,imag:b},backend:c});return c.disposeIntermediateTensorInfo(y),c.disposeIntermediateTensorInfo(b),C}const h=a||Yo(u.dtype,l.dtype);if((u.dtype==="string"||l.dtype==="string"||c.shouldExecuteOnCPU([u,l]))&&o!=null){const g=c.texData.get(u.dataId).values,x=c.texData.get(l.dataId).values,y=u.dtype==="string"?Zs(g):g,b=u.dtype==="string"?Zs(x):x,[C,E]=o(u.shape,l.shape,y,b,h),S=c.makeTensorInfo(E,h),k=c.texData.get(S.dataId);return k.values=C,S}const d=yt().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&t!=null;let p;return d?p=new Sd(t,u.shape,l.shape,e):p=new Bc(n,u.shape,l.shape),c.runWebGLProgram(p,[u,l],h)}}function vm(n,t=!1){if(n==="linear")return t?g_t:h_t;if(n==="relu")return t?x_t:d_t;if(n==="elu")return t?v_t:f_t;if(n==="relu6")return t?y_t:p_t;if(n==="prelu")return t?x6:v6;if(n==="leakyrelu")return t?g6:m6;if(n==="sigmoid")return t?b_t:m_t;throw new Error(`Activation ${n} has not been implemented for the WebGL backend.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class y6{constructor(t,e,r,o=!1,a=!1,i=!1,s=null,u=!1,l=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r,this.enableShapeUniforms=ao(this.outputShape.length);const c=o?t[1]:t[2],h=Math.ceil(c/2),d=o?"i * 2, rc.y":"rc.y, i * 2",p=a?"rc.z, i * 2":"i * 2, rc.z",g=o?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],x=a?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let y="",b="";s&&(u?y=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:l?y=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:y=`vec4 activation(vec4 x) {
          ${s}
        }`,b="result = activation(result);");const C=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),u&&this.variableNames.push("preluActivationWeights"),l&&this.variableNames.push("leakyreluAlpha");let E="rc.x",S="rc.x";t[0]<e[0]?E=`imod(rc.x, ${t[0]})`:e[0]<t[0]&&(S=`imod(rc.x, ${e[0]})`),this.userCode=`
      ${y}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${h}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = ${E};
        int batchB = ${S};
        for (int i = 0; i < ${h}; i++) {
          vec4 a = getMatrixA(batchA, ${d});
          vec4 b = getMatrixB(batchB, ${p});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${g[0]} * ${x[0]});
          result += (${g[1]} * ${x[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${C}

        ${b}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jF={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class XF{constructor(t,e,r){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Ee(e,r),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${t}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KF="return a * b;";function pN(n){const{inputs:t,backend:e}=n,{a:r,b:o}=t,a=Yo(r.dtype,o.dtype);if(r.dtype==="complex64"){const s=e.texData.get(r.dataId),u=e.texData.get(o.dataId),l=new XF(jF.REAL,r.shape,o.shape),c=new XF(jF.IMAG,r.shape,o.shape),h=[{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:r.shape},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:r.shape},{dataId:u.complexTensorInfos.real.dataId,dtype:u.complexTensorInfos.real.dtype,shape:o.shape},{dataId:u.complexTensorInfos.imag.dataId,dtype:u.complexTensorInfos.imag.dtype,shape:o.shape}],d=e.runWebGLProgram(l,h,"float32"),p=e.runWebGLProgram(c,h,"float32"),g=Nl({inputs:{real:d,imag:p},backend:e});return e.disposeIntermediateTensorInfo(d),e.disposeIntermediateTensorInfo(p),g}if(e.shouldExecuteOnCPU([r,o])){const s=e.texData.get(r.dataId),u=e.texData.get(o.dataId),[l,c]=OAt(r.shape,o.shape,s.values,u.values,a),h=e.makeTensorInfo(c,a),d=e.texData.get(h.dataId);return d.values=l,h}let i;return yt().getBool("WEBGL_PACK_BINARY_OPERATIONS")?i=new Sd(KF,r.shape,o.shape):i=new Bc(KF,r.shape,o.shape),e.runWebGLProgram(i,[r,o],a)}const M_t={kernelName:Cg,backendName:"webgl",kernelFunc:pN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L_t(n,t,e){const r=[Yf(n.shape),...Qf(n.shape)],o={dtype:n.dtype,shape:r,dataId:n.dataId},a=[Yf(t),...Qf(t)],i=new p6(a,r),s=!0,u=[r],l=e.runWebGLProgram(i,[o],n.dtype,u,s);return{dataId:l.dataId,shape:t,dtype:l.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wt(n){const{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{shape:a}=r,i=e,s=It(o.shape),u=lz(a,s),l=It(u);H(s===l,()=>`The new shape (${u}) has ${l} elements and the old shape (${o.shape}) has ${s} elements. The new shape and old shape must have the same number of elements.`);const c=i.texData.get(o.dataId);return c.isPacked&&!Uy(o.shape,u)&&!(c.texture!==null&&Uy(c.shape,u))?L_t(o,u,i):(i.incRef(o.dataId),{dataId:o.dataId,shape:u,dtype:o.dtype})}const P_t={kernelName:rb,backendName:"webgl",kernelFunc:Wt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class YF{constructor(t,e){this.variableNames=["x"];const{windowSize:r,batchSize:o,inSize:a,outSize:i}=t;this.outputShape=[o,i];const s=Math.floor(r/4)*4,u=r%4;let l="sumValue += dot(values, ones);";if(e!=null){const h=1/e;l=`sumValue += dot(values * ${Uf(h)?h.toPrecision(2):h}, ones);`}let c="";a%r>0&&(c=`
        if (inIdx < 0 || inIdx >= ${a}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${c}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        float sumValue = 0.0;

        for (int i = 0; i < ${s}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${l}
        }

        int inIdx = inOffset + ${s};
        if (${u===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${l}
        } else if (${u===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${l}
        } else if (${u===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${l}
        }
        setOutput(sumValue);
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class B_t{constructor(t,e){this.variableNames=["x"];const{windowSize:r,batchSize:o,inSize:a,outSize:i}=t;this.outputShape=[o,i];let s="0.0",u="";e==="prod"?s="1.0":e==="min"?(s="1.0 / 1e-20",u="min"):e==="max"&&(s="-1.0 / 1e-20",u="max");let l=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;e==="sum"?l="sumValue":e==="prod"?l="prodValue":e==="all"?l="allValue":e==="any"&&(l="anyValue");const c=Math.floor(r/4)*4,h=r%4;let d=`
      if (${e==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${e==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${u}(values, minMaxValue);
        if (${e==="min"} || ${e==="max"}) {
          minMaxValue = ${u}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,p="vec4";e==="all"?(s="1.0",d=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,p="bvec4"):e==="any"&&(s="0.0",d=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,p="bvec4");let g="";a%r>0&&(g=`
        if (inIdx < 0 || inIdx >= ${a}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${s};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${g}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        vec4 minMaxValue = vec4(${s});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${c}; i += 4) {
          int inIdx = inOffset + i;
          ${p} values = ${p}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${d}
        }

        int inIdx = inOffset + ${c};
        if (${h===1}) {
          ${p} values = ${p}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${d}
        } else if (${h===2}) {
          ${p} values = ${p}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${d}
        } else if (${h===3}) {
          ${p} values = ${p}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${d}
        }
        setOutput(${l});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z_t(n){const t=[];for(;t.length===0||t[t.length-1].outSize!==1;){const e=t.length?t[t.length-1].outSize:n[1],r=Ib(e);t.push({inSize:e,windowSize:r,outSize:Math.ceil(e/r)})}return t}function lh(n,t,e,r){const o=z_t(n.shape);let a=n;for(let i=0;i<o.length;i++){const{inSize:s,windowSize:u,outSize:l}=o[i];let c,h;e==="mean"?c=i===0?new YF({windowSize:u,inSize:s,batchSize:n.shape[0],outSize:l},s):new YF({windowSize:u,inSize:s,batchSize:n.shape[0],outSize:l}):c=new B_t({windowSize:u,inSize:s,batchSize:n.shape[0],outSize:l},e),h=a,a=r.runWebGLProgram(c,[a],t),h.dataId!==n.dataId&&r.disposeIntermediateTensorInfo(h)}return a}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class U_t{constructor(t,e){this.variableNames=["A"];const r=new Array(t.length);for(let i=0;i<r.length;i++)r[i]=t[e[i]];this.outputShape=r,this.rank=r.length;const o=pn(this.rank),a=W_t(e);this.userCode=`
    void main() {
      ${o} resRC = getOutputCoords();
      setOutput(getA(${a}));
    }
    `}}function W_t(n){const t=n.length;if(t>6)throw Error(`Transpose for rank ${t} is not yet supported`);const e=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t);for(let o=0;o<n.length;o++)r[n[o]]=e[o];return r.join()}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class V_t{constructor(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const r=new Array(t.length);for(let c=0;c<r.length;c++)r[c]=t[e[c]];if(this.outputShape=r,this.rank=r.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const o=pn(this.rank),a=d6("rc",this.rank),i=new Array(this.rank);for(let c=0;c<e.length;c++)i[e[c]]=a[c];const s=`vec2(${i.slice(-2).join()})`,u=`++${a[this.rank-1]} < ${r[this.rank-1]}`,l=`getChannel(getA(${i.join()}), ${s})`;this.userCode=`
    void main() {
      ${o} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${l};
      if(${u}) {
        result[1] = ${l};
      }
      --${a[this.rank-1]};
      if(++${a[this.rank-2]} < ${r[this.rank-2]}) {
        result[2] = ${l};
        if(${u}) {
          result[3] = ${l};
        }
      }
      setOutput(result);
    }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vb(n,t,e){const r=yt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new V_t(n.shape,t):new U_t(n.shape,t);return e.runWebGLProgram(r,[n],n.dtype)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G_t(n,t,e,r){const o=t,a=n.shape.length,i=_e(o,n.shape);let s=i;const u=Pn(s,a),l=u!=null;let c=n;l&&(c=Vb(n,u,r),s=er(s.length,a)),Gr("sum",s,a);const[h,d]=Dr(c.shape,s);let p=h;e&&(p=lr(h,i));const g=It(d),y=It(n.shape)/g,b=Wt({inputs:{x:c},attrs:{shape:[y,g]},backend:r}),C=TR(n.dtype),E=lh(b,C,"sum",r),S=Wt({inputs:{x:E},attrs:{shape:p},backend:r});return r.disposeIntermediateTensorInfo(b),r.disposeIntermediateTensorInfo(E),l&&r.disposeIntermediateTensorInfo(c),S}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gb(n){const{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{axis:a,keepDims:i}=r;return G_t(o,a,i,e)}const H_t={kernelName:lb,backendName:"webgl",kernelFunc:Gb};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Co(n){const{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{perm:a}=r,i=e,s=o.shape.length,u=new Array(s);for(let c=0;c<u.length;c++)u[c]=o.shape[a[c]];let l;if(i.shouldExecuteOnCPU([o])){const h=i.texData.get(o.dataId).values,d=fN(h,o.shape,o.dtype,a,u);l=i.makeTensorInfo(u,o.dtype);const p=i.texData.get(l.dataId);p.values=d}else l=Vb(o,a,i);return l}const q_t={kernelName:If,backendName:"webgl",kernelFunc:Co};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const b6=1e3;function Wy({a:n,b:t,transposeA:e,transposeB:r,backend:o,bias:a=null,preluActivationWeights:i=null,leakyreluAlpha:s=0,activation:u=null}){const l=n.shape.length,c=t.shape.length,h=e?n.shape[l-2]:n.shape[l-1],d=r?t.shape[c-1]:t.shape[c-2],p=e?n.shape[l-1]:n.shape[l-2],g=r?t.shape[c-2]:t.shape[c-1],x=n.shape.slice(0,-2),y=t.shape.slice(0,-2),b=It(x),C=It(y),S=Ee(n.shape.slice(0,-2),t.shape.slice(0,-2)).concat([p,g]);H(h===d,()=>`Error in matMul: inner shapes (${h}) and (${d}) of Tensors with shapes ${n.shape} and ${t.shape} and transposeA=${e} and transposeB=${r} must match.`);const k=e?[b,h,p]:[b,p,h],R=r?[C,g,d]:[C,d,g],A=Wt({inputs:{x:n},backend:o,attrs:{shape:k}}),N=Wt({inputs:{x:t},backend:o,attrs:{shape:R}}),_=[A,N],$=Math.max(b,C),D=e?A.shape[1]:A.shape[2],O=a!=null,P=i!=null,z=u==="leakyrelu",W=u!=null?vm(u,!0):null,F=O||P||z||W!=null;let B;if((p===1||g===1)&&D>b6&&F===!1){let q=A,M=N;e&&(q=Co({inputs:{x:A},backend:o,attrs:{perm:[0,2,1]}}),_.push(q)),r&&(M=Co({inputs:{x:N},backend:o,attrs:{perm:[0,2,1]}}),_.push(M));const G=g!==1,Q=g===1;let Z=q;G&&(Z=Wt({inputs:{x:q},backend:o,attrs:{shape:[$,D,1]}}),_.push(Z));const rt=g===1?2:1;let ct=M;Q&&(ct=Wt({inputs:{x:M},backend:o,attrs:{shape:[$,1,D]}}),_.push(ct));const pt=pN({inputs:{a:Z,b:ct},backend:o});B=Gb({inputs:{x:pt},backend:o,attrs:{axis:rt,keepDims:!0}}),_.push(pt)}else{const q=Yo(n.dtype,t.dtype),M=new y6(k,R,[$,p,g],e,r,O,W,P,z),G=[A,N];if(a!=null&&G.push(a),P&&G.push(i),z){const Q=o.makeTensorInfo([],"float32",wl(s,"float32"));G.push(Q),_.push(Q)}B=o.runWebGLProgram(M,G,q)}const U=Wt({inputs:{x:B},backend:o,attrs:{shape:S}});_.push(B);for(const q of _)o.disposeIntermediateTensorInfo(q);return U}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j_t(n){const{inputs:t,backend:e,attrs:r}=n,{a:o,b:a,bias:i,preluActivationWeights:s}=t,{transposeA:u,transposeB:l,activation:c,leakyreluAlpha:h}=r;return Wy({a:o,b:a,transposeA:u,transposeB:l,backend:e,bias:i,preluActivationWeights:s,leakyreluAlpha:h,activation:c})}const X_t={kernelName:xy,backendName:"webgl",kernelFunc:j_t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QF="return abs(x);";function K_t(n){const{inputs:t,backend:e}=n,{x:r}=t;if(e.shouldExecuteOnCPU([r])&&r.dtype!=="complex64"){const a=e.texData.get(r.dataId),i=h6(a.values);return e.makeTensorInfo(r.shape,r.dtype,i)}let o;return yt().getBool("WEBGL_PACK_UNARY_OPERATIONS")?o=new Ku(r.shape,QF):o=new ji(r.shape,QF),e.runWebGLProgram(o,[r],r.dtype)}const Y_t={kernelName:g1,backendName:"webgl",kernelFunc:K_t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q_t=Za+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,Z_t=Ve({opSnippet:Q_t}),J_t={kernelName:jm,backendName:"webgl",kernelFunc:Z_t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tDt=Za+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,eDt=Ve({opSnippet:tDt}),nDt={kernelName:Xm,backendName:"webgl",kernelFunc:eDt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZF="return a + b;",rDt=Hr({opSnippet:ZF,packedOpSnippet:ZF,supportsComplex:!0,cpuKernelImpl:dAt}),oDt={kernelName:hd,backendName:"webgl",kernelFunc:rDt};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aDt{constructor(t,e){this.outputShape=[],this.outputShape=t,this.variableNames=e.map((a,i)=>`T${i}`);const r=[];this.variableNames.forEach(a=>{r.push(`float v${a} = get${a}AtOutCoords();`)});const o=this.variableNames.map(a=>`v${a}`).join(" + ");this.userCode=`
      void main() {
        ${r.join(`
        `)}

        float result = ${o};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class iDt{constructor(t,e){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.variableNames=e.map((a,i)=>`T${i}`);const r=[];this.variableNames.forEach(a=>{r.push(`vec4 v${a} = get${a}AtOutCoords();`)});const o=this.variableNames.map(a=>`v${a}`).join(" + ");this.userCode=`
      void main() {
        ${r.join(`
        `)}

        vec4 result = ${o};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D0(n){const{inputs:t,backend:e}=n,r=t;if(r.length===1)return Zo({inputs:{x:r[0]},backend:e});if(r.length>yt().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const u=Math.floor(r.length/2),l=D0({inputs:r.slice(0,u),backend:e}),c=D0({inputs:r.slice(u),backend:e});return D0({inputs:[l,c],backend:e})}const o=r.map(u=>u.dtype).reduce((u,l)=>Yo(u,l)),a=r.map(u=>u.shape),s=yt().getBool("WEBGL_PACK")?new iDt(r[0].shape,a):new aDt(r[0].shape,a);return e.runWebGLProgram(s,r,o)}const sDt={kernelName:UI,backendName:"webgl",kernelFunc:D0};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uDt(n){const{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{axis:a,keepDims:i}=r,s=o.shape.length,u=_e(a,o.shape);let l=u;const c=Pn(l,s);let h=o;c!=null&&(h=Co({inputs:{x:o},backend:e,attrs:{perm:c}}),l=er(l.length,s)),Gr("all",l,s);const[d,p]=Dr(h.shape,l),g=It(p),x=Wt({inputs:{x:h},backend:e,attrs:{shape:[-1,g]}}),y=lh(x,x.dtype,"all",e);let b;if(i){const C=lr(d,u);b=Wt({inputs:{x:y},backend:e,attrs:{shape:C}})}else b=Wt({inputs:{x:y},backend:e,attrs:{shape:d}});return e.disposeIntermediateTensorInfo(x),e.disposeIntermediateTensorInfo(y),c!=null&&e.disposeIntermediateTensorInfo(h),b}const lDt={kernelName:WI,backendName:"webgl",kernelFunc:uDt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cDt(n){const{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{axis:a,keepDims:i}=r,s=o.shape.length,u=_e(a,o.shape);let l=u;const c=Pn(l,s);let h=o;c!=null&&(h=Co({inputs:{x:o},backend:e,attrs:{perm:c}}),l=er(l.length,s)),Gr("any",l,s);const[d,p]=Dr(h.shape,l),g=It(p),x=Wt({inputs:{x:h},backend:e,attrs:{shape:[-1,g]}}),y=lh(x,x.dtype,"any",e);let b;if(i){const C=lr(d,u);b=Wt({inputs:{x:y},backend:e,attrs:{shape:C}})}else b=Wt({inputs:{x:y},backend:e,attrs:{shape:d}});return e.disposeIntermediateTensorInfo(x),e.disposeIntermediateTensorInfo(y),c!=null&&e.disposeIntermediateTensorInfo(h),b}const hDt={kernelName:VI,backendName:"webgl",kernelFunc:cDt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fDt{constructor(t,e,r){this.variableNames=["A"];const{windowSize:o,batchSize:a,outSize:i}=t;r||this.variableNames.push("bestIndicesA"),this.outputShape=[a,i];const s=e==="max"?">":"<",u=r?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${o};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${o}; i++) {
          int inIdx = ${u};
          float candidate = getA(batch, inIdx);
          if (candidate ${s} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dDt{constructor(t,e,r,o){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,H(t.length>2,()=>`Packed arg${r.charAt(0).toUpperCase()+r.slice(1)} supports only inputs with rank above 2.`);const a=t[t.length-1],i=Math.ceil(a/e);this.outputShape=t.slice(0,-1),i>1&&this.outputShape.push(i),o||this.variableNames.push("bestIndicesA");const s=this.outputShape,u=s.length,l=pn(u),c=xo("coords",u);let h,d;if(i===1){d=u+1;const N=pn(d);h=`
        ${N} sourceLocR = ${N}(${c.join()}, 0);
        ++${c[u-1]};
        ${N} sourceLocG = ${N}(${c.join()}, 0);
        ++${c[u-2]};
        ${N} sourceLocA = ${N}(${c.join()}, 0);
        --${c[u-1]};
        ${N} sourceLocB = ${N}(${c.join()}, 0);
        --${c[u-2]};`}else d=u,h=`
        ${l} sourceLocR = coords;
        ++${c[u-1]};
        ${l} sourceLocG = coords;
        ++${c[u-2]};
        ${l} sourceLocA = coords;
        --${c[u-1]};
        ${l} sourceLocB = coords;
        --${c[u-2]};`;const p=["x","y","z","w","u","v"].slice(0,d),g="."+p[d-1],x=p.map(N=>"int "+N),y=xo("sourceLocR",d-1).concat("inIdx.r"),b=xo("sourceLocG",d-1).concat("inIdx.g"),C=xo("sourceLocB",d-1).concat("inIdx.b"),E=xo("sourceLocA",d-1).concat("inIdx.a"),S=r==="max"?"greaterThan":"lessThan",k=o?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${y.join()}),
                             getBestIndicesAChannel(${b.join()}),
                             getBestIndicesAChannel(${C.join()}),
                             getBestIndicesAChannel(${E.join()})));`,R=`vec4(
            getAChannel(${y.join()}),
            hasNextCol ? getAChannel(${b.join()}) : 0.,
            hasNextRow ? getAChannel(${C.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${E.join()}) : 0.)`,A=o?"":`
      float getBestIndicesAChannel(${x.join()}) {
        return getChannel(getBestIndicesA(${p.join()}),
                                          vec2(${p.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${x.join()}) {
        return getChannel(getA(${p.join()}),
                               vec2(${p.slice(-2).join()}));
      }
      ${A}
      void main() {
        ${l} coords = getOutputCoords();
        bool hasNextCol = ${c[u-1]} < ${s[u-1]-1};
        bool hasNextRow = ${c[u-2]} < ${s[u-2]-1};
        ${h}
        ivec4 srcIdx = ivec4(sourceLocR${g}, sourceLocG${g},
          sourceLocB${g}, sourceLocA${g}) * ${e};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${R};

        for (int i = 0; i < ${e}; i++) {
          inIdx = srcIdx;
          ${k}
          vec4 candidate = ${R};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${S}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w6(n,t,e,r=null){let o=t.shape[0],a=t.shape[1];r!=null&&(o=r.shape[0],a=r.shape[1]);const i=Ib(a),s={windowSize:i,inSize:a,batchSize:o,outSize:Math.ceil(a/i)},u=new fDt(s,e,r==null),l=[t];r!=null&&l.push(r);const c=n.runWebGLProgram(u,l,"int32");if(c.shape[1]===1)return c;const h=w6(n,t,e,c);return n.disposeIntermediateTensorInfo(c),h}function C6(n,t,e,r=null){const o=r!=null?r.shape:t.shape,a=o[o.length-1],i=Ib(a),s=new dDt(o,i,e,r==null),u=r==null?[t]:[t,r],l=n.runWebGLProgram(s,u,"int32");if(l.shape.length===t.shape.length){const c=C6(n,t,e,l);return n.disposeIntermediateTensorInfo(l),c}return l}function S6(n,t,e,r){const o=[e];if(Gr("arg"+r.charAt(0).toUpperCase()+r.slice(1),o,t.shape.length),!yt().getBool("WEBGL_PACK_REDUCE")||t.shape.length<=2){const a=[],i=n.texData.get(t.dataId),s=i!==null&&i.isPacked;let u=t;s&&(u=n.unpackTensor(t),a.push(u));const[l,c]=Dr(u.shape,o),h=It(c),d=Wt({inputs:{x:u},backend:n,attrs:{shape:[-1,h]}});a.push(d);const p=w6(n,d,r);a.push(p);const g=Wt({inputs:{x:p},backend:n,attrs:{shape:l}});return a.forEach(x=>n.disposeIntermediateTensorInfo(x)),g}return C6(n,t,r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pDt(n){const{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{axis:a}=r;let i=_e(a,o.shape);const s=Pn(i,o.shape.length);let u=o;const l=[];s!=null&&(u=Co({inputs:{x:o},backend:e,attrs:{perm:s}}),l.push(u),i=er(i.length,u.shape.length)),Gr("argMax",[i[0]],u.shape.length);const c=S6(e,u,i[0],"max");return l.forEach(h=>e.disposeIntermediateTensorInfo(h)),c}const mDt={kernelName:v1,backendName:"webgl",kernelFunc:pDt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gDt(n){const{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{axis:a}=r;let i=_e(a,o.shape);const s=Pn(i,o.shape.length);let u=o;const l=[];s!=null&&(u=Co({inputs:{x:o},backend:e,attrs:{perm:s}}),l.push(u),i=er(i.length,u.shape.length)),Gr("argMin",[i[0]],u.shape.length);const c=S6(e,u,i[0],"min");return l.forEach(h=>e.disposeIntermediateTensorInfo(h)),c}const vDt={kernelName:x1,backendName:"webgl",kernelFunc:gDt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xDt=Za+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,yDt=Ve({opSnippet:xDt}),bDt={kernelName:Km,backendName:"webgl",kernelFunc:yDt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wDt=Za+"return log(x + sqrt(x * x + 1.0));",CDt=Ve({opSnippet:wDt}),SDt={kernelName:Ym,backendName:"webgl",kernelFunc:CDt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EDt=Za+`
  return atan(x);
`,kDt=Ve({opSnippet:EDt}),IDt={kernelName:Qm,backendName:"webgl",kernelFunc:kDt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RDt=dN+`
  return atan(a, b);
`,TDt=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+uh+`
  return result;
`,NDt=Hr({opSnippet:RDt,packedOpSnippet:TDt}),ADt={kernelName:Jm,backendName:"webgl",kernelFunc:NDt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _Dt=Za+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,DDt=Ve({opSnippet:_Dt}),$Dt={kernelName:Zm,backendName:"webgl",kernelFunc:DDt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xm{constructor(t,e,r,o=!1,a=!1){if(this.variableNames=["x"],e==="avg"&&r)throw new Error("Cannot compute positions for average pool.");const i=t.filterWidth,s=t.strideHeight,u=t.strideWidth,l=t.dilationHeight,c=t.dilationWidth,h=t.effectiveFilterHeight,d=t.effectiveFilterWidth,p=t.padInfo.top,g=t.padInfo.left;this.outputShape=t.outShape;const x=e==="avg",y=`((batch  * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + d`,b=`(xR * ${t.inWidth} + xC) * ${t.inChannels} + d`;let C="0.0";if(x||(C="-1.0 / 1e-20"),r){const N=">=";this.userCode=`
        const ivec2 strides = ivec2(${s}, ${u});
        const ivec2 pads = ivec2(${p}, ${g});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${h};
              wR += ${l}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${d};
                wC += ${c}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${t.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${N} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${o?a?y:b:`wR * ${d} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const E="max";let S=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;e==="avg"&&(S="avgValue / max(count, 1.0)");const k=Math.floor(i/4)*4,R=i%4,A=`
      if (${x}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${E}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${s}, ${u});
      const ivec2 pads = ivec2(${p}, ${g});
      const float initializationValue = ${C};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${t.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${C});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${h};
            wR += ${l}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${t.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${k}; wC += 4) {
            int xC = xCCorner + wC * ${c};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${c}, d),
              getValue(batch, xR, xC + 2 * ${c}, d),
              getValue(batch, xR, xC + 3 * ${c}, d)
            );

            ${A}
          }

          int xC = xCCorner + ${k};
          if (${R===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${A}
          } else if (${R===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${c}, d),
              initializationValue,
              initializationValue
            );

            ${A}
          } else if (${R===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${c}, d),
              getValue(batch, xR, xC + 2 * ${c}, d),
              initializationValue
            );

            ${A}
          }
        }
        setOutput(${S});
      }
    `}}class mN{constructor(t,e,r,o=!1,a=!1){if(this.variableNames=["x"],e==="avg"&&r)throw new Error("Cannot compute positions for average pool.");const i=t.filterWidth,s=t.strideDepth,u=t.strideHeight,l=t.strideWidth,c=t.dilationDepth,h=t.dilationHeight,d=t.dilationWidth,p=t.effectiveFilterDepth,g=t.effectiveFilterHeight,x=t.effectiveFilterWidth,y=t.padInfo.front,b=t.padInfo.top,C=t.padInfo.left;this.outputShape=t.outShape;const E=e==="avg";let S="0.0";if(E||(S="-1.0 / 1e-20"),r){const $=">=";this.userCode=`
        const ivec3 strides =
            ivec3(${s}, ${u}, ${l});
        const ivec3 pads = ivec3(${y}, ${b}, ${C});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${p};
              wD += ${c}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${t.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${g};
                wR += ${h}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${t.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${x};
                  wC += ${d}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${t.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${$} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${o?a?`(((batch * ${t.inDepth} + xD) * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + ch`:`((xD * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + ch`:`wD * ${g} * ${x} +
                      wR * ${x} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const k="max";let R=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;e==="avg"&&(R="avgValue / max(count, 1.0)");const A=Math.floor(i/4)*4,N=i%4,_=`
      if (${E}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${k}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${s}, ${u}, ${l});
      const ivec3 pads = ivec3(${y}, ${b}, ${C});
      const float initializationValue = ${S};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${t.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${S});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${p};
            wD += ${c}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${t.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${g};
            wR += ${h}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${A}; wC += 4) {
              int xC = xCCorner + wC * ${d};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${d}, ch),
                getValue(batch, xD, xR, xC + 2 * ${d}, ch),
                getValue(batch, xD, xR, xC + 3 * ${d}, ch)
              );

              ${_}
            }

            int xC = xCCorner + ${A};
            if (${N===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${_}
            } else if (${N===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${d}, ch),
                initializationValue,
                initializationValue
              );

              ${_}
            } else if (${N===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${d}, ch),
                getValue(batch, xD, xR, xC + 2 * ${d}, ch),
                initializationValue
              );

              ${_}
            }
          }
        }
        setOutput(${R});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ODt(n){const{inputs:t,backend:e,attrs:r}=n,{x:o}=t;iv(o,"avgPool");const{filterSize:a,strides:i,pad:s,dimRoundingMode:u}=r,l=1;H(ro(i,l),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${l}'`);const c=Ya(o.shape,a,i,l,s,u);if(c.filterWidth===1&&c.filterHeight===1&&tn(c.inShape,c.outShape))return Zo({inputs:{x:o},backend:e});const h=new xm(c,"avg",!1);return e.runWebGLProgram(h,[o],"float32")}const FDt={kernelName:y1,backendName:"webgl",kernelFunc:ODt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MDt(n){const{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{filterSize:a,strides:i,pad:s,dimRoundingMode:u,dataFormat:l}=r,c=[1,1,1],h=hu(o.shape,a,i,c,s,u,l),d=new mN(h,"avg",!1);return e.runWebGLProgram(d,[o],"float32")}const LDt={kernelName:b1,backendName:"webgl",kernelFunc:MDt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class PDt{constructor(t){this.variableNames=["dy"],this.outputShape=t.inShape;const e=t.filterHeight,r=t.filterWidth,o=t.strideHeight,a=t.strideWidth,i=t.dilationHeight,s=t.dilationWidth,u=t.effectiveFilterHeight,l=t.effectiveFilterWidth,c=u-1-t.padInfo.top,h=l-1-t.padInfo.left,d=1/(e*r);this.userCode=`
      const ivec2 pads = ivec2(${c}, ${h});
      const float avgMultiplier = float(${d});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${u};
            wR += ${i}) {
          float dyR = float(dyRCorner + wR) / ${o}.0;

          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${l};
            wC+= ${s}) {
            float dyC = float(dyCCorner + wC) / ${a}.0;

            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}class BDt{constructor(t){this.variableNames=["dy"],this.outputShape=t.inShape;const e=t.filterDepth,r=t.filterHeight,o=t.filterWidth,a=t.strideDepth,i=t.strideHeight,s=t.strideWidth,u=t.dilationDepth,l=t.dilationHeight,c=t.dilationWidth,h=t.effectiveFilterDepth,d=t.effectiveFilterHeight,p=t.effectiveFilterWidth,g=h-1-t.padInfo.front,x=d-1-t.padInfo.top,y=p-1-t.padInfo.left,b=1/(e*r*o);this.userCode=`
      const ivec3 pads = ivec3(${g}, ${x}, ${y});
      const float avgMultiplier = float(${b});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${h};
            wD += ${u}) {
          float dyD = float(dyDCorner + wD) / ${a}.0;

          if (dyD < 0.0 || dyD >= ${t.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${d};
              wR += ${l}) {
            float dyR = float(dyRCorner + wR) / ${i}.0;

            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${p};
                wC += ${c}) {
              float dyC = float(dyCCorner + wC) / ${s}.0;

              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zDt(n){const{inputs:t,backend:e,attrs:r}=n,{dy:o,input:a}=t,i=a,{filterSize:s,strides:u,pad:l,dimRoundingMode:c}=r,h=[1,1,1],d=hu(i.shape,s,u,h,l,c),p=new BDt(d);return e.runWebGLProgram(p,[o],i.dtype)}const UDt={kernelName:HI,backendName:"webgl",kernelFunc:zDt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WDt(n){const{inputs:t,backend:e,attrs:r}=n,{dy:o,input:a}=t,i=a;iv([o,a],"avgPoolGrad");const{filterSize:s,strides:u,pad:l}=r,c=Ya(i.shape,s,u,1,l),h=new PDt(c);return e.runWebGLProgram(h,[o],i.dtype)}const VDt={kernelName:GI,backendName:"webgl",kernelFunc:WDt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GDt(n){const{inputs:t,backend:e,attrs:r}=n,{a:o,b:a}=t,{transposeA:i,transposeB:s}=r;return Wy({a:o,b:a,transposeA:i,transposeB:s,backend:e})}const HDt={kernelName:w1,backendName:"webgl",kernelFunc:GDt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qDt{constructor(t,e,r,o,a,i){this.outputShape=[],this.variableNames=["x","mean","variance"],Ee(t,e),Ee(t,r);let s="0.0";o!=null&&(Ee(t,o),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");let u="1.0";a!=null&&(Ee(t,a),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=t,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${s};
        float scale = ${u};
        float inv = scale * inversesqrt(variance + float(${i}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jDt{constructor(t,e,r,o,a,i){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Ee(t,e),Ee(t,r);let s="vec4(0.0)";o!=null&&(Ee(t,o),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");let u="vec4(1.0)";a!=null&&(Ee(t,a),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=t,this.userCode=`
      void main() {
        vec4 offset = ${s};
        vec4 scale = ${u};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${i}));

        setOutput((x - mean) * inv + offset);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XDt=({inputs:n,backend:t,attrs:e})=>{const{x:r,mean:o,variance:a,offset:i,scale:s}=n;H(o.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),H(i==null||o.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),H(s==null||o.shape.length===s.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:u}=e;u==null&&(u=.001);const l=[r,o,a];let c=null;i!=null&&(c=i.shape,l.push(i));let h=null;s!=null&&(h=s.shape,l.push(s));const d=yt().getBool("WEBGL_PACK_NORMALIZATION")?new jDt(r.shape,o.shape,a.shape,c,h,u):new qDt(r.shape,o.shape,a.shape,c,h,u);return t.runWebGLProgram(d,l,l[0].dtype)},KDt={kernelName:$1,backendName:"webgl",kernelFunc:XDt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class YDt{constructor(t){this.variableNames=["source"],this.outputShape=t,this.rank=t.length;const e=pn(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const r=QDt(this.rank);let o;const a=t.map((i,s)=>`sourceLoc.${ZE[s]} = start[${s}] + coords.${ZE[s]};`);o=`
        ${e} sourceLoc;
        ${e} coords = getOutputCoords();
        ${a.join(`
`)}
      `,this.userCode=`
      void main() {
        ${o}
        setOutput(getSource(${r}));
      }
    `}}const ZE=["x","y","z","w","u","v"];function QDt(n){if(n===1)return"sourceLoc";if(n<=6)return ZE.slice(0,n).map(t=>"sourceLoc."+t).join(",");throw Error(`Slicing for rank ${n} is not yet supported`)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ZDt{constructor(t){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const e=pn(this.rank),r=xo("coords",this.rank),o=xo("sourceLoc",this.rank),a=this.rank===1?"sourceLoc":`vec2(${o.slice(-2).join()})`,i=`getChannel(getSource(${o.join()}), ${a})`,s=`
      result.x = ${i};
      if (++${r[this.rank-1]} < ${t[this.rank-1]}) {
        ++${o[this.rank-1]};
        result.y = ${i};
        --${o[this.rank-1]};
      }
    `,u=this.rank===1?"":`
      --${r[this.rank-1]};
      if (++${r[this.rank-2]} < ${t[this.rank-2]}) {
        ++${o[this.rank-2]};
        result.z = ${i};
        if (++${r[this.rank-1]} < ${t[this.rank-1]}) {
          ++${o[this.rank-1]};
          result.w = ${i};
        }
      }
    `,l=this.rank<=4?`sourceLoc = coords +
            ${e}(${t.map((c,h)=>`start[${h}]`).join()});`:t.map((c,h)=>`${o[h]} = ${r[h]} + start[${h}];`).join(`
`);this.userCode=`
      void main() {
        ${e} coords = getOutputCoords();
        ${e} sourceLoc;
        ${l}
        vec4 result = vec4(0.);
        ${s}
        ${u}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JDt(n,t,e,r){const o=r.texData.get(n.dataId),a=r.makeTensorInfo(e,n.dtype),i=r.texData.get(a.dataId);Object.assign(i,o),i.refCount=1,i.shape=e,i.dtype=n.dtype;let s=cT(t,ue(n.shape));o.slice&&(s+=o.slice.flatOffset),i.slice={flatOffset:s,origDataId:o.slice&&o.slice.origDataId||n.dataId};const u=r.dataRefCount.get(i.slice.origDataId)||1;return r.dataRefCount.set(i.slice.origDataId,u+1),a}function kd(n){const{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{begin:a,size:i}=r,[s,u]=kb(o,a,i);if(sT(o,s,u),It(u)===0)return e.makeTensorInfo(u,o.dtype,[]);if(e.shouldExecuteOnCPU([o])||o.dtype==="string"){const h=e.texData.get(o.dataId),d=HAt(h.values,s,u,o.shape,o.dtype);return e.makeTensorInfo(u,o.dtype,d)}const{isPacked:l}=e.texData.get(o.dataId),c=lT(o.shape,s,u);if(l||!c){const h=yt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new ZDt(u):new YDt(u),d=[s];return e.runWebGLProgram(h,[o],o.dtype,d)}return e.uploadToGPU(o.dataId),JDt(o,s,u,e)}const t$t={kernelName:ub,backendName:"webgl",kernelFunc:kd};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const e$t=n=>{const{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{blockShape:a,crops:i}=r;H(o.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const s=a.reduce((C,E)=>C*E),u=jg(o.shape,a,s),l=Xg(u.length,a.length),c=Kg(o.shape,a,s),h=mT(i,a.length),d=gT(c,i,a.length),p=[],g=Wt({inputs:{x:o},backend:e,attrs:{shape:u}}),x=Co({inputs:{x:g},backend:e,attrs:{perm:l}}),y=Wt({inputs:{x},backend:e,attrs:{shape:c}}),b=kd({inputs:{x:y},backend:e,attrs:{begin:h,size:d}});return p.push(g),p.push(x),p.push(y),p.forEach(C=>e.disposeIntermediateTensorInfo(C)),b},n$t={kernelName:C1,backendName:"webgl",kernelFunc:e$t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r$t(n){const{inputs:t,backend:e,attrs:r}=n,{x:o,weights:a}=t,{size:i}=r,s=e.readSync(o.dataId),u=e.readSync(a.dataId),l=c6(s,u,a.dtype,a.shape,i);return e.makeTensorInfo([i],a.dtype,l)}const o$t={kernelName:qI,backendName:"webgl",kernelFunc:r$t};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const a$t=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,i$t=`
  return float(int(a.r) & int(b.r));
`;function s$t(n){const{inputs:t,backend:e}=n,{a:r,b:o}=t,a=yt().getBool("WEBGL_PACK_BINARY_OPERATIONS"),i=yt().getNumber("WEBGL_VERSION");if(e.shouldExecuteOnCPU([r,o])||i===1){const u=e.texData.get(r.dataId).values,l=e.texData.get(o.dataId).values,[c,h]=mAt(r.shape,o.shape,u,l,r.dtype),d=e.makeTensorInfo(h,r.dtype),p=e.texData.get(d.dataId);return p.values=c,d}let s;return a?s=new Sd(a$t,r.shape,o.shape,!1):s=new Bc(i$t,r.shape,o.shape),e.runWebGLProgram(s,[r,o],r.dtype)}const u$t={kernelName:jI,backendName:"webgl",kernelFunc:s$t};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l$t(n){const{inputs:t,backend:e}=n,{s0:r,s1:o}=t,a=e.readSync(r.dataId),i=e.readSync(o.dataId),s=Ee(Array.from(a),Array.from(i));return e.makeTensorInfo([s.length],"int32",Int32Array.from(s))}const c$t={kernelName:mz,backendName:"webgl",kernelFunc:l$t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h$t="return float(a != b);",E6=Hr({opSnippet:h$t,cpuKernelImpl:MAt,dtype:"bool"}),f$t={kernelName:Y1,backendName:"webgl",kernelFunc:E6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uv(n){const{inputs:t,backend:e}=n,{input:r}=t,o=e.texData.get(r.dataId);return Zo({inputs:{x:o.complexTensorInfos.real},backend:e})}const d$t={kernelName:xR,backendName:"webgl",kernelFunc:uv};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const p$t="return float(int(x));";function m$t(n,t){const e=new ji(n.shape,p$t),r=t.runWebGLProgram(e,[n],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JE(n){const{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{dtype:a}=r;if(a==="complex64"){if(o.dtype==="complex64")return Zo({inputs:{x:o},backend:e});const i=Rr(o.shape),s=JE({inputs:{x:o},backend:e,attrs:{dtype:"float32"}}),u=Nl({inputs:{real:s,imag:i},backend:e});return i.dispose(),e.disposeIntermediateTensorInfo(s),u}if(o.dtype==="complex64"){const i=uv({inputs:{input:o},backend:e}),s=JE({inputs:{x:i},backend:e,attrs:{dtype:a}});return e.disposeIntermediateTensorInfo(i),s}if(!cz(o.dtype,a)){const i=Zo({inputs:{x:o},backend:e});return{dataId:i.dataId,shape:i.shape,dtype:a}}if(e.shouldExecuteOnCPU([o])){const i=e.texData.get(o.dataId).values,[s,u,l]=gAt(i,o.shape,o.dtype,a);return e.makeTensorInfo(s,u,l)}if(a==="int32")return m$t(o,e);if(a==="bool"){const i=e.makeTensorInfo([],"bool",Jr("bool",1)),u=E6({inputs:{a:o,b:i},backend:e});return e.disposeIntermediateTensorInfo(i),u}throw new Error(`Error in Cast: failed to cast ${o.dtype} to ${a}`)}const g$t={kernelName:tg,backendName:"webgl",kernelFunc:JE};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JF="return ceil(x);",v$t=Ve({opSnippet:JF,packedOpSnippet:JF,cpuKernelImpl:vAt}),x$t={kernelName:eg,backendName:"webgl",kernelFunc:v$t};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class y$t{constructor(t){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class b$t{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w$t(n){const{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{clipValueMin:a,clipValueMax:i}=r;let s;yt().getBool("WEBGL_PACK_CLIP")?s=new b$t(o.shape):s=new y$t(o.shape);const u=[[a],[i]];return e.runWebGLProgram(s,[o],o.dtype,u)}const C$t={kernelName:ng,backendName:"webgl",kernelFunc:w$t};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class S$t{constructor(t){this.variableNames=["real","imag"],this.outputShape=t,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tM(n,t){return{dataId:t.dataId,dtype:t.dtype,shape:n.shape}}function E$t(n){const{inputs:t,backend:e}=n,{x:r}=t,o=e.texData.get(r.dataId),a=new S$t(r.shape),i=[tM(r,o.complexTensorInfos.real),tM(r,o.complexTensorInfos.imag)];return e.runWebGLProgram(a,i,i[0].dtype)}const k$t={kernelName:S1,backendName:"webgl",kernelFunc:E$t};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class I$t{constructor(t){this.outputShape=[],this.outputShape=Qi(t,1),this.variableNames=t.map((i,s)=>`T${s}`);const e=new Array(t.length-1);e[0]=t[0][1];for(let i=1;i<e.length;i++)e[i]=e[i-1]+t[i][1];const r=[`if (yC < ${e[0]}) setOutput(getT0(yR, yC));`];for(let i=1;i<e.length;i++){const s=e[i-1];r.push(`else if (yC < ${e[i]}) setOutput(getT${i}(yR, yC-${s}));`)}const o=e.length,a=e[e.length-1];r.push(`else setOutput(getT${o}(yR, yC-${a}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${r.join(`
        `)}
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class R$t{constructor(t,e){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Qi(t,e);const r=this.outputShape,o=r.length,a=pn(o),i=xo("coords",o),s=["x","y","z","w","u","v"].slice(0,o);this.variableNames=t.map((x,y)=>`T${y}`);const u=new Array(t.length-1);u[0]=t[0][e];for(let x=1;x<u.length;x++)u[x]=u[x-1]+t[x][e];const l=s[e],c=s.slice(-2),h=s.join();let d=`if (${l} < ${u[0]}) {
        return getChannel(
            getT0(${h}), vec2(${c.join()}));
        }`;for(let x=1;x<u.length;x++){const y=u[x-1];d+=`
        if (${l} < ${u[x]}  && ${l} >= ${u[x-1]}) {
          return getChannel(
            getT${x}(${o0(s,l,y)}),
            vec2(${o0(c,l,y)}));
        }`}const p=u.length,g=u[u.length-1];d+=`
        return getChannel(
          getT${p}(${o0(s,l,g)}),
          vec2(${o0(c,l,g)}));`,this.userCode=`
      float getValue(${s.map(x=>"int "+x)}) {
        ${d}
      }

      void main() {
        ${a} coords = getOutputCoords();
        vec4 result = vec4(getValue(${i}), 0., 0., 0.);

        ${i[o-1]} = ${i[o-1]} + 1;
        if (${i[o-1]} < ${r[o-1]}) {
          result.g = getValue(${i});
        }

        ${i[o-2]} = ${i[o-2]} + 1;
        if (${i[o-2]} < ${r[o-2]}) {
          result.a = getValue(${i});
        }

        ${i[o-1]} = ${i[o-1]} - 1;
        if (${i[o-2]} < ${r[o-2]} &&
            ${i[o-1]} < ${r[o-1]}) {
          result.b = getValue(${i});
        }
        setOutput(result);
      }
    `}}function o0(n,t,e){const r=n.indexOf(t);return n.map((a,i)=>i===r?`${a} - ${e}`:a).join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hb(n){const{inputs:t,backend:e}=n,{input:r}=t,o=e.texData.get(r.dataId);return Zo({inputs:{x:o.complexTensorInfos.imag},backend:e})}const T$t={kernelName:cR,backendName:"webgl",kernelFunc:Hb};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qp(n,t,e){const r=n[0].dtype;if(r==="complex64"){const p=n.map(C=>uv({inputs:{input:C},backend:e})),g=n.map(C=>Hb({inputs:{input:C},backend:e})),x=qp(p,t,e),y=qp(g,t,e),b=Nl({inputs:{real:x,imag:y},backend:e});return p.forEach(C=>e.disposeIntermediateTensorInfo(C)),g.forEach(C=>e.disposeIntermediateTensorInfo(C)),e.disposeIntermediateTensorInfo(x),e.disposeIntermediateTensorInfo(y),b}let o=e.shouldExecuteOnCPU(n);if(r==="string"&&(o=!0),o){const p=n.map(S=>{const R=[-1,It(S.shape.slice(t))];return Wt({inputs:{x:S},backend:e,attrs:{shape:R}})}),g=p.map(S=>({vals:e.readSync(S.dataId),shape:S.shape})),x=Qi(p.map(S=>S.shape),1),y=p[0].shape[0]===1,b=xAt(g,x,r,y),C=Qi(n.map(S=>S.shape),t),E=e.makeTensorInfo(C,r,b);return p.forEach(S=>e.disposeIntermediateTensorInfo(S)),E}const a=n.filter(p=>It(p.shape)>0),i=yt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&a[0].shape.length>1;if(a.length===1){const p=i?new ji(n[0].shape,Wu):new Ku(n[0].shape,Wu);return e.runWebGLProgram(p,n,r)}const s=yt().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(a.length>s){const p=[];for(let x=0;x<a.length;x+=s){const y=a.slice(x,x+s);p.push(qp(y,t,e))}const g=qp(p,t,e);for(const x of p)e.disposeIntermediateTensorInfo(x);return g}if(i){const p=new R$t(a.map(g=>g.shape),t);return e.runWebGLProgram(p,a,r)}const{tensors2D:u,outShape:l}=N$t(a,t,e),c=new I$t(u.map(p=>p.shape)),h=e.runWebGLProgram(c,u,r);u.forEach(p=>e.disposeIntermediateTensorInfo(p));const d=Wt({inputs:{x:h},attrs:{shape:l},backend:e});return e.disposeIntermediateTensorInfo(h),d}function N$t(n,t,e){const r=Qi(n.map(a=>a.shape),t);return{tensors2D:n.map(a=>Wt({inputs:{x:a},attrs:{shape:[-1,It(a.shape.slice(t))]},backend:e})),outShape:r}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k6(n){const{inputs:t,backend:e,attrs:r}=n,{axis:o}=r,a=_e(o,t[0].shape)[0],i=t.map(l=>l.shape);fT(i,a);const s=Qi(t.map(l=>l.shape),a);if(It(s)===0)return e.makeTensorInfo(s,t[0].dtype,[]);const u=t.filter(l=>It(l.shape)>0);return u.length===1?Zo({inputs:{x:u[0]},backend:e}):qp(u,a,e)}const A$t={kernelName:E1,backendName:"webgl",kernelFunc:k6};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class I6{constructor(t,e=!1,r=null,o=!1,a=!1){this.variableNames=["x","W"],this.outputShape=t.outShape;const i=t.padInfo.top,s=t.padInfo.left,u=t.strideHeight,l=t.strideWidth,c=t.dilationHeight,h=t.dilationWidth,d=t.filterHeight,p=t.filterWidth,g=Math.floor(t.inChannels/4)*4,x=t.inChannels%4,y=t.dataFormat==="channelsLast",b=y?1:2,C=y?2:3,E=y?3:1;let S="",k="";r&&(o?S=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:a?S=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:S=`
          float activation(float x) {
            ${r}
          }
        `,k="result = activation(result);");const R=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${S}

      const ivec2 strides = ivec2(${u}, ${l});
      const ivec2 pads = ivec2(${i}, ${s});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${E}];

        ivec2 xRCCorner =
            ivec2(coords[${b}], coords[${C}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${d}; wR++) {
          int xR = xRCorner + wR * ${c};

          if (xR < 0 || xR >= ${t.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${p}; wC++) {
            int xC = xCCorner + wC * ${h};

            if (xC < 0 || xC >= ${t.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${g}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${y}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${x===1}) {

              if (${y}) {
                dotProd +=
                    getX(batch, xR, xC, ${g}) *
                    getW(wR, wC, ${g}, d2);
              } else {
                dotProd +=
                    getX(batch, ${g}, xR, xC) *
                    getW(wR, wC, ${g}, d2);
              }

            } else if (${x===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${g}, d2),
                getW(wR, wC, ${g} + 1, d2)
              );

              if (${y}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${g}),
                  getX(batch, xR, xC, ${g} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${g}, xR, xC),
                  getX(batch, ${g} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${x===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${g}, d2),
                getW(wR, wC, ${g} + 1, d2),
                getW(wR, wC, ${g} + 2, d2)
              );

              if (${y}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${g}),
                  getX(batch, xR, xC, ${g} + 1),
                  getX(batch, xR, xC, ${g} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${g}, xR, xC),
                  getX(batch, ${g} + 1, xR, xC),
                  getX(batch, ${g} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${R}
        ${k}
        setOutput(result);
      }
    `}}class _$t{constructor(t){this.variableNames=["x","W"],this.outputShape=t.outShape;const e=t.padInfo.front,r=t.padInfo.top,o=t.padInfo.left,a=t.strideDepth,i=t.strideHeight,s=t.strideWidth,u=t.dilationDepth,l=t.dilationHeight,c=t.dilationWidth,h=t.filterDepth,d=t.filterHeight,p=t.filterWidth,g=Math.floor(t.inChannels/4)*4,x=t.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${a}, ${i}, ${s});
      const ivec3 pads = ivec3(${e}, ${r}, ${o});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${h}; wF++) {
          int xF = xFCorner + wF * ${u};

          if (xF < 0 || xF >= ${t.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${d}; wR++) {
            int xR = xRCorner + wR * ${l};

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${p}; wC++) {
              int xC = xCCorner + wC * ${c};

              if (xC < 0 || xC >= ${t.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${g}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${x===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${g}) *
                  getW(wF, wR, wC, ${g}, d2);
              } else if (${x===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${g}),
                  getX(batch, xF, xR, xC, ${g} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${g}, d2),
                  getW(wF, wR, wC, ${g} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${x===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${g}),
                  getX(batch, xF, xR, xC, ${g} + 1),
                  getX(batch, xF, xR, xC, ${g} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${g}, d2),
                  getW(wF, wR, wC, ${g} + 1, d2),
                  getW(wF, wR, wC, ${g} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class R6{constructor(t,e=!1,r=null,o=!1,a=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=ao(this.outputShape.length);const i=t.padInfo.left,s=t.strideWidth,u=t.dilationWidth,l=t.filterHeight,c=t.filterWidth,h=c;let d=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let y=0;y<c;y++)d+=`
           vec4 xTexelC${y*2};
           int xTexelC${y*2}Ready;
           vec4 xTexelC${y*2+1};
           int xTexelC${y*2+1}Ready;
           vec4 xC${y};`;d+=`
     for (int r = 0; r < ${l}; r++) {
      for (int d1 = 0; d1 < ${t.inChannels}; d1 += 2) {
       `;for(let y=0;y<c;y++)d+=`
           xTexelC${y*2} = vec4(0.0);
           xTexelC${y*2}Ready = 0;
           xTexelC${y*2+1} = vec4(0.0);
           xTexelC${y*2+1}Ready = 0;
           xC${y} = vec4(0.0);`;d+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let y=0;y<(h+1)/2;y++){const b=y*2;if(d+=`
           xC = xCCorner + ${b*u};
           `,s===1){if(b<c&&(i%2===1?(d+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b}Ready == 0) {
                   xTexelC${b} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${b}.zw = vec2(0.0);
                   }
                   xTexelC${b}Ready = 1;
                 }
               `,u===1&&b>0?d+=`
                 xC${b} = vec4(xTexelC${b-2}.zw, xTexelC${b}.xy);
                 `:d+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${b} = vec4(previous.zw, xTexelC${b}.xy);
                   } else {
                     xC${b} = vec4(0.0, 0.0, xTexelC${b}.xy);
                   }
                   `):d+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${b}Ready == 0) {
                   xTexelC${b} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${b}.zw = vec2(0.0);
                   }
                   xTexelC${b}Ready = 1;
                 }

                 xC${b} = xTexelC${b};
                 `,b+1<c)){const C=i%2===0?MI(u):u;u%2===0&&i%2===1||u%2!==0&&i%2!==1?(d+=`
                   xCOffset = xC + imod(pads[1], 2) + ${C};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b+1}Ready == 0) {
                     xTexelC${b+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${b+1}.zw = vec2(0.0);
                     }
                     xTexelC${b+1}Ready = 1;
                   }
                   `,u>1?d+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${b+1} = vec4(previous.zw, xTexelC${b+1}.xy);
                     } else {
                      xC${b+1} = vec4(0.0, 0.0, xTexelC${b+1}.xy);
                     }
                     `:d+=`
                     xC${b+1} = vec4(xTexelC${b}.zw, xTexelC${b+1}.xy);
                     `):C===1?d+=`
                     xC${b+1} = xTexelC${b};
                     `:d+=`
                     xCOffset = xC + ${C};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b+1}Ready == 0) {
                       xTexelC${b+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${b+1}.zw = vec2(0.0);
                       }
                       xTexelC${b+1}Ready = 1;
                     }

                     xC${b+1} = xTexelC${b+1};
                     `}}else b<c&&(i%2===1?(d+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b}Ready == 0) {
                   xTexelC${b} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${b}.zw = vec2(0.0);
                   }
                   xTexelC${b}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${b+1}Ready == 0) {
                   xTexelC${b+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${b+1}.zw = vec2(0.0);
                   }
                   xTexelC${b+1}Ready = 1;
                 }

                 xC${b} = vec4(xTexelC${b}.zw, xTexelC${b+1}.zw);
               `,b+1<c&&(d+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${b+1} = vec4(xTexelC${b+1}.xy, final.xy);
                 `)):(d+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${b}Ready == 0) {
                   xTexelC${b} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${b}.zw = vec2(0.0);
                   }
                   xTexelC${b}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b+1}Ready == 0) {
                   xTexelC${b+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${b+1}.zw = vec2(0.);
                   }
                   xTexelC${b+1}Ready = 1;
                 }

                 xC${b} = vec4(
                   xTexelC${b}.xy, xTexelC${b+1}.xy);
               `,b+1<c&&(d+=`
                   xC${b+1} = vec4(xTexelC${b}.zw, xTexelC${b+1}.zw);
                 `)));b<c&&(d+=`
             wTexel = getW(r, ${b}, d1, d2);
             dotProd += xC${b}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${t.inChannels}) {
               dotProd += xC${b}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,b+1<c&&(d+=`
               wTexel = getW(r, ${b+1}, d1, d2);
               dotProd += xC${b+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${t.inChannels}) {
                 dotProd += xC${b+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}d+=`
     }
   `,d+=`
     }
   `,d+=`
     }
   `;let p="",g="";r&&(o?p=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${r}
         }`:a?p=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${r}
         }`:p=`vec4 activation(vec4 x) {
           ${r}
         }`,g="result = activation(result);");const x=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${p}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${d}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${x}
         ${g}
         setOutput(result);
       }
     `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class D$t{constructor(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=t,this.enableShapeUniforms=ao(this.outputShape.length);const{dataFormat:r}=e,o=So(),a=r==="channelsLast",i=a?1:2,s=a?2:3,u=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${t[2]} && pos < ${t[1]}) {`;let l="";for(let c=0;c<=1;c++)for(let h=0;h<=1;h++)l+=`
          blockIndex = rc.z + ${h};
          pos = rc.y + ${c};

          ${u}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${i}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${s}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${a}) {
                  innerDims = vec2(d1, ch);
                  result[${c*2+h}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${c*2+h}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${l}

        ${o.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vy(n,t){const e=n.length;return e>=3?t?[...n.slice(0,-3),n[e-3]*n[e-2],n[e-1]]:[...n.slice(0,-3),n[e-3],n[e-2]*n[e-1]]:!t&&e===1&&n[0]>1?[n[0],1]:null}function T6({x:n,filter:t,convInfo:e,backend:r,bias:o=null,preluActivationWeights:a=null,leakyreluAlpha:i=0,activation:s=null}){const u=n.shape,l=r.texData.get(n.dataId),c=e.inChannels,h=u[0]*u[1]*u[2],d=e.outChannels,p=e.dataFormat==="channelsLast",g=!1,x=!1;let y;const b=[];if(a!=null){const S=Vy(a.shape,p);S!=null&&(a=Wt({inputs:{x:a},backend:r,attrs:{shape:S}}),b.push(a))}if(o!=null){const S=Vy(o.shape,p);S!=null&&(o=Wt({inputs:{x:o},backend:r,attrs:{shape:S}}),b.push(o))}if(!((h===1||d===1)&&c>b6)&&l.isPacked&&p&&l.texture!=null&&u[2]%2!==0&&tn(l.shape.slice(-3),u.slice(-3))){const S=u[0]*u[1]*(u[2]+1),k={dataId:n.dataId,shape:[1,S,e.inChannels],dtype:n.dtype},R=l.shape;l.shape=l.shape.slice(),l.shape[l.shape.length-2]++,H(Uy(l.shape,k.shape),()=>`packed reshape ${l.shape} to ${k.shape} isn't free`);const A=Wt({inputs:{x:t},backend:r,attrs:{shape:[1,e.inChannels,e.outChannels]}});b.push(A);const N=Wy({a:k,b:A,backend:r,transposeA:g,transposeB:x,bias:o,activation:s,preluActivationWeights:a,leakyreluAlpha:i}),_=r.texData.get(N.dataId);H(_.isPacked,()=>"batchMatMul result is expected to be packed"),l.shape=R,_.shape=e.outShape,y=Zo({inputs:{x:N},backend:r}),y.shape=e.outShape,b.push(N)}else{const S=e.outHeight*e.outWidth,k=Wt({inputs:{x:n},backend:r,attrs:{shape:p?[e.batchSize,S,e.inChannels]:[e.batchSize,e.inChannels,S]}}),R=Wt({inputs:{x:t},backend:r,attrs:{shape:[1,e.inChannels,e.outChannels]}}),A=Wy({a:p?k:R,b:p?R:k,transposeA:!p,transposeB:x,backend:r,bias:o,activation:s,preluActivationWeights:a,leakyreluAlpha:i});y=Wt({inputs:{x:A},backend:r,attrs:{shape:e.outShape}}),b.push(k),b.push(R),b.push(A)}for(const S of b)r.disposeIntermediateTensorInfo(S);return y}function N6({x:n,filter:t,convInfo:e,backend:r,bias:o=null,preluActivationWeights:a=null,leakyreluAlpha:i=0,activation:s=null}){const{filterWidth:u,filterHeight:l,inChannels:c,outWidth:h,outHeight:d,dataFormat:p}=e,g=p==="channelsLast",x=u*l*c,y=d*h,b=[e.batchSize,x,y],C=!0,E=!1,S=[];if(a!=null){const U=Vy(a.shape,g);U!=null&&(a=Wt({inputs:{x:a},backend:r,attrs:{shape:U}}),S.push(a))}if(o!=null){const U=Vy(o.shape,g);U!=null&&(o=Wt({inputs:{x:o},backend:r,attrs:{shape:U}}),S.push(o))}const k=Wt({inputs:{x:t},backend:r,attrs:{shape:[1,x,It(t.shape)/x]}});S.push(k);const R=new D$t(b,e),A=[n.shape,[e.padInfo.top,e.padInfo.left],[e.strideHeight,e.strideWidth],[e.dilationHeight,e.dilationWidth],[e.inChannels],[e.filterWidth*e.inChannels],[e.outWidth]],N=r.runWebGLProgram(R,[n],"float32",A),_=Wt({inputs:{x:N},backend:r,attrs:{shape:b}});S.push(N),S.push(_);const $=o!=null,D=a!=null,O=s==="leakyrelu",P=s?vm(s,!0):null,z=new y6(g?_.shape:k.shape,g?k.shape:_.shape,g?[e.batchSize,y,e.outChannels]:[e.batchSize,e.outChannels,y],C,E,$,P,D,O),W=g?[_,k]:[k,_];if(o&&W.push(o),D&&W.push(a),O){const U=r.makeTensorInfo([],"float32",wl(i,"float32"));W.push(U),S.push(U)}const F=r.runWebGLProgram(z,W,"float32"),B=Wt({inputs:{x:F},backend:r,attrs:{shape:e.outShape}});S.push(F);for(const U of S)r.disposeIntermediateTensorInfo(U);return B}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $$t(n){const{inputs:t,backend:e,attrs:r}=n,{x:o,filter:a}=t,{strides:i,pad:s,dataFormat:u,dilations:l,dimRoundingMode:c}=r,h=fu(u),d=Vr(o.shape,a.shape,i,l,s,c,!1,h);let p;if(d.filterHeight===1&&d.filterWidth===1&&d.dilationHeight===1&&d.dilationWidth===1&&d.strideHeight===1&&d.strideWidth===1&&(d.padInfo.type==="SAME"||d.padInfo.type==="VALID"))p=T6({x:o,filter:a,convInfo:d,backend:e});else if(d.strideWidth<=2&&h==="channelsLast"&&yt().getBool("WEBGL_EXP_CONV")){const x=new R6(d),y=[[d.padInfo.top,d.padInfo.left],[d.strideHeight,d.strideWidth],[d.dilationHeight,d.dilationWidth],[d.inHeight,d.inWidth]];p=e.runWebGLProgram(x,[o,a],"float32",y)}else if(yt().getBool("WEBGL_CONV_IM2COL"))p=N6({x:o,filter:a,convInfo:d,backend:e});else{const x=new I6(d);p=e.runWebGLProgram(x,[o,a],"float32")}const g=Wt({inputs:{x:p},backend:e,attrs:{shape:d.outShape}});return e.disposeIntermediateTensorInfo(p),g}const O$t={kernelName:k1,backendName:"webgl",kernelFunc:$$t};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class F$t{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;const e=t.strideHeight,r=t.strideWidth,o=t.padInfo.top,a=t.padInfo.left,i=t.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${t.batchSize}; b++) {
          for (int yR = 0; yR < ${t.outHeight}; yR++) {
            int xR = wR + yR * ${e} - ${o};

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${t.outWidth}; yC++) {
              int xC = wC + yC * ${r} - ${a};

              if (xC < 0 || xC >= ${t.inWidth}) {
                continue;
              }

              ${i?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`}
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class M$t{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;const e=t.filterHeight,r=t.filterWidth,o=t.strideHeight,a=t.strideWidth,i=t.dataFormat==="channelsLast",s=e-1-t.padInfo.top,u=r-1-t.padInfo.left,l=i?1:2,c=i?2:3,h=i?3:1;this.userCode=`
      const ivec2 pads = ivec2(${s}, ${u});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${h}];

        ivec2 dyCorner = ivec2(coords[${l}], coords[${c}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${e}; wR++) {
          float dyR = float(dyRCorner + wR) / ${o}.0;

          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${e} - 1 - wR;

          for (int wC = 0; wC < ${r}; wC++) {
            float dyC = float(dyCCorner + wC) / ${a}.0;

            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${r} - 1 - wC;

            for (int d2 = 0; d2 < ${t.outChannels}; d2++) {

              if (${i}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class L$t{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;const e=t.strideDepth,r=t.strideHeight,o=t.strideWidth,a=t.padInfo.front,i=t.padInfo.top,s=t.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${t.batchSize}; b++) {
          for (int yF = 0; yF < ${t.outDepth}; yF++) {
            int xF = wF + yF * ${e} - ${a};

            if (xF < 0 || xF >= ${t.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${t.outHeight}; yR++) {
              int xR = wR + yR * ${r} - ${i};

              if (xR < 0 || xR >= ${t.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${t.outWidth}; yC++) {
                int xC = wC + yC * ${o} - ${s};

                if (xC < 0 || xC >= ${t.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class P$t{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;const e=t.filterDepth,r=t.filterHeight,o=t.filterWidth,a=t.strideDepth,i=t.strideHeight,s=t.strideWidth,u=e-1-t.padInfo.front,l=r-1-t.padInfo.top,c=o-1-t.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${u}, ${l}, ${c});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${e}; wF++) {
          float dyF = float(dyFCorner + wF) / ${a}.0;

          if (dyF < 0.0 || dyF >= ${t.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${e} - 1 - wF;

          for (int wR = 0; wR < ${r}; wR++) {
            float dyR = float(dyRCorner + wR) / ${i}.0;

            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${r} - 1 - wR;

            for (int wC = 0; wC < ${o}; wC++) {
              float dyC = float(dyCCorner + wC) / ${s}.0;

              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${o} - 1 - wC;

              for (int d2 = 0; d2 < ${t.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B$t(n){const{inputs:t,backend:e,attrs:r}=n,{x:o,dy:a}=t,{strides:i,pad:s,dataFormat:u,dimRoundingMode:l,filterShape:c}=r,h=fu(u),d=Vr(o.shape,c,i,1,s,l,!1,h),p=new F$t(d);return e.runWebGLProgram(p,[o,a],"float32")}const z$t={kernelName:KI,backendName:"webgl",kernelFunc:B$t};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class U$t{constructor(t){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=t.inShape,this.enableShapeUniforms=ao(this.outputShape.length);const e=t.filterHeight,r=t.filterWidth,o=e-1-t.padInfo.top,a=r-1-t.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(${o}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < ${e}; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = ${e} - 1 - wR;

          for (int wC = 0; wC < ${r}; wC++) {
            int wCPerm = ${r} - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < ${t.outWidth}.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${t.outWidth}.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < ${t.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < ${t.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < ${t.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W$t(n){const{inputs:t,backend:e,attrs:r}=n,{dy:o,filter:a}=t,{inputShape:i,strides:s,pad:u,dataFormat:l,dimRoundingMode:c}=r,h=fu(l),d=Vr(i,a.shape,s,1,u,c,!1,h);if(yt().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&h==="channelsLast"){const p=[[d.strideHeight,d.strideWidth]],g=new U$t(d);return e.runWebGLProgram(g,[o,a],"float32",p)}else{const p=new M$t(d);return e.runWebGLProgram(p,[o,a],"float32")}}const V$t={kernelName:I1,backendName:"webgl",kernelFunc:W$t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G$t(n){const{inputs:t,backend:e,attrs:r}=n,{x:o,filter:a}=t,{strides:i,pad:s,dilations:u}=r,l=Cl(o.shape,a.shape,i,u,s),c=new _$t(l);return e.runWebGLProgram(c,[o,a],"float32")}const H$t={kernelName:R1,backendName:"webgl",kernelFunc:G$t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q$t(n){const{inputs:t,backend:e,attrs:r}=n,{x:o,dy:a}=t,{strides:i,pad:s,filterShape:u}=r,l=Cl(o.shape,u,i,1,s),c=new L$t(l);return e.runWebGLProgram(c,[o,a],"float32")}const j$t={kernelName:YI,backendName:"webgl",kernelFunc:q$t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X$t(n){const{inputs:t,backend:e,attrs:r}=n,{dy:o,filter:a}=t,{pad:i,strides:s,inputShape:u}=r,l=Cl(u,a.shape,s,1,i),c=new P$t(l);return e.runWebGLProgram(c,[o,a],"float32")}const K$t={kernelName:QI,backendName:"webgl",kernelFunc:X$t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y$t=Ed+`
  return cos(x);
`,Q$t=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  ${uh}
  return result;
`,Z$t=Ve({opSnippet:Y$t,packedOpSnippet:Q$t}),J$t={kernelName:rg,backendName:"webgl",kernelFunc:Z$t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tOt=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,eOt=Ve({opSnippet:tOt}),nOt={kernelName:og,backendName:"webgl",kernelFunc:eOt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rOt{constructor(t,e,r,o,a){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[i,s,u,l]=t,[c]=e,[h,d]=r;this.outputShape=[c,h,d,l];const p=o==="bilinear"?1:0,[g,x]=[`${s-1}.0`,`${u-1}.0`],[y,b,C]=h>1?[`${(s-1)/(h-1)}`,"(y2-y1) * height_ratio",`y1*${g} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${g}`],[E,S,k]=d>1?[`${(u-1)/(d-1)}`,"(x2-x1) * width_ratio",`x1*${x} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${x}`];this.userCode=`
      const float height_ratio = float(${y});
      const float width_ratio = float(${E});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${i}) {
          return;
        }

        float height_scale = ${b};
        float width_scale = ${S};

        float in_y = ${C};
        if( in_y < 0.0 || in_y > ${g} ) {
          setOutput(float(${a}));
          return;
        }
        float in_x = ${k};
        if( in_x < 0.0 || in_x > ${x} ) {
          setOutput(float(${a}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${p} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oOt=n=>{const{inputs:t,backend:e,attrs:r}=n,{image:o,boxes:a,boxInd:i}=t,{cropSize:s,method:u,extrapolationValue:l}=r,c=new rOt(o.shape,a.shape,s,u,l);return e.runWebGLProgram(c,[o,a,i],"float32")},aOt={kernelName:JI,backendName:"webgl",kernelFunc:oOt};var ym;(function(n){n.Prod="*",n.Sum="+"})(ym||(ym={}));class eM{constructor(t,e,r,o){this.op=t,this.outputShape=e,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const a=this.outputShape.length,i=this.op===ym.Prod?"1.0":"0.0",s=r?i:`getX(${nM(a,"coords",this.op)})`,u=this.outputShape[this.outputShape.length-1];let l="",c="";r?(l=o?`end != ${u-1}`:"end != 0",c=o?"end + 1":"end - 1"):(l=o?`end + pow2 < ${u}`:"end >= pow2",c=o?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${pn(a)} coords = getOutputCoords();
        int end = ${rM(a,"coords",this.op)};
        float val = ${s};
        int pow2 = int(pow(2.0, index));
        if (${l}) {
          int idx = ${c};
          ${rM(a,"coords",this.op)} = idx;
          val ${this.op}= getX(${nM(a,"coords",this.op)});
        }
        setOutput(val);
      }
    `}}function nM(n,t,e){if(n===1)return`${t}`;if(n===2)return`${t}.x, ${t}.y`;if(n===3)return`${t}.x, ${t}.y, ${t}.z`;if(n===4)return`${t}.x, ${t}.y, ${t}.z, ${t}.w`;throw new Error(`Cumulative ${e} for rank ${n} is not yet supported`)}function rM(n,t,e){if(n===1)return`${t}`;if(n===2)return`${t}.y`;if(n===3)return`${t}.z`;if(n===4)return`${t}.w`;throw new Error(`Cumulative ${e} for rank ${n} is not yet supported`)}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A6(n,t,e,r,o,a){const i=t.shape.length,s=Pn([r],i);let u=t;s!=null&&(u=Co({inputs:{x:t},backend:e,attrs:{perm:s}}));const l=er(1,i)[0];if(l!==i-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${t.shape.length-1} but got axis=${r}`);const c=u.shape[l];let h=Zo({inputs:{x:u},backend:e});for(let d=0;d<=Math.ceil(Math.log2(c))-1;d++){const p=new eM(n,u.shape,!1,a),g=[[d]],x=h;h=e.runWebGLProgram(p,[h],h.dtype,g),e.disposeIntermediateTensorInfo(x)}if(o){const d=new eM(n,u.shape,o,a),p=h;h=e.runWebGLProgram(d,[h],h.dtype),e.disposeIntermediateTensorInfo(p)}if(s!=null){const d=Sl(s),p=Co({inputs:{x:h},backend:e,attrs:{perm:d}});return e.disposeIntermediateTensorInfo(h),e.disposeIntermediateTensorInfo(u),p}return h}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iOt(n){const{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{axis:a,exclusive:i,reverse:s}=r;return A6(ym.Prod,o,e,a,i,s)}const sOt={kernelName:ZI,backendName:"webgl",kernelFunc:iOt};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uOt(n){const{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{axis:a,exclusive:i,reverse:s}=r;return A6(ym.Sum,o,e,a,i,s)}const lOt={kernelName:T1,backendName:"webgl",kernelFunc:uOt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cOt(n){const{inputs:t,backend:e,attrs:r}=n,{x:o,weights:a}=t,{size:i,binaryOutput:s}=r;if(o.shape.length===1){const u=e.readSync(o.dataId),l=e.readSync(a.dataId),c=c6(u,l,a.dtype,a.shape,i);return e.makeTensorInfo([i],a.dtype,c)}else if(o.shape.length===2){const u=e.bufferSync(o),l=e.bufferSync(a),c=pAt(u,l,i,s);return e.makeTensorInfo(c.shape,a.dtype,c.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${o.shape.length}.`)}const hOt={kernelName:tR,backendName:"webgl",kernelFunc:cOt};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fOt{constructor(t,e,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=e,this.dataFormat=r,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${e};
      int offset_h = imod(h, ${e});
      int in_w = w / ${e};
      int offset_w = imod(w, ${e});
      int offset_d = (offset_h * ${e} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dOt(n){const{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{blockSize:a,dataFormat:i}=r,s=o.shape[0],u=i==="NHWC"?o.shape[1]:o.shape[2],l=i==="NHWC"?o.shape[2]:o.shape[3],c=i==="NHWC"?o.shape[3]:o.shape[1],h=u*a,d=l*a,p=c/(a*a),g=i==="NHWC"?[s,h,d,p]:[s,p,h,d],x=new fOt(g,a,i);return e.runWebGLProgram(x,[o],o.dtype)}const pOt={kernelName:eR,backendName:"webgl",kernelFunc:dOt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _6{constructor(t,e=!1,r=null,o=!1,a=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=ao(this.outputShape.length);const i=t.filterHeight,s=t.filterWidth,u=t.outChannels/t.inChannels;let l="",c="";r&&(o?l=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:a?l=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:l=`
          float activation(float x) {
            ${r}
          }
        `,c="result = activation(result);");const h=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${l}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${u};
        int q = d2 - d1 * ${u};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${i}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${s}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${h}
        ${c}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class D6{constructor(t,e=!1,r=null,o=!1,a=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=ao(this.outputShape.length);const i=t.outChannels/t.inChannels,s=t.padInfo.left,u=t.strideWidth,l=t.dilationWidth,c=t.filterHeight,h=t.filterWidth,d=h;let p=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let b=0;b<h;b++)p+=`
          vec4 xTexelC${b*2};
          int xTexelC${b*2}Ready;
          vec4 xTexelC${b*2+1};
          int xTexelC${b*2+1}Ready;
          vec4 xC${b};`;p+=`
    for (int r = 0; r < ${c}; r++) {
      `;for(let b=0;b<h;b++)p+=`
          xTexelC${b*2} = vec4(0.0);
          xTexelC${b*2}Ready = 0;
          xTexelC${b*2+1} = vec4(0.0);
          xTexelC${b*2+1}Ready = 0;
          xC${b} = vec4(0.0);`;p+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let b=0;b<(d+1)/2;b++){const C=b*2;if(p+=`
          xC = xCCorner + ${C*l};
          `,u===1){if(C<h&&(s%2===1?(p+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${C}Ready == 0) {
                  xTexelC${C} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${C}.zw = vec2(0.0);
                  }
                  xTexelC${C}Ready = 1;
                }
              `,l===1&&C>0?p+=`
                xC${C} = vec4(xTexelC${C-2}.zw, xTexelC${C}.xy);
                `:p+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${C} = vec4(previous.zw, xTexelC${C}.xy);
                  } else {
                    xC${C} = vec4(0.0, 0.0, xTexelC${C}.xy);
                  }
                  `):p+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${C}Ready == 0) {
                  xTexelC${C} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${C}.zw = vec2(0.0);
                  }
                  xTexelC${C}Ready = 1;
                }

                xC${C} = xTexelC${C};
                `,C+1<h)){const E=s%2===0?MI(l):l;l%2===0&&s%2===1||l%2!==0&&s%2!==1?(p+=`
                  xCOffset = xC + imod(pads[1], 2) + ${E};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${C+1}Ready == 0) {
                    xTexelC${C+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${C+1}.zw = vec2(0.0);
                    }
                    xTexelC${C+1}Ready = 1;
                  }
                  `,l>1?p+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${C+1} = vec4(previous.zw, xTexelC${C+1}.xy);
                    } else {
                     xC${C+1} = vec4(0.0, 0.0, xTexelC${C+1}.xy);
                    }
                    `:p+=`
                    xC${C+1} = vec4(xTexelC${C}.zw, xTexelC${C+1}.xy);
                    `):E===1?p+=`
                    xC${C+1} = xTexelC${C};
                    `:p+=`
                    xCOffset = xC + ${E};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${C+1}Ready == 0) {
                      xTexelC${C+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${C+1}.zw = vec2(0.0);
                      }
                      xTexelC${C+1}Ready = 1;
                    }

                    xC${C+1} = xTexelC${C+1};
                    `}}else C<h&&(s%2===1?(p+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${C}Ready == 0) {
                  xTexelC${C} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${C}.zw = vec2(0.0);
                  }
                  xTexelC${C}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${C+1}Ready == 0) {
                  xTexelC${C+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${C+1}.zw = vec2(0.0);
                  }
                  xTexelC${C+1}Ready = 1;
                }

                xC${C} = vec4(xTexelC${C}.zw, xTexelC${C+1}.zw);
              `,C+1<h&&(p+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${C+1} = vec4(xTexelC${C+1}.xy, final.xy);
                `)):(p+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${C}Ready == 0) {
                  xTexelC${C} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${C}.zw = vec2(0.0);
                  }
                  xTexelC${C}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${C+1}Ready == 0) {
                  xTexelC${C+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${C+1}.zw = vec2(0.);
                  }
                  xTexelC${C+1}Ready = 1;
                }

                xC${C} = vec4(
                  xTexelC${C}.xy, xTexelC${C+1}.xy);
              `,C+1<h&&(p+=`
                  xC${C+1} = vec4(xTexelC${C}.zw, xTexelC${C+1}.zw);
                `)));C<h&&(p+=`
            wTexel = getW(r, ${C}, d1, q);
            dotProd += xC${C} * vec4(wTexel.xz, wTexel.xz);
          `,C+1<h&&(p+=`
              wTexel = getW(r, ${C+1}, d1, q);
              dotProd += xC${C+1} * vec4(wTexel.xz, wTexel.xz);
            `))}p+=`
    }
  `,p+=`
      }
    `;let g="",x="";r&&(o?g=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:a?g=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:g=`vec4 activation(vec4 x) {
          ${r}
        }`,x="result = activation(result);");const y=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${g}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${i};
        int q = d2 - d1 * ${i};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${p}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${y}
        ${x}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mOt(n){const{inputs:t,backend:e,attrs:r}=n,{x:o,filter:a}=t,{strides:i,pad:s,dilations:u,dimRoundingMode:l}=r;let c=u;c==null&&(c=[1,1]),H(ro(i,c),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${i} and dilations '${c}'`);const h=Vr(o.shape,a.shape,i,c,s,l,!0);let d;yt().getBool("WEBGL_PACK_DEPTHWISECONV")&&h.strideWidth<=2&&h.outChannels/h.inChannels===1?d=new D6(h):d=new _6(h);const p=[[h.padInfo.top,h.padInfo.left],[h.strideHeight,h.strideWidth],[h.dilationHeight,h.dilationWidth],[h.inHeight,h.inWidth]];return e.runWebGLProgram(d,[o,a],"float32",p)}const gOt={kernelName:N1,backendName:"webgl",kernelFunc:mOt};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vOt{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;const e=t.strideHeight,r=t.strideWidth,o=t.padInfo.top,a=t.padInfo.left,i=t.outChannels/t.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${i} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${t.batchSize}; b++) {
          for (int yR = 0; yR < ${t.outHeight}; yR++) {
            int xR = wR + yR * ${e} - ${o};

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${t.outWidth}; yC++) {
              int xC = wC + yC * ${r} - ${a};

              if (xC < 0 || xC >= ${t.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class xOt{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;const e=t.filterHeight,r=t.filterWidth,o=t.strideHeight,a=t.strideWidth,i=e-1-t.padInfo.top,s=r-1-t.padInfo.left,u=t.outChannels/t.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${i}, ${s});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${e}; wR++) {
          float dyR = float(dyRCorner + wR) / ${o}.0;

          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${e} - 1 - wR;

          for (int wC = 0; wC < ${r}; wC++) {
            float dyC = float(dyCCorner + wC) / ${a}.0;

            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${r} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${u}; dm++) {
              int d2 = d1 * ${u} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yOt(n){const{inputs:t,backend:e,attrs:r}=n,{x:o,dy:a}=t,{strides:i,dilations:s,pad:u,dimRoundingMode:l,filterShape:c}=r,h=Vr(o.shape,c,i,s,u,l,!0),d=new vOt(h);return e.runWebGLProgram(d,[o,a],"float32")}const bOt={kernelName:nR,backendName:"webgl",kernelFunc:yOt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wOt(n){const{inputs:t,backend:e,attrs:r}=n,{dy:o,filter:a}=t,{strides:i,dilations:s,pad:u,dimRoundingMode:l,inputShape:c}=r,h=Vr(c,a.shape,i,s,u,l,!0),d=new xOt(h);return e.runWebGLProgram(d,[o,a],"float32")}const COt={kernelName:rR,backendName:"webgl",kernelFunc:wOt};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class SOt{constructor(t){this.variableNames=["X"],this.outputShape=[t,t],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EOt(n){const{inputs:t,backend:e}=n,{x:r}=t,o=[...r.shape,...r.shape],a=It(r.shape),i=Wt({inputs:{x:r},backend:e,attrs:{shape:[a]}}),s=new SOt(a),u=e.runWebGLProgram(s,[i],i.dtype),l=Wt({inputs:{x:u},backend:e,attrs:{shape:o}});return e.disposeIntermediateTensorInfo(i),e.disposeIntermediateTensorInfo(u),l}const kOt={kernelName:gz,backendName:"webgl",kernelFunc:EOt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class IOt{constructor(t){this.variableNames=["x","W"],this.outputShape=t.outShape;const{inHeight:e,inWidth:r,padInfo:o,strideHeight:a,strideWidth:i,filterHeight:s,filterWidth:u,dilationHeight:l,dilationWidth:c}=t,{top:h,left:d}=o;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${i});
      const ivec2 pads = ivec2(${h}, ${d});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${s}; h++) {
          int hIn = hBeg + h * ${l};

          if (hIn >= 0 && hIn < ${e}) {
            for (int w = 0; w < ${u}; w++) {
              int wIn = wBeg + w * ${c};

              if (wIn >= 0 && wIn < ${r}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ROt(n){const{inputs:t,backend:e,attrs:r}=n,{x:o,filter:a}=t,{strides:i,pad:s,dilations:u}=r,l=Wg(o.shape,a.shape,i,s,"NHWC",u);let c;const h=new IOt(l);c=e.runWebGLProgram(h,[o,a],"float32");const d=Wt({inputs:{x:c},backend:e,attrs:{shape:l.outShape}});return e.disposeIntermediateTensorInfo(c),d}const TOt={kernelName:A1,backendName:"webgl",kernelFunc:ROt};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NOt(n){const{inputs:t,backend:e,attrs:r}=n,{equation:o}=r,a=t,{allDims:i,summedDims:s,idDims:u}=ET(o,a.length);IT(i.length,u,a);const{path:l,steps:c}=RT(s,u),h=c.length;let d=null,p=i.length;const g=[];for(let x=0;x<h;++x){for(const y of c[x]){const{permutationIndices:b,expandDims:C}=kT(p,u[y]);let E;TT(b)?E=a[y]:(E=Co({inputs:{x:a[y]},backend:e,attrs:{perm:b}}),g.push(E));const S=E.shape.slice();for(let k=0;k<C.length;++k)S.splice(C[k],0,1);tn(E.shape,S)||(E=Wt({inputs:{x:E},backend:e,attrs:{shape:S}}),g.push(E)),d===null?d=E:(d=pN({inputs:{a:E,b:d},backend:e}),g.push(d))}x<h-1&&(l[x]>=0&&(d=Gb({inputs:{x:d},backend:e,attrs:{axis:l[x]-(i.length-p),keepDims:!1}}),g.push(d)),p--)}for(const x of g)x!==d&&e.disposeIntermediateTensorInfo(x);return d}const AOt={kernelName:oR,backendName:"webgl",kernelFunc:NOt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _Ot="return (x >= 0.0) ? x : (exp(x) - 1.0);",DOt=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,$Ot=Ve({opSnippet:_Ot,packedOpSnippet:DOt}),OOt={kernelName:ig,backendName:"webgl",kernelFunc:$Ot};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FOt="return (b >= 0.0) ? a : a * (b + 1.0);",MOt=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,LOt=n=>{const{inputs:t,backend:e}=n,{dy:r,y:o}=t,a=yt().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Sd(MOt,r.shape,o.shape):new Bc(FOt,r.shape,o.shape);return e.runWebGLProgram(a,[r,o],r.dtype)},POt={kernelName:aR,backendName:"webgl",kernelFunc:LOt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BOt=`
  return vec4(equal(a, b));
`,zOt="return float(a == b);",UOt=Hr({opSnippet:zOt,packedOpSnippet:BOt,dtype:"bool",cpuKernelImpl:yAt}),WOt={kernelName:_1,backendName:"webgl",kernelFunc:UOt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VOt=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${vT};
  float a1 = ${xT};
  float a2 = ${yT};
  float a3 = ${bT};
  float a4 = ${wT};
  float a5 = ${CT};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,GOt=Ve({opSnippet:VOt}),HOt={kernelName:sg,backendName:"webgl",kernelFunc:GOt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qOt=Ed+`
  return exp(x);
`,jOt=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,$6=Ve({opSnippet:qOt,packedOpSnippet:jOt,cpuKernelImpl:bAt,dtype:"float32"}),XOt={kernelName:ug,backendName:"webgl",kernelFunc:$6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tk(n){const{inputs:t,attrs:e,backend:r}=n,{dim:o}=e,{input:a}=t,i=a.shape.length,s=a.shape.slice();let u=o;return o<0&&(H(-(i+1)<=o,()=>`Axis must be in the interval [${-(i+1)}, ${i}]`),u=i+o+1),s.splice(u,0,1),Wt({inputs:{x:a},backend:r,attrs:{shape:s}})}const KOt={kernelName:D1,backendName:"webgl",kernelFunc:tk};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oM="return exp(x) - 1.0;",YOt=Ve({opSnippet:oM,packedOpSnippet:oM,cpuKernelImpl:wAt}),QOt={kernelName:lg,backendName:"webgl",kernelFunc:YOt};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aM{constructor(t,e,r){this.variableNames=["real","imag"];const o=e[1];this.outputShape=e;const a=r?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,i=r?`${o}.0`:"1.0";let s;if(t==="real")s="return real * expR - imag * expI;";else if(t==="imag")s="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${t}.`);this.userCode=`
      const float exponentMultiplier = ${a};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${s}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${o});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${o}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${i};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O6(n,t,e){const r=e.texData.get(n.dataId),o=It(n.shape),a=n.shape[n.shape.length-1],i=o/a,s=Wt({inputs:{x:n},backend:e,attrs:{shape:[i,a]}}),u=s.shape,l=new aM("real",u,t),c=new aM("imag",u,t),h=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:u},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:u}],d=e.runWebGLProgram(l,h,"float32"),p=e.runWebGLProgram(c,h,"float32"),g=Nl({inputs:{real:d,imag:p},backend:e});e.disposeIntermediateTensorInfo(d),e.disposeIntermediateTensorInfo(p);const x=Wt({inputs:{x:g},backend:e,attrs:{shape:n.shape}});return e.disposeIntermediateTensorInfo(s),e.disposeIntermediateTensorInfo(g),x}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZOt(n){const{inputs:t,backend:e}=n,{input:r}=t;return O6(r,!1,e)}const JOt={kernelName:iR,backendName:"webgl",kernelFunc:ZOt};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class t3t{constructor(t,e){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=t,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lv(n){const{backend:t,attrs:e}=n,{shape:r,value:o}=e;let{dtype:a}=e;if(a=a||ld(o),a==="string"){const i=Qn(a,It(r));return i.fill(o),t.makeTensorInfo(r,a,i)}else{const i=new t3t(r,o),s=[[o]];return t.runWebGLProgram(i,[],a,s)}}const e3t={kernelName:sR,backendName:"webgl",kernelFunc:lv};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class n3t{constructor(t){this.variableNames=["Image"],this.outputShape=[];const e=t[2];this.outputShape=t,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${e} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${e}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const r3t={kernelName:uR,backendName:"webgl",kernelFunc:({inputs:n,backend:t})=>{const{image:e}=n,r=t,o=new n3t(e.shape);return r.runWebGLProgram(o,[e],e.dtype)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iM="return floor(x);",o3t=Ve({opSnippet:iM,packedOpSnippet:iM,cpuKernelImpl:CAt}),a3t={kernelName:cg,backendName:"webgl",kernelFunc:o3t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const i3t=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,s3t=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,u3t=Hr({opSnippet:i3t,packedOpSnippet:s3t,dtype:"int32"}),l3t={kernelName:hg,backendName:"webgl",kernelFunc:u3t};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class c3t{constructor(t){this.variableNames=["A"];const e=So(),[r,o]=t;this.outputShape=t,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${o}.0, ${r}.0);

        vec4 values = ${e.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class h3t{constructor(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const e=So(),[r,o]=t;this.outputShape=t,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${o}.0, ${r}.0);
            vec4 values = ${e.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${e.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const f3t={kernelName:Qdt,backendName:"webgl",kernelFunc:d3t};let ef,kS=yt().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function d3t(n){const{inputs:t,backend:e,attrs:r}=n;let{pixels:o}=t;const{numChannels:a}=r,i=typeof HTMLVideoElement<"u"&&o instanceof HTMLVideoElement,s=typeof HTMLImageElement<"u"&&o instanceof HTMLImageElement,[u,l]=i?[o.videoWidth,o.videoHeight]:[o.width,o.height],c=[l,u],h=[l,u,a];if(s||i){const x=yt().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(ef==null||x!==kS)&&(kS=x,ef=document.createElement("canvas").getContext("2d",{willReadFrequently:kS})),ef.canvas.width=u,ef.canvas.height=l,ef.drawImage(o,0,0,u,l),o=ef.canvas}const d=e.makeTensorInfo(c,"int32");e.texData.get(d.dataId).usage=xa.PIXELS,e.gpgpu.uploadPixelDataToTexture(e.getTexture(d.dataId),o);const p=yt().getBool("WEBGL_PACK")?new h3t(h):new c3t(h),g=e.runWebGLProgram(p,[d],"int32");return e.disposeData(d.dataId),g}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p3t(n){const{inputs:t,backend:e,attrs:r}=n,{x:o,filter:a,bias:i,preluActivationWeights:s}=t,{strides:u,pad:l,dataFormat:c,dilations:h,dimRoundingMode:d,activation:p,leakyreluAlpha:g}=r,x=fu(c),y=Vr(o.shape,a.shape,u,h,l,d,!1,x);let b;const C=[],E=i!=null,S=s!=null,k=p==="leakyrelu",R=()=>{const N=[o,a],_=($,D)=>{if(D==="NCHW"&&$.shape.length===1&&$.shape[0]!==1){const O=Wt({inputs:{x:$},backend:e,attrs:{shape:[$.shape[0],1,1]}});return C.push(O),O}return $};if(E&&N.push(_(i,c)),S&&N.push(_(s,c)),k){const $=e.makeTensorInfo([],"float32",wl(g,"float32"));N.push($),C.push($)}return N};if(y.filterHeight===1&&y.filterWidth===1&&y.dilationHeight===1&&y.dilationWidth===1&&y.strideHeight===1&&y.strideWidth===1&&(y.padInfo.type==="SAME"||y.padInfo.type==="VALID"))b=T6({x:o,filter:a,convInfo:y,backend:e,bias:i,activation:p,preluActivationWeights:s,leakyreluAlpha:g});else if(y.strideWidth<=2&&x==="channelsLast"&&yt().getBool("WEBGL_EXP_CONV")){const N=p?vm(p,!0):null,_=new R6(y,E,N,S,k),$=[[y.padInfo.top,y.padInfo.left],[y.strideHeight,y.strideWidth],[y.dilationHeight,y.dilationWidth],[y.inHeight,y.inWidth]],D=R();b=e.runWebGLProgram(_,D,"float32",$)}else if(yt().getBool("WEBGL_CONV_IM2COL"))b=N6({x:o,filter:a,convInfo:y,backend:e,bias:i,activation:p,preluActivationWeights:s,leakyreluAlpha:g});else{const N=p?vm(p,!1):null,_=new I6(y,E,N,S,k),$=R();b=e.runWebGLProgram(_,$,"float32")}const A=Wt({inputs:{x:b},backend:e,attrs:{shape:y.outShape}});return C.push(b),C.forEach(N=>e.disposeIntermediateTensorInfo(N)),A}const m3t={kernelName:yy,backendName:"webgl",kernelFunc:p3t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g3t(n){const{inputs:t,backend:e,attrs:r}=n,{x:o,filter:a,bias:i,preluActivationWeights:s}=t,{strides:u,pad:l,dilations:c,dimRoundingMode:h,activation:d,leakyreluAlpha:p}=r,g=[];let x=c;x==null&&(x=[1,1]),H(ro(u,x),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${u} and dilations '${x}'`);const y=Vr(o.shape,a.shape,u,x,l,h,!0),b=yt().getBool("WEBGL_PACK_DEPTHWISECONV")&&y.strideWidth<=2&&y.outChannels/y.inChannels===1,C=d?vm(d,b):null,E=[o,a],S=i!=null,k=s!=null,R=d==="leakyrelu";if(S&&E.push(i),k&&E.push(s),R){const $=e.makeTensorInfo([],"float32",wl(p,"float32"));E.push($),g.push($)}let A;b?A=new D6(y,S,C,k,R):A=new _6(y,S,C,k,R);const N=[[y.padInfo.top,y.padInfo.left],[y.strideHeight,y.strideWidth],[y.dilationHeight,y.dilationWidth],[y.inHeight,y.inWidth]],_=e.runWebGLProgram(A,E,"float32",N);return g.forEach($=>e.disposeIntermediateTensorInfo($)),_}const v3t={kernelName:Fz,backendName:"webgl",kernelFunc:g3t};class x3t{constructor(t,e,r,o){this.sliceDim=t,this.strides=e,this.paramsShape=o,this.variableNames=["x","indices"],this.outputShape=r;const a=pn(r.length);let i=`
    int index;`;for(let s=0;s<this.sliceDim;s++)i+=`
          index = round(getIndices(coords[0], ${s}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[s]};
          flattenIndex += index * ${this.strides[s]};`;this.userCode=`
         void main() {
          ${a} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${i}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y3t(n){const{inputs:t,backend:e}=n,{params:r,indices:o}=t,a=o.shape,i=a[a.length-1],s=It(r.shape),[u,l,c,h]=iT(r,o),d=Wt({inputs:{x:o},backend:e,attrs:{shape:[l,i]}}),p=Wt({inputs:{x:r},backend:e,attrs:{shape:[It(r.shape)/c,c]}});if(e.shouldExecuteOnCPU([r,o])||r.dtype==="string"){const b=e.readSync(o.dataId),C=e.bufferSync(r),E=SAt(b,C,r.dtype,l,i,c,h,r.shape,s);return e.makeTensorInfo(u,r.dtype,E.values)}const g=new x3t(i,h,[l,c],r.shape),x=e.runWebGLProgram(g,[p,d],p.dtype),y=Wt({inputs:{x},backend:e,attrs:{shape:u}});return e.disposeIntermediateTensorInfo(d),e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(x),y}const b3t={kernelName:vz,backendName:"webgl",kernelFunc:y3t};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class w3t{constructor(t,e){this.variableNames=["A","indices"],this.outputShape=e,this.rank=e.length;const r=pn(this.rank),o=C3t(t);this.userCode=`
      void main() {
        ${r} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${t[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${o}));
      }
    `}}function C3t(n,t){const e=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[];for(let o=0;o<n.length;o++)o===2?r.push("index"):r.push(`${e[o]}`);return r.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F6(n){const{inputs:t,backend:e,attrs:r}=n,{x:o,indices:a}=t,{axis:i,batchDims:s}=r,u=_e(i,o.shape)[0];if(yt().get("DEBUG")){const C=e.readSync(a.dataId),E=o.shape[u];for(let S=0;S<C.length;++S){const k=C[S];H(k<=E-1&&k>=0,()=>`GatherV2: the index value ${k} is not in [0, ${E-1}]`)}}const l=AT(o,a,u,s),c=It(a.shape),h=[],d=Wt({inputs:{x:o},backend:e,attrs:{shape:[l.batchSize,l.outerSize,l.dimSize,l.sliceSize]}}),p=Wt({inputs:{x:a},backend:e,attrs:{shape:[l.batchSize,c/l.batchSize]}});h.push(d),h.push(p);const g=[l.batchSize,l.outerSize,c/l.batchSize,l.sliceSize];if(e.shouldExecuteOnCPU([o,a])||o.dtype==="string"){const C=e.bufferSync(p),E=e.bufferSync(d),S=EAt(E,C,g);return h.forEach(k=>e.disposeIntermediateTensorInfo(k)),e.makeTensorInfo(l.outputShape,S.dtype,S.values)}const x=new w3t(d.shape,g),y=e.runWebGLProgram(x,[d,p],d.dtype);h.push(y);const b=Wt({inputs:{x:y},backend:e,attrs:{shape:l.outputShape}});return h.forEach(C=>e.disposeIntermediateTensorInfo(C)),b}const S3t={kernelName:O1,backendName:"webgl",kernelFunc:F6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const E3t="return float(a > b);",k3t=`
  return vec4(greaterThan(a, b));
`,I3t=Hr({opSnippet:E3t,packedOpSnippet:k3t,cpuKernelImpl:kAt,dtype:"bool"}),R3t={kernelName:F1,backendName:"webgl",kernelFunc:I3t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T3t="return float(a >= b);",N3t=`
  return vec4(greaterThanEqual(a, b));
`,A3t=Hr({opSnippet:T3t,packedOpSnippet:N3t,dtype:"bool",cpuKernelImpl:IAt}),_3t={kernelName:fg,backendName:"webgl",kernelFunc:A3t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D3t(n){const{inputs:t,backend:e}=n,{input:r}=t;return O6(r,!0,e)}const $3t={kernelName:lR,backendName:"webgl",kernelFunc:D3t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const O3t="return float(!isnan(x) && !isinf(x));",F3t=Ve({opSnippet:O3t,dtype:"bool"}),M3t={kernelName:pg,backendName:"webgl",kernelFunc:F3t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const L3t="return float(isinf(x));",P3t=Ve({opSnippet:L3t,dtype:"bool"}),B3t={kernelName:mg,backendName:"webgl",kernelFunc:P3t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const z3t="return float(isnan(x));",U3t=Ve({opSnippet:z3t,dtype:"bool"}),W3t={kernelName:gg,backendName:"webgl",kernelFunc:U3t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const V3t="return float(a < b);",G3t=`
  return vec4(lessThan(a, b));
`,H3t=Hr({opSnippet:V3t,packedOpSnippet:G3t,cpuKernelImpl:RAt,dtype:"bool"}),q3t={kernelName:L1,backendName:"webgl",kernelFunc:H3t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const j3t="return float(a <= b);",X3t=`
  return vec4(lessThanEqual(a, b));
`,K3t=Hr({opSnippet:j3t,packedOpSnippet:X3t,cpuKernelImpl:TAt,dtype:"bool"}),Y3t={kernelName:P1,backendName:"webgl",kernelFunc:K3t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q3t(n){const{backend:t,attrs:e}=n,{start:r,stop:o,num:a}=e,i=NAt(r,o,a);return t.makeTensorInfo([i.length],"float32",i)}const Z3t={kernelName:xz,backendName:"webgl",kernelFunc:Q3t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J3t=Ed+`
  return x < 0.0 ? 0./0. : log(x);
`,tFt=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,eFt=Ve({opSnippet:J3t,packedOpSnippet:tFt,cpuKernelImpl:AAt}),nFt={kernelName:vg,backendName:"webgl",kernelFunc:eFt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rFt=Ed+`
  return log(1.0 + x);
`,oFt=Ve({opSnippet:rFt}),aFt={kernelName:xg,backendName:"webgl",kernelFunc:oFt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iFt="return float(a >= 1.0 && b >= 1.0);",sFt=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,uFt=Hr({opSnippet:iFt,packedOpSnippet:sFt,dtype:"bool"}),lFt={kernelName:B1,backendName:"webgl",kernelFunc:uFt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cFt="return float(!(x >= 1.0));",hFt=Ve({opSnippet:cFt}),fFt={kernelName:z1,backendName:"webgl",kernelFunc:hFt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dFt="return float(a >= 1.0 || b >= 1.0);",pFt=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,mFt=Hr({opSnippet:dFt,packedOpSnippet:pFt,dtype:"bool"}),gFt={kernelName:U1,backendName:"webgl",kernelFunc:mFt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vFt{constructor(t,e,r,o,a){this.variableNames=["x"],this.outputShape=[];const i=e,s=t[3]-1;this.outputShape=t;let u;const l=`float(${r}) + float(${o}) * sum`;a===.5?u=`inversesqrt(${l})`:a===1?u=`1.0/(${l})`:u=`exp(log(${l}) * float(-${a}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${i}; j <= ${i}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${s}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${u};
        setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xFt{constructor(t,e,r,o,a){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const i=e,s=t[3]-1;this.outputShape=t;let u;const l=`float(${r}) + float(${o}) * sum`;a===.5?u=`inversesqrt(${l})`:a===1?u=`1.0/(${l})`:u=`exp(log(${l}) * float(-${a}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${i};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${i}; j <= ${i}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${s}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${u};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yFt=n=>{const{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{depthRadius:a,bias:i,alpha:s,beta:u}=r,l=yt().getBool("WEBGL_PACK_NORMALIZATION")?new xFt(o.shape,a,i,s,u):new vFt(o.shape,a,i,s,u);return e.runWebGLProgram(l,[o],o.dtype)},bFt={kernelName:W1,backendName:"webgl",kernelFunc:yFt};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wFt{constructor(t,e,r,o,a){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=t,this.depth=t[3],this.depthRadius=e,this.bias=r,this.alpha=o,this.beta=a,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${e})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${e} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${o}) * norm + float(${r});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${o})
                * float(${a})
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${a});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CFt=n=>{const{inputs:t,backend:e,attrs:r}=n,{x:o,y:a,dy:i}=t,{depthRadius:s,bias:u,alpha:l,beta:c}=r,h=new wFt(o.shape,s,u,l,c);return e.runWebGLProgram(h,[o,a,i],o.dtype)},SFt={kernelName:hR,backendName:"webgl",kernelFunc:CFt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EFt(n,t,e,r){const o=It(t),i=It(n.shape)/o,s=Wt({inputs:{x:n},attrs:{shape:[i,o]},backend:r}),u=lh(s,n.dtype,"max",r),l=Wt({inputs:{x:u},attrs:{shape:e},backend:r});return r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(u),l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M6(n){const{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{reductionIndices:a,keepDims:i}=r,s=o.shape.length,u=_e(a,o.shape);let l=u;const c=Pn(l,s),h=c!=null,d=e.shouldExecuteOnCPU([o]);let p=o;if(h){if(d){const E=e.texData.get(p.dataId).values,S=new Array(s);for(let A=0;A<S.length;A++)S[A]=o.shape[c[A]];const k=fN(E,o.shape,o.dtype,c,S);p=e.makeTensorInfo(S,o.dtype);const R=e.texData.get(p.dataId);R.values=k}else p=Vb(o,c,e);l=er(l.length,s)}Gr("max",l,s);const[g,x]=Dr(p.shape,l);let y=g;i&&(y=lr(g,u));let b;if(d){const E=e.texData.get(p.dataId).values,S=_At(E,It(x),y,o.dtype);b=e.makeTensorInfo(y,o.dtype);const k=e.texData.get(b.dataId);k.values=S}else b=EFt(p,x,y,e);return h&&e.disposeIntermediateTensorInfo(p),b}const kFt={kernelName:V1,backendName:"webgl",kernelFunc:M6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IFt=dN+`
  return max(a, b);
`,RFt=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+uh+`
  return result;
`,TFt=Hr({opSnippet:IFt,packedOpSnippet:RFt,cpuKernelImpl:DAt}),NFt={kernelName:yg,backendName:"webgl",kernelFunc:TFt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AFt(n){const{inputs:t,backend:e,attrs:r}=n,{x:o}=t;iv(o,"maxPool");const{filterSize:a,strides:i,pad:s,dimRoundingMode:u}=r,l=1;H(ro(i,l),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${l}'`);const c=Ya(o.shape,a,i,l,s,u);if(c.filterWidth===1&&c.filterHeight===1&&tn(c.inShape,c.outShape))return Zo({inputs:{x:o},backend:e});const h=new xm(c,"max",!1);return e.runWebGLProgram(h,[o],o.dtype)}const _Ft={kernelName:G1,backendName:"webgl",kernelFunc:AFt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DFt(n){const{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{filterSize:a,strides:i,pad:s,dataFormat:u,dimRoundingMode:l}=r,c=[1,1,1],h=hu(o.shape,a,i,c,s,l,u),d=new mN(h,"max",!1);return e.runWebGLProgram(d,[o],o.dtype)}const $Ft={kernelName:H1,backendName:"webgl",kernelFunc:DFt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class OFt{constructor(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;const e=t.strideHeight,r=t.strideWidth,o=t.dilationHeight,a=t.effectiveFilterHeight,i=t.effectiveFilterWidth,s=a-1-t.padInfo.top,u=i-1-t.padInfo.left,l=a*i-1;this.userCode=`
      const ivec2 pads = ivec2(${s}, ${u});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${a};
          wR += ${o}) {
          float dyR = float(dyRCorner + wR) / ${e}.0;

          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${i}; wC++) {
            float dyC = float(dyCCorner + wC) / ${r}.0;

            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${l} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${i} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}class FFt{constructor(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;const e=t.strideDepth,r=t.strideHeight,o=t.strideWidth,a=t.dilationDepth,i=t.dilationHeight,s=t.dilationWidth,u=t.effectiveFilterDepth,l=t.effectiveFilterHeight,c=t.effectiveFilterWidth,h=u-1-t.padInfo.front,d=l-1-t.padInfo.top,p=c-1-t.padInfo.left,g=u*l*c-1;this.userCode=`
      const ivec3 pads = ivec3(${h}, ${d}, ${p});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${u};
           wD += ${a}) {
          float dyD = float(dyDCorner + wD) / ${e}.0;

          if (dyD < 0.0 || dyD >= ${t.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${l};
              wR += ${i}) {
            float dyR = float(dyRCorner + wR) / ${r}.0;

            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${c};
                wC += ${s}) {
              float dyC = float(dyCCorner + wC) / ${o}.0;

              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${g} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${l} * ${c} +
                  wR * ${c} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MFt(n){const{inputs:t,backend:e,attrs:r}=n,{dy:o,input:a}=t,i=a,{filterSize:s,strides:u,pad:l,dimRoundingMode:c}=r,h=[1,1,1],d=hu(i.shape,s,u,h,l,c),p=new mN(d,"max",!0),g=e.runWebGLProgram(p,[i],i.dtype),x=new FFt(d),y=e.runWebGLProgram(x,[o,g],i.dtype);return e.disposeIntermediateTensorInfo(g),y}const LFt={kernelName:dR,backendName:"webgl",kernelFunc:MFt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PFt(n){const{inputs:t,backend:e,attrs:r}=n,{dy:o,input:a,output:i}=t,s=a;iv([a,i],"maxPoolGrad");const{filterSize:u,strides:l,pad:c,dimRoundingMode:h}=r,d=Ya(s.shape,u,l,1,c,h),p=!0,g=new xm(d,"max",p),x=e.runWebGLProgram(g,[s],s.dtype),y=new OFt(d),b=e.runWebGLProgram(y,[o,x],s.dtype);return e.disposeIntermediateTensorInfo(x),b}const BFt={kernelName:fR,backendName:"webgl",kernelFunc:PFt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zFt(n,t,e,r){let o=new xm(e,"max",!1);const a=r.runWebGLProgram(o,[n],"float32");o=new xm(e,"max",!0,!0,t);const i=r.runWebGLProgram(o,[n],"float32");return[a,i]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UFt={kernelName:yz,backendName:"webgl",kernelFunc:({inputs:n,attrs:t,backend:e})=>{const{x:r}=n,{filterSize:o,strides:a,pad:i,includeBatchInIndex:s}=t,u=e;H(r.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${r.shape.length}.`);const l=[1,1];H(ro(a,l),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${a} and dilations '${l}'`);const c=Ya(r.shape,o,a,l,i),[h,d]=zFt(r,s,c,u);return[h,d]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WFt(n,t,e,r){const o=It(t),i=It(n.shape)/o,s=Wt({inputs:{x:n},attrs:{shape:[i,o]},backend:r}),u=lh(s,"float32","mean",r),l=Wt({inputs:{x:u},attrs:{shape:e},backend:r});return r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(u),l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VFt={kernelName:q1,backendName:"webgl",kernelFunc:({inputs:n,attrs:t,backend:e})=>{const{x:r}=n,{keepDims:o,axis:a}=t,i=e,s=r.shape.length,u=_e(a,r.shape);let l=u;const c=Pn(l,s),h=c!=null,d=i.shouldExecuteOnCPU([r]),p=[];let g=r;if(h){if(d){const S=i.texData.get(g.dataId).values,k=new Array(s);for(let N=0;N<k.length;N++)k[N]=r.shape[c[N]];const R=fN(S,r.shape,r.dtype,c,k);g=i.makeTensorInfo(k,r.dtype);const A=i.texData.get(g.dataId);A.values=R}else g=Vb(r,c,i);p.push(g),l=er(l.length,s)}Gr("sum",l,s);const[x,y]=Dr(g.shape,l);let b=x;o&&(b=lr(x,u));const C=WFt(g,y,b,i);for(const E of p)i.disposeIntermediateTensorInfo(E);return C}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GFt(n){const{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{axis:a,keepDims:i}=r,s=o.shape.length,u=_e(a,o.shape);let l=u;const c=Pn(l,s);let h=o;c!=null&&(h=Co({inputs:{x:o},backend:e,attrs:{perm:c}}),l=er(l.length,o.shape.length)),Gr("min",l,s);const[d,p]=Dr(h.shape,l),g=It(p),x=Wt({inputs:{x:h},backend:e,attrs:{shape:[-1,g]}}),y=lh(x,x.dtype,"min",e);let b;if(i){const C=lr(d,u);b=Wt({inputs:{x:y},backend:e,attrs:{shape:C}})}else b=Wt({inputs:{x:y},backend:e,attrs:{shape:d}});return e.disposeIntermediateTensorInfo(x),e.disposeIntermediateTensorInfo(y),c!=null&&e.disposeIntermediateTensorInfo(h),b}const HFt={kernelName:j1,backendName:"webgl",kernelFunc:GFt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qFt=dN+`
  return min(a, b);
`,jFt=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+uh+`
  return result;
`,XFt=Hr({opSnippet:qFt,packedOpSnippet:jFt,cpuKernelImpl:$At}),KFt={kernelName:bg,backendName:"webgl",kernelFunc:XFt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class YFt{constructor(t,e,r){this.variableNames=["x"],this.outputShape=e.map((c,h)=>c[0]+t[h]+c[1]);const o=t.length,a=pn(o),i=e.map(c=>c[0]).join(","),s=e.map((c,h)=>c[0]+t[h]).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,o),l=r==="reflect"?0:1;if(o===1){this.userCode=`
        int start = ${i};
        int end = ${s};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${l};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${l};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${a} start = ${a}(${i});
      ${a} end = ${a}(${s});

      void main() {
        ${a} outC = getOutputCoords();
        for (int i = 0; i < ${o}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${l};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${l};
          }
        }
        ${a} coords = outC - start;
        setOutput(getX(${u}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class QFt{constructor(t,e,r){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.map((g,x)=>g[0]+t[x]+g[1]);const o=t.length,a=pn(o),i=e.map(g=>g[0]).join(","),s=e.map((g,x)=>g[0]+t[x]).join(","),u=xo("rc",o),l=xo("source",o),c=`${u[o-1]} < ${this.outputShape[o-1]}`,h=o===1?"source":`vec2(${l.slice(-2).join()})`,d=r==="reflect"?0:1;let p="";if(o===1){const g=`
        ${a} source = rc;
        if (source < start) {
          source = start * 2 - source - ${d};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${d};
        }
        source -= start;
      `;p=`
        ${a} rc = outputLoc;
        ${g}
        result[0] = getChannel(getX(${l.join()}), ${h});
        ${u[o-1]} += 1;
        if(${c}) {
          ${g}
          result[1] = getChannel(getX(${l.join()}), ${h});
        }
      `}else{const g=`
        ${a} source = rc;
        ${a} lt = ${a}(lessThan(source, start));
        ${a} gte = ${a}(greaterThanEqual(source, end));
        ${a} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${d}) +
                gte * ((end - 1) * 2 - source + ${d});
        source -= start;
      `;p=`
        ${a} rc = outputLoc;
        ${g}
        result[0] = getChannel(getX(${l.join()}), ${h});
        ${u[o-1]} += 1;
        if(${c}) {
          ${g}
          result[1] = getChannel(getX(${l.join()}), ${h});
        }
        rc = outputLoc;
        ${u[o-2]} += 1;
        if(${u[o-2]} < ${this.outputShape[o-2]}) {
          ${g}
          result[2] = getChannel(getX(${l.join()}), ${h});
          ${u[o-1]} += 1;
          if(${c}) {
            ${g}
            result[3] = getChannel(getX(${l.join()}), ${h});
          }
        }
      `}this.userCode=`
      const ${a} start = ${a}(${i});
      const ${a} end = ${a}(${s});

      void main() {
        ${a} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${p}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZFt=({inputs:n,backend:t,attrs:e})=>{const{x:r}=n,{paddings:o,mode:a}=e,i=yt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new QFt(r.shape,o,a):new YFt(r.shape,o,a);return t.runWebGLProgram(i,[r],r.dtype)},JFt={kernelName:X1,backendName:"webgl",kernelFunc:ZFt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tMt=`if (b == 0.0) return NAN;
  return mod(a, b);`,eMt=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+uh+`
  return result;
`,nMt=Hr({opSnippet:tMt,packedOpSnippet:eMt}),rMt={kernelName:wg,backendName:"webgl",kernelFunc:nMt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class oMt{constructor(t,e,r){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[t,r],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${e-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${e-1}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aMt=`
if (a == b) {
  return 1.0;
};
return a / b;`,iMt=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,L6=Hr({opSnippet:aMt,packedOpSnippet:iMt,checkOutOfBounds:!0}),sMt={kernelName:ag,backendName:"webgl",kernelFunc:L6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sM="return a - b;",P6=Hr({opSnippet:sM,packedOpSnippet:sM,supportsComplex:!0,cpuKernelImpl:t_t}),uMt={kernelName:Lg,backendName:"webgl",kernelFunc:P6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B6(n){const{inputs:t,backend:e,attrs:r}=n,{logits:o}=t,{dim:a}=r,i=_e([a],o.shape),s=M6({inputs:{x:o},backend:e,attrs:{reductionIndices:i,keepDims:!1}}),u=lr(s.shape,i),l=Wt({inputs:{x:s},backend:e,attrs:{shape:u}}),c=P6({inputs:{a:o,b:l},backend:e}),h=$6({inputs:{x:c},backend:e}),d=Gb({inputs:{x:h},backend:e,attrs:{axis:i,keepDims:!1}}),p=Wt({inputs:{x:d},backend:e,attrs:{shape:u}}),g=L6({inputs:{a:h,b:p},backend:e});return e.disposeIntermediateTensorInfo(s),e.disposeIntermediateTensorInfo(l),e.disposeIntermediateTensorInfo(c),e.disposeIntermediateTensorInfo(h),e.disposeIntermediateTensorInfo(d),e.disposeIntermediateTensorInfo(p),g}const lMt={kernelName:fb,backendName:"webgl",kernelFunc:B6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cMt(n){const{inputs:t,backend:e,attrs:r}=n,{logits:o}=t,{numSamples:a,seed:i,normalized:s}=r,u=s?o:B6({inputs:{logits:o},backend:e,attrs:{dim:o.shape.length-1}}),l=u.shape[0],c=u.shape[1],h=new oMt(l,c,a),d=[[i]],p=e.runWebGLProgram(h,[u],"int32",d);return s||e.disposeIntermediateTensorInfo(u),p}const hMt={kernelName:bz,backendName:"webgl",kernelFunc:cMt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fMt=Za+`
  return -x;
`,dMt=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function pMt(n){const{inputs:t,backend:e}=n,{x:r}=t;if(e.shouldExecuteOnCPU([r])){const a=e.texData.get(r.dataId),[i,s]=FAt(a.values,r.shape,r.dtype);return e.makeTensorInfo(s,r.dtype,i)}let o;return yt().getBool("WEBGL_PACK_UNARY_OPERATIONS")?o=new Ku(r.shape,dMt):o=new ji(r.shape,fMt),e.runWebGLProgram(o,[r],r.dtype)}const mMt={kernelName:K1,backendName:"webgl",kernelFunc:pMt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gMt=eT;function vMt(n){pa("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:e,attrs:r}=n,{boxes:o,scores:a}=t,{maxOutputSize:i,iouThreshold:s,scoreThreshold:u}=r,l=e.readSync(o.dataId),c=e.readSync(a.dataId),{selectedIndices:h}=gMt(l,c,i,s,u);return e.makeTensorInfo([h.length],"int32",new Int32Array(h))}const xMt={kernelName:pR,backendName:"webgl",kernelFunc:vMt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yMt=nT;function bMt(n){pa("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:e,attrs:r}=n,{boxes:o,scores:a}=t,{maxOutputSize:i,iouThreshold:s,scoreThreshold:u,padToMaxOutputSize:l}=r,c=e.readSync(o.dataId),h=e.readSync(a.dataId),{selectedIndices:d,validOutputs:p}=yMt(c,h,i,s,u,l);return[e.makeTensorInfo([d.length],"int32",new Int32Array(d)),e.makeTensorInfo([],"int32",new Int32Array([p]))]}const wMt={kernelName:mR,backendName:"webgl",kernelFunc:bMt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CMt=rT;function SMt(n){pa("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:e,attrs:r}=n,{boxes:o,scores:a}=t,{maxOutputSize:i,iouThreshold:s,scoreThreshold:u,softNmsSigma:l}=r,c=e.readSync(o.dataId),h=e.readSync(a.dataId),d=i,p=s,g=u,x=l,{selectedIndices:y,selectedScores:b}=CMt(c,h,d,p,g,x);return[e.makeTensorInfo([y.length],"int32",new Int32Array(y)),e.makeTensorInfo([b.length],"float32",new Float32Array(b))]}const EMt={kernelName:gR,backendName:"webgl",kernelFunc:SMt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kMt{constructor(t,e,r,o){this.variableNames=["indices"],this.outputShape=[t,e],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${o}), float(${r}),
                      float(index == coords.y)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IMt=n=>{const{inputs:t,backend:e,attrs:r}=n,{indices:o}=t,{dtype:a,depth:i,onValue:s,offValue:u}=r,l=It(o.shape),c=new kMt(l,i,s,u),h=Wt({inputs:{x:o},backend:e,attrs:{shape:[l]}}),d=e.runWebGLProgram(c,[h],a);e.disposeIntermediateTensorInfo(h);const p=[...o.shape,i],g=Wt({inputs:{x:d},backend:e,attrs:{shape:p}});return e.disposeIntermediateTensorInfo(d),g},RMt={kernelName:Z1,backendName:"webgl",kernelFunc:IMt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gy(n){const{inputs:t,backend:e}=n,{x:r}=t;if(r.dtype==="complex64"){const o=uv({inputs:{input:r},backend:e}),a=Gy({inputs:{x:o},backend:e}),i=Hb({inputs:{input:r},backend:e}),s=Gy({inputs:{x:i},backend:e}),u=Nl({inputs:{real:a,imag:s},backend:e});return e.disposeIntermediateTensorInfo(o),e.disposeIntermediateTensorInfo(a),e.disposeIntermediateTensorInfo(i),e.disposeIntermediateTensorInfo(s),u}else return lv({attrs:{shape:r.shape,dtype:r.dtype,value:r.dtype==="string"?"":0},backend:e})}const TMt={kernelName:mb,backendName:"webgl",kernelFunc:Gy};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z6(n){const{inputs:t,backend:e}=n,{x:r}=t;if(r.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(r.dtype==="complex64"){const o=uv({inputs:{input:r},backend:e}),a=z6({inputs:{x:o},backend:e}),i=Hb({inputs:{input:r},backend:e}),s=Gy({inputs:{x:i},backend:e}),u=Nl({inputs:{real:a,imag:s},backend:e});return e.disposeIntermediateTensorInfo(o),e.disposeIntermediateTensorInfo(a),e.disposeIntermediateTensorInfo(i),e.disposeIntermediateTensorInfo(s),u}else return lv({attrs:{shape:r.shape,dtype:r.dtype,value:1},backend:e})}const NMt={kernelName:Q1,backendName:"webgl",kernelFunc:z6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AMt(n){const{inputs:t,backend:e,attrs:r}=n,{axis:o}=r;if(t.length===1)return tk({inputs:{input:t[0]},backend:e,attrs:{dim:o}});const a=t[0].shape,i=t[0].dtype;t.forEach(c=>{LI(a,c.shape,"All tensors passed to stack must have matching shapes"),H(i===c.dtype,()=>"All tensors passed to stack must have matching dtypes")});const s=[],u=t.map(c=>{const h=tk({inputs:{input:c},backend:e,attrs:{dim:o}});return s.push(h),h}),l=k6({inputs:u,backend:e,attrs:{axis:o}});return s.forEach(c=>e.disposeIntermediateTensorInfo(c)),l}const _Mt={kernelName:J1,backendName:"webgl",kernelFunc:AMt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class DMt{constructor(t,e,r){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=e.map((l,c)=>l[0]+t[c]+l[1]);const o=t.length,a=pn(o),i=e.map(l=>l[0]).join(","),s=e.map((l,c)=>l[0]+t[c]).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,o);if(o===1){this.userCode=`
        int start = ${i};
        int end = ${s};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${a} start = ${a}(${i});
      ${a} end = ${a}(${s});

      void main() {
        ${a} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${a} coords = outC - start;
          setOutput(getX(${u}));
        }
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $Mt{constructor(t,e,r){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=e.map((x,y)=>x[0]+t[y]+x[1]);const o=t.length,a=pn(o),i=e.map(x=>x[0]).join(","),s=e.map((x,y)=>x[0]+t[y]).join(","),u=xo("rc",o),l=xo("source",o),c=`${u[o-1]} < ${this.outputShape[o-1]}`,h=o===1?"source":`vec2(${l.slice(-2).join()})`,d=[`${a} rc = outputLoc;`,`${u[o-1]} += 1;
       if(${c}) {
      `,o===1?"":`}
       rc = outputLoc;
       ${u[o-2]} += 1;
       if(${u[o-2]} < ${this.outputShape[o-2]}) {`,o===1?"":`  ${u[o-1]} += 1;
         if(${c}) {`],p=o===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let g="";for(let x=0,y=o===1?2:4;x<y;x++)g+=`
        ${d[x]}
        if (${p}) {
          result[${x}] = float(value);
        } else {
          ${a} source = rc - start;
          result[${x}] = getChannel(getX(${l.join()}), ${h});
        }
      `;g+=o===1?"} ":"}}",this.userCode=`
      const ${a} start = ${a}(${i});
      const ${a} end = ${a}(${s});

      void main() {
        ${a} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${g}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U6=n=>{const{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{paddings:a,constantValue:i}=r;if(It(o.shape)===0){const l=a.map((c,h)=>c[0]+o.shape[h]+c[1]);return lv({backend:e,attrs:{shape:l,value:i,dtype:o.dtype}})}const s=yt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new $Mt(o.shape,a,i):new DMt(o.shape,a,i),u=[[i]];return e.runWebGLProgram(s,[o],o.dtype,u)},OMt={kernelName:tb,backendName:"webgl",kernelFunc:U6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FMt=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,MMt=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+uh+`
  return result;
`,LMt=Hr({opSnippet:FMt,packedOpSnippet:MMt}),PMt={kernelName:Sg,backendName:"webgl",kernelFunc:LMt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BMt(n){const{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{axis:a,keepDims:i}=r,s=o.shape.length,u=[],l=_e(a,o.shape);let c=l;const h=Pn(c,s);let d=o;h!=null&&(d=Co({inputs:{x:o},backend:e,attrs:{perm:h}}),c=er(c.length,s),u.push(d)),Gr("prod",c,s);let p;if(e.shouldExecuteOnCPU([d])){const g=e.texData.get(d.dataId).values,{outVals:x,outShape:y,outDtype:b}=LAt(d.shape,d.dtype,g,c);p=e.makeTensorInfo(y,b,x)}else{const[g,x]=Dr(d.shape,c),y=It(x),b=Wt({inputs:{x:d},backend:e,attrs:{shape:[-1,y]}}),C=TR(o.dtype),E=lh(b,C,"prod",e);p=Wt({inputs:{x:E},backend:e,attrs:{shape:g}}),u.push(b),u.push(E)}if(i){u.push(p);const g=lr(p.shape,l);p=Wt({inputs:{x:p},backend:e,attrs:{shape:g}})}return u.forEach(g=>e.disposeIntermediateTensorInfo(g)),p}const zMt={kernelName:nb,backendName:"webgl",kernelFunc:BMt};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UMt(n){const{inputs:t,backend:e,attrs:r}=n,{paramsNestedSplits:o,paramsDenseValues:a,indices:i}=t,{outputRaggedRank:s}=r,u=o.map(b=>e.readSync(b.dataId)),l=o.map(b=>b.shape),c=e.readSync(a.dataId),h=e.readSync(i.dataId),[d,p,g]=PAt(u,l,c,a.shape,a.dtype,h,i.shape,s),x=d.map(b=>e.makeTensorInfo([b.length],"int32",b)),y=e.makeTensorInfo(g,a.dtype,p);return x.concat([y])}const WMt={kernelName:wz,backendName:"webgl",kernelFunc:UMt};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VMt(n){const{inputs:t,backend:e}=n,{starts:r,limits:o,deltas:a}=t,i=e.readSync(r.dataId),s=e.readSync(o.dataId),u=e.readSync(a.dataId),[l,c]=BAt(i,r.shape,r.dtype,s,o.shape,u,a.shape),h=e.makeTensorInfo([l.length],"int32",l),d=e.makeTensorInfo([c.length],r.dtype,c);return[h,d]}const GMt={kernelName:Cz,backendName:"webgl",kernelFunc:VMt};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HMt(n){const{inputs:t,backend:e,attrs:r}=n,{shape:o,values:a,defaultValue:i,rowPartitionTensors:s}=t,{rowPartitionTypes:u}=r,l=e.readSync(o.dataId),c=e.readSync(a.dataId),h=e.readSync(i.dataId),d=s.map(y=>e.readSync(y.dataId)),p=s.map(y=>y.shape),[g,x]=zAt(l,o.shape,c,a.shape,a.dtype,h,i.shape,d,p,u);return e.makeTensorInfo(g,a.dtype,x)}const qMt={kernelName:Sz,backendName:"webgl",kernelFunc:HMt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const W6=n=>{const{backend:t,attrs:e}=n,{start:r,stop:o,step:a,dtype:i}=e,s=UAt(r,o,a,i);return t.makeTensorInfo([s.length],i,s)},jMt={kernelName:vR,backendName:"webgl",kernelFunc:W6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XMt="return 1.0 / x;",KMt=Ve({opSnippet:XMt}),YMt={kernelName:Eg,backendName:"webgl",kernelFunc:KMt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QMt=Za+`
  return (x < 0.0) ? 0.0 : x;
`,ZMt=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,JMt=Ve({opSnippet:QMt,packedOpSnippet:ZMt}),t4t={kernelName:kg,backendName:"webgl",kernelFunc:JMt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const e4t=Za+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,n4t=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,r4t=Ve({opSnippet:e4t,packedOpSnippet:n4t}),o4t={kernelName:Ig,backendName:"webgl",kernelFunc:r4t};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class a4t{constructor(t,e,r,o,a){this.variableNames=["A"],this.outputShape=[];const[i,s,u,l]=t;this.outputShape=[i,e,r,l];const c=[o&&e>1?s-1:s,o&&r>1?u-1:u],h=[o&&e>1?e-1:e,o&&r>1?r-1:r];let d;a?d="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":d="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${c[0]/h[0]},
          ${c[1]/h[1]});
      const vec2 inputShapeRC = vec2(${s}.0, ${u}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${d};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class i4t{constructor(t,e,r,o,a){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[i,s,u,l]=t;this.outputShape=[i,e,r,l];const c=[o&&e>1?s-1:s,o&&r>1?u-1:u],h=[o&&e>1?e-1:e,o&&r>1?r-1:r];let d;a?d="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":d="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${c[0]/h[0]},
          ${c[1]/h[1]},
          ${c[1]/h[1]});
      const vec3 inputShapeRC = vec3(${s}.0, ${u}.0,
                                     ${u}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${d};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${l-1};
        bool hasNextRow = coords.z < ${r-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s4t(n){const{inputs:t,backend:e,attrs:r}=n,{images:o}=t,{alignCorners:a,halfPixelCenters:i,size:s}=r,[u,l]=s,c=yt().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new i4t(o.shape,u,l,a,i):new a4t(o.shape,u,l,a,i);return e.runWebGLProgram(c,[o],"float32")}const u4t={kernelName:ab,backendName:"webgl",kernelFunc:s4t};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class l4t{constructor(t,e,r){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e;const[,o,a]=e,[,i,s]=t,u=[r&&i>1?o-1:o,r&&s>1?a-1:a],l=[r&&i>1?i-1:i,r&&s>1?s-1:s],c=u[0]/l[0],h=u[1]/l[1],d=1/c,p=1/h,g=Math.ceil(d)*2+2,x=Math.ceil(p)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${c});
        const float widthScale = float(${h});

        const float invHeightScale = float(${d});
        const float invWidthScale = float(${p});

        const int winHeight = int(${g});
        const int winWidth = int(${x});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${i}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${s}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${o-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${a-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c4t(n){const{inputs:t,backend:e,attrs:r}=n,{images:o,dy:a}=t,{alignCorners:i}=r,s=new l4t(a.shape,o.shape,i);return e.runWebGLProgram(s,[a],a.dtype)}const h4t={kernelName:bR,backendName:"webgl",kernelFunc:c4t};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class f4t{constructor(t,e,r,o,a){this.variableNames=["A"],this.outputShape=[];const[i,s,u,l]=t;this.outputShape=[i,e,r,l];const c=[o&&e>1?s-1:s,o&&r>1?u-1:u],h=[o&&e>1?e-1:e,o&&r>1?r-1:r],d=o?"0.5":"0.0";let p;a?p="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":p="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${c[0]/h[0]},
          ${c[1]/h[1]});
      const vec2 inputShapeRC = vec2(${s}.0, ${u}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${p};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${d})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class d4t{constructor(t,e,r,o,a){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[i,s,u,l]=t;this.outputShape=[i,e,r,l];const c=[o&&e>1?s-1:s,o&&r>1?u-1:u],h=[o&&e>1?e-1:e,o&&r>1?r-1:r],d=o?"0.5":"0.0";let p;a?p="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":p="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${c[0]/h[0]},
          ${c[1]/h[1]},
          ${c[1]/h[1]});
      const vec3 inputShapeRC = vec3(${s}.0, ${u}.0,
                                     ${u}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${p};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${d})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${l-1};
        bool hasNextRow = coords.z < ${r-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p4t(n){const{inputs:t,backend:e,attrs:r}=n,{images:o}=t,{alignCorners:a,halfPixelCenters:i,size:s}=r,[u,l]=s,c=yt().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new d4t(o.shape,u,l,a,i):new f4t(o.shape,u,l,a,i);return e.runWebGLProgram(c,[o],o.dtype)}const m4t={kernelName:ob,backendName:"webgl",kernelFunc:p4t};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class g4t{constructor(t,e,r){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e;const[,o,a]=e,[,i,s]=t,u=[r&&i>1?o-1:o,r&&s>1?a-1:a],l=[r&&i>1?i-1:i,r&&s>1?s-1:s],c=u[0]/l[0],h=u[1]/l[1],d=1/c,p=1/h,g=Math.ceil(d)*2+2,x=Math.ceil(p)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${c});
        const float widthScale = float(${h});

        const float invHeightScale = float(${d});
        const float invWidthScale = float(${p});

        const int winHeight = int(${g});
        const int winWidth = int(${x});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${i}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${s}) {
              continue;
            }

            float sourceFracRow =
              float(${u[0]}) *
                (float(dyR) / float(${l[0]}));

            float sourceFracCol =
                float(${u[1]}) *
                  (float(dyC) / float(${l[1]}));

            int sourceNearestRow = int(min(
                float(int(${o}) - 1),
                ${r} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${a}) - 1),
                ${r} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v4t(n){const{inputs:t,backend:e,attrs:r}=n,{images:o,dy:a}=t,{alignCorners:i}=r,s=new g4t(a.shape,o.shape,i);return e.runWebGLProgram(s,[a],a.dtype)}const x4t={kernelName:yR,backendName:"webgl",kernelFunc:v4t};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class y4t{constructor(t,e){this.variableNames=["x"];const r=t.length;if(r>4)throw new Error(`WebGL backend: Reverse of rank-${r} tensor is not yet supported`);if(this.outputShape=t,r===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${t[0]} - coord - 1));
        }
      `;return}const o=s=>e.indexOf(s)!==-1&&t[s]!==1?`${t[s]} - coords[${s}] - 1`:`coords[${s}]`,a=t.map((s,u)=>o(u)).join(","),i=pn(r);this.userCode=`
      void main() {
        ${i} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class b4t{constructor(t,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const r=t.length;if(r>4)throw new Error(`WebGL backend: Reverse of rank-${r} tensor is not yet supported`);this.outputShape=t;const o=xo("rc",r),a=`${o[r-1]} + 1 < ${this.outputShape[r-1]}`,i=`${o[r-2]} + 1 < ${this.outputShape[r-2]}`,s=pn(r);r===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${t[0]} - rc - 1),
            ${t[0]} - rc - 1);
          if(${a}){
              result.g = getChannel(getX(${t[0]} - (rc  + 1) - 1),
                ${t[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${s} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${u(o.slice())};
          if(${a}){
            result.g = ${l(o.slice())};
          }
          if(${i}) {
            result.b = ${c(o.slice())};
            if(${a}) {
              result.a = ${h(o.slice())};
            }
          }
          setOutput(result);
        }
    `;function u(g){return d(g)}function l(g){return g[r-1]="("+g[r-1]+" + 1)",d(g)}function c(g){return g[r-2]="("+g[r-2]+" + 1)",d(g)}function h(g){return g[r-1]="("+g[r-1]+" + 1)",g[r-2]="("+g[r-2]+" + 1)",d(g)}function d(g){const x=t.map((C,E)=>p(E,g)),y=x.join(","),b=x.slice(-2).join(",");return`getChannel(getX(${y}), vec2(${b}))`}function p(g,x){return e.indexOf(g)!==-1&&t[g]!==1?`${t[g]} - ${x[g]} - 1`:`${x[g]}`}}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w4t(n){const{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{dims:a}=r,i=o.shape.length,s=_e(a,o.shape);if(i===0)return Zo({inputs:{x:o},backend:e});const u=yt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new b4t(o.shape,s):new y4t(o.shape,s);return e.runWebGLProgram(u,[o],o.dtype)}const C4t={kernelName:ib,backendName:"webgl",kernelFunc:w4t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class S4t{constructor(t,e){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const r=t[1],o=t[2];this.outputShape=t;let a="";typeof e=="number"?a=`float outputValue = ${e.toFixed(2)};`:a=`
        vec3 fill = vec3(${e.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${a}
          if(coordX >= 0 && coordX < ${o} && coordY >= 0 && coordY < ${r}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const E4t={kernelName:RR,backendName:"webgl",kernelFunc:({inputs:n,attrs:t,backend:e})=>{const{image:r}=n,{radians:o,fillValue:a,center:i}=t,s=e,u=new S4t(r.shape,a),[l,c]=pT(i,r.shape[1],r.shape[2]),h=[[l,c,Math.sin(o),Math.cos(o)]];return s.runWebGLProgram(u,[r],r.dtype,h)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const k4t=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,I4t=Ve({opSnippet:k4t}),R4t={kernelName:Rg,backendName:"webgl",kernelFunc:I4t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T4t="return inversesqrt(x);",N4t=Ve({opSnippet:T4t,cpuKernelImpl:WAt}),A4t={kernelName:Tg,backendName:"webgl",kernelFunc:N4t};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gN{constructor(t,e,r,o,a,i,s=!0,u=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=i;const l=pn(a.length),c=pn(i.length);let h="";r===1?h="i":r===2&&(h="i, j");const d=`getIndices(${h})`;let p="";o===1?p="i":o===2&&(p="i, coords[1]");const g=`getUpdates(${p})`;let x="";u&&(x="coords[0], coords[1]");const y=`getDefaultValue(${x})`,b=e>1?"strides[j]":"strides";this.userCode=`
        ${l} strides = ${l}(${a});

        void main() {
          ${c} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${t}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${e}; j++) {
              int index = round(${d});
              flattenedIndex += index * ${b};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${g};
              found = true;
            }
          }
          setOutput(mix(${y}, sum, float(found)));
        }
      `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _4t{constructor(t,e,r,o,a,i,s=!0,u=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=i;const l=pn(a.length),c=pn(i.length);let h="";r===1?h="i":r===2&&(h="i, j");const d=`getIndices(${h})`;let p="";o===1?p="i":o===2&&(p="i, coords[1]");const g=`getUpdates(${p})`;let x="";u&&(x="coords[0], coords[1]");const y=`getDefaultValue(${x})`,b=e>1?"strides[j]":"strides",C=e>1?"strides[j + 1]":"strides";this.userCode=`
        ${l} strides = ${l}(${a});

        void main() {
          ${c} coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < ${t}; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < ${e}; j+=2) {
              ivec4 index = round(${d});
              flattenedIndex += index.xz * ${b};
              if (j + 1 < ${e}) {
                flattenedIndex += index.yw * ${C};
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = ${g};
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(${y}, sum, found));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D4t(n){const{inputs:t,backend:e,attrs:r}=n,{indices:o,updates:a}=t,{shape:i}=r,{sliceRank:s,numUpdates:u,sliceSize:l,strides:c,outputSize:h}=rh(a,o,i),d=[h/l,l];if(h===0)return e.makeTensorInfo(i,o.dtype);const p=Wt({inputs:{x:o},backend:e,attrs:{shape:[u,s]}}),g=Wt({inputs:{x:a},backend:e,attrs:{shape:[u,l]}}),x=e.makeTensorInfo([],"float32",new Float32Array([0]));let y;yt().getBool("WEBGL_PACK")?y=new _4t(u,s,p.shape.length,g.shape.length,c,d):y=new gN(u,s,p.shape.length,g.shape.length,c,d);const b=e.runWebGLProgram(y,[g,p,x],g.dtype),C=Wt({inputs:{x:b},backend:e,attrs:{shape:i}});return e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(g),e.disposeIntermediateTensorInfo(b),e.disposeIntermediateTensorInfo(x),C}const $4t={kernelName:Ez,backendName:"webgl",kernelFunc:D4t};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class O4t{constructor(t,e,r,o){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[t,r];const a="while (left < right) {",i=`for (int i = 0; i < ${Math.ceil(Math.log2(e+1))}; ++i) { if (left >= right) break;`,s=yt().getNumber("WEBGL_VERSION")===2?a:i,u=o==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${s}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${u} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F4t(n){const{inputs:t,backend:e,attrs:r}=n,{sortedSequence:o,values:a}=t,{side:i}=r,s=new O4t(o.shape[0],o.shape[1],a.shape[1],i),u=[[o.shape[1]]];return e.runWebGLProgram(s,[o,a],"int32",u)}const M4t={kernelName:Iz,backendName:"webgl",kernelFunc:F4t};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class L4t{constructor(t,e,r){this.variableNames=["c","a","b"],this.outputShape=e;let o,a;if(r>4)throw Error(`Where for rank ${r} is not yet supported`);if(r===1)a="resRC",o="resRC";else{const s=["resRC.x","resRC.y","resRC.z","resRC.w"],u=[],l=[];for(let c=0;c<e.length;c++)l.push(`${s[c]}`),c<t&&u.push(`${s[c]}`);o=u.join(),a=l.join()}const i=pn(r);this.userCode=`
      void main() {
        ${i} resRC = getOutputCoords();
        float cVal = getC(${o});
        if (cVal >= 1.0) {
          setOutput(getA(${a}));
        } else {
          setOutput(getB(${a}));
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P4t(n){const{inputs:t,backend:e}=n,{condition:r,t:o,e:a}=t,i=new L4t(r.shape.length,o.shape,o.shape.length);return e.runWebGLProgram(i,[r,o,a],Yo(o.dtype,a.dtype))}const B4t={kernelName:sb,backendName:"webgl",kernelFunc:P4t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const z4t=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${Rb};
  float scale = ${Tb};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,U4t=Ve({opSnippet:z4t}),W4t={kernelName:Ng,backendName:"webgl",kernelFunc:U4t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const V4t=Ed+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,G4t=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,H4t=Ve({opSnippet:V4t,packedOpSnippet:G4t,cpuKernelImpl:GAt}),q4t={kernelName:$g,backendName:"webgl",kernelFunc:H4t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const j4t=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,X4t=Ve({opSnippet:j4t}),K4t={kernelName:Dg,backendName:"webgl",kernelFunc:X4t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y4t=Ed+`
  return sin(x);
`,Q4t=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  ${uh}
  return result;
`,Z4t=Ve({opSnippet:Y4t,packedOpSnippet:Q4t}),J4t={kernelName:Ag,backendName:"webgl",kernelFunc:Z4t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tLt=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,eLt=Ve({opSnippet:tLt}),nLt={kernelName:_g,backendName:"webgl",kernelFunc:eLt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rLt=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,oLt=Ve({opSnippet:rLt}),aLt={kernelName:Og,backendName:"webgl",kernelFunc:oLt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iLt=n=>{const{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{blockShape:a,paddings:i}=r;H(o.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const s=a.reduce((b,C)=>b*C),u=[[0,0]];u.push(...i);for(let b=1+a.length;b<o.shape.length;++b)u.push([0,0]);const l=[],c=U6({inputs:{x:o},backend:e,attrs:{paddings:u,constantValue:0}}),h=jg(c.shape,a,s,!1),d=Xg(h.length,a.length,!1),p=Kg(c.shape,a,s,!1),g=Wt({inputs:{x:c},backend:e,attrs:{shape:h}}),x=Co({inputs:{x:g},backend:e,attrs:{perm:d}}),y=Wt({inputs:{x},backend:e,attrs:{shape:p}});return l.push(c),l.push(g),l.push(x),l.forEach(b=>e.disposeIntermediateTensorInfo(b)),y},sLt={kernelName:cb,backendName:"webgl",kernelFunc:iLt};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uLt(n){const{inputs:t,backend:e}=n,{indices:r,values:o,denseShape:a,defaultValue:i}=t;if(a.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${a.shape}`);if(r.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${r.shape}`);if(o.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${o.shape}`);if(i.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${i.shape}`);const s=e.readSync(r.dataId),u=e.readSync(o.dataId),l=e.readSync(a.dataId),c=e.readSync(i.dataId)[0],[h,d,p,g,x]=qAt(s,r.shape,r.dtype,u,o.dtype,l,c);return[e.makeTensorInfo(d,r.dtype,h),e.makeTensorInfo([d[0]],o.dtype,p),e.makeTensorInfo([g.length],"bool",new Uint8Array(g.map(y=>Number(y)))),e.makeTensorInfo([x.length],r.dtype,new Int32Array(x))]}const lLt={kernelName:Rz,backendName:"webgl",kernelFunc:uLt};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cLt(n){const{inputs:t,backend:e}=n,{inputIndices:r,inputShape:o,newShape:a}=t;if(r.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${r.shape}`);if(o.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${o.shape}`);if(a.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${a.shape}`);const i=Array.from(e.readSync(o.dataId)),s=e.readSync(r.dataId),u=Array.from(e.readSync(a.dataId)),[l,c,h]=jAt(s,r.shape,r.dtype,i,u);return[e.makeTensorInfo(c,r.dtype,l),e.makeTensorInfo([h.length],a.dtype,new Int32Array(h))]}const hLt={kernelName:Tz,backendName:"webgl",kernelFunc:cLt};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fLt(n){const{inputs:t,backend:e}=n,{data:r,indices:o,segmentIds:a}=t;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(o.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${o.shape}`);if(a.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${a.shape}`);const i=e.readSync(r.dataId),s=e.readSync(o.dataId),u=e.readSync(a.dataId),[l,c]=f6(i,r.shape,r.dtype,s,u,!0);return e.makeTensorInfo(c,r.dtype,l)}const dLt={kernelName:Nz,backendName:"webgl",kernelFunc:fLt};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pLt(n){const{inputs:t,backend:e}=n,{data:r,indices:o,segmentIds:a}=t;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(o.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${o.shape}`);if(a.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${a.shape}`);const i=e.readSync(r.dataId),s=e.readSync(o.dataId),u=e.readSync(a.dataId),[l,c]=f6(i,r.shape,r.dtype,s,u);return e.makeTensorInfo(c,r.dtype,l)}const mLt={kernelName:Az,backendName:"webgl",kernelFunc:pLt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gLt(n){const{inputs:t,backend:e,attrs:r}=n,{sparseIndices:o,sparseValues:a,defaultValue:i}=t,{outputShape:s}=r,{sliceRank:u,numUpdates:l,sliceSize:c,strides:h,outputSize:d}=rh(a,o,s),p=!1;if(a.dtype==="string"){const b=e.bufferSync(o),C=e.bufferSync(a),E=sl(e.readSync(i.dataId)[0]),S=VAt(b,C,s,d,c,l,u,h,E,p);return e.makeTensorInfo(s,S.dtype,S.values)}const g=new gN(l,u,o.shape.length,a.shape.length,h,[d,1],p),x=e.runWebGLProgram(g,[a,o,i],a.dtype),y=Wt({inputs:{x},backend:e,attrs:{shape:s}});return e.disposeIntermediateTensorInfo(x),y}const vLt={kernelName:_z,backendName:"webgl",kernelFunc:gLt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xLt(n){const{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{numOrSizeSplits:a,axis:i}=r,s=_e(i,o.shape)[0],u=NT(o,a,s),l=o.shape.length,c=new Array(l).fill(0),h=o.shape.slice();return u.map(d=>{const p=[...h];p[s]=d;const g=kd({inputs:{x:o},backend:e,attrs:{begin:c,size:p}});return c[s]+=d,g})}const yLt={kernelName:hb,backendName:"webgl",kernelFunc:xLt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uM="return sqrt(x);",bLt=Ve({opSnippet:uM,packedOpSnippet:uM,cpuKernelImpl:XAt}),wLt={kernelName:Fg,backendName:"webgl",kernelFunc:bLt};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CLt="return x * x;",SLt=Ve({opSnippet:CLt}),ELt={kernelName:wR,backendName:"webgl",kernelFunc:SLt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lM="return (a - b) * (a - b);",kLt=Hr({opSnippet:lM,packedOpSnippet:lM}),ILt={kernelName:Mg,backendName:"webgl",kernelFunc:kLt};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RLt(n){const{inputs:t,backend:e,attrs:r}=n,{x:o}=t;if(o.dtype!=="string")throw new Error("Input must be of datatype string");const a=e.readSync(o.dataId),i=Zs(a),s=KAt(i,"string",r);return e.makeTensorInfo(o.shape,"string",s)}const TLt={kernelName:CR,backendName:"webgl",kernelFunc:RLt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NLt({inputs:n,attrs:t,backend:e}){const{x:r}=n,o=Za+`
    return x > 0.0 ? 1.0 : float(${t.alpha});
  `,a=new ji(r.shape,o);return e.runWebGLProgram(a,[r],r.dtype)}const ALt={kernelName:Ug,backendName:"webgl",kernelFunc:NLt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _Lt{constructor(t,e,r){this.variableNames=["x"],this.outputShape=r;const o=r.length,a=pn(r.length),i=pn(r.length);let s="";if(o===1)s="coords * strides + begin";else{let u=0;s=r.map((l,c)=>(u++,r.length===1?`coords * strides[${c}] + begin[${c}]`:`coords[${u-1}] * strides[${c}] + begin[${c}]`)).join(",")}this.userCode=`
      ${a} begin = ${a}(${t});
      ${a} strides = ${a}(${e});

      void main() {
        ${i} coords = getOutputCoords();
        setOutput(getX(${s}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DLt(n){const{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{begin:a,end:i,strides:s,beginMask:u,endMask:l,ellipsisMask:c,newAxisMask:h,shrinkAxisMask:d}=r,{finalShapeSparse:p,finalShape:g,isIdentity:x,sliceDim0:y,isSimpleSlice:b,begin:C,end:E,strides:S}=hT(o.shape,a,i,s,u,l,c,h,d);let k;if(x)k=Wt({inputs:{x:o},backend:e,attrs:{shape:g}});else if(y||b){H(o.shape.length>=1,()=>`Input must have rank at least 1, got: ${o.shape.length}`);const A=uT(C,E,S),N=kd({inputs:{x:o},backend:e,attrs:{begin:C,size:A}});k=Wt({inputs:{x:N},backend:e,attrs:{shape:g}}),e.disposeIntermediateTensorInfo(N)}else if(e.shouldExecuteOnCPU([o])){const N=e.readSync(o.dataId),_=Ae(o.shape,o.dtype,N),$=YAt(p,_,S,C);k=e.makeTensorInfo(g,o.dtype,$.values)}else{const N=new _Lt(C,S,p);k=e.runWebGLProgram(N,[o],o.dtype)}const R=Wt({inputs:{x:k},backend:e,attrs:{shape:g}});return e.disposeIntermediateTensorInfo(k),R}const $Lt={kernelName:SR,backendName:"webgl",kernelFunc:DLt};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OLt(n){const{inputs:t,backend:e,attrs:r}=n,{separator:o,nGramWidths:a,leftPad:i,rightPad:s,padWidth:u,preserveShortSequences:l}=r,{data:c,dataSplits:h}=t,d=e.readSync(c.dataId),p=e.readSync(h.dataId),[g,x]=QAt(d,p,o,a,i,s,u,l);return[e.makeTensorInfo([g.length],"string",g),e.makeTensorInfo(h.shape,"int32",x)]}const FLt={kernelName:Dz,backendName:"webgl",kernelFunc:OLt};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MLt(n){const{inputs:t,backend:e,attrs:r}=n,{skipEmpty:o}=r,{input:a,delimiter:i}=t;if(a.dtype!=="string")throw new Error("Input must be of datatype string");if(a.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${a.shape}`);if(i.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${i.shape}`);const s=e.readSync(a.dataId),u=e.readSync(i.dataId)[0],[l,c,h]=ZAt(s,u,o),d=c.length;return[e.makeTensorInfo([d,2],"int32",l),e.makeTensorInfo([d],"string",c),e.makeTensorInfo([2],"int32",new Int32Array(h))]}const LLt={kernelName:$z,backendName:"webgl",kernelFunc:MLt};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PLt(n){const{inputs:t,backend:e,attrs:r}=n,{numBuckets:o}=r,{input:a}=t;if(a.dtype!=="string")throw new Error("Input must be of datatype string");if(o<=0)throw new Error("Number of buckets must be at least 1");const i=e.readSync(a.dataId),s=JAt(i,o);return e.makeTensorInfo(a.shape,"int32",s)}const BLt={kernelName:Oz,backendName:"webgl",kernelFunc:PLt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zLt="return tan(x);",ULt=Ve({opSnippet:zLt}),WLt={kernelName:Pg,backendName:"webgl",kernelFunc:ULt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VLt=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,GLt=Ve({opSnippet:VLt}),HLt={kernelName:Bg,backendName:"webgl",kernelFunc:GLt};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qLt(n){const{inputs:t,backend:e,attrs:r}=n,{tensor:o,indices:a,updates:i}=t,{sliceRank:s,numUpdates:u,sliceSize:l,strides:c,outputSize:h}=rh(i,a,o.shape),d=[h/l,l];if(h===0)return e.makeTensorInfo(o.shape,a.dtype);const p=Wt({inputs:{x:a},backend:e,attrs:{shape:[u,s]}}),g=Wt({inputs:{x:i},backend:e,attrs:{shape:[u,l]}}),x=Wt({inputs:{x:o},backend:e,attrs:{shape:d}}),y=new gN(u,s,p.shape.length,g.shape.length,c,d,!1,!0),b=e.runWebGLProgram(y,[g,p,x],x.dtype),C=Wt({inputs:{x:b},backend:e,attrs:{shape:o.shape}});return e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(g),e.disposeIntermediateTensorInfo(x),e.disposeIntermediateTensorInfo(b),C}const jLt={kernelName:kz,backendName:"webgl",kernelFunc:qLt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class XLt{constructor(t,e){this.variableNames=["A"];const r=new Array(t.length);for(let i=0;i<r.length;i++)r[i]=t[i]*e[i];this.outputShape=r,this.rank=r.length;const o=pn(this.rank),a=KLt(t);this.userCode=`
      void main() {
        ${o} resRC = getOutputCoords();
        setOutput(getA(${a}));
      }
    `}}function KLt(n){const t=n.length;if(t>5)throw Error(`Tile for rank ${t} is not yet supported`);if(t===1)return`imod(resRC, ${n[0]})`;const e=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[];for(let o=0;o<n.length;o++)r.push(`imod(${e[o]}, ${n[o]})`);return r.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V6(n){const{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{reps:a}=r;if(o.dtype==="string"||o.shape.length>5){const u=e.readSync(o.dataId),l=o.dtype==="string"?u.map(d=>sl(d)):u,c=Ae(o.shape,o.dtype,l),h=e_t(c,a);return e.makeTensorInfo(h.shape,h.dtype,h.values)}const i=new XLt(o.shape,a);return e.runWebGLProgram(i,[o],o.dtype)}const YLt={kernelName:zg,backendName:"webgl",kernelFunc:V6};class QLt{constructor(t){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=t,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}}class ZLt{constructor(t){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=t,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ql(n,t){t!==null&&n.disposeIntermediateTensorInfo(t)}function cM(n){let t=1;for(;t<n;)t*=2;return t}function JLt(n){const{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{k:a,sorted:i}=r,s=yt().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),u=yt().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),l=o.shape,c=l[l.length-1];if(e.shouldExecuteOnCPU([o])||c<s||a>u){const $=e.readSync(o.dataId),[D,O]=n_t($,l,o.dtype,a,i);return[e.makeTensorInfo(D.shape,D.dtype,D.values),e.makeTensorInfo(O.shape,O.dtype,O.values)]}if(a===0)return l[l.length-1]=0,[e.makeTensorInfo(l,o.dtype,[]),e.makeTensorInfo(l,"int32",[])];if(c===1)return[o,lv({attrs:{shape:l,dtype:"int32",value:0},backend:e})];const h=e.texData.get(o.dataId),d=h!==null&&h.isPacked,p=d?e.unpackTensor(o):o,x=It(l)/c,y=Wt({inputs:{x:p},attrs:{shape:[x,c]},backend:e});d&&Ql(e,p);const b=cM(a),C=cM(c);let E=null;const S=()=>E===null?[y,y]:[y,E],k=($,D,O)=>{const P=S(),z=new QLt(O),F=[[c],[E===null?1:0],[Number.NEGATIVE_INFINITY],[$],[D]],B=E;E=e.runWebGLProgram(z,P,"int32",F),Ql(e,B)};for(let $=1;$<b;$*=2){const D=$*2;for(let O=$;O>=1;O/=2)k(D,O,[x,C])}for(let $=C;$>b;$/=2){const D=S(),O=new ZLt([x,$/2]),z=[[c],[E===null?1:0],[b]],W=E;E=e.runWebGLProgram(O,D,"int32",z),Ql(e,W);const F=b/2,B=F*2;for(let U=F;U>=1;U/=2)k(B,U,E.shape)}let R=E;E=kd({inputs:{x:E},backend:e,attrs:{begin:0,size:[x,a]}}),Ql(e,R);let A=F6({inputs:{x:y,indices:E},backend:e,attrs:{axis:1,batchDims:1}});Ql(e,y);const N=l.slice(0,-1);N.push(a),R=E,E=Wt({inputs:{x:E},attrs:{shape:N},backend:e}),Ql(e,R);const _=A;return A=Wt({inputs:{x:A},attrs:{shape:N},backend:e}),Ql(e,_),[A,E]}const tPt={kernelName:ER,backendName:"webgl",kernelFunc:JLt};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ePt{constructor(t,e,r,o,a,i){this.variableNames=["Image","Transforms"],this.outputShape=i;const s=r==="nearest"?1:2;let u;switch(o){case"constant":u=1;break;case"reflect":u=2;break;case"wrap":u=3;break;case"nearest":u=4;break;default:u=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${u} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${u} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${u} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${t} && 0 <= coordX && coordX < ${e}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${a});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${a});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${e}));
                float mapY = mapCoord(inY, float(${t}));

                if (${s} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nPt(n){const{inputs:t,backend:e,attrs:r}=n,{image:o,transforms:a}=t,{interpolation:i,fillMode:s,fillValue:u,outputShape:l}=r,[c,h,d,p]=o.shape,[g,x]=l??[h,d],y=[c,g,x,p],b=new ePt(h,d,i,s,u,y);return e.runWebGLProgram(b,[o,a],"float32")}const rPt={kernelName:kR,backendName:"webgl",kernelFunc:nPt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oPt(n){const{inputs:t,attrs:e,backend:r}=n,{axis:o}=e,{x:a}=t;iv(a,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const i=r.readSync(a.dataId),{outputValues:s,outputShape:u,indices:l}=r_t(i,o,a.shape,a.dtype);return[r.makeTensorInfo(u,a.dtype,s),r.makeTensorInfo([l.length],"int32",l)]}const aPt={kernelName:IR,backendName:"webgl",kernelFunc:oPt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iPt(n){const{inputs:t,backend:e,attrs:r}=n,{value:o}=t;let{axis:a}=r;a<0&&(a+=o.shape.length);const i=o,s=i.shape.length,u=o.shape[a],l=new Array(s-1);let c=0;for(let x=0;x<s;x++)x!==a&&(l[c++]=i.shape[x]);const h=[],d=new Array(s).fill(0),p=i.shape.slice();p[a]=1;const g=new Array(u);for(let x=0;x<g.length;x++){d[a]=x;const y=kd({inputs:{x:i},backend:e,attrs:{begin:d,size:p}}),b=Wt({inputs:{x:y},backend:e,attrs:{shape:l}});g[x]=b,h.push(y)}return h.forEach(x=>e.disposeIntermediateTensorInfo(x)),g}const sPt={kernelName:db,backendName:"webgl",kernelFunc:iPt};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uPt{constructor(t,e){this.variableNames=["x","segmentIds"];const r=t.windowSize,o=t.batchSize,a=t.inSize,i=t.numSegments,s=i*Math.ceil(a/r);this.outputShape=[o,s];const u="0.0",l="sumValue",c=Math.floor(r/4)*4,h=r%4,d=`
        sumValue += dot(values, segFilter);
    `;let p="";a%r>0&&(p=`
        if (inIdx < 0 || inIdx >= ${a}) {
          return initializationValue;
        }
      `);let g="";a%r>0&&(g=`
        if (inIdx < 0 || inIdx >= ${a}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${u};

      float getValue(int batch, int inIdx) {
        ${p}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${g}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${i})) * float(${r}));
        int currentSeg = int(mod(float(outIdx), float(${i})));

        float sumValue = 0.0;

        for (int i = 0; i < ${c}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${d}
        }

        int inIdx = inOffset + ${c};
        if (${h===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${d}
        } else if (${h===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${d}
        } else if (${h===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${d}
        }
        setOutput(${l});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lPt(n){const{inputs:t,backend:e,attrs:r}=n,{x:o,segmentIds:a}=t,{numSegments:i}=r,s=o.shape.length,u=[];let l=0;const c=Pn([l],s);let h=o;c!=null&&(h=Co({inputs:{x:o},backend:e,attrs:{perm:c}}),u.push(h),l=er(1,s)[0]);const d=EW(h.shape,l,i),p=It([h.shape[l]]),g=Wt({inputs:{x:h},backend:e,attrs:{shape:[-1,p]}});u.push(g);const x=TR(o.dtype),y=(S,k,R,A,N)=>{const _=S.shape[0],$=S.shape[1],D=SW($,N),O={windowSize:D,inSize:$,batchSize:_,numSegments:N},P=new uPt(O,k),z=e.compileAndRun(P,[S,R],A);if(u.push(z),z.shape[1]===N)return z;const W=W6({backend:e,attrs:{start:0,stop:N,step:1,dtype:"float32"}}),F=V6({inputs:{x:W},backend:e,attrs:{reps:[$/D]}});return u.push(W),u.push(F),y(z,k,F,A,N)},b=y(g,"unsortedSegmentSum",a,x,i),C=Wt({inputs:{x:b},backend:e,attrs:{shape:d}});let E=C;if(c!=null){u.push(C);const S=Sl(c);E=Co({inputs:{x:E},backend:e,attrs:{perm:S}})}return u.forEach(S=>e.disposeIntermediateTensorInfo(S)),E}const cPt={kernelName:pb,backendName:"webgl",kernelFunc:lPt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hPt=[X_t,Y_t,J_t,nDt,oDt,sDt,lDt,hDt,mDt,vDt,bDt,SDt,IDt,ADt,$Dt,FDt,LDt,UDt,VDt,HDt,KDt,n$t,o$t,u$t,c$t,g$t,x$t,C$t,__t,k$t,A$t,O$t,z$t,V$t,H$t,j$t,K$t,J$t,nOt,aOt,sOt,lOt,hOt,pOt,gOt,bOt,COt,kOt,TOt,AOt,OOt,POt,WOt,HOt,XOt,KOt,QOt,JOt,e3t,r3t,a3t,l3t,f3t,m3t,v3t,b3t,S3t,R3t,_3t,A_t,$3t,T$t,M3t,B3t,W3t,$_t,q3t,Y3t,Z3t,nFt,aFt,lFt,fFt,gFt,bFt,SFt,kFt,NFt,_Ft,$Ft,LFt,BFt,UFt,VFt,HFt,KFt,JFt,rMt,hMt,M_t,mMt,xMt,wMt,EMt,f$t,RMt,NMt,_Mt,OMt,PMt,F_t,zMt,WMt,GMt,qMt,jMt,d$t,sMt,YMt,t4t,o4t,P_t,u4t,h4t,m4t,x4t,C4t,E4t,R4t,A4t,$4t,M4t,B4t,W4t,q4t,K4t,J4t,nLt,t$t,lMt,aLt,sLt,lLt,hLt,dLt,mLt,vLt,yLt,wLt,ELt,ILt,TLt,ALt,$Lt,FLt,LLt,BLt,uMt,H_t,WLt,HLt,jLt,YLt,tPt,rPt,q_t,aPt,sPt,cPt,TMt];for(const n of hPt)Mz(n);function G6(n,t){return function(){return n.apply(t,arguments)}}const{toString:fPt}=Object.prototype,{getPrototypeOf:vN}=Object,{iterator:qb,toStringTag:H6}=Symbol,jb=(n=>t=>{const e=fPt.call(t);return n[e]||(n[e]=e.slice(8,-1).toLowerCase())})(Object.create(null)),Ei=n=>(n=n.toLowerCase(),t=>jb(t)===n),Xb=n=>t=>typeof t===n,{isArray:Id}=Array,Zf=Xb("undefined");function cv(n){return n!==null&&!Zf(n)&&n.constructor!==null&&!Zf(n.constructor)&&jo(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}const q6=Ei("ArrayBuffer");function dPt(n){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(n):t=n&&n.buffer&&q6(n.buffer),t}const pPt=Xb("string"),jo=Xb("function"),j6=Xb("number"),hv=n=>n!==null&&typeof n=="object",mPt=n=>n===!0||n===!1,$0=n=>{if(jb(n)!=="object")return!1;const t=vN(n);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(H6 in n)&&!(qb in n)},gPt=n=>{if(!hv(n)||cv(n))return!1;try{return Object.keys(n).length===0&&Object.getPrototypeOf(n)===Object.prototype}catch{return!1}},vPt=Ei("Date"),xPt=Ei("File"),yPt=Ei("Blob"),bPt=Ei("FileList"),wPt=n=>hv(n)&&jo(n.pipe),CPt=n=>{let t;return n&&(typeof FormData=="function"&&n instanceof FormData||jo(n.append)&&((t=jb(n))==="formdata"||t==="object"&&jo(n.toString)&&n.toString()==="[object FormData]"))},SPt=Ei("URLSearchParams"),[EPt,kPt,IPt,RPt]=["ReadableStream","Request","Response","Headers"].map(Ei),TPt=n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function fv(n,t,{allOwnKeys:e=!1}={}){if(n===null||typeof n>"u")return;let r,o;if(typeof n!="object"&&(n=[n]),Id(n))for(r=0,o=n.length;r<o;r++)t.call(null,n[r],r,n);else{if(cv(n))return;const a=e?Object.getOwnPropertyNames(n):Object.keys(n),i=a.length;let s;for(r=0;r<i;r++)s=a[r],t.call(null,n[s],s,n)}}function X6(n,t){if(cv(n))return null;t=t.toLowerCase();const e=Object.keys(n);let r=e.length,o;for(;r-- >0;)if(o=e[r],t===o.toLowerCase())return o;return null}const dc=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,K6=n=>!Zf(n)&&n!==dc;function ek(){const{caseless:n,skipUndefined:t}=K6(this)&&this||{},e={},r=(o,a)=>{const i=n&&X6(e,a)||a;$0(e[i])&&$0(o)?e[i]=ek(e[i],o):$0(o)?e[i]=ek({},o):Id(o)?e[i]=o.slice():(!t||!Zf(o))&&(e[i]=o)};for(let o=0,a=arguments.length;o<a;o++)arguments[o]&&fv(arguments[o],r);return e}const NPt=(n,t,e,{allOwnKeys:r}={})=>(fv(t,(o,a)=>{e&&jo(o)?n[a]=G6(o,e):n[a]=o},{allOwnKeys:r}),n),APt=n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),_Pt=(n,t,e,r)=>{n.prototype=Object.create(t.prototype,r),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:t.prototype}),e&&Object.assign(n.prototype,e)},DPt=(n,t,e,r)=>{let o,a,i;const s={};if(t=t||{},n==null)return t;do{for(o=Object.getOwnPropertyNames(n),a=o.length;a-- >0;)i=o[a],(!r||r(i,n,t))&&!s[i]&&(t[i]=n[i],s[i]=!0);n=e!==!1&&vN(n)}while(n&&(!e||e(n,t))&&n!==Object.prototype);return t},$Pt=(n,t,e)=>{n=String(n),(e===void 0||e>n.length)&&(e=n.length),e-=t.length;const r=n.indexOf(t,e);return r!==-1&&r===e},OPt=n=>{if(!n)return null;if(Id(n))return n;let t=n.length;if(!j6(t))return null;const e=new Array(t);for(;t-- >0;)e[t]=n[t];return e},FPt=(n=>t=>n&&t instanceof n)(typeof Uint8Array<"u"&&vN(Uint8Array)),MPt=(n,t)=>{const r=(n&&n[qb]).call(n);let o;for(;(o=r.next())&&!o.done;){const a=o.value;t.call(n,a[0],a[1])}},LPt=(n,t)=>{let e;const r=[];for(;(e=n.exec(t))!==null;)r.push(e);return r},PPt=Ei("HTMLFormElement"),BPt=n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,r,o){return r.toUpperCase()+o}),hM=(({hasOwnProperty:n})=>(t,e)=>n.call(t,e))(Object.prototype),zPt=Ei("RegExp"),Y6=(n,t)=>{const e=Object.getOwnPropertyDescriptors(n),r={};fv(e,(o,a)=>{let i;(i=t(o,a,n))!==!1&&(r[a]=i||o)}),Object.defineProperties(n,r)},UPt=n=>{Y6(n,(t,e)=>{if(jo(n)&&["arguments","caller","callee"].indexOf(e)!==-1)return!1;const r=n[e];if(jo(r)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+e+"'")})}})},WPt=(n,t)=>{const e={},r=o=>{o.forEach(a=>{e[a]=!0})};return Id(n)?r(n):r(String(n).split(t)),e},VPt=()=>{},GPt=(n,t)=>n!=null&&Number.isFinite(n=+n)?n:t;function HPt(n){return!!(n&&jo(n.append)&&n[H6]==="FormData"&&n[qb])}const qPt=n=>{const t=new Array(10),e=(r,o)=>{if(hv(r)){if(t.indexOf(r)>=0)return;if(cv(r))return r;if(!("toJSON"in r)){t[o]=r;const a=Id(r)?[]:{};return fv(r,(i,s)=>{const u=e(i,o+1);!Zf(u)&&(a[s]=u)}),t[o]=void 0,a}}return r};return e(n,0)},jPt=Ei("AsyncFunction"),XPt=n=>n&&(hv(n)||jo(n))&&jo(n.then)&&jo(n.catch),Q6=((n,t)=>n?setImmediate:t?((e,r)=>(dc.addEventListener("message",({source:o,data:a})=>{o===dc&&a===e&&r.length&&r.shift()()},!1),o=>{r.push(o),dc.postMessage(e,"*")}))(`axios@${Math.random()}`,[]):e=>setTimeout(e))(typeof setImmediate=="function",jo(dc.postMessage)),KPt=typeof queueMicrotask<"u"?queueMicrotask.bind(dc):typeof process<"u"&&process.nextTick||Q6,YPt=n=>n!=null&&jo(n[qb]),St={isArray:Id,isArrayBuffer:q6,isBuffer:cv,isFormData:CPt,isArrayBufferView:dPt,isString:pPt,isNumber:j6,isBoolean:mPt,isObject:hv,isPlainObject:$0,isEmptyObject:gPt,isReadableStream:EPt,isRequest:kPt,isResponse:IPt,isHeaders:RPt,isUndefined:Zf,isDate:vPt,isFile:xPt,isBlob:yPt,isRegExp:zPt,isFunction:jo,isStream:wPt,isURLSearchParams:SPt,isTypedArray:FPt,isFileList:bPt,forEach:fv,merge:ek,extend:NPt,trim:TPt,stripBOM:APt,inherits:_Pt,toFlatObject:DPt,kindOf:jb,kindOfTest:Ei,endsWith:$Pt,toArray:OPt,forEachEntry:MPt,matchAll:LPt,isHTMLForm:PPt,hasOwnProperty:hM,hasOwnProp:hM,reduceDescriptors:Y6,freezeMethods:UPt,toObjectSet:WPt,toCamelCase:BPt,noop:VPt,toFiniteNumber:GPt,findKey:X6,global:dc,isContextDefined:K6,isSpecCompliantForm:HPt,toJSONObject:qPt,isAsyncFn:jPt,isThenable:XPt,setImmediate:Q6,asap:KPt,isIterable:YPt};function ke(n,t,e,r,o){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",t&&(this.code=t),e&&(this.config=e),r&&(this.request=r),o&&(this.response=o,this.status=o.status?o.status:null)}St.inherits(ke,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:St.toJSONObject(this.config),code:this.code,status:this.status}}});const Z6=ke.prototype,J6={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{J6[n]={value:n}});Object.defineProperties(ke,J6);Object.defineProperty(Z6,"isAxiosError",{value:!0});ke.from=(n,t,e,r,o,a)=>{const i=Object.create(Z6);St.toFlatObject(n,i,function(c){return c!==Error.prototype},l=>l!=="isAxiosError");const s=n&&n.message?n.message:"Error",u=t==null&&n?n.code:t;return ke.call(i,s,u,e,r,o),n&&i.cause==null&&Object.defineProperty(i,"cause",{value:n,configurable:!0}),i.name=n&&n.name||"Error",a&&Object.assign(i,a),i};const QPt=null;function nk(n){return St.isPlainObject(n)||St.isArray(n)}function tq(n){return St.endsWith(n,"[]")?n.slice(0,-2):n}function fM(n,t,e){return n?n.concat(t).map(function(o,a){return o=tq(o),!e&&a?"["+o+"]":o}).join(e?".":""):t}function ZPt(n){return St.isArray(n)&&!n.some(nk)}const JPt=St.toFlatObject(St,{},null,function(t){return/^is[A-Z]/.test(t)});function Kb(n,t,e){if(!St.isObject(n))throw new TypeError("target must be an object");t=t||new FormData,e=St.toFlatObject(e,{metaTokens:!0,dots:!1,indexes:!1},!1,function(x,y){return!St.isUndefined(y[x])});const r=e.metaTokens,o=e.visitor||c,a=e.dots,i=e.indexes,u=(e.Blob||typeof Blob<"u"&&Blob)&&St.isSpecCompliantForm(t);if(!St.isFunction(o))throw new TypeError("visitor must be a function");function l(g){if(g===null)return"";if(St.isDate(g))return g.toISOString();if(St.isBoolean(g))return g.toString();if(!u&&St.isBlob(g))throw new ke("Blob is not supported. Use a Buffer instead.");return St.isArrayBuffer(g)||St.isTypedArray(g)?u&&typeof Blob=="function"?new Blob([g]):Buffer.from(g):g}function c(g,x,y){let b=g;if(g&&!y&&typeof g=="object"){if(St.endsWith(x,"{}"))x=r?x:x.slice(0,-2),g=JSON.stringify(g);else if(St.isArray(g)&&ZPt(g)||(St.isFileList(g)||St.endsWith(x,"[]"))&&(b=St.toArray(g)))return x=tq(x),b.forEach(function(E,S){!(St.isUndefined(E)||E===null)&&t.append(i===!0?fM([x],S,a):i===null?x:x+"[]",l(E))}),!1}return nk(g)?!0:(t.append(fM(y,x,a),l(g)),!1)}const h=[],d=Object.assign(JPt,{defaultVisitor:c,convertValue:l,isVisitable:nk});function p(g,x){if(!St.isUndefined(g)){if(h.indexOf(g)!==-1)throw Error("Circular reference detected in "+x.join("."));h.push(g),St.forEach(g,function(b,C){(!(St.isUndefined(b)||b===null)&&o.call(t,b,St.isString(C)?C.trim():C,x,d))===!0&&p(b,x?x.concat(C):[C])}),h.pop()}}if(!St.isObject(n))throw new TypeError("data must be an object");return p(n),t}function dM(n){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(r){return t[r]})}function xN(n,t){this._pairs=[],n&&Kb(n,this,t)}const eq=xN.prototype;eq.append=function(t,e){this._pairs.push([t,e])};eq.toString=function(t){const e=t?function(r){return t.call(this,r,dM)}:dM;return this._pairs.map(function(o){return e(o[0])+"="+e(o[1])},"").join("&")};function tBt(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function nq(n,t,e){if(!t)return n;const r=e&&e.encode||tBt;St.isFunction(e)&&(e={serialize:e});const o=e&&e.serialize;let a;if(o?a=o(t,e):a=St.isURLSearchParams(t)?t.toString():new xN(t,e).toString(r),a){const i=n.indexOf("#");i!==-1&&(n=n.slice(0,i)),n+=(n.indexOf("?")===-1?"?":"&")+a}return n}class pM{constructor(){this.handlers=[]}use(t,e,r){return this.handlers.push({fulfilled:t,rejected:e,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){St.forEach(this.handlers,function(r){r!==null&&t(r)})}}const rq={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},eBt=typeof URLSearchParams<"u"?URLSearchParams:xN,nBt=typeof FormData<"u"?FormData:null,rBt=typeof Blob<"u"?Blob:null,oBt={isBrowser:!0,classes:{URLSearchParams:eBt,FormData:nBt,Blob:rBt},protocols:["http","https","file","blob","url","data"]},yN=typeof window<"u"&&typeof document<"u",rk=typeof navigator=="object"&&navigator||void 0,aBt=yN&&(!rk||["ReactNative","NativeScript","NS"].indexOf(rk.product)<0),iBt=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",sBt=yN&&window.location.href||"http://localhost",uBt=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:yN,hasStandardBrowserEnv:aBt,hasStandardBrowserWebWorkerEnv:iBt,navigator:rk,origin:sBt},Symbol.toStringTag,{value:"Module"})),yo={...uBt,...oBt};function lBt(n,t){return Kb(n,new yo.classes.URLSearchParams,{visitor:function(e,r,o,a){return yo.isNode&&St.isBuffer(e)?(this.append(r,e.toString("base64")),!1):a.defaultVisitor.apply(this,arguments)},...t})}function cBt(n){return St.matchAll(/\w+|\[(\w*)]/g,n).map(t=>t[0]==="[]"?"":t[1]||t[0])}function hBt(n){const t={},e=Object.keys(n);let r;const o=e.length;let a;for(r=0;r<o;r++)a=e[r],t[a]=n[a];return t}function oq(n){function t(e,r,o,a){let i=e[a++];if(i==="__proto__")return!0;const s=Number.isFinite(+i),u=a>=e.length;return i=!i&&St.isArray(o)?o.length:i,u?(St.hasOwnProp(o,i)?o[i]=[o[i],r]:o[i]=r,!s):((!o[i]||!St.isObject(o[i]))&&(o[i]=[]),t(e,r,o[i],a)&&St.isArray(o[i])&&(o[i]=hBt(o[i])),!s)}if(St.isFormData(n)&&St.isFunction(n.entries)){const e={};return St.forEachEntry(n,(r,o)=>{t(cBt(r),o,e,0)}),e}return null}function fBt(n,t,e){if(St.isString(n))try{return(t||JSON.parse)(n),St.trim(n)}catch(r){if(r.name!=="SyntaxError")throw r}return(e||JSON.stringify)(n)}const dv={transitional:rq,adapter:["xhr","http","fetch"],transformRequest:[function(t,e){const r=e.getContentType()||"",o=r.indexOf("application/json")>-1,a=St.isObject(t);if(a&&St.isHTMLForm(t)&&(t=new FormData(t)),St.isFormData(t))return o?JSON.stringify(oq(t)):t;if(St.isArrayBuffer(t)||St.isBuffer(t)||St.isStream(t)||St.isFile(t)||St.isBlob(t)||St.isReadableStream(t))return t;if(St.isArrayBufferView(t))return t.buffer;if(St.isURLSearchParams(t))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let s;if(a){if(r.indexOf("application/x-www-form-urlencoded")>-1)return lBt(t,this.formSerializer).toString();if((s=St.isFileList(t))||r.indexOf("multipart/form-data")>-1){const u=this.env&&this.env.FormData;return Kb(s?{"files[]":t}:t,u&&new u,this.formSerializer)}}return a||o?(e.setContentType("application/json",!1),fBt(t)):t}],transformResponse:[function(t){const e=this.transitional||dv.transitional,r=e&&e.forcedJSONParsing,o=this.responseType==="json";if(St.isResponse(t)||St.isReadableStream(t))return t;if(t&&St.isString(t)&&(r&&!this.responseType||o)){const i=!(e&&e.silentJSONParsing)&&o;try{return JSON.parse(t,this.parseReviver)}catch(s){if(i)throw s.name==="SyntaxError"?ke.from(s,ke.ERR_BAD_RESPONSE,this,null,this.response):s}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:yo.classes.FormData,Blob:yo.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};St.forEach(["delete","get","head","post","put","patch"],n=>{dv.headers[n]={}});const dBt=St.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),pBt=n=>{const t={};let e,r,o;return n&&n.split(`
`).forEach(function(i){o=i.indexOf(":"),e=i.substring(0,o).trim().toLowerCase(),r=i.substring(o+1).trim(),!(!e||t[e]&&dBt[e])&&(e==="set-cookie"?t[e]?t[e].push(r):t[e]=[r]:t[e]=t[e]?t[e]+", "+r:r)}),t},mM=Symbol("internals");function Lp(n){return n&&String(n).trim().toLowerCase()}function O0(n){return n===!1||n==null?n:St.isArray(n)?n.map(O0):String(n)}function mBt(n){const t=Object.create(null),e=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=e.exec(n);)t[r[1]]=r[2];return t}const gBt=n=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(n.trim());function IS(n,t,e,r,o){if(St.isFunction(r))return r.call(this,t,e);if(o&&(t=e),!!St.isString(t)){if(St.isString(r))return t.indexOf(r)!==-1;if(St.isRegExp(r))return r.test(t)}}function vBt(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,e,r)=>e.toUpperCase()+r)}function xBt(n,t){const e=St.toCamelCase(" "+t);["get","set","has"].forEach(r=>{Object.defineProperty(n,r+e,{value:function(o,a,i){return this[r].call(this,t,o,a,i)},configurable:!0})})}let Xo=class{constructor(t){t&&this.set(t)}set(t,e,r){const o=this;function a(s,u,l){const c=Lp(u);if(!c)throw new Error("header name must be a non-empty string");const h=St.findKey(o,c);(!h||o[h]===void 0||l===!0||l===void 0&&o[h]!==!1)&&(o[h||u]=O0(s))}const i=(s,u)=>St.forEach(s,(l,c)=>a(l,c,u));if(St.isPlainObject(t)||t instanceof this.constructor)i(t,e);else if(St.isString(t)&&(t=t.trim())&&!gBt(t))i(pBt(t),e);else if(St.isObject(t)&&St.isIterable(t)){let s={},u,l;for(const c of t){if(!St.isArray(c))throw TypeError("Object iterator must return a key-value pair");s[l=c[0]]=(u=s[l])?St.isArray(u)?[...u,c[1]]:[u,c[1]]:c[1]}i(s,e)}else t!=null&&a(e,t,r);return this}get(t,e){if(t=Lp(t),t){const r=St.findKey(this,t);if(r){const o=this[r];if(!e)return o;if(e===!0)return mBt(o);if(St.isFunction(e))return e.call(this,o,r);if(St.isRegExp(e))return e.exec(o);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,e){if(t=Lp(t),t){const r=St.findKey(this,t);return!!(r&&this[r]!==void 0&&(!e||IS(this,this[r],r,e)))}return!1}delete(t,e){const r=this;let o=!1;function a(i){if(i=Lp(i),i){const s=St.findKey(r,i);s&&(!e||IS(r,r[s],s,e))&&(delete r[s],o=!0)}}return St.isArray(t)?t.forEach(a):a(t),o}clear(t){const e=Object.keys(this);let r=e.length,o=!1;for(;r--;){const a=e[r];(!t||IS(this,this[a],a,t,!0))&&(delete this[a],o=!0)}return o}normalize(t){const e=this,r={};return St.forEach(this,(o,a)=>{const i=St.findKey(r,a);if(i){e[i]=O0(o),delete e[a];return}const s=t?vBt(a):String(a).trim();s!==a&&delete e[a],e[s]=O0(o),r[s]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const e=Object.create(null);return St.forEach(this,(r,o)=>{r!=null&&r!==!1&&(e[o]=t&&St.isArray(r)?r.join(", "):r)}),e}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,e])=>t+": "+e).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...e){const r=new this(t);return e.forEach(o=>r.set(o)),r}static accessor(t){const r=(this[mM]=this[mM]={accessors:{}}).accessors,o=this.prototype;function a(i){const s=Lp(i);r[s]||(xBt(o,i),r[s]=!0)}return St.isArray(t)?t.forEach(a):a(t),this}};Xo.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);St.reduceDescriptors(Xo.prototype,({value:n},t)=>{let e=t[0].toUpperCase()+t.slice(1);return{get:()=>n,set(r){this[e]=r}}});St.freezeMethods(Xo);function RS(n,t){const e=this||dv,r=t||e,o=Xo.from(r.headers);let a=r.data;return St.forEach(n,function(s){a=s.call(e,a,o.normalize(),t?t.status:void 0)}),o.normalize(),a}function aq(n){return!!(n&&n.__CANCEL__)}function Rd(n,t,e){ke.call(this,n??"canceled",ke.ERR_CANCELED,t,e),this.name="CanceledError"}St.inherits(Rd,ke,{__CANCEL__:!0});function iq(n,t,e){const r=e.config.validateStatus;!e.status||!r||r(e.status)?n(e):t(new ke("Request failed with status code "+e.status,[ke.ERR_BAD_REQUEST,ke.ERR_BAD_RESPONSE][Math.floor(e.status/100)-4],e.config,e.request,e))}function yBt(n){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return t&&t[1]||""}function bBt(n,t){n=n||10;const e=new Array(n),r=new Array(n);let o=0,a=0,i;return t=t!==void 0?t:1e3,function(u){const l=Date.now(),c=r[a];i||(i=l),e[o]=u,r[o]=l;let h=a,d=0;for(;h!==o;)d+=e[h++],h=h%n;if(o=(o+1)%n,o===a&&(a=(a+1)%n),l-i<t)return;const p=c&&l-c;return p?Math.round(d*1e3/p):void 0}}function wBt(n,t){let e=0,r=1e3/t,o,a;const i=(l,c=Date.now())=>{e=c,o=null,a&&(clearTimeout(a),a=null),n(...l)};return[(...l)=>{const c=Date.now(),h=c-e;h>=r?i(l,c):(o=l,a||(a=setTimeout(()=>{a=null,i(o)},r-h)))},()=>o&&i(o)]}const Hy=(n,t,e=3)=>{let r=0;const o=bBt(50,250);return wBt(a=>{const i=a.loaded,s=a.lengthComputable?a.total:void 0,u=i-r,l=o(u),c=i<=s;r=i;const h={loaded:i,total:s,progress:s?i/s:void 0,bytes:u,rate:l||void 0,estimated:l&&s&&c?(s-i)/l:void 0,event:a,lengthComputable:s!=null,[t?"download":"upload"]:!0};n(h)},e)},gM=(n,t)=>{const e=n!=null;return[r=>t[0]({lengthComputable:e,total:n,loaded:r}),t[1]]},vM=n=>(...t)=>St.asap(()=>n(...t)),CBt=yo.hasStandardBrowserEnv?((n,t)=>e=>(e=new URL(e,yo.origin),n.protocol===e.protocol&&n.host===e.host&&(t||n.port===e.port)))(new URL(yo.origin),yo.navigator&&/(msie|trident)/i.test(yo.navigator.userAgent)):()=>!0,SBt=yo.hasStandardBrowserEnv?{write(n,t,e,r,o,a){const i=[n+"="+encodeURIComponent(t)];St.isNumber(e)&&i.push("expires="+new Date(e).toGMTString()),St.isString(r)&&i.push("path="+r),St.isString(o)&&i.push("domain="+o),a===!0&&i.push("secure"),document.cookie=i.join("; ")},read(n){const t=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(n){this.write(n,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function EBt(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function kBt(n,t){return t?n.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):n}function sq(n,t,e){let r=!EBt(t);return n&&(r||e==!1)?kBt(n,t):t}const xM=n=>n instanceof Xo?{...n}:n;function zc(n,t){t=t||{};const e={};function r(l,c,h,d){return St.isPlainObject(l)&&St.isPlainObject(c)?St.merge.call({caseless:d},l,c):St.isPlainObject(c)?St.merge({},c):St.isArray(c)?c.slice():c}function o(l,c,h,d){if(St.isUndefined(c)){if(!St.isUndefined(l))return r(void 0,l,h,d)}else return r(l,c,h,d)}function a(l,c){if(!St.isUndefined(c))return r(void 0,c)}function i(l,c){if(St.isUndefined(c)){if(!St.isUndefined(l))return r(void 0,l)}else return r(void 0,c)}function s(l,c,h){if(h in t)return r(l,c);if(h in n)return r(void 0,l)}const u={url:a,method:a,data:a,baseURL:i,transformRequest:i,transformResponse:i,paramsSerializer:i,timeout:i,timeoutMessage:i,withCredentials:i,withXSRFToken:i,adapter:i,responseType:i,xsrfCookieName:i,xsrfHeaderName:i,onUploadProgress:i,onDownloadProgress:i,decompress:i,maxContentLength:i,maxBodyLength:i,beforeRedirect:i,transport:i,httpAgent:i,httpsAgent:i,cancelToken:i,socketPath:i,responseEncoding:i,validateStatus:s,headers:(l,c,h)=>o(xM(l),xM(c),h,!0)};return St.forEach(Object.keys({...n,...t}),function(c){const h=u[c]||o,d=h(n[c],t[c],c);St.isUndefined(d)&&h!==s||(e[c]=d)}),e}const uq=n=>{const t=zc({},n);let{data:e,withXSRFToken:r,xsrfHeaderName:o,xsrfCookieName:a,headers:i,auth:s}=t;if(t.headers=i=Xo.from(i),t.url=nq(sq(t.baseURL,t.url,t.allowAbsoluteUrls),n.params,n.paramsSerializer),s&&i.set("Authorization","Basic "+btoa((s.username||"")+":"+(s.password?unescape(encodeURIComponent(s.password)):""))),St.isFormData(e)){if(yo.hasStandardBrowserEnv||yo.hasStandardBrowserWebWorkerEnv)i.setContentType(void 0);else if(St.isFunction(e.getHeaders)){const u=e.getHeaders(),l=["content-type","content-length"];Object.entries(u).forEach(([c,h])=>{l.includes(c.toLowerCase())&&i.set(c,h)})}}if(yo.hasStandardBrowserEnv&&(r&&St.isFunction(r)&&(r=r(t)),r||r!==!1&&CBt(t.url))){const u=o&&a&&SBt.read(a);u&&i.set(o,u)}return t},IBt=typeof XMLHttpRequest<"u",RBt=IBt&&function(n){return new Promise(function(e,r){const o=uq(n);let a=o.data;const i=Xo.from(o.headers).normalize();let{responseType:s,onUploadProgress:u,onDownloadProgress:l}=o,c,h,d,p,g;function x(){p&&p(),g&&g(),o.cancelToken&&o.cancelToken.unsubscribe(c),o.signal&&o.signal.removeEventListener("abort",c)}let y=new XMLHttpRequest;y.open(o.method.toUpperCase(),o.url,!0),y.timeout=o.timeout;function b(){if(!y)return;const E=Xo.from("getAllResponseHeaders"in y&&y.getAllResponseHeaders()),k={data:!s||s==="text"||s==="json"?y.responseText:y.response,status:y.status,statusText:y.statusText,headers:E,config:n,request:y};iq(function(A){e(A),x()},function(A){r(A),x()},k),y=null}"onloadend"in y?y.onloadend=b:y.onreadystatechange=function(){!y||y.readyState!==4||y.status===0&&!(y.responseURL&&y.responseURL.indexOf("file:")===0)||setTimeout(b)},y.onabort=function(){y&&(r(new ke("Request aborted",ke.ECONNABORTED,n,y)),y=null)},y.onerror=function(S){const k=S&&S.message?S.message:"Network Error",R=new ke(k,ke.ERR_NETWORK,n,y);R.event=S||null,r(R),y=null},y.ontimeout=function(){let S=o.timeout?"timeout of "+o.timeout+"ms exceeded":"timeout exceeded";const k=o.transitional||rq;o.timeoutErrorMessage&&(S=o.timeoutErrorMessage),r(new ke(S,k.clarifyTimeoutError?ke.ETIMEDOUT:ke.ECONNABORTED,n,y)),y=null},a===void 0&&i.setContentType(null),"setRequestHeader"in y&&St.forEach(i.toJSON(),function(S,k){y.setRequestHeader(k,S)}),St.isUndefined(o.withCredentials)||(y.withCredentials=!!o.withCredentials),s&&s!=="json"&&(y.responseType=o.responseType),l&&([d,g]=Hy(l,!0),y.addEventListener("progress",d)),u&&y.upload&&([h,p]=Hy(u),y.upload.addEventListener("progress",h),y.upload.addEventListener("loadend",p)),(o.cancelToken||o.signal)&&(c=E=>{y&&(r(!E||E.type?new Rd(null,n,y):E),y.abort(),y=null)},o.cancelToken&&o.cancelToken.subscribe(c),o.signal&&(o.signal.aborted?c():o.signal.addEventListener("abort",c)));const C=yBt(o.url);if(C&&yo.protocols.indexOf(C)===-1){r(new ke("Unsupported protocol "+C+":",ke.ERR_BAD_REQUEST,n));return}y.send(a||null)})},TBt=(n,t)=>{const{length:e}=n=n?n.filter(Boolean):[];if(t||e){let r=new AbortController,o;const a=function(l){if(!o){o=!0,s();const c=l instanceof Error?l:this.reason;r.abort(c instanceof ke?c:new Rd(c instanceof Error?c.message:c))}};let i=t&&setTimeout(()=>{i=null,a(new ke(`timeout ${t} of ms exceeded`,ke.ETIMEDOUT))},t);const s=()=>{n&&(i&&clearTimeout(i),i=null,n.forEach(l=>{l.unsubscribe?l.unsubscribe(a):l.removeEventListener("abort",a)}),n=null)};n.forEach(l=>l.addEventListener("abort",a));const{signal:u}=r;return u.unsubscribe=()=>St.asap(s),u}},NBt=function*(n,t){let e=n.byteLength;if(e<t){yield n;return}let r=0,o;for(;r<e;)o=r+t,yield n.slice(r,o),r=o},ABt=async function*(n,t){for await(const e of _Bt(n))yield*NBt(e,t)},_Bt=async function*(n){if(n[Symbol.asyncIterator]){yield*n;return}const t=n.getReader();try{for(;;){const{done:e,value:r}=await t.read();if(e)break;yield r}}finally{await t.cancel()}},yM=(n,t,e,r)=>{const o=ABt(n,t);let a=0,i,s=u=>{i||(i=!0,r&&r(u))};return new ReadableStream({async pull(u){try{const{done:l,value:c}=await o.next();if(l){s(),u.close();return}let h=c.byteLength;if(e){let d=a+=h;e(d)}u.enqueue(new Uint8Array(c))}catch(l){throw s(l),l}},cancel(u){return s(u),o.return()}},{highWaterMark:2})},bM=64*1024,{isFunction:a0}=St,DBt=(({Request:n,Response:t})=>({Request:n,Response:t}))(St.global),{ReadableStream:wM,TextEncoder:CM}=St.global,SM=(n,...t)=>{try{return!!n(...t)}catch{return!1}},$Bt=n=>{n=St.merge.call({skipUndefined:!0},DBt,n);const{fetch:t,Request:e,Response:r}=n,o=t?a0(t):typeof fetch=="function",a=a0(e),i=a0(r);if(!o)return!1;const s=o&&a0(wM),u=o&&(typeof CM=="function"?(g=>x=>g.encode(x))(new CM):async g=>new Uint8Array(await new e(g).arrayBuffer())),l=a&&s&&SM(()=>{let g=!1;const x=new e(yo.origin,{body:new wM,method:"POST",get duplex(){return g=!0,"half"}}).headers.has("Content-Type");return g&&!x}),c=i&&s&&SM(()=>St.isReadableStream(new r("").body)),h={stream:c&&(g=>g.body)};o&&["text","arrayBuffer","blob","formData","stream"].forEach(g=>{!h[g]&&(h[g]=(x,y)=>{let b=x&&x[g];if(b)return b.call(x);throw new ke(`Response type '${g}' is not supported`,ke.ERR_NOT_SUPPORT,y)})});const d=async g=>{if(g==null)return 0;if(St.isBlob(g))return g.size;if(St.isSpecCompliantForm(g))return(await new e(yo.origin,{method:"POST",body:g}).arrayBuffer()).byteLength;if(St.isArrayBufferView(g)||St.isArrayBuffer(g))return g.byteLength;if(St.isURLSearchParams(g)&&(g=g+""),St.isString(g))return(await u(g)).byteLength},p=async(g,x)=>{const y=St.toFiniteNumber(g.getContentLength());return y??d(x)};return async g=>{let{url:x,method:y,data:b,signal:C,cancelToken:E,timeout:S,onDownloadProgress:k,onUploadProgress:R,responseType:A,headers:N,withCredentials:_="same-origin",fetchOptions:$}=uq(g),D=t||fetch;A=A?(A+"").toLowerCase():"text";let O=TBt([C,E&&E.toAbortSignal()],S),P=null;const z=O&&O.unsubscribe&&(()=>{O.unsubscribe()});let W;try{if(R&&l&&y!=="get"&&y!=="head"&&(W=await p(N,b))!==0){let G=new e(x,{method:"POST",body:b,duplex:"half"}),Q;if(St.isFormData(b)&&(Q=G.headers.get("content-type"))&&N.setContentType(Q),G.body){const[Z,rt]=gM(W,Hy(vM(R)));b=yM(G.body,bM,Z,rt)}}St.isString(_)||(_=_?"include":"omit");const F=a&&"credentials"in e.prototype,B={...$,signal:O,method:y.toUpperCase(),headers:N.normalize().toJSON(),body:b,duplex:"half",credentials:F?_:void 0};P=a&&new e(x,B);let U=await(a?D(P,$):D(x,B));const q=c&&(A==="stream"||A==="response");if(c&&(k||q&&z)){const G={};["status","statusText","headers"].forEach(ct=>{G[ct]=U[ct]});const Q=St.toFiniteNumber(U.headers.get("content-length")),[Z,rt]=k&&gM(Q,Hy(vM(k),!0))||[];U=new r(yM(U.body,bM,Z,()=>{rt&&rt(),z&&z()}),G)}A=A||"text";let M=await h[St.findKey(h,A)||"text"](U,g);return!q&&z&&z(),await new Promise((G,Q)=>{iq(G,Q,{data:M,headers:Xo.from(U.headers),status:U.status,statusText:U.statusText,config:g,request:P})})}catch(F){throw z&&z(),F&&F.name==="TypeError"&&/Load failed|fetch/i.test(F.message)?Object.assign(new ke("Network Error",ke.ERR_NETWORK,g,P),{cause:F.cause||F}):ke.from(F,F&&F.code,g,P)}}},OBt=new Map,lq=n=>{let t=n?n.env:{};const{fetch:e,Request:r,Response:o}=t,a=[r,o,e];let i=a.length,s=i,u,l,c=OBt;for(;s--;)u=a[s],l=c.get(u),l===void 0&&c.set(u,l=s?new Map:$Bt(t)),c=l;return l};lq();const ok={http:QPt,xhr:RBt,fetch:{get:lq}};St.forEach(ok,(n,t)=>{if(n){try{Object.defineProperty(n,"name",{value:t})}catch{}Object.defineProperty(n,"adapterName",{value:t})}});const EM=n=>`- ${n}`,FBt=n=>St.isFunction(n)||n===null||n===!1,cq={getAdapter:(n,t)=>{n=St.isArray(n)?n:[n];const{length:e}=n;let r,o;const a={};for(let i=0;i<e;i++){r=n[i];let s;if(o=r,!FBt(r)&&(o=ok[(s=String(r)).toLowerCase()],o===void 0))throw new ke(`Unknown adapter '${s}'`);if(o&&(St.isFunction(o)||(o=o.get(t))))break;a[s||"#"+i]=o}if(!o){const i=Object.entries(a).map(([u,l])=>`adapter ${u} `+(l===!1?"is not supported by the environment":"is not available in the build"));let s=e?i.length>1?`since :
`+i.map(EM).join(`
`):" "+EM(i[0]):"as no adapter specified";throw new ke("There is no suitable adapter to dispatch the request "+s,"ERR_NOT_SUPPORT")}return o},adapters:ok};function TS(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new Rd(null,n)}function kM(n){return TS(n),n.headers=Xo.from(n.headers),n.data=RS.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),cq.getAdapter(n.adapter||dv.adapter,n)(n).then(function(r){return TS(n),r.data=RS.call(n,n.transformResponse,r),r.headers=Xo.from(r.headers),r},function(r){return aq(r)||(TS(n),r&&r.response&&(r.response.data=RS.call(n,n.transformResponse,r.response),r.response.headers=Xo.from(r.response.headers))),Promise.reject(r)})}const hq="1.12.2",Yb={};["object","boolean","number","function","string","symbol"].forEach((n,t)=>{Yb[n]=function(r){return typeof r===n||"a"+(t<1?"n ":" ")+n}});const IM={};Yb.transitional=function(t,e,r){function o(a,i){return"[Axios v"+hq+"] Transitional option '"+a+"'"+i+(r?". "+r:"")}return(a,i,s)=>{if(t===!1)throw new ke(o(i," has been removed"+(e?" in "+e:"")),ke.ERR_DEPRECATED);return e&&!IM[i]&&(IM[i]=!0,console.warn(o(i," has been deprecated since v"+e+" and will be removed in the near future"))),t?t(a,i,s):!0}};Yb.spelling=function(t){return(e,r)=>(console.warn(`${r} is likely a misspelling of ${t}`),!0)};function MBt(n,t,e){if(typeof n!="object")throw new ke("options must be an object",ke.ERR_BAD_OPTION_VALUE);const r=Object.keys(n);let o=r.length;for(;o-- >0;){const a=r[o],i=t[a];if(i){const s=n[a],u=s===void 0||i(s,a,n);if(u!==!0)throw new ke("option "+a+" must be "+u,ke.ERR_BAD_OPTION_VALUE);continue}if(e!==!0)throw new ke("Unknown option "+a,ke.ERR_BAD_OPTION)}}const F0={assertOptions:MBt,validators:Yb},Di=F0.validators;let wc=class{constructor(t){this.defaults=t||{},this.interceptors={request:new pM,response:new pM}}async request(t,e){try{return await this._request(t,e)}catch(r){if(r instanceof Error){let o={};Error.captureStackTrace?Error.captureStackTrace(o):o=new Error;const a=o.stack?o.stack.replace(/^.+\n/,""):"";try{r.stack?a&&!String(r.stack).endsWith(a.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+a):r.stack=a}catch{}}throw r}}_request(t,e){typeof t=="string"?(e=e||{},e.url=t):e=t||{},e=zc(this.defaults,e);const{transitional:r,paramsSerializer:o,headers:a}=e;r!==void 0&&F0.assertOptions(r,{silentJSONParsing:Di.transitional(Di.boolean),forcedJSONParsing:Di.transitional(Di.boolean),clarifyTimeoutError:Di.transitional(Di.boolean)},!1),o!=null&&(St.isFunction(o)?e.paramsSerializer={serialize:o}:F0.assertOptions(o,{encode:Di.function,serialize:Di.function},!0)),e.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?e.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:e.allowAbsoluteUrls=!0),F0.assertOptions(e,{baseUrl:Di.spelling("baseURL"),withXsrfToken:Di.spelling("withXSRFToken")},!0),e.method=(e.method||this.defaults.method||"get").toLowerCase();let i=a&&St.merge(a.common,a[e.method]);a&&St.forEach(["delete","get","head","post","put","patch","common"],g=>{delete a[g]}),e.headers=Xo.concat(i,a);const s=[];let u=!0;this.interceptors.request.forEach(function(x){typeof x.runWhen=="function"&&x.runWhen(e)===!1||(u=u&&x.synchronous,s.unshift(x.fulfilled,x.rejected))});const l=[];this.interceptors.response.forEach(function(x){l.push(x.fulfilled,x.rejected)});let c,h=0,d;if(!u){const g=[kM.bind(this),void 0];for(g.unshift(...s),g.push(...l),d=g.length,c=Promise.resolve(e);h<d;)c=c.then(g[h++],g[h++]);return c}d=s.length;let p=e;for(;h<d;){const g=s[h++],x=s[h++];try{p=g(p)}catch(y){x.call(this,y);break}}try{c=kM.call(this,p)}catch(g){return Promise.reject(g)}for(h=0,d=l.length;h<d;)c=c.then(l[h++],l[h++]);return c}getUri(t){t=zc(this.defaults,t);const e=sq(t.baseURL,t.url,t.allowAbsoluteUrls);return nq(e,t.params,t.paramsSerializer)}};St.forEach(["delete","get","head","options"],function(t){wc.prototype[t]=function(e,r){return this.request(zc(r||{},{method:t,url:e,data:(r||{}).data}))}});St.forEach(["post","put","patch"],function(t){function e(r){return function(a,i,s){return this.request(zc(s||{},{method:t,headers:r?{"Content-Type":"multipart/form-data"}:{},url:a,data:i}))}}wc.prototype[t]=e(),wc.prototype[t+"Form"]=e(!0)});let LBt=class fq{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let e;this.promise=new Promise(function(a){e=a});const r=this;this.promise.then(o=>{if(!r._listeners)return;let a=r._listeners.length;for(;a-- >0;)r._listeners[a](o);r._listeners=null}),this.promise.then=o=>{let a;const i=new Promise(s=>{r.subscribe(s),a=s}).then(o);return i.cancel=function(){r.unsubscribe(a)},i},t(function(a,i,s){r.reason||(r.reason=new Rd(a,i,s),e(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const e=this._listeners.indexOf(t);e!==-1&&this._listeners.splice(e,1)}toAbortSignal(){const t=new AbortController,e=r=>{t.abort(r)};return this.subscribe(e),t.signal.unsubscribe=()=>this.unsubscribe(e),t.signal}static source(){let t;return{token:new fq(function(o){t=o}),cancel:t}}};function PBt(n){return function(e){return n.apply(null,e)}}function BBt(n){return St.isObject(n)&&n.isAxiosError===!0}const ak={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(ak).forEach(([n,t])=>{ak[t]=n});function dq(n){const t=new wc(n),e=G6(wc.prototype.request,t);return St.extend(e,wc.prototype,t,{allOwnKeys:!0}),St.extend(e,t,null,{allOwnKeys:!0}),e.create=function(o){return dq(zc(n,o))},e}const tr=dq(dv);tr.Axios=wc;tr.CanceledError=Rd;tr.CancelToken=LBt;tr.isCancel=aq;tr.VERSION=hq;tr.toFormData=Kb;tr.AxiosError=ke;tr.Cancel=tr.CanceledError;tr.all=function(t){return Promise.all(t)};tr.spread=PBt;tr.isAxiosError=BBt;tr.mergeConfig=zc;tr.AxiosHeaders=Xo;tr.formToJSON=n=>oq(St.isHTMLForm(n)?new FormData(n):n);tr.getAdapter=cq.getAdapter;tr.HttpStatusCode=ak;tr.default=tr;const{Axios:rzt,AxiosError:ozt,CanceledError:azt,isCancel:izt,CancelToken:szt,VERSION:uzt,all:lzt,Cancel:czt,isAxiosError:hzt,spread:fzt,toFormData:dzt,AxiosHeaders:pzt,HttpStatusCode:mzt,formToJSON:gzt,getAdapter:vzt,mergeConfig:xzt}=tr;function zBt({setSongs:n}){const t=_t.useRef(),e=async()=>{try{const a="/models";console.log("Loading face-api.js models..."),await Promise.all([Pr.tinyFaceDetector.loadFromUri(a),Pr.faceExpressionNet.loadFromUri(a),Pr.faceLandmark68Net.loadFromUri(a)]),console.log("Models loaded successfully!")}catch(a){console.error("Error loading models:",a)}},r=()=>{navigator.mediaDevices.getUserMedia({video:!0}).then(a=>{t.current.srcObject=a}).catch(a=>{console.error("Error accessing webcam: ",a),alert("Please allow camera access to use this feature")})};async function o(){if(!Pr.tinyFaceDetector.params||!Pr.faceExpressionNet.params||!Pr.faceLandmark68Net.params){alert("Face-api models are not loaded yet. Please wait a moment and try again.");return}const a=await _dt(t.current,new YB).withFaceExpressions();let i=0,s="";if(console.log(a),!a||a.length===0){console.log("No face detected");return}for(const u of Object.keys(a[0].expressions))a[0].expressions[u]>i&&(i=a[0].expressions[u],s=u);console.log(s),tr.get(`http://localhost:3000/songs?mood=${s}`).then(u=>{console.log(u.data),n(u.data.songs)})}return _t.useEffect(()=>{kpt("webgl").then(()=>{e().then(r)})},[]),Ot.jsxs("div",{className:"mood-element",children:[Ot.jsx("h1",{children:"Moodify Player"}),Ot.jsx("video",{ref:t,autoPlay:!0,muted:!0,className:"user-video-feed"}),Ot.jsx("button",{onClick:o,children:"Detect Mood"})]})}const UBt=({Songs:n})=>{const[t,e]=_t.useState(null),r=o=>{e(t===o?null:o)};return Ot.jsxs("div",{className:"mood-songs",children:[Ot.jsx("h2",{children:"Recommended Songs"}),n.map((o,a)=>Ot.jsxs("div",{className:"song",children:[Ot.jsxs("div",{className:"title",children:[Ot.jsx("h3",{children:o.title}),Ot.jsx("p",{children:o.artist})]}),Ot.jsxs("div",{className:"play-pause-button",children:[t===a&&Ot.jsx("audio",{src:o.audio,style:{display:"none"},autoPlay:t===a}),Ot.jsx("button",{onClick:()=>r(a),children:t===a?Ot.jsx("i",{className:"ri-pause-line"}):Ot.jsx("i",{className:"ri-play-circle-fill"})})]})]},a))]})};function WBt(){const[n,t]=_t.useState([]);return Ot.jsxs(Ot.Fragment,{children:[Ot.jsx(zBt,{setSongs:t}),Ot.jsx(UBt,{Songs:n})]})}const VBt=()=>{const[n,t]=_t.useState(""),[e,r]=_t.useState(""),[o,a]=_t.useState(""),[i,s]=_t.useState(null),[u,l]=_t.useState(!1),[c,h]=_t.useState([]),d=["neutral","happy","sad","angry","fearful","disgusted","surprised"],p={neutral:"😐",happy:"😊",sad:"😢",angry:"😠",fearful:"😨",disgusted:"🤢",surprised:"😮"};_t.useEffect(()=>{const E=setTimeout(()=>{h(S=>S.filter(k=>Date.now()-k.id<5e3))},5e3);return()=>clearTimeout(E)},[c]);const g=(E,S,k)=>{const R=Date.now(),A={id:R,type:E,title:S,message:k,timestamp:Date.now()};h(N=>[...N,A]),setTimeout(()=>{h(N=>N.filter(_=>_.id!==R))},5e3)},x=E=>{h(S=>S.filter(k=>k.id!==E))},y=async E=>{if(E.preventDefault(),!n||!e||!o||!i){g("error","Validation Error","Please fill all fields");return}const S=new FormData;S.append("title",n),S.append("artist",e),S.append("mood",o),S.append("audio",i);try{l(!0),await tr.post("http://localhost:3000/songs",S,{headers:{"Content-Type":"multipart/form-data"}}),g("success","Success!","Song uploaded successfully!"),t(""),r(""),a(""),s(null)}catch(k){g("error","Upload Failed",k.message)}finally{l(!1)}},b=E=>{const S=E.target.files?.[0]||null;s(S)},C=E=>{a(E)};return Ot.jsxs(Ot.Fragment,{children:[Ot.jsx("div",{className:"notification-container",children:c.map(E=>Ot.jsxs("div",{className:`notification-popup ${E.type}`,children:[Ot.jsx("div",{className:`notification-icon ${E.type}`,children:E.type==="success"?Ot.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:Ot.jsx("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"})}):Ot.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:Ot.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"})})}),Ot.jsxs("div",{className:"notification-content",children:[Ot.jsx("div",{className:"notification-title",children:E.title}),Ot.jsx("div",{className:"notification-message",children:E.message})]}),Ot.jsx("button",{className:"notification-close",onClick:()=>x(E.id),children:Ot.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:Ot.jsx("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})})}),Ot.jsx("div",{className:"notification-progress"})]},E.id))}),Ot.jsx("div",{className:"song",children:Ot.jsx("div",{className:"upload-song-container",children:Ot.jsxs("form",{onSubmit:y,className:"upload-song-form",children:[Ot.jsx("h2",{className:"upload-song-title",children:"Upload Your Song"}),Ot.jsx("div",{className:"form-group",children:Ot.jsx("input",{type:"text",placeholder:"Song Title",value:n,onChange:E=>t(E.target.value),required:!0,className:"form-input"})}),Ot.jsx("div",{className:"form-group",children:Ot.jsx("input",{type:"text",placeholder:"Artist Name",value:e,onChange:E=>r(E.target.value),required:!0,className:"form-input"})}),Ot.jsxs("div",{className:"form-group",children:[Ot.jsx("label",{className:"form-input",style:{cursor:"pointer"},children:"Select Mood"}),Ot.jsx("div",{className:"mood-selector",children:d.map(E=>Ot.jsxs("div",{className:`mood-option ${o===E?"selected":""}`,onClick:()=>C(E),children:[Ot.jsx("span",{className:"emoji",children:p[E]}),Ot.jsx("span",{className:"text",children:E})," "]},E))})]}),Ot.jsx("div",{className:"form-group",children:Ot.jsxs("div",{className:"file-input-wrapper",children:[Ot.jsx("input",{type:"file",accept:"audio/*",onChange:b,required:!0,className:"file-input",id:"audio-file"}),Ot.jsxs("label",{htmlFor:"audio-file",className:`file-input-label ${i?"file-selected":""}`,children:[Ot.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:Ot.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"})}),i?i.name:"Choose Audio File"]})]})}),Ot.jsxs("button",{type:"submit",disabled:u,className:"upload-button",children:[u&&Ot.jsx("span",{className:"loading-spinner"}),u?"Uploading...":"Upload Song"]})]})})})]})},GBt=()=>{const[n,t]=_t.useState(!1),e=dl(),r=()=>{t(a=>!a)},o=()=>{t(!1)};return Ot.jsx("nav",{className:"navbar",children:Ot.jsxs("div",{className:"nav-container",children:[Ot.jsx(sc,{to:"/",className:"nav-logo",onClick:o,children:"Moodify"}),Ot.jsxs("div",{className:`navbar-toggle ${n?"active":""}`,onClick:r,"aria-label":"Toggle navigation",tabIndex:0,role:"button",children:[Ot.jsx("span",{}),Ot.jsx("span",{}),Ot.jsx("span",{})]}),Ot.jsxs("ul",{className:`nav-links${n?" open":""}`,children:[Ot.jsx("li",{children:Ot.jsx(sc,{to:"/",className:e.pathname==="/"?"active":"",onClick:o,children:"Home"})}),Ot.jsx("li",{children:Ot.jsx(sc,{to:"/about",className:e.pathname==="/about"?"active":"",onClick:o,children:"About"})}),Ot.jsx("li",{children:Ot.jsx(sc,{to:"/upload",className:e.pathname==="/upload"?"active":"",onClick:o,children:"Upload song"})})]})]})})},HBt=()=>Ot.jsx("div",{className:"about-container",children:Ot.jsxs("div",{className:"about-card",children:[Ot.jsx("h1",{children:"About Our Project"}),Ot.jsxs("p",{children:["This app uses ",Ot.jsx("strong",{children:"face recognition and mood detection"})," to recommend songs from our database. Simply allow camera access, capture your face, and enjoy music that matches your mood."]}),Ot.jsx("h2",{children:"✨ Features"}),Ot.jsxs("ul",{children:[Ot.jsx("li",{children:"📷 Capture your face with camera permission"}),Ot.jsx("li",{children:"😊 Detect your mood instantly"}),Ot.jsx("li",{children:"🎵 Get personalized songs based on mood"}),Ot.jsx("li",{children:"▶️ Play and enjoy music seamlessly"}),Ot.jsx("li",{children:"🛠️ Admin can upload and manage song database easily"})]}),Ot.jsx("h2",{children:"⚡ How It Works"}),Ot.jsxs("ol",{children:[Ot.jsx("li",{children:"Allow camera permission."}),Ot.jsx("li",{children:"Capture your face → App detects your mood."}),Ot.jsx("li",{children:"Song suggestions appear based on mood."}),Ot.jsx("li",{children:"Click play and enjoy!"}),Ot.jsx("li",{children:"Admin can add new songs anytime."})]})]})}),qBt=()=>Ot.jsx("div",{className:"page-not-found-container",children:Ot.jsxs("div",{className:"page-not-found-content",children:[Ot.jsx("h1",{className:"page-not-found-title",children:"404"}),Ot.jsx("p",{className:"page-not-found-subtitle",children:"Route not exits"}),Ot.jsx("p",{className:"page-not-found-desc",children:"The page you're looking for doesn't exist."}),Ot.jsx(sc,{to:"/",className:"page-not-found-link",children:"Go Back Home"})]})});function jBt(){return Ot.jsxs(Ot.Fragment,{children:[Ot.jsx(GBt,{}),Ot.jsxs(DX,{children:[Ot.jsx(Pp,{path:"/",element:Ot.jsx(WBt,{})}),Ot.jsx(Pp,{path:"/upload",element:Ot.jsx(VBt,{})}),Ot.jsx(Pp,{path:"/about",element:Ot.jsx(HBt,{})}),Ot.jsx(Pp,{path:"*",element:Ot.jsx(qBt,{})})]})]})}Uj.createRoot(document.getElementById("root")).render(Ot.jsx(_t.StrictMode,{children:Ot.jsx(eK,{children:Ot.jsx(jBt,{})})}))});export default XBt();
